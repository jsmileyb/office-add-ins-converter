{0}------------------------------------------------

# **Outlook add-ins overview**

#### 07/02/2025

Outlook add-ins are solutions that extend the functionality of the Outlook client through a web-based platform. Outlook add-ins have the following key aspects.

- The same add-in and business logic works across web (Microsoft 365 and Outlook.com), desktop (Outlook on Windows ([new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) and classic) and on Mac), and mobile.
- Outlook add-ins consist of a manifest, which describes how the add-in integrates into Outlook (for example, a button, task pane, or event). It also includes JavaScript and HTML code, which make up the UI and business logic of the add-in.
- Outlook add-ins can be acquired from [AppSource](https://appsource.microsoft.com/) or sideloaded by end users or administrators.
- Outlook add-ins require a network connection to run.

Outlook add-ins are different from COM or VSTO add-ins, which are older integrations specific to Outlook running on Windows. Unlike COM add-ins, Outlook add-ins don't have any code physically installed on the user's device or Outlook client. For an Outlook add-in, Outlook reads the manifest and hooks up the specified controls in the UI, and then loads the JavaScript and HTML. The web components all run in the context of a browser or webview control in a sandbox.

#### ) **Important**

- COM and VSTO add-ins aren't supported in the **[new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** . However, these add-ins are still supported in the classic Outlook on Windows desktop client. To learn more, see **Develop Outlook add-ins for new Outlook on Windows**.
- In classic Outlook on Windows, it isn't recommended to install COM add-ins alongside Office web add-ins, especially if they operate on the same surface or mail item. The operations performed by COM and web add-ins could interfere with each other and lead to unexpected behavior. If you need to support both COM and web add-in versions of your solution, you must specify the COM solution as an equivalent add-in. To learn more, see **Make your Office Add-in compatible with an existing COM add-in**.

The Outlook items that support add-ins include email messages, meeting requests, responses and cancellations, and appointments. Each Outlook add-in defines the context in which it is

{1}------------------------------------------------

available, including the types of items and if the user is reading or composing an item.

#### 7 **Note**

Add-ins that interact with the user's calendar, meetings, or appointments are available only if the user opens the calendar in Outlook, not Teams. However, you can create a Teams meeting app and surface it in Outlook. For more information, see **[Extend a Teams](https://learn.microsoft.com/en-us/microsoftteams/platform/m365-apps/extend-m365-meeting-app) [meeting app to Outlook](https://learn.microsoft.com/en-us/microsoftteams/platform/m365-apps/extend-m365-meeting-app)**.

#### 7 **Note**

If you plan to **publish** your add-in to AppSource and make it available within the Office experience, make sure that you conform to the **Commercial marketplace certification policies**. For example, to pass validation, your add-in must work across all platforms that support the methods that you define (for more information, see **section 1120.3** and the **[Office Add-in application and availability page](https://learn.microsoft.com/en-us/javascript/api/requirement-sets)**).

# **Extension points**

Extension points are the ways that add-ins integrate with Outlook. The following are the ways this can be done.

- Add-ins can declare buttons that appear in command surfaces across messages and appointments. For more information, see Add-in commands.

{2}------------------------------------------------

- Add-ins can link off regular expression matches in messages and appointments. For more information, see Contextual Outlook add-ins.
#### ) **Important**

Entity-based contextual Outlook add-ins are now retired. As an alternative solution, implement regular expression rules in your contextual add-in. For guidance on how to implement these rules, see **Contextual Outlook add-ins**.

- Add-ins can perform tasks when a specific event occurs. For more information, see [Configure your Outlook add-in for event-based activation.](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/autolaunch)
### **Mailbox items available to add-ins**

Outlook add-ins activate when the user is composing or reading a message or appointment, but not other item types. However, add-ins are *not* activated if the current message item, in a compose or read form, is one of the following:

- Protected by Information Rights Management (IRM) or encrypted in other ways for protection and accessed from Outlook on mobile devices. A digitally-signed message is an example since digital signing relies on one of these mechanisms. To learn more about IRM support in Outlook add-ins, see Mail items protected by IRM.
- An IRM-protected mail item with a sensitivity label that has the **Allow programmatic access** custom policy option set to false . To learn more about IRM support in Outlook add-ins, see Mail items protected by IRM.
- A delivery report or notification that has the message class IPM.Report.*, including delivery and Non-Delivery Report (NDR) reports, and read, non-read, and delay notifications.
- A .msg or .eml file which is an attachment to another message.
- A .msg or .eml file opened from the file system.
- In a [group mailbox](https://learn.microsoft.com/en-us/microsoft-365/admin/create-groups/compare-groups?view=o365-worldwide&preserve-view=true#shared-mailboxes), in a shared mailbox*, in another user's mailbox*, in an [archive](https://learn.microsoft.com/en-us/purview/archive-mailboxes) [mailbox,](https://learn.microsoft.com/en-us/purview/archive-mailboxes) or in a public folder.

#### ) **Important**

* Support for delegate access scenarios (for example, folders shared from another user's mailbox) was introduced in **[requirement set 1.8](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.8/outlook-requirement-set-1.8)**, while shared mailbox support 

{3}------------------------------------------------

was introduced in **[requirement set 1.13](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.13/outlook-requirement-set-1.13)**. To learn more, see **Implement shared folders and shared mailbox scenarios**.

- Using a custom form.
- Created through Simple MAPI. Simple MAPI is used when an Office user creates or sends an email from an Office application on Windows while Outlook is closed. For example, a user can create an Outlook email while working in Word which triggers an Outlook compose window without launching the full Outlook application. If, however, Outlook is already running when the user creates the email from Word, that isn't a Simple MAPI scenario so Outlook add-ins work in the compose form as long as other activation requirements are met.

Currently, there are additional considerations when designing and implementing add-ins for mobile clients. To learn more, see Add support for add-in commands in Outlook on mobile devices.

### **Mail items protected by IRM**

Outlook add-ins activate on IRM-protected mail items when the item is accessed from the following supported clients.

- Outlook on the web
- [New Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)
- Classic Outlook on Windows starting in Version 2009 (Build 13229.10000)

#### 7 **Note**

Digital signing relies on protection mechanisms, such as IRM. Starting in classic Outlook on Windows Version 1711 (Build 8711.1000) associated with a Microsoft 365 subscription, add-ins activate on digitally-signed messages.

- Outlook on Mac starting in Version 16.77 (23082700)
However, add-ins won't activate on IRM-protected items when:

- The IRM-protected item is accessed from Outlook on mobile devices.
- The IRM-protected item has a sensitivity label with the **Allow programmatic access** custom policy option set to false . For more information on custom policy options, see [Usage rights and descriptions.](https://learn.microsoft.com/en-us/azure/information-protection/configure-usage-rights)

{4}------------------------------------------------

# **Supported clients**

Outlook add-ins are supported in Outlook on the web, Outlook on Windows (new and classic), Outlook on Mac, Outlook on iOS, Outlook on Android, and Outlook.com. Not all of the newest features are supported in all clients at the same time. For details about feature support on clients and servers, see [Requirement sets supported by Exchange servers and Outlook clients](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients) and articles specific to those features.

# **Supported accounts**

On supported Outlook clients, add-ins can run on Outlook.com (consumer or personal) and Microsoft 365 business mailbox accounts. For more information on Microsoft accounts, see [What's the difference between a Microsoft account and a work or school account?](https://support.microsoft.com/account-billing/72f10e1e-cab8-4950-a8da-7c45339575b0) .

While non-Microsoft mailbox accounts, such as Gmail and Yahoo Mail, can be added to certain Outlook clients, Outlook add-ins aren't always supported on these accounts. The following table outlines add-in support on non-Microsoft accounts for each Outlook client.

ノ **Expand table**

| Outlook client                | Add-in support on non-Microsoft accounts                                                                                                                                                            |
|-------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Web                           | Not supported.                                                                                                                                                                                      |
| new Outlook on<br>Windows     | Not supported.                                                                                                                                                                                      |
| classic Outlook on<br>Windows | Not supported.                                                                                                                                                                                      |
| Mac                           | If a non-Microsoft account was added using the IMAP CloudCache option,<br>add-ins are supported.<br>If a non-Microsoft account was added using the IMAP Direct option, add<br>ins aren't supported. |
| Mobile (Android and<br>iOS)   | Not supported.                                                                                                                                                                                      |

When using non-Microsoft accounts that support add-ins in Outlook, note that you must first select a folder or item in the non-Microsoft mailbox to load the add-in.

# **Get started building Outlook add-ins**

To get started building Outlook add-ins, try the following:

{5}------------------------------------------------

- Quick start Build a simple task pane.
- Tutorial Learn how to create an add-in that inserts GitHub gists into a new message.

# **See also**

- [Learn about the Microsoft 365 Developer Program](https://aka.ms/m365devprogram)
- Best practices for developing Office Add-ins
- Design guidelines for Office Add-ins
- [License your Office and SharePoint Add-ins](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/why-publish)
- Publish your Office Add-in
- [Make your solutions available in AppSource and within Office](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/submit-to-appsource-via-partner-center)

{6}------------------------------------------------

# **Build your first Outlook add-in**

Article • 04/30/2025

In this article, you'll walk through the process of building an Outlook task pane add-in using Yo Office that displays at least one property of a selected message.

# **Prerequisites**

- Node.js (the latest LTS version). Visit the [Node.js site](https://nodejs.org/) to download and install the right version for your operating system.
- The latest version of Yeoman and the Yeoman generator for Office Add-ins. To install these tools globally, run the following command via the command prompt.

command line npm install -g yo generator-office

7 **Note**

Even if you've previously installed the Yeoman generator, we recommend you update your package to the latest version from npm.

- Office connected to a Microsoft 365 subscription (including Office on the web).
#### 7 **Note**

If you don't already have Office, you might qualify for a Microsoft 365 E5 developer subscription through the **[Microsoft 365 Developer Program](https://aka.ms/m365devprogram)** ; for details, see the **[FAQ](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-)**. Alternatively, you can **[sign up for a 1-month free trial](https://www.microsoft.com/microsoft-365/try)** or **[purchase a](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g) [Microsoft 365 plan](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g)** .

- Outlook on the web, [new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) , Outlook 2016 or later on Windows (connected to a Microsoft 365 account), or Outlook on Mac.
# **Create the add-in project**

- 1. Run the following command to create an add-in project using the Yeoman generator. A folder that contains the project will be added to the current directory.

{7}------------------------------------------------

#### yo office

#### 7 **Note**

When you run the yo office command, you may receive prompts about the data collection policies of Yeoman and the Office Add-in CLI tools. Use the information that's provided to respond to the prompts as you see fit.

When prompted, provide the following information to create your add-in project.

- **Choose a project type** Office Add-in Task Pane project
- **Choose a script type** JavaScript
- **What do you want to name your add-in?** My Office Add-in
- **Which Office client application would you like to support?** Outlook
- **Which manifest would you like to use?** Choose either Unified manifest for Microsoft 365 or Add-in only manifest

#### 7 **Note**

The unified manifest for Microsoft 365 enables you to combine an Outlook Add-in with a Teams app as a single unit of development and deployment. We're working to extend support for the unified manifest to Excel, PowerPoint, Word, custom Copilot development, and other extensions of Microsoft 365. For more about it, see **Office Add-ins with the unified manifest**. For a sample of a combined Teams app and Outlook Add-in, see **[Discount Offers](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/tab-add-in-combined/nodejs)** .

We love to get your feedback about the unified manifest. If you have any suggestions, please create an issue in the repo for the **[Office JavaScript Library](https://github.com/OfficeDev/office-js/issues)** .

Depending on your choice of manifest, the prompts and answers should look like one of the following:

{8}------------------------------------------------

After you complete the wizard, the generator will create the project and install supporting Node components.

- 2. Navigate to the root folder of the web application project.
# **Explore the project**

The Yeoman generator creates a project in a folder with the project name that you chose. The project contains sample code for a very basic task pane add-in. The following are the most important files.

- The **./manifest.json** or **./manifest.xml** file in the root directory of the project defines the settings and capabilities of the add-in.
- The **./src/taskpane/taskpane.html** file contains the HTML markup for the task pane.
- The **./src/taskpane/taskpane.css** file contains the CSS that's applied to content in the task pane.
- The **./src/taskpane/taskpane.js** file contains the Office JavaScript API code that facilitates interaction between the task pane and Outlook.

{9}------------------------------------------------

# **Try it out**

#### 7 **Note**

- Office Add-ins should use HTTPS, not HTTP, even while you're developing. If you're prompted to install a certificate after you run one of the following commands, accept the prompt to install the certificate that the Yeoman generator provides. You may also have to run your command prompt or terminal as an administrator for the changes to be made.
- If this is your first time developing an Office Add-in on your machine, you may be prompted in the command line to grant Microsoft Edge WebView a loopback exemption ("Allow localhost loopback for Microsoft Edge WebView?"). When prompted, enter Y to allow the exemption. Note that you'll need administrator privileges to allow the exemption. Once allowed, you shouldn't be prompted for an exemption when you sideload Office Add-ins in the future (unless you remove the exemption from your machine). To learn more, see **["We can't open this add-in from](https://learn.microsoft.com/en-us/office/troubleshoot/office-suite-issues/cannot-open-add-in-from-localhost) [localhost" when loading an Office Add-in or using Fiddler](https://learn.microsoft.com/en-us/office/troubleshoot/office-suite-issues/cannot-open-add-in-from-localhost)**.

- When you first use Yeoman generator to develop an Office Add-in, your default browser opens a window where you'll be prompted to sign in to your Microsoft 365 account. If a sign-in window doesn't appear and you encounter a sideloading or login timeout error, run teamsapp auth login m365 .
- 1. Run the following command in the root directory of your project. When you run this command, the local web server starts and your add-in is sideloaded.

| command line |  |  |  |  |
|--------------|--|--|--|--|
| npm start    |  |  |  |  |
|              |  |  |  |  |

7 **Note**

{10}------------------------------------------------

- When you first use Yeoman generator to develop an Office Add-in, your default browser opens a window where you'll be prompted to sign in to your Microsoft 365 account. If a sign-in window doesn't appear and you encounter a sideloading or login timeout error, run teamsapp auth login m365 before running npm start again.
If your add-in wasn't automatically sideloaded, follow the instructions in **Sideload Outlook add-ins for testing** to manually sideload the add-in in Outlook.

- 2. In Outlook, view a message in the [Reading Pane](https://support.microsoft.com/office/2fd687ed-7fc4-4ae3-8eab-9f9b8c6d53f0) , or open the message in its own window.
- 3. Select the **Show Taskpane** button to open the add-in task pane. The location of the addin button varies depending on the Outlook client you're using.
	- **Outlook on the web** and **new Outlook on Windows**: From the action bar of the message, select **Apps**. Then, select **My Office Add-in** > **Show Taskpane**.
	- **Classic Outlook on Windows**: Select the **Home** tab (or the **Message** tab if you opened the message in a new window). Then, select **Show Taskpane** from the ribbon.
	- **Outlook on Mac**: Select **My Office Add-in** from the ribbon, then select **Show Taskpane**. You may need to select the ellipsis button ( ... ) from the ribbon to view your add-ins.

The following screenshots show how the add-in appears in classic Outlook on Windows.

{11}------------------------------------------------

- 4. When prompted with the **WebView Stop On Load** dialog box, select **OK**.
#### 7 **Note**

If you select **Cancel**, the dialog won't be shown again while this instance of the addin is running. However, if you restart your add-in, you'll see the dialog again.

- 5. Scroll to the bottom of the task pane and choose the **Run** link to write the message subject to the task pane.

{12}------------------------------------------------

- 6. When you want to stop the local web server and uninstall the add-in, follow the applicable instructions:

{13}------------------------------------------------

- To stop the server, run the following command. If you used npm start , the following command should also uninstall the add-in.
command line npm stop

- If you manually sideloaded the add-in, see Remove a sideloaded add-in.
# **Next steps**

Congratulations, you've successfully created your first Outlook task pane add-in! Next, explore more capabilities of an Outlook add-in by following along with the Outlook add-in tutorial. In the tutorial, you'll build a more complex add-in that incorporates a task pane, which you've learned about in the quick start. Additionally, you'll create a button that invokes a UI-less function.

# **Troubleshooting**

- Ensure your environment is ready for Office development by following the instructions in Set up your development environment.
- Some of the sample code uses ES6 JavaScript. This isn't compatible with older versions of Office that use the Trident (Internet Explorer 11) browser engine. For information on how to support those platforms in your add-in, see Support older Microsoft webviews and Office versions. If you don't already have a Microsoft 365 subscription to use for development, you might qualify for a Microsoft 365 E5 developer subscription through the [Microsoft 365 Developer Program](https://aka.ms/m365devprogram) ; for details, see the [FAQ.](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-) Alternatively, you can [sign up for a 1-month free trial](https://www.microsoft.com/microsoft-365/try) or [purchase a Microsoft 365 plan](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g) .
- The automatic npm install step Yo Office performs may fail. If you see errors when trying to run npm start , navigate to the newly created project folder in a command prompt and manually run npm install . For more information about Yo Office, see Create Office Addin projects using the Yeoman Generator.
- If you receive the error "We can't open this add-in from localhost" in the task pane, follow the steps outlined in the [troubleshooting article](https://learn.microsoft.com/en-us/office/troubleshoot/office-suite-issues/cannot-open-add-in-from-localhost).

# **Code samples**

{14}------------------------------------------------

- [Outlook "Hello world" add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/hello-world/outlook-hello-world) : Learn how to build a simple Office Add-in with only a manifest, HTML web page, and a logo.
# **See also**

- Office Add-ins with the add-in only manifest
- Using Visual Studio Code to publish

{15}------------------------------------------------

# **Tutorial: Build a message compose Outlook add-in**

Article • 01/07/2025

This tutorial teaches you how to build an Outlook add-in that can be used in message compose mode to insert content into the body of a message.

In this tutorial, you will:

- " Create an Outlook add-in project
- " Define buttons that appear in the compose message window
- Implement a first-run experience that collects information from the user and fetches data from an external service "
- " Implement a UI-less button that invokes a function
- " Implement a task pane that inserts content into the body of a message

#### **Tip**

If you want a completed version of this tutorial (using the add-in only manifest), visit the **[Office Add-ins samples repo on GitHub](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/tutorials/outlook-tutorial)** .

# **Prerequisites**

- Node.js (the latest LTS version). Visit the [Node.js site](https://nodejs.org/) to download and install the right version for your operating system.
- The latest version of Yeoman and the Yeoman generator for Office Add-ins. To install these tools globally, run the following command via the command prompt.

```
command line
```

```
npm install -g yo generator-office
```
#### 7 **Note**

Even if you've previously installed the Yeoman generator, we recommend you update your package to the latest version from npm.

- Office connected to a Microsoft 365 subscription (including Office on the web).

{16}------------------------------------------------

#### 7 **Note**

If you don't already have Office, you might qualify for a Microsoft 365 E5 developer subscription through the **[Microsoft 365 Developer Program](https://aka.ms/m365devprogram)** ; for details, see the **[FAQ](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-)**. Alternatively, you can **[sign up for a 1-month free trial](https://www.microsoft.com/microsoft-365/try)** or **[purchase a Microsoft 365 plan](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g)** .

- [Visual Studio Code (VS Code)](https://code.visualstudio.com/) or your preferred code editor.
- Outlook on the web, [new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) , or Outlook 2016 or later on Windows (connected to a Microsoft 365 account).
- A [GitHub](https://www.github.com/) account.

# **Setup**

The add-in that you'll create in this tutorial will read [gists](https://gist.github.com/) from the user's GitHub account and add the selected gist to the body of a message. Complete the following steps to create two new gists that you can use to test the add-in you're going to build.

- 1. [Login to GitHub](https://github.com/login) .
- 2. [Create a new gist](https://gist.github.com/) .
	- In the **Gist description...** field, enter **Hello World Markdown**.
	- In the **Filename including extension...** field, enter **test.md**.
	- Add the following markdown to the multiline textbox.

```
markdown
# Hello World
This is content converted from Markdown!
Here's a JSON sample:
 ```json
 {
 "foo": "bar"
 }
 ```
```
- Select the **Create public gist** button.

{17}------------------------------------------------

#### 3. [Create another new gist](https://gist.github.com/) .

- In the **Gist description...** field, enter **Hello World Html**.
- In the **Filename including extension...** field, enter **test.html**.
- Add the following markdown to the multiline textbox.

```
HTML
<html>
 <head>
 <style>
 h1 {
 font-family: Calibri;
 }
 </style>
 </head>
 <body>
 <h1>Hello World!</h1>
 <p>This is a test</p>
 </body>
</html>
```
- Select the **Create public gist** button.
### **Create an Outlook add-in project**

- 1. Run the following command to create an add-in project using the Yeoman generator. A folder that contains the project will be added to the current directory.
command line yo office

7 **Note**

When you run the yo office command, you may receive prompts about the data collection policies of Yeoman and the Office Add-in CLI tools. Use the information that's provided to respond to the prompts as you see fit.

When prompted, provide the following information to create your add-in project.

- 2. The steps to create the project vary slightly depending on the type of manifest.

{18}------------------------------------------------

#### 7 **Note**

The unified manifest for Microsoft 365 enables you to combine an Outlook Add-in with a Teams app as a single unit of development and deployment. We're working to extend support for the unified manifest to Excel, PowerPoint, Word, custom Copilot development, and other extensions of Microsoft 365. For more about it, see **Office Add-ins with the unified manifest**. For a sample of a combined Teams app and Outlook Add-in, see **[Discount Offers](https://github.com/OfficeDev/Microsoft-Teams-Samples/tree/main/samples/tab-add-in-combined/nodejs)** .

We love to get your feedback about the unified manifest. If you have any suggestions, please create an issue in the repo for the **[Office JavaScript](https://github.com/OfficeDev/office-js/issues) [Library](https://github.com/OfficeDev/office-js/issues)** .

| Unified manifest for Microsoft 365                                   |
|----------------------------------------------------------------------|
|                                                                      |
| Choose a project type - Office<br>Add-in Task Pane project           |
| Choose a script type - JavaScript                                    |
| What do you want to name your add-in? - Git<br>the gist              |
| Which Office client application would you like to support? - Outlook |
| Which manifest would you like to use? - unified<br>manifest for      |
| Microsoft 365                                                        |
|                                                                      |

After you complete the wizard, the generator creates the project and installs supporting Node components.

- 3. Navigate to the root directory of the project.

| command line |  |  |  |  |  |  |
|--------------|--|--|--|--|--|--|

{19}------------------------------------------------

- 4. This add-in uses the following libraries.
	- [Showdown](https://github.com/showdownjs/showdown) library to convert Markdown to HTML.
	- [URI.js](https://github.com/medialize/URI.js) library to build relative URLs.
	- [jQuery](https://jquery.com/) library to simplify DOM interactions.

To install these tools for your project, run the following command in the root directory of the project.

```
command line
```

```
npm install showdown urijs jquery --save
```
- 5. Open your project in VS Code or your preferred code editor.

```
 Tip
```
On Windows, you can navigate to the root directory of the project via the command line and then enter code . to open that folder in VS Code. On Mac, you'll need to **[add the code command to the path](https://code.visualstudio.com/docs/setup/mac#_launching-from-the-command-line)** before you can use that command to open the project folder in VS Code.

### **Update the manifest**

The manifest for an add-in controls how it appears in Outlook. It defines the way the add-in appears in the add-in list and the buttons that appear on the ribbon, and it sets the URLs for the HTML and JavaScript files used by the add-in.

### **Specify basic information**

Make the following updates in the manifest file to specify some basic information about the add-in.

Unified manifest for Microsoft 365

- 1. Locate the "description" property, replace the default "short" and "long" values with descriptions of the add-in, and save the file.

{20}------------------------------------------------

```
JSON
"description": {
 "short": "Gets gists.",
 "full": "Allows users to access their GitHub gists."
},
```
2. Save the file.

### **Test the generated add-in**

Before going any further, let's test the basic add-in that the generator created to confirm that the project is set up correctly.

7 **Note**

- Office Add-ins should use HTTPS, not HTTP, even while you're developing. If you're prompted to install a certificate after you run one of the following commands, accept the prompt to install the certificate that the Yeoman generator provides. You may also have to run your command prompt or terminal as an administrator for the changes to be made.
- If this is your first time developing an Office Add-in on your machine, you may be prompted in the command line to grant Microsoft Edge WebView a loopback exemption ("Allow localhost loopback for Microsoft Edge WebView?"). When prompted, enter Y to allow the exemption. Note that you'll need administrator privileges to allow the exemption. Once allowed, you shouldn't be prompted for an exemption when you sideload Office Addins in the future (unless you remove the exemption from your machine). To learn more, see **["We can't open this add-in from localhost" when loading an](https://learn.microsoft.com/en-us/office/troubleshoot/office-suite-issues/cannot-open-add-in-from-localhost) [Office Add-in or using Fiddler](https://learn.microsoft.com/en-us/office/troubleshoot/office-suite-issues/cannot-open-add-in-from-localhost)**.

{21}------------------------------------------------

- 1. Run the following command in the root directory of your project. When you run this command, the local web server starts and your add-in is sideloaded.
command line npm start

7 **Note**

If your add-in wasn't automatically sideloaded, follow the instructions in **Sideload Outlook add-ins for testing** to manually sideload the add-in in Outlook.

- 2. In Outlook, open an existing message and select the **Show Taskpane** button.
- 3. When prompted with the **WebView Stop On Load** dialog box, select **OK**.

#### 7 **Note**

If you select **Cancel**, the dialog won't be shown again while this instance of the add-in is running. However, if you restart your add-in, you'll see the dialog again.

If everything's been set up correctly, the task pane opens and renders the add-in's welcome page.

{22}------------------------------------------------

- 4. When you want to stop the local web server and uninstall the add-in, follow the applicable instructions:
	- To stop the server, run the following command. If you used npm start , the following command should also uninstall the add-in.

command line npm stop

- If you manually sideloaded the add-in, see Remove a sideloaded add-in.
# **Define buttons**

{23}------------------------------------------------

Now that you've verified the base add-in works, you can customize it to add more functionality. By default, the manifest only defines buttons for the read message window. Let's update the manifest to remove the buttons from the read message window and define two new buttons for the compose message window:

- **Insert gist**: a button that opens a task pane
- **Insert default gist**: a button that invokes a function

The procedure depends on which manifest you're using.

```
Unified manifest for Microsoft 365
```
Take the following steps:

- 1. Open the **manifest.json** file.
- 2. In the "extensions.runtimes" array, there are two runtime objects. For the second one, with the "id" of "CommandsRuntime", change the "actions.id" to "insertDefaultGist". This is the name of a function that you create in a later step. When you're done, the runtime object should look like the following:

```
JSON
{
 "id": "CommandsRuntime",
 "type": "general",
 "code": {
 "page": "https://localhost:3000/commands.html",
 "script": "https://localhost:3000/commands.js"
 },
 "lifetime": "short",
 "actions": [
 {
 "id": "insertDefaultGist",
 "type": "executeFunction",
 "displayName": "action"
 }
 ]
}
```
- 3. Change the item in the "extensions.ribbons.contexts" array to "mailCompose". This means the buttons will appear only in a new message or reply window.
JSON "contexts": [ "mailCompose"

{24}------------------------------------------------

- ],
- 4. The "extensions.ribbons.tabs.groups" array has a group object in it. Make the following changes to this object.
	- a. Change the "id" property to "msgComposeCmdGroup".
	- b. Change the "label" property to "Git the gist".
- 5. That same group object has a "controls" array with two control objects. We need to make changes to the JSON for each of them. In the first one, take these steps.
	- a. Change the "id" to "msgComposeInsertGist".
	- b. Change the "label" to "Insert gist".
	- c. Change the "supertip.title" to "Insert gist".
	- d. Change the "supertip.description" to "Displays a list of your gists and allows you to insert their contents into the current message."
- 6. In the second control object, take these steps.
	- a. Change the "id" to "msgComposeInsertDefaultGist".
	- b. Change the "label" to "Insert default gist".
	- c. Change the "supertip.title" to "Insert default gist".
	- d. Change the "supertip.description" to "Inserts the content of the gist you mark as default into the current message."
	- e. Change the "actionId" to "insertDefaultGist". This matches the "action.id" of the "CommandsRuntime" that you set in an earlier step.

When you're done, the "ribbons" property should look like the following:

```
JSON
"ribbons": [
 {
 "contexts": [
 "mailCompose"
 ],
 "tabs": [
 {
 "builtInTabId": "TabDefault",
 "groups": [
 {
 "id": "msgComposeCmdGroup",
             "label": "Git the gist",
             "icons": [
 {
 "size": 16,
                  "file": 
"https://localhost:3000/assets/icon-16.png"
 },
```

{25}------------------------------------------------

```
 {
 "size": 32,
                "file": 
"https://localhost:3000/assets/icon-32.png"
 },
              {
 "size": 80,
                "file": 
"https://localhost:3000/assets/icon-80.png"
 }
 ],
            "controls": [
 {
 "id": "msgComposeInsertGist",
                "type": "button",
                "label": "Insert gist",
                "icons": [
 {
 "size": 16,
                     "file": 
"https://localhost:3000/assets/icon-16.png"
 },
                  {
 "size": 32,
                     "file": 
"https://localhost:3000/assets/icon-32.png"
 },
                  {
 "size": 80,
                     "file": 
"https://localhost:3000/assets/icon-80.png"
 }
 ],
                "supertip": {
 "title": "Insert gist",
                  "description": "Displays a list
of your gists and allows you to insert their contents into the
current message."
 },
                "actionId": "TaskPaneRuntimeShow"
 },
              {
 "id": 
"msgComposeInsertDefaultGist",
 "type": "button",
                "label": "Insert default gist",
                "icons": [
 {
 "size": 16,
                     "file": 
"https://localhost:3000/assets/icon-16.png"
 },
                  {
 "size": 32,
                     "file":
```

{26}------------------------------------------------

### **Reinstall the add-in**

You must reinstall the add-in for the manifest changes to take effect.

- 1. If the web server is running, run the following command.
- 2. Run the following command to start the local web server and automatically sideload your add-in.

| command line |  |  |  |  |  |
|--------------|--|--|--|--|--|
| npm start    |  |  |  |  |  |

After you've reinstalled the add-in, you can verify that it installed successfully by checking for the commands **Insert gist** and **Insert default gist** in a compose message window. Note that nothing will happen if you select either of these items, because you haven't yet finished building this add-in.

{27}------------------------------------------------

- If you're running this add-in in Outlook 2016 or later on Windows, you should see two new buttons on the ribbon of the compose message window: **Insert gist** and **Insert default gist**.

| C    | 1)      | Untitled - Message                     |        | E |    | 0<br>×                      |
|------|---------|----------------------------------------|--------|---|----|-----------------------------|
| File | Message | Insert Options Format Text Review Help |        |   |    | Tell me                     |
|      |         | V                                      | B<br>V |   | মি |                             |
|      |         |                                        |        |   |    | Names                       |
|      | To      |                                        |        |   |    | ಡಿ<br>Address Book          |
| Send | CC      |                                        |        |   |    | ಿದ್ದ<br>Check Names         |
|      | Bcc     |                                        |        |   |    | Include                     |
|      |         |                                        |        |   |    | 0<br>Attach File_<br>>      |
|      | Subject |                                        |        |   |    | 2 Link                      |
|      |         |                                        |        |   |    | Signature<br>>              |
|      |         |                                        |        |   |    | Tags                        |
|      |         |                                        |        |   |    | High Importance<br>-        |
|      |         |                                        |        |   |    | Low Importance<br>ﺮ ﺍﻟﻤﺮﺍﺟﻊ |
|      |         |                                        |        |   |    | the<br>Follow Up            |
|      |         |                                        |        |   |    | Assign Policy<br>>          |
|      |         |                                        |        |   |    | Voice                       |
|      |         |                                        |        |   |    | =<br>Dictate<br>>           |
|      |         |                                        |        |   |    | Sensitivity                 |
|      |         |                                        |        |   |    | Sensitivity<br>>            |
|      |         |                                        |        |   |    | Git the gist                |
|      |         |                                        |        |   |    | Insert gist                 |
|      |         |                                        |        |   |    | Insert default gist<br>1    |

- If you're running this add-in in Outlook on the web or new Outlook on Windows, select **Apps** from the ribbon of the compose message window, then select **Git the gist** to see the **Insert gist** and **Insert default gist** options.

| Message       | Insert | Format text | Draw | Options |   |  |  |  |               |  |       |                        |     |
|---------------|--------|-------------|------|---------|---|--|--|--|---------------|--|-------|------------------------|-----|
| 为~ 向~ 日       |        | Aptos       | × 11 |         | B |  |  |  | I U & S N v … |  | April | の × 60 × (1 × )<br>(三) |     |
|               |        |             |      |         |   |  |  |  |               |  |       | Git the gist           |     |
| Send          | V      |             |      |         |   |  |  |  |               |  |       | · Insert gist In       | இ   |
| To            |        |             |      |         |   |  |  |  |               |  |       | Insert default gist    | Boc |
| Cc            |        |             |      |         |   |  |  |  |               |  |       |                        |     |
|               |        |             |      |         |   |  |  |  |               |  |       |                        |     |
| Add a subject |        |             |      |         |   |  |  |  |               |  |       |                        |     |

# **Implement a first-run experience**

This add-in needs to be able to read gists from the user's GitHub account and identify which one the user has chosen as the default gist. In order to achieve these goals, the

{28}------------------------------------------------

add-in must prompt the user to provide their GitHub username and choose a default gist from their collection of existing gists. Complete the steps in this section to implement a first-run experience that displays a dialog to collect this information from the user.

### **Create the UI of the dialog**

Let's start by creating the UI for the dialog.

- 1. Within the **./src** folder, create a new subfolder named **settings**.
- 2. In the **./src/settings** folder, create a file named **dialog.html**.
- 3. In **dialog.html**, add the following markup to define a basic form with a text input for a GitHub username and an empty list for gists that'll be populated via JavaScript.

```
HTML
<!DOCTYPE html>
<html>
<head>
 <meta charset="UTF-8" />
 <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
 <title>Settings</title>
 <!-- Office JavaScript API -->
 <script type="text/javascript"
src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js">
</script>
<!-- For more information on Fluent UI, visit
https://developer.microsoft.com/fluentui. -->
 <link rel="stylesheet" href="https://res-
1.cdn.office.net/files/fabric-cdn-prod_20230815.002/office-ui-fabric-
core/11.0.0/css/fabric.min.css"/>
 <!-- Template styles -->
 <link href="dialog.css" rel="stylesheet" type="text/css" />
</head>
<body class="ms-font-l">
 <main>
 <section class="ms-font-m ms-fontColor-neutralPrimary">
 <div class="not-configured-warning ms-MessageBar ms-MessageBar--
warning">
 <div class="ms-MessageBar-content">
 <div class="ms-MessageBar-icon">
 <i class="ms-Icon ms-Icon--Info"></i>
```

{29}------------------------------------------------

```
 </div>
 <div class="ms-MessageBar-text">
 Oops! It looks like you haven't configured <strong>Git the
gist</strong> yet.
 <br/>
 Please configure your GitHub username and select a default
gist, then try that action again!
 </div>
 </div>
 </div>
 <div class="ms-font-xxl">Settings</div>
 <div class="ms-Grid">
 <div class="ms-Grid-row">
 <div class="ms-TextField">
 <label class="ms-Label">GitHub Username</label>
 <input class="ms-TextField-field" id="github-user"
type="text" value="" placeholder="Please enter your GitHub username">
 </div>
 </div>
 <div class="error-display ms-Grid-row">
 <div class="ms-font-l ms-fontWeight-semibold">An error
occurred:</div>
 <pre><code id="error-text"></code></pre>
 </div>
 <div class="gist-list-container ms-Grid-row">
 <div class="list-title ms-font-xl ms-fontWeight-
regular">Choose Default Gist</div>
 <form>
 <div id="gist-list">
 </div>
 </form>
 </div>
 </div>
 <div class="ms-Dialog-actions">
 <div class="ms-Dialog-actionsRight">
 <button class="ms-Dialog-action ms-Button ms-Button--primary"
id="settings-done" disabled>
 <span class="ms-Button-label">Done</span>
 </button>
 </div>
 </div>
 </section>
 </main>
 <script type="text/javascript"
src="../../node_modules/jquery/dist/jquery.js"></script>
 <script type="text/javascript" src="../helpers/gist-api.js"></script>
 <script type="text/javascript" src="dialog.js"></script>
</body>
</html>
```
You may have noticed that the HTML file references a JavaScript file, **gist-api.js**, that doesn't yet exist. This file will be created in the Fetch data from GitHub section 

{30}------------------------------------------------

below.

- 4. Save your changes.
- 5. Next, create a file in the **./src/settings** folder named **dialog.css**.
- 6. In **dialog.css**, add the following code to specify the styles that are used by **dialog.html**.

```
css
section {
 margin: 10px 20px;
}
.not-configured-warning {
 display: none;
}
.error-display {
 display: none;
}
.gist-list-container {
 margin: 10px -8px;
 display: none;
}
.list-title {
 border-bottom: 1px solid #a6a6a6;
 padding-bottom: 5px;
}
ul {
 margin-top: 10px;
}
.ms-ListItem-secondaryText,
.ms-ListItem-tertiaryText {
 padding-left: 15px;
}
```
- 7. Save your changes.
### **Develop the functionality of the dialog**

Now that you've defined the dialog UI, you can write the code that makes it actually do something.

- 1. In the **./src/settings** folder, create a file named **dialog.js**.

{31}------------------------------------------------

- 2. Add the following code. Note that this code uses jQuery to register events and uses the messageParent method to send the user's choices back to the caller.

```
JavaScript
(function() {
 'use strict';
 // The onReady function must be run each time a new page is loaded.
 Office.onReady(function() {
 $(document).ready(function() {
 if (window.location.search) {
 // Check if warning should be displayed.
 const warn = getParameterByName('warn');
 if (warn) {
 $('.not-configured-warning').show();
 } else {
 // See if the config values were passed.
 // If so, pre-populate the values.
 const user = getParameterByName('gitHubUserName');
 const gistId = getParameterByName('defaultGistId');
 $('#github-user').val(user);
 loadGists(user, function(success) {
 if (success) {
 $('.ms-ListItem').removeClass('is-selected');
 $('input').filter(function() {
 return this.value === gistId;
 }).addClass('is-selected').attr('checked', 'checked');
 $('#settings-done').removeAttr('disabled');
 }
 });
 }
 }
 // When the GitHub username changes,
 // try to load gists.
 $('#github-user').on('change', function() {
 $('#gist-list').empty();
 const ghUser = $('#github-user').val();
 if (ghUser.length > 0) {
 loadGists(ghUser);
 }
 });
 // When the Done button is selected, send the
 // values back to the caller as a serialized
 // object.
 $('#settings-done').on('click', function() {
 const settings = {};
 settings.gitHubUserName = $('#github-user').val();
 const selectedGist = $('.ms-ListItem.is-selected');
```

{32}------------------------------------------------

```
 if (selectedGist) {
 settings.defaultGistId = selectedGist.val();
 sendMessage(JSON.stringify(settings));
 }
 });
 });
 });
 // Load gists for the user using the GitHub API
 // and build the list.
 function loadGists(user, callback) {
 getUserGists(user, function(gists, error) {
 if (error) {
 $('.gist-list-container').hide();
 $('#error-text').text(JSON.stringify(error, null, 2));
 $('.error-display').show();
 if (callback) callback(false);
 } else {
 $('.error-display').hide();
 buildGistList($('#gist-list'), gists, onGistSelected);
 $('.gist-list-container').show();
 if (callback) callback(true);
 }
 });
 }
 function onGistSelected() {
 $('.ms-ListItem').removeClass('is-selected').removeAttr('checked');
 $(this).children('.ms-ListItem').addClass('is-
selected').attr('checked', 'checked');
 $('.not-configured-warning').hide();
 $('#settings-done').removeAttr('disabled');
 }
 function sendMessage(message) {
 Office.context.ui.messageParent(message);
 }
 function getParameterByName(name, url) {
 if (!url) {
 url = window.location.href;
 }
 name = name.replace(/[\[\]]/g, "\\$&");
 const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
 results = regex.exec(url);
 if (!results) return null;
 if (!results[2]) return '';
 return decodeURIComponent(results[2].replace(/\+/g, " "));
```

{33}------------------------------------------------

 } })();

- 3. Save your changes.
### **Update webpack config settings**

Finally, open the **webpack.config.js** file found in the root directory of the project and complete the following steps.

- 1. Locate the entry object within the config object and add a new entry for dialog .

```
JavaScript
dialog: "./src/settings/dialog.js",
```
After you've done this, the new entry object will look like this:

```
JavaScript
entry: {
 polyfill: ["core-js/stable", "regenerator-runtime/runtime"],
 taskpane: ["./src/taskpane/taskpane.js", 
"./src/taskpane/taskpane.html"],
 commands: "./src/commands/commands.js",
 dialog: "./src/settings/dialog.js",
},
```
- 2. Locate the plugins array within the config object. In the patterns array of the new CopyWebpackPlugin object, add new entries for **taskpane.css** and **dialog.css**.

```
JavaScript
{
 from: "./src/taskpane/taskpane.css",
 to: "taskpane.css",
},
{
 from: "./src/settings/dialog.css",
 to: "dialog.css",
},
```
After you've done this, the new CopyWebpackPlugin object will look like the following. Note the slight difference if the add-in uses the add-in only manifest.

{34}------------------------------------------------

```
JavaScript
```

```
new CopyWebpackPlugin({
 patterns: [
 {
 from: "./src/taskpane/taskpane.css",
 to: "taskpane.css",
 },
 {
 from: "./src/settings/dialog.css",
 to: "dialog.css",
 },
 {
 from: "assets/*",
 to: "assets/[name][ext][query]",
 },
 {
 from: "manifest*.json", // The file extension is "xml" if the add-
in only manifest is being used.
 to: "[name]" + "[ext]",
 transform(content) {
 if (dev) {
 return content;
 } else {
 return content.toString().replace(new RegExp(urlDev, "g"),
urlProd);
 }
 },
 },
]}),
```
- 3. In the same plugins array within the config object, add this new object to the end of the array.

```
JavaScript
new HtmlWebpackPlugin({
 filename: "dialog.html",
 template: "./src/settings/dialog.html",
 chunks: ["polyfill", "dialog"]
})
```
After you've done this, the new plugins array will look ike the following. Note the slight difference if the add-in uses the add-in only manifest.

```
JavaScript
plugins: [
 new HtmlWebpackPlugin({
 filename: "taskpane.html",
```

{35}------------------------------------------------

```
 template: "./src/taskpane/taskpane.html",
 chunks: ["polyfill", "taskpane"],
 }),
 new CopyWebpackPlugin({
 patterns: [
 {
 from: "./src/taskpane/taskpane.css",
 to: "taskpane.css",
 },
 {
 from: "./src/settings/dialog.css",
 to: "dialog.css",
 },
 {
 from: "assets/*",
 to: "assets/[name][ext][query]",
 },
 {
 from: "manifest*.json", // The file extension is "xml" if the
add-in only manifest is being used.
 to: "[name]." + buildType + "[ext]",
 transform(content) {
 if (dev) {
 return content;
 } else {
 return content.toString().replace(new RegExp(urlDev, "g"),
urlProd);
 }
 },
 },
 ],
 }),
 new HtmlWebpackPlugin({
 filename: "commands.html",
 template: "./src/commands/commands.html",
 chunks: ["polyfill", "commands"],
 }),
 new HtmlWebpackPlugin({
 filename: "dialog.html",
 template: "./src/settings/dialog.html",
 chunks: ["polyfill", "dialog"]
 })
],
```
### **Fetch data from GitHub**

The **dialog.js** file you just created specifies that the add-in should load gists when the **change** event fires for the GitHub username field. To retrieve the user's gists from GitHub, you'll use the [GitHub Gists API](https://developer.github.com/v3/gists/) .

1. Within the **./src** folder, create a new subfolder named **helpers**.

{36}------------------------------------------------

- 2. In the **./src/helpers** folder, create a file named **gist-api.js**.
- 3. In **gist-api.js**, add the following code to retrieve the user's gists from GitHub and build the list of gists.

```
JavaScript
function getUserGists(user, callback) {
 const requestUrl = 'https://api.github.com/users/' + user + '/gists';
 $.ajax({
 url: requestUrl,
 dataType: 'json'
 }).done(function(gists) {
 callback(gists);
 }).fail(function(error) {
 callback(null, error);
 });
}
function buildGistList(parent, gists, clickFunc) {
 gists.forEach(function(gist) {
 const listItem = $('<div/>')
 .appendTo(parent);
 const radioItem = $('<input>')
 .addClass('ms-ListItem')
 .addClass('is-selectable')
 .attr('type', 'radio')
 .attr('name', 'gists')
 .attr('tabindex', 0)
 .val(gist.id)
 .appendTo(listItem);
 const descPrimary = $('<span/>')
 .addClass('ms-ListItem-primaryText')
 .text(gist.description)
 .appendTo(listItem);
 const descSecondary = $('<span/>')
 .addClass('ms-ListItem-secondaryText')
 .text(' - ' + buildFileList(gist.files))
 .appendTo(listItem);
 const updated = new Date(gist.updated_at);
 const descTertiary = $('<span/>')
 .addClass('ms-ListItem-tertiaryText')
 .text(' - Last updated ' + updated.toLocaleString())
 .appendTo(listItem);
 listItem.on('click', clickFunc);
```

{37}------------------------------------------------

```
 }); 
}
function buildFileList(files) {
 let fileList = '';
 for (let file in files) {
 if (files.hasOwnProperty(file)) {
 if (fileList.length > 0) {
 fileList = fileList + ', ';
 }
 fileList = fileList + files[file].filename + ' (' +
files[file].language + ')';
 }
 }
 return fileList;
}
```
- 4. Save your changes.
- 5. Run the following command to rebuild the project.

command line npm run build

# **Implement a UI-less button**

This add-in's **Insert default gist** button is a UI-less button that invokes a JavaScript function, rather than opens a task pane like many add-in buttons do. When the user selects the **Insert default gist** button, the corresponding JavaScript function checks whether the add-in has been configured.

- If the add-in has already been configured, the function loads the content of the gist that the user has selected as the default and inserts it into the body of the message.
- If the add-in hasn't yet been configured, then the settings dialog prompts the user to provide the required information.

### **Update the function file (HTML)**

{38}------------------------------------------------

A function that's invoked by a UI-less button must be defined in the file that's specified by the **<FunctionFile>** element in the manifest for the corresponding form factor. This add-in's manifest specifies https://localhost:3000/commands.html as the function file.

- 1. Open the **./src/commands/commands.html** and replace the entire contents with the following markup.

```
HTML
<!DOCTYPE html>
<html>
<head>
 <meta charset="UTF-8" />
 <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
 <!-- Office JavaScript API -->
 <script type="text/javascript"
src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js">
</script>
 <script type="text/javascript"
src="../../node_modules/jquery/dist/jquery.js"></script>
 <script type="text/javascript"
src="../../node_modules/showdown/dist/showdown.min.js"></script>
 <script type="text/javascript"
src="../../node_modules/urijs/src/URI.min.js"></script>
 <script type="text/javascript" src="../helpers/addin-config.js">
</script>
 <script type="text/javascript" src="../helpers/gist-api.js">
</script>
</head>
<body>
 <!-- NOTE: The body is empty on purpose. Since functions in
commands.js are
 invoked via a button, there is no UI to render. -->
</body>
</html>
```
You may have noticed that the HTML file references a JavaScript file, **addinconfig.js**, that doesn't yet exist. This file will be created in the Create a file to manage configuration settings section later in this tutorial.

- 2. Save your changes.
### **Update the function file (JavaScript)**

{39}------------------------------------------------

- 1. Open the file **./src/commands/commands.js** and replace the entire contents with the following code. Note that if the **insertDefaultGist** function determines the addin hasn't yet been configured, it adds the ?warn=1 parameter to the dialog URL. Doing so makes the settings dialog render the message bar that's defined in **./src/settings/dialog.html**, to tell the user why they're seeing the dialog.

```
JavaScript
let config;
let btnEvent;
// The onReady function must be run each time a new page is loaded.
Office.onReady();
function showError(error) {

Office.context.mailbox.item.notificationMessages.replaceAsync('github-
error', {
 type: 'errorMessage',
 message: error
 });
}
let settingsDialog;
function insertDefaultGist(event) {
 config = getConfig();
 // Check if the add-in has been configured.
 if (config && config.defaultGistId) {
 // Get the default gist content and insert.
 try {
 getGist(config.defaultGistId, function(gist, error) {
 if (gist) {
 buildBodyContent(gist, function (content, error) {
 if (content) {
 Office.context.mailbox.item.body.setSelectedDataAsync(
 content,
 { coercionType: Office.CoercionType.Html },
 function (result) {
 event.completed();
 }
 );
 } else {
 showError(error);
 event.completed();
 }
 });
 } else {
 showError(error);
 event.completed();
 }
 });
```

{40}------------------------------------------------

```
 } catch (err) {
 showError(err);
 event.completed();
 }
 } else {
 // Save the event object so we can finish up later.
 btnEvent = event;
 // Not configured yet, display settings dialog with
 // warn=1 to display warning.
 const url = new URI('dialog.html?
warn=1').absoluteTo(window.location).toString();
 const dialogOptions = { width: 20, height: 40, displayInIframe: 
true };
 Office.context.ui.displayDialogAsync(url, dialogOptions, 
function(result) {
 settingsDialog = result.value;

settingsDialog.addEventHandler(Office.EventType.DialogMessageReceived,
receiveMessage);

settingsDialog.addEventHandler(Office.EventType.DialogEventReceived,
dialogClosed);
 });
 }
}
// Register the function.
Office.actions.associate("insertDefaultGist", insertDefaultGist);
function receiveMessage(message) {
 config = JSON.parse(message.message);
 setConfig(config, function(result) {
 settingsDialog.close();
 settingsDialog = null;
 btnEvent.completed();
 btnEvent = null;
 });
}
function dialogClosed(message) {
 settingsDialog = null;
 btnEvent.completed();
 btnEvent = null;
}
```
- 2. Save your changes.
### **Create a file to manage configuration settings**

{41}------------------------------------------------

- 1. In the **./src/helpers** folder, create a file named **addin-config.js** and add the following code. This code uses the [RoamingSettings object](https://learn.microsoft.com/en-us/javascript/api/outlook/office.roamingsettings) to get and set configuration values.

```
JavaScript
function getConfig() {
 const config = {};
 config.gitHubUserName =
Office.context.roamingSettings.get('gitHubUserName');
 config.defaultGistId =
Office.context.roamingSettings.get('defaultGistId');
 return config;
}
function setConfig(config, callback) {
 Office.context.roamingSettings.set('gitHubUserName',
config.gitHubUserName);
 Office.context.roamingSettings.set('defaultGistId',
config.defaultGistId);
 Office.context.roamingSettings.saveAsync(callback);
}
```
- 2. Save your changes.
### **Create new functions to process gists**

- 1. Open the **./src/helpers/gist-api.js** file and add the following functions. Note the following:
	- If the gist contains HTML, the add-in inserts the HTML as is into the body of the message.
	- If the gist contains Markdown, the add-in uses the [Showdown](https://github.com/showdownjs/showdown) library to convert the Markdown to HTML, then inserts the resulting HTML into the body of the message.
	- If the gist contains anything other than HTML or Markdown, the add-in inserts it into the body of the message as a code snippet.

#### JavaScript

```
function getGist(gistId, callback) {
 const requestUrl = 'https://api.github.com/gists/' + gistId;
```

{42}------------------------------------------------

```
 $.ajax({
 url: requestUrl,
 dataType: 'json'
 }).done(function(gist) {
 callback(gist);
 }).fail(function(error) {
 callback(null, error);
 });
}
function buildBodyContent(gist, callback) {
 // Find the first non-truncated file in the gist
 // and use it.
 for (let filename in gist.files) {
 if (gist.files.hasOwnProperty(filename)) {
 const file = gist.files[filename];
 if (!file.truncated) {
 // We have a winner.
 switch (file.language) {
 case 'HTML':
 // Insert as is.
 callback(file.content);
 break;
 case 'Markdown':
 // Convert Markdown to HTML.
 const converter = new showdown.Converter();
 const html = converter.makeHtml(file.content);
 callback(html);
 break;
 default:
 // Insert contents as a <code> block.
 let codeBlock = '<pre><code>';
 codeBlock = codeBlock + file.content;
 codeBlock = codeBlock + '</code></pre>';
 callback(codeBlock);
 }
 return;
 }
 }
 }
 callback(null, 'No suitable file found in the gist');
}
```
- 2. Save your changes.
### **Test the Insert default gist button**

- 1. If the local web server isn't already running, run npm start from the command prompt.
- 2. Open Outlook and compose a new message.

{43}------------------------------------------------

- 3. In the compose message window, select the **Insert default gist** button. You should see a dialog where you can configure the add-in, starting with the prompt to set your GitHub username.

|     | Insert default gist<br>Insert qist<br>Logo                                                                                                                                                                                                    |
|-----|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| oke | Git the gist - https://localhost:3000/src/settings/dialog.html?warn=1<br>1<br>Oops! It looks like you haven't configured Git the gist yet.<br>Please configure your GitHub username and select a default<br>gist, then try that action again! |
|     | Settings<br>GitHub Username  Please enter your GitHub<br>Done                                                                                                                                                                                 |

- 4. In the settings dialog, enter your GitHub username and then either **Tab** or click elsewhere in the dialog to invoke the **change** event, which should load your list of public gists. Select a gist to be the default, and select **Done**.

{44}------------------------------------------------

- 5. Select the **Insert default gist** button again. This time, you should see the contents of the gist inserted into the body of the email.
7 **Note**

Outlook on Windows: To pick up the latest settings, you may need to close and reopen the compose message window.

# **Implement a task pane**

This add-in's **Insert gist** button opens a task pane and displays the user's gists. The user can then select one of the gists to insert into the body of the message. If the user hasn't yet configured the add-in, they'll be prompted to do so.

## **Specify the HTML for the task pane**

{45}------------------------------------------------

- 1. In the project that you've created, the task pane HTML is specified in the file **./src/taskpane/taskpane.html**. Open that file and replace the entire contents with the following markup.

```
HTML
<!DOCTYPE html>
<html>
<head>
 <meta charset="UTF-8" />
 <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
 <meta name="viewport" content="width=device-width, initial-
scale=1">
 <title>Contoso Task Pane Add-in</title>
 <!-- Office JavaScript API -->
 <script type="text/javascript"
src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js">
</script>
 <!-- For more information on Fluent UI, visit
https://developer.microsoft.com/fluentui. -->
 <link rel="stylesheet" href="https://res-
1.cdn.office.net/files/fabric-cdn-prod_20230815.002/office-ui-fabric-
core/11.0.0/css/fabric.min.css"/>
 <!-- Template styles -->
 <link href="taskpane.css" rel="stylesheet" type="text/css" />
</head>
<body class="ms-font-l ms-landing-page">
 <main class="ms-landing-page__main">
 <section class="ms-landing-page__content ms-font-m ms-fontColor-
neutralPrimary">
 <div id="not-configured" style="display: none;">
 <div class="centered ms-font-xxl ms-u-textAlignCenter">Welcome!
</div>
 <div class="ms-font-xl" id="settings-prompt">Please choose the 
<strong>Settings</strong> icon at the bottom of this window to
configure this add-in.</div>
 </div>
 <div id="gist-list-container" style="display: none;">
 <form>
 <div id="gist-list">
 </div>
 </form>
 </div>
 <div id="error-display" style="display: none;" class="ms-u-
borderBase ms-fontColor-error ms-font-m ms-bgColor-error ms-
borderColor-error">
 </div>
 </section>
```

{46}------------------------------------------------

```
 <button class="ms-Button ms-Button--primary" id="insert-button"
tabindex=0 disabled>
 <span class="ms-Button-label">Insert</span>
 </button>
 </main>
 <footer class="ms-landing-page__footer ms-bgColor-themePrimary">
 <div class="ms-landing-page__footer--left">
 <img src="../../assets/logo-filled.png" />
 <h1 class="ms-font-xl ms-fontWeight-semilight ms-fontColor-
white">Git the gist</h1>
 </div>
 <div id="settings-icon" class="ms-landing-page__footer--right"
aria-label="Settings" tabindex=0>
 <i class="ms-Icon enlarge ms-Icon--Settings ms-fontColor-white">
</i>
 </div>
 </footer>
 <script type="text/javascript"
src="../../node_modules/jquery/dist/jquery.js"></script>
 <script type="text/javascript"
src="../../node_modules/showdown/dist/showdown.min.js"></script>
 <script type="text/javascript"
src="../../node_modules/urijs/src/URI.min.js"></script>
 <script type="text/javascript" src="../helpers/addin-config.js">
</script>
 <script type="text/javascript" src="../helpers/gist-api.js"></script>
 <script type="text/javascript" src="taskpane.js"></script>
</body>
</html>
```
- 2. Save your changes.
### **Specify the CSS for the task pane**

- 1. In the project that you've created, the task pane CSS is specified in the file **./src/taskpane/taskpane.css**. Open that file and replace the entire contents with the following code.

```
css
/* Copyright (c) Microsoft. All rights reserved. Licensed under the MIT
license. See full license in root of repo. */
html, body {
 width: 100%;
 height: 100%;
 margin: 0;
 padding: 0;
 overflow: auto; }
body {
```

{47}------------------------------------------------

```
 position: relative;
 font-size: 16px; }
main {
 height: 100%;
 overflow-y: auto; }
footer {
 width: 100%;
 position: relative;
 bottom: 0;
 margin-top: 10px;}
p, h1, h2, h3, h4, h5, h6 {
 margin: 0;
 padding: 0; }
ul {
 padding: 0; }
#settings-prompt {
 margin: 10px 0;
}
#error-display {
 padding: 10px;
}
#insert-button {
 margin: 0 10px;
}
.clearfix {
 display: block;
 clear: both;
 height: 0; }
.pointerCursor {
 cursor: pointer; }
.invisible {
 visibility: hidden; }
.undisplayed {
 display: none; }
.ms-Icon.enlarge {
 position: relative;
 font-size: 20px;
 top: 4px; }
.ms-ListItem-secondaryText,
.ms-ListItem-tertiaryText {
 padding-left: 15px;
}
```

{48}------------------------------------------------

```
.ms-landing-page {
 display: -webkit-flex;
 display: flex;
 -webkit-flex-direction: column;
 flex-direction: column;
 -webkit-flex-wrap: nowrap;
 flex-wrap: nowrap;
 height: 100%; }
.ms-landing-page__main {
 display: -webkit-flex;
 display: flex;
 -webkit-flex-direction: column;
 flex-direction: column;
 -webkit-flex-wrap: nowrap;
 flex-wrap: nowrap;
 -webkit-flex: 1 1 0;
 flex: 1 1 0;
 height: 100%; }
.ms-landing-page__content {
 display: -webkit-flex;
 display: flex;
 -webkit-flex-direction: column;
 flex-direction: column;
 -webkit-flex-wrap: nowrap;
 flex-wrap: nowrap;
 height: 100%;
 -webkit-flex: 1 1 0;
 flex: 1 1 0;
 padding: 20px; }
.ms-landing-page__content h2 {
 margin-bottom: 20px; }
.ms-landing-page__footer {
 display: -webkit-inline-flex;
 display: inline-flex;
 -webkit-justify-content: center;
 justify-content: center;
 -webkit-align-items: center;
 align-items: center; }
.ms-landing-page__footer--left {
 transition: background ease 0.1s, color ease 0.1s;
 display: -webkit-inline-flex;
 display: inline-flex;
 -webkit-justify-content: flex-start;
 justify-content: flex-start;
 -webkit-align-items: center;
 align-items: center;
 -webkit-flex: 1 0 0px;
 flex: 1 0 0px;
 padding: 20px; }
```

{49}------------------------------------------------

```
.ms-landing-page__footer--left:active {
 cursor: default; }
.ms-landing-page__footer--left--disabled {
 opacity: 0.6;
 pointer-events: none;
 cursor: not-allowed; }
.ms-landing-page__footer--left--disabled:active, .ms-landing-
page__footer--left--disabled:hover {
 background: transparent; }
.ms-landing-page__footer--left img {
 width: 40px;
 height: 40px; }
.ms-landing-page__footer--left h1 {
 -webkit-flex: 1 0 0px;
 flex: 1 0 0px;
 margin-left: 15px;
 text-align: left;
 width: auto;
 max-width: auto;
 overflow: hidden;
 white-space: nowrap;
 text-overflow: ellipsis; }
.ms-landing-page__footer--right {
 transition: background ease 0.1s, color ease 0.1s;
 padding: 29px 20px; }
.ms-landing-page__footer--right:active, .ms-landing-page__footer--
right:hover {
 background: #005ca4;
 cursor: pointer; }
.ms-landing-page__footer--right:active {
 background: #005ca4; }
.ms-landing-page__footer--right--disabled {
 opacity: 0.6;
 pointer-events: none;
 cursor: not-allowed; }
.ms-landing-page__footer--right--disabled:active, .ms-landing-
page__footer--right--disabled:hover {
 background: transparent; }
```
- 2. Save your changes.
### **Specify the JavaScript for the task pane**

{50}------------------------------------------------

- 1. In the project that you've created, the task pane JavaScript is specified in the file **./src/taskpane/taskpane.js**. Open that file and replace the entire contents with the following code.

```
JavaScript
(function() {
 'use strict';
 let config;
 let settingsDialog;
 Office.onReady(function() {
 $(document).ready(function() {
 config = getConfig();
 // Check if add-in is configured.
 if (config && config.gitHubUserName) {
 // If configured, load the gist list.
 loadGists(config.gitHubUserName);
 } else {
 // Not configured yet.
 $('#not-configured').show();
 }
 // When insert button is selected, build the content
 // and insert into the body.
 $('#insert-button').on('click', function() {
 const gistId = $('.ms-ListItem.is-selected').val();
 getGist(gistId, function(gist, error) {
 if (gist) {
 buildBodyContent(gist, function (content, error) {
 if (content) {
 Office.context.mailbox.item.body.setSelectedDataAsync(
 content,
 { coercionType: Office.CoercionType.Html },
 function (result) {
 if (result.status ===
Office.AsyncResultStatus.Failed) {
 showError("Could not insert gist: " +
result.error.message);
 }
 }
 );
 } else {
 showError('Could not create insertable content: ' +
error);
 }
 });
 } else {
 showError('Could not retrieve gist: ' + error);
 }
 });
```

{51}------------------------------------------------

```
 });
 // When the settings icon is selected, open the settings dialog.
 $('#settings-icon').on('click', function() {
 // Display settings dialog.
 let url = new
URI('dialog.html').absoluteTo(window.location).toString();
 if (config) {
 // If the add-in has already been configured, pass the
existing values
 // to the dialog.
 url = url + '?gitHubUserName=' + config.gitHubUserName + 
'&defaultGistId=' + config.defaultGistId;
 }
 const dialogOptions = { width: 20, height: 40, displayInIframe:
true };
 Office.context.ui.displayDialogAsync(url, dialogOptions, 
function(result) {
 settingsDialog = result.value;

settingsDialog.addEventHandler(Office.EventType.DialogMessageReceived,
receiveMessage);

settingsDialog.addEventHandler(Office.EventType.DialogEventReceived,
dialogClosed);
 });
 })
 });
 });
 function loadGists(user) {
 $('#error-display').hide();
 $('#not-configured').hide();
 $('#gist-list-container').show();
 getUserGists(user, function(gists, error) {
 if (error) {
 } else {
 $('#gist-list').empty();
 buildGistList($('#gist-list'), gists, onGistSelected);
 }
 });
 }
 function onGistSelected() {
 $('#insert-button').removeAttr('disabled');
 $('.ms-ListItem').removeClass('is-selected').removeAttr('checked');
 $(this).children('.ms-ListItem').addClass('is-
selected').attr('checked', 'checked');
 }
 function showError(error) {
```

{52}------------------------------------------------

```
 $('#not-configured').hide();
 $('#gist-list-container').hide();
 $('#error-display').text(error);
 $('#error-display').show();
 }
 function receiveMessage(message) {
 config = JSON.parse(message.message);
 setConfig(config, function(result) {
 settingsDialog.close();
 settingsDialog = null;
 loadGists(config.gitHubUserName);
 });
 }
 function dialogClosed(message) {
 settingsDialog = null;
 }
})();
```
- 2. Save your changes.
### **Test the Insert gist button**

- 1. If the local web server isn't already running, run npm start from the command prompt.
- 2. Open Outlook and compose a new message.
- 3. In the compose message window, select the **Insert gist** button. You should see a task pane open to the right of the compose form.
- 4. In the task pane, select the **Hello World Html** gist and select **Insert** to insert that gist into the body of the message.

# **Next steps**

{53}------------------------------------------------

In this tutorial, you've created an Outlook add-in that can be used in message compose mode to insert content into the body of a message. To learn more about developing Outlook add-ins, continue to the following article.

**Outlook add-in APIs**

# **Code samples**

- [Completed Outlook add-in tutorial](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/tutorials/outlook-tutorial) : The result of completing this tutorial.
# **See also**

- Office Add-in manifests
- Outlook add-in design guidelines
- Debug function commands in Outlook add-ins

{54}------------------------------------------------

# **Develop Outlook add-ins for the new Outlook on Windows**

08/05/2025

The new Outlook on Windows desktop client unifies the Windows and web codebases to create a more consistent Outlook experience for users and administrators. Its modern and simplified interface has added capabilities and aims to improve productivity, organization, and collaboration for users. More importantly, the new Outlook on Windows supports Outlook web add-ins, so that you can continue to extend Outlook's functionality.

# **Impact on VSTO and COM add-ins**

The new Outlook on Windows aims to unify the extensibility experience across all Outlook platforms. To provide a more reliable and stable add-in experience, VSTO and COM add-ins aren't supported in the new Outlook on Windows. To ensure your add-in continues to work in the new Outlook on Windows, you must migrate your VSTO or COM add-in to an Outlook web add-in. Migrating to an Outlook web add-in not only enables compatibility with the new Outlook on Windows, it also makes your solution available to users on other platforms, such as Outlook on Mac, on mobile, or on the web.

To help get you started on the migration process, review the following guidance.

- The differences in features and scenarios supported by VSTO and COM add-ins and Outlook web add-ins are being addressed. To determine whether your add-in scenario is fully supported in an Outlook web add-in, see Supported scenarios in Outlook web add-ins.
- For guidance on how to transition your VSTO add-in to an Outlook web add-in, see VSTO add-in developer's guide and Tutorial: Share code between both a VSTO Add-in and an Office Add-in with a shared code library.
- If you're new to Outlook web add-ins, try out the Outlook quick start to build your first add-in.
- If you're an IT administrator and would like to learn more about how to transition to Outlook web add-ins in your organization, see [Transitioning add-ins from classic Outlook to](https://learn.microsoft.com/en-us/microsoft-365-apps/outlook/get-started/migrate-com-to-web-addins#transitioning-add-ins-from-classic-outlook-to-the-new-outlook-for-windows) [the new Outlook for Windows](https://learn.microsoft.com/en-us/microsoft-365-apps/outlook/get-started/migrate-com-to-web-addins#transitioning-add-ins-from-classic-outlook-to-the-new-outlook-for-windows). By default, when a user switches to new Outlook on Windows for the first time, they can choose to import their Outlook settings and install existing add-ins from classic Outlook on Windows. Because COM add-ins aren't supported in the new client, web add-in counterparts are installed instead. For more information, see [Install web add-in counterparts of existing COM add-ins in new Outlook for Windows.](https://learn.microsoft.com/en-us/microsoft-365-apps/outlook/get-started/install-web-add-ins)

{55}------------------------------------------------

### **Supported scenarios in Outlook web add-ins**

The development of the Outlook JavaScript API used by Outlook web add-ins is focused on closing the gap on scenarios that are only supported by VSTO and COM add-in solutions. This way, users who transition to the Outlook web add-in can continue to have a seamless experience.

The following table identifies key Outlook scenarios and their support status in a web add-in. This table will be updated as additional scenarios are supported. Periodically check this section as you plan to migrate your VSTO or COM add-in.

#### **Tip**

As we continue to update the table of supported scenarios, if you want to view the recent changes made, select **Edit This Document** (**pencil icon**) from the top right corner of the article, then select **History**.

To learn more about Outlook add-in features that are in preview, see **[Outlook add-in API](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/outlook-requirement-set-preview?view=outlook-js-preview&preserve-view=true) [preview requirement set](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/outlook-requirement-set-preview?view=outlook-js-preview&preserve-view=true)**.

| Scenario                                 | Description                                                                                                                          | Support<br>status in<br>Outlook<br>web add<br>ins | Related features and samples                                                                                                                                                                        |
|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Spam email<br>reporting and<br>education | Enable users to<br>report<br>unsolicited and<br>potentially<br>unsafe<br>messages and<br>learn how to<br>identify these<br>messages. | Supported.                                        | Implement an integrated spam-reporting add-in<br>ReportPhishingCommandSurface extension point<br>Office.context.mailbox.item.getAsFileAsync                                                         |
| Online<br>meetings                       | Enable users to<br>create and join<br>online<br>meetings.                                                                            | Supported.                                        | Create an Outlook add-in for an online-meeting<br>provider<br>Implement shared folders and shared mailbox<br>scenarios in an Outlook add-in<br>Office.context.mailbox.item.getSharedPropertiesAsync |

{56}------------------------------------------------

| Scenario                                                                    | Description                                                                                                                                                                                             | Support<br>status in<br>Outlook<br>web add<br>ins | Related features and samples                                                                                                                                                                                                                                                                                                                                                                                    |  |  |  |  |
|-----------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|--|--|
|                                                                             |                                                                                                                                                                                                         |                                                   | Office.SharedProperties                                                                                                                                                                                                                                                                                                                                                                                         |  |  |  |  |
| Meeting<br>enhancements                                                     | Provide<br>additional<br>services for<br>users when they<br>schedule<br>meetings, such<br>as location<br>selection,<br>catering<br>services, and<br>room lighting<br>and<br>temperature<br>adjustments. | Supported.                                        | Activate add-ins with events<br>Handle OnMessageSend and OnAppointmentSend<br>events in your Outlook add-in with Smart Alerts<br>Office.context.mailbox.item.enhancedLocation                                                                                                                                                                                                                                   |  |  |  |  |
| Online<br>signatures                                                        | Automatically<br>add themed<br>signatures to<br>messages and<br>appointments.                                                                                                                           | Supported.                                        | Automatically update your signature when switching<br>between Exchange accounts<br>Implement event-based activation in Outlook mobile<br>add-ins<br>Use Outlook event-based activation to set the<br>signature<br>Office.context.mailbox.item.loadCustomPropertiesAsync<br>Office.context.mailbox.item.body.setSignatureAsync                                                                                   |  |  |  |  |
| Customer<br>relationship<br>management<br>(CRM) and<br>tracking<br>services | Enable users to<br>send and<br>retrieve<br>information<br>from their CRM<br>system to track<br>communications<br>with existing<br>and potential<br>customers.                                           | Supported.                                        | Activate your Outlook add-in without the Reading Pane<br>enabled or a message selected<br>Drag and drop messages and attachments into the task<br>pane of an Outlook add-in<br>Log appointment notes to an external application in<br>Outlook mobile add-ins<br>Office.context.mailbox.item.body.getAsync<br>Office.context.mailbox.item.body.setAsync<br>Office.context.mailbox.item.loadCustomPropertiesAsync |  |  |  |  |
| Content reuse                                                               | Enable users to<br>transfer and<br>retrieve text and<br>other content<br>types from<br>partner systems.                                                                                                 | Supported.                                        | Prepend or append content to a message or<br>appointment body on send<br>Office.context.mailbox.item.body.appendOnSendAsync<br>Office.context.mailbox.item.body.prependAsync<br>Office.context.mailbox.item.body.prependOnSendAsync                                                                                                                                                                             |  |  |  |  |

{57}------------------------------------------------

| Scenario                    | Description                                                                                        | Support<br>status in<br>Outlook<br>web add<br>ins                                                                                                          | Related features and samples                                                                                                                                                                                                                                                                                                                                                                                                                   |
|-----------------------------|----------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Mail item<br>transformation | Enable users to<br>transform mail<br>items into other<br>formats.                                  | Supported.                                                                                                                                                 | Drag and drop messages and attachments into the task<br>pane of an Outlook add-in<br>getAsFileAsync method                                                                                                                                                                                                                                                                                                                                     |
| Project<br>management       | Enable users to<br>create and track<br>project work<br>items from<br>partner systems.              | Supported.                                                                                                                                                 | Activate your Outlook add-in on multiple messages<br>Activate your Outlook add-in without the Reading Pane<br>enabled or a message selected<br>Verify the color categories applied to a new message or<br>appointment                                                                                                                                                                                                                          |
| Attachment<br>management    | Enable users to<br>import or<br>export<br>attachments<br>from partner<br>locations.                | Supported.                                                                                                                                                 | Activate your Outlook add-in on multiple messages<br>Activate your Outlook add-in without the Reading Pane<br>enabled or a message selected<br>Activate add-ins with events<br>Drag and drop messages and attachments into the task<br>pane of an Outlook add-in                                                                                                                                                                               |
| Message<br>encryption       | Enable users to<br>encrypt and<br>decrypt<br>messages.                                             | Partially<br>supported.<br>Essential<br>features<br>are yet to<br>be<br>addressed<br>to create a<br>similar<br>experience<br>to VSTO or<br>COM add<br>ins. | Office.context.mailbox.item.body.getAsync<br>Office.context.mailbox.item.body.setAsync<br>Office.context.mailbox.item.display (preview)<br>Office.context.mailbox.item.display.body.setAsync<br>(preview)<br>Office.context.mailbox.item.display.subject.setAsync<br>(preview)                                                                                                                                                                 |
| Data loss<br>prevention     | Prevent users<br>from forwarding<br>mail items that<br>contain highly<br>sensitive<br>information. | Supported.                                                                                                                                                 | Automatically check for an attachment before a<br>message is sent<br>Handle OnMessageSend and OnAppointmentSend<br>events in your Outlook add-in with Smart Alerts<br>Manage the sensitivity label of your message or<br>appointment in compose mode<br>Verify the sensitivity label of a message<br>Office.SensitivityLabel<br>Office.SensitivityLabelsCatalog<br>Office.SensitivityLabelDetails<br>Office.context.mailbox.item.body.getAsync |

{58}------------------------------------------------

| Scenario                    | Description                                                                                          | Support<br>status in<br>Outlook<br>web add<br>ins                                                                                                          | Related features and samples                                                                                                                                                                                                                                                                                                                                                                                                 |
|-----------------------------|------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                             |                                                                                                      |                                                                                                                                                            | Office.context.mailbox.item.body.setAsync<br>Office.context.mailbox.item.closeAsync<br>Office.context.mailbox.item.inReplyTo<br>Office.context.mailbox.item.getConversationIndexAsync<br>Office.context.mailbox.item.getItemClassAsync                                                                                                                                                                                       |
| Mail item<br>classification | Enable users to<br>identify and<br>classify<br>messages that<br>contain<br>sensitive<br>information. | Partially<br>supported.<br>Essential<br>features<br>are yet to<br>be<br>addressed<br>to create a<br>similar<br>experience<br>to VSTO or<br>COM add<br>ins. | Automatically check for an attachment before a<br>message is sent<br>Handle OnMessageSend and OnAppointmentSend<br>events in your Outlook add-in with Smart Alerts<br>Manage the sensitivity label of your message or<br>appointment in compose mode<br>Manage the sensitivity level of an appointment<br>Office.Sensitivity<br>Office.SensitivityLabel<br>Office.SensitivityLabelsCatalog<br>Office.SensitivityLabelDetails |
| Data sync<br>service        | Enable<br>bidirectional<br>synchronization<br>of mail items<br>with partner<br>systems.              | Partially<br>supported.<br>Essential<br>features<br>are yet to<br>be<br>addressed<br>to create a<br>similar<br>experience<br>to VSTO or<br>COM add<br>ins. | Use Microsoft Graph to manage personal contacts in<br>Outlook                                                                                                                                                                                                                                                                                                                                                                |
| Proofing mail<br>items      | Provide users<br>with real-time<br>proofreading<br>assistance as<br>they compose<br>messages.        | Not<br>currently<br>supported.                                                                                                                             | Not available                                                                                                                                                                                                                                                                                                                                                                                                                |

There are various possibilities for extending the Outlook functionality through add-ins. If your VSTO or COM add-in solution doesn't quite fit any of the scenarios in the table, [complete the](https://aka.ms/DevNewOutlook) [survey to share your scenario](https://aka.ms/DevNewOutlook) .

{59}------------------------------------------------

# **Support for classic Outlook on Windows**

Classic Outlook on Windows with a Microsoft 365 subscription or a retail perpetual version of Office 2016 or later will continue to support the development of new and existing Outlook web add-ins. Additionally, it will continue to receive releases of the latest Outlook add-in features.

## **Test your add-in in the new Outlook on Windows**

Test your Outlook web add-in in the new Outlook on Windows today! To switch to the new Outlook on Windows, you must meet the following requirements.

- Have a Microsoft 365 work or school account connected to Exchange Online. The new client doesn't currently support on-premises, hybrid, or sovereign Exchange accounts.
7 **Note**

While you can add non-Microsoft mail accounts, such as Gmail, to the new Outlook on Windows, you can only use Outlook add-ins with a Microsoft account. For more information, see the "Supported accounts" section of the **Outlook add-ins overview**.

- Have a minimum OS installation of Windows 10 Version 1809 (Build 17763).
To help you install and set up the Outlook desktop client, see [Getting started with the new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) [Outlook for Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) .

For guidance on how to sideload your add-in, see Sideload Outlook add-ins for testing.

#### **Tip**

In the new Outlook on Windows, you must keep the main client window open to run addins (the window can be active or inactive). If the main window is minimized, the add-in will pause or stop working.

# **Debug your add-in**

To debug an add-in installed in the new Outlook on Windows desktop client, perform the following:

- 1. Close the new Outlook on Windows client if you already have it open.
- 2. Then, in a command prompt, run the following command to open the new Outlook on Windows client and an instance of the Microsoft Edge DevTools.

{60}------------------------------------------------

olk.exe --devtools

#### **Tip**

After running the command, the DevTools window stays open, so that you can debug an add-in's task pane as you open and close it. If you close the DevTools window, you must close your Outlook client first before running olk.exe --devtools again.

- 3. Sideload the add-in to Outlook on the web.
- 4. Use Microsoft Edge DevTools to debug your add-in.

# **Add-in availability when offline**

When you turn on the [offline setting](https://support.microsoft.com/office/2460e4a8-16c7-47fc-b204-b1549275aac9) in the new Outlook on Windows, you can continue to access your emails and calendar if you lose internet connection. While some functionalities remain available, Outlook add-ins and the Microsoft 365 and Copilot store aren't available when offline. The following table describes the behavior of certain types of add-ins when your machine is offline or has an intermittent connection.

| ノ | Expand table |  |
|---|--------------|--|
|---|--------------|--|

| Scenario                                                 | Task pane and<br>function<br>command add-ins                         | Event-based add-ins                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|----------------------------------------------------------|----------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| No internet<br>connection<br>when Outlook is<br>launched | Installed add-ins<br>don't appear on the<br>ribbon or action<br>bar. | Because Outlook can't determine which add-ins are installed<br>while offline, event-based add-ins can't activate when the event<br>they handle occurs.                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                                          |                                                                      | In this scenario, to ensure that Smart Alerts add-ins still check<br>messages for compliance before they're sent, administrators can<br>configure the OnSendAddinsEnabled mailbox policy in Exchange<br>Online PowerShell. When configured, outgoing messages are<br>saved to the Drafts folder instead of the Outbox folder to prevent<br>them from being automatically sent when the machine<br>reconnects to the internet. For more information, see the "Offline<br>when Outlook launches" section of Handle OnMessageSend and<br>OnAppointmentSend events in your Outlook add-in with Smart<br>Alerts. |
| A connection is                                          | Installed add-ins                                                    | Outlook will be able to identify which event-based add-ins are                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| established after                                        | appear on the                                                        | installed. Installed add-ins can then activate when the event they                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

{61}------------------------------------------------

| Scenario                                                  | Task pane and<br>function<br>command add-ins                                                                                                                        | Event-based add-ins                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|-----------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| launching<br>Outlook while<br>offline                     | ribbon and action<br>bar.                                                                                                                                           | handle occurs.<br>When you select Send on a message that was blocked by the<br>OnSendAddinsEnabled mailbox policy, the Smart Alerts add-in<br>runs to check for compliance.                                                                                                                                                                                                                                                                                                                                                                         |
| Machine loses<br>connection<br>while Outlook is<br>in use | If you lose<br>connection while<br>using Outlook, your<br>installed add-ins<br>won't run. A dialog<br>or notification is<br>shown to notify<br>that you're offline. | If you lose connection when an event occurs, the behavior differs<br>depending on the type of event-based add-in.<br>Smart Alerts add-ins: When you select Send, the behavior<br>depends on whether the add-in implements the prompt<br>user, soft block, or block send mode option. To learn more,<br>see the "Intermittent connection" section of Handle<br>OnMessageSend and OnAppointmentSend events in your<br>Outlook add-in with Smart Alerts.<br>Other event-based add-ins: An add-in doesn't activate<br>when the event it handles occurs. |
| A connection is<br>reestablished                          | Installed add-ins<br>can run operations<br>again.                                                                                                                   | Installed add-ins resume handling events when they occur.<br>Messages that were moved to the Outbox folder are sent. When<br>messages in the Drafts folder are sent, Smart Alerts add-ins are<br>activated to ensure compliance.                                                                                                                                                                                                                                                                                                                    |

# **Development experience feedback**

As you test your Outlook web add-in in the new Outlook on Windows, share feedback on your experience with the developer community through [GitHub](https://github.com/OfficeDev/office-js/issues/new/choose) .

# **See also**

- [Overview of the new Outlook for Windows](https://learn.microsoft.com/en-us/microsoft-365-apps/outlook/overview-new-outlook-windows)
- [Blog post: Add-ins in the new Outlook for Windows](https://techcommunity.microsoft.com/t5/outlook-blog/add-ins-in-the-new-outlook-for-windows/ba-p/3954388)
- [Podcast: Update on development with new Outlook for Windows](https://www.m365devpodcast.com/update-on-development-with-new-outlook-for-windows/)
- Outlook add-ins overview
- Build your first Outlook add-in
- VSTO add-in developer's guide
- Tutorial: Share code between both a VSTO Add-in and an Office Add-in with a shared code library

{62}------------------------------------------------

# **Outlook add-in APIs**

Article • 01/07/2025

To use APIs in your Outlook add-in, you must specify the location of the Office.js library, the requirement set, the schema, and the permissions. You'll primarily use the Office JavaScript APIs exposed through the Mailbox object.

# **Office.js library**

To interact with the [Outlook add-in API](https://learn.microsoft.com/en-us/javascript/api/outlook), you need to use the JavaScript APIs in Office.js. The content delivery network (CDN) for the library is https://appsforoffice.microsoft.com/lib/1/hosted/Office.js . Add-ins submitted to AppSource must reference Office.js by this CDN; they can't use a local reference.

Reference the CDN in a <script> tag in the <head> tag of the web page (.html, .aspx, or .php file) that implements the UI of your add-in.

HTML

<script src="https://appsforoffice.microsoft.com/lib/1/hosted/Office.js" type="text/javascript"></script>

As we add new APIs, the URL to Office.js will stay the same. We will change the version in the URL only if we break an existing API behavior.

#### ) **Important**

When developing an add-in for any Office client application, reference the Office JavaScript API from inside the <head> section of the page. This ensures that the API is fully initialized prior to any body elements.

# **Requirement sets**

All Outlook APIs belong to the [Mailbox requirement set.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets) The Mailbox requirement set has versions, and each new set of APIs that are released belongs to a higher version of the set. Not all Outlook clients will support the newest set of APIs when they are released, but if an Outlook client declares support for a requirement set, it will support all the APIs in that requirement set.

{63}------------------------------------------------

To control which Outlook clients the add-in appears in, specify a minimum requirement set version in the manifest. For example, if you specify requirement set version 1.3, the add-in will not show up in any Outlook client that doesn't support a minimum version of 1.3.

Specifying a requirement set doesn't limit your add-in to the APIs in that version. If the add-in specifies requirement set v1.1 but is running in an Outlook client that supports v1.3, the add-in can still use v1.3 APIs. The requirement set only controls which Outlook clients the add-in appears in.

To check the availability of any APIs from a requirement set greater than the one specified in the manifest, you can use standard JavaScript:

```
JavaScript
if (item.somePropertyOrFunction) {
 item.somePropertyOrFunction... 
}
```
#### 7 **Note**

These checks are not needed for any APIs that are in the requirement set version specified in the manifest.

Specify the minimum requirement set that supports the critical set of APIs for your scenario, without which features of your add-in won't work. You specify the requirement set in the manifest. The markup varies depending on the manifest that you are using.

- **Add-in only manifest**: Use the **<Requirements>** element. Note that the **<Methods>** child element of **<Requirements>** isn't supported in Outlook add-ins, so you can't declare support for specific methods.
- **Unified manifest for Microsoft 365**: Use the "extensions.capabilities" property.

For more information, see Office Add-in manifests, and [Understanding Outlook API](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets) [requirement sets.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets)

# **Permissions**

Your add-in requires the appropriate permissions to use the APIs that it needs. In general, you should specify the minimum permission needed for your add-in.

{64}------------------------------------------------

There are four levels of permissions; **restricted**, **read item**, **read/write item**, and **read/write mailbox**. For more details. For more details, see Understanding Outlook addin permissions.

# **Mailbox object**

Outlook add-ins primarily use a subset of the API exposed through the [Mailbox](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox) object. To access the objects and members for use in Outlook add-ins, such as the [Item](https://learn.microsoft.com/en-us/javascript/api/outlook/office.item) object in compose or read mode, use the [mailbox](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-mailbox-member) property of the **Context** object to access the **Mailbox** object. The following code is an example.

JavaScript

```
// Access the Item object.
const item = Office.context.mailbox.item;
```
#### ) **Important**

When calling Office.context.mailbox.item on a message, note that the Reading Pane in the Outlook client must be turned on. For guidance on how to configure the Reading Pane, see **[Use and configure the Reading Pane to preview](https://support.microsoft.com/office/2fd687ed-7fc4-4ae3-8eab-9f9b8c6d53f0) [messages](https://support.microsoft.com/office/2fd687ed-7fc4-4ae3-8eab-9f9b8c6d53f0)** .

Additionally, Outlook add-ins can use the following objects.

- **Office** object: for initialization.
- **Context** object: for access to content and display language properties.

For information about using JavaScript in Outlook add-ins, see Outlook add-ins. To explore the Outlook JavaScript API, see the [Outlook API reference](https://learn.microsoft.com/en-us/javascript/api/outlook) page.

# **See also**

- Office Add-in manifests
- [Understanding Outlook API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets)
- Understanding Outlook add-in permissions
- Privacy and security for Office Add-ins

{65}------------------------------------------------

# **Outlook JavaScript API requirement sets**

08/27/2025

Outlook add-ins declare what API versions they require in their manifest. The markup varies depending on whether you're using the add-in only manifest format or the unified manifest for Microsoft 365.

```
Unified manifest for Microsoft 365
```
The API version is specified by the "extensions.requirements.capabilities" property. Set the "capabilities.name" property to "Mailbox" and the "capabilities.minVersion" property to the minimum API requirement set that supports the add-in's scenarios.

For example, the following manifest snippet indicates a minimum requirement set of 1.1.

```
JSON
"extensions": [
{
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox", "minVersion": "1.1"
 }
 ]
 },
 ...
}
```
All Outlook APIs belong to the Mailbox requirement set. The Mailbox requirement set has versions, and each new set of APIs that we release belongs to a higher version of the set. Not all Outlook clients support the newest set of APIs, but if an Outlook client declares support for a requirement set, generally it supports all of the APIs in that requirement set (check the documentation on a specific API or feature for any exceptions).

The minimum requirement set specified in the manifest determines which Outlook clients can load the add-in. If the Outlook client doesn't support at least the specified version, the add-in won't load. For example, if you specify the requirement set version to 1.3, the add-in only appears in Outlook clients that support version 1.3 or higher.

```
7 Note
```

{66}------------------------------------------------

Although Outlook on Android and on iOS support up to requirement set 1.5, your mobile add-in can now implement some APIs from later requirement sets. For more information on which APIs are supported in Outlook mobile, see **Outlook JavaScript APIs supported in Outlook on mobile devices**.

# **Use APIs from later requirement sets**

Setting a requirement set doesn't limit the available APIs that the add-in can use. For example, if the add-in specifies requirement set "Mailbox 1.1", but it's running in an Outlook client which supports "Mailbox 1.3", the add-in can use APIs from requirement set "Mailbox 1.3".

To use a newer API, developers can check if a particular application supports the requirement set by doing the following:

```
JavaScript
if (Office.context.requirements.isSetSupported('Mailbox', '1.3')) {
 // Perform actions.
}
else {
 // Provide alternate flow/logic.
}
```
Alternatively, developers can check for the existence of a newer API by using standard JavaScript technique.

```
JavaScript
if (item.somePropertyOrMethod !== undefined) {
 // Use item.somePropertyOrMethod.
 item.somePropertyOrMethod;
}
```
No such checks are necessary for any APIs which are present in the requirement set version specified in the manifest.

# **Choose a minimum requirement set**

Developers should use the earliest requirement set that contains the critical set of APIs for their scenario, without which the add-in won't work.

{67}------------------------------------------------

# **Requirement sets supported by Exchange servers and Outlook clients**

In this section, we note the range of requirement sets supported by Exchange server and Outlook clients. For details about server and client requirements for running Outlook add-ins, see [Outlook add-ins requirements.](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/add-in-requirements)

#### ) **Important**

If your target Exchange server and Outlook client support different requirement sets, then you may be restricted to the lower requirement set range. For example, if an add-in is running in Outlook 2019 on Windows (highest requirement set: 1.6) against Exchange 2016 (highest requirement set: 1.5), your add-in may be limited to requirement set 1.5.

### **Exchange server support**

The following table lists Exchange servers and the Mailbox requirement sets they support. For your add-in to show up in Outlook hosted in a particular Exchange environment, the version you specify as the minimum requirement set in your add-in's manifest must be supported by that environment.

| ノ | Expand table |  |
|---|--------------|--|

| Product                 | Major Exchange<br>version    | Supported API requirement sets                                                                             |
|-------------------------|------------------------------|------------------------------------------------------------------------------------------------------------|
| Exchange Online         | Latest build                 | 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 1.10, 1.11, 1.12, 1.13,<br>1.14, 1.15<br>1<br>IdentityAPI 1.3 |
| Exchange on<br>premises | Subscription Edition<br>(SE) | 1.1, 1.2, 1.3, 1.4, 1.5                                                                                    |
|                         | 2019                         | 1.1, 1.2, 1.3, 1.4, 1.5                                                                                    |
|                         | 2016                         | 1.1, 1.2, 1.3, 1.4, 1.5                                                                                    |

 To require the Identity API set 1.3 in your Outlook add-in code, check if it's supported by calling isSetSupported('IdentityAPI', '1.3') . Declaring it in the Outlook add-in's manifest isn't supported. You can also determine if the API is supported by checking that it's not undefined . For further details, see [Using APIs from later requirement sets.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#using-apis-from-later-requirement-sets) 1

{68}------------------------------------------------

Even if an add-in implements features from later requirement sets not supported in an Exchange on-premises environment, it can still be added to an Outlook client as long as the minimum requirement set specified in its manifest aligns with those supported by Exchange on-premises. However, an implemented feature only works if the Outlook client in which the add-in is installed supports the minimum requirement set needed by a feature. For example, a signature add-in that specifies 1.5 in its manifest will be installed and loaded in the Exchange 2019 on-premises environment. However, its call to [Body.setSignatureAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body#outlook-office-body-setsignatureasync-member(1)), which was introduced in requirement set 1.10, will only run if the Outlook client where the add-in is installed supports 1.10.

To determine the requirement sets supported by varying Outlook clients, see Outlook client support. We recommend supplementing this with the documentation on the specific feature for any exceptions.

### **Outlook client support**

Add-ins are supported in Outlook on the following platforms.

| Platform       | Major Office/Outlook version                                 | Supported API requirement sets                                                |
|----------------|--------------------------------------------------------------|-------------------------------------------------------------------------------|
| Web            | modern Outlook UI when connected                             | 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 1.10, 1.11,                      |
| 1 2<br>browser | to                                                           | 1.12, 1.13, 1.14, 1.15                                                        |
|                | Exchange Online: subscription,                               | DevicePermissionService 1.1                                                   |
|                | Outlook.com                                                  | DialogAPI 1.1                                                                 |
|                |                                                              | DialogAPI 1.2                                                                 |
|                |                                                              | DialogOrigin 1.1                                                              |
|                |                                                              | 3<br>IdentityAPI 1.3                                                          |
|                |                                                              | NestedAppAuth 1.1                                                             |
|                | classic Outlook UI when connected to<br>Exchange on-premises | 1.1, 1.2, 1.3, 1.4, 1.5, 1.6                                                  |
| Windows        | new Outlook UI<br>with a Microsoft                           | 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 1.10, 1.11,                      |
|                | 365 subscription                                             | 1.12, 1.13, 1.14, 1.15                                                        |
|                |                                                              | DevicePermissionService 1.1                                                   |
|                |                                                              | DialogAPI 1.1                                                                 |
|                |                                                              | DialogAPI 1.2                                                                 |
|                |                                                              | DialogOrigin 1.1                                                              |
|                |                                                              | 3<br>IdentityAPI 1.3                                                          |
|                |                                                              | NestedAppAuth 1.1                                                             |
|                | classic Outlook UI with a Microsoft                          | 4<br>4<br>4<br>1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8<br>, 1.9<br>, 1.10<br>, |
|                | 365 subscription                                             | 4<br>4<br>4<br>4<br>4<br>1.11<br>, 1.12<br>, 1.13<br>, 1.14<br>, 1.15         |
|                |                                                              | DialogAPI 1.1                                                                 |
|                |                                                              |                                                                               |

{69}------------------------------------------------

| Platform | Major Office/Outlook version                                    | Supported API requirement sets                                                                                                                                                                                                                                                        |
|----------|-----------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|          |                                                                 | DialogAPI 1.2<br>DialogOrigin 1.1<br>3<br>IdentityAPI 1.3<br>NestedAppAuth 1.1                                                                                                                                                                                                        |
|          |                                                                 | OpenBrowserWindowApi 1.1                                                                                                                                                                                                                                                              |
|          | retail perpetual Outlook 2016 and<br>later (classic Outlook UI) | 4<br>4<br>4<br>1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8<br>, 1.9<br>, 1.10<br>,<br>4<br>4<br>4<br>4<br>4<br>1.11<br>, 1.12<br>, 1.13<br>, 1.14<br>, 1.15<br>DialogAPI 1.1<br>DialogAPI 1.2<br>DialogOrigin 1.1<br>3<br>IdentityAPI 1.3<br>NestedAppAuth 1.1<br>OpenBrowserWindowApi 1.1 |
|          | volume-licensed perpetual Outlook<br>2024 (classic Outlook UI)  | 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 1.10, 1.11,<br>1.12, 1.13, 1.14<br>DialogAPI 1.1<br>DialogAPI 1.2<br>DialogOrigin 1.1<br>3<br>IdentityAPI 1.3<br>NestedAppAuth 1.1<br>OpenBrowserWindowApi 1.1                                                                           |
|          | volume-licensed perpetual Outlook<br>2021 (classic Outlook UI)  | 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9<br>DialogAPI 1.1<br>DialogAPI 1.2<br>DialogOrigin 1.1<br>3<br>IdentityAPI 1.3<br>OpenBrowserWindowApi 1.1                                                                                                                                 |
|          | volume-licensed perpetual Outlook<br>2019 (classic Outlook UI)  | 1.1, 1.2, 1.3, 1.4, 1.5, 1.6                                                                                                                                                                                                                                                          |
|          | volume-licensed perpetual Outlook<br>2016 (classic Outlook UI)  | 5<br>1.1, 1.2, 1.3, 1.4                                                                                                                                                                                                                                                               |
| Mac      | 6<br>new UI                                                     | 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 1.10, 1.11,<br>1.12, 1.13, 1.14<br>DialogAPI 1.1<br>DialogAPI 1.2<br>DialogOrigin 1.1<br>3<br>IdentityAPI 1.3<br>NestedAppAuth 1.1<br>OpenBrowserWindowApi 1.1                                                                           |
|          | classic UI                                                      | 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8<br>DialogAPI 1.1<br>7<br>DialogAPI 1.2                                                                                                                                                                                                         |

{70}------------------------------------------------

| Platform       | Major Office/Outlook version | Supported API requirement sets |
|----------------|------------------------------|--------------------------------|
|                |                              | DialogOrigin 1.1<br>3          |
|                |                              | IdentityAPI 1.3                |
|                |                              | NestedAppAuth 1.1              |
|                |                              | OpenBrowserWindowApi 1.1       |
| 1 8<br>Android | subscription                 | 1.1, 1.2, 1.3, 1.4, 1.5        |
|                |                              | NestedAppAuth 1.1              |
| 1 8<br>iOS     | subscription                 | 1.1, 1.2, 1.3, 1.4, 1.5        |
|                |                              | NestedAppAuth 1.1              |

 Add-ins aren't supported in Outlook on Android, on iOS, and modern mobile web with on-premises Exchange accounts. Certain iOS devices still support add-ins when using onpremises Exchange accounts with classic Outlook on the web. For information about supported devices, see Requirements for running Office Add-ins. 1

 Add-ins don't work in modern Outlook on the web on iPhone and Android smartphones. For information about supported devices, see Requirements for running Office Add-ins. 2

 To require the Identity API set 1.3 in your Outlook add-in code, check if it's supported by calling isSetSupported('IdentityAPI', '1.3') . Declaring it in the Outlook add-in's manifest isn't supported. You can also determine if the API is supported by checking that it's not undefined . For further details, see [Using APIs from later requirement sets.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#using-apis-from-later-requirement-sets) 3

 To learn about the minimum supported versions for recent requirement sets in classic Outlook on Windows with a Microsoft 365 subscription or a retail perpetual license, see Version support for requirement sets in classic Outlook on Windows. 4

 Support for 1.4 in volume-licensed perpetual Outlook 2016 was added as part of the [July](https://support.microsoft.com/help/4022223) [3, 2018, update for Office 2016 (KB4022223)](https://support.microsoft.com/help/4022223) . 5

 Support for the new Mac UI is available from Outlook Version 16.38.506. For more information, see the Add-in support in Outlook on new Mac UI section. 6

 Although classic Outlook on Mac doesn't support Mailbox requirement set 1.9, it does support the DialogApi 1.2 requirement set. For information on the minimum supported version and build, see [Dialog API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/dialog-api-requirement-sets?view=common-js-preview). 7

 Currently, there are additional considerations when designing and implementing add-ins for mobile clients. For more details, see code considerations when adding support for addin commands in Outlook on mobile devices. Although Outlook on Android and on iOS support up to requirement set 1.5, your mobile add-in can now implement some APIs from 8

{71}------------------------------------------------

later requirement sets. For more information on which APIs are supported in Outlook mobile, see Outlook JavaScript APIs supported in Outlook on mobile devices.

#### **Tip**

You can distinguish between classic and modern Outlook in a web browser by checking your mailbox toolbar.

#### **modern**

### **Version support for requirement sets in classic Outlook on Windows**

The following table lists version support for more recent Mailbox requirement sets in classic Outlook on Windows with a Microsoft 365 subscription or a retail perpetual license.

| Requirement set | Version                          |
|-----------------|----------------------------------|
| 1.8             | Version 1910 (Build 12130.20272) |
| 1.9             | Version 2008 (Build 13127.20296) |
| 1.10            | Version 2104 (Build 13929.20296) |
| 1.11            | Version 2110 (Build 14527.20226) |
| 1.12            | Version 2206 (Build 15330.20196) |
| 1.13            | Version 2304 (Build 16327.20248) |
| 1.14            | Version 2404 (Build 17530.15000) |
| 1.15            | Version 2412 (Build 18324.20172) |

{72}------------------------------------------------

For more details about your client version, see the update history page for [Microsoft 365](https://learn.microsoft.com/en-us/officeupdates/update-history-office365-proplus-by-date) or [Office 2024](https://learn.microsoft.com/en-us/officeupdates/update-history-office-2024) and how to [find your Office client version and update channel](https://support.microsoft.com/office/932788b8-a3ce-44bf-bb09-e334518b8b19) .

#### 7 **Note**

In Outlook, each update channel receives updates at a different rate. To verify that your channel supports a particular version or build, see **[Update history for Microsoft 365 Apps](https://learn.microsoft.com/en-us/officeupdates/update-history-microsoft365-apps-by-date)**. For a comparison of the different update channels, see **[Overview of update channels for](https://learn.microsoft.com/en-us/microsoft-365-apps/updates/overview-update-channels) [Microsoft 365 Apps](https://learn.microsoft.com/en-us/microsoft-365-apps/updates/overview-update-channels)**.

# **Reference the Office JavaScript API production library**

To use APIs in any of the numbered requirement sets, you should reference the **production** library on the [Office.js content delivery network (CDN)](https://appsforoffice.microsoft.com/lib/1/hosted/office.js) . For information on how to use preview APIs, see Test preview APIs.

### **Test preview APIs**

New Outlook JavaScript APIs are first introduced in "preview" and later become part of a specific, numbered requirement set after sufficient testing occurs and user feedback is acquired. To provide feedback about a preview API, please use the feedback mechanism at the end of the web page where the API is documented.

#### 7 **Note**

Preview APIs are subject to change and aren't intended for use in a production environment.

For more details about the preview APIs, see [Outlook API preview requirement set.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/outlook-requirement-set-preview?view=common-js-preview)

{73}------------------------------------------------

# **outlook package**

# **Interfaces**

| Office.<br>Appointment                             | The subclass of Item dealing with appointments.<br>Important: This is an internal Outlook object, not directly exposed through existing<br>interfaces. You should treat this as a mode of Office.context.mailbox.item<br>. For more<br>information, refer to the Object Model page.<br>Child interfaces:<br>AppointmentCompose<br>AppointmentRead      |
|----------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Office.<br>Appointment<br>Compose                  | The appointment organizer mode of Office.context.mailbox.item.<br>Important: This is an internal Outlook object, not directly exposed through existing<br>interfaces. You should treat this as a mode of Office.context.mailbox.item<br>. For more<br>information, refer to the Object Model page.<br>Parent interfaces:<br>ItemCompose<br>Appointment |
| Office.<br>Appointment<br>Form                     | The AppointmentForm object is used to access the currently selected appointment.                                                                                                                                                                                                                                                                       |
| Office.<br>Appointment<br>Read                     | The appointment attendee mode of Office.context.mailbox.item.<br>Important: This is an internal Outlook object, not directly exposed through existing<br>interfaces. You should treat this as a mode of Office.context.mailbox.item<br>. For more<br>information, refer to the Object Model page.<br>Parent interfaces:<br>ItemRead<br>Appointment     |
| Office.<br>Appointment<br>TimeChanged<br>EventArgs | Provides the current dates and times of the appointment that raised the<br>Office.EventType.AppointmentTimeChanged event.                                                                                                                                                                                                                              |

{74}------------------------------------------------

| Office.<br>Attachment<br>Content               | Represents the content of an attachment on a message or appointment item.                                                                                                                                                                                                                                                |
|------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Office.<br>Attachment<br>Details               | Represents an attachment on an item from the server. Read mode only.                                                                                                                                                                                                                                                     |
|                                                | An array of AttachmentDetails objects is returned as the attachments property of an<br>appointment or message item.                                                                                                                                                                                                      |
| Office.<br>Attachment<br>Details<br>Compose    | Represents an attachment on an item. Compose mode only.                                                                                                                                                                                                                                                                  |
|                                                | An array of AttachmentDetailsCompose objects is returned by the getAttachmentsAsync<br>method.                                                                                                                                                                                                                           |
| Office.<br>Attachments<br>ChangedEvent<br>Args | Provides information about the attachment on a mail item that raised the<br>Office.EventType.AttachmentsChanged event.                                                                                                                                                                                                   |
| Office.Body                                    | The body object provides methods for adding and updating the content of the<br>message or appointment. It is returned in the body property of the selected item.                                                                                                                                                         |
| Office.                                        | Represents the categories on an item.                                                                                                                                                                                                                                                                                    |
| Categories                                     | In Outlook, a user can tag messages and appointments by using a category to color<br>code them. The user defines categories in a master list on their mailbox. They can then<br>apply one or more categories to an item.                                                                                                 |
|                                                | Important: In Outlook on the web and new Outlook on Windows<br>, you can't use the<br>API to manage categories applied to a message in Compose mode.                                                                                                                                                                     |
| Office.Category<br>Details                     | Represents a category's details like name and associated color.                                                                                                                                                                                                                                                          |
| Office.Coercion<br>TypeOptions                 | Provides an option for the data format.                                                                                                                                                                                                                                                                                  |
| Office.Contact                                 | Represents the details about a contact (similar to what's on a physical contact or<br>business card) extracted from the item's body. Read mode only.                                                                                                                                                                     |
|                                                | The list of contacts extracted from the body of an email message or appointment is<br>returned in the contacts property of the Entities object returned by the getEntities or<br>getEntitiesByType method of the current item.                                                                                           |
|                                                | Warning: Entity-based contextual Outlook add-ins are now retired. However, regular<br>expression rules are still supported. We recommend updating your contextual add-in<br>to use regular expression rules as an alternative solution. For guidance on how to<br>implement these rules, see Contextual Outlook add-ins. |
| Office.Custom<br>Properties                    | The CustomProperties object represents custom properties that are specific to a<br>particular mail item and specific to an Outlook add-in. For example, there might be a<br>need for an add-in to save some data that's specific to the current message that                                                             |

{75}------------------------------------------------

|                                                      | activated the add-in. If the user revisits the same message in the future and activates<br>the add-in again, the add-in will be able to retrieve the data that had been saved as<br>custom properties.                                                                                                                                                                                                                                                                  |
|------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                                      | To learn more about CustomProperties<br>, see Get and set add-in metadata for an<br>Outlook add-in.                                                                                                                                                                                                                                                                                                                                                                     |
| Office.Delay                                         | The DelayDeliveryTime object enables you to manage the delayed delivery date and                                                                                                                                                                                                                                                                                                                                                                                        |
| DeliveryTime                                         | time of a message.                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Office.<br>Diagnostics                               | Provides diagnostic information to an Outlook add-in.                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Office.DragAnd<br>DropEventArgs                      | Provides details about the mouse pointer position and the messages or file<br>attachments being dragged and dropped into an add-in's task pane when the<br>Office.EventType.DragAndDropEvent event is raised.                                                                                                                                                                                                                                                           |
| Office.Dragover                                      | Represents the DragAndDropEventArgs.dragAndDropEventData object when messages or                                                                                                                                                                                                                                                                                                                                                                                        |
| EventData                                            | file attachments are dragged over an add-in's task pane.                                                                                                                                                                                                                                                                                                                                                                                                                |
| Office.Drop                                          | Represents the DragAndDropEventArgs.dragAndDropEventData object when messages or                                                                                                                                                                                                                                                                                                                                                                                        |
| EventData                                            | file attachments are dropped into an add-in's task pane.                                                                                                                                                                                                                                                                                                                                                                                                                |
| Office.Dropped                                       | Provides the contents and details of the message or file attachment being dragged and                                                                                                                                                                                                                                                                                                                                                                                   |
| ItemDetails                                          | dropped into an add-in's task pane.                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Office.Dropped                                       | Provides the messages or file attachments being dragged and dropped into an add                                                                                                                                                                                                                                                                                                                                                                                         |
| Items                                                | in's task pane.                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Office.Email                                         | Provides the email properties of the sender or specified recipients of an email message                                                                                                                                                                                                                                                                                                                                                                                 |
| AddressDetails                                       | or appointment.                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Office.Email<br>User                                 | Represents an email account on an Exchange Server.                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Office.Enhanced<br>Location                          | Represents the set of locations on an appointment.                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Office.Enhanced<br>Locations<br>ChangedEvent<br>Args | Provides the current enhanced locations when the<br>Office.EventType.EnhancedLocationsChanged event is raised.                                                                                                                                                                                                                                                                                                                                                          |
| Office.Entities                                      | Represents a collection of entities found in an email message or appointment. Read<br>mode only.                                                                                                                                                                                                                                                                                                                                                                        |
|                                                      | The Entities object is a container for the entity arrays returned by the getEntities<br>and getEntitiesByType methods when the item (either an email message or an<br>appointment) contains one or more entities that have been found by the server. You<br>can use these entities in your code to provide additional context information to the<br>viewer, such as a map to an address found in the item, or to open a dialer for a phone<br>number found in the item. |

{76}------------------------------------------------

|                                                              | If no entities of the type specified in the property are present in the item, the property<br>associated with that entity is null. For example, if a message contains a street address<br>and a phone number, the addresses property and phoneNumbers property would<br>contain information, and the other properties would be null. |
|--------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                                              | To be recognized as an address, the string must contain a United States postal address<br>that has at least a subset of the elements of a street number, street name, city, state,<br>and zip code.                                                                                                                                  |
|                                                              | To be recognized as a phone number, the string must contain a North American phone<br>number format.                                                                                                                                                                                                                                 |
|                                                              | Entity recognition relies on natural language recognition that is based on machine<br>learning of large amounts of data. The recognition of an entity is non-deterministic and<br>success sometimes relies on the particular context in the item.                                                                                    |
|                                                              | When the property arrays are returned by the getEntitiesByType method, only the<br>property for the specified entity contains data; all other properties are null.                                                                                                                                                                   |
|                                                              | Warning: Entity-based contextual Outlook add-ins are now retired. However, regular<br>expression rules are still supported. We recommend updating your contextual add-in<br>to use regular expression rules as an alternative solution. For guidance on how to<br>implement these rules, see Contextual Outlook add-ins.             |
| Office.From                                                  | Provides a method to get the from value of a message in an Outlook add-in.                                                                                                                                                                                                                                                           |
| Office.Infobar<br>ClickedEvent<br>Args                       | Provides basic details about the notification message that raised the<br>Office.EventType.InfobarClicked event.                                                                                                                                                                                                                      |
| Office.Infobar                                               | Provides additional details about the notification message that raised the                                                                                                                                                                                                                                                           |
| Details                                                      | Office.EventType.InfobarClicked event.                                                                                                                                                                                                                                                                                               |
| Office.<br>Initialization<br>Context<br>ChangedEvent<br>Args | Provides data from an actionable message, InsightMessage notification, Smart Alerts<br>dialog, or integrated spam-reporting dialog when the<br>Office.EventType.InitializationContextChanged event occurs.                                                                                                                           |
| Office.Internet                                              | The InternetHeaders object represents custom internet headers that are preserved                                                                                                                                                                                                                                                     |
| Headers                                                      | after the message item leaves Exchange and is converted to a MIME message.                                                                                                                                                                                                                                                           |
|                                                              | Internet headers are stored as string key-value pairs on a per-item basis.                                                                                                                                                                                                                                                           |
|                                                              | Note: This object is intended for you to set and get your custom headers on a message<br>item. To learn more, see Get and set internet headers on a message in an Outlook add<br>in.                                                                                                                                                 |
| Office.Item                                                  | The item namespace is used to access the currently selected message, meeting<br>request, or appointment. You can determine the type of the item by using the<br>itemType property.                                                                                                                                                   |

{77}------------------------------------------------

|                                     | To see the full member list, refer to the Object Model page.                                                                                                                                                                     |
|-------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                     | If you want to see IntelliSense for only a specific type or mode, cast this item to one of<br>the following:                                                                                                                     |
|                                     | AppointmentCompose<br>AppointmentRead<br>MessageCompose<br>MessageRead                                                                                                                                                           |
| Office.Item                         | The compose mode of Office.context.mailbox.item.                                                                                                                                                                                 |
| Compose                             | Important: This is an internal Outlook object, not directly exposed through existing<br>interfaces. You should treat this as a mode of Office.context.mailbox.item<br>. For more<br>information, refer to the Object Model page. |
|                                     | Child interfaces:                                                                                                                                                                                                                |
|                                     | AppointmentCompose<br>MessageCompose                                                                                                                                                                                             |
| Office.ItemRead                     | The read mode of Office.context.mailbox.item.                                                                                                                                                                                    |
|                                     | Important: This is an internal Outlook object, not directly exposed through existing<br>interfaces. You should treat this as a mode of Office.context.mailbox.item<br>. For more<br>information, refer to the Object Model page. |
|                                     | Child interfaces:                                                                                                                                                                                                                |
|                                     | AppointmentRead<br>MessageRead                                                                                                                                                                                                   |
| Office.Loaded<br>Message<br>Compose | Represents a message in compose mode that's currently loaded. A<br>LoadedMessageCompose object is returned when                                                                                                                  |
|                                     | Office.context.mailbox.loadItemByIdAsync is called on a message in compose mode.                                                                                                                                                 |
| Office.Loaded<br>MessageRead        | Represents a message in read mode that's currently loaded. A LoadedMessageRead<br>object is returned when Office.context.mailbox.loadItemByIdAsync is called on a<br>message in read mode.                                       |
| Office.Local<br>ClientTime          | Represents a date and time in the local client's time zone. Read mode only.                                                                                                                                                      |
| Office.Location                     | Provides methods to get and set the location of a meeting in an Outlook add-in.                                                                                                                                                  |
| Office.Location<br>Details          | Represents a location. Read-only.                                                                                                                                                                                                |
| Office.Location<br>Identifier       | Represents the ID of a location.                                                                                                                                                                                                 |

{78}------------------------------------------------

| Office.Mailbox          | Provides access to the Microsoft Outlook add-in object model.                                                                                                                                                                                                                                                            |
|-------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                         | Key properties:                                                                                                                                                                                                                                                                                                          |
|                         | diagnostics : Provides diagnostic information to an Outlook add-in.<br>item : Provides methods and properties for accessing a message or appointment<br>in an Outlook add-in.<br>userProfile : Provides information about the user in an Outlook add-in.                                                                 |
| Office.Mailbox<br>Event | The MailboxEvent object is passed as an argument to the event handler of an add-in<br>that implements event-based activation, including Smart Alerts, or the integrated<br>spam-reporting feature. It allows the add-in to signify to the Outlook client that it has<br>completed processing an event.                   |
| Office.Master           | Represents the categories master list on the mailbox.                                                                                                                                                                                                                                                                    |
| Categories              | In Outlook, a user can tag messages and appointments by using a category to color<br>code them. The user defines categories in a master list on their mailbox. They can then<br>apply one or more categories to an item.                                                                                                 |
|                         | Important: In delegate or shared scenarios, the delegate can get the categories in the<br>master list but can't add or remove categories.                                                                                                                                                                                |
| Office.Meeting          | Represents a suggested meeting found in an item. Read mode only.                                                                                                                                                                                                                                                         |
| Suggestion              | The list of meetings suggested in an email message is returned in the<br>meetingSuggestions property of the Entities object that's returned when the<br>getEntities or getEntitiesByType method is called on the active item.                                                                                            |
|                         | The start and end values are string representations of a Date object that contains the<br>date and time at which the suggested meeting is to begin and end. The values are in<br>the default time zone specified for the current user.                                                                                   |
|                         | Warning: Entity-based contextual Outlook add-ins are now retired. However, regular<br>expression rules are still supported. We recommend updating your contextual add-in<br>to use regular expression rules as an alternative solution. For guidance on how to<br>implement these rules, see Contextual Outlook add-ins. |
| Office.Message          | A subclass of Item for messages.                                                                                                                                                                                                                                                                                         |
|                         | Important: This is an internal Outlook object, not directly exposed through existing<br>interfaces. You should treat this as a mode of Office.context.mailbox.item . For more<br>information, refer to the Object Model page.                                                                                            |
|                         | Child interfaces:                                                                                                                                                                                                                                                                                                        |
|                         | MessageCompose<br>MessageRead                                                                                                                                                                                                                                                                                            |

{79}------------------------------------------------

| Office.Message                             | The message compose mode of Office.context.mailbox.item.                                                                                                                                                                                                                                                                                                                                                                                                                   |
|--------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Compose                                    | Important:                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                                            | This is an internal Outlook object, not directly exposed through existing<br>interfaces. You should treat this as a mode of Office.context.mailbox.item . For<br>more information, refer to the Object Model page.<br>When calling Office.context.mailbox.item on a message, note that the Reading<br>Pane in the Outlook client must be turned on. For guidance on how to configure<br>the Reading Pane, see Use and configure the Reading Pane to preview<br>messages    |
|                                            | Parent interfaces:                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                            | ItemCompose                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|                                            | Message                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Office.Message<br>Read                     | The message read mode of Office.context.mailbox.item.                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                                            | Important:                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|                                            | This is an internal Outlook object, not directly exposed through existing<br>interfaces. You should treat this as a mode of Office.context.mailbox.item<br>. For<br>more information, refer to the Object Model page.<br>When calling Office.context.mailbox.item on a message, note that the Reading<br>Pane in the Outlook client must be turned on. For guidance on how to configure<br>the Reading Pane, see Use and configure the Reading Pane to preview<br>messages |
|                                            | Parent interfaces:                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|                                            | ItemRead<br>Message                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| Office.<br>Notification<br>MessageAction   | The definition of the action for a notification message.                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Office.<br>Notification<br>MessageDetails  | An array of NotificationMessageDetails objects are returned by the<br>NotificationMessages.getAllAsync method.                                                                                                                                                                                                                                                                                                                                                             |
| Office.<br>Notification<br>Messages        | The NotificationMessages object is returned as the notificationMessages property of<br>an item.                                                                                                                                                                                                                                                                                                                                                                            |
| Office.Office<br>ThemeChanged<br>EventArgs | Provides the updated Office theme that raised the<br>Office.EventType.OfficeThemeChanged event.                                                                                                                                                                                                                                                                                                                                                                            |

{80}------------------------------------------------

| Office.<br>Organizer                          | Represents the appointment organizer, even if an alias or a delegate was used to<br>create the appointment. This object provides a method to get the organizer value of an<br>appointment in an Outlook add-in.                                                                                                                                                                                   |
|-----------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Office.Phone<br>Number                        | Represents a phone number identified in an item. Read mode only.<br>An array of PhoneNumber objects containing the phone numbers found in an email<br>message is returned in the phoneNumbers property of the Entities object that's<br>returned when you call the getEntities method on the selected item.<br>Warning: Entity-based contextual Outlook add-ins are now retired. However, regular |
|                                               | expression rules are still supported. We recommend updating your contextual add-in<br>to use regular expression rules as an alternative solution. For guidance on how to<br>implement these rules, see Contextual Outlook add-ins.                                                                                                                                                                |
| Office.<br>Recipients                         | Represents recipients of an item. Compose mode only.                                                                                                                                                                                                                                                                                                                                              |
| Office.<br>Recipients<br>ChangedEvent<br>Args | Provides change status of recipients fields when the<br>Office.EventType.RecipientsChanged event is raised.                                                                                                                                                                                                                                                                                       |
| Office.<br>Recipients<br>ChangedFields        | Represents RecipientsChangedEventArgs.changedRecipientFields object.                                                                                                                                                                                                                                                                                                                              |
| Office.<br>Recurrence                         | The Recurrence object provides methods to get and set the recurrence pattern of<br>appointments but only get the recurrence pattern of meeting requests. It will have a<br>dictionary with the following keys: seriesTime<br>, recurrenceType<br>, recurrenceProperties<br>,<br>and recurrenceTimeZone (optional).                                                                                |
| Office.<br>Recurrence<br>ChangedEvent<br>Args | Provides updated recurrence object that raised the<br>Office.EventType.RecurrenceChanged event.                                                                                                                                                                                                                                                                                                   |
| Office.<br>Recurrence<br>Properties           | Represents the properties of the recurrence.                                                                                                                                                                                                                                                                                                                                                      |
| Office.<br>RecurrenceTime<br>Zone             | Represents the time zone of the recurrence.                                                                                                                                                                                                                                                                                                                                                       |
| Office.Reply<br>Form<br>Attachment            | A file or item attachment. Used when displaying a reply form.                                                                                                                                                                                                                                                                                                                                     |
| Office.Reply                                  | A ReplyFormData object that contains body or attachment data and a callback                                                                                                                                                                                                                                                                                                                       |
| FormData                                      | function. Used when displaying a reply form.                                                                                                                                                                                                                                                                                                                                                      |

{81}------------------------------------------------

| Office.Roaming<br>Settings               | The settings created by using the methods of the RoamingSettings object are saved<br>per add-in and per user. That is, they are available only to the add-in that created<br>them, and only from the user's mailbox in which they are saved.<br>While the Outlook add-in API limits access to these settings to only the add-in that<br>created them, these settings shouldn't be considered secure storage. They can be<br>accessed by Exchange Web Services or Extended MAPI. They shouldn't be used to store<br>sensitive information, such as user credentials or security tokens.<br>The name of a setting is a String, while the value can be a String, Number, Boolean,<br>null, Object, or Array.<br>The RoamingSettings object is accessible via the roamingSettings property in the<br>Office.context namespace.<br>To learn more about RoamingSettings<br>, see Get and set add-in metadata for an Outlook<br>add-in. |
|------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Office.Selected<br>ItemDetails           | Represents the properties of a message that's currently selected in Outlook.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Office.<br>Sensitivity                   | Provides methods to get and set the sensitivity level of an appointment. To learn more<br>about sensitivity levels, see Mark your email as Normal, Personal, Private, or<br>Confidential                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Office.                                  | Provides methods to get or set the sensitivity label of a message or appointment. For                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| SensitivityLabel                         | more information on sensitivity labels, see Learn about sensitivity labels.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Office.                                  | Provides the change status of the sensitivity label applied to a message or                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| SensitivityLabel<br>ChangedEvent<br>Args | appointment in compose mode. This information is provided when the<br>Office.EventType.SensitivityLabelChanged event is raised.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Office.<br>SensitivityLabel<br>Details   | Represents the properties of available sensitivity labels in Outlook.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Office.<br>Sensitivity<br>LabelsCatalog  | Provides methods to check the status of the catalog of sensitivity labels in Outlook and<br>retrieve all available sensitivity labels if the catalog is enabled.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Office.Series<br>Time                    | The SeriesTime object provides methods to get and set the dates and times of<br>appointments in a recurring series and get the dates and times of meeting requests in<br>a recurring series.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

{82}------------------------------------------------

| Office.Shared                                         | Represents the properties of an appointment or message in a shared folder or shared                                                                                                                                                                                                                                      |  |  |  |  |
|-------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|--|--|
| Properties                                            | mailbox.                                                                                                                                                                                                                                                                                                                 |  |  |  |  |
|                                                       | For more information on how this object is used, see Enable shared folders and shared<br>mailbox scenarios in an Outlook add-in.                                                                                                                                                                                         |  |  |  |  |
| Office.Smart<br>AlertsEvent<br>Completed<br>Options   | Specifies the behavior of a Smart Alerts add-in when it completes processing an<br>OnMessageSend or OnAppointmentSend event.                                                                                                                                                                                             |  |  |  |  |
| Office.Spam<br>ReportingEvent<br>Args                 | Provides information about the Office.EventType.SpamReporting event that occurs<br>when an unsolicited message is reported.                                                                                                                                                                                              |  |  |  |  |
| Office.Spam<br>ReportingEvent<br>Completed<br>Options | Specifies the behavior of an integrated spam-reporting add-in after it completes<br>processing a SpamReporting event.                                                                                                                                                                                                    |  |  |  |  |
| Office.Subject                                        | Provides methods to get and set the subject of an appointment or message in an<br>Outlook add-in.                                                                                                                                                                                                                        |  |  |  |  |
| Office.Task<br>Suggestion                             | Represents a suggested task identified in an item. Read mode only.                                                                                                                                                                                                                                                       |  |  |  |  |
|                                                       | The list of tasks suggested in an email message is returned in the taskSuggestions<br>property of the Entities object that's returned when the getEntities or<br>getEntitiesByType method is called on the active item.                                                                                                  |  |  |  |  |
|                                                       |                                                                                                                                                                                                                                                                                                                          |  |  |  |  |
|                                                       | Warning: Entity-based contextual Outlook add-ins are now retired. However, regular<br>expression rules are still supported. We recommend updating your contextual add-in<br>to use regular expression rules as an alternative solution. For guidance on how to<br>implement these rules, see Contextual Outlook add-ins. |  |  |  |  |
| Office.Time                                           | The Time object is returned as the start or end property of an appointment in compose<br>mode.                                                                                                                                                                                                                           |  |  |  |  |

# **Enums**

| Office.Mailbox<br>Enums.ActionType | Specifies the type of custom action in a notification message. |
|------------------------------------|----------------------------------------------------------------|
| Office.Mailbox<br>Enums.           | Specifies the sensitivity level of an appointment.             |

{83}------------------------------------------------

| Appointment<br>SensitivityType                      |                                                                                                                                                                                                                                                                                                                          |  |  |  |
|-----------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|--|
| Office.Mailbox<br>Enums.Attachment<br>ContentFormat | Specifies the formatting that applies to an attachment's content.                                                                                                                                                                                                                                                        |  |  |  |
| Office.Mailbox<br>Enums.Attachment<br>Status        | Specifies whether an attachment was added to or removed from an item.                                                                                                                                                                                                                                                    |  |  |  |
| Office.Mailbox<br>Enums.Attachment<br>Type          | Specifies the attachment's type.                                                                                                                                                                                                                                                                                         |  |  |  |
| Office.Mailbox                                      | Specifies the portion of a message's body displayed for replies to a conversation                                                                                                                                                                                                                                        |  |  |  |
| Enums.BodyMode                                      | thread with more than one message.                                                                                                                                                                                                                                                                                       |  |  |  |
| Office.Mailbox<br>Enums.Category<br>Color           | Specifies the category color.                                                                                                                                                                                                                                                                                            |  |  |  |
| Office.Mailbox<br>Enums.Compose<br>Type             | Specifies a message's compose type.                                                                                                                                                                                                                                                                                      |  |  |  |
|                                                     |                                                                                                                                                                                                                                                                                                                          |  |  |  |
| Office.Mailbox<br>Enums.Days                        | Specifies the day of week or type of day.                                                                                                                                                                                                                                                                                |  |  |  |
| Office.Mailbox<br>Enums.Delegate<br>Permissions     | This bitmask represents a delegate's permissions on a shared folder.                                                                                                                                                                                                                                                     |  |  |  |
| Office.Mailbox                                      | Specifies an entity's type.                                                                                                                                                                                                                                                                                              |  |  |  |
| Enums.EntityType                                    | Warning: Entity-based contextual Outlook add-ins are now retired. However,<br>regular expression rules are still supported. We recommend updating your<br>contextual add-in to use regular expression rules as an alternative solution. For<br>guidance on how to implement these rules, see Contextual Outlook add-ins. |  |  |  |
| Office.Mailbox<br>Enums.Infobar<br>ActionType       | Action types supported by Office.EventType.InfobarClicked.                                                                                                                                                                                                                                                               |  |  |  |
| Office.Mailbox<br>Enums.InfobarType                 | Type of notification allowed by Office.EventType.InfobarClicked.                                                                                                                                                                                                                                                         |  |  |  |

{84}------------------------------------------------

| Office.Mailbox<br>Enums.ItemType               | Specifies an item's type.                                                                                        |  |  |  |
|------------------------------------------------|------------------------------------------------------------------------------------------------------------------|--|--|--|
| Office.Mailbox<br>Enums.Location<br>Type       | Specifies an appointment location's type.                                                                        |  |  |  |
| Office.Mailbox<br>Enums.Month                  | Specifies the month.                                                                                             |  |  |  |
| Office.Mailbox                                 | Specifies the folder to which a reported spam or phishing message is moved once                                  |  |  |  |
| Enums.MoveSpam                                 | it's processed by a spam-reporting add-in.                                                                       |  |  |  |
| ItemTo                                         | To learn more about the integrated spam-reporting feature, see Implement an<br>integrated spam-reporting add-in. |  |  |  |
| Office.Mailbox<br>Enums.Open<br>Location       | Specifies the location from which an add-in wants to access data.                                                |  |  |  |
| Office.Mailbox<br>Enums.OWAView                | Represents the current view of Outlook on the web.                                                               |  |  |  |
| Office.Mailbox<br>Enums.Recipient<br>Type      | Specifies the type of recipient of a message or appointment.                                                     |  |  |  |
| Office.Mailbox<br>Enums.Recurrence<br>TimeZone | Specifies the time zone applied to the recurrence.                                                               |  |  |  |
| Office.Mailbox<br>Enums.Recurrence<br>Type     | Specifies the type of recurrence.                                                                                |  |  |  |
| Office.Mailbox<br>Enums.Response<br>Type       | Specifies the type of response to a meeting invitation.                                                          |  |  |  |
| Office.Mailbox<br>Enums.RestVersion            | Specifies the version of the REST API that corresponds to a REST-formatted item ID.                              |  |  |  |
| Office.Mailbox<br>Enums.Save<br>Location       | Specifies the location in which an add-in wants to save data.                                                    |  |  |  |
| Office.Mailbox<br>Enums.SendMode<br>Override   | Specifies the send mode option that overrides the option set in the manifest at<br>runtime.                      |  |  |  |

{85}------------------------------------------------

|                                            | For information on how to implement a Smart Alerts add-in, see Handle<br>OnMessageSend and OnAppointmentSend events in your Outlook add-in with<br>Smart Alerts. |
|--------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Office.Mailbox<br>Enums.Source<br>Property | Specifies the source of the selected data in an item (see<br>Office.mailbox.item.getSelectedDataAsync for details).                                              |
| Office.Mailbox<br>Enums.Week<br>Number     | Specifies the week of the month.                                                                                                                                 |

{86}------------------------------------------------

# **Understanding Outlook add-in permissions**

Article • 10/17/2024

Outlook add-ins specify the required permission level in their manifest. There are four available levels.

| Permission<br>level<br>canonical<br>name | add-in only<br>manifest name | unified manifest for<br>Microsoft 365 name | Summary description                                                                                                                                                                                                 |
|------------------------------------------|------------------------------|--------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| restricted                               | Restricted                   | MailboxItem.Restricted.User                | Allows access to properties<br>and methods that don't<br>pertain to specific information<br>about the user or mail item.                                                                                            |
| read item                                | ReadItem                     | MailboxItem.Read.User                      | In addition to what is allowed<br>in restricted, it allows:<br>regular expressions<br>Outlook add-in API read<br>access<br>getting the item<br>properties and the<br>callback token<br>writing custom<br>properties |
| read/write<br>item                       | ReadWriteItem                | MailboxItem.ReadWrite.User                 | In addition to what is allowed<br>in read item, it allows:<br>full Outlook add-in API<br>access except<br>makeEwsRequestAsync<br>setting the item<br>properties                                                     |
| read/write<br>mailbox                    | ReadWriteMailbox             | Mailbox.ReadWrite.User                     | In addition to what is allowed<br>in read/write item, it allows:<br>creating, reading, writing<br>items and folders<br>sending items                                                                                |

{87}------------------------------------------------

| Permission<br>level<br>canonical<br>name | add-in only<br>manifest name | unified manifest for<br>Microsoft 365 name | Summary description            |
|------------------------------------------|------------------------------|--------------------------------------------|--------------------------------|
|                                          |                              |                                            | calling<br>makeEwsRequestAsync |

Permissions are declared in the manifest. The markup varies depending on the type of manifest.

- **Add-in only manifest**: Use the **<Permissions>** element.
- **Unified manifest for Microsoft 365**: Use the "name" property of an object in the "authorization.permissions.resourceSpecific" array.

7 **Note**

- There's a supplementary permission needed for add-ins that use the appendon-send feature. With the add-in only manifest, specify the permission in the **[ExtendedPermissions](https://learn.microsoft.com/en-us/javascript/api/manifest/extendedpermissions)** element. For details, see **Implement append-on-send in your Outlook add-in**. With the unified manifest, specify this permission with the name **Mailbox.AppendOnSend.User** in an additional object in the "authorization.permissions.resourceSpecific" array.
- There's a supplementary permission needed for add-ins that use shared folders. With the add-in only manifest, specify the permission by setting the **[SupportsSharedFolders](https://learn.microsoft.com/en-us/javascript/api/manifest/supportssharedfolders)** element to true . For details, see **Implement shared folders and shared mailbox scenarios in an Outlook add-in**. With the unified manifest, specify this permission with the name **Mailbox.SharedFolder** in an additional object in the "authorization.permissions.resourceSpecific" array.

The four levels of permissions are cumulative: the **read/write mailbox** permission includes the permissions of **read/write item**, **read item** and **restricted**, **read/write item** includes **read item** and **restricted**, and the **read item** permission includes **restricted**.

You can see the permissions requested by a mail add-in before installing it from [AppSource](https://appsource.microsoft.com/) . You can also see the required permissions of installed add-ins in the Exchange Admin Center.

{88}------------------------------------------------

To make sure that your Outlook add-in specifies the correct permission level, verify the minimum permission level required by each API implemented by your add-in. For information on minimum permission levels, see **[Outlook API reference](https://learn.microsoft.com/en-us/javascript/api/outlook)**.

# **restricted permission**

The **restricted** permission is the most basic level of permission. Outlook assigns this permission to a mail add-in by default if the add-in doesn't request a specific permission in its manifest.

### **Can do**

Access any properties and methods that do **not** pertain to specific information about the user or item (see the next section for the list of members that do).

### **Can't do**

- Use the [ItemHasAttachment](https://learn.microsoft.com/en-us/javascript/api/manifest/rule#itemhasattachment-rule) or [ItemHasRegularExpressionMatch](https://learn.microsoft.com/en-us/javascript/api/manifest/rule#itemhasregularexpressionmatch-rule) rule.
- Access the members in the following list that pertain to the information of the user or item. Attempting to access members in this list will return **null** and result in an error message which states that Outlook requires the mail add-in to have elevated permission.
	- [item.addFileAttachmentAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods)
	- [item.addItemAttachmentAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods)
	- [item.attachments](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties)
	- [item.bcc](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties)
	- [item.body](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties)
	- [item.cc](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties)
	- [item.from](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties)
	- [item.getRegExMatches](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods)
	- [item.getRegExMatchesByName](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods)
	- [item.optionalAttendees](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties)
	- [item.organizer](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties)
	- [item.removeAttachmentAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods)
	- [item.requiredAttendees](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties)
	- [item.sender](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties)
	- [item.to](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties)
	- [mailbox.getCallbackTokenAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#methods)
	- [mailbox.getUserIdentityTokenAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#methods)

{89}------------------------------------------------

- [mailbox.makeEwsRequestAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#methods)
- [mailbox.userProfile](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#properties)
- [Body](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body) and all its child members
- [Location](https://learn.microsoft.com/en-us/javascript/api/outlook/office.location) and all its child members
- [Recipients](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients) and all its child members
- [Subject](https://learn.microsoft.com/en-us/javascript/api/outlook/office.subject) and all its child members
- [Time](https://learn.microsoft.com/en-us/javascript/api/outlook/office.time) and all its child members

## **read item permission**

The **read item** permission is the next level of permission in the permissions model.

### **Can do**

- Read all the properties of the current item in a read or compose form. For example, [item.to](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties) in a read form and [item.to.getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients#outlook-office-recipients-getasync-member(1)) in a compose form.
- In Exchange on-premises environments, get a callback token to get the full mail item with Exchange Web Services (EWS).

#### ) **Important**

Legacy Exchange tokens are deprecated. Starting October 2024, legacy Exchange **user identity** and **callback** tokens will begin to be turned off for Exchange Online tenants. For the timeline and details, see our **FAQ page**. This is part of **[Microsoft's Secure Future Initiative](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/)** , which gives organizations the tools needed to respond to the current threat landscape. Exchange user identity tokens will still work for Exchange on-premises. Nested app authentication is the recommended approach for tokens going forward.

- [Write custom properties](https://learn.microsoft.com/en-us/javascript/api/outlook/office.customproperties) set by the add-in on that item.
- Use regular expressions in a contextual add-in.

### **Can't do**

- Use the token provided by **mailbox.getCallbackTokenAsync** to:
	- Update or delete the current item using the Outlook REST API or access any other items in the user's mailbox.
	- Get the current calendar event item using the Outlook REST API.

{90}------------------------------------------------

- Use any of the following APIs.
	- [mailbox.makeEwsRequestAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#methods)
	- [item.addFileAttachmentAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods)
	- [item.addItemAttachmentAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods)
	- [item.bcc.addAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients#outlook-office-recipients-addasync-member(1))
	- [item.bcc.setAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients#outlook-office-recipients-setasync-member(1))
	- [item.body.prependAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body#outlook-office-body-prependasync-member(1))
	- [item.body.setAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body#outlook-office-body-setasync-member(1))
	- [item.body.setSelectedDataAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body#outlook-office-body-setselecteddataasync-member(1))
	- [item.cc.addAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients#outlook-office-recipients-addasync-member(1))
	- [item.cc.setAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients#outlook-office-recipients-setasync-member(1))
	- [item.end.setAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.time#outlook-office-time-setasync-member(1))
	- [item.location.setAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.location#outlook-office-location-setasync-member(1))
	- [item.optionalAttendees.addAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients#outlook-office-recipients-addasync-member(1))
	- [item.optionalAttendees.setAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients#outlook-office-recipients-setasync-member(1))
	- [item.removeAttachmentAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods)
	- [item.requiredAttendees.addAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients#outlook-office-recipients-addasync-member(1))
	- [item.requiredAttendees.setAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients#outlook-office-recipients-setasync-member(1))
	- [item.start.setAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.time#outlook-office-time-setasync-member(1))
	- [item.subject.setAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.subject#outlook-office-subject-setasync-member(1))
	- [item.to.addAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients#outlook-office-recipients-addasync-member(1))
	- [item.to.setAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients#outlook-office-recipients-setasync-member(1))

# **read/write item permission**

Specify **read/write item** permission in the manifest to request this permission. Mail addins activated in compose forms that use write methods (**Message.to.addAsync** or **Message.to.setAsync**) must use at least this level of permission.

### **Can do**

- Read and write all item-level properties of the item that is being viewed or composed in Outlook.
- Add or remove attachments of that item.
- Use all other members of the Office JavaScript API that are applicable to mail addins, except **Mailbox.makeEWSRequestAsync**.

{91}------------------------------------------------

- Use the token provided by **mailbox.getCallbackTokenAsync** to:
	- Update or delete the current item using the Outlook REST API or access any other items in the user's mailbox.
	- Get the current calendar event item using the Outlook REST API.
- Use **mailbox.makeEWSRequestAsync**.

# **read/write mailbox permission**

The **read/write mailbox** permission is the highest level of permission.

In Exchange on-premises environments, the token provided by **mailbox.getCallbackTokenAsync** provides access to use Exchange Web Services (EWS) operations or Outlook REST APIs to do the following:

- Read and write all properties of any item in the user's mailbox.
- Create, read, and write to any folder or item in that mailbox.
- Send an item from that mailbox.

Through **mailbox.makeEwsRequestAsync**, you can access the following EWS operations.

- [CopyItem](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/copyitem-operation)
- [CreateFolder](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/createfolder-operation)
- [CreateItem](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/createitem-operation)
- [FindConversation](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/findconversation-operation)
- [FindFolder](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/findfolder-operation)
- [FindItem](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/finditem-operation)
- [GetConversationItems](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/getconversationitems-operation)
- [GetFolder](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/getfolder-operation)
- [GetItem](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/getitem-operation)
- [MarkAsJunk](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/markasjunk-operation)
- [MoveItem](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/moveitem-operation)
- [SendItem](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/senditem-operation)
- [UpdateFolder](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/updatefolder-operation)
- [UpdateItem](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/updateitem-operation)

Attempting to use an unsupported operation will result in an error response.

### ) **Important**

Legacy Exchange tokens are deprecated. Starting October 2024, legacy Exchange **user identity** and **callback** tokens will begin to be turned off for Exchange Online tenants. For the timeline and details, see our **FAQ page**. This is part of **[Microsoft's](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/)** 

{92}------------------------------------------------

**[Secure Future Initiative](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/)** , which gives organizations the tools needed to respond to the current threat landscape. Exchange user identity tokens will still work for Exchange on-premises. Nested app authentication is the recommended approach for tokens going forward.

### **See also**

- Privacy, permissions, and security for Outlook add-ins

{93}------------------------------------------------

# **Outlook add-in design guidelines**

Article • 02/19/2025

Add-ins are a great way for partners to extend the functionality of Outlook beyond our core feature set. Add-ins enable users to access external experiences, tasks, and content without needing to leave their inbox. Once installed, Outlook add-ins are available on every platform and device.

The following high-level guidelines will help you design and build a compelling add-in, which brings the best of your app right into Outlook on the web, on Windows, on Mac, on Android, and on iOS.

# **Principles**

### **Focus on a few key tasks; do them well**

The best designed add-ins are simple to use, focused, and provide real value to users. Because your add-in will run inside of Outlook, there is additional emphasis placed on this principle. Outlook is a productivity app—it's where people go to get things done.

Your add-in will be an extension of our experience and it's important to make sure the scenarios you enable feel like a natural fit inside Outlook. Think carefully about which of your common use cases will benefit the most from having hooks to them from within our email and calendaring experiences.

### 7 **Note**

Add-ins that interact with the user's calendar, meetings, or appointments are available only if the user opens the calendar in Outlook, not Teams.

An add-in shouldn't attempt to do everything your app does. The focus should be on the most frequently used, and appropriate, actions in the context of Outlook content. Think about your call to action and make it clear what the user should do when your task pane opens.

### **Make it feel as native as possible**

Your add-in should be designed using patterns native to the platform that Outlook is running on. To achieve this, be sure to respect and implement the interaction and visual 

{94}------------------------------------------------

guidelines set forth by each platform. Outlook has its own guidelines and those are also important to consider. A well-designed add-in will be an appropriate blend of your experience, the platform, and Outlook.

This does mean that your add-in will have to visually be different when it runs in Outlook on iOS versus on Android.

### **Make it enjoyable to use and get the details right**

People enjoy using products that are both functionally and visually appealing. You can help ensure the success of your add-in by crafting an experience where you've carefully considered every interaction and visual detail. The necessary steps to complete a task must be clear and relevant. Ideally, no action should be further than a click or two away.

Try not to take a user out of context to complete an action. A user should easily be able to get in and out of your add-in and back to whatever they were doing before. An addin isn't meant to be a destination to spend a lot of time in—it's an enhancement to our core functionality. If done properly, your add-in will help us deliver on the goal of making people more productive.

### **Brand wisely**

We value great branding, and we know it's important to provide users with your unique experience. But we feel the best way to ensure your add-in's success is to build an intuitive experience that subtly incorporates elements of your brand versus displaying persistent or obtrusive brand elements that only distract a user from moving through your system in an unencumbered manner.

A good way to incorporate your brand in a meaningful way is through the use of your brand colors, icons, and voice—assuming these don't conflict with the preferred platform patterns or accessibility requirements. Strive to keep the focus on content and task completion, not brand attention.

#### 7 **Note**

Ads should not be shown within add-ins in Outlook on iOS or on Android.

# **Design patterns**

7 **Note**

{95}------------------------------------------------

While the above principles apply to all endpoints/platforms, the following patterns and examples are specific to mobile add-ins in Outlook on iOS.

To help you create a well-designed add-in, we have templates that contain iOS mobile patterns that work within the Outlook mobile environment. Leveraging these specific patterns will help ensure your add-in feels native to both the iOS platform and Outlook mobile. These patterns are also detailed later in this article. While not exhaustive, this is the start of a library that we'll continue to build upon as we uncover additional paradigms partners wish to include in their add-ins.

### **Overview**

A typical add-in is made up of the following components.

{96}------------------------------------------------

|                                         | ▼ ▲   12:30                     |                    |            | ▼ ▲    12:30                                                   |  |  |
|-----------------------------------------|---------------------------------|--------------------|------------|----------------------------------------------------------------|--|--|
|                                         | ×<br>Contoso                    | Navigation bar     | ×          | Contoso                                                        |  |  |
| Branding area<br>(only on sign in page) | CONTOSO                         | Section title      | Recipients |                                                                |  |  |
|                                         | Sign in to your account         |                    |            | Robin Counts<br>VP sales                                       |  |  |
|                                         | Email or Username               | Cells/input fields |            | Charlotte Walton<br>Sales Director                             |  |  |
|                                         | Password                        |                    |            | Elliot Woodward<br>Graphic Designer                            |  |  |
|                                         |                                 |                    |            | SEE ALL 7 PEOPLE                                               |  |  |
|                                         | SIGN IN                         |                    | Activity   |                                                                |  |  |
|                                         | Don't have an account? Sign up! |                    | ill        | Task: Send year 2018 ideas<br>Next activity: December 17, 2016 |  |  |
|                                         |                                 |                    | E          | Meeting: Conference prep                                       |  |  |
|                                         | © 2017 Contoso Corporation      | Main action        |            | TRACK EMAIL                                                    |  |  |
|                                         | マ<br>O<br>0                     |                    |            | ব<br>O<br>0                                                    |  |  |

### **Loading**

When a user taps on your add-in, the UX should display as quickly as possible. If there is any delay, use a progress bar or activity indicator. A progress bar should be used when the amount of time is determinable and an activity indicator should be used when the amount of time is indeterminable.

#### **An example of loading pages on iOS**

| Progress bar |         |  | Activity indicator |         |  |
|--------------|---------|--|--------------------|---------|--|
|              |         |  |                    |         |  |
| ?            | 9:41 AM |  | ?                  | 9:41 AM |  |
| ×            | Contoso |  |                    | Contoso |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    | 사수      |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |
|              |         |  |                    |         |  |

**An example of loading pages on Android**

{97}------------------------------------------------

### **Sign in/Sign up**

Make your sign in (and sign up) flow straightforward and simple to use.

**An example page to sign in and sign up on iOS**

| Sian up                                                                    |                                   | Sign in                         |  |
|----------------------------------------------------------------------------|-----------------------------------|---------------------------------|--|
| .                                                                          | 9:41 AM<br>Contoso                | 9:41 AM<br>Contoso              |  |
|                                                                            | CONTOSO                           | CONTOSO                         |  |
|                                                                            | Create your account               | Sign in to your account         |  |
|                                                                            | Email or Username                 | Email or Username               |  |
| yourprovider@provider.com                                                  |                                   | yourprovider@provider.com       |  |
| Password                                                                   |                                   | Password                        |  |
| Create a Password                                                          |                                   | Create a Password               |  |
|                                                                            | Sign Up for Free                  | Sign In                         |  |
| By clicking Sign up, I agree to the Terms of Service<br>and Privacy Policy |                                   | Don't have an account? Sign up! |  |
|                                                                            | Already have an account? Sign in! |                                 |  |
|                                                                            |                                   |                                 |  |
|                                                                            | © 2016 Contoso Corporation        | © 2016 Contoso Corporation      |  |

**An example sign in page on Android**

{98}------------------------------------------------

| Sign up                                                              | Sign in                         |
|----------------------------------------------------------------------|---------------------------------|
|                                                                      |                                 |
| 7 4 12:30                                                            | ▼ 4 12:30                       |
| ×                                                                    | Contoso                         |
| Contoso                                                              | ×                               |
| CONTOSO                                                              | CONTOSO                         |
| Create your account                                                  | Sign in to your account         |
| Email or Username                                                    | Email or Username               |
| Password                                                             | Password                        |
|                                                                      |                                 |
| SIGN UP                                                              | SIGN IN                         |
| By signing up, I agree to the Terms of Service<br>and Privacy policy | Don't have an account? Sign up! |
| Already have an account? Sign in!                                    |                                 |
| © 2017 Contoso Corporation                                           | © 2017 Contoso Corporation      |
| ব                                                                    | ব                               |
| O                                                                    |                                 |
|                                                                      | O                               |

### **Brand bar**

The first screen of your add-in should include your branding element. Designed for recognition, the brand bar also helps set context for the user. Because the navigation bar contains the name of your company/brand, it's unnecessary to repeat the brand bar on subsequent pages.

#### **An example of branding on iOS**

| Do                                                                                          | Do                                         | Don't               |  |
|---------------------------------------------------------------------------------------------|--------------------------------------------|---------------------|--|
| Use a white version of your logo and set the<br>background banner to your main brand color. | Stay within 15px margins and 60% coverage. | Go outside margins. |  |
|                                                                                             |                                            |                     |  |
| CONTOSO<br>HS                                                                               |                                            | Inc.                |  |
|                                                                                             | CONTOSO                                    |                     |  |
|                                                                                             | Alpine Ski House                           |                     |  |
|                                                                                             |                                            |                     |  |
|                                                                                             |                                            |                     |  |

#### **An example of branding on Android**

{99}------------------------------------------------

| Do                                                                                          | Do                                         | Don't               |
|---------------------------------------------------------------------------------------------|--------------------------------------------|---------------------|
| Use a white version of your logo and set the background<br>banner to your main brand color. | Stay within 16px margins and 60% coverage. | Go outside margins. |
|                                                                                             |                                            |                     |
| CONTOSO                                                                                     |                                            | Fabrikam, Inc.      |
|                                                                                             | CONTOSO<br>HS                              |                     |
|                                                                                             |                                            |                     |
|                                                                                             | Alpine Ski House name                      |                     |
|                                                                                             |                                            |                     |
|                                                                                             |                                            |                     |
|                                                                                             |                                            |                     |

### **Margins**

Mobile margins should be set to 15px (8% of screen) for each side, to align with Outlook on iOS and 16px for each side to align with Outlook on Android.

# **Typography**

Typography usage is aligned to Outlook on iOS and is kept simple for scannability.

**Typography on iOS**

{100}------------------------------------------------

| Title 1              | Light 28pt   |  |
|----------------------|--------------|--|
| Title 2              | Regular 22pt |  |
| Outlook iOS use only |              |  |
| Body                 | Regular 17pt |  |
| Subhead              | Regular 15pt |  |
| Footnote             | Regular 13pt |  |
| Caption 1            | Regular 12pt |  |

#### **Typography on Android**

| Title 1                  | Medium 20pt   |
|--------------------------|---------------|
| Title 2                  | Semibold 24pt |
| Outlook Android use only |               |
| Subheader                | Medium 14pt   |
| Body 1                   | Regular 16pt  |
| Body 2                   | Reqular 14pt  |
| Caption                  | Regular 12pt  |
| BUTTON                   | MEDIUM 14 PT  |

### **Color palette**

Color usage is subtle in Outlook on iOS. To align, we ask that usage of color is localized to actions and error states, with only the brand bar using a unique color.

{101}------------------------------------------------

| 222222 | Most headlining type               |
|--------|------------------------------------|
|        |                                    |
| 545454 | secondary type                     |
| 8E8E93 | icons only                         |
| gggggg | secondary type                     |
| E1E1E1 | dividers, disabled states          |
| F8F8F8 | form background, section title bar |
| 0075DA | actions,                           |
| E63237 | error states, damaging actions     |

### **Cells**

Since the navigation bar cannot be used to label a page, use section titles to label pages.

#### **Examples of cells on iOS**

| Section title - small     |         |  | Section title - tall  |                           |  |
|---------------------------|---------|--|-----------------------|---------------------------|--|
| ?                         | 9:41 AM |  |                       | 9:41 AM                   |  |
|                           | Contoso |  |                       | Contoso                   |  |
| FOLDERS                   |         |  |                       |                           |  |
| UI Patterns / Notes       |         |  | FOLDERS               |                           |  |
| Outlook Messaging & Ideas |         |  | Ul Patterns / Notes   |                           |  |
| Illustration Concepts     |         |  |                       | Outlook Messaging & Ideas |  |
| Misc Notes                |         |  | Illustration Concepts |                           |  |
|                           |         |  | Misc Notes            |                           |  |
|                           |         |  |                       |                           |  |
|                           |         |  |                       |                           |  |
|                           |         |  |                       |                           |  |
|                           |         |  |                       |                           |  |
|                           |         |  |                       |                           |  |
|                           |         |  |                       |                           |  |
|                           |         |  |                       |                           |  |
|                           |         |  |                       |                           |  |
|                           |         |  |                       |                           |  |
|                           |         |  |                       |                           |  |
|                           |         |  |                       |                           |  |

{102}------------------------------------------------

| ?             | 9:41 AM |  |
|---------------|---------|--|
| ×             | Contoso |  |
| SET TIME      |         |  |
| Specific Time |         |  |
| In 1 Hour     |         |  |
| In 4 Hours    |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |

| ?             | 9:41 AM |  |
|---------------|---------|--|
| ×             | Contoso |  |
|               |         |  |
| SET TIME      |         |  |
| Specific Time |         |  |
| In 1 Hour     |         |  |
| In 4 Hours    |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |
|               |         |  |

|                         | 9:41 AM               |  |
|-------------------------|-----------------------|--|
|                         | Contoso               |  |
| Back<br>(               |                       |  |
| CREATE CONTACT          |                       |  |
|                         | Elliot Woodward       |  |
| Job title               |                       |  |
| Account name<br>Contoso |                       |  |
| Work email              | ewoodward@contoso.com |  |
| Company                 |                       |  |
| Department              |                       |  |
| Mobile number           |                       |  |
| Work number             |                       |  |
| Manager name            |                       |  |
|                         | Save                  |  |

|  |  | ?             |         | 9:41 AM |       |
|--|--|---------------|---------|---------|-------|
|  |  | ×             | Contoso |         |       |
|  |  | SECTION TITLE |         |         |       |
|  |  | Label         | Label   | Label   | Label |
|  |  |               |         |         |       |
|  |  |               |         |         |       |
|  |  |               |         |         |       |
|  |  |               |         |         |       |
|  |  |               |         |         |       |
|  |  |               |         |         |       |
|  |  |               |         |         |       |
|  |  |               |         |         |       |
|  |  |               |         |         |       |
|  |  |               |         |         |       |
|  |  |               |         |         |       |
|  |  |               |         |         |       |
|  |  |               |         |         |       |
|  |  |               |         |         |       |
|  |  |               |         |         |       |
|  |  |               |         |         |       |

{103}------------------------------------------------

| >       |
|---------|
|         |
| Input > |
|         |
|         |
|         |
|         |
| >       |
|         |
|         |

|      | 9:41 AM<br>Contoso |   |
|------|--------------------|---|
|      | 1<br>CONTOSO       |   |
|      | Notebook           | > |
| 1    | Tags               | > |
| யு   | Time               | > |
| ನ್ನಾ | People             | > |
|      |                    |   |
|      |                    |   |
|      |                    |   |
|      |                    |   |
|      |                    |   |
|      |                    |   |
|      |                    |   |
|      |                    |   |

#### **Examples of cells on Android**

| Section title             |       |
|---------------------------|-------|
|                           |       |
|                           | 12:30 |
| Contoso<br>×              |       |
| Folders                   |       |
| UI Patterns / Notes       | >     |
| Outlook Messaging & Ideas |       |
| Illustration Concepts     | 0 0   |
| Misc Notes                |       |
|                           |       |
|                           |       |
|                           |       |
|                           |       |
|                           |       |
|                           |       |
|                           |       |
|                           |       |
| ব                         |       |
|                           |       |

{104}------------------------------------------------

| 30              |
|-----------------|
| Translator<br>× |
| Translate to    |
| Finnish         |
| French          |
| German          |
| Haitian Creole  |
| Hebrew          |
| Hindi           |
| Hmong Daw       |
| French          |
| German          |
|                 |
|                 |

| ×            | Translator     |  | 12:30 |
|--------------|----------------|--|-------|
| Translate to |                |  |       |
| Finnish      |                |  |       |
| French       |                |  |       |
| German       |                |  |       |
|              | Haitian Creole |  |       |
| Hebrew       |                |  |       |
| Hindi        |                |  |       |
|              | Hmong Daw      |  |       |
| French       |                |  |       |
| German       |                |  |       |
|              |                |  |       |
|              | <              |  |       |

|                 | 2:30 |  |  |  |  |  |
|-----------------|------|--|--|--|--|--|
| ×<br>Translator |      |  |  |  |  |  |
| Translate to    |      |  |  |  |  |  |
| Finnish         |      |  |  |  |  |  |
| French          |      |  |  |  |  |  |
| German          |      |  |  |  |  |  |
| Haitian Creole  |      |  |  |  |  |  |
| Hebrew          |      |  |  |  |  |  |
| Hindi           |      |  |  |  |  |  |
| Hmong Daw       |      |  |  |  |  |  |
| French          |      |  |  |  |  |  |
| German          |      |  |  |  |  |  |
|                 |      |  |  |  |  |  |
|                 |      |  |  |  |  |  |

{105}------------------------------------------------

|  | Single-line item<br>Need 20 more pairs of S7s<br>Wrong Graphics |  |
|--|-----------------------------------------------------------------|--|
|  | Focused inbox<br>Line item unselected<br>Line item selected     |  |
|  |                                                                 |  |

|            | Two-line item<br>Secondary text |
|------------|---------------------------------|
| Work Email | rcounts@nimble.com              |
|            | Roger Brown<br>Graphic Desginer |
|            |                                 |
|            | Two-line item<br>Secondary text |
|            | rcounts@nimble.com              |
|            | Work Email<br>Roger Brown       |
|            | Graphic Desginer                |

### **Actions**

Even if your app handles a multitude of actions, think about the most important ones you want your add-in to perform, and concentrate on those.

**Examples of actions on iOS**

{106}------------------------------------------------

|                         | 9:41 AM               |  |
|-------------------------|-----------------------|--|
|                         | Contoso               |  |
| く Back                  |                       |  |
| SET TIME                |                       |  |
|                         | Elliot Woodward       |  |
| Job title               |                       |  |
| Account name<br>Contoso |                       |  |
| Work email              | ewoodward@contoso.com |  |
| Company                 |                       |  |
| Department              |                       |  |
| Mobile number           |                       |  |
| Work number             |                       |  |
| Manager name            |                       |  |
| Manager number          |                       |  |
|                         | Save                  |  |

**Examples of actions on Android**

{107}------------------------------------------------

| × | Nimble                                                                                                                                                   |
|---|----------------------------------------------------------------------------------------------------------------------------------------------------------|
|   | Robin Counts<br>Marketing Director<br>Lead at Nimble                                                                                                     |
|   | Robin Counts is a marketing professional in New<br>York City. She specializes in early development of<br>brands - with special focus in the tech sector. |
|   | ALL 8 SOCIAL BIOS                                                                                                                                        |
|   | Contact Details                                                                                                                                          |
|   | rcounts@nimble.com<br>Work Email                                                                                                                         |
|   | 1 (415) 555-1212<br>Main Phone                                                                                                                           |
|   | New York City, New York                                                                                                                                  |
|   | SAVE                                                                                                                                                     |
|   |                                                                                                                                                          |

| Do       |                                                                                                                               | Do |                                                                                          |
|----------|-------------------------------------------------------------------------------------------------------------------------------|----|------------------------------------------------------------------------------------------|
|          | Anchor actions to the bottom when the amount of<br>content on the screen is unknown (i.e. content may go<br>beyond the fold). |    | Float actions when you can be sure the content on the<br>screen won't go below the fold. |
|          | 12:30                                                                                                                         |    |                                                                                          |
| ×        | Nimble                                                                                                                        | ×  | Nimble                                                                                   |
|          | Contacts in this email                                                                                                        |    | Contacts in this email                                                                   |
|          | Robin Counts<br>rcounts@contoso.com                                                                                           |    | Robin Counts<br>rcounts@contoso.com                                                      |
|          | Charlotte Walton<br>Charlottew@relecloud.com                                                                                  |    | Charlotte Walton<br>Charlottew@relecloud.com                                             |
|          | Elliot Woodward<br>ew@relecloud.com                                                                                           |    | Elliot Woodward<br>ew@relecloud.com                                                      |
|          | SEE ALL 7 PEOPLE                                                                                                              |    | SEE ALL 7 PEOPLE                                                                         |
| Activity |                                                                                                                               |    | TRACK EMAIL                                                                              |
| iiil     | Task: Send year 2018 ideas<br>Next activity: December 17, 2016                                                                |    | SAVE CONTACTS                                                                            |
|          | TRACK EMAIL                                                                                                                   |    |                                                                                          |
|          | SAVE CONTACTS                                                                                                                 |    |                                                                                          |
|          | ব<br>0<br>O                                                                                                                   |    | <<br>O<br>0                                                                              |

### **Buttons**

Buttons are used when there are other UX elements below (vs. actions, where the action is the last element on the screen).

**Examples of buttons on iOS**

{108}------------------------------------------------

| Buttons                                              | Do                                                                         |  |  |
|------------------------------------------------------|----------------------------------------------------------------------------|--|--|
| There are various states of a button. Make sure your | Float use a button if there are other pieces of Ul                         |  |  |
| add-in adheres to the right ones at the given time.  | (including text) you need to display below it.                             |  |  |
|                                                      | 9:41 AM                                                                    |  |  |
| Action                                               | Contoso                                                                    |  |  |
| Button / pressed / primary                           | CONTOSO                                                                    |  |  |
| Action                                               |                                                                            |  |  |
| Button / pressed / primary                           | Create your account                                                        |  |  |
|                                                      | Email or username                                                          |  |  |
| Action                                               | kelly@microsoft.com                                                        |  |  |
| Button / pressed / disabled                          | Label                                                                      |  |  |
| ネに                                                   | Input                                                                      |  |  |
| In progress example (signing in, etc)                | Sign Up for Free                                                           |  |  |
|                                                      | By clicking Sign up, I agree to the Terms of Service<br>and Privacy Policy |  |  |
|                                                      | Already have an account? Sign in!                                          |  |  |
|                                                      |                                                                            |  |  |
|                                                      | @ 2016 Contoso Corporation                                                 |  |  |

#### **Examples of buttons on Android**

| Buttons                                                                                                                                               | Do                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| There are various states of a button. Make sure your<br>add-in adheres to the right ones at the given time. You<br>choose from light and dark themes. | Float use a button if there are other pieces of UI<br>(including text) you need to display below it. |
|                                                                                                                                                       |                                                                                                      |
| Button / primary / default                                                                                                                            | Nimble<br>×                                                                                          |
| NORMAL<br>NORMAL                                                                                                                                      |                                                                                                      |
| Button / primary / pressed                                                                                                                            | Sign in to your account                                                                              |
| PRESSED                                                                                                                                               | Email or Username                                                                                    |
| PRESSED                                                                                                                                               | kelly@microsoft.com                                                                                  |
| Button / primary / disabled                                                                                                                           |                                                                                                      |
| DISABLED                                                                                                                                              | Password                                                                                             |
| DISABLED                                                                                                                                              | ★★★★★★★★★★                                                                                           |
| In progress example (signing in, etc)                                                                                                                 | SIGN IN                                                                                              |
|                                                                                                                                                       | By signing in, I agree to the Terms of Service<br>and Privacy policy                                 |
|                                                                                                                                                       | Don't have an account? Sign up!                                                                      |
|                                                                                                                                                       | @ 2017 Contoso Corporation                                                                           |
|                                                                                                                                                       | <<br>O<br>0                                                                                          |

### **Tabs**

Tabs can aid in content organization.

#### **Examples of tabs on iOS**

{109}------------------------------------------------

| Tabs                              |       |       |       |
|-----------------------------------|-------|-------|-------|
| Pick the one that fits your needs |       |       |       |
|                                   |       |       |       |
| Label                             | Label | Label | Label |
|                                   |       |       |       |
| Label                             |       | Label | Label |
|                                   |       |       |       |
| Label                             |       |       | Label |
|                                   |       |       |       |
|                                   |       |       |       |
|                                   |       |       |       |
|                                   |       |       |       |
|                                   |       |       |       |
|                                   |       |       |       |
|                                   |       |       |       |
|                                   |       |       |       |
|                                   |       |       |       |
|                                   |       |       |       |
|                                   |       |       |       |
|                                   |       |       |       |
|                                   |       |       |       |

#### **Examples of tabs on Android**

| NO. ONE<br>NO. ONE<br>ITEM TWO | ITEM TWO<br>THE THIRD | NO. ONE<br>NO. ONE |          | ITEM TWO  |        |
|--------------------------------|-----------------------|--------------------|----------|-----------|--------|
|                                |                       |                    |          |           |        |
|                                |                       |                    | ITEM TWO | THE THIRD |        |
| NO. ONE<br>ITEM TWO            | THE THIRD<br>THE FO   | NO. ONE            | ITEM TWO | THE THIRD | THE FC |
| Tabs with icons                |                       | Tabs with icons    |          |           |        |
|                                | 国                     |                    |          | 源         |        |

### **Icons**

Icons should follow the current Outlook on iOS design when possible. Use our standard size and color.

#### **Examples of icons on iOS**

{110}------------------------------------------------

#### **Examples of icons on Android**

| Icons                                                 |        |            |        |             |  |
|-------------------------------------------------------|--------|------------|--------|-------------|--|
| Where you can, leverage the material design icon set. |        |            |        |             |  |
|                                                       |        |            |        |             |  |
| add                                                   | files  | attachment | people | images      |  |
|                                                       |        |            | ලා     |             |  |
| more                                                  | Label  | phone      | Link   | Edit        |  |
|                                                       |        |            |        |             |  |
| email                                                 | send   | reply      | folder | search      |  |
|                                                       |        |            |        |             |  |
| clock                                                 | credit | fliter     | marker | description |  |
|                                                       |        | 11         |        |             |  |
| close                                                 | flag   | modify     | cloud  | check       |  |
|                                                       | 0      |            |        |             |  |
| setting                                               | camera | receipt    | delete | font        |  |
|                                                       |        |            |        |             |  |
| block                                                 |        |            |        |             |  |

### **End-to-end examples**

When Outlook mobile add-ins were launched, we worked closely with our partners who were building add-ins. As a way to showcase the potential of their add-ins on Outlook mobile, our designer put together end-to-end flows for each add-in, leveraging our guidelines and patterns.

{111}------------------------------------------------

These examples are meant to highlight the ideal way to approach both the interaction and visual design of an add-in and may not match the exact feature sets in the shipped versions of the add-ins.

### **GIPHY**

#### **An example of GIPHY on iOS**

#### **An example of GIPHY on Android**

{112}------------------------------------------------

### **Nimble**

#### **An example of Nimble on iOS**

| Nimble<br>Robin Counts<br>Marketing Director<br>at Contoso<br>Robin Counts is a marketing professional in |
|-----------------------------------------------------------------------------------------------------------|
|                                                                                                           |
|                                                                                                           |
|                                                                                                           |
|                                                                                                           |
|                                                                                                           |
| New York City. She specializes in early                                                                   |
| development of brands - with special focus in<br>the tech sector.                                         |
|                                                                                                           |
| CONTACT DETAILS                                                                                           |
| Work email<br>rcounts@contoso.com                                                                         |
| Work phone<br>1 (415) 555-1212                                                                            |
| Location<br>New York City, New York                                                                       |
|                                                                                                           |
|                                                                                                           |

#### **An example of Nimble on Android**

| Sign in screen                                                       | Landing screen                               | Detail screen                                                                                                                                            |
|----------------------------------------------------------------------|----------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| ▼ ▲ 12:30                                                            | ▼ ▲ 12:30                                    | ▼ ▲ 12:30                                                                                                                                                |
| ×                                                                    | Nimble                                       | Nimble                                                                                                                                                   |
| Nimble                                                               | ×                                            | ×                                                                                                                                                        |
| ്ട് പ്രസ്തില                                                         | Contacts in this email                       | Robin Counts                                                                                                                                             |
| Sign in to your account                                              | Robin Counts<br>rcounts@contoso.com          | Marketing Director<br>Lead at Nimble                                                                                                                     |
| Email or Username<br>kelly@microsoft.com                             | Charlotte Walton<br>Charlottew@relecloud.com | Robin Counts is a marketing professional in New<br>York City. She specializes in early development of<br>brands - with special focus in the tech sector. |
| Password<br>***********                                              | Elliot Woodward<br>ew@relecloud.com          | ALL 8 SOCIAL BIOS                                                                                                                                        |
|                                                                      |                                              | Contact Details                                                                                                                                          |
| SIGN IN                                                              |                                              | rcounts@nimble.com<br>D<br>Work Email                                                                                                                    |
| By signing in, I agree to the Terms of Service<br>and Privacy policy |                                              | 1 (415) 555-1212<br>ﺮ<br>Main Phone                                                                                                                      |
| Don't have an account? Sign up!                                      |                                              | New York City, New York<br>O                                                                                                                             |
| C 2017 nimble                                                        |                                              | Address                                                                                                                                                  |
| <                                                                    | ব                                            | <1                                                                                                                                                       |
| O                                                                    | O                                            | O                                                                                                                                                        |
| 0                                                                    | 0                                            | 0                                                                                                                                                        |

### **Trello**

**An example of Trello on iOS**

{113}------------------------------------------------

| ?               | 9:41 AM |  |
|-----------------|---------|--|
|                 | Trello  |  |
| く Back          |         |  |
|                 |         |  |
| STARRED BOARDS  |         |  |
| Android         |         |  |
| ios             |         |  |
| Product         |         |  |
| Web             |         |  |
| PERSONAL BOARDS |         |  |
|                 |         |  |
| Remodel         |         |  |
| To-dos          |         |  |
| Trips           |         |  |
|                 |         |  |
|                 |         |  |
|                 |         |  |
|                 |         |  |
|                 |         |  |

|   |                 | 9:41 AM |  |
|---|-----------------|---------|--|
|   |                 | Trello  |  |
| < | Back            |         |  |
|   | STARRED BOARDS  |         |  |
|   | Android         |         |  |
|   | ios             |         |  |
|   | Product         |         |  |
|   | Web             |         |  |
|   | PERSONAL BOARDS |         |  |
|   | Remodel         |         |  |
|   | To-dos          |         |  |
|   | Trips           |         |  |
|   |                 |         |  |
|   |                 |         |  |
|   |                 |         |  |
|   |                 |         |  |

|                                 |        | 9:41 AM |   |        |   |
|---------------------------------|--------|---------|---|--------|---|
|                                 |        | Trello  |   |        |   |
| Back<br><                       |        |         |   |        |   |
| CARD TITLE                      |        |         |   |        |   |
| Scotland Castle info            |        |         |   |        |   |
|                                 |        |         |   |        |   |
|                                 |        |         |   |        |   |
|                                 |        |         |   |        |   |
|                                 |        |         |   |        |   |
|                                 |        |         |   |        |   |
| Done                            |        |         |   |        |   |
| T<br>R<br>Y<br>U<br>W<br>Q<br>- |        |         |   |        |   |
| S<br>A                          | D<br>F | G<br>H  | J | K      | 1 |
| Z<br>◆                          | C<br>X | V<br>B  | N | M      | × |
| 123                             | 0      | space   |   | return |   |

|       |                                                                                |   | 9:41 AM |        |   |   |      |        |
|-------|--------------------------------------------------------------------------------|---|---------|--------|---|---|------|--------|
|       | Trello                                                                         |   |         |        |   |   |      |        |
| <     | Back                                                                           |   |         |        |   |   |      |        |
|       | DESCRIPTION                                                                    |   |         |        |   |   |      |        |
| Skibo | Mom & dad castle info:<br>Dornoch Road<br>Clashmore IV25 3RQ<br>United Kingdom |   |         |        |   |   |      |        |
|       |                                                                                |   |         |        |   |   | Done |        |
| Q     | W                                                                              |   | R       | Y<br>T | U |   | 1    | P      |
| A     | S                                                                              | D | F       | G      | H | J | K    |        |
| ◆     | Z                                                                              | X | C       | V      | B | N | M    |        |
| 123   |                                                                                | 0 | space   |        |   |   |      | return |

| 9:41 AM                                |                      |                |       |  |  |  |
|----------------------------------------|----------------------|----------------|-------|--|--|--|
| Trello                                 |                      |                |       |  |  |  |
| 1 Trollo                               |                      |                |       |  |  |  |
| Board                                  |                      |                | Trips |  |  |  |
| List                                   |                      | Scotland       |       |  |  |  |
| Card Title                             | Scotland Castle info |                |       |  |  |  |
| Description                            | Mom & dad castle     |                |       |  |  |  |
|                                        |                      |                |       |  |  |  |
| Done                                   |                      |                |       |  |  |  |
| Sun 6 Sep                              | 7                    | 57             |       |  |  |  |
| Mon 7 Sep                              | 8                    | 58             |       |  |  |  |
| Tue 8 Sep                              | 9                    | ನ್ನಾಗಿ         | AM    |  |  |  |
| Wed 9 Sep                              | 10                   | 00             |       |  |  |  |
| Thu 10 Sep<br>Fri 11 Sep<br>Sat 12 Sep | 11<br>12<br>13<br>11 | 01<br>02<br>03 | PM    |  |  |  |

{114}------------------------------------------------

| All edits made |                        | Progress on action |                           | Into-bar confirmation                                |                                           |              |              |
|----------------|------------------------|--------------------|---------------------------|------------------------------------------------------|-------------------------------------------|--------------|--------------|
| ?<br>×         | 9:41 AM<br>Trello      | ?<br>×             | 9:41 AM<br>Trello         | ?                                                    | 9:41 AM                                   | ប្រា<br>ー    | L<br>000     |
|                | 19 Trello              |                    | Trello                    | Scotland Trip                                        |                                           |              |              |
| Board          | Trips                  | Board              | Trips                     | 1:01 PM                                              | Ann Wimmer<br>To Kelly Rollin, Eric Hofer |              | 17<br>바      |
| List           | Scotland >             | List               | Scotland                  |                                                      | You replied to this message with GIPHY    |              | ×            |
| Card Title     | Scotland Castle info > | Card Title         | Scotland Castle info<br>> | Skibo                                                |                                           |              |              |
| Description    | Mom & dad castle  >    | Description        | Mom & dad castle<br>>     | Dornoch Road<br>Clashmore IV25 3RQ<br>United Kingdom |                                           |              |              |
| Due Date       | Wed, Sep 09 10:00 AM   | Due Date<br>()     | Wed, Sep 09 10:00 AM      |                                                      |                                           |              |              |
|                | Add card               |                    | 六六                        |                                                      |                                           |              |              |
|                |                        |                    |                           |                                                      |                                           |              |              |
|                |                        |                    |                           | 17                                                   | 16                                        | பி           |              |
|                |                        |                    |                           | D<br>Mail<br>Calendar                                | 을<br>Files                                | ದ್<br>People | O<br>Setting |

#### **An example of Trello on Android**

| Sign in screen                                                       |    | Landing screen                                                                                      |    | Board selection screen                                                                              |
|----------------------------------------------------------------------|----|-----------------------------------------------------------------------------------------------------|----|-----------------------------------------------------------------------------------------------------|
| ▼ ▲   12:30<br>Trello<br>×                                           | ×  | ▼ ▲   12:30<br>Trello                                                                               | ×  | ▼ 4 12:30<br>Trello                                                                                 |
| 0 Trello                                                             | 0  | Board<br>New Properties<br>V                                                                        | 0  | New properties                                                                                      |
| Sign in to your account<br>Email or Username                         | == | List<br>Scotland<br>V                                                                               | == | Remodel<br>Sun Valley                                                                               |
| kelly@microsoft.com                                                  | I  | Card Title<br>Scotland Castle info                                                                  | 0  | Trips                                                                                               |
| Password<br>★★★★★★★★★★★<br>SIGN IN                                   | == | Description<br>Mom & dad Castle info:<br>Skibo, Dornoch Road, Clashmore<br>IV25 3RQ, United Kingdom | == | Description<br>Mom & dad Castle info:<br>Skibo, Dornoch Road, Clashmore<br>IV25 3RQ, United Kingdom |
| By signing in, I agree to the Terms of Service<br>and Privacy policy | O  | Due Date<br>Time<br>09 Sep, 2017<br>5:00 PM                                                         | 0  | Due Date<br>Time<br>09 Sep, 2017<br>5:00 PM                                                         |
| Don't have an account? Sign up!<br>© 2017 Trello                     |    | ADD CARD                                                                                            |    | ADD CARD                                                                                            |
| ব<br>O<br>0                                                          |    | <1<br>O<br>0                                                                                        |    | <<br>O<br>0                                                                                         |

{115}------------------------------------------------

| ×  | Trello                                                     |         |
|----|------------------------------------------------------------|---------|
|    | Board                                                      |         |
|    | Trips                                                      |         |
|    | List                                                       |         |
| == | Scotland                                                   |         |
|    | Card Title                                                 |         |
|    | Scotland Castle info                                       |         |
|    | Description                                                |         |
|    | Mom & dad Castle info:                                     |         |
|    | Skibo, Dornoch Road, Clashmore<br>IV25 3RQ, United Kingdom |         |
|    |                                                            |         |
|    | Due Date                                                   | Time    |
|    | 09 Sep, 2017                                               | 5:00 PM |
|    | ADD CARD                                                   |         |
|    |                                                            |         |
|    | V                                                          |         |
|    |                                                            |         |

| × | Trello                                                                                              |                 |
|---|-----------------------------------------------------------------------------------------------------|-----------------|
|   | Board<br>Trips                                                                                      |                 |
| = | List<br>Scotland                                                                                    |                 |
|   | Card Title<br>Scotland Castle info                                                                  |                 |
|   | Description<br>Mom & dad Castle info:<br>Skibo, Dornoch Road, Clashmore<br>IV25 3RQ, United Kingdom |                 |
|   | Due Date<br>09 Sep, 2017                                                                            | Time<br>5:00 PM |
|   |                                                                                                     |                 |
|   |                                                                                                     |                 |

|  | Info-bar confirmation |
|--|-----------------------|
|  |                       |

### **Dynamics CRM**

#### **An example of Dynamics CRM on iOS**

|            | Landing screen                                                 |  | Landing screen - scrolled |                                  |  |                | Set regarding           |  |
|------------|----------------------------------------------------------------|--|---------------------------|----------------------------------|--|----------------|-------------------------|--|
| ?<br>×     | 9:41 AM<br>Dynamics CRM                                        |  | ?<br>×                    | 9:41 AM<br>Dynamics CRM          |  | ?<br>×         | 9:41 AM<br>Dynamics CRM |  |
|            | Dvnamics CRM                                                   |  |                           | Dynamics CRM                     |  | < Back         |                         |  |
|            |                                                                |  |                           | Next activity: December 17, 2016 |  | WRONG GRAPHICS |                         |  |
| RECIPIENTS |                                                                |  |                           | Meeting: Conference prep         |  | Priority       | High >                  |  |
|            | Robin Counts<br>VP Sales                                       |  | 12                        | Last activity: November 22, 2016 |  | Created on     | 11/28/2016 8:17 PM >    |  |
|            | Charlotte Walton<br>Sales Director                             |  | ACCOUNT                   |                                  |  |                | Set regarding           |  |
|            | Elliot Woodward<br>Graphic Designer                            |  | Contoso                   |                                  |  |                | Open record             |  |
|            |                                                                |  | RECENT CASES              |                                  |  |                |                         |  |
|            | See all 7 people                                               |  | Wrong graphics            |                                  |  |                |                         |  |
| ACTIVITY   |                                                                |  |                           | Need 20 more pairs of S7s        |  |                |                         |  |
| =          | Task: Send year 2018 ideas<br>Next activity: December 17, 2016 |  |                           | RECENT OPPORTUNITIES             |  |                |                         |  |
| 12         | Meeting: Conference prep                                       |  |                           | St. Anton store opening          |  |                |                         |  |
|            | Last activity: November 22, 2016                               |  |                           | Chamonix store opening           |  |                |                         |  |
|            | Track email                                                    |  |                           | Track email                      |  |                |                         |  |

**An example of Dynamics CRM on Android**

{116}------------------------------------------------

|  | Set regarding |  |
|--|---------------|--|
|  |               |  |

| Dynamics CRM<br>×                  |                                     | 12:30 |  |  |
|------------------------------------|-------------------------------------|-------|--|--|
| Wrong Graphics                     |                                     |       |  |  |
| Priotity<br>High                   |                                     |       |  |  |
| Created on<br>Thu, May 25<br>Today | Time<br>5:00 PM<br>Duration: 1 hour |       |  |  |
| SET REGARDING                      |                                     |       |  |  |
| OPEN RECORD                        |                                     |       |  |  |
|                                    |                                     |       |  |  |
|                                    |                                     |       |  |  |
|                                    |                                     |       |  |  |
|                                    |                                     |       |  |  |

{117}------------------------------------------------

# **Activate add-ins with events**

08/01/2025

Event-based activation automatically triggers your add-in to complete their tasks without explicitly launching it. This allows the add-in to validate, insert, or refresh critical content without any manual operations. The add-in is opened in the background to avoid disrupting the user. You can also integrate event-based activation with the task pane and function commands.

### **Overview**

While the particular steps to add event-based functionality to your add-in vary by platform and manifest type, the general flow is as follows.

- 1. Update the manifest with an extension for the event.
- 2. Connect the event in the manifest with a JavaScript function to handle the event.
- 3. Have the event handler function perform its actions, then call event.completed when it finishes.
- 4. Call [Office.actions.associate](https://learn.microsoft.com/en-us/javascript/api/office/office.actions#office-office-actions-associate-member(1)) to connect the event handler function with the ID specified in the manifest.

### **Try out event-based activation**

Discover how to streamline workflows and improve user experiences with event-based activation. Try out the samples to see the feature in action.

### **Outlook samples**

- Automatically set the subject of a new message or appointment
- Automatically check for an attachment before a message is sent
- Automatically update your signature when switching between mail accounts
- [Encrypt attachments, process meeting request attendees, and react to appointment date/time changes](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-encrypt-attachments) [using Outlook event-based activation](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-encrypt-attachments)
- [Set your signature using Outlook event-based activation](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-set-signature)
- [Identify and tag external recipients using Outlook event-based activation](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-tag-external)
- [Verify the color categories of a message or appointment before it's sent using Smart Alerts](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-check-item-categories)
- [Verify the sensitivity label of a message](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-verify-sensitivity-label)

### **Word samples**

- Add headers when a document opens
# **Supported events**

The following tables list events that are currently available and the supported clients for each event. When an event is raised, the handler receives an event object which may include details specific to the type of event. The **Description** column includes a link to the related object where applicable.

{118}------------------------------------------------

### **Excel, PowerPoint, Word events**

ノ **Expand table**

| Event canonical name<br>and add-in only<br>manifest name | Unified manifest for<br>Microsoft 365 name | Description                                                                                        | Supported clients and<br>channels                                                                       |
|----------------------------------------------------------|--------------------------------------------|----------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------|
| OnDocumentOpened                                         | Not yet supported                          | Occurs when a user opens a document or<br>creates a new document, spreadsheet, or<br>presentation. | Windows (Build >=<br>16.0.18324.20032)<br>Office on the web<br>Office on Mac will be<br>available later |

#### **Outlook events**

Support for this feature in Outlook was introduced in [requirement set 1.10](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.10/outlook-requirement-set-1.10), with additional events now available in subsequent requirement sets. The following table lists each event's minimum requirement set and the clients and platforms that support it. For more information on Outlook clients and the requirement sets they support, see [Requirement sets supported by Exchange servers and Outlook clients](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients).

|                                                       |                                            |                                                                                                                        | ノ Expand table                                                                                                              |
|-------------------------------------------------------|--------------------------------------------|------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|
| Event canonical name<br>and add-in only manifest name | Unified manifest for Microsoft<br>365 name | Description                                                                                                            | Minimum<br>requirement<br>set and<br>supported<br>clients                                                                   |
| OnNewMessageCompose                                   | newMessageComposeCreated                   | On composing a new message<br>(includes reply, reply all, and<br>forward) but not on editing, for<br>example, a draft. | 1.10<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI<br>2<br>Android<br>3<br>2 3<br>iOS |
| OnNewAppointmentOrganizer                             | newAppointmentOrganizerCreated             | On creating a new appointment but<br>not on editing an existing one.                                                   | 1.10<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI                                    |

{119}------------------------------------------------

| Event canonical name<br>and add-in only manifest name | Unified manifest for Microsoft<br>365 name | Description                                                                                                                        | Minimum<br>requirement<br>set and<br>supported<br>clients                                                                   |
|-------------------------------------------------------|--------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|
| OnMessageAttachmentsChanged                           | messageAttachmentsChanged                  | On adding or removing attachments<br>while composing a message.<br>Event-specific data object:<br>AttachmentsChangedEventArgs      | 1.11<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI                                    |
| OnAppointmentAttachmentsChanged                       | appointmentAttachmentsChanged              | On adding or removing attachments<br>while composing an appointment.<br>Event-specific data object:<br>AttachmentsChangedEventArgs | 1.11<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI                                    |
| OnMessageRecipientsChanged                            | messageRecipientsChanged                   | On adding or removing recipients<br>while composing a message.<br>Event-specific data object:<br>RecipientsChangedEventArgs        | 1.11<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI<br>2<br>Android<br>3<br>2 3<br>iOS |
| OnAppointmentAttendeesChanged                         | appointmentAttendeesChanged                | On adding or removing attendees<br>while composing an appointment.<br>Event-specific data object:<br>RecipientsChangedEventArgs    | 1.11<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI                                    |
| OnAppointmentTimeChanged                              | appointmentTimeChanged                     | On changing date/time while<br>composing an appointment.<br>Event-specific data object:                                            | 1.11<br>Web<br>browser                                                                                                      |

{120}------------------------------------------------

| Event canonical name<br>and add-in only manifest name | Unified manifest for Microsoft<br>365 name | Description                                                                                                                                                                                                                                                                     | Minimum<br>requirement<br>set and<br>supported<br>clients                                |
|-------------------------------------------------------|--------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|
|                                                       |                                            | AppointmentTimeChangedEventArgs<br>Important: If you drag and drop an<br>appointment to a different date/time<br>slot on the calendar, the<br>OnAppointmentTimeChanged event<br>doesn't occur. It only occurs when<br>the date/time is directly changed<br>from an appointment. | Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI                           |
| OnAppointmentRecurrenceChanged                        | appointmentRecurrenceChanged               | On adding, changing, or removing<br>the recurrence details while<br>composing an appointment. If the<br>date/time is changed, the<br>OnAppointmentTimeChanged event also<br>occurs.<br>Event-specific data object:<br>RecurrenceChangedEventArgs                                | 1.11<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI |
| OnInfoBarDismissClicked                               | infoBarDismissClicked                      | On dismissing a notification while<br>composing a message or<br>appointment item. Only the add-in<br>that added the notification will be<br>notified.<br>Event-specific data object:<br>InfobarClickedEventArgs                                                                 | 1.11<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI |
| OnMessageSend                                         | messageSending                             | On sending a message item. To learn<br>more, try the Smart Alerts<br>walkthrough.                                                                                                                                                                                               | 1.12<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI |
| OnAppointmentSend                                     | appointmentSending                         | On sending an appointment item. To<br>learn more, see Handle<br>OnMessageSend and<br>OnAppointmentSend events in your<br>Outlook add-in with Smart Alerts.                                                                                                                      | 1.12<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )                       |

{121}------------------------------------------------

| Event canonical name<br>and add-in only manifest name | Unified manifest for Microsoft<br>365 name | Description                                                                                                                                                                                           | Minimum<br>requirement<br>set and<br>supported<br>clients                                                                             |
|-------------------------------------------------------|--------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------|
|                                                       |                                            |                                                                                                                                                                                                       | New<br>2<br>Mac UI                                                                                                                    |
| OnMessageCompose                                      | messageComposeOpened                       | On composing a new message<br>(includes reply, reply all, and<br>forward) or editing a draft.                                                                                                         | 1.12<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI                                              |
| OnAppointmentOrganizer                                | appointmentOrganizerOpened                 | On creating a new appointment or<br>editing an existing one.                                                                                                                                          | 1.12<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI                                              |
| OnMessageFromChanged                                  | messageFromChanged                         | On changing the mail account in the<br>From field of a message being<br>composed. To learn more, see<br>Automatically update your signature<br>when switching between Exchange<br>accounts.           | 1.13<br>Web<br>4<br>browser<br>Windows<br>4<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI<br>2<br>Android<br>3<br>2 3<br>iOS |
| OnAppointmentFromChanged                              | appointmentFromChanged                     | On changing the mail account in the<br>organizer field of an appointment<br>being composed. To learn more, see<br>Automatically update your signature<br>when switching between Exchange<br>accounts. | 1.13<br>New<br>2<br>Mac UI                                                                                                            |
| OnSensitivityLabelChanged                             | sensitivityLabelChanged                    | On changing the sensitivity label<br>while composing a message or<br>appointment. To learn how to<br>manage the sensitivity label of a mail<br>item, see Manage the sensitivity                       | 1.13<br>Web<br>4<br>browser<br>Windows<br>4<br>(new                                                                                   |

{122}------------------------------------------------

| Event canonical name<br>and add-in only manifest name | Unified manifest for Microsoft<br>365 name | Description                                                                            | Minimum<br>requirement<br>set and<br>supported<br>clients |
|-------------------------------------------------------|--------------------------------------------|----------------------------------------------------------------------------------------|-----------------------------------------------------------|
|                                                       |                                            | label of your message or<br>appointment in compose mode.                               | and<br>1<br>classic )<br>New                              |
|                                                       |                                            | Event-specific data object:<br>SensitivityLabelChangedEventArgs                        | 2<br>Mac UI                                               |
| OnMessageReadWithCustomAttachment                     | Not available                              | On opening a message that contains<br>a specific attachment type in read<br>mode.      | 5<br>Preview<br>Windows<br>1<br>(classic )                |
| OnMessageReadWithCustomHeader                         | Not available                              | On opening a message that contains<br>a specific internet header name in<br>read mode. | 5<br>Preview<br>Windows<br>1<br>(classic )                |

#### 7 **Note**

 Event-based add-ins in classic Outlook on Windows require a minimum of Windows 10 Version 1903 (Build 18362) or Windows Server 2019 Version 1903 to run. 1

 Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on Mac and on mobile devices. To run this type of add-in on Mac and on mobile platforms, the add-in must first be published to **[AppSource](https://appsource.microsoft.com/)** then deployed in the **Microsoft 365 Admin Center**. For more information, see the "Client and platform support" section of **Office Add-ins with the unified app manifest for Microsoft 365**. 2

 For more information, see **Implement event-based activation in Outlook mobile add-ins**. 3

 The OnMessageFromChanged and OnSensitivityLabelChanged events aren't currently available with the unified manifest for Microsoft 365 in Outlook on the web and the new Outlook on Windows. To handle these events, implement an add-in only manifest instead. For information about the types of manifests, see **Office Add-ins manifest**. 4

 To preview the OnMessageReadWithCustomAttachment and OnMessageReadWithCustomHeader events, you must install classic Outlook on Windows Version 2312 (Build 17110.10000) or later. Then, join the **[Microsoft 365](https://techcommunity.microsoft.com/blog/microsoft365insiderblog/join-the-microsoft-365-insider-program-on-windows/4206638) [Insider program](https://techcommunity.microsoft.com/blog/microsoft365insiderblog/join-the-microsoft-365-insider-program-on-windows/4206638)** and select the **Beta Channel** option to access Office beta builds. 5

#### **Event-based activation in Outlook on mobile devices**

Outlook on mobile supports APIs up to Mailbox requirement set 1.5. However, support is now enabled for additional APIs and features introduced in later requirement sets, such as the OnNewMessageCompose event. To learn more, see Implement event-based activation in Outlook mobile add-ins.

### **Behavior and limitations**

{123}------------------------------------------------

As you develop an event-based add-in, be mindful of the following feature behaviors and limitations.

- Event-based add-ins work only when deployed by an administrator. If users install them directly from AppSource or the Office Store, they will not automatically launch (for workarounds to the AppSource limitation, see AppSource listing options for your event-based add-in). Admin deployments are done by uploading the manifest to the Microsoft 365 admin center.
- APIs that interact with the UI or display UI elements are not supported for Word, PowerPoint, and Excel on Windows. This is because the event handler runs in a JavaScript-only runtime. For more information, see Runtimes in Office Add-ins.
- Event-based add-ins require an internet connection to be able to launch when a specific event occurs. Addin event handlers are expected to be short-running, lightweight, and as noninvasive as possible. After activation, your add-in will time out within approximately 300 seconds, the maximum length of time allowed for running event-based add-ins. To signal that your add-in has completed processing a launch event, your associated event handler must call the [event.completed](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxevent#outlook-office-mailboxevent-completed-member(1)) method. (Note that code included after the event.completed statement isn't guaranteed to run.) Each time an event that your add-in handles is triggered, the add-in is reactivated and runs the associated event handler, and the timeout window is reset. The add-in ends after it times out, or the user closes the compose window or sends the item.
- The behavior of multiple add-ins that subscribe to the same event isn't deterministic. Outlook launches the add-ins in no particular order. For Excel, PowerPoint, and Word, only one random add-in will be activated. For example, if multiple Word add-ins that handle OnDocumentOpened , only one of those handlers will run.
- Currently, only five event-based add-ins can be actively running.
- In all supported Outlook clients, the user must remain on the current mail item where the add-in was activated for it to complete running. Navigating away from the current item (for example, switching to another compose window or tab) terminates the add-in operation. However, an add-in that activates on the OnMessageSend event handles item switching differently depending on which Outlook client it's running on. To learn more, see the "User navigates away from current message" section of Handle OnMessageSend and OnAppointmentSend events in your Outlook add-in with Smart Alerts.
- In addition to item switching, an event-based add-in also ceases operation when the user sends the message or appointment they're composing.

### **Event-based add-in limitations in the new Outlook on Windows**

In the new Outlook on Windows, you must keep the main window of the client open for the add-in to process the mail item. If the main window is minimized, the add-in will pause or stop working.

### **Event-based add-in limitations in Excel, PowerPoint, Word, and classic Outlook on Windows**

When developing an event-based add-in to run on a Windows client, be mindful of the following:

- Imports aren't supported in the JavaScript file where you implement the handling for event-based activation.
- Only the JavaScript file referenced in the manifest is supported for event-based activation. You must bundle your event-handling JavaScript code into this single file. The location of the referenced JavaScript file in the manifest varies depending on the type of manifest your add-in uses.

{124}------------------------------------------------

- **Add-in only manifest**: <Override> child element of the <Runtime> node
- **Unified manifest for Microsoft 365**: "script" property of the "code" object

Note that a large JavaScript bundle may cause issues with the performance of your add-in. We recommend preprocessing heavy operations, so that they're not included in your event-handling code.

- When the JavaScript function specified in the manifest to handle an event runs, code in Office.onReady() and Office.initialize isn't run. We recommend adding any startup logic needed by event handlers, such as checking the user's client version, to the event handlers instead.
### **Event-based add-in limitations in Excel, PowerPoint, and Word**

The following platforms or features are not yet supported.

- Office on Mac
- The unified manifest for Microsoft 365

### **Unsupported APIs**

Some Office.js APIs that change or alter the UI aren't allowed from event-based add-ins. The following are blocked APIs.

| API                         | Methods                                                                                            |
|-----------------------------|----------------------------------------------------------------------------------------------------|
| Office.devicePermission     | requestPermissionsAsync                                                                            |
| Office.context.auth *       | getAccessToken<br>getAccessTokenAsync                                                              |
| Office.context.mailbox      | displayAppointmentForm<br>displayMessageForm<br>displayNewAppointmentForm<br>displayNewMessageForm |
| Office.context.mailbox.item | close                                                                                              |
| Office.context.ui           | displayDialogAsync<br>messageParent                                                                |

#### ノ **Expand table**

#### 7 **Note**

* **[OfficeRuntime.auth](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.auth)** is supported in all versions that support event-based activation and single sign-on (SSO), while **[Office.auth](https://learn.microsoft.com/en-us/javascript/api/office/office.auth)** is only supported in certain Outlook builds. For more information, see **Use single sign-on (SSO) or cross-origin resource sharing (CORS) in your event-based or spam-reporting Outlook add-in**.

{125}------------------------------------------------

### **Preview features in event handlers (classic Outlook on Windows)**

Classic Outlook on Windows includes a local copy of the production and beta versions of Office.js instead of loading from the content delivery network (CDN). By default, the local production copy of the API is referenced. To reference the local beta copy of the API, you must configure your computer's registry. This will enable you to test [preview features](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/outlook-requirement-set-preview) in your event handlers in classic Outlook on Windows.

- 1. In the registry, navigate to
HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\Outlook\Options\WebExt\Developer . If the key doesn't exist, create it.

- 2. Create an entry named EnableBetaAPIsInJavaScript and set its value to 1 .
### **Enable single sign-on (SSO)**

To enable SSO in your event-based add-in, you must add its JavaScript file to a well-known URI. For guidance on how to configure this resource, see Use single sign-on (SSO) or cross-origin resource sharing (CORS) in your event-based or spam-reporting Office Add-in.

### **Request external data**

You can request external data by using an API like [Fetch](https://developer.mozilla.org/docs/Web/API/Fetch_API) or by using [XMLHttpRequest (XHR)](https://developer.mozilla.org/docs/Web/API/XMLHttpRequest) , a standard web API that issues HTTP requests to interact with servers.

#### 7 **Note**

If your add-in will operate in a JavaScript-only runtime, use absolute URLs in your Fetch API calls. Relative URLs in Fetch API calls aren't supported in a JavaScript-only runtime.

Be aware that you must use additional security measures when using XMLHttpRequest objects, requiring [Same](https://developer.mozilla.org/docs/Web/Security/Same-origin_policy) [Origin Policy](https://developer.mozilla.org/docs/Web/Security/Same-origin_policy) and [CORS (Cross-Origin Resource Sharing)](https://developer.mozilla.org/docs/Web/HTTP/CORS) .

#### 7 **Note**

Full CORS support is available in Office on the web, Mac, and Windows (starting in Version 2201, Build 16.0.14813.10000) clients.

To make CORS requests from your event-based add-in, you must add the add-in and its JavaScript file to a wellknown URI. For guidance on how to configure this resource, see Use single sign-on (SSO) or cross-origin resource

{126}------------------------------------------------

### **Troubleshoot your add-in**

As you develop your event-based add-in, you may need to troubleshoot issues, such as your add-in not loading or the event not occurring. For guidance on how to troubleshoot an event-based add-in, see Troubleshoot eventbased and spam-reporting add-ins.

### **Deploy your add-in**

Event-based add-ins are restricted to admin-managed deployments only, even if they're acquired from AppSource. If users acquire the add-in from AppSource or the in-app Office Store, they won't be able to activate the event-based function of the add-in. To learn more about listing your event-based add-in in AppSource, see AppSource listing options for your event-based add-in.

Admin deployments are done by uploading the manifest to the Microsoft 365 admin center. To do so, follow these steps.

- 1. In the admin portal, expand the **Settings** section in the navigation pane then select **Integrated apps**.
- 2. On the **Integrated apps** page, choose the **Upload custom apps** action.

#### ) **Important**

Add-ins that use the **Smart Alerts feature** can only be published to AppSource if the manifest's send mode property is set to the **prompt user** or **soft block** option. If an add-in's send mode property is set to **block**, it can only be deployed by an organization's admin as it will fail AppSource validation.

For more information about how to deploy an add-in, please refer to [Deploy and publish Office Add-ins in the](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/office-addins) [Microsoft 365 admin center.](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/office-addins)

### **Deploy manifest updates**

Because event-based add-ins are deployed by admins, any change you make to the manifest requires admin consent through the Microsoft 365 admin center. Until the admin accepts your changes, users in their organization are blocked from using the add-in. To learn more about the admin consent process, see Admin consent for installing event-based add-ins.

{127}------------------------------------------------

### **See also**

- Troubleshoot event-based and spam-reporting add-ins
- Debug event-based and spam-reporting add-ins
- AppSource listing options for your event-based add-in
- Handle OnMessageSend and OnAppointmentSend events in your Outlook add-in with Smart Alerts

{128}------------------------------------------------

# **Handle OnMessageSend and OnAppointmentSend events in your Outlook add-in with Smart Alerts**

07/31/2025

The OnMessageSend and OnAppointmentSend events take advantage of Smart Alerts, which allows you to run logic after a user selects **Send** in their Outlook message or appointment. With Smart Alerts, users of your add-in can take the opportunity to improve the content of their email, add a missing sensitivity label, or include an important recipient in a meeting invite.

Smart Alerts is available through the event-based activation feature. To understand how to configure your add-in to use this feature, use other available events, debug your add-in, and more, see Activate add-ins with events.

#### 7 **Note**

The OnMessageSend and OnAppointmentSend events were introduced in **[requirement set](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.12/outlook-requirement-set-1.12) [1.12](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.12/outlook-requirement-set-1.12)**. Additional functionality and customization options were also added to subsequent requirement sets. To verify that your Outlook client supports these events and features, see **Supported clients and platforms** and the specific sections in the **walkthrough** that describe the features you want to implement.

### **Supported clients and platforms**

The following table lists supported client-server combinations for the Smart Alerts feature, including the minimum required Exchange Server Cumulative Update where applicable. Excluded combinations aren't supported.

| Client                     | Exchange<br>Online | Exchange Server<br>Subscription<br>Edition (SE) | Exchange 2019 on<br>premises<br>(Cumulative Update<br>12 or later) | Exchange 2016 on<br>premises<br>(Cumulative Update<br>22 or later) |
|----------------------------|--------------------|-------------------------------------------------|--------------------------------------------------------------------|--------------------------------------------------------------------|
| Web browser<br>(modern UI) | Yes                | Not applicable                                  | Not applicable                                                     | Not applicable                                                     |
| new Outlook on<br>Windows  | Yes                | Not applicable                                  | Not applicable                                                     | Not applicable                                                     |

{129}------------------------------------------------

| Client                                                                  | Exchange<br>Online | Exchange Server<br>Subscription<br>Edition (SE) | Exchange 2019 on<br>premises<br>(Cumulative Update<br>12 or later) | Exchange 2016 on<br>premises<br>(Cumulative Update<br>22 or later) |
|-------------------------------------------------------------------------|--------------------|-------------------------------------------------|--------------------------------------------------------------------|--------------------------------------------------------------------|
| Windows (classic)<br>Version 2206<br>(Build<br>15330.20196) or<br>later | Yes                | Yes                                             | Yes                                                                | Yes                                                                |
| Mac<br>Version 16.65<br>(22082700) or<br>later                          | Yes                | Not applicable                                  | Not applicable                                                     | Not applicable                                                     |
| Android                                                                 | Not<br>applicable  | Not applicable                                  | Not applicable                                                     | Not applicable                                                     |
| iOS                                                                     | Not<br>applicable  | Not applicable                                  | Not applicable                                                     | Not applicable                                                     |

#### ) **Important**

Enhancements to the Smart Alerts feature were introduced in later requirement sets. Because of this, the minimum supported Outlook version and build may vary. The requirement sets and versions needed for a feature are mentioned in the **walkthrough** and applicable sections of this article.

# **Try out Smart Alerts in an event-based add-in**

To see Smart Alerts in action, try out the walkthrough. You'll create an add-in that checks whether a document or picture is attached to a message before it's sent. In addition to implementing a basic Smart Alerts add-in, you'll also learn about the following functionalities to further enhance the user experience of your add-in.

- Customize the Smart Alerts dialog message using Markdown
- Customize the text of a dialog button
- Open a task pane or run a function from the dialog
- Override the send mode option at runtime
- Programmatically send the mail item once it meets your add-in's conditions

# **Smart Alerts feature behavior and scenarios**

{130}------------------------------------------------

The following sections include guidance on the send mode options and the behavior of the feature in certain scenarios.

### **Available send mode options**

When you configure your add-in to respond to the OnMessageSend or OnAppointmentSend event, you must include the send mode property in the manifest. Its markup varies depending on the type of manifest your add-in uses.

- **Add-in only manifest**: Set the **SendMode** property of the [LaunchEvent](https://learn.microsoft.com/en-us/javascript/api/manifest/launchevent) element.
- **Unified manifest for Microsoft 365**: Set the "sendMode" option of the event object in the ["autoRunEvents"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/element-extensions#autorunevents) array.

If the conditions implemented by your add-in aren't met or your add-in is unavailable when the event occurs, a dialog is shown to the user to alert them that additional actions may be needed before the mail item can be sent. The send mode property determines the options available to the user in the dialog.

The following table lists the available send mode options.

ノ **Expand table**

| Send mode option canonical | Add-in only manifest | Unified manifest for Microsoft 365 |
|----------------------------|----------------------|------------------------------------|
| name                       | name                 | name                               |
| prompt user                | PromptUser           | promptUser                         |
| soft block                 | SoftBlock            | softBlock                          |
| block                      | Block                | block                              |

#### **Tip**

Starting in **[Mailbox requirement set 1.14](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.14/outlook-requirement-set-1.14)**, your add-in can now override its send mode option at runtime. To learn more, see **Override the send mode option at runtime (optional)**.

#### **prompt user**

If the item doesn't meet the add-in's conditions, the user can choose **Send Anyway** in the alert, or address the issue then try to send the item again. If the add-in is taking a long time to process the item, the user will be prompted with the option to stop running the add-in and

{131}------------------------------------------------

choose **Send Anyway**. In the event the add-in is unavailable (for example, there's an error loading the add-in), the item will be sent.

| Outlook Smart Alerts add-in                            |  |
|--------------------------------------------------------|--|
| Looks like you're forgetting to include an attachment. |  |
| Don't Send<br>15                                       |  |

Use the **prompt user** option in your add-in if one of the following applies.

- The condition checked by the add-in isn't mandatory, but is nice to have in the message or appointment being sent.
- You'd like to recommend an action and allow the user to decide whether they want to apply it to the message or appointment being sent.

Some scenarios where the **prompt user** option is applied include suggesting to tag the message or appointment as low or high importance and recommending to apply a color category to the item.

### **soft block**

Default option if the send mode property of your manifest isn't configured. The user is alerted that the item they're sending doesn't meet the add-in's conditions and they must address the issue before trying to send the item again. However, if the add-in is unavailable (for example, there's an error loading the add-in), the item will be sent.

|  | Outlook Smart Alerts add-in                            |  |
|--|--------------------------------------------------------|--|
|  | Looks like you're forgetting to include an attachment. |  |
|  | Don't Send                                             |  |

Use the **soft block** option in your add-in when you want a condition to be met before a message or appointment can be sent, but you don't want the user to be blocked from sending the item if the add-in is unavailable. Sample scenarios where the **soft block** option is used include prompting the user to set a message or appointment's importance level and checking that the appropriate signature is applied before the item is sent.

### **block**

The item isn't sent if any of the following situations occur.

{132}------------------------------------------------

- The item doesn't meet the add-in's conditions.
- The add-in is unable to connect to the server.
- There's an error loading the add-in.

|  | Outlook Smart Alerts add-in                            |  |
|--|--------------------------------------------------------|--|
|  |                                                        |  |
|  | Looks like you're forgetting to include an attachment. |  |
|  | Don't Send                                             |  |
|  |                                                        |  |

Use the **block** option if the add-in's conditions are mandatory, even if the add-in is unavailable. For example, the **block** option is ideal when users are required to apply a sensitivity label to a message or appointment before it can be sent.

### **Add-in is unavailable**

If the add-in is unavailable when a message or appointment is being sent (for example, an error occurs that prevents the add-in from loading), the user is alerted. The options available to the user differ depending on the send mode option applied to the add-in.

If the **prompt user** or **soft block** option is used, the user can choose **Send Anyway** to send the item without the add-in checking it, or **Try Later** to let the item be checked by the add-in when it becomes available again.

If the **block** option is used, the user can't send the item until the add-in becomes available.

{133}------------------------------------------------

If a Smart Alerts add-in that implements the **send mode override** feature can't complete processing an event due to an error or is unavailable when the event occurs, it uses the send mode option specified in the manifest.

### **Long-running add-in operations**

If the add-in runs for more than five seconds, but less than five minutes, the user is alerted that the add-in is taking longer than expected to process the message or appointment.

If the **prompt user** option is used, the user can choose **Send Anyway** to send the item without the add-in completing its check. Alternatively, the user can select **Don't Send** to stop the addin from processing.

However, if the **soft block** or **block** option is used, the user will not be able to send the item until the add-in completes processing it.

|  | Outlook Smart Alerts add-in                                                        |  |
|--|------------------------------------------------------------------------------------|--|
|  | Outlook Dogfood add-in is taking longer than expected.<br>Processing<br>Don't Send |  |

OnMessageSend and OnAppointmentSend add-ins should be short-running and lightweight. To avoid the long-running operation dialog, use other events to process conditional checks before the OnMessageSend or OnAppointmentSend event is activated. For example, if the user is required to encrypt attachments for every message or appointment, consider using the OnMessageAttachmentsChanged or OnAppointmentAttachmentsChanged event to perform the check.

### **Add-in timed out**

If the add-in runs for five minutes or more, it will time out. If the **prompt user** option is used, the user can choose **Send Anyway** to send the item without the add-in completing its check. Alternatively, the user can choose **Don't Send**.

{134}------------------------------------------------

| Outlook Smart Alerts add-in     | ×          |
|---------------------------------|------------|
| Outlook Smart Alerts timed out. |            |
| Send Anyway                     | Don't Send |

If the **soft block** or **block** option is used, the user can't send the item until the add-in completes its check. The user must attempt to send the item again to reactivate the add-in.

| Outlook Smart Alerts add-in     |            |
|---------------------------------|------------|
| Outlook Smart Alerts timed out. |            |
|                                 | Don't Send |

### **Intermittent or no internet connection**

Event-based add-ins, including Smart Alerts add-ins, require an internet connection to launch. This section describes how an add-in behaves when Outlook is launched without connectivity, when Outlook experiences intermittent connectivity, and when the Work Offline mode, if applicable to the Outlook client, is turned on.

### **Offline when Outlook launches**

When Outlook launches without internet connectivity, it's unable to determine which add-ins are installed. Because of this, Smart Alerts add-ins can't activate when the OnMessageSend or OnAppointmentSend events occur. In this scenario, to ensure that all mail items are checked for compliance before they're sent, administrators can configure policies in their organization. The policy to be set varies depending on the Outlook client.

#### Windows (classic)

Configure the **Block send when web add-ins can't load** Group Policy setting. When the setting is turned on, mail items are moved to the **Drafts** folder when the **Send** button is selected. This way, when Outlook is able to load add-ins, any installed Smart Alerts add-ins can run checks on the items before they're sent.

To turn on the setting, perform the following:

{135}------------------------------------------------

- 1. Download the latest [Administrative Templates tool](https://www.microsoft.com/download/details.aspx?id=49030) .
- 2. Open the **Local Group Policy Editor** (**gpedit.msc**).
- 3. Navigate to **User Configuration** > **Administrative Templates** > **Microsoft Outlook 2016** > **Security** > **Trust Center**.
- 4. Open the **Block send when web add-ins can't load** setting.
- 5. In the dialog that appears, select **Enabled**.
- 6. Select **OK** or **Apply** to save your change.

### **Intermittent connection**

#### 7 **Note**

In classic Outlook on Windows and on Mac, the behavior of a Smart Alerts add-in is different while in **[Work Offline mode](https://support.microsoft.com/office/f3a1251c-6dd5-4208-aef9-7c8c9522d633)** . For more information, see **Outlook client in Work Offline mode**.

If Outlook was able to load any Smart Alerts add-ins that are installed, but loses connection when a send event occurs, the behavior differs depending on the send mode option implemented by the add-in.

If the **prompt user** or **soft block** option is used, the following behavior applies.

- **Send Anyway** option is selected: The message is moved to the **Outbox** folder. When a connection is reestablished, the message is automatically sent.
- **Don't Send** option is selected: The message is saved to the **Drafts** folder. This prevents the message from being automatically sent when a connection is reestablished. When Outlook is back online and the user selects **Send**, the Smart Alerts add-in is activated.

If the **block** option is used, the message is saved to the **Drafts** folder and a dialog is shown to the user notifying them to reconnect. This prevents the message from being automatically sent when a connection is reestablished. When Outlook is back online and the user selects **Send**, the Smart Alerts add-in is activated.

### **Outlook client in Work Offline mode**

In Outlook on Windows (classic client starting in Version 2310 (Build 16913.10000)) and on Mac (starting in Version 16.80 (23121017)), a Smart Alerts add-in that implements the **soft block** or **block** option can only process a mail item while the Outlook client is online. If [Work Offline](https://support.microsoft.com/office/f3a1251c-6dd5-4208-aef9-7c8c9522d633) [mode](https://support.microsoft.com/office/f3a1251c-6dd5-4208-aef9-7c8c9522d633) is turned on in the Outlook client when a mail item is sent, the item isn't saved to the

{136}------------------------------------------------

**Outbox** folder and the user is alerted that they must deactivate Work Offline mode before they can attempt to send their item.

If the Smart Alerts add-in implements the **prompt user** option, it doesn't process mail items while Work Offline mode is turned on. The item is saved to the **Outbox** folder instead.

### **User navigates away from current message**

When a user navigates away from the message they're sending (for example, to read a message in their inbox), the behavior of a Smart Alerts add-in differs between Outlook clients. Select the tab for the Outlook client on which the add-in is running.

Web / Windows

#### **Message composed in a window**

#### 7 **Note**

In classic Outlook on Windows, the behavior described in this section applies to Version 2402 (Build 17310.10000) and later.

If a message is being composed in a separate window, such as a new message, and a user navigates away from it after they select **Send**, the Smart Alerts add-in will continue to process the message in the background. If additional actions are needed before the message can be sent, the appropriate Smart Alerts dialog is shown to the user (see Available send mode options).

### **Message composed in the Reading Pane**

If a reply, forward, or existing draft is being composed in the Outlook Reading Pane, and a user navigates away from it after they select **Send**, a dialog with options is shown to the

{137}------------------------------------------------

user. The options available depend on the send mode option implemented by the add-in.

If the prompt user send mode option is implemented, the following options are shown.

- **Wait**: This option opens the message being composed in a new window, so that the Smart Alerts add-in can continue to process it. If the user navigates away from the newly opened window during processing, the add-in will continue to process the message in the background (to learn more, see Message composed in a window). If additional actions are needed before a message can be sent, the appropriate Smart Alerts dialog is shown to the user.
- **Send Anyway**: This option terminates the add-in operation and sends the message.

#### ) **Important**

In Outlook on the web and new Outlook on Windows, the **Send Anyway** option may not appear in the item-switch dialog even if the add-in currently running implements the **prompt user** send mode option. This is because the **Send Anyway** option is shown only if all installed Smart Alerts add-ins implement the **prompt user** send mode option. Otherwise, only the **Wait** and **Save as Draft** options are shown. This helps provide a more secure experience since multiple Smart Alerts add-ins can launch in any order (for more information on this behavior, see **Event-based activation behavior and limitations**).

- **Save as Draft**: This option terminates the add-in and send operations and saves a draft of the message to the mailbox's **Drafts** folder.
#### **Outlook on the web and new Outlook on Windows**

**Classic Outlook on Windows**

{138}------------------------------------------------

If the soft block or block send mode option is implemented, only the **Wait** and **Save as Draft** options are shown.

**Outlook on the web and new Outlook on Windows**

# **Activate Smart Alerts in applications that use Simple MAPI**

#### 7 **Note**

This feature is currently only supported in classic Outlook on Windows starting in Version 2301 (Build 17126.20004).

Users can send mail items through certain applications that use [Simple MAPI](https://learn.microsoft.com/en-us/previous-versions/windows/desktop/windowsmapi/simple-mapi), even if the Outlook client isn't running at the time the item is sent. When this occurs, any installed Smart 

{139}------------------------------------------------

Alerts add-in won't activate to check the mail item for compliance.

To ensure that outgoing items meet the conditions of your Smart Alerts add-in before they're sent, you must turn on the **Running Outlook for Simple MAPI Mail Sending** Group Policy setting on every applicable machine in your organization.

### **Behavior when the setting is turned on**

When the **Running Outlook for Simple MAPI Mail Sending** setting is set to **Enabled**, users are required to have their Outlook client running at the time a mail item is sent in the following scenarios.

- A file is sent as an attachment through the **Share** > **Attach a copy instead** option in Excel, Word, or PowerPoint.
- A file is sent as an attachment through the **Send to** > **Mail recipient** option in File Explorer.

{140}------------------------------------------------

| test |                                                                                        |                                                                                  |
|------|----------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|
|      | Open<br>Edit<br>Print<br>Add to Favorites<br>Scan with Microsoft Defender<br>Open with |                                                                                  |
|      | Give access to<br>Copy as path<br>Share<br>15<br>Restore previous versions             |                                                                                  |
|      | Send to<br>Cut<br>Copy                                                                 | ><br>Bluetooth device<br>Compressed (zipped) folder<br>Desktop (create shortcut) |
|      | Create shortcut<br>Delete<br>Rename                                                    | Documents<br>Mail recipient                                                      |
|      | Properties                                                                             |                                                                                  |

- A file is sent through an application that uses Simple MAPI, which opens a new message Outlook window.
If a user's Outlook client isn't running at the time the mail item is sent, a dialog is shown to notify them that they must open their client to send the item.

### **Behavior when the setting is turned off or not configured**

When the **Running Outlook for Simple MAPI Mail Sending** setting is set to **Disabled** or **Not Configured** in your organization, any user who uses applications that implement Simple MAPI to send mail items will be able to do so without activating their Smart Alerts add-in for compliance checks.

### **Configure the Group Policy setting**

By default, the **Running Outlook for Simple MAPI Mail Sending** setting is set to **Not Configured**. To turn on the setting, perform the following:

- 1. Download the latest [Administrative Templates tool](https://www.microsoft.com/download/details.aspx?id=49030) .
- 2. Open the **Local Group Policy Editor** (**gpedit.msc**).

{141}------------------------------------------------

- 3. Navigate to **User Configuration\Administrative Templates\Microsoft Outlook 2016\Miscellaneous**.
- 4. Open the **Running Outlook for Simple MAPI Mail Sending** setting.
- 5. In the dialog that appears, select **Enabled**.
- 6. Select **OK** or **Apply** to save your change.

# **Limitations**

Because the OnMessageSend and OnAppointmentSend events are supported through the eventbased activation feature, the same feature limitations apply to add-ins that activate as a result of these events. For a description of these limitations, see Event-based activation behavior and limitations.

In addition to these constraints, be mindful of the following:

- Only one instance each of the OnMessageSend and OnAppointmentSend event can be declared in the manifest. If you require multiple OnMessageSend or OnAppointmentSend events, you must declare each one in a separate add-in.
- The Smart Alerts dialog message must be 500 characters or less. While you can change the message and certain aspects of a button in the Smart Alerts dialog, the following can't be customized.
	- The dialog's title bar. Your add-in's name is always displayed there.
	- The font or color of the dialog message. However, you can use Markdown to format certain elements of your message. For a list of supported elements, see Limitations to formatting the dialog message using Markdown.
	- The icon next to the dialog message.
	- Dialogs that provide information on event processing and progress. For example, the text and options that appear in the timeout and long-running operation dialogs can't be changed.
- In Outlook on the web and in new Outlook on Windows, the OnAppointmentSend event only occurs when a meeting is sent from a separate window. The event doesn't occur when a meeting is sent from an embedded meeting form or when a meeting is forwarded.

### **Limitations to formatting the dialog message using Markdown**

7 **Note**

{142}------------------------------------------------

Support for Markdown in a Smart Alerts dialog was introduced in **[requirement set 1.15](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.15/outlook-requirement-set-1.15)**. Learn more about its **[supported clients and platforms](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#outlook-client-support)**.

You can use Markdown to format the message of a Smart Alerts dialog through the errorMessageMarkdown option of the event.completed call. However, only the following elements are supported.

- Bold, italic, or bold and italic text. Both the [asterisk (*) and underscore (_) formats](https://www.markdownguide.org/basic-syntax/#emphasis) are supported.

```
JavaScript
event.completed({
 allowEvent: false,
 ...
 errorMessageMarkdown: "**Important**: Apply the appropriate sensitivity
label to your message before sending."
});
```
- Bulleted or unordered lists. To create an item in the list, begin with a dash ( ) or asterisk ( * ), add the content, then append \r to signify item completion.

```
JavaScript
event.completed({
 allowEvent: false,
 ...
 errorMessageMarkdown: "Your email doesn't meet company guidelines.\n\nFor
additional assistance, contact the IT Service Desk:\n\n- Phone number: 425-
555-0102\r- Email: it@contoso.com\r- Website: [Contoso IT Service Desk]
(https://www.contoso.com/it-service-desk)\r"
});
```

{143}------------------------------------------------

- Numbered or ordered lists. To create an item in the list, begin with a number followed by a period, add the content, then append \r to signify item completion. The first item of the list must start with the number one ( 1. ) and the succeeding numbers must be in numerical order.

```
JavaScript
event.completed({
 allowEvent: false,
 ...
 errorMessageMarkdown: "Help your recipients know your intentions when you
send a mail item. To set the sensitivity level of an item:\n\n1. Select
**File** > **Properties**.\r2. From the **Sensitivity** dropdown, select
**Normal**, **Personal**, **Private**, or **Confidential**.\r3. Select
**Close**.\r"
});
```
- Links. To create a link, enclose your link text in square brackets ( [] ), then enclose the HTTPS URL in parentheses ( () ). You must provide an HTTPS URL, otherwise it won't render as a link that a user can select from the dialog. The angle brackets format ( <> ) isn't supported.

{144}------------------------------------------------

```
JavaScript
```

```
event.completed({
 allowEvent: false,
 ...
 errorMessageMarkdown: "Need onsite assistance on the day of your meeting?
Visit the [Contoso Facilities](https://www.contoso.com/facilities/meetings)
page to learn more."
});
```
- New lines. Use \n\n to create a new line.

```
JavaScript
event.completed({
 allowEvent: false,
 ...
 errorMessageMarkdown: "Add a personalized user avatar to your signature
today!\n\nTo customize your signature, visit [Customize my email signature]
(https://www.fabrikam.com/marketing/customize-email-signature)."
});
```
### **Tip**

To escape characters in your message, such as an asterisk, add a backslash ( \ ) before the character.

# **Best practices**

{145}------------------------------------------------

The Smart Alerts feature ensures that all outgoing mail items are compliant with the information protection policies of an organization and helps users improve their messages through recommendations. To ensure your add-in always provides users with a smooth and efficient sending experience, observe the following guidelines.

- **Don't let your add-in further delay the send operation**. Smart Alerts add-ins must be short-running and lightweight. Avoid overloading the OnMessageSend and OnAppointmentSend event handlers with heavy validations. To prevent this, preprocess information when other events occur, such as the OnMessageRecipientsChanged or OnMessageAttachmentsChanged event. To determine which events your add-in can respond to, see the "Supported events" section of Activate add-ins with events.
- **Don't implement additional dialogs**. Prevent overwhelming your users with too many dialogs. Instead, customize the text in the Smart Alerts dialog to convey information. If needed, you can also customize the text and functionality of certain dialog buttons to provide users with additional information and functionality through a task pane or function.
- **Enable the appropriate Group Policy settings in your organization**. To ensure that your Smart Alerts add-in activates on each mail item, including those sent using applications that implement Simple MAPI, configure the **Running Outlook for Simple MAPI Sending** setting. To learn more about this setting, see Activate Smart Alerts in applications that use Simple MAPI.

# **Debug your add-in**

For guidance on how to troubleshoot your Smart Alerts add-in, see Troubleshoot event-based and spam-reporting add-ins.

# **Deploy to users**

Similar to other event-based add-ins, add-ins that use the Smart Alerts feature must be deployed by an organization's administrator. For guidance on how to deploy your add-in via the Microsoft 365 admin center, see the "Deploy to users" section in Activate add-ins with events.

#### ) **Important**

Add-ins that use the Smart Alerts feature can only be published to AppSource if the manifest's **send mode property** is set to the **soft block** or **prompt user** option. If an addin's send mode property is set to **block**, it can only be deployed by an organization's

{146}------------------------------------------------

admin as it will fail AppSource validation. To learn more about publishing your eventbased add-in to AppSource, see **AppSource listing options for your event-based add-in**.

# **Differences between Smart Alerts and the on-send feature**

While Smart Alerts and the on-send feature provide your users the opportunity to improve their messages and meeting invites before they're sent, Smart Alerts is a newer feature that offers you more flexibility with how you prompt your users for further action. Key differences between the two features are outlined in the following table.

| Attribute                               | Smart Alerts                                                                   | On-send                                                                                         |
|-----------------------------------------|--------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------|
| Minimum<br>supported<br>requirement set | Mailbox 1.12                                                                   | Mailbox 1.8                                                                                     |
| Supported<br>Outlook clients            | Windows (new and classic)<br>Web browser (modern UI)<br>Mac (new UI)           | Windows (new and classic)<br>Web browser (modern<br>and classic UI)<br>Mac (new and classic UI) |
| Supported<br>manifest types             | Unified manifest for Microsoft 365<br>Add-in only manifest                     | Add-in only manifest                                                                            |
| Supported events                        | Add-in only manifest<br>OnMessageSend<br>OnAppointmentSend                     | ItemSend                                                                                        |
|                                         | Unified manifest for Microsoft 365<br>"messageSending"<br>"appointmentSending" |                                                                                                 |
| Manifest<br>extension<br>property       | Add-in only manifest<br>LaunchEvent                                            | Events                                                                                          |
|                                         | Unified manifest for Microsoft 365                                             |                                                                                                 |

{147}------------------------------------------------

| Attribute                                                | Smart Alerts                                                                                                                                                                                       | On-send                                                                                                                                                             |
|----------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                                          | "autoRunEvents"                                                                                                                                                                                    |                                                                                                                                                                     |
| Supported send<br>mode options                           | prompt user<br>soft block<br>block<br>To learn more about each option, see Available                                                                                                               | Block                                                                                                                                                               |
|                                                          | send mode options.                                                                                                                                                                                 |                                                                                                                                                                     |
| Maximum number<br>of supported<br>events in an add<br>in | One OnMessageSend and one OnAppointmentSend<br>event.                                                                                                                                              | One ItemSend event.                                                                                                                                                 |
| Add-in<br>deployment                                     | Add-in can be published to AppSource if its<br>send mode property is set to the soft block or<br>prompt user option. Otherwise, the add-in must<br>be deployed by an organization's administrator. | Add-in can't be published to<br>AppSource. It must be deployed<br>by an organization's<br>administrator.                                                            |
| Additional<br>configuration for<br>add-in installation   | No additional configuration is needed once the<br>manifest is uploaded to the Microsoft 365 admin<br>center.                                                                                       | Depending on the<br>organization's compliance<br>standards and the Outlook client<br>used, certain mailbox policies<br>must be configured to install the<br>add-in. |

# **See also**

- Activate add-ins with events
- AppSource listing options for your event-based add-in
- [Office Add-ins code sample: Office Add-ins code sample: Verify the color categories of a](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-check-item-categories) [message or appointment before it's sent using Smart Alerts](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-check-item-categories)
- [Office Add-ins code sample: Verify the sensitivity label of a message](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-verify-sensitivity-label)

{148}------------------------------------------------

# **Implement event-based activation in Outlook mobile add-ins**

08/01/2025

With the event-based activation feature, develop an add-in to automatically activate and complete operations when certain events occur in Outlook on Android or on iOS, such as composing a new message.

The following sections walk you through how to develop an Outlook mobile add-in that automatically adds a signature to new messages being composed. This highlights a sample scenario of how you can implement event-based activation in your mobile add-in. Significantly enhance the mobile user experience by exploring other scenarios and supported events in your add-in today.

To learn how to implement an event-based add-in for Outlook on the web, on Windows ([new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) and classic), and on Mac, see Activate add-ins with events.

7 **Note**

Outlook on Android and on iOS only support up to Mailbox requirement set 1.5. However, to support the event-based activation feature, some APIs from later requirement sets have been enabled on mobile clients. For more information on this exception, see **Additional supported APIs**.

# **Supported events and clients**

| Event canonical name and<br>add-in only manifest<br>name | Unified app manifest for<br>Microsoft 365 name | Description                                                                                                      | Supported<br>clients                                                            |
|----------------------------------------------------------|------------------------------------------------|------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
| OnNewMessageCompose                                      | newMessageComposeCreated                       | Occurs on composing a new<br>message (includes reply,<br>reply all, and forward), but<br>not on editing a draft. | Android<br>(Version<br>4.2352.0<br>and<br>later)<br>iOS<br>(Version<br>4.2352.0 |

{149}------------------------------------------------

| Event canonical name and<br>add-in only manifest<br>name | Unified app manifest for<br>Description<br>Microsoft 365 name |                                                                                                                                                                                                       | Supported<br>clients                                                                             |
|----------------------------------------------------------|---------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|
|                                                          |                                                               |                                                                                                                                                                                                       | and<br>later)                                                                                    |
| OnMessageRecipientsChanged                               | messageRecipientsChanged                                      | Occurs on adding or<br>removing recipients while<br>composing a message.<br>Event-specific data object:<br>RecipientsChangedEventArgs                                                                 | Android<br>(Version<br>4.2425.0<br>and<br>later)<br>iOS<br>(Version<br>4.2425.0<br>and<br>later) |
| OnMessageFromChanged                                     | messageFromChanged                                            | Occurs on changing the mail<br>account in the From field of<br>a message being composed.<br>To learn more, see<br>Automatically update your<br>signature when switching<br>between Exchange accounts. | Android<br>(Version<br>4.2502.0<br>and<br>later)<br>iOS<br>(Version<br>4.2502.0<br>and<br>later) |

# **Set up your environment**

To run the feature, you must have a supported version of Outlook on Android or on iOS (see Supported events and clients) and a Microsoft 365 subscription. Then, complete the Outlook quick start in which you create an add-in project with the Yeoman generator for Office Add-ins.

# **Configure the manifest**

The steps for configuring the manifest depend on which type of manifest you selected in the quick start.

|  |  | Unified app manifest for Microsoft 365 |
|--|--|----------------------------------------|
|--|--|----------------------------------------|

7 **Note**

{150}------------------------------------------------

- When developing an event-based add-in to run in Outlook on Android and on iOS, note that the unified manifest for Microsoft 365 can only be used if the add-in handles certain events. To learn which events are supported, see **Supported events and clients**.
- Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on mobile devices. To run this type of add-in on mobile platforms, the add-in must first be published to **[AppSource](https://appsource.microsoft.com/)** then deployed in the **Microsoft 365 Admin Center**. For more information, see **Support for add-ins with the unified manifest for Microsoft 365**.
- 1. Configure the ["extensions.runtimes"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array?view=m365-app-prev&preserve-view=true) property just as you would for setting up a function command. For details, see Configure the runtime for the function command.
- 2. In the ["extensions.ribbons.contexts"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array#contexts) array, add mailRead as an item. When you're finished, the array should look like the following.

```
JSON
"contexts": [
 "mailRead"
],
```
- 3. In the ["extensions.ribbons.requirements.formFactors"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/requirements-extension-element#formfactors) array, add "mobile" as an item. When you're finished, the array should look like the following.

```
JSON
"formFactors": [
 "mobile",
 <!-- Typically there will be other form factors listed. -->
]
```
- 4. Add the following ["autoRunEvents"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/element-extensions#autorunevents) array as a property of the object in the ["extensions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root#extensions) array.

```
JSON
"autoRunEvents": [
]
```

{151}------------------------------------------------

- 5. Add an object like the following to the "autoRunEvents" array. Note the following about this code:
	- The "events" property maps handlers to events.
	- The "events.type" must be one of the types listed at Supported events and clients.
	- The value of the "events.actionId" is the name of a function that you create in Implement the event handler.
	- You can have more than one object in the "events" array.

```
JSON
 {
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox",
 "minVersion": "1.5"
 }
 ],
 "scopes": [
 "mail"
 ]
 },
 "events": [
 {
 "type": "newMessageComposeCreated",
 "actionId": "onNewMessageComposeHandler"
 },
 ]
 }
```
#### **Tip**

To learn more about manifests for Outlook add-ins, see **Office Add-ins manifest** and **Add support for add-in commands in Outlook on mobile devices**.

# **Implement the event handler**

To enable your add-in to complete tasks when the OnNewMessageCompose event occurs, you must implement a JavaScript event handler. In this section, you'll create the onNewMessageComposeHandler function that adds a signature to a new message being composed, then shows a message to notify that the signature was added.

{152}------------------------------------------------

- 1. From the same quick start project, navigate to the **./src** directory, then create a new folder named **launchevent**.
- 2. In the **./src/launchevent** folder, create a new file named **launchevent.js**.
- 3. Open the **launchevent.js** file you created and add the following JavaScript code.

```
JavaScript
/*
* Copyright (c) Microsoft Corporation. All rights reserved. Licensed under
the MIT license.
* See LICENSE in the project root for license information.
*/
// Add start-up logic code here, if any.
Office.onReady();
function onNewMessageComposeHandler(event) {
 const item = Office.context.mailbox.item;
 const signatureIcon = 
"iVBORw0KGgoAAAANSUhEUgAAACcAAAAnCAMAAAC7faEHAAAAAXNSR0IArs4c6QAAAARnQU1BAACx
jwv8YQUAAAAzUExURQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAKMFRskAAAAQdFJOUwAQIDBAUGBwgI+fr7/P3+8jGoKKAAAACXBIWXMAAA7DAAAOwwHHb6
hkAAABT0lEQVQ4T7XT2ZalIAwF0DAJhMH+/6+tJOQqot6X6joPiouNBo3w9/Hd6+hrYnUt6vhLcjE
AJevVW0zJxABSlcunhERpjY+UKoNN5+ZgDGu2onNz0OngjP2FM1VdyBW1LtvGeYrBLs7U5I1PTXZt
+zifcS3Icw2GcS3vxRY3Vn/iqx31hUyTnV515kdTfbaNhZLI30AceqDiIo4tyKEmJpKdP5M4um+nU
wfDWxAXdzqMNKQ14jLdL5ntXzxcRF440mhS6yu882Kxa30RZcUIjTCJg7lscsR4VsMjfX9Q0Vuv/W
d3YosD1J4LuSRtaL7bzXGN1wx2cytUdncDuhA3fu6HPTiCvpQUIjZ3sCcHVbvLtbNTHlysx2w9/s2
7m9gEb+7CTri6hR1wcTf2gVf3wBRe3CMbcHYvTODkXhnD0+178K/pZ9+n/C1ru/2HAPwAo7YM1X4+
tLMAAAAASUVORK5CYII=";
 // Get the sender's account information.
 item.from.getAsync((result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.log(result.error.message);
 event.completed();
 return;
 }
 // Create a signature based on the sender's information.
 const name = result.value.displayName;
 const options = { asyncContext: name, isInline: true };
 item.addFileAttachmentFromBase64Async(signatureIcon, 
"signatureIcon.png", options, (result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.log(result.error.message);
 event.completed();
 return;
 }
 // Add the created signature to the message.
 const signature = "<img src='cid:signatureIcon.png'>" +
```

{153}------------------------------------------------

```
result.asyncContext;
 item.body.setSignatureAsync(signature, { coercionType:
Office.CoercionType.Html }, (result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.log(result.error.message);
 event.completed();
 return;
 }
 // Show a notification when the signature is added to the
message.
 const notification = {
 type:
Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,
 message: "Company signature added.",
 icon: "none",
 persistent: false 
 };
 item.notificationMessages.addAsync("signature_notification",
notification, (result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.log(result.error.message);
                event.completed();
                return;
 }
 event.completed();
 });
 });
 });
 });
}
```
- 4. Save your changes.
# **Add a reference to the event-handling JavaScript file**

Ensure that the **./src/commands/commands.html** file has a reference to the JavaScript file that contains your event handler.

- 1. Navigate to the **./src/commands** folder, then open **commands.html**.
- 2. Immediately before the closing **head** tag ( </head> ), add a script entry for the JavaScript file that contains the event handler.

HTML

{154}------------------------------------------------

- 3. Save you changes.
# **Test and validate your add-in**

- 1. Follow the guidance to test and validate your add-in.
- 2. Sideload your add-in in Outlook on Windows (new or classic), on Mac, or on the web.
- 3. Open Outlook on Android or on iOS. If you have Outlook already open on your device, restart it.
- 4. Create a new message. The event-based add-in adds the signature to the message. If you have a signature saved on your mobile device, it will briefly appear in the message you create, but will be immediately replaced by the signature added by the add-in.

| New message<br>0<br>×         |   |
|-------------------------------|---|
| Company signature added.<br>0 | × |
| To                            |   |
| Subject                       |   |
| General                       |   |
| Adele Vance                   |   |

# **Behavior and limitations**

As you develop an event-based add-in for Outlook mobile, be mindful of the following feature behaviors and limitations.

- Because event-based add-ins are expected to be short-running and lightweight, an addin is allowed to run for a maximum of 60 seconds from the time it activates. To signal that your add-in has completed processing an event, your event handler must call the [event.completed](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxevent#outlook-office-mailboxevent-completed-member(1)) method. The add-in operation also ends when the user closes the compose window or sends the message.

{155}------------------------------------------------

- Only one add-in can run at a time. If multiple event-based add-ins are installed on a user's account, they will run sequentially.
- If you tap and hold the Outlook icon on your mobile device, then select **New mail** to create a new message, an event-based add-in that handles the OnNewMessageCompose event may take a few seconds to initialize and complete processing the event.
- When using an event-based add-in that handles the OnNewMessageCompose event, if there are no changes made to a new message being composed, a draft won't be saved. This applies even if the add-in adds a signature using the [Office.context.mailbox.item.body.setSignatureAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body#outlook-office-body-setsignatureasync-member(1)) method.
- In an event-based add-in that manages signatures when the OnNewMessageCompose event occurs, if you select **Reply** from the bottom of a message, the add-in activates and adds the signature to the message. However, the signature won't be visible in the current view. To view your message with the added signature, expand the compose window to full screen.
- To enhance your add-in's functionality, you can use supported APIs from later requirement sets in compose mode. For more information, see Additional supported APIs.

# **Additional supported APIs**

Although Outlook mobile supports APIs up to [Mailbox requirement set 1.5](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.5/outlook-requirement-set-1.5), to further extend the capability of your event-based add-in in Outlook mobile, additional APIs from later requirement sets are now supported in compose mode.

- [Office.context.mailbox.item.addFileAttachmentFromBase64Async](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messagecompose#outlook-office-messagecompose-addfileattachmentfrombase64async-member(1))
- [Office.context.mailbox.item.disableClientSignatureAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messagecompose#outlook-office-messagecompose-disableclientsignatureasync-member(1))
- [Office.context.mailbox.item.from.getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.from#outlook-office-from-getasync-member(1))
- [Office.context.mailbox.item.getComposeTypeAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messagecompose#outlook-office-messagecompose-getcomposetypeasync-member(1))
- [Office.context.mailbox.item.body.setSignatureAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body#outlook-office-body-setsignatureasync-member(1))
- [Office.context.mailbox.item.sessionData](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messagecompose#outlook-office-messagecompose-sessiondata-member)

To learn more about APIs that are supported in Outlook on mobile devices, see Outlook JavaScript APIs supported in Outlook on mobile devices.

# **Deploy to users**

Event-based add-ins must be deployed by an organization's administrator. For guidance on how to deploy your add-in via the Microsoft 365 admin center, see the "Deploy your add-in" section of Activate add-ins with events.

# **See also**

{156}------------------------------------------------

- Activate add-ins with events
- Add-ins for Outlook on mobile devices
- Add mobile support to an Outlook add-in
- Outlook JavaScript APIs supported in Outlook on mobile devices

{157}------------------------------------------------

# **Automatically set the subject of a new message or appointment**

08/06/2025

Need to add a required disclaimer to all your messages? With an event-based add-in, content is automatically added to new messages or appointments. Your users can focus on writing, instead of compliance.

The following sections teach you how to develop an add-in that handles the OnNewMessageCompose and OnNewAppointmentOrganizer events. By the end of this walkthrough, you'll have an add-in that automatically sets the subject of new messages and appointments being created.

#### 7 **Note**

- The OnNewMessageCompose and OnNewAppointmentOrganizer events were introduced in **[requirement set 1.10](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.10/outlook-requirement-set-1.10)**. To verify that your Outlook client supports these events, see **[Requirement sets supported by Exchange servers and Outlook clients](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients)**.
- The OnNewMessageCompose event is now supported in Outlook on mobile devices. To learn how to implement this event in your Outlook mobile add-in, see **Implement event-based activation in Outlook mobile add-ins**.

### **Set up your environment**

Complete the Outlook quick start which creates an add-in project with the Yeoman generator for Office Add-ins.

# **Configure the manifest**

To configure the manifest, select the tab for the type of manifest you're using.

Unified manifest for Microsoft 365

#### 7 **Note**

Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on Mac and on mobile devices. To run this type of add-in on Mac and on

{158}------------------------------------------------

mobile platforms, the add-in must first be published to **[AppSource](https://appsource.microsoft.com/)** then deployed in the **Microsoft 365 Admin Center**. For more information, see the "Client and platform support" section of **Office Add-ins with the unified app manifest for Microsoft 365**.

- 1. Open the **manifest.json** file.
- 2. Navigate to the ["authorization.permissions.resourceSpecific"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-authorization-permissions#resourcespecific) array. In the array object, replace the value of the "name" property with "MailboxItem.ReadWrite.User" . This is needed by the add-in to be able to set the subject of the mail item.

```
JSON
...
"authorization": {
 "permissions": {
 "resourceSpecific": [
 {
 "name": "MailboxItem.ReadWrite.User",
 "type": "Delegated"
 }
 ]
 }
},
...
```
- 3. Add the following object to the ["extensions.runtimes"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array?view=m365-app-prev&preserve-view=true) array. Note the following about this markup:
	- The "minVersion" of the Mailbox requirement set is configured to "1.10" as this is the lowest version of the requirement set that supports the OnNewMessageCompose and OnNewAppointmentOrganizer events.
	- The "id" of the runtime is set to the descriptive name "autorun_runtime" .
	- The "code" property has a child "page" property that is set to an HTML file and a child "script" property that is set to a JavaScript file. You'll create or edit these files in later steps. Office uses one of these values depending on the platform.
		- Office on Windows executes the event handlers in a JavaScript-only runtime, which loads a JavaScript file directly.
		- Office on Mac and on the web, and [new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) execute the handlers in a browser runtime, which loads an HTML file. That file, in turn, contains a <script> tag that loads the JavaScript file.

{159}------------------------------------------------

For more information, see Runtimes in Office Add-ins.

- The "lifetime" property is set to "short" , which means that the runtime starts up when one of the events is triggered and shuts down when the handler completes. (In certain rare cases, the runtime shuts down before the handler completes. See Runtimes in Office Add-ins.)
- There are two types of ["actions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-actions-item) that can run in the runtime. You'll create functions to correspond to these actions in a later step.

```
JSON
{
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox",
 "minVersion": "1.10"
 }
 ]
 },
 "id": "autorun_runtime",
 "type": "general",
 "code": {
 "page": "https://localhost:3000/commands.html",
 "script": "https://localhost:3000/launchevent.js"
 },
 "lifetime": "short",
 "actions": [
 {
 "id": "onNewMessageComposeHandler",
 "type": "executeFunction",
 "displayName": "onNewMessageComposeHandler"
 },
 {
 "id": "onNewAppointmentComposeHandler",
 "type": "executeFunction",
 "displayName": "onNewAppointmentComposeHandler"
 }
 ]
}
```
- 4. Add the following ["autoRunEvents"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/element-extensions#autorunevents) array as a property of the object in the ["extensions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root#extensions) array.
JSON "autoRunEvents": [

{160}------------------------------------------------

- 5. Add the following object to the "autoRunEvents" array. The "events" property maps handlers to events as described in the table earlier in this article. The handler names must match those used in the "id" properties of the objects in the "actions" array in an earlier step.

```
JSON
 {
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox",
 "minVersion": "1.10"
 }
 ],
 "scopes": [
 "mail"
 ]
 },
 "events": [
 {
 "type": "newMessageComposeCreated",
 "actionId": "onNewMessageComposeHandler"
 },
 {
 "type": "newAppointmentOrganizerCreated",
 "actionId": "onNewAppointmentComposeHandler"
 }
 ]
 }
```
#### **Tip**

]

- To learn about runtimes in add-ins, see **Runtimes in Office Add-ins**.
- To learn more about manifests for Outlook add-ins, see **Office Add-in manifests**.

# **Implement event handling**

- 1. From the same quick start project, create a new folder named **launchevent** under the **./src** directory.
- 2. In the **./src/launchevent** folder, create a new file named **launchevent.js**.

{161}------------------------------------------------

- 3. Open the file **./src/launchevent/launchevent.js** in your code editor and add the following JavaScript code.

```
JavaScript
/*
* Copyright (c) Microsoft Corporation. All rights reserved. Licensed under
the MIT license.
* See LICENSE in the project root for license information.
*/
function onNewMessageComposeHandler(event) {
 setSubject(event);
}
function onNewAppointmentComposeHandler(event) {
 setSubject(event);
}
function setSubject(event) {
 Office.context.mailbox.item.subject.setAsync(
 "Set by an event-based add-in!",
 {
 "asyncContext": event
 },
 function (asyncResult) {
 // Handle success or error.
 if (asyncResult.status !== Office.AsyncResultStatus.Succeeded) {
 console.error("Failed to set subject: " + 
JSON.stringify(asyncResult.error));
 }
 // Call event.completed() to signal to the Outlook client that the add-
in has completed processing the event.
 asyncResult.asyncContext.completed();
 });
}
// IMPORTANT: To ensure your add-in is supported in Outlook, remember to map
the event handler name specified in the manifest to its JavaScript
counterpart.
Office.actions.associate("onNewMessageComposeHandler",
onNewMessageComposeHandler);
Office.actions.associate("onNewAppointmentComposeHandler",
onNewAppointmentComposeHandler);
```
- 4. Save your changes.
#### 7 **Note**

- There are some limitations you must be aware of when developing an event-based add-in for classic Outlook on Windows. To learn more, see **Event-based activation**

{162}------------------------------------------------

**behavior and limitations**.

- To ensure your add-in runs as expected when an event occurs, call Office.actions.associate in the JavaScript file where your handlers are implemented. This maps the event handler name specified in the manifest to its JavaScript counterpart. The location of the handler name in the manifest differs depending on the type of manifest your add-in uses.
	- **Unified manifest for Microsoft 365**: The value specified in the **["actionId"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-auto-run-events-array-events#actionid)** property of the applicable **["autoRunEvents.events"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-auto-run-events-array-events)** object.
	- **Add-in only manifest**: The function name specified in the applicable **[LaunchEvent](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#launchevent)** element.

# **Update the commands HTML file**

- 1. In the **./src/commands** folder, open **commands.html**.
- 2. Immediately before the closing **head** tag ( </head> ), add a script entry to include the event-handling JavaScript code.

HTML <script type="text/javascript" src="../launchevent/launchevent.js"></script>

- 3. Save your changes.
# **Update webpack config settings**

- 1. Open the **webpack.config.js** file found in the root directory of the project and complete the following steps.
- 2. Locate the plugins array within the config object and add this new object at the beginning of the array.

```
JavaScript
new CopyWebpackPlugin({
 patterns: [
 {
 from: "./src/launchevent/launchevent.js",
 to: "launchevent.js",
 },
```

{163}------------------------------------------------

- ], }),
- 3. Save your changes.

# **Try it out**

- 1. Run the following commands in the root directory of your project. When you run npm start , the local web server will start (if it's not already running) and your add-in will be sideloaded.

| command line  |
|---------------|
| npm run build |
|               |
| command line  |
| npm start     |
|               |
|               |

#### 7 **Note**

- When you first use Yeoman generator to develop an Office Add-in, your default browser opens a window where you'll be prompted to sign in to your Microsoft 365 account. If a sign-in window doesn't appear and you encounter a sideloading or login timeout error, run atk auth login m365 before running npm start again.
If your add-in wasn't automatically sideloaded, follow the instructions in **Sideload Outlook add-ins for testing** to manually sideload the add-in in Outlook.

2. In Outlook on the web or in new Outlook on Windows, create a new message.

{164}------------------------------------------------

| > Send                        | 0  | Attach V |         | യ Insert V |    |      |     | Sensitivity |      | E | Discard |    |    |              |  |                         |  |
|-------------------------------|----|----------|---------|------------|----|------|-----|-------------|------|---|---------|----|----|--------------|--|-------------------------|--|
| To                            |    |          |         |            |    |      |     |             |      |   |         |    |    |              |  | Всс                     |  |
| Cc                            |    |          |         |            |    |      |     |             |      |   |         |    |    |              |  |                         |  |
| Set by an event-based add-in! |    |          |         |            |    |      |     |             |      |   |         |    |    |              |  |                         |  |
| Sent from Outlook             |    |          |         |            |    |      |     |             |      |   |         |    |    |              |  |                         |  |
| AA<br>S                       | AS | B        | I       | U          | 0  | A    | త్ర | ලිටු        | 三    | = | ←三      | →三 | リフ | lilli  Milli |  |                         |  |
| Send                          | >  |          | Discard |            | 01 | Qy V |     | 1000        | (22) | A |         |    |    |              |  | Draft saved at 11:00 AM |  |

- 3. In Outlook on the new Mac UI, create a new message.

| 000       | Set by an event-based add-in! • adelev@M365x535783.onmicrosoft.com          |             |  |  |  |  |  |  |  |
|-----------|-----------------------------------------------------------------------------|-------------|--|--|--|--|--|--|--|
| Send<br>A | A Editor<br>同<br>Discard<br>V Attach<br>A Signature<br>Sensitivity<br>><br> |             |  |  |  |  |  |  |  |
| From:     | Adele Vance (adelev@M365x535783.onmicrosoft.com) >                          | く           |  |  |  |  |  |  |  |
| To:       |                                                                             | Cc Bcc      |  |  |  |  |  |  |  |
| Subject:  | Priority ><br>Set by an event-based add-in!                                 |             |  |  |  |  |  |  |  |
| Calibri   | I<br>×2<br>: △~<br>U ab & v x2<br>0 11<br>는 두 후 후 프<br>り 図・つ ■・<br>B        | A� 卷 品 ▼ ∞∞ |  |  |  |  |  |  |  |
|           |                                                                             |             |  |  |  |  |  |  |  |
|           |                                                                             |             |  |  |  |  |  |  |  |
|           |                                                                             |             |  |  |  |  |  |  |  |
|           |                                                                             |             |  |  |  |  |  |  |  |

- 4. In classic Outlook on Windows, create a new message.

{165}------------------------------------------------

| 間ですぐ<br>। >               | Q<br>Untitled - Message (HTML)<br>Search       | 4      | B      |              |
|---------------------------|------------------------------------------------|--------|--------|--------------|
| File<br>Message<br>Insert | Format Text<br>Options<br>Review<br>Help       |        |        |              |
| E<br>S<br>>               | Q + A<br>B<br>I<br>വ<br>><br><br>><br>><br>নির | 0<br>> | S<br>> | 2 -<br><br>V |
| To<br>D                   |                                                |        |        |              |
| Send<br>Cc                |                                                |        |        |              |
| Bcc                       |                                                |        |        |              |
| Subject                   | Set by an event-based add-in!                  |        |        |              |
|                           |                                                |        |        |              |
|                           |                                                |        |        | P            |
| ব                         |                                                |        |        | ▶            |

- 5. When you want to stop the local web server and uninstall the add-in, follow the applicable instructions:
	- To stop the server, run the following command. If you used npm start , the following command should also uninstall the add-in.

| command line |  |  |  |  |  |
|--------------|--|--|--|--|--|
| npm stop     |  |  |  |  |  |

- If you manually sideloaded the add-in, see Remove a sideloaded add-in.
# **Next steps**

To learn more about event-based activation and other events that you can implement in your add-in, see Activate add-ins with events

# **See also**

- Activate add-ins with events
- [Office Add-ins code sample: Set your signature using Outlook event-based activation](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-set-signature)

{166}------------------------------------------------

# **Automatically check for an attachment before a message is sent**

08/26/2025

Never miss attaching an important document or photo to your message ever again. With an event-based add-in, your messages are automatically checked for attachments before they're sent, so that you can feel assured that you're always sending a complete version.

The following sections walk you through how to develop an event-based add-in that implements Smart Alerts to handle the OnMessageSend event. By the end of this walkthrough, your add-in will automatically check for an attached document or picture mentioned in the message and alert you if it's missing before the message is sent.

#### 7 **Note**

The OnMessageSend and OnAppointmentSend events were introduced in **[requirement set](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.12/outlook-requirement-set-1.12) [1.12](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.12/outlook-requirement-set-1.12)**. Additional functionality and customization options were also added to subsequent requirement sets. To verify that your Outlook client supports these events and features, see **Supported clients and platforms** and the specific sections that describe the features you want to implement.

# **Set up your environment**

Before you start the walkthrough, verify that your Outlook client supports the Smart Alerts feature. For guidance, see Supported clients and platforms.

Then, complete the Outlook quick start, which creates an add-in project with the Yeoman generator for Office Add-ins.

# **Configure the manifest**

To configure the manifest, select the tab for the type of manifest you are using.

Unified manifest for Microsoft 365

7 **Note**

{167}------------------------------------------------

Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on Mac. To run this type of add-in on Mac, the add-in must first be published to **[AppSource](https://appsource.microsoft.com/)** then deployed in the **Microsoft 365 Admin Center**. For more information, see **Support for add-ins with the unified manifest for Microsoft 365**.

- 1. Open the **manifest.json** file.
- 2. Add the following object to the ["extensions.runtimes"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array?view=m365-app-prev&preserve-view=true) array. Note the following about this markup:
	- Although the OnMessageSend event was introduced in requirement set 1.12, the "minVersion" is set to "1.15" . This supports the use of Smart Alerts enhancements that were introduced in later requirement sets.
	- The "id" of the runtime is set to the descriptive name "autorun_runtime" .
	- The "code" property has a child "page" property that is set to an HTML file and a child "script" property that is set to a JavaScript file. You'll create or edit these files in later steps. Office uses one of these values or the other depending on the platform.
		- Classic Outlook on Windows executes the event handler in a JavaScript-only runtime, which loads a JavaScript file directly.
		- Outlook on the web, on Mac, and on [new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) execute the handler in a browser runtime, which loads an HTML file. That file, in turn, contains a <script> tag that loads the JavaScript file. For more information, see Runtimes in Office Add-ins.
	- The "lifetime" property is set to "short" , which means that the runtime starts up when the event is triggered and shuts down when the handler completes. (In certain rare cases, the runtime shuts down before the handler completes. See Runtimes in Office Add-ins.)
	- There is an action to run a handler for the OnMessageSend event. You'll create the handler function in a later step.

```
JSON
```

```
{
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox",
 "minVersion": "1.15"
 }
 ]
 },
 "id": "autorun_runtime",
 "type": "general",
```

{168}------------------------------------------------

```
 "code": {
 "page": "https://localhost:3000/commands.html",
 "script": "https://localhost:3000/launchevent.js"
 },
 "lifetime": "short",
 "actions": [
 {
 "id": "onMessageSendHandler",
 "type": "executeFunction",
 "displayName": "onMessageSendHandler"
 }
 ]
}
```
- 3. Add the following ["autoRunEvents"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/element-extensions#autorunevents) array as a property of the object in the ["extensions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root#extensions) array.

```
JSON
"autoRunEvents": [
]
```
- 4. Add the following object to the "autoRunEvents" array. Note the following about this code:
	- The event object assigns a handler function to the OnMessageSend event (using the event's unified manifest name, "messageSending" , as described in the supported events table). The function name provided in "actionId" must match the name used in the "id" property of the object in the ["actions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-actions-item) array in an earlier step.
	- The "sendMode" option is set to "softBlock" . This means that if the message doesn't meet the conditions that the add-in sets for sending, the user must take action before they can send the message. However, if the add-in is unavailable at the time of sending, the item will be sent.

```
JSON
 {
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox",
 "minVersion": "1.15"
 }
 ],
 "scopes": [
```

{169}------------------------------------------------

```
 "mail"
 ]
 },
 "events": [
 {
 "type": "messageSending",
 "actionId": "onMessageSendHandler",
 "options": {
 "sendMode": "softBlock"
 }
 }
 ]
 }
```
#### **Tip**

- For a list of send mode options available with the OnMessageSend and OnAppointmentSend events, see **Available send mode options**.
- To learn more about manifests for Outlook add-ins, see **Office Add-in manifests**.

# **Implement event handling**

You have to implement handling for your selected event.

In this scenario, you'll add handling for sending a message. Your add-in will check for certain keywords in the message. If any of those keywords are found, it will then check for any attachments. If there are no attachments, your add-in will recommend to the user to add the possibly missing attachment.

- 1. From the same quick start project, create a new folder named **launchevent** under the **./src** directory.
- 2. In the **./src/launchevent** folder, create a new file named **launchevent.js**.
- 3. Open the file **./src/launchevent/launchevent.js** in your code editor and add the following JavaScript code.

```
JavaScript
/*
* Copyright (c) Microsoft Corporation. All rights reserved. Licensed under
the MIT license.
* See LICENSE in the project root for license information.
*/
```

{170}------------------------------------------------

```
function onMessageSendHandler(event) {
 Office.context.mailbox.item.body.getAsync(
 "text",
 { asyncContext: event },
 getBodyCallback
 );
}
function getBodyCallback(asyncResult){
 const event = asyncResult.asyncContext;
 let body = "";
 if (asyncResult.status !== Office.AsyncResultStatus.Failed &&
asyncResult.value !== undefined) {
 body = asyncResult.value;
 } else {
 const message = "Failed to get body text";
 console.error(message);
 event.completed({ allowEvent: false, errorMessage: message });
 return;
 }
 const matches = hasMatches(body);
 if (matches) {
 Office.context.mailbox.item.getAttachmentsAsync(
 { asyncContext: event },
 getAttachmentsCallback);
 } else {
 event.completed({ allowEvent: true });
 }
}
function hasMatches(body) {
 if (body == null || body == "") {
 return false;
 }
 const arrayOfTerms = ["send", "picture", "document", "attachment"];
 for (let index = 0; index < arrayOfTerms.length; index++) {
 const term = arrayOfTerms[index].trim();
 const regex = RegExp(term, 'i');
 if (regex.test(body)) {
 return true;
 }
 }
 return false;
}
function getAttachmentsCallback(asyncResult) {
 const event = asyncResult.asyncContext;
 if (asyncResult.value.length > 0) {
 for (let i = 0; i < asyncResult.value.length; i++) {
 if (asyncResult.value[i].isInline == false) {
 event.completed({ allowEvent: true });
```

{171}------------------------------------------------

```
 return;
 }
 }
 event.completed({
 allowEvent: false,
 errorMessage: "Looks like the body of your message includes an image or
an inline file. Attach a copy to the message before sending.",
 // TIP: In addition to the formatted message, it's recommended to also
set a
 // plain text message in the errorMessage property for compatibility on
 // older versions of Outlook clients.
 errorMessageMarkdown: "Looks like the body of your message includes an
image or an inline file. Attach a copy to the message before
sending.\n\n**Tip**: For guidance on how to attach a file, see [Attach files
in Outlook](https://www.contoso.com/help/attach-files-in-outlook)."
 });
 } else {
 event.completed({
 allowEvent: false,
 errorMessage: "Looks like you're forgetting to include an attachment.",
 // TIP: In addition to the formatted message, it's recommended to also
set a
 // plain text message in the errorMessage property for compatibility on
 // older versions of Outlook clients.
 errorMessageMarkdown: "Looks like you're forgetting to include an
attachment.\n\n**Tip**: For guidance on how to attach a file, see [Attach
files in Outlook](https://www.contoso.com/help/attach-files-in-outlook)."
 });
 }
}
// IMPORTANT: To ensure your add-in is supported in Outlook, remember to map
the event handler name specified in the manifest to its JavaScript
counterpart.
Office.actions.associate("onMessageSendHandler", onMessageSendHandler);
```
#### ) **Important**

- In classic Outlook on Windows, imports aren't currently supported in the JavaScript file where you implement the handling for event-based activation.
- To ensure your add-in runs as expected when an OnMessageSend or OnAppointmentSend event occurs, call Office.actions.associate in the JavaScript file where your handlers are implemented. This maps the event handler name specified in the manifest to its JavaScript counterpart. If this call isn't included in your JavaScript file and the send mode property of your manifest is set to **soft block** or isn't specified, your users will be blocked from sending messages or meetings. The

{172}------------------------------------------------

location of the handler name in the manifest differs depending on the type of manifest your add-in uses.

- **Unified manifest for Microsoft 365**: The value specified in the **["actionId"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-auto-run-events-array-events#actionid)** property of the applicable **["autoRunEvents.events"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-auto-run-events-array-events)** object.
- **Add-in only manifest**: The function name specified in the applicable **[LaunchEvent](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#launchevent)** element.
- In classic Outlook on Windows, when the JavaScript function specified in the manifest to handle an event runs, code in Office.onReady() and Office.initialize isn't run. We recommend adding any startup logic needed by event handlers, such as checking the user's Outlook version, to the event handlers instead.
- The **[errorMessageMarkdown](https://learn.microsoft.com/en-us/javascript/api/outlook/office.smartalertseventcompletedoptions#outlook-office-smartalertseventcompletedoptions-errormessagemarkdown-member)** property was introduced in **[requirement set 1.15](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.15/outlook-requirement-set-1.15)**. Learn more about its **[supported clients and platforms](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#outlook-client-support)**.

# **Customize the text and functionality of a button in the dialog (optional)**

#### 7 **Note**

Support to customize a button in the Smart Alerts dialog and program it to open a task pane was introduced in **[requirement set 1.14](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.14/outlook-requirement-set-1.14)**. The ability to program a button to run a function was introduced in **[requirement set 1.15](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.15/outlook-requirement-set-1.15)**. Learn more about its **[supported clients](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#outlook-client-support) [and platforms](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#outlook-client-support)**.

If a mail item doesn't meet the conditions of a Smart Alerts add-in, a dialog is shown to the user to alert them that additional actions may be needed before an item can be sent. To provide the user with further guidance on how to meet the conditions of your add-in, you can customize the text of a button in the dialog and program it to open a task pane or run a function.

The button you can customize depends on the Outlook client and version on which the add-in is running.

| Client                                 | Customizable<br>dialog button | Specifications                                                                                                          |
|----------------------------------------|-------------------------------|-------------------------------------------------------------------------------------------------------------------------|
| Windows (classic)<br>Supported Mailbox | Don't Send                    | The text and functionality of the Don't Send button can be<br>customized. Customizable functionality includes opening a |

{173}------------------------------------------------

| Client                                        | Customizable<br>dialog button | Specifications                                                                                                           |
|-----------------------------------------------|-------------------------------|--------------------------------------------------------------------------------------------------------------------------|
| 1.14 versions prior to<br>Version 2412 (Build |                               | task pane or running a function.                                                                                         |
| 18324.20000)                                  |                               | The Don't Send button appears in the dialog no matter what<br>send mode option you select. By default, selecting Don't   |
| Mac                                           |                               | Send cancels the send operation and closes the dialog.                                                                   |
| Version 16.100<br>(25072537)                  |                               |                                                                                                                          |
|                                               |                               |                                                                                                                          |
|                                               |                               |                                                                                                                          |
| Web browser                                   | Take Action                   | The text and functionality of the Take Action button can be<br>customized. Customizable functionality includes opening a |
| Windows (new)                                 |                               | task pane or running a function.                                                                                         |
| Windows (classic)                             |                               | The Take Action button only appears in the Smart Alerts                                                                  |
| Version 2412 (Build<br>18324.20000) or later  |                               | dialog when you configure a task pane or function to run<br>from the dialog. When the Take Action button is present, the |
|                                               |                               | Don't Send button is used to cancel the mail item being                                                                  |
|                                               |                               | sent. The text and functionality of the Don't Send button<br>can't be customized.                                        |
|                                               |                               |                                                                                                                          |
|                                               |                               |                                                                                                                          |
|                                               |                               |                                                                                                                          |
|                                               |                               |                                                                                                                          |
|                                               |                               |                                                                                                                          |

#### 7 **Note**

In classic Outlook on Windows, if you customized the text and functionality of the **Don't Send** button in your Smart Alerts add-in prior to Version 2412 (Build 18324.20000), no additional action is needed to implement the **Take Action** button in the latest supported versions. The default or customized **Take Action** button will automatically appear the next time a user receives a Smart Alerts dialog. Although no implementation changes are needed, we recommend notifying users of this updated experience.

If you only customized the text of the **Don't Send** button in earlier supported versions, your custom text won't appear in the latest versions that support the **Take Action** implementation.

{174}------------------------------------------------

To modify the text of the dialog button or assign it a task pane or function, you must set additional options in the [event.completed](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxevent#outlook-office-mailboxevent-completed-member(1)) method of your event handler.

- The [cancelLabel](https://learn.microsoft.com/en-us/javascript/api/outlook/office.smartalertseventcompletedoptions#outlook-office-smartalertseventcompletedoptions-cancellabel-member) option customizes the text of the applicable button. Custom text must be a maximum of 20 characters.
- The [commandId](https://learn.microsoft.com/en-us/javascript/api/outlook/office.smartalertseventcompletedoptions#outlook-office-smartalertseventcompletedoptions-commandid-member) option specifies the ID of the task pane or function that runs when the applicable button is selected. The value must match the task pane or function command ID in the manifest of your add-in. The markup depends on the type of manifest your addin uses.
	- **Add-in only manifest**: The id attribute of the <Control> element representing the task pane or function command.
	- **Unified manifest for Microsoft 365**: The "id" property of the task pane or function command in the "controls" array.

In supported Outlook clients and versions, when the commandId option is specified, the **Take Action** button appears in the Smart Alerts dialog.

- The [contextData](https://learn.microsoft.com/en-us/javascript/api/outlook/office.smartalertseventcompletedoptions#outlook-office-smartalertseventcompletedoptions-contextdata-member) option specifies any JSON data you want to pass to the add-in when the applicable button is selected. If you include this option, you must also set the commandId option. Otherwise, the JSON data is ignored.
#### **Tip**

When you configure a button in the Smart Alerts dialog to run a function, a button for the implemented add-in command is also added to the ribbon or action bar of the Outlook client. Use the contextData option to distinguish when a user runs the function from the Smart Alerts dialog.

To retrieve the value of the contextData option, you must call **[Office.context.mailbox.item.getInitializationContextAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods)** in the JavaScript implementation of your task pane or function command.

In this sample, the dialog button is modified to open a task pane.

- 1. Navigate to the **./src/launchevent** folder, then open **launchevent.js**.
- 2. Replace the **getAttachmentsCallback** function with the following code.

```
JavaScript
function getAttachmentsCallback(asyncResult) {
 const event = asyncResult.asyncContext;
 if (asyncResult.value.length > 0) {
```

{175}------------------------------------------------

```
 for (let i = 0; i < asyncResult.value.length; i++) {
 if (asyncResult.value[i].isInline == false) {
 event.completed({ allowEvent: true });
 return;
 }
 }
 event.completed({
 allowEvent: false,
 errorMessage: "Looks like the body of your message includes an image or
an inline file. Attach a copy to the message before sending.",
 // TIP: In addition to the formatted message, it's recommended to also
set a
 // plain text message in the errorMessage property for compatibility on
 // older versions of Outlook clients.
 errorMessageMarkdown: "Looks like the body of your message includes an
image or an inline file. Attach a copy to the message before
sending.\n\n**Tip**: For guidance on how to attach a file, see [Attach files
in Outlook](https://www.contoso.com/help/attach-files-in-outlook).",
 cancelLabel: "Add an attachment",
 commandId: "msgComposeOpenPaneButton"
 });
 } else {
 event.completed({
 allowEvent: false,
 errorMessage: "Looks like you're forgetting to include an attachment.",
 // TIP: In addition to the formatted message, it's recommended to also
set a
 // plain text message in the errorMessage property for compatibility on
 // older versions of Outlook clients.
 errorMessageMarkdown: "Looks like you're forgetting to include an
attachment.\n\n**Tip**: For guidance on how to attach a file, see [Attach
files in Outlook](https://www.contoso.com/help/attach-files-in-outlook).",
 cancelLabel: "Add an attachment",
 commandId: "msgComposeOpenPaneButton"
 });
 }
}
```
3. Save your changes.

# **Override the send mode option at runtime (optional)**

#### 7 **Note**

Support to override the send mode option at runtime was introduced in **[requirement set](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.14/outlook-requirement-set-1.14) [1.14](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.14/outlook-requirement-set-1.14)**. Learn more about its **[supported clients and platforms](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#outlook-client-support)**.

{176}------------------------------------------------

There may be instances when you want your add-in to implement different send mode options. For example, you may want your add-in to enforce the **block** option on mail items that don't meet the information protection policies of your organization, but only have it apply the **prompt user** option to provide a recommendation if a user adds the incorrect recipient.

To override the send mode option at runtime, you must set the [sendModeOverride](https://learn.microsoft.com/en-us/javascript/api/outlook/office.smartalertseventcompletedoptions#outlook-office-smartalertseventcompletedoptions-sendmodeoverride-member) option in the event.completed method of your event handler.

- 1. Navigate to the **./src/launchevent** folder, then open **launchevent.js**.
- 2. Replace the **getAttachmentsCallback** function with the following code.

```
JavaScript
function getAttachmentsCallback(asyncResult) {
 const event = asyncResult.asyncContext;
 if (asyncResult.value.length > 0) {
 for (let i = 0; i < asyncResult.value.length; i++) {
 if (asyncResult.value[i].isInline == false) {
 event.completed({ allowEvent: true });
 return;
 }
 }
 event.completed({
 allowEvent: false,
 errorMessage: "Looks like the body of your message includes an image or
an inline file. Would you like to attach a copy of it to the message?",
 // TIP: In addition to the formatted message, it's recommended to also
set a
 // plain text message in the errorMessage property for compatibility on
 // older versions of Outlook clients.
 errorMessageMarkdown: "Looks like the body of your message includes an
image or an inline file. Would you like to attach a copy of it to the
message?\n\n**Tip**: For guidance on how to attach a file, see [Attach files
in Outlook](https://www.contoso.com/help/attach-files-in-outlook).",
 cancelLabel: "Attach a copy",
 commandId: "msgComposeOpenPaneButton",
 sendModeOverride: Office.MailboxEnums.SendModeOverride.PromptUser
 });
 } else {
 event.completed({
 allowEvent: false,
 errorMessage: "Looks like you're forgetting to include an attachment.",
 // TIP: In addition to the formatted message, it's recommended to also
set a
 // plain text message in the errorMessage property for compatibility on
 // older versions of Outlook clients.
 errorMessageMarkdown: "Looks like you're forgetting to include an
attachment.\n\n**Tip**: For guidance on how to attach a file, see [Attach
files in Outlook](https://www.contoso.com/help/attach-files-in-outlook).",
 cancelLabel: "Add an attachment",
```

{177}------------------------------------------------

```
 commandId: "msgComposeOpenPaneButton"
 });
 }
}
```
- 3. Save your changes.
# **Configure the task pane (optional)**

If you implemented the optional steps to customize a dialog button or override the send mode option in this walkthrough, you also need to configure the task pane.

#### 7 **Note**

In Outlook on the web, new Outlook on Windows, supported versions of classic Outlook on Windows prior to Version 2412 (Build 18324.20000), and Outlook on Mac, you can customize the text of the **Don't Send** button without implementing a task pane or function command. Although the task pane is needed in this sample, it isn't a requirement to be able to customize the button text or override the send mode option in these clients.

In classic Outlook on Windows starting in Version 2412 (Build 18324.20000), you must implement a task pane or function command to customize the **Take Action** button. This is because the **Take Action** button only appears in the Smart Alerts dialog when a task pane or function command is implemented in the add-in.

- 1. Navigate to the **./src/taskpane** folder, then open **taskpane.html**.
- 2. Select the entire <body> node (including its open and close tags) and replace it with the following code.

```
HTML
<body class="ms-welcome ms-Fabric">
 <header class="ms-welcome__header ms-bgColor-neutralLighter">
 <img width="90" height="90" src="../../assets/logo-filled.png"
alt="Contoso" title="Contoso" />
 <h1 class="ms-font-su">Try out the Smart Alerts sample</h1>
 </header>
 <section id="sideload-msg" class="ms-welcome__main">
 <h2 class="ms-font-xl">Please <a
href="https://learn.microsoft.com/office/dev/add-ins/testing/test-debug-
office-add-ins#sideload-an-office-add-in-for-testing">sideload</a> your add-
in to see app body.</h2>
 </section>
 <main id="app-body" class="ms-welcome__main" style="display: none;">
```

{178}------------------------------------------------

```
 <p>
 This sample implements a Smart Alerts add-in that activates when
you forget to attach a document or picture that you mention in your message.
 To learn more, see the <a
href="https://learn.microsoft.com/office/dev/add-ins/outlook/smart-alerts-
onmessagesend-walkthrough">Smart Alerts walkthrough</a>.
 </p>
 <h3 class="ms-font-l">Add an attachment</h3>
 <p>Add the URL of a file to add it as an attachment.</p>
 <div class="ms-TextField">
 <label class="ms-Label ms-font-l">URL of file:</label>
 <input id="attachment-url" class="ms-TextField-field" type="text"
value="https://localhost:3000/assets/icon-128.png" placeholder="">
 </div>
 <br/>
 <button class="ms-Button ms-Button--primary">
 <span id="add-attachment" class="ms-Button-label">Add as
attachment</span>
 </button>
 <br/>
 <h3 class="ms-font-l">Override the send mode option at runtime</h3>
 <p>Add an inline image to test overriding the send mode option at
runtime.</p>
 <button class="ms-Button ms-Button--primary">
 <span id="add-inline-image" class="ms-Button-label">Add an inline
image</span>
 </button>
 </main>
</body>
```
- 3. Save your changes.
- 4. In the same **./src/taskpane** folder, open **taskpane.js**.
- 5. Replace its contents with the following code.

```
JavaScript
/*
 * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under
the MIT license.
 * See LICENSE in the project root for license information.
 */
Office.onReady((info) => {
 if (info.host === Office.HostType.Outlook) {
 document.getElementById("sideload-msg").style.display = "none";
 document.getElementById("app-body").style.display = "flex";
 document.getElementById("add-attachment").onclick = addAttachment;
 document.getElementById("add-inline-image").onclick = addInlineImage;
 }
});
```

{179}------------------------------------------------

```
// Adds the specified URL as an attachment to the message.
export async function addAttachment() {
 const attachmentUrl = document.querySelector("#attachment-url").value;
 Office.context.mailbox.item.addFileAttachmentAsync(attachmentUrl,
getFileName(attachmentUrl), (asyncResult) => {
 console.log("Added attachment.");
 });
}
// Gets the file name from a URL.
function getFileName(url) {
 const lastIndex = url.lastIndexOf("/");
 if (lastIndex >= 0) {
 return url.substring(lastIndex + 1);
 }
 return url;
}
// Adds an inline image to the body of the message.
export async function addInlineImage() {
 const mailItem = Office.context.mailbox.item;
 const base64String =

"iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAMAAADVRocKAAAAAXNSR0IArs4c6QAAAARnQU1BAACx
jwv8YQUAAAAnUExURQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAN0S+bUAA
AAMdFJOUwAQIDBAUI+fr7/P7yEupu8AAAAJcEhZcwAADsMAAA7DAcdvqGQAAAF8SURBVGhD7dfLdo
MwDEVR6Cspzf9/b20QYOthS5Zn0Z2kVdY6O2WULrFYLBaLxd5ur4mDZD14b8ogWS/dtxV+dmx9ysA
2QUj9TQRWv5D7HyKwuIW9n0vc8tkpHP0W4BOg3wQ8wtlvA+PC1e8Ao8Ld7wFjQtHvAiNC2e8DdqHq
KwCrUPc1gE1AfRVgEXBfB+gF0lcCWoH2tYBOYPpqQCNwfT3QF9i+AegJfN8CtAWhbwJagtS3AbIg9
o2AJMh9M5C+SVGBvx6zAfmT0r+Bv8JMwP4kyFPir+cswF5KL3WLv14zAFBCLf56Tw9cparFX4upga
JUtPhrOS1QlY5W+vWTXrGgBFB/b72ev3/0igUdQPppP/nfowfKUUEFcP207y/yxKmgAYQ+PywoAFO
fCH3A2MdCFzD3kdADBvq10AGG+pXQBgb7pdAEhvuF0AIc/VtoAK7+JciAs38KIuDugyAC/v4hiMCE
/i7IwLRBsh68N2WQjMVisVgs9i5bln8LGScNcCrONQAAAABJRU5ErkJggg==";
 // Get the current body of the message.
 mailItem.body.getAsync(Office.CoercionType.Html, (bodyResult) => {
 if (bodyResult.status === Office.AsyncResultStatus.Failed) {
 console.log(bodyResult.error.message);
 return;
 }
 // Insert the Base64-encoded image to the beginning of the body.
 const options = { isInline: true, asyncContext: bodyResult.value };
 mailItem.addFileAttachmentFromBase64Async(base64String, "sample.png",
options, (attachResult) => {
 if (attachResult.status === Office.AsyncResultStatus.Failed) {
 console.log(attachResult.error.message);
 return;
 }
 let body = attachResult.asyncContext;
 body += '<img src="cid:sample.png" />';
 mailItem.body.setAsync(body, { coercionType: Office.CoercionType.Html
}, (setResult) => {
```

{180}------------------------------------------------

```
 if (setResult.status === Office.AsyncResultStatus.Failed) {
 console.log(setResult.error.message);
 return;
 }
 console.log("Inline image added to the body.");
 });
 });
 });
}
```
6. Save your changes.

### **Programmatically send the item from the task pane (optional)**

#### 7 **Note**

The sendAsync method was introduced in **[requirement set 1.15](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.15/outlook-requirement-set-1.15)**. Learn more about its supported clients and platforms.

To further streamline a user's experience when recommending changes to the mail items they're sending, call the [sendAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.15/office.context.mailbox.item?view=outlook-js-1.15&preserve-view=true#methods) method in your task pane or function command code.

- 1. In **taskpane.js**, replace the addAttachment function with the following code.

```
JavaScript
// Adds the specified URL as an attachment to the message.
// Then, programmatically sends the message.
export async function addAttachment() {
 const attachmentUrl = document.querySelector("#attachment-url").value;
 Office.context.mailbox.item.addFileAttachmentAsync(attachmentUrl,
getFileName(attachmentUrl), (asyncResult) => {
 console.log("Added attachment");
 // Programmatically send the item.
 Office.context.mailbox.item.sendAsync((sendResult) => {
 if (sendResult.status === Office.AsyncResultStatus.Failed) {
 console.log(`Unable to send the message: 
${sendResult.error.message}`);
 return;
 }
 // Don't run additional operations here. Process them before the
sendAsync call instead.
 });
 // Don't run additional operations after the sendAsync call. Process them
```

{181}------------------------------------------------

```
before the sendAsync call instead.
 });
}
```
### **Tip**

- Any code implemented to run when asyncResult.status is Office.AsyncResultStatus.Success or after the sendAsync method isn't guaranteed to be processed. This is because the item may have already been sent and the add-in has completed processing. We recommend processing other operations before calling sendAsync .
- The sendAsync implementation varies between a task pane and function command implementation. For guidance, see the **[sendAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.15/office.context.mailbox.item?view=outlook-js-1.15&preserve-view=true#methods)** reference documentation.
- 2. Save your changes.
- 3. In **taskpane.html**, update the label of the add-attachment button.

HTML

<span id="add-attachment" class="ms-Button-label">Add and send</span>

### **Tip**

It's good practice to indicate to the user when your add-in programmatically sends the mail item they're composing. Depending on your implementation, you can indicate this in the label of a button or add a note to the task pane.

- 4. Save your changes.
# **Update the commands HTML file**

- 1. In the **./src/commands** folder, open **commands.html**.
- 2. Immediately before the closing **head** tag ( </head> ), add a script entry for the eventhandling JavaScript code.

JavaScript

{182}------------------------------------------------

- 3. Save your changes.
# **Update webpack config settings**

- 1. Open the **webpack.config.js** file found in the root directory of the project and complete the following steps.
- 2. Locate the plugins array within the config object and add this new object to the beginning of the array.

```
JavaScript
new CopyWebpackPlugin({
 patterns: [
 {
 from: "./src/launchevent/launchevent.js",
 to: "launchevent.js",
 },
 ],
}),
```
- 3. Save your changes.
# **Try it out**

- 1. Run the following commands in the root directory of your project. When you run npm start , the local web server will start (if it isn't already running) and your add-in will be sideloaded.

| command line  |  |  |  |  |
|---------------|--|--|--|--|
| npm run build |  |  |  |  |
|               |  |  |  |  |
| command line  |  |  |  |  |
| npm start     |  |  |  |  |
|               |  |  |  |  |
| 7<br>Note     |  |  |  |  |

{183}------------------------------------------------

- When you first use Yeoman generator to develop an Office Add-in, your default browser opens a window where you'll be prompted to sign in to your Microsoft 365 account. If a sign-in window doesn't appear and you encounter a sideloading or login timeout error, run atk auth login m365 before running npm start again.
If your add-in wasn't automatically sideloaded, follow the instructions in **Sideload Outlook add-ins for testing** to manually sideload the add-in in Outlook.

- 2. In your preferred Outlook client, create a new message and set the subject. In the body, add some text. For example, "Here's a picture of the proposed logo."
- 3. Send the message. A dialog appears requesting you to add an attachment. Select **Don't Send**, **Take Action**, or **Add an attachment**. The options available to you depend on your Outlook client and whether you implemented the optional step to customize the dialog button.
	-
	- Default **Don't Send** button.

- Default **Take Action** button.

{184}------------------------------------------------

|      | To                                     | adelev@contoso.com                                                                                                                                                                                                                            |
|------|----------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Send | Cc                                     |                                                                                                                                                                                                                                               |
|      | Bcc                                    |                                                                                                                                                                                                                                               |
|      | Subject                                | Logo                                                                                                                                                                                                                                          |
|      | Here's a picture of the proposed logo. | Message from Add-in: Office Add-ins Outlook Smart Alerts Sample add-in<br>×<br>Looks like you're forgetting to include an attachment.<br>Tip: For guidance on how to attach a file, see Attach files in Outlook,<br>Don't Send<br>Take Action |

- Customized **Add an attachment** button. Applies to Outlook on the web, new Outlook on Windows, and classic Outlook on Windows (starting in Version 2412 (Build 18324.20000)).

|      | To                                                                                                                                                                                                                                                                                            | O adelev@contoso.com |
|------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------|
| Send | Cc                                                                                                                                                                                                                                                                                            |                      |
|      | Bcc                                                                                                                                                                                                                                                                                           |                      |
|      | Subject                                                                                                                                                                                                                                                                                       | Logo                 |
|      | Here's a picture of the proposed logo.<br>×<br>Message from Add-in: Office Add-ins Outlook Smart Alerts Sample add-in<br>Looks like you're forgetting to include an attachment.<br>Tip: For guidance on how to attach a file, see Attach files in Outlook.<br>Add an attachment<br>Don't Send |                      |

- Customized **Add an attachment** button. Applies to classic Outlook on Windows prior to Version 2412 (Build 18324.20000).

{185}------------------------------------------------

|                                                                                                                                                                                                                    | To<br>O adelev@contoso.com             |  |  |  |  |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|--|--|--|--|
| Send                                                                                                                                                                                                               | Cc                                     |  |  |  |  |
|                                                                                                                                                                                                                    | Subject<br>Logo                        |  |  |  |  |
|                                                                                                                                                                                                                    | Here's a picture of the proposed logo. |  |  |  |  |
| Office Add-ins Outlook Smart Alerts Sample add-in<br>×<br>Looks like you're forgetting to include an attachment.<br>Tip: For guidance on how to attach a file, see Attach files in<br>Outlook<br>Add an attachment |                                        |  |  |  |  |

#### 7 **Note**

In supported versions of classic Outlook on Windows prior to Version 2410 (Build 18031.15000), if you assign a task pane to the **Don't Send** button, closing the dialog also opens the specified task pane.

- 4. Add an attachment to your message. If you implemented the optional step to customize a dialog button, use the task pane to add an attachment.

{186}------------------------------------------------

|      | To<br>O adelev@contoso.com;            | Outlook Smart Alerts<br>×                                                                                    |
|------|----------------------------------------|--------------------------------------------------------------------------------------------------------------|
| Send | Cc                                     |                                                                                                              |
|      | Bec                                    |                                                                                                              |
|      | Subject<br>Logo                        |                                                                                                              |
|      | con-128.png                            | LOGO                                                                                                         |
| 2 KB |                                        |                                                                                                              |
|      | Here's a picture of the proposed logo. | Try out the                                                                                                  |
|      |                                        |                                                                                                              |
|      |                                        | Smart Alerts                                                                                                 |
|      |                                        | sample                                                                                                       |
|      |                                        |                                                                                                              |
|      |                                        |                                                                                                              |
|      |                                        | This sample implements a Smart Alerts add-in<br>that activates when you forget to attach a                   |
|      |                                        | document or picture that you mention in your<br>message. To learn more, see the Smart Alerts<br>walkthrough. |
|      |                                        | Add an attachment                                                                                            |
|      |                                        | Add the URL of a file to add it as an attachment.                                                            |
|      |                                        | URL of file:   https://localhost:3000/a                                                                      |
|      |                                        | Add as attachment                                                                                            |
|      |                                        | Override the send mode option at<br>runtime                                                                  |
|      |                                        | Add an inline image to test overriding the send<br>mode option at runtime.                                   |
|      |                                        | Add an inline image                                                                                          |

- 5. Send the message. If you implemented the optional step to programmatically send the message from the task pane, the message will send when you select **Add and send**. There should be no alert this time.
- 6. When you want to stop the local web server and uninstall the add-in, follow the applicable instructions:
	- To stop the server, run the following command. If you used npm start , the following command should also uninstall the add-in.

| command line |  |  |  |  |  |
|--------------|--|--|--|--|--|
| npm stop     |  |  |  |  |  |

- If you manually sideloaded the add-in, see Remove a sideloaded add-in.

{187}------------------------------------------------

### **Try out overriding the send mode option at runtime (optional)**

If you implemented the optional step to override the send mode option at runtime, perform the following to try it out.

- 1. Run npm start in the root directory of your project. This starts the local web server (if it isn't already running) and sideloads your add-in.
#### 7 **Note**

- When you first use Yeoman generator to develop an Office Add-in, your default browser opens a window where you'll be prompted to sign in to your Microsoft 365 account. If a sign-in window doesn't appear and you encounter a sideloading or login timeout error, run atk auth login m365 before running npm start again.
If your add-in wasn't automatically sideloaded, follow the instructions in **Sideload Outlook add-ins for testing** to manually sideload the add-in in Outlook.

- 2. In your preferred Outlook client, create a new message and set the subject. In the body, add some text. For example, "Here's a picture of the proposed logo."
- 3. From the ribbon, select **Contoso Add-in** > **Show Taskpane**.
- 4. In the task pane, select **Add an inline image**. An image is added to the body of your message.
- 5. Send the message. A dialog appears recommending to attach a copy of the image to the message.
- 6. Select **Send Anyway** to send the message as is, or select **Attach a copy** to include a copy before sending the message.
	- Applies to Outlook on the web, new Outlook on Windows, and classic Outlook on Windows (starting in Version 2412 (Build 18324.20000)).

{188}------------------------------------------------

|      | To                                     | adelev@contoso.com                                                                                                                |
|------|----------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|
| Send | Cc                                     |                                                                                                                                   |
|      | Bcc                                    |                                                                                                                                   |
|      | Subject                                | Logo                                                                                                                              |
|      | Here's a picture of the proposed logo. |                                                                                                                                   |
|      |                                        |                                                                                                                                   |
|      |                                        | Message from Add-in: Office Add-ins Outlook Smart Alerts Sample add-in<br>×                                                       |
|      |                                        | Looks like the body of your message includes an image or an inline file.<br>Would you like to attach a copy of it to the message? |
|      |                                        | Tip: For guidance on how to attach a file, see Attach files in Outlook,<br>Send Anyway<br>Don't Send<br>Attach a copy             |
|      |                                        |                                                                                                                                   |

- Applies to classic Outlook on Windows prior to Version 2412 (Build 18324.20000).

|      | To                                     | adelev@contoso.com                                                                                                                |
|------|----------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|
| Send | Cc                                     |                                                                                                                                   |
|      | Subject                                | Logo                                                                                                                              |
|      | Here's a picture of the proposed logo. |                                                                                                                                   |
|      |                                        |                                                                                                                                   |
|      |                                        | ×<br>Office Add-ins Outlook Smart Alerts Sample add-in                                                                            |
|      |                                        | Looks like the body of your message includes an image or an<br>inline file. Would you like to attach a copy of it to the message? |
|      | Outlook                                | Tip: For guidance on how to attach a file, see Attach files in                                                                    |
|      |                                        | Send Anyway<br>Attach a copy                                                                                                      |
|      |                                        |                                                                                                                                   |

| )<br>Important |  |  |  |  |  |
|----------------|--|--|--|--|--|
|                |  |  |  |  |  |

{189}------------------------------------------------

If a Smart Alerts add-in that implements the override feature can't complete processing an event due to an error or is unavailable when the event occurs, it uses the send mode option specified in the manifest.

# **See also**

- Handle OnMessageSend and OnAppointmentSend events in your Outlook add-in with Smart Alerts
- Activate add-ins with events
- Office Add-in manifests
- Troubleshoot event-based and spam-reporting add-ins
- Debug event-based and spam-reporting add-ins
- AppSource listing options for your event-based add-in
- [Office Add-ins code sample: Verify the color categories of a message or appointment](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-check-item-categories) [before it's sent using Smart Alerts](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-check-item-categories)
- [Office Add-ins code sample: Verify the sensitivity label of a message](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-verify-sensitivity-label)

{190}------------------------------------------------

# **Automatically update your signature when switching between Exchange accounts**

08/01/2025

Applying the correct signature to messages when using multiple Exchange accounts is now made easier with the addition of the OnMessageFromChanged and OnAppointmentFromChanged events to the event-based activation feature. The OnMessageFromChanged event occurs when the account in the **From** field of a message being composed is changed, while the OnAppointmentFromChanged event occurs when the organizer of a meeting being composed is changed. These events further extend the capabilities of signature add-ins and allow them to:

- Provide users with the convenience to apply custom signatures for each of their accounts.
- Enable mailbox delegates to more accurately and efficiently manage outgoing messages and meeting requests from multiple mailboxes.
- Ensure that users' messages and appointments meet their organization's communication and marketing policies.

The following sections walk you through how to develop an event-based add-in that handles the OnMessageFromChanged event to automatically update a message's signature when the mail account in the **From** field is changed.

#### 7 **Note**

The OnMessageFromChanged and OnAppointmentFromChanged events were introduced in **[requirement set 1.13](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.13/outlook-requirement-set-1.13)**. For information about client support for these events, see **Supported clients and platforms**.

# **Supported clients and platforms**

The following tables list client-server combinations that support the OnMessageFromChanged and OnAppointmentFromChanged events. Select the tab for the applicable event.

OnMessageFromChanged event

{191}------------------------------------------------

| Client                                                                     | Exchange<br>Online | Exchange Server<br>Subscription<br>Edition (SE) | Exchange 2019 on<br>premises<br>(Cumulative<br>Update 12 or later) | Exchange 2016 on<br>premises<br>(Cumulative<br>Update 22 or later) |
|----------------------------------------------------------------------------|--------------------|-------------------------------------------------|--------------------------------------------------------------------|--------------------------------------------------------------------|
| Web browser<br>(modern UI)<br>new Outlook on<br>Windows                    | Supported          | Not applicable                                  | Not applicable                                                     | Not applicable                                                     |
| Windows<br>(classic)<br>Version 2304<br>(Build<br>16327.20248) or<br>later | Supported          | Supported                                       | Supported                                                          | Supported                                                          |
| Mac<br>Version 16.77<br>(23081600) or<br>later                             | Supported          | Not applicable                                  | Not applicable                                                     | Not applicable                                                     |
| iOS<br>Version 4.2502.0                                                    | Supported          | Not applicable                                  | Not applicable                                                     | Not applicable                                                     |
| Android<br>Version 4.2502.0                                                | Supported          | Not applicable                                  | Not applicable                                                     | Not applicable                                                     |

### **Prerequisites**

To test the walkthrough, you must have at least two Exchange accounts.

# **Set up your environment**

Complete the Outlook quick start, which creates an add-in project with the Yeoman generator for Office Add-ins.

# **Configure the manifest**

#### 7 **Note**

The OnMessageFromChanged event isn't currently available with the unified manifest for Microsoft 365 in Outlook on the web and the new Outlook on Windows. To handle these 

{192}------------------------------------------------

events, implement an add-in only manifest instead. For information about the types of manifests, see **Office Add-ins manifest**.

Unified manifest for Microsoft 365

#### 7 **Note**

Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on Mac and on mobile devices. To run this type of add-in on Mac and on mobile platforms, the add-in must first be published to **[AppSource](https://appsource.microsoft.com/)** then deployed in the **Microsoft 365 Admin Center**. For more information, see the "Client and platform support" section of **Office Add-ins with the unified app manifest for Microsoft 365**.

- 1. Open the **manifest.json** file.
- 2. Navigate to the ["authorization.permissions.resourceSpecific"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-authorization-permissions-resource-specific) array. In the array object, replace the value of the ["name"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-authorization-permissions-resource-specific#name) property with "MailboxItem.ReadWrite.User" . This is needed by the add-in to be able to update the signature of a message.

```
JSON
...
"authorization": {
 "permissions": {
 "resourceSpecific": [
 {
 "name": "MailboxItem.ReadWrite.User",
 "type": "Delegated"
 }
 ]
 }
},
...
```
- 3. Add the following object to the ["extensions.runtimes"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array) array. Note the following about this markup.
	- The ["minVersion"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/requirements-extension-element-capabilities#minversion) of the Mailbox requirement set is configured as "1.13" because this is the lowest version of the requirement set that supports the OnMessageFromChanged event. For more information, see the "Supported events" table in Activate add-ins with events.

{193}------------------------------------------------

- The ["id"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array#id) of the runtime is set to a descriptive name, "autorun_runtime" .
- The ["code"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtime-code) property has a child ["page"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtime-code#page) property set to an HTML file and a child ["script"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtime-code#script) property set to a JavaScript file. You'll create or edit these files in later steps. Office uses one of these values depending on the platform.
	- Classic Outlook on Windows executes the event handler in a JavaScript-only runtime, which loads a JavaScript file directly.
	- Outlook on the web and on Mac, and new Outlook on Windows execute the handler in a browser runtime, which loads an HTML file. The HTML file contains a <script> tag that then loads the JavaScript file.

For more information, see Runtimes in Office Add-ins.

- The ["lifetime"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array#lifetime) property is set to "short" . This means the runtime starts up when the event occurs and shuts down when the handler completes.
- There are ["actions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-actions-item) to run handlers for the OnMessageFromChanged and OnNewMessageCompose events. You'll create the handlers in a later step.

```
JSON
```

```
{
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox",
 "minVersion": "1.13"
 }
 ]
 },
 "id": "autorun_runtime",
 "type": "general",
 "code": {
 "page": "https://localhost:3000/commands.html",
 "script": "https://localhost:3000/launchevent.js"
 },
 "lifetime": "short",
 "actions": [
 {
 "id": "onMessageFromChangedHandler",
 "type": "executeFunction",
 "displayName": "onMessageFromChangedHandler"
 },
 {
 "id": "onNewMessageComposeHandler",
 "type": "executeFunction",
 "displayName": "onNewMessageComposeHandler"
 }
```

{194}------------------------------------------------

- 4. Add an ["autoRunEvents"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-auto-run-events-array) array as a property of the object in the ["extensions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root#extensions) array. The "autoRunEvents" array contains an object with the following key properties.
	- The ["events"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-auto-run-events-array-events) property assigns handlers to the OnMessageFromChanged and OnNewMessageCompose events. For information on event names used in the unified manifest, see the "Supported events" table in Activate add-ins with events.
	- The function name provided in ["actionId"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-auto-run-events-array-events#actionid) must match the "id" property of its corresponding object in the "actions" array configured earlier.

```
JSON
"autoRunEvents": [
 {
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox",
 "minVersion": "1.13"
 }
 ],
 "scopes": [
 "mail"
 ]
 },
 "events": [
 {
 "type": "messageFromChanged",
 "actionId": "onMessageFromChangedHandler"
 },
 {
 "type": "newMessageComposeCreated",
 "actionId": "onNewMessageComposeHandler"
 }
 ]
 }
]
```
#### **Tip**

 ] }

- To learn about runtimes in add-ins, see **Runtimes in Office Add-ins**.
- To learn more about manifests for Outlook add-ins, see **Office Add-in manifests**.

{195}------------------------------------------------

# **Implement the event handlers**

Event handlers must be configured for the OnNewMessageCompose and OnMessageFromChanged events. The onNewMessageComposeHandler function adds a signature to a newly created message if a default one isn't already configured on the current account. When the account in the **From** field is changed, the onMessageFromChangedHandler function updates the signature based on this newly selected account.

- 1. From the same quick start project, navigate to the **./src** directory, then create a new folder named **launchevent**.
- 2. In the **./src/launchevent** folder, create a new file named **launchevent.js**.
- 3. Open the file **./src/launchevent/launchevent.js** in your code editor and add the following JavaScript code.

```
JavaScript
/*
* Copyright (c) Microsoft Corporation. All rights reserved. Licensed under
the MIT license.
* See LICENSE in the project root for license information.
*/
// The OnNewMessageCompose event handler that adds a signature to a new
message.
function onNewMessageComposeHandler(event) {
 const platform = Office.context.platform;
 const signature = "<i>This is a sample signature.</i>";
 // On supported platforms, check if a default Outlook signature is
already configured.
 if (platform !== Office.PlatformType.Android && platform !==
Office.PlatformType.iOS) {
 Office.context.mailbox.item.isClientSignatureEnabledAsync({ 
asyncContext: { event: event, signature: signature } }, (result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.log(result.error.message);
 return;
 }
 // Add a signature if there's no default Outlook signature
configured.
 const signatureEnabled = result.value;
 if (signatureEnabled === false) {
 const event = result.asyncContext.event;
 const signature = result.asyncContext.signature;
 setSignature(signature, event);
 }
 });
```

{196}------------------------------------------------

```
 } else {
 setSignature(signature, event);
 }
}
```
// The OnMessageFromChanged event handler that updates the signature when the email address in the From field is changed.

```
function onMessageFromChangedHandler(event) {
 const item = Office.context.mailbox.item;
 const signatureIcon =
```

```
"iVBORw0KGgoAAAANSUhEUgAAACcAAAAnCAMAAAC7faEHAAAAAXNSR0IArs4c6QAAAARnQU1BAACx
jwv8YQUAAAAzUExURQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAKMFRskAAAAQdFJOUwAQIDBAUGBwgI+fr7/P3+8jGoKKAAAACXBIWXMAAA7DAAAOwwHHb6
hkAAABT0lEQVQ4T7XT2ZalIAwF0DAJhMH+/6+tJOQqot6X6joPiouNBo3w9/Hd6+hrYnUt6vhLcjE
AJevVW0zJxABSlcunhERpjY+UKoNN5+ZgDGu2onNz0OngjP2FM1VdyBW1LtvGeYrBLs7U5I1PTXZt
+zifcS3Icw2GcS3vxRY3Vn/iqx31hUyTnV515kdTfbaNhZLI30AceqDiIo4tyKEmJpKdP5M4um+nU
wfDWxAXdzqMNKQ14jLdL5ntXzxcRF440mhS6yu882Kxa30RZcUIjTCJg7lscsR4VsMjfX9Q0Vuv/W
d3YosD1J4LuSRtaL7bzXGN1wx2cytUdncDuhA3fu6HPTiCvpQUIjZ3sCcHVbvLtbNTHlysx2w9/s2
7m9gEb+7CTri6hR1wcTf2gVf3wBRe3CMbcHYvTODkXhnD0+178K/pZ9+n/C1ru/2HAPwAo7YM1X4+
tLMAAAAASUVORK5CYII=";
```

```
 // Get the currently selected From account.
 item.from.getAsync({ asyncContext: event }, (result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.log(result.error.message);
 return;
 }
 // Create a signature based on the currently selected From account.
 const name = result.value.displayName;
 const options = { asyncContext: { event: result.asyncContext, name:
name }, isInline: true };
 item.addFileAttachmentFromBase64Async(signatureIcon, 
"signatureIcon.png", options, (result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.log(result.error.message);
 return;
 }
 // Add the created signature to the mail item.
 const signature = "<img src='cid:signatureIcon.png'>" +
result.asyncContext.name;
 const event = result.asyncContext.event;
 setSignature(signature, event);
 });
 });
}
// Sets the custom signature and adds it to the mail item.
function setSignature(signature, event) {
 Office.context.mailbox.item.body.setSignatureAsync(
 signature,
 { asyncContext: event, coercionType: Office.CoercionType.Html },
 (result) => {
```

{197}------------------------------------------------

```
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.log(result.error.message);
 return;
 }
 console.log("Successfully added signature.");
 const event = result.asyncContext;
 event.completed();
 }
 );
}
// IMPORTANT: To ensure your add-in is supported in Outlook, remember to
// map the event handler name specified in the manifest to its JavaScript
counterpart.
Office.actions.associate("onNewMessageComposeHandler",
onNewMessageComposeHandler);
Office.actions.associate("onMessageFromChangedHandler",
onMessageFromChangedHandler);
```
#### ) **Important**

- In classic Outlook on Windows, imports aren't supported in the JavaScript file where you implement the handling for event-based activation.
- In classic Outlook on Windows, when the JavaScript function specified in the manifest to handle an event runs, code in Office.onReady() and Office.initialize isn't run. We recommend adding any startup logic needed by event handlers, such as checking the user's Outlook version, to the event handlers instead.
- To ensure your add-in runs as expected when an event occurs, call Office.actions.associate in the JavaScript file where your handlers are implemented. This maps the event handler name specified in the manifest to its JavaScript counterpart. The location of the handler name in the manifest differs depending on the type of manifest your add-in uses.
	- **Unified manifest for Microsoft 365**: The value specified in the **["actionId"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-auto-run-events-array-events#actionid)** property of the applicable **["autoRunEvents.events"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-auto-run-events-array-events)** object.
	- **Add-in only manifest**: The function name specified in the applicable **[LaunchEvent](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#launchevent)** element.

# **Update the commands HTML file**

- 1. From the **./src/commands** folder, open **commands.html**.

{198}------------------------------------------------

- 2. Add the following code below the existing **script** tag.

```
HTML
<script type="text/javascript" src="../launchevent/launchevent.js"></script>
```
- 3. Save your changes.
# **Update webpack config settings**

- 1. From the root directory of the project, open the **webpack.config.js** file.
- 2. Locate the plugins array within the config object and add the following new object to the beginning of the array.

```
JavaScript
new CopyWebpackPlugin({
 patterns: [
 {
 from: "./src/launchevent/launchevent.js",
 to: "launchevent.js",
 },
 ],
}),
```
- 3. Save your changes.
# **Try it out**

- 1. Run the following commands in the root directory of your project. When you run npm start , the local web server will start (if it isn't already running) and your add-in will be sideloaded.

{199}------------------------------------------------

#### 7 **Note**

When you first use Yeoman generator to develop an Office Add-in, your default browser opens a window where you'll be prompted to sign in to your Microsoft 365 account. If a sign-in window doesn't appear and you encounter a sideloading or login timeout error, run atk auth login m365 before running npm start again.

If your add-in wasn't automatically sideloaded, follow the instructions in **Sideload Outlook add-ins for testing** to manually sideload the add-in in Outlook.

- 2. In your preferred Outlook client, create a new message. If you don't have a default Outlook signature configured, the add-in adds one to the newly created message. In Outlook on mobile devices, the add-in adds a sample signature even if you have a default signature configured.

| D                           | From V  | remy@contoso.com |  |
|-----------------------------|---------|------------------|--|
| Send                        | To      |                  |  |
|                             | Cc      |                  |  |
|                             | Subject |                  |  |
| This is a sample signature. |         |                  |  |

- 3. Enable the **From** field, if applicable. For guidance on how to enable it, see the "Why is the From button missing?" section of [Change the account used to send email messages](https://support.microsoft.com/office/2bdd8d4f-e30f-4ec8-88a0-406ce7b23cc5) .
- 4. Select **From**, then choose a different Exchange account. Alternatively, manually enter the Exchange email address by selecting **From** > **Other Email Address**. An updated signature is added to the message, replacing the previous one.

{200}------------------------------------------------

| D               | From V  | kai@contoso.com |  |  |
|-----------------|---------|-----------------|--|--|
| Send            | Io      |                 |  |  |
|                 | Cc      |                 |  |  |
|                 | Subject |                 |  |  |
|                 |         |                 |  |  |
| kai@contoso.com |         |                 |  |  |

- 5. When you want to stop the local web server and uninstall the add-in, follow the applicable instructions:
	- To stop the server, run the following command. If you used npm start , the following command should also uninstall the add-in.

| command line |  |  |  |  |  |  |
|--------------|--|--|--|--|--|--|
| npm stop     |  |  |  |  |  |  |

- If you manually sideloaded the add-in, see Remove a sideloaded add-in.
# **Troubleshoot your add-in**

For guidance on how to troubleshoot your event-based activation add-in, see Troubleshoot event-based and spam-reporting add-ins.

# **Deploy to users**

Similar to other event-based add-ins, add-ins that use the OnMessageFromChanged and OnAppointmentFromChanged events must be deployed by an organization's administrator. For guidance on how to deploy your add-in via the Microsoft 365 admin center, see the "Deploy your add-in" section of Activate add-ins with events.

# **Event behavior and limitations**

{201}------------------------------------------------

Because the OnMessageFromChanged and OnAppointmentFromChanged events are supported through the event-based activation feature, the same behavior and limitations apply to add-ins that activate as a result of this event. For a detailed description, see Event-based activation behavior and limitations.

In addition to these characteristics, the following aspects also apply when an add-in activates on these events.

- The OnMessageFromChanged event is only supported in message compose mode, while the OnAppointmentFromChanged event is only supported in appointment compose mode.
- In Outlook on the web, on Windows (new and classic), and on mobile devices, only the OnMessageFromChanged event is supported.
- The OnMessageFromChanged and OnAppointmentFromChanged events only support Exchange accounts. If a user switches to a non-Exchange account in the **From** or organizer field, the Outlook client automatically clears out the signature set by the previously selected account.
- Depending on your Outlook client, in messages being composed, the Exchange account is selected from the **From** field dropdown list or manually entered in the field. Outlook on mobile devices only supports selecting an account from the **From** field dropdown list. In appointments being composed, the Exchange account is selected from the organizer field dropdown list.
- In Outlook on the web, on Windows (new and classic), and on Mac, the OnMessageFromChanged and OnAppointmentFromChanged events support delegate and shared mailbox scenarios. These scenarios aren't supported in Outlook on mobile devices.
- The OnAppointmentFromChanged event isn't supported in [Microsoft 365 group calendars](https://support.microsoft.com/office/0cf1ad68-1034-4306-b367-d75e9818376a#Outlook=Web) . If a user switches from their Exchange account to a Microsoft 365 group calendar account in the organizer field, the Outlook client automatically clears out the signature set by the Exchange account.
- When switching to another Exchange account in the **From** or organizer field, the add-ins for the previously selected account, if any, are terminated, and the add-ins associated with the newly selected account are loaded before the OnMessageFromChanged or OnAppointmentFromChanged event is initiated.
- In Outlook on the web, on Windows (new and classic), and on Mac, email account aliases are supported. When an alias for the current account is selected in the **From** or organizer field, the OnMessageFromChanged or OnAppointmentFromChanged event occurs without reloading the account's add-ins. Email account aliases aren't supported in Outlook on mobile devices.
- When the **From** or organizer field dropdown list is opened by mistake or the same account that appears in the **From** or organizer field is reselected, the

{202}------------------------------------------------

OnMessageFromChanged or OnAppointmentFromChanged event occurs, but the account's addins aren't terminated or reloaded.

# **See also**

- Activate add-ins with events
- AppSource listing options for your event-based add-in

{203}------------------------------------------------

# **Implement an integrated spam-reporting add-in**

08/26/2025

With the number of unsolicited emails on the rise, security is at the forefront of add-in usage. Currently, partner spam-reporting add-ins are added to the Outlook ribbon, but they usually appear towards the end of the ribbon or in the overflow menu. This makes it harder for users to locate the add-in to report unsolicited emails. In addition to configuring how messages are processed when they're reported, developers also need to complete additional tasks to show processing dialogs or supplemental information to the user.

The integrated spam-reporting feature eases the task of developing individual add-in components from scratch. More importantly, it displays your add-in in a prominent spot on the Outlook ribbon, making it easier for users to locate it and report spam messages. Implement this feature in your add-in to:

- Improve how unsolicited messages are tracked.
- Provide better guidance to users on how to report suspicious messages.
- Enable an organization's security operations center (SOC) or IT administrators to easily perform spam and phishing simulations for educational purposes.

#### 7 **Note**

Integrated spam reporting was introduced in **[Mailbox requirement set 1.14](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.14/outlook-requirement-set-1.14)**. Additional functionality was also added to subsequent requirement sets. To verify that an Outlook client supports these features, see **Supported clients** and the relevant sections of this article for the features you want to implement.

# **Supported clients**

The following table identifies which Outlook clients support the integrated spam-reporting feature.

- ノ **Expand table**

| Client                 | Status     |
|------------------------|------------|
| Outlook on the web     | Supported* |
| new Outlook on Windows | Supported* |

{204}------------------------------------------------

| Client                                                         | Status        |
|----------------------------------------------------------------|---------------|
| classic Outlook on Windows<br>Version 2404 (Build 17530.15000) | Supported     |
| Outlook on Mac<br>Version 16.100 (25072537)                    | Supported     |
| Outlook on Android                                             | Not available |
| Outlook on iOS                                                 | Not available |

7 **Note**

* In Outlook on the web and the new Outlook on Windows, the integrated spam-reporting feature isn't supported for Microsoft 365 consumer accounts.

# **Set up your environment**

#### **Tip**

To immediately try out a completed spam-reporting add-in solution, see the **[Report spam](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-spam-reporting) [or phishing emails in Outlook](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-spam-reporting)** sample.

Complete the Outlook quick start, which creates an add-in project with the Yeoman generator for Office Add-ins.

# **Configure the manifest**

To implement the integrated spam-reporting feature in your add-in, you must configure the following in your manifest.

- The runtime used by the add-in. In classic Outlook on Windows, a spam-reporting add-in runs in a JavaScript-only runtime. In Outlook on the web and on Mac and in the new Outlook on Windows, a spam-reporting add-in runs in a browser runtime. For more information, see Runtimes in Office Add-ins.
- The button of the spam-reporting add-in that always appears in a prominent spot on the Outlook ribbon. The following is an example of how the button of a spam-reporting addin appears on the ribbon of the classic Outlook client on Windows. The ribbon UI may vary depending on the platform the user's Outlook client is running on.

{205}------------------------------------------------

- The preprocessing dialog. When a user selects the add-in button, a dialog appears with **Report** and **Don't Report** options. In this dialog, you can share information about the reporting process or implement input options to get information about a reported message. Input options include checkboxes, radio buttons, and a text box. When a user selects **Report** from the dialog, the [SpamReporting](https://learn.microsoft.com/en-us/javascript/api/office/office.eventtype) event is activated and is then handled by the JavaScript event handler. The following is an example of a preprocessing dialog in classic Outlook on Windows. Note that the appearance of the dialog may vary depending on the platform the user's Outlook client is running on.

| Thank you for reporting this message.               |  |  |  |
|-----------------------------------------------------|--|--|--|
| For more info go to: Reporting unsolicited messages |  |  |  |
| Why are you reporting this email?                   |  |  |  |
| Received spam email.                                |  |  |  |
| Received a phishing email.                          |  |  |  |
| I'm not sure this is a legitimate email.            |  |  |  |
| Provide additional information, if any:             |  |  |  |
|                                                     |  |  |  |
|                                                     |  |  |  |
|                                                     |  |  |  |

Select the tab for the type of manifest you're using.

| Unified manifest for Microsoft 365               |                                                                                                                                                                            |
|--------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 7<br>Note                                        |                                                                                                                                                                            |
|                                                  | Implementing integrated spam reporting with the unified manifest for Microsoft 365<br>is currently only available in classic Outlook on Windows. For more information, see |
| the Microsoft 365 app manifest schema reference. |                                                                                                                                                                            |

1. In your preferred code editor, open the add-in project you created.

2. Open the **manifest.json** file.

{206}------------------------------------------------

- 3. Update the ["$schema"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root#schema-5) property to use the latest version. For more information, see [Microsoft 365 app manifest schema reference.](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema)
- 4. Add the following object to the ["extensions.runtimes"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array) array. Note the following about this markup.
	- The ["minVersion"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/requirements-extension-element-capabilities#minversion) of the Mailbox requirement set is configured to "1.14" . This is the lowest version of the requirement set that supports the integrated spamreporting feature.
	- The ["id"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array#id) of the runtime is set to a unique descriptive name, "spam_reporting_runtime" .
	- The ["code"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array#code) property has a child "page" property that's set to an HTML file and a child "script" property that's set to a JavaScript file. You'll create or edit these files in later steps.
	- The ["lifetime"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array#lifetime) property is set to "short" . This means that the runtime starts when the SpamReporting event occurs and shuts down when the event handler completes.
	- The ["actions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array#actions) object specifies the event handler function that runs in the runtime. You'll create this function in a later step.

```
JSON
{
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox",
 "minVersion": "1.14"
 }
 ]
 },
 "id": "spam_reporting_runtime",
 "type": "general",
 "code": {
 "page": "https://localhost:3000/commands.html",
 "script": "https://localhost:3000/spamreporting.js"
 },
 "lifetime": "short",
 "actions": [
 {
 "id": "onSpamReport",
 "type": "executeFunction"
 }
 ]
},
```

{207}------------------------------------------------

- 5. Add the following object to the ["extensions.ribbons"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array) array. Note the following about this markup.
	- The ["contexts"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array#contexts) array contains the "spamReportingOverride" string. This prevents the add-in button from appearing at the end of the ribbon or in the overflow section.
	- The ["tabs"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array#tabs) array must be specified in an "extensions.ribbons" object. However, because the button of a spam-reporting add-in is displayed in a specific spot on the ribbon, only an empty array is specified.
	- The ["fixedControls"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array#fixedcontrols) array contains an object that configures the look and functionality of the add-in button on the ribbon. The name of the event handler specified in the ["actionId"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array-fixed-control-item#actionid) property must match the value used in the "id" property of the object in the "actions" array. While the ["enabled"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array-fixed-control-item#enabled) property must be specified in the array, its value doesn't affect the functionality of a spam-reporting add-in.
	- The ["spamPreProcessingDialog"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array#spampreprocessingdialog) object specifies the information and options that are shown in the preprocessing dialog. While you must specify a ["title"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-spam-pre-processing-dialog#title) and ["description"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-spam-pre-processing-dialog#description) for the dialog, you can optionally configure the following properties.
		- The ["spamNeverShowAgainOption"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-spam-pre-processing-dialog#spamnevershowagainoption) property. It provides the option to suppress the preprocessing dialog for succeeding reports. This functionality is useful in scenarios where you don't need additional information from users. To learn more, see Suppress the preprocessing dialog.
		- The ["spamReportingOptions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-spam-pre-processing-dialog-spam-reporting-options?view=m365-app-1.22&preserve-view=true) object. It provides a list of up to five choices that you can configure as radio buttons or checkboxes. This helps a user identify the type of message they're reporting.
		- The ["spamFreeTextSectionTitle"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-spam-pre-processing-dialog#spamfreetextsectiontitle) property. It provides a text box for the user to add more information about the message they're reporting.
		- The ["spamMoreInfo"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-spam-pre-processing-dialog-spam-more-info) object. It includes a link in the dialog to provide informational resources to the user.

```
{
 "contexts": [
 "spamReportingOverride"
 ],
 "tabs": [],
 "fixedControls": [
 {
 "id": "spamReportingButton",
 "type": "button",
 "label": "Report Spam Message",
 "enabled": false,
```
JSON

{208}------------------------------------------------

```
 "icons": [
 {
 "size": 16,
 "url": "https://localhost:3000/assets/icon-16.png"
 },
 {
 "size": 32,
 "url": "https://localhost:3000/assets/icon-32.png"
 },
 {
 "size": 80,
 "url": "https://localhost:3000/assets/icon-80.png"
 }
 ],
 "supertip": {
 "title": "Report Spam Message",
 "description": "Report an unsolicited message."
 },
 "actionId": "onSpamReport"
 }
 ],
 "spamPreProcessingDialog": {
 "title": "Report Spam Message",
 "description": "Thank you for reporting this message.",
 "spamNeverShowAgainOption": false,
 "spamReportingOptions": {
 "title": "Why are you reporting this email?",
 "options": [
 "Received spam email.",
 "Received a phishing email.",
 "I'm not sure this is a legitimate email."
 ],
 "type": "checkbox"
 },
 "spamFreeTextSectionTitle": "Provide additional information, if
any:",
 "spamMoreInfo": {
 "text": "Reporting unsolicited messages",
 "url": "https://www.contoso.com/spamreporting"
 }
 }
},
```
6. Save your changes.

#### **Tip**

To learn more about manifests for Outlook add-ins, see **Office Add-ins manifest**.

{209}------------------------------------------------

# **Implement the event handler**

When your add-in is used to report a message, it generates a SpamReporting event, which is then processed by the event handler in the JavaScript file of your add-in. To map the name of the event handler you specified in your manifest to its JavaScript counterpart, you must call [Office.actions.associate](https://learn.microsoft.com/en-us/javascript/api/office/office.actions#office-office-actions-associate-member) in your code.

- 1. In your add-in project, navigate to the **./src** directory. Then, create a new folder named **spamreporting**.
- 2. In the **./src/spamreporting** folder, create a new file named **spamreporting.js**.
- 3. Open the newly created **spamreporting.js** file and add the following JavaScript code.

```
JavaScript
// Handles the SpamReporting event to process a reported message.
function onSpamReport(event) {
 // TODO - Send a copy of the reported message.
 // TODO - Get the user's responses.
 // TODO - Signal that the spam-reporting event has completed processing.
}
// IMPORTANT: To ensure your add-in is supported in Outlook, remember to map
the event handler name specified in the manifest to its JavaScript
counterpart.
Office.actions.associate("onSpamReport", onSpamReport);
```
- 4. Save your changes.
### **Forward a copy of the message and get the preprocessing dialog responses**

Your event handler is responsible for processing the reported message. You can configure it to forward information, such as a copy of the message or the options selected by the user in the preprocessing dialog, to an internal system for further investigation.

To efficiently send a copy of the reported message, call the [getAsFileAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messageread#outlook-office-messageread-getasfileasync-member(1)) method in your event handler. This gets the Base64-encoded EML format of a message, which you can then forward to your internal system.

If you need to keep track of the user's responses to the options and text box in the preprocessing dialog, extract the options and freeText values from the SpamReporting event 

{210}------------------------------------------------

object. For more information about these properties, see [Office.SpamReportingEventArgs.](https://learn.microsoft.com/en-us/javascript/api/outlook/office.spamreportingeventargs)

The following is an example of a spam-reporting event handler that calls the getAsFileAsync method and gets the user's responses from the SpamReporting event object.

- 1. In the **spamreporting.js** file, replace its contents with the following code.

```
JavaScript
// Handles the SpamReporting event to process a reported message.
function onSpamReport(event) {
 // Get the Base64-encoded EML format of a reported message.
 Office.context.mailbox.item.getAsFileAsync({ asyncContext: event },
(asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(`Error encountered during message processing: 
${asyncResult.error.message}`);
 return;
 }
 // Get the user's responses to the options and text box in the
preprocessing dialog.
 const spamReportingEvent = asyncResult.asyncContext;
 const reportedOptions = spamReportingEvent.options;
 const additionalInfo = spamReportingEvent.freeText;
 // Run additional processing operations here.
 // TODO - Signal that the spam-reporting event has completed processing.
 });
}
// IMPORTANT: To ensure your add-in is supported in Outlook, remember to map
the event handler name specified in the manifest to its JavaScript
counterpart.
Office.actions.associate("onSpamReport", onSpamReport);
```
#### 2. Save your changes.

#### 7 **Note**

To configure single sign-on (SSO) or cross-origin resource sharing (CORS) in your spamreporting add-in, you must add your add-in and its JavaScript file to a well-known URI. For guidance on how to configure this resource, see **Use single sign-on (SSO) or cross-origin resource sharing (CORS) in your event-based or spam-reporting Outlook add-in**.

### **Signal when the event has been processed**

{211}------------------------------------------------

Once the event handler has completed processing the message, it must call the [event.completed](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxevent#outlook-office-mailboxevent-completed-member(1)) method. In addition to signaling to the add-in that the spam-reporting event has been processed, event.completed can also be used to do the following:

- Customize a post-processing dialog to show to the user.
- Perform additional operations on the message, such as deleting it from the inbox.
- Open a task pane and pass information to it.

For a list of properties you can include in a JSON object to pass as a parameter to the event.completed method, see [Office.SpamReportingEventCompletedOptions](https://learn.microsoft.com/en-us/javascript/api/outlook/office.spamreportingeventcompletedoptions).

#### 7 **Note**

Code added after the event.completed call isn't guaranteed to run.

- 1. In the **spamreporting.js** file, replace its contents with the following code.

```
JavaScript
// Handles the SpamReporting event to process a reported message.
function onSpamReport(event) {
 // Get the Base64-encoded EML format of a reported message.
 Office.context.mailbox.item.getAsFileAsync({ asyncContext: event },
(asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(`Error encountered during message processing: 
${asyncResult.error.message}`);
 return;
 }
 // Get the user's responses to the options and text box in the
preprocessing dialog.
 const spamReportingEvent = asyncResult.asyncContext;
 const reportedOptions = spamReportingEvent.options;
 const additionalInfo = spamReportingEvent.freeText;
 // Run additional processing operations here.
 /**
 * Signals that the spam-reporting event has completed processing.
 * It then moves the reported message to the Junk Email folder of the
mailbox, then
 * shows a post-processing dialog to the user. If an error occurs while
the message
 * is being processed, the `onErrorDeleteItem` property determines
whether the message
 * will be deleted.
 */
 const event = asyncResult.asyncContext;
```

{212}------------------------------------------------

```
 event.completed({
 onErrorDeleteItem: true,
 moveItemTo: Office.MailboxEnums.MoveSpamItemTo.JunkFolder,
 showPostProcessingDialog: {
 title: "Contoso Spam Reporting",
 description: "Thank you for reporting this message.",
 },
 });
 });
}
// IMPORTANT: To ensure your add-in is supported in Outlook, remember to map
the event handler name specified in the manifest to its JavaScript
counterpart
Office.actions.associate("onSpamReport", onSpamReport);
```
#### 7 **Note**

If you're on classic Outlook on Windows Version 2308 (Build 16724.10000) or later, Outlook on Mac, Outlook on the web, or the new Outlook on Windows, you must use the moveItemTo property in the event.completed call to specify the folder to which a reported message is moved once it's processed by your add-in. On earlier Outlook builds on Windows that support the integrated spam-reporting feature, you must use the postProcessingAction property.

- 2. Save your changes.
The following is a sample post-processing dialog shown to the user once the add-in completes processing a reported message in classic Outlook on Windows. Note that the appearance of the dialog may vary depending on the platform the user's Outlook client is running on.

| Spam Reporting                        |  |
|---------------------------------------|--|
| Contoso Spam Reporting                |  |
| Thank you for reporting this message. |  |
| OK                                    |  |

#### **Tip**

As you develop a spam-reporting add-in that will run in classic Outlook on Windows, keep the following in mind.

{213}------------------------------------------------

- Imports aren't currently supported in the JavaScript file that contains the code to handle the spam-reporting event.
- When the JavaScript function specified in the manifest to handle the SpamReporting event runs, code in Office.onReady() and Office.initialize isn't run. We recommend adding any startup logic needed by the event handler, such as checking the user's Outlook version, to the event handler instead.

### **Update the commands HTML file**

- 1. In the **./src/commands** folder, open **commands.html**.
- 2. Immediately before the closing **head** tag ( </head> ), add the following **script** entry.

```
HTML
<script type="text/javascript" src="../spamreporting/spamreporting.js">
</script>
```
- 3. Save your changes.
# **Update the webpack config settings**

- 1. From the root directory of your add-in project, open the **webpack.config.js** file.
- 2. Locate the plugins array within the config object and add this new object to the beginning of the array.

```
JavaScript
new CopyWebpackPlugin({
 patterns: [
 {
 from: "./src/spamreporting/spamreporting.js",
 to: "spamreporting.js",
 },
 ],
}),
```
- 3. Save your changes.
# **Test and validate your add-in**

{214}------------------------------------------------

- 1. Sideload the add-in in a supported Outlook client.
- 2. Choose a message from your inbox, then select the add-in's button from the ribbon.
- 3. In the preprocessing dialog, choose a reason for reporting the message and add information about the message, if configured. Then, select **Report**.
- 4. (Optional) In the post-processing dialog, select **OK**.

# **Suppress the preprocessing dialog**

#### 7 **Note**

The "Don't show me this message again" option was introduced in **[requirement set 1.15](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.15/outlook-requirement-set-1.15)**. Learn more about its **[supported clients and platforms](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#outlook-client-support)**.

Depending on your scenario, you might not need a user to provide additional information about a message they're reporting. If the preprocessing dialog of your spam-reporting add-in only provides information to the user, you can choose to include a "Don't show me this message again" option in the dialog.

To implement this in your add-in, you must configure its manifest. The element or property to be configured differs depending on the type of manifest your add-in uses.

- **Unified manifest for Microsoft 365**: Set the

```
"extensions.ribbons.spamPreProcessingDialog.spamNeverShowAgainOption" property to
true . The following code is an example.
```

```
JSON
"extensions": [
 ...
 "ribbons": [
 {
 ...
 "spamPreProcessingDialog": {
```

{215}------------------------------------------------

- **Add-in only manifest**: In the [PreProcessingDialog](https://learn.microsoft.com/en-us/javascript/api/manifest/preprocessingdialog) element, set the [NeverShowAgainOption](https://learn.microsoft.com/en-us/javascript/api/manifest/preprocessingdialog#child-elements) child element to true . The following code is an example.

| XML                                                                                                                                                                                                                                                                                                             |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <br><preprocessingdialog><br/><title resid="PreProcessingDialog.Label"></title><br/><description resid="PreProcessingDialog.Text"></description><br/><nevershowagainoption>true</nevershowagainoption><br/><moreinfo><br/><moreinfotext resid="MoreInfo.Label"></moreinfotext></moreinfo></preprocessingdialog> |
| <moreinfourl resid="MoreInfo.Url"></moreinfourl><br><br>                                                                                                                                                                                                                                                        |
|                                                                                                                                                                                                                                                                                                                 |

Note the following behaviors when implementing this option in your add-in.

- The "Don't show me this message again" option appears in the preprocessing dialog only if there are no user input options configured, such as reporting options or a text box. If your manifest also specifies user input options, they'll be shown in the dialog instead.
- The option to suppress the preprocessing dialog is applied on a per-machine and perplatform basis.
- After suppressing the preprocessing dialog, if a user reports a message and has the [Reading Pane](https://support.microsoft.com/office/2fd687ed-7fc4-4ae3-8eab-9f9b8c6d53f0) turned on, a progress notification is shown on the message while it's being processed. If the Reading Pane is turned off, no progress notification is shown.

{216}------------------------------------------------

#### 7 **Note**

If you implement the "Don't show me this message again" option without configuring a post-processing dialog, a dialog with the following generic message is shown to the user after processing: "Thank you for reporting this message." It's good practice to configure a post-processing dialog to appear after a reported message is processed.

### **Reenable the preprocessing dialog**

To reenable the preprocessing dialog in classic Outlook on Windows after selecting the "Don't show me this message again" option, perform the following steps.

- 1. Open the **Registry Editor** as an administrator.
- 2. Navigate to **HKEY_CURRENT_USER\Software\Microsoft\Office\16.0\Outlook\Options\WebExt\Spam Dialog**.
- 3. Locate your spam-reporting add-in using its ID specified in the manifest.
- 4. Delete the entry of your add-in from the registry.

The preprocessing dialog will appear the next time a message is reported.

# **Open a task pane after reporting a message**

#### 7 **Note**

The option to implement a task pane from the event.completed method was introduced in **[requirement set 1.15](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.15/outlook-requirement-set-1.15)**. Learn more about its **[supported clients and platforms](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#outlook-client-support)**.

Instead of a post-processing dialog, you can implement a task pane to open after a user reports a message. For example, you can use the task pane to show additional information 

{217}------------------------------------------------

based on the user's input in the preprocessing dialog. Similar to the post-processing dialog, the task pane is implemented through the add-in's event.completed call.

#### 7 **Note**

If both the post-processing dialog and task pane capabilities are configured in the event.completed call, the task pane is shown instead of the dialog.

To configure a task pane to open after a message is reported, you must specify the ID of the task pane in the [commandId](https://learn.microsoft.com/en-us/javascript/api/outlook/office.spamreportingeventcompletedoptions#outlook-office-spamreportingeventcompletedoptions-commandid-member) option of the event.completed call. The ID must match the task pane's ID in the manifest. The location of the ID varies depending on the manifest your add-in uses.

- **Unified manifest for Microsoft 365**: The "id" property of the ["extensions.ribbons.tabs.groups.controls"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-common-custom-group-controls-item#id) object that represents the task pane.
- **Add-in only manifest**: The id attribute of the [Control](https://learn.microsoft.com/en-us/javascript/api/manifest/control) element that represents the task pane.

If you need to pass information to the task pane, specify any JSON data in the [contextData](https://learn.microsoft.com/en-us/javascript/api/outlook/office.spamreportingeventcompletedoptions#outlook-office-spamreportingeventcompletedoptions-contextdata-member) option of the event.completed call. To retrieve the value of the contextData option, you must call [Office.context.mailbox.item.getInitializationContextAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messageread#outlook-office-messageread-getinitializationcontextasync-member(1)) in the JavaScript implementation of your task pane.

#### ) **Important**

To ensure that the task pane of the spam-reporting add-in opens and receives context data after a message is reported, you must set the moveItemTo option of the event.completed call to Office.MailboxEnums.MoveSpamItemTo.NoMove .

The following code is an example.

```
JavaScript
...
 event.completed({
 commandId: "msgReadOpenPaneButton",
 contextData: JSON.stringify({ a: "aValue", b: "bValue" }),
 moveItemTo: Office.MailboxEnums.MoveSpamItemTo.NoMove
 });
```
If another task pane is open or pinned at the time a message is reported, the open task pane is closed then the task pane of the spam-reporting add-in is shown.

{218}------------------------------------------------

# **Review feature behavior and limitations**

As you develop and test the integrated spam-reporting feature in your add-in, be mindful of its characteristics and limitations.

- In Outlook on the web and on Windows (new and classic), an integrated spam-reporting add-in replaces the native **Report** button in the Outlook ribbon. If multiple spamreporting add-ins are installed, they will all appear in the **Report** section of the ribbon.
- A spam-reporting add-in can run for a maximum of five minutes once it's activated. Any processing that occurs beyond five minutes will cause the add-in to time out. If the addin times out, a dialog will be shown to the user to notify them of this.

| Spam Reporting                                               |  |
|--------------------------------------------------------------|--|
| Operation Timeout.                                           |  |
| We were unable to process this item. Please try again later. |  |
| OK                                                           |  |

- In classic Outlook on Windows, a spam-reporting add-in can be used to report a message even if the Reading Pane of the Outlook client is turned off. In Outlook on the web, on Mac, and in new Outlook on Windows, the spam-reporting add-in can be used if the Reading Pane is turned on or the message to be reported is open in another window.
- Only one message can be reported at a time. If you select multiple messages to report, the button of the spam-reporting add-in becomes unavailable.
- In classic Outlook on Windows, only one reported message can be processed at a time. If a user attempts to report another message while the previous one is still being processed, a dialog will be shown to notify them of this.

{219}------------------------------------------------

This doesn't apply to Outlook on the web or on Mac, or to the new Outlook on Windows. In these Outlook clients, a user can report a message from the Reading Pane and can simultaneously report each message that's open in a separate window.

- The add-in can still process the reported message even if the user navigates away from the selected message. In Outlook on Mac, this is only supported if a user reports a message while it's open in a separate window. If the user reports a message while viewing it from the Reading Pane and then navigates away from it, the reporting process is terminated.
- In Outlook on the web and the new Outlook on Windows, if a message is reported while it's open in a separate window, a post-processing dialog isn't shown to the user.
- The buttons that appear in the preprocessing and post-processing dialogs aren't customizable. Additionally, the text and buttons in the timeout and ongoing report dialogs can't be modified.
- The integrated spam-reporting and event-based activation features must use the same runtime. Multiple runtimes aren't currently supported in Outlook. To learn more about runtimes, see Runtimes in Office Add-ins.
- A spam-reporting add-in only implements function commands. A task pane command can't be assigned to the spam-reporting button on the ribbon. If you want to implement a task pane separate from the reporting functionality of your add-in, you must configure it in your manifest as follows:
	- **Add-in only manifest**: Include the [Action element](https://learn.microsoft.com/en-us/javascript/api/manifest/action#xsitype-is-showtaskpane) in the manifest and set its xsi:type attribute to ShowTaskpane .
	- **Unified manifest for Microsoft 365**: Configure a task pane object in the "extensions.runtimes" and "extensions.ribbons" arrays. For guidance, see the "Add a task pane command" section of Create add-in commands with the unified manifest for Microsoft 365.

Note that a separate button to activate the task pane will be added to the ribbon, but it won't appear in the dedicated spam-reporting area of the ribbon. If you want to

{220}------------------------------------------------

configure a task pane to open after a message is reported, see Open a task pane after reporting a message.

# **Troubleshoot your add-in**

As you develop your spam-reporting add-in, you might need to troubleshoot issues, such as your add-in not loading. For guidance on how to troubleshoot a spam-reporting add-in, see Troubleshoot event-based and spam-reporting add-ins.

# **See also**

- Office Add-ins manifest
- Runtimes in Office Add-ins
- Troubleshoot event-based and spam-reporting add-ins
- [ReportPhishingCommandSurface extension point](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#reportphishingcommandsurface)
- [Office.MessageRead.getAsFileAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messageread#outlook-office-messageread-getasfileasync-member(1))
- [Office.MailboxEnums.MoveSpamItemTo](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxenums.movespamitemto)
- [Office.SpamReportingEventArgs](https://learn.microsoft.com/en-us/javascript/api/outlook/office.spamreportingeventargs)
- [Office.SpamReportingEventCompletedOptions](https://learn.microsoft.com/en-us/javascript/api/outlook/office.spamreportingeventcompletedoptions)

{221}------------------------------------------------

# **Activate your Outlook add-in without the Reading Pane enabled or a message selected**

08/06/2025

With a simple manifest configuration, you can create Outlook add-ins for the Message Read surface that activate a task pane without the Reading Pane enabled or a message first selected from the mailbox. This feature is called "no item context". Follow the walkthrough to learn more and unlock additional capabilities for your add-in. For example, you can enable your users to access content from different data sources, such as OneDrive or a customer relationship management (CRM) system, directly from their Outlook client.

#### 7 **Note**

Support for this feature was introduced in **[requirement set 1.13](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.13/outlook-requirement-set-1.13)**. See **[clients and platforms](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients)** that support this requirement set.

Although Outlook on the web and **[new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** support requirement set 1.13, an add-in won't activate if the Reading Pane is hidden or a message isn't selected. For more information, see **Feature support in Outlook on the web and new Outlook on Windows**.

# **Set up your environment**

Complete the Outlook quick start in which you create an Outlook add-in with the Yeoman generator for Office Add-ins.

To turn on this feature in a preexisting add-in project, see Configure the manifest.

# **Configure the manifest**

The steps to configure the manifest vary depending on which type of manifest your add-in uses.

Unified manifest for Microsoft 365

7 **Note**

{222}------------------------------------------------

Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on Mac. To run this type of add-in on Mac, the add-in must first be published to **[AppSource](https://appsource.microsoft.com/)** then deployed in the **Microsoft 365 Admin Center**. For more information, see **Support for add-ins with the unified manifest for Microsoft 365**.

- 1. In your preferred code editor, open the [Outlook quick start](https://learn.microsoft.com/en-us/office/dev/add-ins/quickstarts/outlook-quickstart-json-manifest) project that you created.
- 2. Open the **manifest.json** file located at the root of the project.
- 3. In the first object in the ["extensions.runtimes"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array?view=m365-app-prev&preserve-view=true) array, do the following:
	- a. Change the ["requirements.capabilities.minVersion"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/requirements-extension-element-capabilities#minversion) to "1.13" .
	- b. Add a "supportsNoItemContext" property to the object in the ["actions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-actions-item) array and set its value to true .
	- c. Add a "multiselect" property to the same object and set it to true .
	- d. Change the "pinnable" property in the same object to true .

When you are done, it should look like the following.

```
JSON
"runtimes": [
 {
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox",
 "minVersion": "1.13"
 }
 ]
 },
 "id": "TaskPaneRuntime",
 "type": "general",
 "code": {
 "page": "https://localhost:3000/taskpane.html"
 },
 "lifetime": "short",
 "actions": [
 {
 "id": "TaskPaneRuntimeShow",
 "type": "openPage",
 "view": "dashboard",
 "pinnable": true,
 "supportsNoItemContext": true,
 "multiselect": true
 }
 ]
 }
]
```

{223}------------------------------------------------

- 4. Delete the second object in the "extensions.runtimes" array, whose "id" is "CommandsRuntime" .
- 5. The ["extensions.ribbons.tabs.groups.controls"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-custom-tab-groups-item#controls) array has two objects. Delete the second one, whose "id" is "ActionButton" .

### **Configure the task pane**

- 1. In your project, navigate to the **taskpane** folder, then open **taskpane.html**.
- 2. Replace the entire <body> element with the following markup.

```
HTML
<body class="ms-font-m ms-welcome ms-Fabric">
 <header class="ms-welcome__header ms-bgColor-neutralLighter">
 <img width="90" height="90" src="../../assets/logo-filled.png"
alt="logo" title="Add-in logo" />
 <h1 class="ms-font-su">Activate your add-in without enabling the
Reading Pane or selecting a message</h1>
 </header>
 <section id="sideload-msg" class="ms-welcome__main">
 <h2 class="ms-font-xl">Please <a target="_blank"
href="https://learn.microsoft.com/office/dev/add-ins/testing/test-debug-
office-add-ins#sideload-an-office-add-in-for-testing">sideload</a> your add-
in to see app body.</h2>
 </section>
 <main id="app-body" class="ms-welcome__main" style="display: none;">
 <ul class="ms-List ms-welcome__features">
 <li class="ms-ListItem">
 <i class="ms-Icon ms-Icon--CheckList ms-font-xl"></i>
 <span class="ms-font-m">Item multi-select is automatically
enabled when the <b>SupportsNoItemContext</b> manifest element is set to 
<code>true</code>. You can test this by selecting multiple messages in
Outlook, then choosing <b>Show Taskpane</b> from the ribbon.</span>
 </li>
 <li class="ms-ListItem">
 <i class="ms-Icon ms-Icon--Pin ms-font-xl"></i>
 <span class="ms-font-m">Support to pin the task pane is also
automatically enabled. You can test this by selecting the <b>pin</b> icon
from the top right corner of the task pane.</span>
 </li>
 <li class="ms-ListItem">
 <i class="ms-Icon ms-Icon--DockRight ms-font-xl"></i>
 <span class="ms-font-m">This feature can only be implemented
with a task pane.</span>
 </li>
 <li class="ms-ListItem">
 <i class="ms-Icon ms-Icon--Design ms-font-xl"></i>
```

{224}------------------------------------------------

```
 <span class="ms-font-m">Implement your scenario using this
feature today! For example, enable your users to access content from
different data sources, such as OneDrive or your customer relationship
management (CRM) system, without first selecting a message.</span>
 </li>
 </ul>
 </main>
</body>
```
- 3. Save your changes.
### **Update the task pane JavaScript file**

- 1. From the **taskpane** folder, open **taskpane.js**.
- 2. Navigate to the Office.onReady function and replace its contents with the following code.

```
JavaScript
if (info.host === Office.HostType.Outlook) {
 document.getElementById("sideload-msg").style.display = "none";
 document.getElementById("app-body").style.display = "flex";
}
```
- 3. Save your changes.
# **Try it out**

- 1. From a terminal, run the following code in the root directory of your project. This starts the local web server and sideloads your add-in.
command line npm start

7 **Note**

- When you first use Yeoman generator to develop an Office Add-in, your default browser opens a window where you'll be prompted to sign in to your Microsoft 365 account. If a sign-in window doesn't appear and you encounter a sideloading or login timeout error, run atk auth login m365 before running npm start again.

{225}------------------------------------------------

If your add-in wasn't automatically sideloaded, follow the instructions in **Sideload Outlook add-ins for testing** to manually sideload the add-in in Outlook.

- 2. Navigate to your inbox and do one of the following:
	- Turn off your Reading Pane. For guidance, see the "Turn on, turn off, or move the Reading Pane" section of [Use and configure the Reading Pane to preview](https://support.microsoft.com/office/2fd687ed-7fc4-4ae3-8eab-9f9b8c6d53f0) [messages](https://support.microsoft.com/office/2fd687ed-7fc4-4ae3-8eab-9f9b8c6d53f0) .
	- Deselect a message, if applicable. To deselect a message, hold the Ctrl key and select the message.
- 3. Select **Show Taskpane** from the ribbon.
- 4. Explore and test the suggestions listed in the task pane.
- 5. When you want to stop the local web server and uninstall the add-in, follow the applicable instructions:
	- To stop the server, run the following command. If you used npm start , the following command should also uninstall the add-in.

| npm stop | command line |  |  |  |  |  |  |
|----------|--------------|--|--|--|--|--|--|
|          |              |  |  |  |  |  |  |

- If you manually sideloaded the add-in, see Remove a sideloaded add-in.
# **Support for the item multi-select and pinnable task pane features**

Enabling support for no item context in the manifest automatically enables support for item multi-select and pinnable task pane features, even if these features aren't explicitly configured in the manifest.

# **Feature support in Outlook on the web and new Outlook on Windows**

In Outlook on the web and new Outlook on Windows, add-ins that implement no item context don't activate when the Reading Pane is hidden or when a message isn't selected. This is because add-in commands in Outlook on the web don't appear on the ribbon. To activate an

{226}------------------------------------------------

add-in from the Message Read surface, you must first select a message, then select the add-in command from the message action bar.

Since enabling no item context automatically enables the item multi-select feature, you'll be able to activate your add-in in Outlook on the web and new Outlook on Windows on multiple mail items.

# **See also**

- Activate your Outlook add-in on multiple messages
- Implement a pinnable task pane in Outlook

{227}------------------------------------------------

# **Drag and drop messages and attachments into the task pane of an Outlook add-in**

08/28/2025

Drag and drop functionality allows users to seamlessly transfer messages and file attachments from their mailbox directly into your add-in's task pane. With the drag-and-drop feature, users can perform the following without leaving the Outlook client.

- Import files into a document management interface for processing or archiving.
- Upload customer records and communication logs to a customer relationship management (CRM) system for tracking.
- Convert a file into another format.

# **Supported Outlook clients and surfaces**

The following table outlines the Outlook clients that support the drag-and-drop feature and the APIs used to implement it.

| Outlook client                | Support for<br>drag and drop | Implementation method                                | Supported Outlook<br>surfaces                                                       |
|-------------------------------|------------------------------|------------------------------------------------------|-------------------------------------------------------------------------------------|
| Outlook on the<br>web         | Supported                    | Office.js API<br>(Office.EventType.DragAndDropEvent) | Appointment<br>Compose<br>Appointment<br>Read<br>Message<br>Compose<br>Message Read |
| New Outlook<br>on Windows     | Supported                    | Office.js API<br>(Office.EventType.DragAndDropEvent) | Appointment<br>Compose<br>Appointment<br>Read<br>Message<br>Compose<br>Message Read |
| Classic Outlook<br>on Windows | Supported                    | HTML Drag and Drop API                               | Appointment<br>Compose<br>Appointment<br>Read                                       |

{228}------------------------------------------------

| Outlook client        | Support for<br>drag and drop | Implementation method  | Supported Outlook<br>surfaces                                                       |
|-----------------------|------------------------------|------------------------|-------------------------------------------------------------------------------------|
|                       |                              |                        | Message<br>Compose<br>Message Read                                                  |
| Outlook on<br>Mac     | Supported                    | HTML Drag and Drop API | Appointment<br>Compose<br>Appointment<br>Read<br>Message<br>Compose<br>Message Read |
| Outlook on iOS        | Not supported                | Not applicable         | Not applicable                                                                      |
| Outlook on<br>Android | Not supported                | Not applicable         | Not applicable                                                                      |

For information on which file types and scenarios are supported, see Feature behavior and limitations.

# **Implement the drag-and-drop feature**

The drag or drop event occurs when the mouse pointer enters an add-in's task pane. Handling the drag and drop events differs depending on the Outlook client. Select the tab for your applicable client.

#### 7 **Note**

This section assumes that a task pane has already been implemented for your Outlook add-in. For information about task panes, see **Add-in commands**. To create an add-in sample that already implements a task pane, follow the **Outlook quickstart**.

Web and Windows (new)

In Outlook on the web and the new Outlook on Windows, create a handler in your JavaScript file for the [Office.EventType.DragAndDropEvent](https://learn.microsoft.com/en-us/javascript/api/office/office.eventtype) event using the [Office.context.mailbox.addHandlerAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox#outlook-office-mailbox-addhandlerasync-member(1)) method. When the DragAndDropEvent event occurs, the handler receives a [DragAndDropEventArgs](https://learn.microsoft.com/en-us/javascript/api/outlook/office.draganddropeventargs) object so that you can identify when a user drags an item over the task pane, when they drop the item into the task pane, 

{229}------------------------------------------------

and what data is associated with the item. Depending on whether a drag or drop event occurred, the [dragAndDropEventData](https://learn.microsoft.com/en-us/javascript/api/outlook/office.draganddropeventargs#outlook-office-draganddropeventargs-draganddropeventdata-member) property of the DragAndDropEventArgs object returns a [DragoverEventData](https://learn.microsoft.com/en-us/javascript/api/outlook/office.dragovereventdata) or [DropEventData](https://learn.microsoft.com/en-us/javascript/api/outlook/office.dropeventdata) object. These objects provide information on the position of the mouse pointer and the data being transferred to the task pane.

When messages are dragged to the task pane, they're dropped as .eml files. Attachments that are dropped retain their current format. For a list of supported types, see Supported item types.

The following example shows how to implement the drag-and-drop feature.

```
JavaScript
// Handle the DragAndDropEvent event.
Office.context.mailbox.addHandlerAsync(
 Office.EventType.DragAndDropEvent,
 (event) => {
 console.log(`Event occurred: ${event.type}`);
 const eventData = event.dragAndDropEventData;
 // Get the file name and the contents of the items dropped into the
task pane.
 if (eventData.type == "drop") {
 const files = eventData.dataTransfer.files;
 files.forEach((file) => {
 const content = file.fileContent;
 const name = file.name;
 // Add operations to process the item here, such as uploading
the file to a CRM system.
 });
 }
 },
 (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.error("Failed to add event handler:",
asyncResult.error.message); 
 return;
 }
 console.log("Event handler added successfully.");
 }
);
```
# **Feature behavior and limitations**

**Supported item types**

{230}------------------------------------------------

The following file types are supported by the drag-and-drop feature.

- **Messages**: Messages in the .eml or .msg format. Additionally, the following types of encrypted messages are also supported.
	- Messages encrypted using the S/MIME (Secure/Multipurpose Internet Mail Extensions) protocol.
	- Messages protected by Information Rights Management (IRM) with a sensitivity label that has the **Allow programmatic access** custom policy option set to true .
- **Attachments**: File types supported by Outlook. For guidance, see [Blocked attachments in](https://support.microsoft.com/office/434752e1-02d3-4e90-9124-8b81e49a8519) [Outlook](https://support.microsoft.com/office/434752e1-02d3-4e90-9124-8b81e49a8519) .

#### **Tip**

For information on the types of data that the HTML Drag and Drop API supports, see **[Recommended drag types](https://developer.mozilla.org/docs/Web/API/HTML_Drag_and_Drop_API/Recommended_drag_types)** .

### **Supported scenarios**

The following table identifies which scenarios support the drag-and-drop feature in Outlook.

| ノ | Expand table |  |
|---|--------------|--|
|   |              |  |

| Scenario                                                                                                                                                           | Supports drag and drop |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------|
| Drag and drop a message or attachment from the Reading Pane<br>to an<br>add-in's task pane in the same window                                                      | Supported              |
| Drag and drop a message or an attachment from the Reading Pane to a<br>task pane open in a different window                                                        | Supported              |
| While a message is open in a different window, drag and drop an<br>attachment contained in the message to a task pane open in main window<br>of the Outlook client | Supported              |
| While a message is open in a different window, drag and drop an<br>attachment contained in the message to a task pane in the same window                           | Supported              |
| Drag and drop multiple attachments at the same time                                                                                                                | Supported              |
| Drag and drop multiple messages at the same time                                                                                                                   | Supported              |
| Drag and drop a mix of multiple messages and attachments at the same<br>time                                                                                       | Not supported          |
| Drag and drop a file from a task pane to the mailbox                                                                                                               | Not supported          |

{231}------------------------------------------------

| Scenario                                                                               | Supports drag and drop                                                                                               |
|----------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------|
| Drag and drop a file from the desktop to an add-in's task pane in Outlook              | Depends on the drag-and<br>drop API used.<br>Office.js API: Not<br>supported<br>HTML Drag and Drop<br>API: Supported |
| Drag and drop an item from another mailbox                                             | Not supported                                                                                                        |
| Drag and drop an item across two instances of the main window of the<br>Outlook client | Not supported                                                                                                        |
| Drag and drop an item across different Outlook clients                                 | Not supported                                                                                                        |

### **Limitations**

Be aware of the following limitations when implementing drag and drop in your add-in.

- If a user navigates to another mail item while an item that's been dragged to an add-in's task pane is being processed, the behavior varies depending on whether the task pane is pinned. If the task pane is pinned, processing isn't interrupted. Otherwise, processing fails. We recommend including progress indicators and displaying error messages for user awareness.
- Inline image attachments and links in messages can't be dropped into the task pane. For guidance on supported items, see Supported item types.

# **See also**

- Add-in commands
- Implement a pinnable task pane in Outlook
- Limits for activation and JavaScript API for Outlook add-ins

{232}------------------------------------------------

# **Activate your Outlook add-in on multiple messages**

07/15/2025

With the item multi-select feature, your Outlook add-in can now activate and perform operations on multiple selected messages in one go. Certain operations, such as uploading messages to your Customer Relationship Management (CRM) system or categorizing numerous items, can now be easily completed with a single click.

The following sections show how to configure your add-in to retrieve the subject line and sender's email address of multiple messages in read mode.

#### 7 **Note**

Support for the item multi-select feature was introduced in **[requirement set 1.13](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.13/outlook-requirement-set-1.13)**, with additional item properties now available in subsequent requirement sets. See **[clients and](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients) [platforms](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients)** that support this requirement set.

# **Set up your environment**

Complete the Outlook quick start to create an add-in project with the Yeoman generator for Office Add-ins.

# **Configure the manifest**

Unified manifest for Microsoft 365

#### 7 **Note**

Implementing the item multi-select feature with a unified manifest for Microsoft 365 is currently only supported in classic Outlook on Windows. For other supported platforms, use the add-in only manifest instead.

1. In your preferred code editor, open the Outlook quick start project you created.

2. Open the **manifest.json** file located at the root of the project.

{233}------------------------------------------------

- 3. In the ["authorization.permissions.resourceSpecific"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-authorization-permissions#resourcespecific) array, change the value of the "name" property to "Mailbox.ReadWrite.User" . It should look like the following when you're done.

```
JSON
"authorization": {
 "permissions": {
 "resourceSpecific": [
 {
 "name": "Mailbox.ReadWrite.User",
 "type": "Delegated"
 }
 ]
 }
},
```
- 4. In first object of the ["extensions.runtimes"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array?view=m365-app-prev&preserve-view=true) array, make the following changes.
	- a. Change the ["requirements.capabilities.minVersion"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/requirements-extension-element-capabilities#minversion) property to "1.15" . Although the item multi-select feature was introduced in requirement set 1.13, this sample uses enhancements from later requirement sets.
	- b. In the same ["actions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-actions-item) object, add the "supportsNoItemContext" property and set it to true .
	- c. In the same "actions" object, add the "multiselect" property and set it to true .

Your code should look like the following after you've made the changes.

```
JSON
"runtimes": [
 {
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox",
 "minVersion": "1.15"
 }
 ]
 },
 "id": "TaskPaneRuntime",
 "type": "general",
 "code": {
 "page": "https://localhost:3000/taskpane.html"
 },
 "lifetime": "short",
 "actions": [
 {
 "id": "TaskPaneRuntimeShow",
 "type": "openPage",
```

{234}------------------------------------------------

```
 "pinnable": false,
 "view": "dashboard",
 "supportsNoItemContext": true,
 "multiselect": true
 }
 ]
 },
 ...
]
```
- 5. Delete the second object of the "extensions.runtimes" array, whose "id" is "CommandsRuntime" .
- 6. In the "extensions.ribbons.tabs.controls" array, delete the second object, whose "id" is "ActionButton" .
- 7. Save your changes.

#### 7 **Note**

If you turn on the item multi-select feature in your add-in, your add-in will automatically support the **no item context** feature, even if it isn't explicitly configured in the manifest. For more information on task pane pinning behavior in multi-select add-ins, see **Task pane pinning in multi-select add-ins**.

### **Configure the task pane**

Item multi-select relies on the [SelectedItemsChanged](https://learn.microsoft.com/en-us/javascript/api/office/office.eventtype) event to determine when messages are selected or deselected. This event requires a task pane implementation.

- 1. From the **./src/taskpane** folder, open **taskpane.html**.
- 2. In the **<body>** element, replace the entire **<main>** element with the following markup.

```
HTML
<main id="app-body" class="ms-welcome__main">
 <h2 class="ms-font-l">Get information about each selected message</h2>
 <ul id="selected-items"></ul>
 <div role="button" id="run" class="ms-welcome__action ms-Button ms-
Button--hero ms-font-xl">
 <span class="ms-Button-label">Get information</span>
```

{235}------------------------------------------------

- 3. Save your changes.
# **Implement a handler for the SelectedItemsChanged event**

To alert your add-in when the SelectedItemsChanged event occurs, you must register an event handler using the addHandlerAsync method.

- 1. From the **./src/taskpane** folder, open **taskpane.js**.
- 2. Replace the Office.onReady() function with the following:

```
JavaScript
let list;
Office.onReady((info) => {
 if (info.host === Office.HostType.Outlook) {
 document.getElementById("sideload-msg").style.display = "none";
 document.getElementById("app-body").style.display = "flex";
 document.getElementById("run").onclick = run;
 list = document.getElementById("selected-items");
 // Register an event handler to identify when messages are selected.

Office.context.mailbox.addHandlerAsync(Office.EventType.SelectedItemsChanged,
run, (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(asyncResult.error.message);
 return;
 }
 console.log("Event handler added.");
 });
 }
});
```
- 3. Save your changes.
# **Get properties and run operations on selected messages**

{236}------------------------------------------------

Now that you've registered an event handler, your add-in can now get properties or run operations on multiple selected messages. There are two ways to process selected messages. The use of each option depends on the properties and operations you need for your scenario.

- Call the [getSelectedItemsAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox#outlook-office-mailbox-getselecteditemsasync-member(1)) method to get the following properties.
	- Attachment boolean
	- Conversation ID
	- Internet message ID
	- Item ID
	- Item mode ( Read or Compose )
	- Item type ( Message is the only supported type at this time)
	- Subject line
- Call the [loadItemByIdAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox?view=outlook-js-1.15&preserve-view=true#outlook-office-mailbox-loaditembyidasync-member(1)) method to get properties that aren't provided by getSelectedItemsAsync or to run operations on the selected messages. The loadItemByIdAsync method loads one selected message at a time using the message's Exchange Web Services (EWS) ID. To get the EWS IDs of the selected messages, we recommend calling getSelectedItemsAsync . After processing a selected message using loadItemByIdAsync , you must call the [unloadAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.loadedmessageread?view=outlook-js-1.15&preserve-view=true#outlook-office-loadedmessageread-unloadasync-member(1)) method before calling loadItemByIdAsync on another selected message.

### **Tip**

- The loadItemByIdAsync and unloadAsync methods were introduced in **[requirement set 1.15](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.15/outlook-requirement-set-1.15)**. Learn more about its **[supported clients and platforms](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#outlook-client-support)**.
- Before you use the loadItemByIdAsync method, determine if you can already access the properties you need using getSelectedItemsAsync . If you can, you don't need to call loadItemByIdAsync .

The following example implements the getSelectedItemsAsync and loadItemByIdAsync methods to get the subject line and sender's email address from each selected message.

- 1. In **taskpane.js**, replace the existing run function with the following code.

```
JavaScript
export async function run() {
 // Clear the list of previously selected messages, if any.
 clearList(list);
 // Get the subject line and sender's email address of each selected message
and log them to a list in the task pane.
 Office.context.mailbox.getSelectedItemsAsync((asyncResult) => {
```

{237}------------------------------------------------

```
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(asyncResult.error.message);
 return;
 }
 const selectedItems = asyncResult.value;
 getItemInfo(selectedItems);
 });
}
// Gets the subject line and sender's email address of each selected message.
async function getItemInfo(selectedItems) {
 for (const item of selectedItems) {
 addToList(item.subject);
 if (Office.context.requirements.isSetSupported("Mailbox", "1.15")) {
 await getSenderEmailAddress(item);
 }
 }
}
// Gets the sender's email address of each selected message.
async function getSenderEmailAddress(item) {
 const itemId = item.itemId;
 await new Promise((resolve) => {
 Office.context.mailbox.loadItemByIdAsync(itemId, (result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.log(result.error.message);
 return;
 }
 const loadedItem = result.value;
 const sender = loadedItem.from.emailAddress;
 appendToListItem(sender);
 // Unload the current message before processing another selected
message.
 loadedItem.unloadAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(asyncResult.error.message);
 return;
 }
 resolve();
 });
 });
 });
}
// Clears the list in the task pane.
function clearList(list) {
 while (list.firstChild) {
 list.removeChild(list.firstChild);
 }
}
```

{238}------------------------------------------------

```
// Adds an item to a list in the task pane.
function addToList(item) {
 const listItem = document.createElement("li");
 listItem.textContent = item;
 list.appendChild(listItem);
}
// Appends data to the last item of the list in the task pane.
function appendToListItem(data) {
 const listItem = list.lastChild;
 listItem.textContent += ` (${data})`;
}
```
- 2. Save your changes.
# **Try it out**

- 1. From a terminal, run the following code in the root directory of your project. This starts the local web server and sideloads your add-in.
command line npm start

#### 7 **Note**

- When you first use Yeoman generator to develop an Office Add-in, your default browser opens a window where you'll be prompted to sign in to your Microsoft 365 account. If a sign-in window doesn't appear and you encounter a sideloading or login timeout error, run atk auth login m365 before running npm start again.
If your add-in wasn't automatically sideloaded, follow the instructions in **Sideload Outlook add-ins for testing** to manually sideload the add-in in Outlook.

- 2. In Outlook, ensure the Reading Pane is enabled. To enable the Reading Pane, see [Use and](https://support.microsoft.com/office/2fd687ed-7fc4-4ae3-8eab-9f9b8c6d53f0) [configure the Reading Pane to preview messages](https://support.microsoft.com/office/2fd687ed-7fc4-4ae3-8eab-9f9b8c6d53f0) .
- 3. Navigate to your inbox and choose multiple messages by holding Ctrl while selecting messages.
- 4. Select **Show Taskpane**. The location of the add-in varies depending on your Outlook client. For guidance, see [Use add-ins in Outlook](https://support.microsoft.com/office/1ee261f9-49bf-4ba6-b3e2-2ba7bcab64c8) .

{239}------------------------------------------------

- 5. In the task pane, select **Get information**. A list of the selected messages' subject lines and sender email addresses is displayed in the task pane.
- 6. When you want to stop the local web server and uninstall the add-in, follow the applicable instructions:
	- To stop the server, run the following command. If you used npm start , the following command should also uninstall the add-in.

| command line |  |  |  |  |  |  |
|--------------|--|--|--|--|--|--|
| npm stop     |  |  |  |  |  |  |

- If you manually sideloaded the add-in, see Remove a sideloaded add-in.

{240}------------------------------------------------

# **Item multi-select behavior and limitations**

Item multi-select only supports messages within an Exchange mailbox in both read and compose modes. An Outlook add-in only activates on multiple messages if the following conditions are met.

- The messages must be selected from one Exchange mailbox at a time. Non-Exchange mailboxes aren't supported.
- The messages must be selected from one mailbox folder at a time. An add-in doesn't activate on multiple messages if they're located in different folders, unless Conversations view is enabled. For more information, see Multi-select in conversations.
- An add-in must implement a task pane in order to detect the SelectedItemsChanged event.
- The [Reading Pane](https://support.microsoft.com/office/2fd687ed-7fc4-4ae3-8eab-9f9b8c6d53f0) in Outlook must be enabled. An exception to this is if the item multiselect feature is enabled through the no item context feature in the manifest. To learn more, see Activate your Outlook add-in without the Reading Pane enabled or a message selected.
- A maximum of 100 messages can be selected at a time.
- The loadItemByIdAsync method only processes one selected message at a time. Remember to call unloadAsync after loadItemByIdAsync finishes processing the message. This way, the add-in can load and process the next selected message.
- Typically, you can only run get operations on a selected message that's loaded using the loadItemByIdAsync method. However, managing the [categories](https://learn.microsoft.com/en-us/javascript/api/outlook/office.categories) of a loaded message is an exception. You can add, get, and remove categories from a loaded message.
- The loadItemByIdAsync method is supported in task pane and function command addins. This method isn't supported in event-based activation add-ins.

#### 7 **Note**

Meeting invites and responses are considered messages, not appointments, and can therefore be included in a selection.

### **Multi-select in conversations**

Item multi-select supports [Conversations view](https://support.microsoft.com/office/0eeec76c-f59b-4834-98e6-05cfdfa9fb07) whether it's enabled on your mailbox or on specific folders. The following table describes expected behaviors when conversations are expanded or collapsed, when the conversation header is selected, and when conversation messages are located in a different folder from the one currently in view.

{241}------------------------------------------------

| Selection                                                                                                                         | Expanded conversation view                                                                                                | Collapsed conversation view                                                                                                                                                                                                               |
|-----------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Conversation header is<br>selected                                                                                                | If the conversation header is the only<br>item selected, an add-in supporting<br>multi-select doesn't activate. However,  | The behavior differs depending on<br>the Outlook client.                                                                                                                                                                                  |
|                                                                                                                                   | if other non-header messages are also<br>selected, the add-in will only activate<br>on those and not the selected header. | Outlook on Windows (classic) and<br>on Mac:<br>The newest message (that is, the<br>first message in the conversation<br>stack) is included in the message<br>selection.                                                                   |
|                                                                                                                                   |                                                                                                                           | If the newest message in the<br>conversation is located in another<br>folder from the one currently in<br>view, the subsequent message in<br>the stack located in the current<br>folder is included in the selection.                     |
|                                                                                                                                   |                                                                                                                           | Outlook on the web and new<br>Outlook on Windows:<br>All the messages in the<br>conversation stack are selected.<br>This includes messages in the<br>conversation that are located in<br>folders other than the one<br>currently in view. |
| Multiple selected<br>messages in a<br>conversation stack are<br>located in the same<br>folder as the one<br>currently in view     | All chosen messages in the same<br>conversation are included in the<br>selection.                                         | Not applicable. You must expand<br>the conversation stack to select<br>multiple messages from it.                                                                                                                                         |
| Multiple selected<br>messages in a<br>conversation stack are<br>located in different<br>folders from the one<br>currently in view | All chosen messages in the same<br>conversation are included in the<br>selection.                                         | Not applicable. You must expand<br>the conversation stack to select<br>multiple messages from it.                                                                                                                                         |

#### 7 **Note**

On all Outlook clients, you can't select multiple messages that belong to different conversations. If you expand a different conversation while another conversation is 

{242}------------------------------------------------

expanded, the view of the currently expanded conversation collapses and any selected messages are deselected. However, you can select multiple messages from the same expanded conversation and messages that aren't part of any conversation at the same time.

### **Task pane pinning in multi-select add-ins**

In Outlook on the web, on Mac, and in new Outlook on Windows, when the task pane of a multi-select add-in is opened, it's automatically pinned to the Outlook client. It remains pinned even when a user switches to a different mail item or selects the **pin** icon from the task pane. The task pane can only be closed by selecting the **Close** button from the task pane.

Conversely, in classic Outlook on Windows, the task pane isn't automatically pinned and closes when a user switches to a different mail item.

# **Next steps**

Now that you've enabled your add-in to operate on multiple selected messages, you can extend your add-in's capabilities and further enhance the user experience. Explore performing more complex operations by using the selected messages' item IDs with services, such as [Microsoft Graph.](https://learn.microsoft.com/en-us/graph/overview)

# **See also**

- Office Add-in manifests
- Call web services from an Outlook add-in
- [Overview of Microsoft Graph](https://learn.microsoft.com/en-us/graph/overview)
- Activate your Outlook add-in without the Reading Pane enabled or a message selected

{243}------------------------------------------------

# **Implement a pinnable task pane in Outlook**

08/06/2025

The task pane UX shape for add-in commands opens a vertical task pane to the right of an open message or meeting request. This allows an add-in to provide UI for more detailed interactions, such as filling in multiple text fields. This task pane can be shown in the Reading Pane when viewing a list of messages, allowing for quick processing of a message.

However, by default, if a user has an add-in task pane open for a message in the Reading Pane, and then selects a new message, the task pane is automatically closed. For a heavily-used addin, the user may prefer to keep that pane open, eliminating the need to reactivate the add-in on each message. With pinnable task panes, your add-in can give the user that option.

#### 7 **Note**

Although the pinnable task pane feature was introduced in **[requirement set 1.5](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.5/outlook-requirement-set-1.5)**, it's currently only available to Microsoft 365 subscribers using the following:

- Modern Outlook on the web
- **[New Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)**
- Classic Outlook 2016 or later on Windows (Build 7668.2000 or later for users in the Current or Microsoft 365 Insider Channels, Build 7900.xxxx or later for users in Deferred channels)
- Outlook on Mac (Version 16.13 (18050300) or later)

#### ) **Important**

Pinnable task panes aren't available for the following:

- Appointments/Meetings
- Outlook.com

# **Supported Outlook modes**

Pinnable task panes are supported in both the Message Compose and Message Read modes in Outlook. However, pinning isn't supported across different modes. This is because an add-in could have different UIs for buttons and task panes in each mode. For example, if a user pins the task pane of an add-in while reading a message, then creates a new message, they won't

{244}------------------------------------------------

see the add-in's task pane from the message they're composing. To view the task pane, the user must activate the add-in from the message they're composing. If the user then pins the task pane, the task pane remains pinned the next time the user composes another message.

# **Support task pane pinning**

The first step is to add pinning support, which is done in the add-in manifest. The markup varies depending on the type of manifest your add-in uses.

```
Add a "pinnable" property, set to true , to the object in the "actions" array that defines
the button or menu item that opens the task pane. The following is an example.
  JSON
Unified manifest for Microsoft 365
  7 Note
  Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in
  Outlook on Mac. To run this type of add-in on Mac, the add-in must first be published
  to AppSource then deployed in the Microsoft 365 Admin Center. For more
  information, see Support for add-ins with the unified manifest for Microsoft 365.
  "actions": [
   {
   "id": "OpenTaskPane",
   "type": "openPage",
   "view": "TaskPaneView",
   "displayName": "OpenTaskPane",
   "pinnable": true
   }
  ]
```
For a full example, see the msgReadOpenPaneButton control in the [command-demo sample](https://github.com/OfficeDev/outlook-add-in-command-demo/blob/master/command-demo-manifest.xml) [manifest](https://github.com/OfficeDev/outlook-add-in-command-demo/blob/master/command-demo-manifest.xml) .

#### 7 **Note**

Task pane pinning is automatically supported in an add-in that activates without the Reading Pane enabled or a message first selected. To learn more, see **Activate your Outlook add-in without the Reading Pane enabled or a message selected**.

{245}------------------------------------------------

# **Handling UI updates based on currently selected message**

To update your task pane's UI or internal variables based on the current item, you'll need to register an event handler to get notified of the change.

### **Implement the event handler**

The event handler should accept a single parameter, which is an object literal. The type property of this object will be set to Office.EventType.ItemChanged . When the event is called, the Office.context.mailbox.item object is already updated to reflect the currently selected item.

```
JavaScript
function itemChanged(eventArgs) {
 // Update UI based on the new current item.
 updateTaskPaneUI(Office.context.mailbox.item);
}
```
#### ) **Important**

The implementation of event handlers for an ItemChanged event should check whether or not the Office.content.mailbox.item is null.

```
JavaScript
// Example implementation.
function updateTaskPaneUI(item) {
 // Assuming that item is always a read item (instead of a compose item).
 if (item != null) console.log(item.subject);
}
```
### **Register the event handler**

Use the [Office.context.mailbox.addHandlerAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#methods) method to register your event handler for the Office.EventType.ItemChanged event. This should be done in the Office.onReady function of your task pane.

JavaScript

{246}------------------------------------------------

```
Office.onReady(() => {
 $(document).ready(() => {
 // Set up the ItemChanged event.
 Office.context.mailbox.addHandlerAsync(Office.EventType.ItemChanged,
itemChanged);
 updateTaskPaneUI(Office.context.mailbox.item);
 });
});
```
# **Task pane pinning in multi-select**

In Outlook on the web, on Mac, and in the new Outlook on Windows, when the task pane of an add-in that implements the item multi-select feature is opened, it's automatically pinned to the Outlook client. It remains pinned even when a user switches to a different mail item or selects the **pin** icon from the task pane. The task pane can only be closed by selecting the **Close** button from the task pane.

Conversely, in classic Outlook on Windows, the task pane of a multi-select add-in isn't automatically pinned and closes when a user switches to a different mail item.

# **Deploy to users**

If you plan to publish your Outlook add-in to [AppSource](https://appsource.microsoft.com/) and it's configured with a pinnable task pane, the pinned content of the add-in must not be static. That is, the pinned content must change depending on the message or appointment that's currently open or selected in the mailbox. This ensures that your add-in will pass AppSource validation.

# **See also**

For an example add-in that implements a pinnable task pane, see [command-demo](https://github.com/OfficeDev/outlook-add-in-command-demo) on GitHub.

{247}------------------------------------------------

# **Prepend or append content to a message or appointment body on send**

08/01/2025

The prepend-on-send and append-on-send features enable your Outlook add-in to insert content to the body of a message or appointment when the mail item is sent. These features further boost your users' productivity and security by enabling them to:

- Add sensitivity and classification labels to their messages and appointments for easier item identification and organization.
- Insert disclaimers for legal purposes.
- Add standardized headers for marketing and communication purposes.

In this walkthrough, you'll develop an add-in that prepends a header and appends a disclaimer when a message is sent.

7 **Note**

Support for the append-on-send feature was introduced in **[requirement set 1.9](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.9/outlook-requirement-set-1.9)**, while support for the prepend-on-send feature was introduced in **[requirement set 1.13](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.13/outlook-requirement-set-1.13)**. See **[clients and platforms](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients)** that support these requirement sets.

# **Set up your environment**

Complete the Outlook quick start which creates an add-in project with the Yeoman generator for Office Add-ins.

# **Configure the manifest**

To configure the manifest, select the tab for the type of manifest you'll use.

Unified manifest for Microsoft 365

#### 7 **Note**

Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on Mac. To run this type of add-in on Mac, the add-in must first be published

{248}------------------------------------------------

#### to **[AppSource](https://appsource.microsoft.com/)** then deployed in the **Microsoft 365 Admin Center**. For more information, see **Support for add-ins with the unified manifest for Microsoft 365**.

The following shows how to configure your unified manifest to enable the prepend-onsend and append-on-send features.

- 1. Open the **manifest.json** file.
- 2. Add the following object to the ["extensions.runtimes"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array?view=m365-app-prev&preserve-view=true) array. Note the following about this code.
	- The "minVersion" of the Mailbox requirement set is set to "1.13" , so the addin can't be installed on platforms and Office versions where this feature isn't supported.
	- The "id" of the runtime is set to the descriptive name, "function_command_runtime" .
	- The ["code.page"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtime-code#page) property is set to the URL of the UI-less HTML file that will load the function command.
	- The "lifetime" property is set to "short" , which means that the runtime starts up when the function command button is selected and shuts down when the function completes. (In certain rare cases, the runtime shuts down before the handler completes. See Runtimes in Office Add-ins.)
	- There are actions specified to run the "prependHeaderOnSend" and "appendDisclaimerOnSend" functions. You'll create these functions in a later step.

```
JSON
```

```
{
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox",
 "minVersion": "1.13"
 }
 ],
 "formFactors": [
 "desktop"
 ]
 },
 "id": "function_command_runtime",
 "type": "general",
 "code": {
 "page": "https://localhost:3000/commands.html"
 },
 "lifetime": "short",
 "actions": [
 {
```

{249}------------------------------------------------

```
 "id": "prependHeaderOnSend",
 "type": "executeFunction",
 "displayName": "prependHeaderOnSend"
 },
 {
 "id": "appendDisclaimerOnSend",
 "type": "executeFunction",
 "displayName": "appendDisclaimerOnSend"
 }
 ]
}
```
- 3. Add the following object to the ["extensions.ribbons"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/element-extensions#ribbons-property) array. Note the following about this code.
	- The "mailCompose" value is added to the "contexts" array to surface the prepend-on-send and append-on-send buttons in a compose window.
	- The "controls" objects create and configure the buttons for the prepend-onsend and append-on-send functions. The "actionId" property of each object must reflect the same value specified in the applicable ["actions.id"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-actions-item#id) property of the "extensions.runtimes" object.

```
JSON
{
 "contexts": [
 "mailCompose"
 ],
 "tabs": [
 {
 "builtInTabId": "TabDefault",
 "groups": [
 {
 "id": "msgComposeGroup",
 "label": "Contoso Add-in",
 "icons": [
 {
 "size": 16,
                "url" "https://localhost:3000/assets/icon-
16.png"
 },
              {
 "size": 32,
                "url" "https://localhost:3000/assets/icon-
32.png"
 },
              {
 "size": 80,
                "url" "https://localhost:3000/assets/icon-
80.png"
 }
```

{250}------------------------------------------------

```
 ],
 "controls": [
 {
 "id": "PrependButton",
               "type": "button",
               "label": "Prepend header",
               "icons": [
 {
 "size": 16,
                   "url"
"https://localhost:3000/assets/icon-16.png"
 },
                 {
 "size": 32,
                   "url"
"https://localhost:3000/assets/icon-32.png"
 },
                 {
 "size": 80,
                   "url"
"https://localhost:3000/assets/icon-80.png"
 }
 ],
               "supertip": {
 "title": "Prepend header on send",
                 "description": "Prepend the Contoso
header on send."
 },
               "actionId": "prependHeaderOnSend"
 },
             {
 "id": "AppendButton",
               "type": "button",
               "label": "Add disclaimer",
               "icons": [
 {
 "size": 16,
                   "url"
"https://localhost:3000/assets/icon-16.png"
 },
                 {
 "size": 32,
                   "url"
"https://localhost:3000/assets/icon-32.png"
 },
                 {
 "size": 80,
                   "url"
"https://localhost:3000/assets/icon-80.png"
 }
 ],
               "supertip": {
 "title": "Append disclaimer on send",
                 "description": "Append the Contoso
disclaimer on send."
```

{251}------------------------------------------------

- 4. In the ["authorization.permissions.resourceSpecific"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-authorization-permissions#resourcespecific) array, add the following object. Be sure it's separated from other objects in the array with a comma.

```
JSON
{
 "name": "Mailbox.AppendOnSend.User",
 "type": "Delegated"
}
```
- 5. Save your changes.
#### **Tip**

- The prepend-on-send and append-on-send features must be activated by the user through a task pane or function command button. If you want content to be prepended or appended on send without additional action from the user, you can implement these features in an **event-based activation add-in**.
- To learn more about manifests for Outlook add-ins, see **Office Add-in manifests**.

# **Implement the prepend-on-send handler**

In this section, you'll implement the JavaScript code to prepend a sample company header to a mail item when it's sent.

- 1. Navigate to the **./src/commands** folder of your project and open the **commands.js** file.
- 2. Insert the following function at the end of the file.

```
JavaScript
function prependHeaderOnSend(event) {
 // It's recommended to call the getTypeAsync method and pass its returned
```

{252}------------------------------------------------

```
value to the options.coercionType parameter of the prependOnSendAsync call.
 Office.context.mailbox.item.body.getTypeAsync(
 {
 asyncContext: event
 },
 (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(asyncResult.error.message);
 return;
 }
 // Sets the header to be prepended to the body of the message on send.
 const bodyFormat = asyncResult.value;
 // Because of the various ways in which HTML text can be formatted, the
content may render differently when it's prepended to the mail item body.
 // In this scenario, a <br> tag is added to the end of the HTML string
to preserve its format.
 const header = '<div style="border:3px solid #000;padding:15px;"><h1
style="text-align:center;">Contoso Limited</h1></div><br>';
 Office.context.mailbox.item.body.prependOnSendAsync(
 header,
 {
 asyncContext: asyncResult.asyncContext,
 coercionType: bodyFormat
 },
 (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(asyncResult.error.message);
 return;
 }
 console.log("The header will be prepended when the mail item is
sent.");
 asyncResult.asyncContext.completed();
 }
 );
 });
}
```
- 3. Save your changes.
# **Implement the append-on-send handler**

In this section, you'll implement the JavaScript code to append a sample company disclaimer to a mail item when it's sent.

- 1. In the same **commands.js** file, insert the following function after the prependHeaderOnSend function.

{253}------------------------------------------------

```
function appendDisclaimerOnSend(event) { 
 // Calls the getTypeAsync method and passes its returned value to the
options.coercionType parameter of the appendOnSendAsync call.
 Office.context.mailbox.item.body.getTypeAsync(
 {
 asyncContext: event
 }, 
 (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(asyncResult.error.message);
 return;
 }
```
 // Sets the disclaimer to be appended to the body of the message on send. const bodyFormat = asyncResult.value; const disclaimer =

 '<p style = "color:blue"> <i>This and subsequent emails on the same topic are for discussion and information purposes only. Only those matters set out in a fully executed agreement are legally binding. This email may contain confidential information and should not be shared with any third party without the prior written agreement of Contoso. If you are not the intended recipient, take no action and contact the sender immediately.<br> <br>Contoso Limited (company number 01624297) is a company registered in England and Wales whose registered office is at Contoso Campus, Thames Valley Park, Reading RG6 1WG</i></p>';

```
 Office.context.mailbox.item.body.appendOnSendAsync(
 disclaimer,
 {
 asyncContext: asyncResult.asyncContext,
 coercionType: bodyFormat
 },
 (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(asyncResult.error.message);
 return;
 }
 console.log("The disclaimer will be appended when the mail item is
sent.");
 asyncResult.asyncContext.completed();
 }
 );
 });
}
```
- 2. Save your changes.
# **Register the JavaScript functions**

{254}------------------------------------------------

- 1. In the same **commands.js** file, insert the following after the appendDisclaimerOnSend function. These calls map the function name specified in the manifest to its JavaScript counterpart. The location of the function name in the manifest varies depending on the type of manifest your add-in uses.
- **Add-in only manifest**: The function name specified in the <FunctionName> element.
- **Unified manifest for Microsoft 365**: The function name specified in the "id" property of the objects in the "extensions.runtimes.actions" array.

```
JavaScript
Office.actions.associate("prependHeaderOnSend", prependHeaderOnSend);
Office.actions.associate("appendDisclaimerOnSend", appendDisclaimerOnSend);
```
- 1. Save your changes.
# **Try it out**

- 1. Run the following command in the root directory of your project. When you run this command, the local web server will start if it's not already running and your add-in will be sideloaded.

| command line |  |  |  |  |  |  |
|--------------|--|--|--|--|--|--|
| npm start    |  |  |  |  |  |  |
|              |  |  |  |  |  |  |

```
7 Note
```
- When you first use Yeoman generator to develop an Office Add-in, your default browser opens a window where you'll be prompted to sign in to your Microsoft 365 account. If a sign-in window doesn't appear and you encounter a sideloading or login timeout error, run atk auth login m365 before running npm start again.
If your add-in wasn't automatically sideloaded, follow the instructions in **Sideload Outlook add-ins for testing** to manually sideload the add-in in Outlook.

- 2. Create a new message, and add yourself to the **To** line.
- 3. (Optional) Enter text in the body of the message.

{255}------------------------------------------------

- 4. From the ribbon or overflow menu, select **Prepend header**.
- 5. From the ribbon or overflow menu, select **Add disclaimer**.
- 6. Send the message, then open it from your **Inbox** or **Sent Items** folder to view the inserted content.

| Contoso Limited                                                                                                                                                                                                                                                                                                                                                                                                               |  |  |  |  |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|--|--|
| Hi Adele,                                                                                                                                                                                                                                                                                                                                                                                                                     |  |  |  |  |
| The updated reported has been shared with the team.<br>Diego                                                                                                                                                                                                                                                                                                                                                                  |  |  |  |  |
| This and subsequent emails on the same topic are for discussion and information purposes only. Only those matters set out in a fully<br>executed agreement are legally binding. This email may contain confidential information and should not be shared with any third party<br>without the prior written agreement of Contoso. If you are not the intended recipient, take no action and contact the sender<br>immediately. |  |  |  |  |
| Contoso Limited (company number 01624297) is a company registered in England and Wales whose registered office is at Contoso<br>Campus, Thames Valley Park, Reading RG6 1WG                                                                                                                                                                                                                                                   |  |  |  |  |

#### **Tip**

Because content is only prepended or appended once the message is sent, the sender will only be able to view the added content from their **Inbox** or **Sent Items** folder. If you require the sender to view the added content before the message is sent, see **Insert data in the body when composing an appointment or message in Outlook**.

- 7. When you want to stop the local web server and uninstall the add-in, follow the applicable instructions:
	- To stop the server, run the following command. If you used npm start , the following command should also uninstall the add-in.

| command line |  |  |  |  |  |  |
|--------------|--|--|--|--|--|--|
| npm stop     |  |  |  |  |  |  |

- If you manually sideloaded the add-in, see Remove a sideloaded add-in.
# **Review feature behavior and limitations**

As you implement prepend-on-send and append-on-send in your add-in, keep the following in mind.

{256}------------------------------------------------

- Prepend-on-send and append-on-send are only supported in compose mode.
- The string to be prepended or appended must not exceed 5,000 characters.
- HTML can't be prepended or appended to a plain text body of a message or appointment. However, plain text can be added to an HTML-formatted body of a message or appointment.
- Any formatting applied to prepended or appended content doesn't affect the style of the rest of the mail item's body.
- Prepend-on-send and append-on-send can't be implemented in the same add-in that implements the on-send feature. As an alternative, consider implementing Smart Alerts instead.
- When implementing Smart Alerts in the same add-in, the prepend-on-send and appendon-send operations occur before the OnMessageSend and OnAppointmentSend event handler operations.
- If multiple active add-ins use prepend-on-send or append-on-send, the order of the content to be inserted depends on the order in which the add-in ran. For prepend-onsend, the content of the add-in that runs last appears at the top of the mail item body before the previously prepended content. For append-on-send, the content of the add-in that runs last appears at the bottom of the mail item body after the previously appended content.
- Delegate and shared mailbox scenarios are supported as long as the add-in that implements prepend-on-send or append-on-send is enabled on the shared mailbox or owner's account.

# **Troubleshoot your add-in**

If you encounter an error while implementing the prepend-on-send and append-on-send features, refer to the following table for guidance.

| Error                  | Description                                                                       | Resolution                                                                                                    |
|------------------------|-----------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|
| DataExceedsMaximumSize | The content to be<br>appended or prepended is<br>longer than 5,000<br>characters. | Shorten the string you pass to the data<br>parameter of your prependOnSendAsync or<br>appendOnSendAsync call. |

{257}------------------------------------------------

| Error              | Description                                                                                                                                                                                          | Resolution                                                                                                                                                                                                                                                                                       |
|--------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| InvalidFormatError | The message or<br>appointment body is in<br>plain text format, but the<br>coercionType passed to<br>the prependOnSendAsync or<br>appendOnSendAsync<br>method is set to<br>Office.CoercionType.Html . | Only plain text can be inserted into a plain text<br>body of a message or appointment. To verify the<br>format of the mail item being composed, call<br>Office.context.mailbox.item.body.getTypeAsync ,<br>then pass its returned value to your<br>prependOnSendAsync or appendOnSendAsync call. |

# **See also**

- Office Add-in manifests
- [Office.Body](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body)
- Handle OnMessageSend and OnAppointmentSend events in your Outlook add-in with Smart Alerts

{258}------------------------------------------------

# **Implement shared folders and shared mailbox scenarios in an Outlook add-in**

07/22/2025

This article describes how to implement shared folders (also known as delegate access) and shared mailbox scenarios in your Outlook add-in, including which permissions the Office JavaScript API supports.

#### 7 **Note**

Shared folder support was introduced in **[requirement set 1.8](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.8/outlook-requirement-set-1.8)**, while shared mailbox support was introduced in **[requirement set 1.13](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.13/outlook-requirement-set-1.13)**. For information about client support for these features, see **Supported clients and platforms**.

# **Supported clients and platforms**

The following table shows supported client-server combinations for this feature, including the minimum required Cumulative Update where applicable.

|                                       |                    |                                                                           |                                                                              | ノ<br>Expand table                                                            |
|---------------------------------------|--------------------|---------------------------------------------------------------------------|------------------------------------------------------------------------------|------------------------------------------------------------------------------|
| Client                                | Exchange<br>Online | Exchange Server<br>Subscription<br>Edition (SE)                           | Exchange 2019 on<br>premises<br>(Cumulative<br>Update 1 or later)            | Exchange 2016 on<br>premises<br>(Cumulative<br>Update 6 or later)            |
| Web browser<br>(modern Outlook<br>UI) | Supported          | Not applicable                                                            | Not applicable                                                               | Not applicable                                                               |
| Web browser<br>(classic Outlook UI)   | Not<br>applicable  | Shared<br>folders:<br>Supported<br>Shared<br>mailboxes: Not<br>applicable | Shared<br>folders:<br>Supported<br>Shared<br>mailboxes:<br>Not<br>applicable | Shared<br>folders:<br>Supported<br>Shared<br>mailboxes:<br>Not<br>applicable |
| new Outlook on<br>Windows             | Supported          | Not applicable                                                            | Not applicable                                                               | Not applicable                                                               |

{259}------------------------------------------------

| Client                                                                                                                                                          | Exchange<br>Online | Exchange Server<br>Subscription<br>Edition (SE) | Exchange 2019 on<br>premises<br>(Cumulative<br>Update 1 or later) | Exchange 2016 on<br>premises<br>(Cumulative<br>Update 6 or later) |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------|-------------------------------------------------|-------------------------------------------------------------------|-------------------------------------------------------------------|
| Windows (classic)<br>Shared folders:<br>Version 1910 (Build<br>12130.20272) or<br>later<br>Shared mailboxes:<br>Version 2304 (Build<br>16327.20248) or<br>later | Supported          | Supported*                                      | Supported*                                                        | Supported*                                                        |
| Mac<br>Version 16.47 or<br>later                                                                                                                                | Supported          | Supported                                       | Supported                                                         | Supported                                                         |
| Android                                                                                                                                                         | Not<br>applicable  | Not applicable                                  | Not applicable                                                    | Not applicable                                                    |
| iOS                                                                                                                                                             | Not<br>applicable  | Not applicable                                  | Not applicable                                                    | Not applicable                                                    |

#### 7 **Note**

* Support for this feature in an on-premises Exchange environment is available starting in classic Outlook on Windows Version 2206 (Build 15330.20000) for the Current Channel and Version 2207 (Build 15427.20000) for the Monthly Enterprise Channel.

# **Supported setups**

The following sections describe configurations for shared mailboxes and shared folders that support the use of add-ins. The feature APIs may not work as expected in other configurations. Select the platform you'd like to learn how to configure.

| Windows (classic) |
|-------------------|
| Shared<br>folders |
|                   |

{260}------------------------------------------------

The mailbox owner must first provide access to a delegate using one of the following options.

- Set up delegate access from the mailbox in classic Outlook on Windows. To learn more, see [Allow someone else to manage your mail and calendar](https://support.microsoft.com/office/41c40c04-3bd1-4d22-963a-28eafec25926) .
- Set up delegate access from the Microsoft 365 admin center. This option can only be completed by administrators. To learn more, see [Give mailbox permissions to another](https://learn.microsoft.com/en-us/microsoft-365/admin/add-users/give-mailbox-permissions-to-another-user) [Microsoft 365 user.](https://learn.microsoft.com/en-us/microsoft-365/admin/add-users/give-mailbox-permissions-to-another-user)
- Set up delegate access from the Exchange admin center. This option can only be completed by administrators. To learn more, see [Manage permissions for recipients.](https://learn.microsoft.com/en-us/exchange/recipients/mailbox-permissions)

Once access is provided, the delegate must then follow the instructions outlined in the "Add another person's mailbox to your profile" section of the article [Manage another](https://support.microsoft.com/office/afb79d6b-2967-43b9-a944-a6b953190af5) [person's mail and calendar items](https://support.microsoft.com/office/afb79d6b-2967-43b9-a944-a6b953190af5) .

#### **Shared mailboxes**

Exchange server admins can create and manage shared mailboxes for sets of users to access. [Exchange Online](https://learn.microsoft.com/en-us/exchange/collaboration-exo/shared-mailboxes) and [on-premises Exchange environments](https://learn.microsoft.com/en-us/exchange/collaboration/shared-mailboxes/create-shared-mailboxes) are supported.

An Exchange Server feature known as "automapping" is on by default. This means that subsequently the [shared mailbox should automatically appear](https://learn.microsoft.com/en-us/microsoft-365/admin/email/create-a-shared-mailbox?view=o365-worldwide&preserve-view=true#add-the-shared-mailbox-to-outlook) in a user's Outlook client after Outlook has been closed and reopened. However, if an admin turned off automapping, the user must follow the manual steps outlined in the "Add a shared mailbox to Outlook" section of the article [Open and use a shared mailbox in Outlook](https://support.microsoft.com/office/d94a8e9e-21f1-4240-808b-de9c9c088afd) .

### 2 **Warning**

Do **NOT** sign into the shared mailbox with a password. The feature APIs won't work in that case.

# **Configure the manifest**

To implement shared folder and shared mailbox scenarios in your add-in, you must first configure support for the feature in your manifest. The markup varies depending on the type of manifest your add-in uses.

{261}------------------------------------------------

#### 7 **Note**

Implementing shared folder and shared mailbox scenarios with a unified manifest for Microsoft 365 is currently only supported in classic Outlook on Windows. For other supported platforms, use the add-in only manifest instead.

Add an additional object to the ["authorization.permissions.resourceSpecific"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-authorization-permissions#resourcespecific) array. Set its "name" property to "Mailbox.SharedFolder" and its "type" property to "Delegated" .

```
JSON
"authorization": {
 "permissions": {
 "resourceSpecific": [
 ...
 {
 "name": "Mailbox.SharedFolder",
 "type": "Delegated"
 },
 ]
 }
},
```
# **Identify if a folder or mailbox is shared**

Before you can run operations in a shared folder or shared mailbox, you must first identify whether the current folder or mailbox is shared. To determine this, call [Office.context.mailbox.item.getSharedPropertiesAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods) on a message or appointment in compose or read mode. If the item is in a shared folder or shared mailbox, the method returns a [SharedProperties](https://learn.microsoft.com/en-us/javascript/api/outlook/office.sharedproperties) object that provides the user's permissions, the owner's email address, the REST API's base URL, and the location of the target mailbox.

#### 7 **Note**

In Outlook on the web and on Windows (new and classic), depending on how the shared folder or mailbox is accessed, the getSharedPropertiesAsync method may require certain conditions to be met in Message Compose mode. For more information, see the "Message Compose mode" section in **Limitations**.

The following example calls the getSharedPropertiesAsync method to identify the owner of the mailbox and the permissions of the delegate or shared mailbox user.

{262}------------------------------------------------

```
JavaScript
Office.context.mailbox.item.getSharedPropertiesAsync((result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.error("The current folder or mailbox isn't shared.");
 return;
 }
 const sharedProperties = result.value;
 console.log(`Owner: ${sharedProperties.owner}`);
 console.log(`Permissions: ${sharedProperties.delegatePermissions} `);
});
```
### **Supported permissions**

The following table describes the permissions that getSharedPropertiesAsync supports for delegates and shared mailbox users.

ノ **Expand table**

| Permission | Value       | Description                             |
|------------|-------------|-----------------------------------------|
| Read       | 1 (000001)  | Can read items.                         |
| Write      | 2 (000010)  | Can create items.                       |
| DeleteOwn  | 4 (000100)  | Can delete only the items they created. |
| DeleteAll  | 8 (001000)  | Can delete any items.                   |
| EditOwn    | 16 (010000) | Can edit only the items they created.   |
| EditAll    | 32 (100000) | Can edit any items.                     |

#### 7 **Note**

Currently, the API supports getting existing permissions, but not setting permissions.

The [DelegatePermissions](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxenums.delegatepermissions) enum returned by the [delegatePermissions](https://learn.microsoft.com/en-us/javascript/api/outlook/office.sharedproperties#outlook-office-sharedproperties-delegatepermissions-member) property is implemented using a bitmask to indicate the permissions. Each position in the bitmask represents a particular permission and if it's set to 1 , then the user has the respective permission. For example, if the second bit from the right is 1 , then the user has **Write** permission.

# **Perform an operation as a delegate or shared mailbox user**

{263}------------------------------------------------

Once you've identified that the current mail item is in a shared folder or shared mailbox, your add-in can then perform the necessary operations on the item within the shared environment. To run operations on an item in a shared context, you must first configure your add-in's permission in the manifest. Then, use Microsoft Graph to complete the operations.

#### 7 **Note**

- Exchange Web Services (EWS) isn't supported in shared folder and shared mailbox scenarios.
- In delegate or shared scenarios, a delegate can get the **[categories from the Outlook](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mastercategories) [master list](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mastercategories)** but can't add or remove categories from the list.

### **Configure the add-in's permissions**

To use Microsoft Graph services, an add-in must configure the **read/write mailbox** permission in its manifest. The markup varies depending on the type of manifest your add-in uses.

- **Unified manifest for Microsoft 365**: Set the "name" property of an object in the "authorization.permissions.resourceSpecific" array to "Mailbox.ReadWrite.User" .
- **Add-in only manifest**: Set the [Permissions](https://learn.microsoft.com/en-us/javascript/api/manifest/permissions) element to **ReadWriteMailbox**.

### **Use Microsoft Graph**

To implement your shared folder and shared mailbox scenarios, use Microsoft Graph to access additional mailbox information and resources. For example, you can use Microsoft Graph to [get the contents of an Outlook message that's attached to a message](https://learn.microsoft.com/en-us/graph/outlook-get-mime-message#get-mime-content-of-an-outlook-message-attached-to-an-outlook-item-or-group-post) in a mailbox where a user has delegate access. For guidance on how to use Microsoft Graph, see [Overview of](https://learn.microsoft.com/en-us/graph/overview) [Microsoft Graph](https://learn.microsoft.com/en-us/graph/overview) and [Outlook mail API in Microsoft Graph.](https://learn.microsoft.com/en-us/graph/outlook-mail-concept-overview)

#### **Tip**

To access Microsoft Graph APIs from your add-in, use MSAL.js nested app authentication (NAA). To learn more, see **Enable SSO in an Office Add-in using nested app authentication (preview)**.

# **Add-in support in shared folder and shared mailbox scenarios**

{264}------------------------------------------------

The availability of add-ins in a shared folder or shared mailbox varies depending on the scenario and Outlook client.

#### **Tip**

To learn more about where add-ins do and don't activate in general, refer to the **Mailbox items available to add-ins** section of the Outlook add-ins overview page.

### **Add-ins in shared folder scenarios**

The following table outlines the availability of add-ins in shared folder scenarios.

| ノ<br>Expand table |
|-------------------|
|-------------------|

| Scenario                                                                                                                                                             | Add-in availability                                                                                            |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------|
| Inbox folder is shared with a delegate                                                                                                                               | Add-ins are available to the delegate in message read<br>mode.                                                 |
| Drafts folder is shared with a delegate                                                                                                                              | Add-ins are available to the delegate in message<br>compose mode.                                              |
| (New Outlook on Windows only) Shared                                                                                                                                 | See the behaviors outlined in the "Web: same tab or                                                            |
| mailbox is automatically mapped by an                                                                                                                                | window, Windows (new): non-promoted mailbox,                                                                   |
| administrator and isn't promoted to a full                                                                                                                           | Windows (classic), and Mac" column of Add-ins in                                                               |
| account by the user                                                                                                                                                  | shared mailbox scenarios.                                                                                      |
| Calendar is explicitly shared with a delegate                                                                                                                        | Add-ins are available to the delegate in appointment                                                           |
| (the entire mailbox may not be shared)                                                                                                                               | read and compose modes.                                                                                        |
| Calendar is shared with a group of users with<br>different access (for example, made it editable<br>to a particular distribution list or the entire<br>organization) | Add-ins are available to users with indirect or implicit<br>permissions in appointment read and compose modes. |

### **Add-ins in shared mailbox scenarios**

The following table outlines the availability of add-ins in shared mailbox scenarios across various Outlook clients. Note that the behavior in Outlook on the web may differ depending on whether the shared mailbox is opened in the same panel as the user's primary mailbox or in a separate tab or window using the **Open another mailbox** option. Similarly, the behavior in new Outlook on Windows may also differ depending on whether the shared mailbox was added or promoted as a full account on the client.

{265}------------------------------------------------

| Scenario                                   | Applicable Outlook clients                                                                                                                                                                                                                                                                                                                               | Applicable Outlook clients                                                                                                                                                                                                          |  |  |
|--------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|
|                                            | Web: same tab or<br>window<br>Windows (new): non<br>promoted<br>Windows (classic)<br>Mac                                                                                                                                                                                                                                                                 | Web: separate tab or window<br>Windows (new): promoted                                                                                                                                                                              |  |  |
| Add-in<br>installed by<br>the user         | Users can't install add-ins in a<br>shared mailbox. Add-ins<br>installed by a user are added<br>to the user's primary mailbox.                                                                                                                                                                                                                           | Users can't install add-ins in a shared mailbox. The in<br>app Microsoft 365 and Copilot store doesn't appear on<br>the ribbon of the mailbox.                                                                                      |  |  |
| Add-in<br>installed by an<br>administrator | Administrators shouldn't<br>deploy add-ins to a shared<br>mailbox. They should instead<br>deploy an add-in to the user's<br>primary mailbox. The user can<br>then use the add-in in a<br>shared mailbox as long as the<br>add-in meets certain<br>requirements (see the<br>following scenarios for add-in<br>availability in read and<br>compose modes). | The same limitation and recommendation on other<br>platforms apply (see previous column).                                                                                                                                           |  |  |
| Add-in used in<br>read mode                | An add-in's manifest must be<br>configured to support shared<br>mailbox scenarios. For more<br>information, see Configure the<br>manifest. The add-in must be<br>installed in the user's primary<br>mailbox by the user or<br>administrator.                                                                                                             | The same manifest configuration and behavior on<br>other platforms apply (see previous column).                                                                                                                                     |  |  |
| Add-in used in<br>compose<br>mode          | In Outlook on the web<br>(mailbox opened in the same<br>window) and on Windows<br>(new and classic), add-ins<br>installed in the user's primary<br>mailbox that support<br>compose mode are available<br>for use. An add-in's manifest<br>doesn't need additional<br>configuration to support<br>shared mailbox scenarios.                               | An add-in's manifest must be configured to support<br>shared mailbox scenarios. For more information, see<br>Configure the manifest. The add-in must be installed in<br>the user's primary mailbox by the user or<br>administrator. |  |  |

{266}------------------------------------------------

| Scenario                                                    | Applicable Outlook clients                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Applicable Outlook clients                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |  |  |
|-------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|
|                                                             | Web: same tab or<br>window<br>Windows (new): non<br>promoted<br>Windows (classic)<br>Mac                                                                                                                                                                                                                                                                                                                                                                                                                        | Web: separate tab or window<br>Windows (new): promoted                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |  |  |
|                                                             | However, in Outlook on Mac,<br>an add-in's manifest must be<br>configured to support shared<br>mailbox scenarios. For more<br>information, see Configure the<br>manifest.                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |  |  |
| Templates<br>created using<br>the My<br>Templates<br>add-in | This only applies to Outlook<br>on the web and on Windows<br>(new and classic) since the My<br>Templates add-in isn't<br>supported in shared<br>mailboxes on Outlook on Mac.<br>Templates created are saved<br>to the creator's primary<br>mailbox. Although the creator<br>can use these templates in<br>both their primary and shared<br>mailboxes, other users who<br>have access to the shared<br>mailbox can't access these<br>templates. For more<br>information, see Create an<br>email message template | Templates created are saved to the shared mailbox.<br>Anyone with access to the shared mailbox can edit or<br>use these templates if they open the mailbox using<br>Open another mailbox in Outlook on the web, or if<br>the mailbox is promoted to a full account in new<br>Outlook on Windows. These shared templates can't be<br>accessed by anyone, including the template creator,<br>from other platforms. This includes Outlook on the<br>web, if the shared mailbox is opened in the same tab<br>as the user's primary mailbox, and new Outlook on<br>Windows, if the shared mailbox wasn't promoted to a<br>full account. Conversely, templates created on other<br>platforms can't be accessed from a shared mailbox<br>opened using the Open another mailbox option or<br>from a promoted shared mailbox. For more<br>information, see Create an email message template |  |  |
| Default add<br>ins in Outlook                               | In Outlook on the web and on<br>Windows (new and classic),<br>default Outlook add-ins are<br>available for use in a shared<br>mailbox. Default Outlook add<br>ins can include My Templates,<br>Unsubscribe, and Action<br>Items. Note that some default<br>add-ins may not appear in<br>your organization.<br>In Outlook on Mac, default                                                                                                                                                                        | Default add-ins are available in a shared mailbox.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |  |  |

{267}------------------------------------------------

| Scenario | Applicable Outlook clients<br>Web: same tab or<br>window<br>Windows (new): non<br>promoted<br>Windows (classic)<br>Mac | Applicable Outlook clients<br>Web: separate tab or window<br>Windows (new): promoted |
|----------|------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|
|          | add-ins aren't available in a<br>shared mailbox.                                                                       |                                                                                      |

# **Limitations**

Depending on your add-in's scenarios, there are a few limitations for you to consider when handling shared folder or shared mailbox situations.

### **Message Compose mode**

In Message Compose mode, [getSharedPropertiesAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messagecompose#outlook-office-messagecompose-getsharedpropertiesasync-member(1)) isn't supported in Outlook on the web or on Windows (new and classic) unless the following conditions are met.

- **Delegate access/Shared folders**
	- 1. The mailbox owner starts a message. This can be a new message, a reply, or a forward.
	- 2. They save the message then move it from their own **Drafts** folder to a folder shared with the delegate.
	- 3. The delegate opens the draft from the shared folder then continues composing.
- **Shared mailbox opened in the same panel as the user's primary mailbox (web, classic Windows) or shared mailbox that hasn't been promoted to a full account (new Windows)**
	- 1. A shared mailbox user starts a message. This can be a new message, a reply, or a forward.
	- 2. They save the message then move it from their own **Drafts** folder to a folder in the shared mailbox.
	- 3. Another shared mailbox user opens the draft from the shared mailbox then continues composing.

{268}------------------------------------------------

The getSharedPropertiesAsync method is supported on the following platforms without additional conditions.

- Outlook on the web when the shared mailbox is opened in a separate tab or window using the **Open another mailbox** option.
- new Outlook on Windows when the shared mailbox is promoted to a full account.

Once these conditions are met, the message becomes available in a shared context and addins that support these shared scenarios can get the item's shared properties. After the message is sent, it's usually found in the **Sent Items** folder of the sender's personal mailbox.

### **User or shared mailbox hidden from an address list**

If an admin hid a user or shared mailbox address from an address list, such as the global address list (GAL), affected mail items opened in the mailbox report Office.context.mailbox.item as null. For example, if the user opens a mail item in a shared mailbox that's hidden from the GAL, Office.context.mailbox.item representing that mail item is null.

### **Sync across shared folder clients**

A delegate's updates to the owner's mailbox are usually synced across mailboxes immediately. However, if Microsoft Graph operations were used to set an extended property on an item, such changes could take some time to sync. To avoid a delay, we recommend you instead use the [CustomProperties](https://learn.microsoft.com/en-us/javascript/api/outlook/office.customproperties) object and related APIs. To learn more, see the "Custom properties" tab of [Get and set metadata in an Outlook add-in.](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/metadata-for-an-outlook-add-in?tabs=custom-properties)

# **See also**

- [Allow someone else to manage your mail and calendar](https://support.microsoft.com/office/41c40c04-3bd1-4d22-963a-28eafec25926)
- [Calendar sharing in Microsoft 365](https://support.microsoft.com/office/b576ecc3-0945-4d75-85f1-5efafb8a37b4)
- [Add a shared mailbox to Outlook](https://learn.microsoft.com/en-us/microsoft-365/admin/email/create-a-shared-mailbox?view=o365-worldwide&preserve-view=true#add-the-shared-mailbox-to-outlook)
- [Overview of Microsoft Graph](https://learn.microsoft.com/en-us/graph/overview)

{269}------------------------------------------------

# **Add-ins for Outlook on mobile devices**

08/13/2025

Add-ins now work in Outlook on mobile devices, using the same APIs available for other Outlook endpoints. If you've built an add-in for Outlook already, it's easy to get it working on Outlook mobile.

Outlook mobile add-ins are supported on all Microsoft 365 business accounts and Outlook.com accounts. However, support isn't currently available for non-Microsoft accounts, such as Gmail. For more information, see the "Supported accounts" section of Outlook add-ins overview.

#### **An example task pane in Outlook on iOS**

{270}------------------------------------------------

**An example task pane in Outlook on Android**

# **What's different on mobile?**

- The small size and quick interactions make designing for mobile a challenge. To ensure quality experiences for customers, any add-in declaring mobile support must meet certain validation criteria to be approved in AppSource.
	- The add-in **MUST** adhere to the UI guidelines.
	- The scenario for the add-in **MUST** make sense on mobile.
	- You'll need to agree to our developer addendum for add-ins on iOS, and you must submit your Apple Developer ID for verification.
- In general, only Message Read mode is supported. This has implications for how you configure the manifest.

{271}------------------------------------------------

- **Unified manifest for Microsoft 365**: "mailRead" is the only item you should declare in the ["extensions.ribbons.contexts"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array#contexts) array.
- **Add-in only manifest**: MobileMessageReadCommandSurface is the only [ExtensionPoint](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#mobilemessagereadcommandsurface) you should declare in the mobile section of your manifest.

However, there are some exceptions.

- 1. Appointment Organizer mode is supported for online meeting provider integrated add-ins.
	- **Unified manifest for Microsoft 365**: "onlineMeetingDetailsOrganizer" is permitted in the "extensions.ribbons.contexts" array.
	- **Add-in only manifest**: The [MobileOnlineMeetingCommandSurface extension](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#mobileonlinemeetingcommandsurface) [point](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#mobileonlinemeetingcommandsurface) is permitted.

For more information on this scenario, see Create an Outlook mobile add-in for an online-meeting provider.

- 2. Appointment Attendee mode is supported for integrated add-ins created by providers of note-taking and customer relationship management (CRM) applications.
	- **Unified manifest for Microsoft 365**: "logEventMeetingDetailsAttendee" is permitted in the "extensions.ribbons.contexts" array.
	- **Add-in only manifest**: The [MobileLogEventAppointmentAttendee extension](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#mobilelogeventappointmentattendee) [point](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#mobilelogeventappointmentattendee) is permitted.

For more information on this scenario, see Log appointment notes to an external application in Outlook mobile add-ins.

- 3. Event-based activation is supported.
	- **Unified manifest for Microsoft 365**: Event-based add-ins aren't treated as a context in the unified manifest, so there is no exception for configuring the "extensions.ribbons.contexts" array. But note that event-based add-ins do require an "extensions.autoRunEvents" property in the manifest.
	- **Add-in only manifest**: The [LaunchEvent extension point](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#launchevent) *must be declared*.

For more information, see Implement event-based activation in Outlook mobile add-ins.

- Your manifest needs to declare mobile support including special mobile controls and icon sizes.
	- **Unified manifest for Microsoft 365**: Include the string "mobile" in the ["extensions.ribbons.requirements.formFactors"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/requirements-extension-element#formfactors) array, and include a "customMobileRibbonGroups" array in the tab object of the ["extensions.ribbons.tabs"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array#tabs)

{272}------------------------------------------------

array. The object in this array must include a "controls.type" of "mobileButton" and a "controls.icons" array.

- **Add-in only manifest**: Include a <MobileFormFactor> , and include the correct types of [controls](https://learn.microsoft.com/en-us/javascript/api/manifest/control) and [icon sizes](https://learn.microsoft.com/en-us/javascript/api/manifest/icon).
To learn more, see Add support for add-in commands in Outlook on mobile devices.

# **What makes a good scenario for Outlook mobile add-ins?**

Remember that the average Outlook session length on a phone is much shorter than on a PC. That means your add-in must be fast, and the scenario must allow the user to get in, get out, and get on with their email workflow.

Here are examples of scenarios that make sense in Outlook mobile.

- The add-in brings valuable information into Outlook, helping users triage their email and respond appropriately. For example, a customer relationship management (CRM) add-in that lets the user see customer information and share appropriate information.
- The add-in adds value to the user's email content by saving the information to a tracking, collaboration, or similar system. For example, an add-in that lets users turn emails into task items for project tracking, or help tickets for a support team.

**An example user interaction to create a Trello card from an email message on iOS**

{273}------------------------------------------------

**An example user interaction to create a Trello card from an email message on Android**

{274}------------------------------------------------

# **Support for add-ins with the unified manifest for Microsoft 365**

Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on mobile devices. To run this type of add-in, it must first be published to [AppSource](https://appsource.microsoft.com/) then deployed in the Microsoft 365 admin center. An add-in only manifest is then generated from the unified manifest, which enables the add-in to be installed in Outlook mobile.

#### 7 **Note**

Custom add-ins or line-of-business (LOB) add-ins that use the unified manifest can be deployed in the **[Integrated apps portal](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/test-and-deploy-microsoft-365-apps)** of the Microsoft 365 admin center, but they won't be installable in Outlook mobile.

{275}------------------------------------------------

For more information, see the "Client and platform support" section of Office Add-ins with the unified app manifest for Microsoft 365.

# **Testing your add-ins on mobile**

To test an add-in on Outlook mobile, first sideload an add-in using a Microsoft 365 or Outlook.com account in Outlook on the web, on Windows ([new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) or classic), or on Mac. Make sure your manifest is properly formatted to contain MobileFormFactor or it won't load in Outlook mobile.

After your add-in is working, make sure to test it on different screen sizes, including phones and tablets. You should make sure it meets accessibility guidelines for contrast, font size, and color, as well as being usable with a screen reader such as VoiceOver on iOS or TalkBack on Android.

Troubleshooting on mobile can be hard since you may not have the tools you're used to. However, one option for troubleshooting on iOS is to use Fiddler (check out [this tutorial on](https://www.telerik.com/blogs/using-fiddler-with-apple-ios-devices) [using it with an iOS device](https://www.telerik.com/blogs/using-fiddler-with-apple-ios-devices) ).

#### 7 **Note**

Modern Outlook on the web on iPhone and Android smartphones is no longer required or available for testing Outlook add-ins. Additionally, add-ins aren't supported in Outlook on Android, on iOS, and modern mobile web with on-premises Exchange accounts. Certain iOS devices still support add-ins when using on-premises Exchange accounts with classic Outlook on the web. For information about supported devices, see **Requirements for running Office Add-ins**.

# **Next steps**

Learn how to:

- Add support for add-in commands in Outlook on mobile devices.
- Implement supported Outlook JavaScript APIs.
- Design a great mobile experience for your add-in.
- Get an access token and call Outlook REST APIs from your add-in.

{276}------------------------------------------------

# **Add support for add-in commands in Outlook on mobile devices**

08/06/2025

Implement add-in commands in Outlook on mobile devices to access the same functionality (with some limitations) that you already have in Outlook on the web, on Windows ([new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) and classic), and on Mac. Adding support for Outlook mobile requires updating the add-in manifest and possibly changing your code for mobile scenarios.

# **Update the manifest**

The first step to enabling add-in commands in Outlook mobile is to define them in the add-in manifest.

```
Unified manifest for Microsoft 365
```
7 **Note**

Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on mobile devices. To run this type of add-in on mobile platforms, the add-in must first be published to **[AppSource](https://appsource.microsoft.com/)** then deployed in the **Microsoft 365 Admin Center**. For more information, see **Support for add-ins with the unified manifest for Microsoft 365**.

- 1. In the ["extensions.ribbons.requirements.formFactors"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/requirements-extension-element#formfactors) array, add "mobile" as an item. When you are finished, the array should look like the following.

```
JSON
"formFactors": [
 "mobile",
 <!-- Typically, there'll be other form factors listed. -->
]
```
- 2. If your add-in uses Appointment Attendee mode, such as an add-in that integrates a provider of a note-taking or customer relationship management (CRM) application, add "logEventMeetingDetailsAttendee" to the ["extensions.ribbons.contexts"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array#contexts) array. The following is an example.
JSON

{277}------------------------------------------------

```
"contexts": [
 "meetingDetailsAttendee",
 "logEventMeetingDetailsAttendee"
],
```
- 3. If your add-in uses an integrated online meeting provider, add
"onlineMeetingDetailsOrganizer" to the "extensions.ribbons.contexts" array. The following is an example.

```
JSON
"contexts": [
 "meetingDetailsOrganizer",
 "onlineMeetingDetailsOrganizer"
],
```
- 4. In the ["extensions.ribbons.tabs"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array#tabs) array, find the tab with the "builtInTabId" of "TabDefault" . Add a child "customMobileRibbonGroups" array to it (as a peer of the existing "groups" property). Inside this array, create an object and do the following:
	- Set appropriate "id" and "label" values.
	- Create an object in the "controls" array to represent a button and configure it as follows.
		- Set appropriate "id" and "label" values. To ensure that the button fits correctly in the ribbon, we recommend that you limit the "label" to 16 characters.
		- Set "type" to "mobileButton" .
		- Assign a function to the "actionId" property. This should match the "id" of the object in the "extensions.runtimes.actions" array.
		- Be sure you have all nine required icons.

The following is an example.

```
JSON
"tabs": [
 {
 "builtInTabId": "TabDefault",
 "groups": [
 <-- Non-mobile group objects omitted. -->
 ],
 "customMobileRibbonGroups": [
 {
 "id": "mobileApptComposeGroup",
 "label": "Contoso Meeting",
```

{278}------------------------------------------------

```
 "controls": [
 { 
 "id": "mobileInsertMeetingButton",
              "label": "Add meeting",
              "type": "mobileButton",
              "actionId": "insertContosoMeeting",
              "icons": [
 {
 "scale": 1,
                   "size": 25,
                   "url": "https://contoso.com/assets/icon-
25.png"
 },
                 {
 "scale": 1,
                   "size": 32,
                   "url": "https://contoso.com/assets/icon-
32.png"
 },
                 {
 "scale": 1,
                   "size": 48,
                   "url": "https://contoso.com/assets/icon-
48.png"
 }, 
                 {
 "scale": 2,
                   "size": 25,
                   "url": "https://contoso.com/assets/icon-
25.png"
 },
                 {
 "scale": 2,
                   "size": 32,
                   "url": "https://contoso.com/assets/icon-
32.png"
 },
                 {
 "scale": 2,
                   "size": 48,
                   "url": "https://contoso.com/assets/icon-
48.png"
 }, 
                 {
 "scale": 3,
                   "size": 25,
                   "url": "https://contoso.com/assets/icon-
25.png"
 },
                 {
 "scale": 3,
                   "size": 32,
                   "url": "https://contoso.com/assets/icon-
32.png"
 },
```

{279}------------------------------------------------

# **Code considerations**

Designing an add-in for mobile introduces some additional considerations.

### **Use Microsoft Graph**

Add-ins should prefer to get information from the Office.js API when possible. If your add-in requires information not exposed by the Office.js API, use [Microsoft Graph](https://learn.microsoft.com/en-us/graph/overview) to access the user's mailbox.

### **Pinch zoom**

By default users can use the "pinch zoom" gesture to zoom in on task panes. If this doesn't make sense for your scenario, be sure to disable pinch zoom in your HTML.

## **Close task panes**

In Outlook mobile, task panes take up the entire screen and by default require the user to close them to return to the message. Consider using the [Office.context.ui.closeContainer](https://learn.microsoft.com/en-us/javascript/api/office/office.ui#office-office-ui-closecontainer-member(1)) method to close the task pane when your scenario is complete.

# **Compose mode and appointments**

Currently, add-ins in Outlook mobile only support activation when reading messages. Add-ins aren't activated when composing messages or when viewing or composing appointments. However, there are some exceptions.

{280}------------------------------------------------

- 1. Online meeting provider integrated add-ins activate in Appointment Organizer mode. For more information about this exception (including available APIs), see Create an Outlook mobile add-in for an online-meeting provider.
- 2. Add-ins that log appointment notes and other details to customer relationship management (CRM) or note-taking services activate in Appointment Attendee mode. For more information about this exception (including available APIs), see Log appointment notes to an external application in Outlook mobile add-ins.
- 3. Event-based add-ins activate when the OnNewMessageCompose event occurs. For more information about this exception (including additional supported APIs), see Implement event-based activation in Outlook mobile add-ins.

### **Supported APIs**

Although Outlook mobile supports up to [Mailbox requirement set 1.5](https://learn.microsoft.com/en-us/javascript/api/outlook?view=outlook-js-1.5&preserve-view=true), you can now implement additional APIs from later requirement sets to further extend the capability of your add-in on Outlook mobile. For guidance on which APIs you can implement in your mobile add-in, see Outlook JavaScript APIs supported in Outlook on mobile devices.

# **See also**

- [Requirement sets supported by Exchange servers and Outlook clients](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients)
- Outlook JavaScript APIs supported in Outlook on mobile devices

{281}------------------------------------------------

# **Outlook JavaScript APIs supported in Outlook on mobile devices**

08/08/2025

Outlook on Android and on iOS support up to [Mailbox requirement set 1.5](https://learn.microsoft.com/en-us/javascript/api/outlook?view=outlook-js-1.5&preserve-view=true). To further extend the capabilities of an Outlook mobile add-in, certain APIs from later requirement sets, previously available only to Outlook desktop and web clients, are now enabled for mobile support. This article outlines the APIs supported in Outlook mobile and any implementation exceptions.

# **Supported APIs**

The following table lists a subset of APIs from requirement sets beyond 1.5 that can now be implemented in Outlook mobile add-ins. Even if the minimum requirement set specified in the manifest of your add-in is greater than 1.5, as long as the API used from the later requirement set is supported, the add-in will appear and activate in Outlook on Android or on iOS. For more information on how to specify the minimum requirement set in your add-in, see [Outlook JavaScript](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets) [API requirement sets.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets)

| API                                               | Minimum                                             | Supported   | Supported         |         |                 |                |                                                                                          |
|---------------------------------------------------|-----------------------------------------------------|-------------|-------------------|---------|-----------------|----------------|------------------------------------------------------------------------------------------|
|                                                   | Office.context.mailbox.getIsIdentityManaged         | requirement | Not<br>applicable | Outlook | Compose<br>Read | Outlook on     | Android<br>(Version<br>4.2443.0<br>or later)<br>iOS<br>(Version<br>4.2443.0<br>or later) |
|                                                   | Office.context.mailbox.getIsOpenFromLocationAllowed | set         | Not<br>applicable | modes   | Compose<br>Read | mobile clients | Android<br>(Version<br>4.2443.0<br>or later)<br>iOS<br>(Version<br>4.2443.0<br>or later) |
| Office.context.mailbox.getIsSaveToLocationAllowed | Not                                                 | Compose     | Android           |         |                 |                |                                                                                          |
|                                                   | applicable                                          | Read        | (Version          |         |                 |                |                                                                                          |

{282}------------------------------------------------

| API                                                     | Minimum                                                      | Supported          | Supported                                                                                |         |                    |                |                                                                                          |
|---------------------------------------------------------|--------------------------------------------------------------|--------------------|------------------------------------------------------------------------------------------|---------|--------------------|----------------|------------------------------------------------------------------------------------------|
|                                                         |                                                              | requirement        |                                                                                          | Outlook |                    | Outlook on     | 4.2443.0<br>or later)<br>iOS<br>(Version<br>4.2443.0<br>or later)                        |
|                                                         | Office.context.mailbox.item.addFileAttachmentFromBase64Async | set                | Mailbox 1.8                                                                              | modes   | Message<br>Compose | mobile clients | Android<br>(Version<br>4.2352.0<br>or later)<br>iOS<br>(Version<br>4.2352.0<br>or later) |
| Office.context.mailbox.item.body.setSignatureAsync      | Mailbox 1.10                                                 | Message<br>Compose | Android<br>(Version<br>4.2352.0<br>or later)<br>iOS<br>(Version<br>4.2352.0<br>or later) |         |                    |                |                                                                                          |
| Office.context.mailbox.item.disableClientSignatureAsync | Mailbox 1.10                                                 | Message<br>Compose | Android<br>(Version<br>4.2352.0<br>or later)<br>iOS<br>(Version<br>4.2352.0<br>or later) |         |                    |                |                                                                                          |
| Office.context.mailbox.item.from.getAsync               | Mailbox 1.7                                                  | Message<br>Compose | Android<br>(Version<br>4.2352.0<br>or later)<br>iOS<br>(Version<br>4.2352.0<br>or later) |         |                    |                |                                                                                          |

{283}------------------------------------------------

| API                                                     | Minimum                                              | Supported          | Supported                                                                                |         |                    |                |                                                                                          |
|---------------------------------------------------------|------------------------------------------------------|--------------------|------------------------------------------------------------------------------------------|---------|--------------------|----------------|------------------------------------------------------------------------------------------|
|                                                         | Office.context.mailbox.item.getComposeTypeAsync      | requirement        | Mailbox 1.10                                                                             | Outlook | Message<br>Compose | Outlook on     | Android<br>(Version<br>4.2352.0<br>or later)<br>iOS<br>(Version<br>4.2352.0<br>or later) |
|                                                         | Office.context.mailbox.item.internetHeaders.getAsync | set                | Mailbox 1.8                                                                              | modes   | Message<br>Compose | mobile clients | Android<br>(Version<br>4.2405.0<br>or later)<br>iOS<br>(Version<br>4.2405.0<br>or later) |
| Office.context.mailbox.item.internetHeaders.removeAsync | Mailbox 1.8                                          | Message<br>Compose | Android<br>(Version<br>4.2405.0<br>or later)<br>iOS<br>(Version<br>4.2405.0<br>or later) |         |                    |                |                                                                                          |
| Office.context.mailbox.item.internetHeaders.setAsync    | Mailbox 1.8                                          | Message<br>Compose | Android<br>(Version<br>4.2405.0<br>or later)<br>iOS<br>(Version<br>4.2405.0<br>or later) |         |                    |                |                                                                                          |
| Office.context.mailbox.item.sessionData                 | Mailbox 1.11                                         | Message<br>Compose | Android<br>(Version<br>4.2425.0)<br>iOS<br>(Version<br>4.2425.0)                         |         |                    |                |                                                                                          |

{284}------------------------------------------------

| API | Minimum                                    | Supported   | Supported      |         |         |            |                |
|-----|--------------------------------------------|-------------|----------------|---------|---------|------------|----------------|
|     | Office.AddinCommands.EventCompletedOptions | requirement | Mailbox 1.8    | Outlook | Compose | Outlook on | Android<br>iOS |
|     | set                                        | modes       | mobile clients |         |         |            |                |

### **Supported events**

The following table lists the events that can be handled by add-ins running in Outlook on mobile devices. For more information about event-based activation, see Implement event-based activation in Outlook mobile add-ins.

ノ **Expand table**

| Event canonical name       | Supported clients                                                        |
|----------------------------|--------------------------------------------------------------------------|
| OnNewMessageCompose        | Android (Version 4.2352.0 and later)<br>iOS (Version 4.2352.0 and later) |
| OnMessageRecipientsChanged | Android (Version 4.2425.0 and later)<br>iOS (Version 4.2425.0 and later) |
| OnMessageFromChanged       | Android (Version 4.2502.0 and later)<br>iOS (Version 4.2502.0 and later) |

# **Unsupported APIs**

Although Outlook mobile supports up to requirement set 1.5, there are some APIs from these earlier requirement sets that aren't supported. The following table lists these APIs and also notes features that aren't supported in certain Outlook modes.

|                            |                            | ノ Expand table                                                |  |  |
|----------------------------|----------------------------|---------------------------------------------------------------|--|--|
| API                        | Minimum<br>requirement set | Unsupported Outlook<br>modes                                  |  |  |
| Office.context.officeTheme | Mailbox 1.14               | Message Read<br>Message<br>Compose<br>Appointment<br>Attendee |  |  |

{285}------------------------------------------------

| API                                           | Minimum<br>requirement set | Unsupported Outlook<br>modes                                                              |
|-----------------------------------------------|----------------------------|-------------------------------------------------------------------------------------------|
|                                               |                            | Appointment<br>Organizer                                                                  |
| Office.context.mailbox.ewsUrl                 | Mailbox 1.1                | Message Read<br>Message<br>Compose<br>Appointment<br>Attendee<br>Appointment<br>Organizer |
| Office.context.mailbox.convertToEwsId         | Mailbox 1.3                | Message Read<br>Message<br>Compose<br>Appointment<br>Attendee<br>Appointment<br>Organizer |
| Office.context.mailbox.convertToRestId        | Mailbox 1.3                | Message Read<br>Message<br>Compose<br>Appointment<br>Attendee<br>Appointment<br>Organizer |
| Office.context.mailbox.displayAppointmentForm | Mailbox 1.1                | Message Read<br>Message<br>Compose<br>Appointment<br>Attendee<br>Appointment<br>Organizer |
| Office.context.mailbox.displayMessageForm     | Mailbox 1.1                | Message Read<br>Message<br>Compose<br>Appointment<br>Attendee<br>Appointment<br>Organizer |

{286}------------------------------------------------

| API                                                                    | Minimum<br>requirement set                                                  | Unsupported Outlook<br>modes                                                              |
|------------------------------------------------------------------------|-----------------------------------------------------------------------------|-------------------------------------------------------------------------------------------|
| Office.context.mailbox.displayNewAppointmentForm                       | Mailbox 1.1                                                                 | Message Read<br>Appointment<br>Attendee                                                   |
| Office.context.mailbox.getCallbackTokenAsync(options,<br>callback)     | Mailbox 1.5                                                                 | Message<br>Compose<br>Appointment<br>Organizer                                            |
| Office.context.mailbox.getCallbackTokenAsync(callback,<br>userContext) | Mailbox 1.1 (Read<br>mode support)<br>Mailbox 1.3 (Compose<br>mode support) | Message Read<br>Message<br>Compose<br>Appointment<br>Attendee<br>Appointment<br>Organizer |
| Office.context.mailbox.makeEwsRequestAsync                             | Mailbox 1.1                                                                 | Message Read<br>Message<br>Compose<br>Appointment<br>Attendee<br>Appointment<br>Organizer |
| Office.context.mailbox.item.addFileAttachmentAsync                     | Mailbox 1.1 (classic<br>Windows, Mac)<br>Mailbox 1.8 (Web, new<br>Windows)  | Message<br>Compose<br>Appointment<br>Organizer                                            |
| Office.context.mailbox.item.dateTimeModified                           | Mailbox 1.1                                                                 | Message Read<br>Appointment<br>Attendee                                                   |
| Office.context.mailbox.item.displayReplyAllForm                        | Mailbox 1.1                                                                 | Message Read<br>Appointment<br>Attendee                                                   |
| Office.context.mailbox.item.displayReplyForm                           | Mailbox 1.1                                                                 | Message Read<br>Appointment<br>Attendee                                                   |
| Office.context.mailbox.item.getRegexMatches                            | Mailbox 1.1                                                                 | Message Read                                                                              |

{287}------------------------------------------------

| API                                               | Minimum<br>requirement set | Unsupported Outlook<br>modes                        |
|---------------------------------------------------|----------------------------|-----------------------------------------------------|
|                                                   |                            | Appointment<br>Attendee                             |
| Office.context.mailbox.item.getRegexMatchesByName | Mailbox 1.1                | Message Read<br>Appointment<br>Attendee             |
| Office.context.mailbox.item.notificationMessages  | Mailbox 1.3                | Appointment<br>Attendee<br>Appointment<br>Organizer |
| Office.context.mailbox.item.body.getTypeAsync     | Mailbox 1.1                | Message<br>Compose                                  |
| Office.context.mailbox.item.body.prependAsync     | Mailbox 1.1                | Message<br>Compose                                  |
| Office.context.mailbox.item.body.setAsync         | Mailbox 1.1                | Message<br>Compose                                  |
| Office.context.mailbox.item.subject.setAsync      | Mailbox 1.1                | Message<br>Compose                                  |

### **See also**

- [Outlook JavaScript API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets)
- Add-ins for Outlook on mobile devices
- Add support for add-in commands in Outlook on mobile devices
- [Requirement sets supported by Exchange servers and Outlook clients](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients)

{288}------------------------------------------------

# **Log appointment notes to an external application in Outlook mobile add-ins**

08/06/2025

Saving your appointment notes and other details to a customer relationship management (CRM) or note-taking application can help you keep track of meetings you've attended.

In this article, you'll learn how to set up your Outlook mobile add-in to enable users to log notes and other details about their appointments to your CRM or note-taking application. Throughout this article, we'll be using a fictional CRM service provider named "Contoso".

You can opt to implement a function command or task pane add-in. With a function command implementation, users can log and view notes and other details about their appointments when they select the add-in button. With a task pane implementation, users can directly manage their appointment notes from a task pane interface. As you follow the instructions in this article, select the tab for the type of add-in you're developing.

# **Supported clients**

Logging notes to an external application from an Outlook mobile add-in is supported in Outlook on Android and on iOS with a Microsoft 365 subscription.

# **Set up your environment**

Complete the Outlook quick start to create an add-in project with the Yeoman generator for Office Add-ins.

# **Configure the manifest**

To configure your add-in's manifest, select the type of manifest you're using.

- Unified manifest for Microsoft 365
- Add-in only manifest

### **Unified manifest for Microsoft 365**

7 **Note**

{289}------------------------------------------------

Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on mobile devices. To run this type of add-in on mobile platforms, the add-in must first be published to **[AppSource](https://appsource.microsoft.com/)** then deployed in the **Microsoft 365 Admin Center**. For more information, see **Support for add-ins with the unified manifest for Microsoft 365**.

Function command

- 1. Open the quick start project in your code editor.
- 2. Open the **manifest.json** file located at the root of your project.
- 3. In the ["authorization.permissions.resourceSpecific"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-authorization-permissions#resourcespecific) array, find the *first* object and set its "name" property to "MailboxItem.ReadWrite.User" . It should look like the following when you're done.

```
JSON
{
 "name": "MailboxItem.ReadWrite.User",
 "type": "Delegated"
}
```
- 4. In the ["validDomains"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root#validdomains) array, ensure that the URL to https://www.contoso.com is included. The array should look like the following when you're done.

```
JSON
"validDomains": [
 "https://www.contoso.com"
],
```
- 5. In the ["extensions.runtimes"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array?view=m365-app-prev&preserve-view=true) array, delete the object whose "id" is set to "TaskPaneRuntime" .
- 6. In the same array, navigate to the remaining object, whose "id" is set to "CommandsRuntime" , and replace it with the following object.

```
JSON
{
 "requirements": {
 "capabilities": [
 {
```

{290}------------------------------------------------

```
 "name": "Mailbox",
 "minVersion": "1.3"
 }
 ]
 },
 "id": "CommandsRuntime",
 "type": "general",
 "code": {
 "page": "https://localhost:3000/commands.html",
 "script": "https://localhost:3000/commands.js"
 },
 "lifetime": "short",
 "actions": [
 {
 "id": "logCRMEvent",
 "type": "executeFunction"
 }
 ]
}
```
- 7. In the ["ribbons"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/element-extensions#ribbons) array, replace the existing object with the following code. Note the following about these changes.
	- The "desktop" and "mobile" values in the ["ribbons.requirements.formFactors"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/requirements-extension-element#formfactors) array configure the **Log to Contoso** button to appear in Outlook on mobile devices and on desktop clients.
	- The "logEventMeetingDetailsAttendee" value in the "contexts" array configures the add-in button to appear in the Appointment Attendee surface, so that users can log their appointment notes.
	- The object in the "ribbons.tabs.groups.controls" array configures the add-in button that calls the note-logging function in Outlook desktop clients. The "actionId" property must match the ["actions.id"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-actions-item#id) of the object in the "extensions.runtimes" array.
	- The object in the ["ribbons.tabs.customMobileRibbonGroups"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array-tabs-item#custommobileribbongroups) array configures the add-in button that calls the note-logging function in Outlook on mobile devices. All nine of the objects specified in the

"customMobileRibbonGroups.controls.icons" array are required for a mobile button. Additionally, the "customMobileRibbonGroups.controls.actionId" property must match the "actions.id" of the object in the "extensions.runtimes" array.

```
JSON
```
{

```
 "requirements": {
 "formFactors": [
```

{291}------------------------------------------------

```
 "desktop",
 "mobile"
 ]
 },
 "contexts": [
 "logEventMeetingDetailsAttendee"
 ],
 "tabs": [
 {
 "builtInTabId": "TabDefault",
 "groups": [
 {
 "id": "apptReadGroup",
 "label": "Contoso Add-in",
 "icons": [
 {
 "size": 16,
               "url": "https://localhost:3000/assets/icon-
16.png"
 },
             {
 "size": 32,
               "url": "https://localhost:3000/assets/icon-
32.png"
 },
             {
 "size": 80,
               "url": "https://localhost:3000/assets/icon-
80.png"
 }
 ],
 "controls": [
 {
 "id": "desktopLogToCRM",
               "type": "button",
               "label": "Log to Contoso",
               "icons": [
 {
 "size": 16,
                   "url": 
"https://www.contoso.com/assets/icon-16.png"
 },
                 {
 "size": 32,
                   "url": 
"https://www.contoso.com/assets/icon-32.png"
 },
                 {
 "size": 80,
                   "url": 
"https://www.contoso.com/assets/icon-80.png"
 }
 ],
               "supertip": {
 "title": "Log to Contoso CRM",
```

{292}------------------------------------------------

```
 "description": "Log notes to Contoso CRM
for this appointment."
 },
               "actionId": "logCRMEvent"
 }
 ]
 }
 ],
 "customMobileRibbonGroups": [
 {
 "id": "mobileApptReadGroup",
 "label": "Contoso Add-in",
 "controls": [
 {
 "id": "mobileLogToCRM",
               "label": "Log to Contoso",
               "type": "mobileButton",
               "icons": [
 {
 "scale": 1,
                   "size": 25,
                   "url": 
"https://contoso.com/assets/icon-25.png"
 },
                 {
 "scale": 1,
                   "size": 32,
                   "url": 
"https://contoso.com/assets/icon-32.png"
 },
                 {
 "scale": 1,
                   "size": 48,
                   "url": 
"https://contoso.com/assets/icon-48.png"
 }, 
                 {
 "scale": 2,
                   "size": 25,
                   "url": 
"https://contoso.com/assets/icon-25.png"
 },
                 {
 "scale": 2,
                   "size": 32,
                   "url": 
"https://contoso.com/assets/icon-32.png"
 },
                 {
 "scale": 2,
                   "size": 48,
                   "url": 
"https://contoso.com/assets/icon-48.png"
 }, 
                 {
```

{293}------------------------------------------------

```
8. Save your changes.
   "scale": 3,
                     "size": 25,
                     "url": 
  "https://contoso.com/assets/icon-25.png"
   },
                   {
   "scale": 3,
                     "size": 32,
                     "url": 
  "https://contoso.com/assets/icon-32.png"
   },
                   {
   "scale": 3,
                     "size": 48,
                     "url": 
  "https://contoso.com/assets/icon-48.png"
   }
   ],
                "actionId": "logCRMEvent"
   }
   ]
   }
   ]
   }
   ]
  }
```
### **Add-in only manifest**

To enable users to log appointment notes with your add-in, you must configure the [MobileLogEventAppointmentAttendee extension point](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#mobilelogeventappointmentattendee) in the manifest under the parent element MobileFormFactor . Other form factors aren't supported.

- 3. Select the entire <VersionOverrides> node (including open and close tags) and replace it with the following XML. Make sure to replace all references to **Contoso** with your company's information.
XML

{294}------------------------------------------------

```
<VersionOverrides
xmlns="http://schemas.microsoft.com/office/mailappversionoverrides"
xsi:type="VersionOverridesV1_0">
 <VersionOverrides
xmlns="http://schemas.microsoft.com/office/mailappversionoverrides/1.1"
xsi:type="VersionOverridesV1_1">
 <Description resid="residDescription"></Description>
 <Requirements>
 <bt:Sets>
 <bt:Set Name="Mailbox" MinVersion="1.3"/>
 </bt:Sets>
 </Requirements>
 <Hosts>
 <Host xsi:type="MailHost">
 <DesktopFormFactor>
 <FunctionFile resid="residFunctionFile"/>
 <!-- Configures the add-in button to appear in the Appointment
Attendee surface of Outlook desktop clients. -->
 <ExtensionPoint xsi:type="AppointmentAttendeeCommandSurface">
 <OfficeTab id="TabDefault">
 <Group id="apptReadGroup">
 <Label resid="residDescription"/>
 <Control xsi:type="Button"
id="apptReadDesktopFunctionButton">
 <Label resid="residLabel"/>
 <Supertip>
 <Title resid="residLabel"/>
 <Description resid="residTooltip"/>
 </Supertip>
 <Icon>
 <bt:Image size="16" resid="icon-16"/>
 <bt:Image size="32" resid="icon-32"/>
 <bt:Image size="80" resid="icon-80"/>
 </Icon>
 <Action xsi:type="ExecuteFunction">
 <FunctionName>logCRMEvent</FunctionName>
 </Action>
 </Control>
 </Group>
 </OfficeTab>
 </ExtensionPoint>
 </DesktopFormFactor>
 <MobileFormFactor>
 <FunctionFile resid="residFunctionFile"/>
 <!-- Configures the add-in button to appear in the Appointment
Attendee surface of Outlook on mobile devices. -->
 <ExtensionPoint xsi:type="MobileLogEventAppointmentAttendee">
 <Control xsi:type="MobileButton"
id="apptReadMobileFunctionButton">
 <Label resid="residLabel"/>
 <Icon>
 <bt:Image size="25" scale="1" resid="icon-16"/>
 <bt:Image size="25" scale="2" resid="icon-16"/>
 <bt:Image size="25" scale="3" resid="icon-16"/>
```

{295}------------------------------------------------

```
 <bt:Image size="32" scale="1" resid="icon-32"/>
 <bt:Image size="32" scale="2" resid="icon-32"/>
 <bt:Image size="32" scale="3" resid="icon-32"/>
 <bt:Image size="48" scale="1" resid="icon-48"/>
 <bt:Image size="48" scale="2" resid="icon-48"/>
 <bt:Image size="48" scale="3" resid="icon-48"/>
 </Icon>
 <Action xsi:type="ExecuteFunction">
 <FunctionName>logCRMEvent</FunctionName>
 </Action>
 </Control>
 </ExtensionPoint>
 </MobileFormFactor>
 </Host>
 </Hosts>
 <Resources>
 <bt:Images>
 <bt:Image id="icon-16"
DefaultValue="https://contoso.com/assets/icon-16.png"/>
 <bt:Image id="icon-32"
DefaultValue="https://contoso.com/assets/icon-32.png"/>
 <bt:Image id="icon-48"
DefaultValue="https://contoso.com/assets/icon-48.png"/>
 <bt:Image id="icon-80"
DefaultValue="https://contoso.com/assets/icon-80.png"/>
 </bt:Images>
 <bt:Urls>
 <bt:Url id="residFunctionFile"
DefaultValue="https://contoso.com/commands.html"/>
 </bt:Urls>
 <bt:ShortStrings>
 <bt:String id="residDescription" DefaultValue="Log appointment
notes and other details to Contoso CRM."/>
 <bt:String id="residLabel" DefaultValue="Log to Contoso"/>
 </bt:ShortStrings>
 <bt:LongStrings>
 <bt:String id="residTooltip" DefaultValue="Log notes to Contoso
CRM for this appointment."/>
 </bt:LongStrings>
 </Resources>
 </VersionOverrides>
</VersionOverrides>
```
- 4. Save your changes.
#### **Tip**

To learn more about manifests for Outlook add-ins, see **Office Add-in manifests** and **Add support for add-in commands in Outlook on mobile devices**.

{296}------------------------------------------------

## **Capture appointment notes**

Function command

In this section, learn how your add-in can extract appointment details when the user selects the **Log** button.

- 1. From the same quick start project, open the file **./src/commands/commands.js** in your code editor.
- 2. Replace the entire content of the **commands.js** file with the following JavaScript.

```
JavaScript
let event;
// Add start-up logic code to the onReady function, if any.
Office.onReady();
function logCRMEvent(appointmentEvent) {
 event = appointmentEvent;
 console.log(`Subject: ${Office.context.mailbox.item.subject}`);
 Office.context.mailbox.item.body.getAsync(
 "html",
 { asyncContext: "This is passed to the callback" },
 (result) => {
 if (result.status === Office.AsyncResultStatus.Succeeded) {
 event.completed({ allowEvent: true });
 } else {
 console.error("Failed to get body.");
 event.completed({ allowEvent: false });
 }
 }
 );
}
// Register the function.
Office.actions.associate("logCRMEvent", logCRMEvent);
```
- 3. Save your changes.
- 4. Open the **./src/commands/commands.html** file of your add-in project.
- 5. Locate <script type="text/javascript"

src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script> , then add the following code after it. This adds a reference to the **commands.js** file.

HTML

{297}------------------------------------------------

- 6. Save your changes.
### **View appointment notes**

The **Log** button label can be toggled to display **View** by setting the **EventLogged** custom property reserved for this purpose. When the user selects the **View** button, they can look at their logged notes for this appointment.

Your add-in defines the log-viewing experience. For example, in a function command implementation, you can display the logged appointment notes in a dialog when the user selects the **View** button. For details on how to implement dialogs, see Use the Office dialog API in your Office Add-ins.

Function command

- 1. In **./src/commands/commands.js**, add the following function. This function sets the **EventLogged** custom property on the current appointment item.

```
JavaScript
function updateCustomProperties() {

Office.context.mailbox.item.loadCustomPropertiesAsync((customPropertiesRe
sult) => {
 if (customPropertiesResult.status ===
Office.AsyncResultStatus.Succeeded) {
 const customProperties = customPropertiesResult.value;
 customProperties.set("EventLogged", true);
 customProperties.saveAsync((setSaveAsyncResult) => {
 if (setSaveAsyncResult.status ===
Office.AsyncResultStatus.Succeeded) {
 console.log("EventLogged custom property saved successfully.");
 event.completed({ allowEvent: true });
 event = undefined;
 }
 });
 }
 });
}
```
- 2. Save your changes.

{298}------------------------------------------------

- 3. Call the **updateCustomProperties** function after the add-in successfully logs the appointment notes. For example, you can call it from **logCRMEvent** as shown in the following code.

```
JavaScript
function logCRMEvent(appointmentEvent) {
 event = appointmentEvent;
 console.log(`Subject: ${Office.context.mailbox.item.subject}`);
 Office.context.mailbox.item.body.getAsync(
 "html",
 { asyncContext: "This is passed to the callback" },
 (result) => {
 if (result.status === Office.AsyncResultStatus.Succeeded) {
 // Replace `event.completed({ allowEvent: true });` with the
following statement.
 updateCustomProperties();
 } else {
 console.error("Failed to get body.");
 event.completed({ allowEvent: false });
 }
 }
 );
}
```
# **Delete the appointment log**

If you'd like your users to undo logging or delete the logged appointment notes so a replacement log can be saved, you have two options.

- Use Microsoft Graph to [clear the custom properties object](https://learn.microsoft.com/en-us/graph/api/resources/extended-properties-overview?view=graph-rest-1.0&preserve-view=true) when the user selects the appropriate button in the task pane.
- Create a function to clear the **EventLogged** custom property on the current appointment item (shown in the following example).

{299}------------------------------------------------

```
Office.context.mailbox.item.loadCustomPropertiesAsync((customPropertiesRe
sult) => {
 if (customPropertiesResult.status ===
Office.AsyncResultStatus.Succeeded) {
 const customProperties = customPropertiesResult.value;
 customProperties.remove("EventLogged");
 customProperties.saveAsync((removeSaveAsyncResult) => {
 if (removeSaveAsyncResult.status ===
Office.AsyncResultStatus.Succeeded) {
 console.log("Custom properties cleared");
 event.completed({ allowEvent: true });
 event = undefined;
 }
 });
 }
 });
}
```
- 2. Save your changes.
JavaScript

- 3. Call the **clearCustomProperties** function when you want to clear the custom property. For example, you can call it from **logCRMEvent** if setting the log failed in some way as shown in the following function.

```
function logCRMEvent(appointmentEvent) {
 event = appointmentEvent;
 console.log(`Subject: ${Office.context.mailbox.item.subject}`);
 Office.context.mailbox.item.body.getAsync(
 "html",
 { asyncContext: "This is passed to the callback" },
 (result) => {
 if (result.status === Office.AsyncResultStatus.Succeeded) {
 updateCustomProperties();
 } else {
 console.error("Failed to get body.");
 // Replace `event.completed({ allowEvent: false });` with the
following statement.
 clearCustomProperties();
 }
 }
 );
}
```
### **Test and validate**

- 1. Follow the usual guidance to test and validate your add-in.

{300}------------------------------------------------

- 2. After you sideload the add-in in Outlook on the web, on Windows ([new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) or classic), or on Mac, restart Outlook on your Android or iOS mobile device.
- 3. Open an appointment as an attendee, then verify that under the **Meeting Insights** card, there's a new card with your add-in's name alongside the **Log** button.

### **UI: Log the appointment notes**

As a meeting attendee, you should see a screen similar to the following image when you open a meeting.

### **UI: View the appointment log**

After successfully logging the appointment notes, the button should now be labeled **View** instead of **Log**. You should see a screen similar to the following image.

{301}------------------------------------------------

# **Available APIs**

The following APIs are available for this feature.

- Dialog APIs
- [Office.AddinCommands.Event](https://learn.microsoft.com/en-us/javascript/api/office/office.addincommands.event?view=outlook-js-preview&preserve-view=true)
- [Office.CustomProperties](https://learn.microsoft.com/en-us/javascript/api/outlook/office.customproperties?view=outlook-js-preview&preserve-view=true)
- [Office.RoamingSettings](https://learn.microsoft.com/en-us/javascript/api/outlook/office.roamingsettings?view=outlook-js-preview&preserve-view=true)
- [Appointment Read (attendee) APIs](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentread?view=outlook-js-preview&preserve-view=true) **except** the following:
	- [Office.context.mailbox.item.categories](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentread?view=outlook-js-preview&preserve-view=true#categories)
	- [Office.context.mailbox.item.enhancedLocation](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentread?view=outlook-js-preview&preserve-view=true#enhancedLocation)
	- [Office.context.mailbox.item.isAllDayEvent](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentread?view=outlook-js-preview&preserve-view=true#isAllDayEvent)
	- [Office.context.mailbox.item.recurrence](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentread?view=outlook-js-preview&preserve-view=true#recurrence)

{302}------------------------------------------------

- [Office.context.mailbox.item.sensitivity](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentread?view=outlook-js-preview&preserve-view=true#sensitivity)
- [Office.context.mailbox.item.seriesId](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentread?view=outlook-js-preview&preserve-view=true#seriesId)

To learn more about APIs that are supported in Outlook on mobile devices, see Outlook JavaScript APIs supported in Outlook on mobile devices.

# **Restrictions**

Several restrictions apply.

- The **Log** button name can't be changed. However, there's a way for a different label to be displayed by setting a custom property on the appointment item. For more details, see View appointment notes.
- The **EventLogged** custom property must be used if you want to toggle the label of the **Log** button to **View** and back.
- The add-in icon should be in grayscale using hex code #919191 or its equivalent in [other](https://convertingcolors.com/hex-color-919191.html) [color formats](https://convertingcolors.com/hex-color-919191.html) .
- The add-in should extract the meeting details from the appointment form within the oneminute timeout period. However, any time spent in a dialog box the add-in opened for authentication, for example, is excluded from the timeout period.

# **See also**

- Add-ins for Outlook on mobile devices
- Add support for add-in commands in Outlook on mobile devices
- Outlook JavaScript APIs supported in Outlook on mobile devices

{303}------------------------------------------------

# **Implement event-based activation in Outlook mobile add-ins**

08/01/2025

With the event-based activation feature, develop an add-in to automatically activate and complete operations when certain events occur in Outlook on Android or on iOS, such as composing a new message.

The following sections walk you through how to develop an Outlook mobile add-in that automatically adds a signature to new messages being composed. This highlights a sample scenario of how you can implement event-based activation in your mobile add-in. Significantly enhance the mobile user experience by exploring other scenarios and supported events in your add-in today.

To learn how to implement an event-based add-in for Outlook on the web, on Windows ([new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) and classic), and on Mac, see Activate add-ins with events.

7 **Note**

Outlook on Android and on iOS only support up to Mailbox requirement set 1.5. However, to support the event-based activation feature, some APIs from later requirement sets have been enabled on mobile clients. For more information on this exception, see **Additional supported APIs**.

# **Supported events and clients**

| Event canonical name and<br>add-in only manifest<br>name | Unified app manifest for<br>Microsoft 365 name | Description                                                                                                      | Supported<br>clients                                                            |
|----------------------------------------------------------|------------------------------------------------|------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------|
| OnNewMessageCompose                                      | newMessageComposeCreated                       | Occurs on composing a new<br>message (includes reply,<br>reply all, and forward), but<br>not on editing a draft. | Android<br>(Version<br>4.2352.0<br>and<br>later)<br>iOS<br>(Version<br>4.2352.0 |

{304}------------------------------------------------

| Event canonical name and<br>add-in only manifest<br>name | Unified app manifest for<br>Microsoft 365 name | Description                                                                                                                                                                                           | Supported<br>clients                                                                             |
|----------------------------------------------------------|------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|
|                                                          |                                                |                                                                                                                                                                                                       | and<br>later)                                                                                    |
| OnMessageRecipientsChanged                               | messageRecipientsChanged                       | Occurs on adding or<br>removing recipients while<br>composing a message.<br>Event-specific data object:<br>RecipientsChangedEventArgs                                                                 | Android<br>(Version<br>4.2425.0<br>and<br>later)<br>iOS<br>(Version<br>4.2425.0<br>and<br>later) |
| OnMessageFromChanged                                     | messageFromChanged                             | Occurs on changing the mail<br>account in the From field of<br>a message being composed.<br>To learn more, see<br>Automatically update your<br>signature when switching<br>between Exchange accounts. | Android<br>(Version<br>4.2502.0<br>and<br>later)<br>iOS<br>(Version<br>4.2502.0<br>and<br>later) |

# **Set up your environment**

To run the feature, you must have a supported version of Outlook on Android or on iOS (see Supported events and clients) and a Microsoft 365 subscription. Then, complete the Outlook quick start in which you create an add-in project with the Yeoman generator for Office Add-ins.

# **Configure the manifest**

The steps for configuring the manifest depend on which type of manifest you selected in the quick start.

|  |  | Unified app manifest for Microsoft 365 |
|--|--|----------------------------------------|
|--|--|----------------------------------------|

7 **Note**

{305}------------------------------------------------

- When developing an event-based add-in to run in Outlook on Android and on iOS, note that the unified manifest for Microsoft 365 can only be used if the add-in handles certain events. To learn which events are supported, see **Supported events and clients**.
- Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on mobile devices. To run this type of add-in on mobile platforms, the add-in must first be published to **[AppSource](https://appsource.microsoft.com/)** then deployed in the **Microsoft 365 Admin Center**. For more information, see **Support for add-ins with the unified manifest for Microsoft 365**.
- 1. Configure the ["extensions.runtimes"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array?view=m365-app-prev&preserve-view=true) property just as you would for setting up a function command. For details, see Configure the runtime for the function command.
- 2. In the ["extensions.ribbons.contexts"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array#contexts) array, add mailRead as an item. When you're finished, the array should look like the following.

```
JSON
"contexts": [
 "mailRead"
],
```
- 3. In the ["extensions.ribbons.requirements.formFactors"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/requirements-extension-element#formfactors) array, add "mobile" as an item. When you're finished, the array should look like the following.

```
JSON
"formFactors": [
 "mobile",
 <!-- Typically there will be other form factors listed. -->
]
```
- 4. Add the following ["autoRunEvents"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/element-extensions#autorunevents) array as a property of the object in the ["extensions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root#extensions) array.

```
JSON
"autoRunEvents": [
]
```

{306}------------------------------------------------

- 5. Add an object like the following to the "autoRunEvents" array. Note the following about this code:
	- The "events" property maps handlers to events.
	- The "events.type" must be one of the types listed at Supported events and clients.
	- The value of the "events.actionId" is the name of a function that you create in Implement the event handler.
	- You can have more than one object in the "events" array.

```
JSON
 {
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox",
 "minVersion": "1.5"
 }
 ],
 "scopes": [
 "mail"
 ]
 },
 "events": [
 {
 "type": "newMessageComposeCreated",
 "actionId": "onNewMessageComposeHandler"
 },
 ]
 }
```
#### **Tip**

To learn more about manifests for Outlook add-ins, see **Office Add-ins manifest** and **Add support for add-in commands in Outlook on mobile devices**.

# **Implement the event handler**

To enable your add-in to complete tasks when the OnNewMessageCompose event occurs, you must implement a JavaScript event handler. In this section, you'll create the onNewMessageComposeHandler function that adds a signature to a new message being composed, then shows a message to notify that the signature was added.

{307}------------------------------------------------

- 1. From the same quick start project, navigate to the **./src** directory, then create a new folder named **launchevent**.
- 2. In the **./src/launchevent** folder, create a new file named **launchevent.js**.
- 3. Open the **launchevent.js** file you created and add the following JavaScript code.

```
JavaScript
/*
* Copyright (c) Microsoft Corporation. All rights reserved. Licensed under
the MIT license.
* See LICENSE in the project root for license information.
*/
// Add start-up logic code here, if any.
Office.onReady();
function onNewMessageComposeHandler(event) {
 const item = Office.context.mailbox.item;
 const signatureIcon = 
"iVBORw0KGgoAAAANSUhEUgAAACcAAAAnCAMAAAC7faEHAAAAAXNSR0IArs4c6QAAAARnQU1BAACx
jwv8YQUAAAAzUExURQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAKMFRskAAAAQdFJOUwAQIDBAUGBwgI+fr7/P3+8jGoKKAAAACXBIWXMAAA7DAAAOwwHHb6
hkAAABT0lEQVQ4T7XT2ZalIAwF0DAJhMH+/6+tJOQqot6X6joPiouNBo3w9/Hd6+hrYnUt6vhLcjE
AJevVW0zJxABSlcunhERpjY+UKoNN5+ZgDGu2onNz0OngjP2FM1VdyBW1LtvGeYrBLs7U5I1PTXZt
+zifcS3Icw2GcS3vxRY3Vn/iqx31hUyTnV515kdTfbaNhZLI30AceqDiIo4tyKEmJpKdP5M4um+nU
wfDWxAXdzqMNKQ14jLdL5ntXzxcRF440mhS6yu882Kxa30RZcUIjTCJg7lscsR4VsMjfX9Q0Vuv/W
d3YosD1J4LuSRtaL7bzXGN1wx2cytUdncDuhA3fu6HPTiCvpQUIjZ3sCcHVbvLtbNTHlysx2w9/s2
7m9gEb+7CTri6hR1wcTf2gVf3wBRe3CMbcHYvTODkXhnD0+178K/pZ9+n/C1ru/2HAPwAo7YM1X4+
tLMAAAAASUVORK5CYII=";
 // Get the sender's account information.
 item.from.getAsync((result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.log(result.error.message);
 event.completed();
 return;
 }
 // Create a signature based on the sender's information.
 const name = result.value.displayName;
 const options = { asyncContext: name, isInline: true };
 item.addFileAttachmentFromBase64Async(signatureIcon, 
"signatureIcon.png", options, (result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.log(result.error.message);
 event.completed();
 return;
 }
 // Add the created signature to the message.
 const signature = "<img src='cid:signatureIcon.png'>" +
```

{308}------------------------------------------------

```
result.asyncContext;
 item.body.setSignatureAsync(signature, { coercionType:
Office.CoercionType.Html }, (result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.log(result.error.message);
 event.completed();
 return;
 }
 // Show a notification when the signature is added to the
message.
 const notification = {
 type:
Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,
 message: "Company signature added.",
 icon: "none",
 persistent: false 
 };
 item.notificationMessages.addAsync("signature_notification",
notification, (result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.log(result.error.message);
                event.completed();
                return;
 }
 event.completed();
 });
 });
 });
 });
}
```
- 4. Save your changes.
# **Add a reference to the event-handling JavaScript file**

Ensure that the **./src/commands/commands.html** file has a reference to the JavaScript file that contains your event handler.

- 1. Navigate to the **./src/commands** folder, then open **commands.html**.
- 2. Immediately before the closing **head** tag ( </head> ), add a script entry for the JavaScript file that contains the event handler.

HTML

{309}------------------------------------------------

- 3. Save you changes.
# **Test and validate your add-in**

- 1. Follow the guidance to test and validate your add-in.
- 2. Sideload your add-in in Outlook on Windows (new or classic), on Mac, or on the web.
- 3. Open Outlook on Android or on iOS. If you have Outlook already open on your device, restart it.
- 4. Create a new message. The event-based add-in adds the signature to the message. If you have a signature saved on your mobile device, it will briefly appear in the message you create, but will be immediately replaced by the signature added by the add-in.

| New message<br>0<br>×         |   |
|-------------------------------|---|
| Company signature added.<br>0 | × |
| To                            |   |
| Subject                       |   |
| General                       |   |
| Adele Vance                   |   |

# **Behavior and limitations**

As you develop an event-based add-in for Outlook mobile, be mindful of the following feature behaviors and limitations.

- Because event-based add-ins are expected to be short-running and lightweight, an addin is allowed to run for a maximum of 60 seconds from the time it activates. To signal that your add-in has completed processing an event, your event handler must call the [event.completed](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxevent#outlook-office-mailboxevent-completed-member(1)) method. The add-in operation also ends when the user closes the compose window or sends the message.

{310}------------------------------------------------

- Only one add-in can run at a time. If multiple event-based add-ins are installed on a user's account, they will run sequentially.
- If you tap and hold the Outlook icon on your mobile device, then select **New mail** to create a new message, an event-based add-in that handles the OnNewMessageCompose event may take a few seconds to initialize and complete processing the event.
- When using an event-based add-in that handles the OnNewMessageCompose event, if there are no changes made to a new message being composed, a draft won't be saved. This applies even if the add-in adds a signature using the [Office.context.mailbox.item.body.setSignatureAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body#outlook-office-body-setsignatureasync-member(1)) method.
- In an event-based add-in that manages signatures when the OnNewMessageCompose event occurs, if you select **Reply** from the bottom of a message, the add-in activates and adds the signature to the message. However, the signature won't be visible in the current view. To view your message with the added signature, expand the compose window to full screen.
- To enhance your add-in's functionality, you can use supported APIs from later requirement sets in compose mode. For more information, see Additional supported APIs.

# **Additional supported APIs**

Although Outlook mobile supports APIs up to [Mailbox requirement set 1.5](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.5/outlook-requirement-set-1.5), to further extend the capability of your event-based add-in in Outlook mobile, additional APIs from later requirement sets are now supported in compose mode.

- [Office.context.mailbox.item.addFileAttachmentFromBase64Async](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messagecompose#outlook-office-messagecompose-addfileattachmentfrombase64async-member(1))
- [Office.context.mailbox.item.disableClientSignatureAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messagecompose#outlook-office-messagecompose-disableclientsignatureasync-member(1))
- [Office.context.mailbox.item.from.getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.from#outlook-office-from-getasync-member(1))
- [Office.context.mailbox.item.getComposeTypeAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messagecompose#outlook-office-messagecompose-getcomposetypeasync-member(1))
- [Office.context.mailbox.item.body.setSignatureAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body#outlook-office-body-setsignatureasync-member(1))
- [Office.context.mailbox.item.sessionData](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messagecompose#outlook-office-messagecompose-sessiondata-member)

To learn more about APIs that are supported in Outlook on mobile devices, see Outlook JavaScript APIs supported in Outlook on mobile devices.

# **Deploy to users**

Event-based add-ins must be deployed by an organization's administrator. For guidance on how to deploy your add-in via the Microsoft 365 admin center, see the "Deploy your add-in" section of Activate add-ins with events.

# **See also**

{311}------------------------------------------------

- Activate add-ins with events
- Add-ins for Outlook on mobile devices
- Add mobile support to an Outlook add-in
- Outlook JavaScript APIs supported in Outlook on mobile devices

{312}------------------------------------------------

# **Create an Outlook add-in for an onlinemeeting provider**

08/08/2025

Setting up an online meeting is a core experience for an Outlook user, and it's easy to [create a](https://learn.microsoft.com/en-us/microsoftteams/teams-add-in-for-outlook) [Teams meeting with Outlook](https://learn.microsoft.com/en-us/microsoftteams/teams-add-in-for-outlook). However, creating an online meeting in Outlook with a non-Microsoft service can be cumbersome. By implementing this feature, service providers can streamline the online meeting creation and joining experience for their Outlook add-in users.

In this article, you'll learn how to set up your Outlook add-in to enable users to organize and join a meeting using your online-meeting service. Throughout this article, we'll use a fictional online-meeting service provider, "Contoso".

#### ) **Important**

This feature is supported in Outlook on the web, Windows (**[new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** and classic), Mac, Android, and iOS with a Microsoft 365 subscription.

## **Set up your environment**

Complete the Outlook quick start in which you create an add-in project with the Yeoman generator for Office Add-ins.

# **Configure the manifest**

The steps for configuring the manifest depend on which type of manifest you selected in the quick start.

Unified manifest for Microsoft 365

#### 7 **Note**

Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on Mac and on mobile devices. To run this type of add-in on Mac and on mobile platforms, the add-in must first be published to **[AppSource](https://appsource.microsoft.com/)** then deployed in the **Microsoft 365 Admin Center**. For more information, see the "Client and

{313}------------------------------------------------

platform support" section of **Office Add-ins with the unified app manifest for Microsoft 365**.

- 1. Open the **manifest.json** file.
- 2. Find the *first* object in the ["authorization.permissions.resourceSpecific"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-authorization-permissions#resourcespecific) array and set its "name" property to "MailboxItem.ReadWrite.User" . It should look like this when you're done.

```
JSON
{
 "name": "MailboxItem.ReadWrite.User",
 "type": "Delegated"
}
```
- 3. In the ["validDomains"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root#validdomains) array, change the URL to "https://contoso.com" , which is the URL of the fictional online meeting provider. The array should look like this when you're done.

```
JSON
"validDomains": [
 "https://contoso.com"
],
```
- 4. Add the following object to the ["extensions.runtimes"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array?view=m365-app-prev&preserve-view=true) array. Note the following about this code.
	- The "minVersion" of the Mailbox requirement set is set to "1.3" so the runtime won't launch on platforms and Office versions where this feature isn't supported.
	- The "id" of the runtime is set to the descriptive name "online_meeting_runtime" .
	- The ["code.page"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtime-code#page) property is set to the URL of UI-less HTML file that will load the function command.
	- The "lifetime" property is set to "short" which means that the runtime starts up when the function command button is selected and shuts down when the function completes. (In certain rare cases, the runtime shuts down before the handler completes. See Runtimes in Office Add-ins.)
	- There's an action to run a function named "insertContosoMeeting" . You'll create this function in a later step.

{314}------------------------------------------------

```
JSON
```

```
{
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox",
 "minVersion": "1.3"
 }
 ],
 "formFactors": [
 "desktop"
 ]
 },
 "id": "online_meeting_runtime",
 "type": "general",
 "code": {
 "page": "https://contoso.com/commands.html"
 },
 "lifetime": "short",
 "actions": [
 {
 "id": "insertContosoMeeting",
 "type": "executeFunction",
 "displayName": "insertContosoMeeting"
 }
 ]
}
```
- 5. Replace the ["extensions.ribbons"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/element-extensions#ribbons-property) array with the following. Note the following about this markup.
	- The "minVersion" of the Mailbox requirement set is set to "1.3" so the the ribbon customizations won't appear on platforms and Office versions where this feature is not supported.
	- The "contexts" array specifies that the ribbon is available only in the meeting details organizer window.
	- There will be a custom control group on the default ribbon tab (of the meeting details organizer window) labelled **Contoso meeting**.
	- The group will have a button labelled **Add meeting**.
	- The button's "actionId" has been set to "insertContosoMeeting" , which matches the "id" of the action you created in the previous step.

```
JSON
```

```
"ribbons": [
 {
 "requirements": {
 "capabilities": [
```

{315}------------------------------------------------

```
 {
 "name": "Mailbox",
 "minVersion": "1.3"
 }
 ],
 "scopes": [
 "mail"
 ],
 "formFactors": [
 "desktop"
 ]
 },
 "contexts": [
 "meetingDetailsOrganizer"
 ],
 "tabs": [
 {
 "builtInTabId": "TabDefault",
 "groups": [
 {
 "id": "apptComposeGroup",
 "label": "Contoso meeting",
 "controls": [
 {
 "id": "insertMeetingButton",
              "type": "button",
              "label": "Add meeting",
              "icons": [
 {
 "size": 16,
                  "url": "icon-16.png"
 },
                {
 "size": 32,
                  "url": "icon-32.png"
 },
                {
 "size": 64,
                  "url": "icon-64_02.png"
 },
                {
 "size": 80,
                  "url": "icon-80.png"
 }
 ],
              "supertip": {
 "title": "Add a Contoso meeting",
                "description": "Add a Contoso meeting to
this appointment."
 },
              "actionId": "insertContosoMeeting",
 }
 ]
 }
 ]
```

{316}------------------------------------------------

### **Add mobile support**

- 1. Open the **manifest.json** file.
- 2. In the ["extensions.ribbons.requirements.formFactors"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/requirements-extension-element#formfactors) array, add "mobile" as an item. When you're finished, the array should look like the following.

JSON

```
"formFactors": [
 "desktop",
 "mobile"
]
```
- 1. In the ["extensions.ribbons.contexts"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array#contexts) array, add onlineMeetingDetailsOrganizer as an item. When you're finished, the array should look like the following.
JSON

```
"contexts": [
 "meetingDetailsOrganizer",
 "onlineMeetingDetailsOrganizer"
],
```
- 1. In the ["extensions.ribbons.tabs"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array#tabs) array, find the tab with the "builtInTabId" of "TabDefault" . Add a child "customMobileRibbonGroups" array to it (as a peer of the existing "groups" property). When you're finished, the "tabs" array should look like the following:

```
JSON
"tabs": [
 {
 "builtInTabId": "TabDefault",
 "groups": [
 <-- non-mobile group objects omitted -->
 ],
 "customMobileRibbonGroups": [
 {
 "id": "mobileApptComposeGroup",
 "label": "Contoso Meeting",
```

{317}------------------------------------------------

```
 "controls": [
 { 
 "id": "mobileInsertMeetingButton",
              "label": "Add meeting",
              "type": "mobileButton",
              "actionId": "insertContosoMeeting",
              "icons": [
 {
 "scale": 1,
                   "size": 25,
 "url": "https://contoso.com/assets/icon-25.png"
 },
                {
 "scale": 1,
                   "size": 32,
                   "url": "https://contoso.com/assets/icon-
32.png"
 },
                {
 "scale": 1,
                   "size": 48,
                   "url": "https://contoso.com/assets/icon-
48.png"
 }, 
                {
 "scale": 2,
                   "size": 25,
                   "url": "https://contoso.com/assets/icon-
25.png"
 },
                {
 "scale": 2,
                   "size": 32,
                   "url": "https://contoso.com/assets/icon-
32.png"
 },
                {
 "scale": 2,
                   "size": 48,
                   "url": "https://contoso.com/assets/icon-
48.png"
 }, 
                {
 "scale": 3,
                   "size": 25,
                   "url": "https://contoso.com/assets/icon-
25.png"
 },
                {
 "scale": 3,
                   "size": 32,
                   "url": "https://contoso.com/assets/icon-
32.png"
 },
                {
```

{318}------------------------------------------------

#### **Tip**

To learn more about manifests for Outlook add-ins, see **Office Add-in manifests** and **Add support for add-in commands in Outlook on mobile devices**.

# **Implement adding online meeting details**

In this section, learn how your add-in script can update a user's meeting to include online meeting details. The following applies to all supported platforms.

- 1. From the same quick start project, open the file **./src/commands/commands.js** in your code editor.
- 2. Replace the entire content of the **commands.js** file with the following JavaScript.

```
JavaScript
// 1. How to construct online meeting details.
// Not shown: How to get the meeting organizer's ID and other details from
your service.
const newBody = '<br>' +
 '<a href="https://contoso.com/meeting?id=123456789" target="_blank">Join
Contoso meeting</a>' +
 '<br><br>' +
 'Phone Dial-in: +1(123)456-7890' +
 '<br><br>' +
 'Meeting ID: 123 456 789' +
 '<br><br>' +
 'Want to test your video connection?' +
 '<br><br>' +
 '<a href="https://contoso.com/testmeeting" target="_blank">Join test
meeting</a>' +
 '<br><br>';
```

{319}------------------------------------------------

```
let mailboxItem;
// Office is ready.
Office.onReady(function () {
 mailboxItem = Office.context.mailbox.item;
 }
);
// 2. How to define and register a function command named
`insertContosoMeeting` (referenced in the manifest)
// to update the meeting body with the online meeting details.
function insertContosoMeeting(event) {
 // Get HTML body from the client.
 mailboxItem.body.getAsync("html",
 { asyncContext: event },
 function (getBodyResult) {
 if (getBodyResult.status === Office.AsyncResultStatus.Succeeded)
{
 updateBody(getBodyResult.asyncContext, getBodyResult.value);
 } else {
 console.error("Failed to get HTML body.");
 getBodyResult.asyncContext.completed({ allowEvent: false });
 }
 }
 );
}
// Register the function.
Office.actions.associate("insertContosoMeeting", insertContosoMeeting);
// 3. How to implement a supporting function `updateBody`
// that appends the online meeting details to the current body of the
meeting.
function updateBody(event, existingBody) {
 // Append new body to the existing body.
 mailboxItem.body.setAsync(existingBody + newBody,
 { asyncContext: event, coercionType: "html" },
 function (setBodyResult) {
 if (setBodyResult.status === Office.AsyncResultStatus.Succeeded)
{
 setBodyResult.asyncContext.completed({ allowEvent: true });
 } else {
 console.error("Failed to set HTML body.");
 setBodyResult.asyncContext.completed({ allowEvent: false });
 }
 }
 );
}
```
## **Test and validate your add-in**

Follow the usual guidance to test and validate your add-in, then sideload the manifest in Outlook on the web, on Windows (new or classic), or on Mac. If your add-in also supports 

{320}------------------------------------------------

mobile, restart Outlook on your Android or iOS device after sideloading. Once the add-in is sideloaded, create a new meeting and verify that the Microsoft Teams or Skype toggle is replaced with your own.

### **Create meeting UI**

As a meeting organizer, you should see screens similar to the following three images when you create a meeting.

{321}------------------------------------------------

{322}------------------------------------------------

### **Join meeting UI**

As a meeting attendee, you should see a screen similar to the following image when you view the meeting.

#### ) **Important**

The **Join** button is only supported in Outlook on the web, on Mac, on Android, on iOS, and in new Outlook on Windows. If you only see a meeting link, but don't see the **Join** button in a supported client, it may be that the online-meeting template for your service isn't registered on our servers. See the **Register your online-meeting template** section for details.

# **Register your online-meeting template**

Registering your online-meeting add-in is optional. It only applies if you want to surface the **Join** button in meetings, in addition to the meeting link. Once you've published your onlinemeeting add-in and would like to register it, create a GitHub issue using the following guidance. We'll contact you to coordinate a registration timeline.

{323}------------------------------------------------

#### ) **Important**

- The **Join** button is only supported in Outlook on the web, on Mac, on Android, on iOS, and in new Outlook on Windows.
- Only online-meeting add-ins published to AppSource can be registered. Line-ofbusiness add-ins aren't supported.
- 1. Create a [new GitHub issue](https://github.com/OfficeDev/office-js/issues/new) .
- 2. Set the **Title** of the new issue to "Outlook: Register the online-meeting template for myservice", replacing my-service with your service name.
- 3. In the issue body, replace the existing text with the following:
	- The asset ID of your published add-in.
	- The string you set in the newBody or similar variable from the Implement adding online meeting details section earlier in this article.

#### 4. Click **Submit new issue**.

| Register the online-meeting template for Contoso                                                                                                                                                                                                                                                                                                                                                       |                  |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------|
| Add a description                                                                                                                                                                                                                                                                                                                                                                                      |                  |
| Write<br>Preview                                                                                                                                                                                                                                                                                                                                                                                       |                  |
| Can you please register the online-meeting template for our Contoso service?                                                                                                                                                                                                                                                                                                                           |                  |
| Asset ID: WA123456789                                                                                                                                                                                                                                                                                                                                                                                  |                  |
| '<br>' +<br>' <a href="https://contoso.com/meeting?id=123456789" target="_blank">Join Contoso meeting</a> ' +<br>'<br><br>' +<br>'Phone Dial-in" +1(123)456-7890' +<br>'<br><br>' +<br>'Meeting ID: 123 456 789' +<br>'<br><br>' +<br>'Want to test your video connection?' +<br>'<br><br>' +<br>' <a href="https://contoso.com/testmeeting" target="_blank">Join test meeting</a> ' +<br>'<br><br>' + |                  |
| Thanks.                                                                                                                                                                                                                                                                                                                                                                                                |                  |
|                                                                                                                                                                                                                                                                                                                                                                                                        | Submit new issue |

{324}------------------------------------------------

# **Automatically provide post-meeting resources and updates to attendees**

After a meeting ends, the organizer and attendees often need access to important resources such as video recordings or meeting transcripts. If available, your online-meeting add-in can automatically update the meeting invite with these resources, making them easily accessible to all participants.

This section outlines how to use the Microsoft Graph API to update a calendar item with postmeeting resources. The updated content of a meeting will be reflected in the calendars of the organizer and the attendees. Additionally, an update will be sent to the attendees.

This implementation requires the following:

- An access token to make Microsoft Graph API calls. For guidance, see Use the Microsoft Graph REST API from an Outlook add-in.
- An indicator to your add-in when a meeting scheduled with your online-meeting add-in has ended.
- Access to a meeting's Exchange ID and the ID assigned by the add-in.
- Access to the necessary resources that will be added to the meeting.
- Access to the meeting instance created by the organizer. Changes must be made to the organizer's meeting instance to propagate to the attendees' meeting instance.
- 1. When a meeting ends, configure your add-in to fetch the resources that will be added to the meeting object.
- 2. Use the Microsoft Graph API to get the organizer's meeting instance. Ensure that the body property is included in the request. For information on the API, see [Get event.](https://learn.microsoft.com/en-us/graph/api/event-get)
- 3. Update the body of the meeting with the applicable meeting resources. For information on the API, see [Update event](https://learn.microsoft.com/en-us/graph/api/event-update).

#### ) **Important**

When making changes to the body property of a meeting, make sure to preserve the online meeting blob. Removing the meeting blob from the body disables the onlinemeeting functionality.

Once the meeting resources have been added to the meeting, an update is sent to the attendees. The changes are also reflected in the calendar instances of the organizer and the attendees.

{325}------------------------------------------------

The following is an example of how to update the meeting body with a link to a video recording.

```
JavaScript
const options = {
 authProvider,
};
const client = Client.init(options);
// Get the body of the meeting.
const currentEvent = await client.api('/users/{organizerId}/events/{meetingId}')
 .select('body')
 .get();
const existingBody = currentEvent.body.content;
// Update the body with a link to a video recording.
const meetingResources = `
<br><br>
<h2>Meeting summary</h2>
<p>The team discussed monthly sales targets for Fabrikam. Current market
conditions were discussed. A follow-up meeting will be scheduled to finalize
revenue goals for the quarter.</p>
<a href="https://contoso.com/recording/123456789" target="_blank">View
recording</a>
`;
const updatedBody = existingBody + meetingResources;
const updatedEvent = {
 body: {
 contentType: 'html',
 content: updatedBody
 }
};
// Update the event with the new body content.
await client.api('/users/{organizerId}/events/{meetingId}')
 .update(updatedEvent);
```
# **Available APIs**

The following APIs are available for this feature.

- Appointment Organizer APIs
	- [Office.context.mailbox.item.body](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentcompose?view=outlook-js-preview&preserve-view=true#outlook-office-appointmentcompose-body-member) [(Body.getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body?view=outlook-js-preview&preserve-view=true#outlook-office-body-getasync-member(1)), [Body.setAsync)](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body?view=outlook-js-preview&preserve-view=true#outlook-office-body-setasync-member(1))
	- [Office.context.mailbox.item.end](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentcompose?view=outlook-js-preview&preserve-view=true#outlook-office-appointmentcompose-end-member) [(Time)](https://learn.microsoft.com/en-us/javascript/api/outlook/office.time?view=outlook-js-preview&preserve-view=true)
	- [Office.context.mailbox.item.loadCustomPropertiesAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentcompose?view=outlook-js-preview&preserve-view=true#outlook-office-appointmentcompose-loadcustompropertiesasync-member(1)) ([CustomProperties)](https://learn.microsoft.com/en-us/javascript/api/outlook/office.customproperties?view=outlook-js-preview&preserve-view=true)

{326}------------------------------------------------

- [Office.context.mailbox.item.location](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentcompose?view=outlook-js-preview&preserve-view=true#outlook-office-appointmentcompose-location-member) ([Location](https://learn.microsoft.com/en-us/javascript/api/outlook/office.location?view=outlook-js-preview&preserve-view=true))
- [Office.context.mailbox.item.optionalAttendees](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentcompose?view=outlook-js-preview&preserve-view=true#outlook-office-appointmentcompose-optionalattendees-member) [(Recipients](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients?view=outlook-js-preview&preserve-view=true))
- [Office.context.mailbox.item.requiredAttendees](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentcompose?view=outlook-js-preview&preserve-view=true#outlook-office-appointmentcompose-requiredattendees-member) ([Recipients](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients?view=outlook-js-preview&preserve-view=true))
- [Office.context.mailbox.item.start](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentcompose?view=outlook-js-preview&preserve-view=true#outlook-office-appointmentcompose-start-member) ([Time](https://learn.microsoft.com/en-us/javascript/api/outlook/office.time?view=outlook-js-preview&preserve-view=true))
- [Office.context.mailbox.item.subject](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentcompose?view=outlook-js-preview&preserve-view=true#outlook-office-appointmentcompose-subject-member) ([Subject)](https://learn.microsoft.com/en-us/javascript/api/outlook/office.subject?view=outlook-js-preview&preserve-view=true)
- [Office.context.roamingSettings](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context?view=outlook-js-preview&preserve-view=true#roamingsettings-roamingsettings) [(RoamingSettings)](https://learn.microsoft.com/en-us/javascript/api/outlook/office.roamingsettings?view=outlook-js-preview&preserve-view=true)
- Handle auth flow
	- Dialog APIs

# **Restrictions**

Several restrictions apply.

- Applicable only to online-meeting service providers.
- Only admin-installed add-ins will appear on the meeting compose screen, replacing the default Teams or Skype option. User-installed add-ins won't activate.
- The add-in icon should be in grayscale using hex code #919191 or its equivalent in [other](https://convertingcolors.com/hex-color-919191.html) [color formats](https://convertingcolors.com/hex-color-919191.html) .
- Only one function command is supported in Appointment Organizer (compose) mode.
- The add-in should update the meeting details in the appointment form within the oneminute timeout period. However, any time spent in a dialog box the add-in opened for authentication, for example, is excluded from the timeout period.

# **See also**

- Add-ins for Outlook on mobile devices
- Add support for add-in commands in Outlook on mobile devices
- [Working with calendars and events using the Microsoft Graph API](https://learn.microsoft.com/en-us/graph/api/resources/calendar-overview)

{327}------------------------------------------------

# **Contextual Outlook add-ins**

Article • 07/18/2024

Contextual add-ins are Outlook add-ins that activate based on text in a message or appointment. By using contextual add-ins, a user can initiate tasks related to a mail item without leaving the item itself. For example, a contextual add-in can choose a string in the body of a mail item that opens a meeting suggestion add-in.

You can specify regular expression rules to activate a contextual add-in when a match is found in specific fields of the message. Contextual add-ins only activate in read mode. Outlook doesn't activate contextual add-ins when the user is composing an item.

#### ) **Important**

Entity-based contextual Outlook add-ins are now retired. As an alternative solution, implement regular expression rules in your contextual add-in.

# **Configure the manifest**

#### 7 **Note**

Contextual Outlook add-ins aren't supported when the add-in uses a **Unified manifest for Microsoft 365**.

A contextual add-in's manifest must include an [ExtensionPoint](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#detectedentity) element with its xsi:type attribute set to DetectedEntity . Within the **<ExtensionPoint>** element, the add-in must then specify a regular expression rule using the [Rule](https://learn.microsoft.com/en-us/javascript/api/manifest/rule) element with its xsi:type attribute set to [ItemHasRegularExpressionMatch.](https://learn.microsoft.com/en-us/javascript/api/manifest/rule#itemhasregularexpressionmatch-rule)

The following example activates an add-in whenever a stock symbol is included in the body of the current mail item.

| XML                                                                                                                                                                                                                                                                                              |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <extensionpoint xsi:type="DetectedEntity"><br/><label resid="Context.Label"></label><br/><sourcelocation resid="DetectedEntity.URL"></sourcelocation><br/><rule <br="" xsi:type="ItemHasRegularExpressionMatch">PropertyName="BodyAsPlaintext" RegExName="TickerSymbols"</rule></extensionpoint> |

{328}------------------------------------------------

### **Supported characters in regular expression rules**

Outlook evaluates regular expressions based on the rules for the JavaScript interpreter used by the browser or webview control on the client computer. For brevity, this article uses "browser" to refer to "browser or webview control". Outlook supports the same list of special characters that all XML processors also support. The following table lists these special characters. You can use these characters in a regular expression by specifying the escape sequence of the corresponding character.

ノ **Expand table**

| Character | Description           | Escape sequence to use |
|-----------|-----------------------|------------------------|
| "         | Double quotation mark | "                      |
| &         | Ampersand             | &                      |
| '         | Apostrophe            | '                      |
| <         | Less-than sign        | <                      |
| >         | Greater-than sign     | >                      |

### **Best practices for using regular expressions in rules**

Be mindful of the following when you use regular expressions.

- If you specify an ItemHasRegularExpressionMatch rule on the body of an item, the regular expression should further filter the body and shouldn't attempt to return the entire body of the item. Using a regular expression such as .* to attempt to obtain the entire body of an item doesn't always return the expected results.
- The plain text body returned on one browser can be different in subtle ways on another. If you use an ItemHasRegularExpressionMatch rule with BodyAsPlaintext as the PropertyName attribute, test your regular expression on all the browsers that your add-in supports.

Because different browsers use different ways to obtain the text body of a selected item, you should make sure that your regular expression supports the subtle differences that can be returned as part of the body text. For example, browsers

{329}------------------------------------------------

may return line breaks differently. For more information, see [W3C DOM](https://quirksmode.org/dom/html/) [Compatibility - HTML](https://quirksmode.org/dom/html/) .

- The HTML body of an item is slightly different between classic Outlook on Windows or Outlook on Mac, and Outlook on the web, on mobile devices, or [new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) [Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) . Define your regular expressions carefully.
- Depending on the Outlook client, type of device, or property that a regular expression is being applied on, there are other best practices and limits for each of the clients that you should be aware of when designing regular expressions as activation rules. For details, see Limits for activation and JavaScript API for Outlook add-ins.

# **Use regular expression results in your JavaScript code**

In the JavaScript code of your add-in, you can obtain matches to a regular expression by using the following methods on the current item.

- [getRegExMatches](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods) returns matches in the current item for all regular expressions specified in an ItemHasRegularExpressionMatch rule of the add-in.
- [getRegExMatchesByName](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods) returns matches in the current item for the identified regular expression specified in an ItemHasRegularExpressionMatch rule of the addin.
- [getSelectedRegExMatches](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods) returns highlighted matches in the current item for the regular expression specified in an ItemHasRegularExpressionMatch rule of the addin.

When the regular expressions are evaluated, the matches are returned to your add-in in an array object. For getRegExMatches , that object has the identifier of the name of the regular expression.

#### 7 **Note**

Outlook doesn't return matches in any particular order in the array. Also, you shouldn't assume that matches are returned in the same order in this array even when you run the same add-in on each of these clients on the same item in the same mailbox.

{330}------------------------------------------------

The following is an example of a rule collection that contains an

ItemHasRegularExpressionMatch rule with a regular expression named videoURL .

```
XML
<Rule xsi:type="RuleCollection" Mode="And">
 <Rule xsi:type="ItemIs" ItemType="Message"/>
 <Rule xsi:type="ItemHasRegularExpressionMatch" RegExName="videoURL"
RegExValue="http://www\.youtube\.com/watch\?v=[a-zA-Z0-9_-]{11}"
PropertyName="BodyAsPlaintext"/>
</Rule>
```
The getRegExMatches method is then called on the current message to set a variable videos to the results of specified ItemHasRegularExpressionMatch rule.

```
JavaScript
const videos = Office.context.mailbox.item.getRegExMatches().videoURL;
```
# **See also**

- [Outlook add-in: Contoso Order Number](https://github.com/OfficeDev/Outlook-Add-In-Contextual-Regex) (sample contextual add-in that activates based on a regular expression match)
- Build your first Outlook add-in

{331}------------------------------------------------

# **Troubleshoot Outlook contextual add-in activation**

07/14/2025

Outlook contextual add-in activation is based on the activation rules in an add-in only manifest for the add-in. When conditions for the currently selected item satisfy the activation rules for the add-in, the application activates and displays the add-in button in the Outlook UI (add-in selection pane for compose add-ins, add-in bar for read add-ins). However, if your add-in doesn't activate as you expect, you should look into the following areas for possible reasons.

#### ) **Important**

Entity-based contextual Outlook add-ins are now retired. As an alternative solution, implement regular expression rules in your contextual add-in. For guidance on how to implement these rules, see **Contextual Outlook add-ins**.

# **Is user mailbox on a version of Exchange Server that is at least Exchange 2016?**

First, ensure that the user's email account you're testing with is on a version of Exchange Server that is at least Exchange 2016. If you're using specific features that are released after Exchange 2016, make sure the user's account is on the appropriate version of Exchange.

You can verify the version of Exchange by using one of the following approaches.

- Check with your Exchange Server administrator.
- If you're testing the add-in on Outlook on the web or mobile devices, in a script debugger (for example, the JScript Debugger that comes with Internet Explorer), look for the **src** attribute of the **script** tag that specifies the location from which scripts are loaded. The path should contain a substring **owa/15.0.516.x/owa2/...**, where **15.0.516.x** represents the version of the Exchange Server, such as **15.0.516.2**.
- Alternatively, you can use the [Office.context.mailbox.diagnostics.hostVersion](https://learn.microsoft.com/en-us/javascript/api/outlook/office.diagnostics#outlook-office-diagnostics-hostversion-member) property to verify the version. In Outlook on the web, on mobile devices, and in [new Outlook on](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) [Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) , this property returns the version of the Exchange Server.

# **Is the add-in available?**

{332}------------------------------------------------

Check your list of installed add-ins to verify whether an add-in is available. For instructions on how to view your add-ins in Outlook, see [Use add-ins in Outlook](https://support.microsoft.com/office/1ee261f9-49bf-4ba6-b3e2-2ba7bcab64c8) .

If you also use the classic Outlook on Mac client, resource usage limits apply to add-ins that could affect their availability across supported platforms. For more information, see Resource usage limits for add-ins.

# **Does the tested item support Outlook add-ins? Is the selected item delivered by a version of Exchange Server that is at least Exchange 2016?**

If your Outlook add-in is a read add-in and is supposed to be activated when the user is viewing a message (including email messages, meeting requests, responses, and cancellations) or appointment, even though these items generally support add-ins, there are exceptions. Check if the selected item is one of those listed where Outlook add-ins don't activate.

Also, because appointments are always saved in Rich Text Format, an [ItemHasRegularExpressionMatch](https://learn.microsoft.com/en-us/javascript/api/manifest/rule#itemhasregularexpressionmatch-rule) rule that specifies a **PropertyName** value of **BodyAsHTML** wouldn't activate an add-in on an appointment or message that's saved in plain text or Rich Text Format.

# **Is the add-in manifest installed properly, and does Outlook have a cached copy?**

#### 7 **Note**

Outlook add-in features that depend on activation rules aren't supported when the add-in uses a **unified app manifest for Microsoft 365**.

This scenario applies to only classic Outlook on Windows. Normally, when you install an Outlook add-in for a mailbox, the Exchange Server copies the add-in manifest from the location you indicate to the mailbox on that Exchange Server. Every time Outlook starts, it reads all the manifests installed for that mailbox into a temporary cache at the following location.

text

%LocalAppData%\Microsoft\Office\16.0\WEF

{333}------------------------------------------------

For example, for the user John, the cache might be at C:\Users\john\AppData\Local\Microsoft\Office\16.0\WEF.

If an add-in doesn't activate for any items, the manifest might not have been installed properly on the Exchange Server, or Outlook hasn't read the manifest properly on startup. Using the Exchange Admin Center, ensure that the add-in is installed and enabled for your mailbox, and reboot the Exchange Server, if necessary.

The following figure shows a summary of the steps to verify whether Outlook has a valid version of the manifest.

The following procedure describes the details.

- 1. If you have modified the manifest while Outlook is open, and you're not using Visual Studio 2015 or a later version of Visual Studio to develop the add-in, you should uninstall the add-in and reinstall it using the Exchange Admin Center.

{334}------------------------------------------------

- 2. Restart Outlook and test whether Outlook now activates the add-in.
- 3. If Outlook doesn't activate the add-in, check whether Outlook has a properly cached copy of the manifest for the add-in. Look under the following path.

text

%LocalAppData%\Microsoft\Office\16.0\WEF

You can find the manifest in the following subfolder.

text

```
\<insert your guid>\<insert base 64 hash>\Manifests\
<ManifestID>_<ManifestVersion>
```
#### 7 **Note**

The following is an example of a path to a manifest installed for a mailbox for the user John.

text

C:\Users\john\appdata\Local\Microsoft\Office\16.0\WEF\{8D8445A4-80E4- 4D6B-B7AC-D4E6AF594E73}\GoRshCWa7vW8+jhKmyiDhA==\Manifests\b3d7d9d5-6f57- 437d-9830-94e2aaccef16_1.2

Verify whether the manifest of the add-in you're testing is among the cached manifests.

- 4. If the manifest is in the cache, skip the rest of this section and consider the other possible reasons following this section.
- 5. If the manifest is not in the cache, check whether Outlook indeed successfully read the manifest from the Exchange Server. To do that, use the Windows Event Viewer:
	- a. Under **Windows Logs**, choose **Application**.
	- b. Look for a reasonably recent event for which the Event ID equals 63, which represents Outlook downloading a manifest from an Exchange Server.
	- c. If Outlook successfully read a manifest, the logged event should have the following description.

{335}------------------------------------------------

The Exchange web service request GetAppManifests succeeded.

Then skip the rest of this section and consider the other possible reasons following this section.

- 6. If you don't see a successful event, close Outlook, and delete all the manifests in the following path.

```
text
%LocalAppData%\Microsoft\Office\16.0\WEF\<insert your guid>\<insert base 64
hash>\Manifests\
```
Start Outlook and test whether Outlook now activates the add-in.

- 7. If Outlook doesn't activate the add-in, go back to Step 3 to verify again whether Outlook has properly read the manifest.
### **Is the add-in manifest valid?**

See Validate and troubleshoot issues with your manifest to debug add-in manifest issues.

# **Are you using the appropriate activation rules?**

Starting in version 1.1 of the Office Add-ins manifests schema, you can create add-ins that are activated when the user is in a compose form (compose add-ins) or in a read form (read addins). Make sure you specify the appropriate activation rules for each type of form that your add-in is supposed to activate in. For example, you can activate compose add-ins using only [ItemIs](https://learn.microsoft.com/en-us/javascript/api/manifest/rule#itemis-rule) rules with the **FormType** attribute set to **Edit** or **ReadOrEdit**, and you can't use any of the other types of rules, such as [ItemHasRegularExpressionMatch](https://learn.microsoft.com/en-us/javascript/api/manifest/rule#itemhasregularexpressionmatch-rule) rules for compose add-ins.

# **If you use a regular expression, is it properly specified?**

Because regular expressions in activation rules are part of the XML-formatted add-in only manifest file for a read add-in, if a regular expression uses certain characters, be sure to follow the corresponding escape sequence that XML processors support. The following table lists these special characters.

{336}------------------------------------------------

| Character | Description           | Escape sequence to use |
|-----------|-----------------------|------------------------|
| "         | Double quotation mark | "                      |
| &         | Ampersand             | &                      |
| '         | Apostrophe            | '                      |
| <         | Less-than sign        | <                      |
| >         | Greater-than sign     | >                      |

# **If you use a regular expression, does the read addin activate in Outlook on the web, on mobile devices, or in new Outlook on Windows, but not in Outlook on Windows (classic) or Outlook on Mac?**

Outlook on Windows (classic) and Outlook on Mac use a regular expression engine that's different from the one used by Outlook on the web, on mobile devices, and on [new Outlook on](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) [Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) . Classic Outlook on Windows and Outlook on Mac use the C++ regular expression engine provided as part of the Visual Studio standard template library. This engine complies with ECMAScript 5 standards. Outlook on the web, on mobile devices, and [new Outlook on](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) [Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) use regular expression evaluation that's part of JavaScript, is provided by the browser, and supports a superset of ECMAScript 5.

While in most cases, these Outlook clients find the same matches for the same regular expression in an activation rule, there are exceptions. For instance, if the regex includes a custom character class based on predefined character classes, Outlook on Windows (classic) and Outlook on Mac may return results different from Outlook on the web, on mobile devices, and new Outlook on Windows. As an example, character classes that contain shorthand character classes [\d\w] within them would return different results. In this case, to avoid different results on different applications, use (\d|\w) instead.

Test your regular expression thoroughly. If it returns different results, rewrite the regular expression for compatibility with both engines. To verify evaluation results in Outlook on Windows (classic) and Outlook on Mac, write a small C++ program that applies the regular expression against a sample of the text you are trying to match. Running on Visual Studio, the C++ test program would use the standard template library, simulating the behavior of Outlook on Windows (classic) or Outlook on Mac when running the same regular expression. To verify

{337}------------------------------------------------

evaluation results in Outlook on the web, on mobile devices, and in new Outlook on Windows, use your favorite JavaScript regular expression tester.

# **If you use an ItemIs, ItemHasAttachment, or ItemHasRegularExpressionMatch rule, have you verified the related item property?**

If you use an **ItemHasRegularExpressionMatch** activation rule, verify whether the value of the **PropertyName** attribute is what you expect for the selected item. The following are some tips to debug the corresponding properties.

- If the selected item is a message and you specify **BodyAsHTML** in the **PropertyName** attribute, open the message, and then choose **View Source** to verify the message body in the HTML representation of that item.
- If the selected item is an appointment, or if the activation rule specifies **BodyAsPlaintext** in the **PropertyName**, you can use the Outlook object model and the Visual Basic Editor in classic Outlook on Windows.
	- 1. Ensure that macros are enabled and the **Developer** tab is displayed on the ribbon for Outlook.
	- 2. In the Visual Basic Editor, choose **View**, **Immediate Window**.
	- 3. Type the following to display various properties depending on the scenario.
		- The HTML body of the message or appointment item selected in the Outlook explorer:

| VB                                         |  |
|--------------------------------------------|--|
| ?ActiveExplorer.Selection.Item(1).HTMLBody |  |

- The plain text body of the message or appointment item selected in the Outlook explorer:

```
VB
?ActiveExplorer.Selection.Item(1).Body
```
- The HTML body of the message or appointment item opened in the current Outlook inspector:

{338}------------------------------------------------

VB

?ActiveInspector.CurrentItem.HTMLBody

- The plain text body of the message or appointment item opened in the current Outlook inspector:
VB

?ActiveInspector.CurrentItem.Body

If the **ItemHasRegularExpressionMatch** activation rule specifies **Subject** or **SenderSMTPAddress**, or if you use an **ItemIs** or **ItemHasAttachment** rule, and you're familiar with or would like to use MAPI, use [MFCMAPI](https://github.com/stephenegriffin/mfcmapi) . Verify the MAPI property that your rule relies

on in the following table.

ノ **Expand table**

| Type of rule                                       | Verify this MAPI property         |
|----------------------------------------------------|-----------------------------------|
| ItemHasRegularExpressionMatch rule with<br>Subject | PidTagSubject                     |
| ItemHasRegularExpressionMatch rule with            | PidTagSenderSmtpAddress and       |
| SenderSMTPAddress                                  | PidTagSentRepresentingSmtpAddress |
| ItemIs                                             | PidTagMessageClass                |
| ItemHasAttachment                                  | PidTagHasAttachments              |

After verifying the property value, you can then use a regular expression evaluation tool to test whether the regular expression finds a match in that value.

# **Does Outlook apply all the regular expressions to the portion of the item body as you expect?**

This section applies to all activation rules that use regular expressions, particularly, those that are applied to the item body, which may be large in size and take longer to evaluate for matches. You should be aware that even if the item property that an activation rule depends on has the value you expect, Outlook may not be able to evaluate all the regular expressions on the entire value of the item property. To provide reasonable performance and to control excessive resource usage by a read add-in, Outlook observes the following limits on processing regular expressions in activation rules at runtime.

{339}------------------------------------------------

- **The size of the item body evaluated**. There are limits to the portion of an item body on which Outlook evaluates a regular expression. These limits depend on the Outlook client, form factor, and format of the item body. For more information, see Limits on the size of the item body evaluated.
- **Number of regular expression matches**. Outlook on the web, on Windows ([new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) and classic), on Mac, and on mobile devices each returns a maximum of 50 regular expression matches. These matches are unique, and duplicate matches don't count against this limit. Don't assume any order to the returned matches, and don't assume the order in Outlook on Windows (classic) and Outlook on Mac is the same as that in Outlook on the web, on mobile devices, and in new Outlook on Windows. If you expect many matches to regular expressions in your activation rules, and you're missing a match, you may be exceeding this limit.
- **Length of a regular expression match**. There are limits to the length of a regular expression match that the Outlook application would return. Outlook doesn't include any match above the limit and doesn't display any warning message. You can run your regular expression using other regex evaluation tools or a stand-alone C++ test program to verify whether you have a match that exceeds such limits. The following table summarizes the limits. For more information, see Limits of activation rules for contextual Outlook add-in.

ノ **Expand table**

| Limit on length of a       | Outlook on the web, on new Windows | Outlook on Windows   |
|----------------------------|------------------------------------|----------------------|
| regex match                | client, and on mobile devices      | (classic) and on Mac |
| Item body is plain<br>text | 3 KB                               | 1.5 KB               |
| Item body is HTML          | 3 KB                               | 3 KB                 |

- **Time spent on evaluating all regular expressions of a read add-in in Outlook on Windows (classic) and Outlook on Mac**. By default, for each read add-in, Outlook must finish evaluating all the regular expressions in its activation rules within one second. Otherwise, Outlook retries up to three times and makes the add-in unavailable if Outlook can't complete the evaluation. Outlook displays a message in the notification bar that the add-in is unavailable. The amount of time available for your regular expression can be modified by setting a group policy or a registry key.
#### 7 **Note**

If Outlook on Windows (classic) or Outlook on Mac makes a read add-in unavailable, the read add-in becomes unavailable on the same mailbox in Outlook on the web,

{340}------------------------------------------------

# **See also**

- Deploy and install Outlook add-ins for testing
- Contextual Outlook add-ins
- Limits for activation and JavaScript API for Outlook add-ins
- Validate and troubleshoot issues with your manifest

{341}------------------------------------------------

# **Module extension Outlook add-ins**

Article • 02/27/2025

Module extension add-ins appear in the Outlook navigation bar, right alongside mail, tasks, and calendars. A module extension isn't limited to using mail and appointment information. You can create applications that run inside Outlook to make it easy for your users to access business information and productivity tools without ever leaving Outlook.

#### **Tip**

Module extensions are only supported in classic Outlook on Windows. To provide a more modern solution that's available on various platforms, create **[personal tab](https://learn.microsoft.com/en-us/microsoftteams/platform/m365-apps/extend-m365-teams-personal-tab) [apps that open in Outlook](https://learn.microsoft.com/en-us/microsoftteams/platform/m365-apps/extend-m365-teams-personal-tab)** instead. With personal tab apps, your users will have access to business critical data and productivity tools not just in Outlook, but across Microsoft 365 applications, including Microsoft Teams, and various platforms.

# **Supported clients and manifests**

To create and run module extension add-ins, you must:

- Develop the add-in using an add-in only manifest. The Unified manifest for Microsoft 365 doesn't support module extensions.
- Run the add-in in classic Outlook on Windows (Outlook 2016 or later).

# **Open a module extension**

To open a module extension, navigate to the Outlook navigation bar, select **More Apps**, then choose the module extension add-in.

{342}------------------------------------------------

### **Tip**

In older versions of classic Outlook on Windows, the navigation bar appears at the bottom of the window. Access to a module extension varies depending on the layout of the navigation bar and the number of available module extensions.

- If the user has compact navigation selected, the navigation bar has an icon that shows an extension is loaded.
- If the user isn't using compact navigation, the navigation bar will display the name of the add-in.
# **Configure a module extension**

When you select a module extension add-in, Outlook replaces the built-in module with your custom module so that you can interact with the add-in. You can use some of the

{343}------------------------------------------------

features of the [Outlook JavaScript API](https://learn.microsoft.com/en-us/javascript/api/outlook) in your add-in. APIs that logically assume a specific Outlook item, such as a message or appointment, don't work in module extensions. The module can also include function commands in the Outlook ribbon that interact with the add-in's page. To facilitate this, your function commands must call the Office.onReady or Office.initialize method and the [Event.completed](https://learn.microsoft.com/en-us/javascript/api/office/office.addincommands.event#office-office-addincommands-event-completed-member(1)) method.

To test and learn how to configure a module extension, see the [Office Add-ins module](https://github.com/OfficeDev/Outlook-Add-in-JavaScript-ModuleExtension) [extension sample](https://github.com/OfficeDev/Outlook-Add-in-JavaScript-ModuleExtension) .

# **Example**

The following is a section of a manifest file that defines a module extension.

```
XML
<VersionOverrides
xmlns="http://schemas.microsoft.com/office/mailappversionoverrides"
 xsi:type="VersionOverridesV1_0">
 <VersionOverrides
xmlns="http://schemas.microsoft.com/office/mailappversionoverrides/1.1"
 xsi:type="VersionOverridesV1_1">
 <Requirements>
 <bt:Sets DefaultMinVersion="1.3">
 <bt:Set Name="Mailbox"/>
```

{344}------------------------------------------------

```
 </bt:Sets>
 </Requirements>
 <Hosts>
 <Host xsi:type="MailHost">
 <DesktopFormFactor>
 <!-- Sets the URL of the JavaScript file that contains the code to
 run the operations of a module extension add-in. -->
 <FunctionFile resid="residFunctionFileUrl"/>
 <!--Configures the add-in as a module extension. -->
 <ExtensionPoint xsi:type="Module">
 <SourceLocation resid="residExtensionPointUrl"/>
 <Label resid="residExtensionPointLabel"/>
 <CommandSurface>
 <CustomTab id="idTab">
 <Group id="idGroup">
 <Label resid="residGroupLabel"/>
 <Control xsi:type="Button" id="group.changeToAssociate">
 <Label resid="residChangeToAssociateLabel"/>
 <Supertip>
 <Title resid="residChangeToAssociateLabel"/>
 <Description resid="residChangeToAssociateDesc"/>
 </Supertip>
 <Icon>
 <bt:Image size="16" resid="residAssociateIcon16"/>
 <bt:Image size="32" resid="residAssociateIcon32"/>
 <bt:Image size="80" resid="residAssociateIcon80"/>
 </Icon>
 <Action xsi:type="ExecuteFunction">
 <FunctionName>changeToAssociateRate</FunctionName>
 </Action>
 </Control>
 </Group>
 <Label resid="residCustomTabLabel"/>
 </CustomTab>
 </CommandSurface>
 </ExtensionPoint>
 </DesktopFormFactor>
 </Host>
 </Hosts>
 <Resources>
 <bt:Images>
 <bt:Image id="residAssociateIcon16"
 DefaultValue="https://localhost:3000/assets/associate-
16.png"/>
 <bt:Image id="residAssociateIcon32"
 DefaultValue="https://localhost:3000/assets/associate-
32.png"/>
 <bt:Image id="residAssociateIcon80"
 DefaultValue="https://localhost:3000/assets/associate-
80.png"/>
 </bt:Images>
 <bt:Urls>
 <bt:Url id="residFunctionFileUrl"
 DefaultValue="https://localhost:3000/module.html"/>
 <bt:Url id="residExtensionPointUrl"
```

{345}------------------------------------------------

```
 DefaultValue="https://localhost:3000/module.html"/>
 </bt:Urls>
 <bt:ShortStrings>
 <bt:String id="residExtensionPointLabel"
 DefaultValue="Billable Hours"/>
 <bt:String id="residGroupLabel"
 DefaultValue="Change billing rate"/>
 <bt:String id="residCustomTabLabel"
 DefaultValue="Billable hours"/>
 <bt:String id="residChangeToAssociateLabel"
 DefaultValue="Associate Rate"/>
 </bt:ShortStrings>
 <bt:LongStrings>
 <bt:String id="residChangeToAssociateDesc"
 DefaultValue="Change to the associate billing rate:
$127/hr"/>
 </bt:LongStrings>
 </Resources>
 </VersionOverrides>
</VersionOverrides>
```
### **See also**

- Office Add-in manifests
- Add-in commands
- [Office Add-ins sample: Compute billable hours with a module extension add-in in](https://github.com/OfficeDev/Outlook-Add-in-JavaScript-ModuleExtension) [Outlook](https://github.com/OfficeDev/Outlook-Add-in-JavaScript-ModuleExtension)

{346}------------------------------------------------

# **On-send feature for Outlook add-ins**

07/22/2025

#### ) **Important**

We recommend using **Smart Alerts** instead of the on-send feature to check that certain conditions are met before a mail item is sent. Smart Alerts was released in **[requirement](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.12/outlook-requirement-set-1.12) [set 1.12](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.12/outlook-requirement-set-1.12)** and introduced the OnMessageSend and OnAppointmentSend events.

Smart Alerts provides the following benefits.

- It offers **send mode options** when you want to provide your users with optional recommendations instead of mandatory conditions, so that they won't be unnecessarily blocked from sending messages. For example, with the **soft block** option, users can still send messages even if the add-in is unavailable during an outage. This option isn't supported by the on-send feature.
- It allows your add-in to be published to AppSource if the send mode property is set to the **prompt user** or **soft block** option. To learn more about publishing an eventbased add-in, see **AppSource listing options for your event-based add-in**.

The on-send feature should only be used to support older Outlook versions that don't support the Smart Alerts feature. For improved security, we encourage users to upgrade to the latest version of Outlook.

For more information on the differences between Smart Alerts and the on-send feature, see **Differences between Smart Alerts and the on-send feature**. **Try out Smart Alerts by completing the walkthrough**.

The on-send feature for Outlook add-ins provides a way to handle a message or meeting item, or block users from certain actions, and allows an add-in to set certain properties on send.

For example, use the on-send feature to:

- Prevent a user from sending sensitive information or leaving the subject line blank.
- Add a specific recipient to the CC line in messages, or to the optional recipients line in meetings.

The on-send feature is triggered by the ItemSend event type and is UI-less.

For information about limitations related to the on-send feature, see Limitations later in this article.

{347}------------------------------------------------

# **Supported clients and platforms**

The following table shows supported client-server combinations for the on-send feature, including the minimum required Cumulative Update where applicable. Excluded combinations are not supported.

ノ **Expand table**

| Client                                                            | Exchange<br>Online | Exchange Server<br>Subscription Edition<br>(SE) | Exchange 2019<br>on-premises<br>(Cumulative<br>Update 1 or later) | Exchange 2016<br>on-premises<br>(Cumulative<br>Update 6 or later) |
|-------------------------------------------------------------------|--------------------|-------------------------------------------------|-------------------------------------------------------------------|-------------------------------------------------------------------|
| Web browser<br>modern Outlook UI<br>new Outlook on<br>Windows     | Yes                | Not applicable                                  | Not applicable                                                    | Not applicable                                                    |
| Web browser<br>classic Outlook UI                                 | Not<br>applicable  | Yes                                             | Yes                                                               | Yes                                                               |
| Windows (classic)<br>Version 1910 (Build<br>12130.20272) or later | Yes                | Yes                                             | Yes                                                               | Yes                                                               |
| Mac<br>Version 16.47<br>(21031401) or later                       | Yes                | Yes                                             | Yes                                                               | Yes                                                               |

#### 7 **Note**

The on-send feature was officially released in requirement set 1.8 (see **[current server and](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients) [client support](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients)** for details). However, note that the feature's support matrix is a superset of the requirement set's.

#### ) **Important**

Add-ins that use the on-send feature aren't allowed in **[AppSource](https://appsource.microsoft.com/)** .

# **How does the on-send feature work?**

{348}------------------------------------------------

You can use the on-send feature to build an Outlook add-in that integrates the ItemSend synchronous event. This event detects that the user is pressing the **Send** button (or the **Send Update** button for existing meetings) and can be used to block the item from sending if the validation fails. For example, when a user triggers a message send event, an Outlook add-in that uses the on-send feature can:

- Read and validate the email message contents.
- Verify that the message includes a subject line.
- Set a predetermined recipient.

Validation is done on the client side in Outlook when the send event is triggered, and the addin has up to 5 minutes before it times out. If validation fails, the sending of the item is blocked, and an error message is displayed in an information bar that prompts the user to take action.

#### 7 **Note**

In Outlook on the web and new Outlook on Windows, when the on-send feature is triggered in a message being composed within the Outlook browser tab, the item is popped out to its own browser window or tab in order to complete validation and other processing.

The following screenshot shows an information bar that notifies the sender to add a subject.

The following screenshot shows an information bar that notifies the sender that blocked words were found.

{349}------------------------------------------------

# **Limitations**

The on-send feature currently has the following limitations.

- **Append-on-send** feature If you call [item.body.AppendOnSendAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body?view=outlook-js-1.9&preserve-view=true#outlook-office-body-appendonsendasync-member(1)) in the on-send handler, an error is returned.
- **AppSource** You can't publish Outlook add-ins that use the on-send feature to [AppSource](https://appsource.microsoft.com/) as they will fail AppSource validation. Add-ins that use the on-send feature should be deployed by administrators. If you want the option to publish your add-in to AppSource, consider using Smart Alerts instead, which is a newer version of the on-send feature. To learn more about Smart Alerts and how to deploy these add-ins, see Use Smart Alerts and the OnMessageSend and OnAppointmentSend events in your Outlook add-in and AppSource listing options for your event-based add-in.

#### ) **Important**

When running npm run validate to **validate your add-in's manifest**, you'll receive the error, "Mailbox add-in containing ItemSend event is invalid. Mailbox add-in manifest contains ItemSend event in VersionOverrides which is not allowed." This message appears because add-ins that use the ItemSend event, which is required for this version of the on-send feature, can't be published to AppSource. You'll still be able to sideload and run your add-in, provided that no other validation errors are found.

{350}------------------------------------------------

- **Manifest** The on-send feature is only supported in add-ins that use the add-in only manifest. It isn't supported in add-ins that use the unified manifest for Microsoft 365. In the add-in only manifest, only one ItemSend event is supported per add-in. If you have two or more ItemSend events in a manifest, the manifest will fail validation.
- **Performance** Multiple roundtrips to the web server that hosts the add-in can affect the performance of the add-in. Consider the effects on performance when you create add-ins that require multiple message- or meeting-based operations.
- **Send Later** (Mac only) If there are on-send add-ins, the **Send Later** feature will be unavailable.

Also, it's not recommended that you call item.close() in the on-send event handler as closing the item should happen automatically after the event is completed.

### **Mailbox type/mode limitations**

On-send functionality is only supported for user mailboxes in Outlook on the web, Windows (new and classic), and Mac. In addition to situations where add-ins don't activate as noted in the Mailbox items available to add-ins section of the Outlook add-ins overview page, the functionality is not currently supported for offline mode where that mode is available.

In cases where Outlook add-ins don't activate, the on-send add-in won't run and the message will be sent.

However, if the on-send feature is enabled and available but the mailbox scenario is unsupported, Outlook won't allow sending.

# **Multiple on-send add-ins**

If multiple on-send add-ins are installed, the add-ins will run in the order in which they are received from APIs getAppManifestCall or getExtensibilityContext . If the first add-in allows sending, the second add-in can change something that would make the first one block sending. However, the first add-in won't run again if all installed add-ins have allowed sending.

For example, Add-in1 and Add-in2 both use the on-send feature. Add-in1 is installed first, and Add-in2 is installed second. Add-in1 verifies that the word Fabrikam appears in the message as a condition for the add-in to allow send. However, Add-in2 removes any occurrences of the word Fabrikam. The message will send with all instances of Fabrikam removed (due to the order of installation of Add-in1 and Add-in2).

{351}------------------------------------------------

# **Deploy Outlook add-ins that use on-send**

We recommend that administrators deploy Outlook add-ins that use the on-send feature. Administrators have to ensure that the on-send add-in:

- Is always present any time a compose item is opened (for email: new, reply, or forward).
- Can't be closed or disabled by the user.

# **Install Outlook add-ins that use on-send**

The on-send feature in Outlook requires that add-ins are configured for the send event types. Select the platform you'd like to configure.

Windows (classic)

Add-ins for classic Outlook on Windows that use the on-send feature should run for any users who have them installed. However, if users are required to run the add-in to meet compliance standards, then the group policy **Block send when web add-ins can't load** must be set to **Enabled** on each applicable machine.

To set mailbox policies, administrators can download the [Administrative Templates tool](https://www.microsoft.com/download/details.aspx?id=49030) then access the latest administrative templates by running the Local Group Policy Editor, **gpedit.msc**.

#### 7 **Note**

In older versions of the Administrative Templates tool, the policy name was **Disable send when web extensions can't load**. Substitute in this name in later steps if needed.

### **What the policy does**

For compliance reasons, administrators may need to ensure that users cannot send message or meeting items until the latest on-send add-in is available to run. Administrators must enable the group policy **Block send when web add-ins can't load** so that all add-ins are updated from Exchange and available to verify each message or meeting item meets expected rules and regulations on send.

{352}------------------------------------------------

| Policy<br>status | Result                                                                                                                                                                                 |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Disabled         | The currently downloaded manifests of the on-send add-ins (not necessarily the latest<br>versions) run on message or meeting items being sent. This is the default<br>status/behavior. |
| Enabled          | After the latest manifests of the on-send add-ins are downloaded from Exchange, the<br>add-ins are run on message or meeting items being sent. Otherwise, send is blocked.             |

### **Manage the on-send policy**

By default, the on-send policy is disabled. Administrators can enable the on-send policy by ensuring the user's group policy setting **Block send when web add-ins can't load** is set to **Enabled**. To disable the policy for a user, the administrator should set it to **Disabled**. To manage this policy setting, you can do the following:

- 1. Download the latest [Administrative Templates tool](https://www.microsoft.com/download/details.aspx?id=49030) .
- 2. Open the Local Group Policy Editor (**gpedit.msc**).
- 3. Navigate to **User Configuration** > **Administrative Templates** > **Microsoft Outlook 2016** > **Security** > **Trust Center**.
- 4. Select the **Block send when web add-ins can't load** setting.
- 5. Open the link to edit policy setting.
- 6. In the **Block send when web add-ins can't load** dialog window, select **Enabled** or **Disabled** as appropriate then select **OK** or **Apply** to put the update into effect.

# **On-send feature scenarios**

The following are the supported and unsupported scenarios for add-ins that use the on-send feature.

### **Event handlers are dynamically defined**

Your add-in's event handlers must be defined by the time Office.initialize or Office.onReady() is called (for further information, see Startup of an Outlook add-in and Initialize your Office Add-in). If your handler code is dynamically defined by certain circumstances during initialization, you must create a stub function to call the handler once it's completely defined. The stub function must be referenced in the **<Event>** element's FunctionName attribute of your manifest. This workaround ensures that your handler is defined and ready to be referenced once Office.initialize or Office.onReady() runs.

{353}------------------------------------------------

If your handler isn't defined once your add-in is initialized, the sender will be notified that "The callback function is unreachable" through an information bar in the mail item.

### **User mailbox has the on-send add-in feature enabled but no add-ins are installed**

In this scenario, the user will be able to send message and meeting items without any add-ins executing.

### **User mailbox has the on-send add-in feature enabled and add-ins that supports on-send are installed and enabled**

Add-ins will run during the send event, which will then either allow or block the user from sending.

### **Mailbox delegation, where mailbox 1 has full access permissions to mailbox 2**

**Web browser (classic Outlook)**

| Scenario | Mailbox 1<br>on-send<br>feature | Mailbox 2<br>on-send<br>feature | Outlook<br>web session<br>(classic) | Result                                                                   | Supported?                                                         |
|----------|---------------------------------|---------------------------------|-------------------------------------|--------------------------------------------------------------------------|--------------------------------------------------------------------|
| 1        | Enabled                         | Enabled                         | New session                         | Mailbox 1 cannot<br>send a message or<br>meeting item from<br>mailbox 2. | Not currently<br>supported. As a<br>workaround, use<br>scenario 3. |
| 2        | Disabled                        | Enabled                         | New session                         | Mailbox 1 cannot<br>send a message or<br>meeting item from<br>mailbox 2. | Not currently<br>supported. As a<br>workaround, use<br>scenario 3. |
| 3        | Enabled                         | Enabled                         | Same session                        | On-send add-ins<br>assigned to mailbox<br>1 run on-send.                 | Supported.                                                         |
| 4        | Enabled                         | Disabled                        | New session                         | No on-send add-ins<br>run; message or<br>meeting item is sent.           | Supported.                                                         |

{354}------------------------------------------------

### **Web browser (modern Outlook), Windows, Mac**

To enforce on-send, administrators should ensure the policy has been enabled on both mailboxes. To learn how to support delegate access in an add-in, see Implement shared folders and shared mailbox scenarios.

### **User mailbox with on-send add-in feature/policy enabled, add-ins that support on-send are installed and enabled and offline mode is enabled**

On-send add-ins will run according to the online state of the user, the add-in backend, and Exchange.

### **User's state**

The on-send add-ins will run during send if the user is online. If the user is offline, the on-send add-ins will not run during send and the message or meeting item will not be sent.

### **Add-in backend's state**

An on-send add-in will run if its backend is online and reachable. If the backend is offline, send is disabled.

### **Exchange's state**

The on-send add-ins will run during send if the Exchange server is online and reachable. If the on-send add-in cannot reach Exchange and the applicable policy or cmdlet is turned on, send is disabled.

#### 7 **Note**

On Mac in any offline state, the **Send** button (or the **Send Update** button for existing meetings) is disabled and a notification displayed that their organization doesn't allow send when the user is offline.

### **User can edit item while on-send add-ins are working on it**

While on-send add-ins are processing an item, the user can edit the item by adding, for example, inappropriate text or attachments. If you want to prevent the user from editing the 

{355}------------------------------------------------

item while your add-in is processing on send, you can implement a workaround using a dialog. This workaround can be used in Outlook on the web (classic), Windows (classic), and Mac.

#### ) **Important**

Modern Outlook on the web and new Outlook on Windows: To prevent the user from editing the item while your add-in is processing on send, you should set the *OnSendAddinsEnabled* flag to true as described in the **[Install Outlook add-ins that use](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/outlook-on-send-addins?tabs=modern#install-outlook-add-ins-that-use-on-send) [on-send](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/outlook-on-send-addins?tabs=modern#install-outlook-add-ins-that-use-on-send)** section earlier in this article.

In your on-send handler:

- 1. Call [displayDialogAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.ui?view=outlook-js-preview&preserve-view=true#office-office-ui-displaydialogasync-member(1)) to open a dialog so that mouse clicks and keystrokes are disabled.
) **Important**

To get this behavior in classic Outlook on the web, you should set the **[displayInIframe property](https://learn.microsoft.com/en-us/javascript/api/office/office.dialogoptions?view=outlook-js-preview&preserve-view=true#office-office-dialogoptions-displayiniframe-member)** to true in the options parameter of the displayDialogAsync call.

- 2. Implement processing of the item.
- 3. Close the dialog. Also, handle what happens if the user closes the dialog.

# **Code examples**

The following code examples show you how to create a simple on-send add-in. To download the code sample that these examples are based on, see [Outlook-Add-in-On-Send](https://github.com/OfficeDev/Outlook-Add-in-On-Send) .

#### **Tip**

If you use a dialog with the on-send event, make sure to close the dialog before completing the event.

### **Manifest, version override, and event**

The [Outlook-Add-in-On-Send](https://github.com/OfficeDev/Outlook-Add-in-On-Send) code sample includes two manifests:

{356}------------------------------------------------

- Contoso Message Body Checker.xml Shows how to check the body of a message for restricted words or sensitive information on send.
- Contoso Subject and CC Checker.xml Shows how to add a recipient to the CC line and verify that the message includes a subject line on send.

In the Contoso Message Body Checker.xml manifest file, you include the function file and function name that should be called on the ItemSend event. The operation runs synchronously.

```
XML
<Hosts>
 <Host xsi:type="MailHost">
 <DesktopFormFactor>
 <!-- The functionfile and function name to call on message send. -->
 <!-- In this case, the function validateBody will be called within the
JavaScript code referenced in residUILessFunctionFileUrl. -->
 <FunctionFile resid="residUILessFunctionFileUrl" />
 <ExtensionPoint xsi:type="Events">
 <Event Type="ItemSend" FunctionExecution="synchronous"
FunctionName="validateBody" />
 </ExtensionPoint>
 </DesktopFormFactor>
 </Host>
</Hosts>
```
#### ) **Important**

If you are using Visual Studio 2019 to develop your on-send add-in, you may get a validation warning like the following: "This is an invalid xsi:type

'http://schemas.microsoft.com/office/mailappversionoverrides/1.1:Events' ." To work around this, you'll need a newer version of the MailAppVersionOverridesV1_1.xsd which has been provided as a GitHub gist in a **[blog about this warning](https://theofficecontext.com/2018/11/29/visual-studio-2017-this-is-an-invalid-xsitype-mailappversionoverrides-1-1event/)** .

For the Contoso Subject and CC Checker.xml manifest file, the following example shows the function file and function name to call on message send event.

| XML                                                                                                                                                                                                                                                                                                                             |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <hosts><br/><host xsi:type="MailHost"><br/><desktopformfactor></desktopformfactor></host></hosts>                                                                                                                                                                                                                               |
| The functionfile and function name to call on message send.<br>In this case the function validateSubjectAndCC will be called<br>within the JavaScript code referenced in residUILessFunctionFileUrl.<br><functionfile resid="residUILessFunctionFileUrl"></functionfile><br><extensionpoint xsi:type="Events"></extensionpoint> |

{357}------------------------------------------------

```
 <Event Type="ItemSend" FunctionExecution="synchronous"
FunctionName="validateSubjectAndCC" />
 </ExtensionPoint>
 </DesktopFormFactor>
 </Host>
</Hosts>
```
The on-send API requires VersionOverrides v1_1 . The following shows you how to add the VersionOverrides node in your manifest.

```
XML
 <VersionOverrides
xmlns="http://schemas.microsoft.com/office/mailappversionoverrides"
xsi:type="VersionOverridesV1_0">
 <!-- On-send requires VersionOverridesV1_1 -->
 <VersionOverrides
xmlns="http://schemas.microsoft.com/office/mailappversionoverrides/1.1"
xsi:type="VersionOverridesV1_1">
 ...
 </VersionOverrides>
</VersionOverrides>
```

```
7 Note
```
To learn more about manifests for Outlook add-ins, see **Office Add-ins manifest**.

### **Event and item objects, and body.getAsync and body.setAsync methods**

To access the currently selected message or meeting item (in this example, the newly composed message), use the Office.context.mailbox.item namespace. The ItemSend event is automatically passed by the on-send feature to the function specified in the manifest—in this example, the validateBody function.

```
JavaScript
let mailboxItem;
Office.initialize = function (reason) {
 mailboxItem = Office.context.mailbox.item;
}
// Entry point for Contoso Message Body Checker add-in before send is allowed.
// <param name="event">ItemSend event is automatically passed by on-send code to
the function specified in the manifest.</param>
```

{358}------------------------------------------------

```
function validateBody(event) {
 mailboxItem.body.getAsync("html", { asyncContext: event },
checkBodyOnlyOnSendCallBack);
}
```
The validateBody function gets the current body in the specified format (HTML) and passes the ItemSend event object that the code wants to access in the callback function. In addition to the getAsync method, the Body object also provides a setAsync method that you can use to replace the body with the specified text.

#### 7 **Note**

For more information, see **[Event Object](https://learn.microsoft.com/en-us/javascript/api/office/office.addincommands.event)** and **[Body.getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body#outlook-office-body-getasync-member(1))**.

### **NotificationMessages object and event.completed method**

The checkBodyOnlyOnSendCallBack function uses a regular expression to determine whether the message body contains blocked words. If it finds a match against an array of restricted words, it then blocks the email from being sent and notifies the sender via the information bar. To do this, it uses the notificationMessages property of the Item object to return a [NotificationMessages](https://learn.microsoft.com/en-us/javascript/api/outlook/office.notificationmessages) object. It then adds a notification to the item by calling the addAsync method, as shown in the following example.

```
JavaScript
// Determine whether the body contains a specific set of blocked words. If it
contains the blocked words, block email from being sent. Otherwise allow sending.
// <param name="asyncResult">ItemSend event passed from the calling function.
</param>
function checkBodyOnlyOnSendCallBack(asyncResult) {
 const listOfBlockedWords = new Array("blockedword", "blockedword1", 
"blockedword2");
 const wordExpression = listOfBlockedWords.join('|');
 // \b to perform a "whole words only" search using a regular expression in the
form of \bword\b.
 // i to perform case-insensitive search.
 const regexCheck = new RegExp('\\b(' + wordExpression + ')\\b', 'i');
 const checkBody = regexCheck.test(asyncResult.value);
 if (checkBody) {
 mailboxItem.notificationMessages.addAsync('NoSend', { type: 
'errorMessage', message: 'Blocked words have been found in the body of this email.
Please remove them.' });
 // Block send.
 asyncResult.asyncContext.completed({ allowEvent: false });
```

{359}------------------------------------------------

```
 }
 // Allow send.
 asyncResult.asyncContext.completed({ allowEvent: true });
}
```
The following are the parameters for the addAsync method.

- NoSend A string that is a developer-specified key to reference a notification message. You can use it to modify this message later. The key can't be longer than 32 characters.
- type One of the properties of the JSON object parameter. Represents the type of a message; the types correspond to the values of the [Office.MailboxEnums.ItemNotificationMessageType](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxenums.itemnotificationmessagetype) enumeration. Possible values are progress indicator, information message, or error message. In this example, type is an error message.
- message One of the properties of the JSON object parameter. In this example, message is the text of the notification message.

To signal that the add-in has finished processing the ItemSend event triggered by the send operation, call the [event.completed({allowEvent:Boolean})](https://learn.microsoft.com/en-us/javascript/api/office/office.addincommands.event#office-office-addincommands-event-completed-member(1)) method. The [allowEvent](https://learn.microsoft.com/en-us/javascript/api/office/office.addincommands.eventcompletedoptions#office-office-addincommands-eventcompletedoptions-allowevent-member) property is a Boolean. If set to true , send is allowed. If set to false , the email message is blocked from sending.

### **replaceAsync , removeAsync , and getAllAsync methods**

In addition to the addAsync method, the NotificationMessages object also includes replaceAsync , removeAsync , and getAllAsync methods. These methods are not used in this code sample. For more information, see [NotificationMessages.](https://learn.microsoft.com/en-us/javascript/api/outlook/office.notificationmessages)

### **Subject and CC checker code**

The following code example shows you how to add a recipient to the CC line and verify that the message includes a subject on send. This example uses the on-send feature to allow or disallow an email from sending.

```
JavaScript
// Invoke by Contoso Subject and CC Checker add-in before send is allowed.
// <param name="event">ItemSend event is automatically passed by on-send code to
the function specified in the manifest.</param>
function validateSubjectAndCC(event) {
 shouldChangeSubjectOnSend(event);
}
```

{360}------------------------------------------------

```
// Determine whether the subject should be changed. If it is already changed,
allow send. Otherwise change it.
// <param name="event">ItemSend event passed from the calling function.</param>
function shouldChangeSubjectOnSend(event) {
 mailboxItem.subject.getAsync(
 { asyncContext: event },
 function (asyncResult) {
 addCCOnSend(asyncResult.asyncContext);
 //console.log(asyncResult.value);
 // Match string.
 const checkSubject = (new RegExp(/\
[Checked\]/)).test(asyncResult.value)
 // Add [Checked]: to subject line.
 subject = '[Checked]: ' + asyncResult.value;
 // Determine whether a string is blank, null, or undefined.
 // If yes, block send and display information bar to notify sender to
add a subject.
 if (asyncResult.value === null || (/^\s*$/).test(asyncResult.value)) {
 mailboxItem.notificationMessages.addAsync('NoSend', { type: 
'errorMessage', message: 'Please enter a subject for this email.' });
 asyncResult.asyncContext.completed({ allowEvent: false });
 }
 else {
 // If can't find a [Checked]: string match in subject, call
subjectOnSendChange function.
 if (!checkSubject) {
 subjectOnSendChange(subject, asyncResult.asyncContext);
 //console.log(checkSubject);
 }
 else {
 // Allow send.
 asyncResult.asyncContext.completed({ allowEvent: true });
 }
 }
 });
}
// Add a CC to the email. In this example, CC contoso@contoso.onmicrosoft.com
// <param name="event">ItemSend event passed from calling function</param>
function addCCOnSend(event) {
 mailboxItem.cc.setAsync(['Contoso@contoso.onmicrosoft.com'], { asyncContext:
event });
}
// Determine whether the subject should be changed. If it is already changed,
allow send, otherwise change it.
// <param name="subject">Subject to set.</param>
// <param name="event">ItemSend event passed from the calling function.</param>
function subjectOnSendChange(subject, event) {
 mailboxItem.subject.setAsync(
 subject,
 { asyncContext: event },
 function (asyncResult) {
 if (asyncResult.status == Office.AsyncResultStatus.Failed) {
```

{361}------------------------------------------------

```
 mailboxItem.notificationMessages.addAsync('NoSend', { type: 
'errorMessage', message: 'Unable to set the subject.' });
 // Block send.
 asyncResult.asyncContext.completed({ allowEvent: false });
 }
 else {
 // Allow send.
 asyncResult.asyncContext.completed({ allowEvent: true });
 }
 });
}
```
To learn more about how to add a recipient to the CC line and verify that the email message includes a subject line on send, and to see the APIs you can use, see the [Outlook-Add-in-On-](https://github.com/OfficeDev/Outlook-Add-in-On-Send)[Send sample](https://github.com/OfficeDev/Outlook-Add-in-On-Send) . The code is well commented.

# **Debug Outlook add-ins that use on-send**

For instructions on how to debug your on-send add-in, see Debug function commands in Outlook add-ins.

#### **Tip**

If the error "The callback function is unreachable" appears when your users run your addin and your add-in's event handler is dynamically defined, you must create a stub function as a workaround. See **Event handlers are dynamically defined** for more information.

# **See also**

- Overview of Outlook add-ins architecture and features
- [Add-in Command Demo Outlook add-in](https://github.com/OfficeDev/outlook-add-in-command-demo)

{362}------------------------------------------------

# **Use the Microsoft Graph REST API from an Outlook add-in**

Article • 04/23/2025

The Outlook JavaScript API (Office.js) retrieves the properties of messages and appointments and run operations on these items in your add-in. However, there may be instances where the data you need isn't available through the API. For example, your add-in may need to implement single sign-on or identify messages in a user's mailbox that originated from the same sender. To get the information you need, use the [Outlook mail REST API](https://learn.microsoft.com/en-us/graph/api/resources/mail-api-overview) through [Microsoft Graph.](https://learn.microsoft.com/en-us/graph/overview)

### **Get started**

To make calls to the Microsoft Graph API in Office Add-ins, implement the nested app authentication (NAA) solution to request a token.

#### ) **Important**

Legacy Exchange tokens are deprecated. Legacy Exchange **user identity** and **callback** tokens have been turned off for most Exchange Online tenants. Administrators can reenable legacy tokens for tenants and add-ins until June 2025. In October 2025, legacy tokens will be completely turned off for all tenants. For the timeline and details, see our **FAQ page**. This is part of **[Microsoft's Secure Future Initiative](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/)** , which gives organizations the tools needed to respond to the current threat landscape. Exchange user identity tokens will still work for Exchange on-premises. Nested app authentication is the recommended approach for tokens going forward.

# **Call the Microsoft Graph API**

Once you have an access token, you can then use it to call Microsoft Graph.

The Microsoft Graph API consists of the v1.0 and beta endpoints. Note the following about the endpoint pattern.

- version specifies the v1.0 or beta API.
- resource specifies the resource your add-in interacts with, such as a user, group, or site.
- query_parameters specifies parameters to customize your request. For example, you can filter the messages returned to only those from a specific sender.

{363}------------------------------------------------

```
HTTP
```
https://graph.microsoft.com/[version]/[resource]?[query_parameters]

For more information on the Microsoft Graph API and its components, see [Use the Microsoft](https://learn.microsoft.com/en-us/graph/use-the-api) [Graph API](https://learn.microsoft.com/en-us/graph/use-the-api).

### **See also**

- [Microsoft Graph REST API v1.0 endpoint reference](https://learn.microsoft.com/en-us/graph/api/overview)
- [Outlook mail API overview](https://learn.microsoft.com/en-us/graph/outlook-mail-concept-overview)
- [Use the Outlook mail REST API](https://learn.microsoft.com/en-us/graph/api/resources/mail-api-overview)
- Enable SSO in an Office Add-in using nested app authentication (preview)

{364}------------------------------------------------

# **Use the Outlook REST APIs from an Outlook add-in**

Article • 04/23/2025

The [Office.context.mailbox.item](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item) namespace provides access to many of the common fields of messages and appointments. However, in some scenarios an add-in may need to access data that isn't exposed by the namespace. For example, the add-in may rely on custom properties set by an outside app, or it needs to search the user's mailbox for messages from the same sender. In these scenarios, the [Outlook REST APIs](https://learn.microsoft.com/en-us/outlook/rest) is the recommended method to retrieve the information.

#### ) **Important**

#### **Outlook REST v2.0 and beta endpoints are deprecated**

The Outlook REST v2.0 and beta endpoints are now **[deprecated](https://devblogs.microsoft.com/microsoft365dev/final-reminder-outlook-rest-api-v2-0-and-beta-endpoints-decommissioning/)** . However, privately released and AppSource-hosted add-ins are still able to use the REST service until **[extended support ends for Outlook 2019 on October 14, 2025](https://learn.microsoft.com/en-us/lifecycle/end-of-support/end-of-support-2025)**. Traffic from these add-ins is automatically identified for exemption. This exemption also applies to new add-ins developed after March 31, 2024.

Although add-ins are able to use the REST service until October 2025, we highly encourage you to migrate your add-ins to use **Microsoft Graph**.

### **Get an access token**

#### ) **Important**

Legacy Exchange tokens are deprecated. Legacy Exchange **user identity** and **callback** tokens have been turned off for most Exchange Online tenants. Administrators can reenable legacy tokens for tenants and add-ins until June 2025. In October 2025, legacy tokens will be completely turned off for all tenants. For the timeline and details, see our **FAQ page**. This is part of **[Microsoft's Secure Future Initiative](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/)** , which gives organizations the tools needed to respond to the current threat landscape. Exchange user identity tokens will still work for Exchange on-premises. Nested app authentication is the recommended approach for tokens going forward.

The Outlook REST APIs require a bearer token in the Authorization header. Typically apps use OAuth2 flows to retrieve a token. However, add-ins can retrieve a token without implementing 

{365}------------------------------------------------

OAuth2 by using the new [Office.context.mailbox.getCallbackTokenAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#methods) method introduced in the Mailbox requirement set 1.5.

By setting the isRest option to true , you can request a token compatible with the REST APIs.

### **Add-in permissions and token scope**

It is important to consider what level of access your add-in will need via the REST APIs. In most cases, the token returned by getCallbackTokenAsync will provide read-only access to the current item only. This is true even if your add-in specifies the read/write item permission level in its manifest.

If your add-in will require write access to the current item or other items in the user's mailbox, your add-in must specify the read/write mailbox permission. level in its manifest. In this case, the token returned will contain read/write access to the user's messages, events, and contacts.

### **Example**

```
JavaScript
Office.context.mailbox.getCallbackTokenAsync({isRest: true}, function(result){
 if (result.status === "succeeded") {
 const accessToken = result.value;
 // Use the access token.
 getCurrentItem(accessToken);
 } else {
 // Handle the error.
 }
});
```
# **Get the item ID**

To retrieve the current item via REST, your add-in will need the item's ID, properly formatted for REST. This is obtained from the [Office.context.mailbox.item.itemId](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties) property, but some checks should be made to ensure that it is a REST-formatted ID.

- In Outlook on mobile devices, the value returned by Office.context.mailbox.item.itemId is a REST-formatted ID and can be used as-is.
- In other Outlook clients, the value returned by Office.context.mailbox.item.itemId is an EWS-formatted ID, and must be converted using the [Office.context.mailbox.convertToRestId](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#methods) method.

{366}------------------------------------------------

- Note you must also convert Attachment ID to a REST-formatted ID in order to use it. The reason the IDs must be converted is that EWS IDs can contain non-URL safe values which will cause problems for REST.
Your add-in can determine which Outlook client it is loaded in by checking the [Office.context.mailbox.diagnostics.hostName](https://learn.microsoft.com/en-us/javascript/api/outlook/office.diagnostics#outlook-office-diagnostics-hostname-member) property.

### **Example**

```
JavaScript
function getItemRestId() {
 if (Office.context.mailbox.diagnostics.hostName === 'OutlookIOS') {
 // itemId is already REST-formatted.
 return Office.context.mailbox.item.itemId;
 } else {
 // Convert to an item ID for API v2.0.
 return Office.context.mailbox.convertToRestId(
 Office.context.mailbox.item.itemId,
 Office.MailboxEnums.RestVersion.v2_0
 );
 }
}
```
# **Get the REST API URL**

The final piece of information your add-in needs to call the REST API is the hostname it should use to send API requests. This information is in the [Office.context.mailbox.restUrl](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#properties) property.

### **Example**

```
JavaScript
// Example: https://outlook.office.com
const restHost = Office.context.mailbox.restUrl;
```
# **Call the API**

After your add-in has the access token, item ID, and REST API URL, it can either pass that information to a back-end service which calls the REST API, or it can call it directly using AJAX. The following example calls the Outlook Mail REST API to get the current message.

{367}------------------------------------------------

#### ) **Important**

For on-premises Exchange deployments, client-side requests using AJAX or similar libraries fail because CORS isn't supported in that server setup.

JavaScript

```
function getCurrentItem(accessToken) {
 // Get the item's REST ID.
 const itemId = getItemRestId();
 // Construct the REST URL to the current item.
 // Details for formatting the URL can be found at
 // https://learn.microsoft.com/previous-versions/office/office-365-
api/api/version-2.0/mail-rest-operations#get-messages.
 const getMessageUrl = Office.context.mailbox.restUrl +
 '/v2.0/me/messages/' + itemId;
 $.ajax({
 url: getMessageUrl,
 dataType: 'json',
 headers: { 'Authorization': 'Bearer ' + accessToken }
 }).done(function(item){
 // Message is passed in `item`.
 const subject = item.Subject;
 ...
 }).fail(function(error){
 // Handle error.
 });
}
```
# **See also**

- [Add-in Command sample](https://github.com/OfficeDev/outlook-add-in-command-demo)
- Use the Microsoft Graph REST API from an Outlook add-in

{368}------------------------------------------------

# **Use Exchange Web Services (EWS) from an Outlook add-in**

Article • 10/17/2024

Your Outlook add-in can use Exchange Web Services (EWS) from an environment that runs Exchange Server (on-premises). EWS is a web service that's available on the server that provides the source location for the add-in's UI. This article provides an example that shows how an Outlook add-in can request information from EWS.

#### ) **Important**

Legacy Exchange tokens are deprecated. Starting October 2024, legacy Exchange **user identity** and **callback** tokens will begin to be turned off for Exchange Online tenants. For the timeline and details, see our **FAQ page**. This is part of **[Microsoft's](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/) [Secure Future Initiative](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/)** , which gives organizations the tools needed to respond to the current threat landscape. Exchange user identity tokens will still work for Exchange on-premises. Nested app authentication is the recommended approach for tokens going forward.

The way you call a web service varies based on where the web service is located. The following tables list the different ways you can call a web service based on location.

| Web service<br>location | Way to call the web service                                                                                                                                                                                                                                                                                                       |
|-------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| The Exchange            | Use the mailbox.makeEwsRequestAsync method to call EWS operations that                                                                                                                                                                                                                                                            |
| server that hosts       | add-ins support. The Exchange server that hosts the mailbox also exposes                                                                                                                                                                                                                                                          |
| the client mailbox      | EWS.                                                                                                                                                                                                                                                                                                                              |
| The web server          | Call the web service by using standard JavaScript techniques. The JavaScript                                                                                                                                                                                                                                                      |
| that provides the       | code in the UI frame runs in the context of the web server that provides the                                                                                                                                                                                                                                                      |
| source location for     | UI. Therefore, it can call web services on that server without causing a cross                                                                                                                                                                                                                                                    |
| the add-in UI           | site scripting error.                                                                                                                                                                                                                                                                                                             |
| All other locations     | Create a proxy for the web service on the web server that provides the<br>source location for the UI. If you don't provide a proxy, cross-site scripting<br>errors will prevent your add-in from running. One way to provide a proxy is<br>by using JSON/P. For more information, see Privacy and security for Office<br>Add-ins. |

{369}------------------------------------------------

# **Using the makeEwsRequestAsync method to access EWS operations**

#### ) **Important**

EWS calls and operations aren't supported in add-ins running in Outlook on Android and on iOS.

You can use the [mailbox.makeEwsRequestAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#methods) method to make an EWS request to the on-premises Exchange server that hosts the user's mailbox.

EWS supports different operations on an Exchange server; for example, item-level operations to copy, find, update, or send an item, and folder-level operations to create, get, or update a folder. To perform an EWS operation, create an XML SOAP request for that operation. When the operation finishes, you get an XML SOAP response that contains data that's relevant to the operation. EWS SOAP requests and responses follow the schema defined in the **Messages.xsd** file. Like other EWS schema files, the **Message.xsd** file is located in the IIS virtual directory that hosts EWS.

To use the makeEwsRequestAsync method to initiate an EWS operation, provide the following:

- The XML for the SOAP request for that EWS operation as an argument to the *data* parameter.
- A callback function (as the *callback* argument).
- Any optional input data for that callback function (as the *userContext* argument).

When the EWS SOAP request is complete, Outlook calls the callback function with one argument, which is an [AsyncResult](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult) object. The callback function can access two properties of the AsyncResult object: the value property, which contains the XML SOAP response of the EWS operation, and optionally, the asyncContext property, which contains any data passed as the userContext parameter. Typically, the callback function then parses the XML in the SOAP response to get any relevant information and processes that information accordingly.

# **Tips for parsing EWS responses**

When parsing a SOAP response from an EWS operation, note the following browserdependent issues.

{370}------------------------------------------------

- Specify the prefix for a tag name when using the DOM method getElementsByTagName to include support for Internet Explorer and the Trident webview.
getElementsByTagName behaves differently depending on browser type. For example, an EWS response can contain the following XML (formatted and abbreviated for display purposes).

```
<t:ExtendedProperty><t:ExtendedFieldURI PropertySetId="00000000-0000-
0000-0000-000000000000"
PropertyName="MyProperty"
PropertyType="String"/>
<t:Value>{
...
}</t:Value></t:ExtendedProperty>
```
Code, as in the following, would work on a browser like Chrome to get the XML enclosed by the ExtendedProperty tags.

```
JavaScript
```
XML

```
const mailbox = Office.context.mailbox;
mailbox.makeEwsRequestAsync(mailbox.item.itemId, (result) => {
 const response = $.parseXML(result.value);
 const extendedProps =
response.getElementsByTagName("ExtendedProperty")
});
```
For the Trident (Internet Explorer) webview, you must include the t: prefix of the tag name, as follows.

```
JavaScript
```

```
const mailbox = Office.context.mailbox;
mailbox.makeEwsRequestAsync(mailbox.item.itemId, (result) => {
 const response = $.parseXML(result.value);
 const extendedProps =
response.getElementsByTagName("t:ExtendedProperty")
});
```
- Use the DOM property textContent to get the contents of a tag in an EWS response, as follows.
JavaScript

{371}------------------------------------------------

Other properties such as innerHTML may not work on the Trident (Internet Explorer) webview for some tags in an EWS response.

### **Example**

The following example calls makeEwsRequestAsync to use the [GetItem](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/getitem-operation) operation to get the subject of an item. This example includes the following three functions.

- getSubjectRequest Takes an item ID as input, and returns the XML for the SOAP request to call GetItem for the specified item.
- sendRequest Calls getSubjectRequest to get the SOAP request for the selected item, then passes the SOAP request and the callback function, callback , to makeEwsRequestAsync to get the subject of the specified item.
- callback Processes the SOAP response, which includes any subject and other information about the specified item.

```
JavaScript
function getSubjectRequest(id) {
 // Return a GetItem operation request for the subject of the specified
item. 
 const result = 
 '<?xml version="1.0" encoding="utf-8"?>' +
 '<soap:Envelope xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance"'
+
 ' xmlns:xsd="https://www.w3.org/2001/XMLSchema"' +
 ' xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"'
+
 ' 
xmlns:t="http://schemas.microsoft.com/exchange/services/2006/types">' +
 ' <soap:Header>' +
 ' <RequestServerVersion Version="Exchange2013"
xmlns="http://schemas.microsoft.com/exchange/services/2006/types"
soap:mustUnderstand="0" />' +
 ' </soap:Header>' +
 ' <soap:Body>' +
 ' <GetItem
xmlns="http://schemas.microsoft.com/exchange/services/2006/messages">' +
 ' <ItemShape>' +
 ' <t:BaseShape>IdOnly</t:BaseShape>' +
 ' <t:AdditionalProperties>' +
 ' <t:FieldURI FieldURI="item:Subject"/>' +
 ' </t:AdditionalProperties>' +
```

{372}------------------------------------------------

```
 ' </ItemShape>' +
 ' <ItemIds><t:ItemId Id="' + id + '"/></ItemIds>' +
 ' </GetItem>' +
 ' </soap:Body>' +
 '</soap:Envelope>';
 return result;
}
function sendRequest() {
 // Create a local variable that contains the mailbox.
 const mailbox = Office.context.mailbox;
 mailbox.makeEwsRequestAsync(getSubjectRequest(mailbox.item.itemId),
callback);
}
function callback(asyncResult) {
 const result = asyncResult.value;
 const context = asyncResult.context;
 // Process the returned response here.
}
```
# **EWS operations that add-ins support**

Outlook add-ins can access a subset of operations that are available in EWS via the makeEwsRequestAsync method. If you're unfamiliar with EWS operations and how to use the makeEwsRequestAsync method to access an operation, start with a SOAP request example to customize your *data* argument.

The following describes how you can use the makeEwsRequestAsync method.

- 1. In the XML, substitute any item IDs and relevant EWS operation attributes with appropriate values.
- 2. Include the SOAP request as an argument for the *data* parameter of makeEwsRequestAsync .
- 3. Specify a callback function and call makeEwsRequestAsync .
- 4. In the callback function, verify the results of the operation in the SOAP response.
- 5. Use the results of the EWS operation according to your needs.

The following table lists the EWS operations that add-ins support. To see examples of SOAP requests and responses, choose the link for each operation. For more information about EWS operations, see [EWS operations in Exchange.](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/ews-operations-in-exchange)

{373}------------------------------------------------

#### ノ **Expand table**

| EWS operation          | Description                                                                                                                                 |
|------------------------|---------------------------------------------------------------------------------------------------------------------------------------------|
| CopyItem operation     | Copies the specified items and puts the new items in a designated<br>folder in the Exchange store.                                          |
| CreateFolder operation | Creates folders in the specified location in the Exchange store.                                                                            |
| CreateItem operation   | Creates the specified items in the Exchange store.                                                                                          |
| ExpandDL operation     | Displays the full membership of distribution lists.                                                                                         |
| FindConversation       | Enumerates a list of conversations in the specified folder in the                                                                           |
| operation              | Exchange store.                                                                                                                             |
| FindFolder operation   | Finds subfolders of an identified folder and returns a set of<br>properties that describe the set of subfolders.                            |
| FindItem operation     | Identifies items that are located in a specified folder in the Exchange<br>store.                                                           |
| GetConversationItems   | Gets one or more sets of items that are organized in nodes in a                                                                             |
| operation              | conversation.                                                                                                                               |
| GetFolder operation    | Gets the specified properties and contents of folders from the<br>Exchange store.                                                           |
| GetItem operation      | Gets the specified properties and contents of items from the<br>Exchange store.                                                             |
| GetUserAvailability    | Provides detailed information about the availability of a set of users,                                                                     |
| operation              | rooms, and resources within a specified time period.                                                                                        |
| MarkAsJunk operation   | Moves email messages to the Junk Email folder, and adds or<br>removes senders of the messages from the blocked senders list<br>accordingly. |
| MoveItem operation     | Moves items to a single destination folder in the Exchange store.                                                                           |
| ResolveNames operation | Resolves ambiguous email addresses and display names.                                                                                       |
| SendItem operation     | Sends email messages that are located in the Exchange store.                                                                                |
| UpdateFolder operation | Modifies the properties of existing folders in the Exchange store.                                                                          |
| UpdateItem operation   | Modifies the properties of existing items in the Exchange store.                                                                            |

7 **Note**

{374}------------------------------------------------

FAI (Folder Associated Information) items can't be updated (or created) from an add-in. These hidden messages are stored in a folder and are used to store a variety of settings and auxiliary data. Attempting to use the UpdateItem operation will throw an ErrorAccessDenied error: "Office extension is not allowed to update this type of item". As an alternative, you may use the **[EWS Managed API](https://learn.microsoft.com/en-us/exchange/client-developer/exchange-web-services/get-started-with-ews-managed-api-client-applications)** to update these items from a Windows client or a server application. Caution is recommended as internal, service-type data structures are subject to change and could break your solution.

# **Authentication and permission considerations for makeEwsRequestAsync**

When you use the makeEwsRequestAsync method, the request is authenticated by using the email account credentials of the current user. The makeEwsRequestAsync method manages the credentials for you so that you don't have to provide authentication credentials with your request.

#### 7 **Note**

The server administrator must use the **[New-WebServicesVirtualDirectory](https://learn.microsoft.com/en-us/powershell/module/exchange/client-access-servers/New-WebServicesVirtualDirectory?view=exchange-ps&preserve-view=true)** or the **[Set-WebServicesVirtualDirectory](https://learn.microsoft.com/en-us/powershell/module/exchange/client-access-servers/Set-WebServicesVirtualDirectory?view=exchange-ps&preserve-view=true)** cmdlet to set the *OAuthAuthentication* parameter to true on the Client Access server EWS directory in order to enable the makeEwsRequestAsync method to make EWS requests.

To use the makeEwsRequestAsync method, your add-in must request the **read/write mailbox** permission in the manifest. The markup varies depending on the type of manifest.

- **Add-in only manifest**: Set the **<Permissions>** element to **ReadWriteMailbox**.
- **Unified manifest for Microsoft 365**: Set the "name" property of an object in the "authorization.permissions.resourceSpecific" array to "Mailbox.ReadWrite.User".

For information about using the **read/write mailbox** permission, see read/write mailbox permission.

# **See also**

- Privacy and security for Office Add-ins
- Addressing same-origin policy limitations in Office Add-ins

{375}------------------------------------------------

- [EWS reference for Exchange](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/ews-reference-for-exchange)
- [Mail apps for Outlook and EWS in Exchange](https://learn.microsoft.com/en-us/exchange/client-developer/exchange-web-services/mail-apps-for-outlook-and-ews-in-exchange)

See the following for creating backend services for add-ins using ASP.NET Web API.

- [Create a web service for an Office Add-in using the ASP.NET Web API](https://learn.microsoft.com/en-us/archive/blogs/officeapps/create-a-web-service-for-an-app-for-office-using-the-asp-net-web-api)
- [The basics of building an HTTP service using ASP.NET Web API](https://dotnet.microsoft.com/apps/aspnet/apis)

{376}------------------------------------------------

# **Create notifications for your Outlook addin**

Article • 05/30/2025

Implement notification messages for your Outlook add-in to keep your users informed about important events, feedback, or errors with minimal disruption to their workflow.

# **Supported Outlook surfaces and modes**

Notification messages are supported on messages and appointments in both read and compose modes. They're displayed above the body of the mail item.

To manage a notification on a mail item, call [Office.context.mailbox.item.notificationMessages](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.3/office.context.mailbox.item#properties) in your add-in's JavaScript code. This property returns a [NotificationMessages](https://learn.microsoft.com/en-us/javascript/api/outlook/office.notificationmessages) object with methods to add, remove, get, or replace notifications. The following code shows how to use these methods to manage your add-in's notifications.

```
JavaScript
const notificationMessages = Office.context.mailbox.item.notificationMessages;
// Sample informational message.
const notificationDetails = {
 type: Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,
 message: "This is a sample notification message.",
 icon: "icon-16",
 persistent: false
};
```

{377}------------------------------------------------

```
const notificationKey = "notification_01";
// Add a notification to the mail item.
notificationMessages.addAsync(notificationKey, notificationDetails, (result) => {
 console.log("Added an informational notification.");
});
// Get all the notifications of the mail item.
notificationMessages.getAllAsync((result) => {
 console.log(JSON.stringify(result.value));
});
// Replace a notification.
const newNotification = {
 type: Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,
 message: "This is a sample error message."
};
notificationMessages.replaceAsync(notificationKey, newNotification, (result) => {
 console.log("Replaced the existing notification.");
});
// Remove a notification.
notificationMessages.removeAsync(notificationKey, (result) => {
 console.log("Removed the notification.");
});
```
# **Types of notifications**

A notification consists of a unique identifier, an icon, and a message. Depending on the type, it could also include a **Dismiss** action or a custom action. There are different [types of](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxenums.itemnotificationmessagetype) [notifications](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxenums.itemnotificationmessagetype) you can display to the user to fit your particular scenario.

- ErrorMessage
- InformationalMessage
- InsightMessage
- ProgressIndicator

The following sections describe each notification type, including its [properties](https://learn.microsoft.com/en-us/javascript/api/outlook/office.notificationmessagedetails) and supported platforms.

### **ErrorMessage**

**Description**

{378}------------------------------------------------

Alerts the user about an error or failed operation. For example, use the ErrorMessage type to notify the user that their personalized signature wasn't successfully added to a message.

|  | (8) Your signature couldn't be inserted at this time. Please try again. | Dismiss |
|--|-------------------------------------------------------------------------|---------|
|  |                                                                         |         |

#### **Properties**

- Displays an error icon. This icon can't be customized.
- Includes a **Dismiss** action to close the notification. If a user doesn't dismiss the error notification, it remains visible until the user sees it once before switching to another mail item.

#### **Minimum supported requirement set**

[1.3](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.3/outlook-requirement-set-1.3)

#### **Supported platforms**

- Web
- Windows (new and classic)
- Mac
- Android
- iOS

### **InformationalMessage**

#### **Description**

Provides information or feedback to the user. For example, use the InformationalMessage type to notify the user that their file upload completed successfully.

|  | C Your file has been uploaded successfully. | Dismiss |  |
|--|---------------------------------------------|---------|--|
|  |                                             |         |  |

#### **Properties**

- Must specify an icon. Although an icon is required, the custom icon is currently displayed only in classic Outlook on Windows. On other platforms, an information icon is shown.
- Includes a **Dismiss** action to close the notification.
- Can be customized to persist even after a user switches to another mail item. The notification remains until the add-in removes it or the user selects **Dismiss**.

#### **Minimum supported requirement set**

{379}------------------------------------------------

#### **Supported platforms**

- Web
- Windows (new and classic)
- Mac
- Android
- iOS

### **InsightMessage**

#### **Description**

Provides information or feedback to the user with an option to perform an action. For example, use the InsightMessage type to recommend adding catering services to a meeting with external recipients.

| Your meeting includes external recipients. Explore available services to enhance your<br>meeting. |              |         |
|---------------------------------------------------------------------------------------------------|--------------|---------|
|                                                                                                   | See services | Dismiss |

#### **Properties**

- Must specify an icon. Although an icon is required, the custom icon is displayed only in classic Outlook on Windows. On other platforms, an information icon is shown.
- Includes an option to perform one [action](https://learn.microsoft.com/en-us/javascript/api/outlook/office.notificationmessageaction). Currently, opening the add-in's task pane is the only supported action.
- Includes a **Dismiss** action to close the notification.
- Doesn't persist when a user switches to another mail item.

#### **Minimum supported requirement set**

#### [1.10](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.10/outlook-requirement-set-1.10)

#### **Supported platforms**

- Web
- Windows (new and classic)
- Mac

### **ProgressIndicator**

{380}------------------------------------------------

#### **Description**

Indicates the progress of an add-in operation. For example, use the ProgressIndicator to inform the user that their file is in the process of being attached to the mail item.

#### **Properties**

- In classic Outlook on Windows, displays a progress icon. On other platforms, displays an information icon. This icon can't be customized.
- Doesn't persist when a user switches to another mail item.

#### **Minimum supported requirement set**

#### [1.3](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.3/outlook-requirement-set-1.3)

#### **Supported platforms**

- Web
- Windows (new and classic)
- Mac
- Android
- iOS

# **Feature behaviors**

When creating and managing notifications for your add-in, be mindful of the following behaviors, limitations, and best practices.

### **Maximum number of notifications per mail item**

In Outlook on the web, on Windows (new and classic), and on Mac, you can add a maximum of five notifications per message. In Outlook on mobile devices, only one notification can be added to a message. Setting an additional notification replaces the existing one.

### **InsightMessage limitations**

Only one InsightMessage notification is allowed per add-in on a mail item. In Outlook on the web and new Outlook on Windows, the InsightMessage type is only supported in compose mode.

{381}------------------------------------------------

### **Notification icons and unified manifest for Microsoft 365**

If your add-in uses the unified manifest for Microsoft 365, you can't customize the icon of an InformationalMessage or InsightMessage notification. The notification uses the first image specified in the ["icons"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-common-custom-group-controls-item#icons) array of the first [extensions.ribbons.tabs.groups.controls](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-common-custom-group-controls-item) object of the manifest. Although this is the case, you must still specify a string in the [icon](https://learn.microsoft.com/en-us/javascript/api/outlook/office.notificationmessagedetails#outlook-office-notificationmessagedetails-icon-member) property of your [NotificationMessageDetails](https://learn.microsoft.com/en-us/javascript/api/outlook/office.notificationmessagedetails) object (for example, "icon-16").

### **Notification icons in Outlook on mobile devices**

In compose mode, while the style of each notification type varies on other Outlook clients, notifications in Outlook on Android and on iOS all use the same style. The notification message always uses an information icon.

### **Notifications for multiple selected messages**

When managing notifications for multiple selected messages, only the getAllAsync method is supported. To learn more, see Activate your Outlook add-in on multiple messages.

### **Best practices for ProgressIndicator notifications**

When implementing a ProgressIndicator notification in your add-in, once the applicable operation or action completes, replace the progress notification with another notification type. This is a best practice to ensure that your users always get the latest status of an operation.

# **Try the code example in Script Lab**

Learn how you can use notifications in your add-in by trying out the [Work with notification](https://raw.githubusercontent.com/OfficeDev/office-js-snippets/prod/samples/outlook/35-notifications/add-getall-remove.yaml) [messages](https://raw.githubusercontent.com/OfficeDev/office-js-snippets/prod/samples/outlook/35-notifications/add-getall-remove.yaml) sample in [Script Lab for Outlook](https://appsource.microsoft.com/product/office/wa200001603) . For more information on Script Lab, see Explore Office JavaScript API using Script Lab.

### **See also**

- Use the Office dialog API in Office Add-ins
- [Configure your Outlook add-in for event-based activation](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/autolaunch)

{382}------------------------------------------------

# **Get or set the body of a message or appointment in Outlook**

06/04/2025

Call the [Body](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body) API on a message or appointment to retrieve content, determine its format, or update content. With the available Body methods, you can customize signatures depending on mail item recipients or add disclaimers for legal purposes.

Select the applicable tab to learn how to get or set the body of a mail item.

Get body

You can get the body of a message or appointment in both read and compose modes. To retrieve the body of a mail item, call [Office.context.mailbox.item.body.getAsync.](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body#outlook-office-body-getasync-member(1)) When you call the getAsync method, you must specify the format for the returned body in the coercionType parameter. For example, you can get the body in HTML or plain text format.

The following example gets the body of an item in HTML format.

```
JavaScript
// Get the current body of the message or appointment.
Office.context.mailbox.item.body.getAsync(Office.CoercionType.Html,
(bodyResult) => {
 if (bodyResult.status === Office.AsyncResultStatus.Failed) {
 console.log(`Failed to get body: ${bodyResult.error.message}`);
 return;
 }
 const body = bodyResult.value;
 // Perform additional operations here.
});
```
# **Get the body of message replies in Outlook on the web or the new Outlook on Windows**

In Outlook on the web and the [new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) , users can organize their messages as conversations or individual messages in **Settings** > **Mail** > **Layout** > **Message organization**. This setting affects how much of a message's body is displayed to the user, particularly in conversation threads with multiple messages. Depending on the setting, the contents of the entire conversation thread or just the current message is displayed. For

{383}------------------------------------------------

more information on the **Message Organization** setting, see [Change how the message list](https://support.microsoft.com/office/57fe0cd8-e90b-4b1b-91e4-a0ba658c0042) [is displayed in Outlook](https://support.microsoft.com/office/57fe0cd8-e90b-4b1b-91e4-a0ba658c0042) .

When you call Office.context.mailbox.item.body.getAsync on a message reply, the entire body of a conversation thread is returned. If you want the returned body to reflect the user's **Message Organization** setting, you can specify the [bodyMode](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxenums.bodymode) option in the getAsync call. The following table lists the portion of the body returned depending on the bodyMode configuration.

ノ **Expand table**

| bodyMode configuration                                        | Effect on body                                                                                                                                                                                                                                     |
|---------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| bodyMode isn't specified in the getAsync call                 | The entire body of the conversation thread is<br>returned.                                                                                                                                                                                         |
| bodyMode is set to                                            | The entire body of the conversation thread is                                                                                                                                                                                                      |
| Office.MailboxEnums.BodyMode.FullBody                         | returned.                                                                                                                                                                                                                                          |
| bodyMode is set to<br>Office.MailboxEnums.BodyMode.HostConfig | If Message Organization is set to Group messages<br>by conversation > All messages from the selected<br>conversation or Show email grouped by<br>conversation > Newest on top/Newest on bottom,<br>only the body of the current reply is returned. |
|                                                               | If Message Organization is set to Individual<br>messages: Do not group messages > Only a single<br>message or Show email as individual messages, the<br>entire body of the conversation thread is returned.                                        |

#### 7 **Note**

The bodyMode option is ignored in Outlook on Windows (classic), on Mac, and on mobile devices.

The following example specifies the bodyMode option to honor the user's message setting.

JavaScript

```
Office.context.mailbox.item.body.getAsync(
 Office.CoercionType.Html,
 { bodyMode: Office.MailboxEnums.BodyMode.HostConfig },
 (bodyResult) => {
 if (bodyResult.status === Office.AsyncResultStatus.Failed) {
 console.log(`Failed to get body: ${bodyResult.error.message}`);
 return;
```

{384}------------------------------------------------

```
 }
 const body = bodyResult.value;
 // Perform additional operations here.
 }
);
```
# **Try code samples in Script Lab**

Get the [Script Lab for Outlook add-in](https://appsource.microsoft.com/product/office/wa200001603) and try out the item body code samples to see the get and set APIs in action. To learn more about Script Lab, see Explore Office JavaScript API using Script Lab.

# **See also**

- Create Outlook add-ins for compose forms
- Asynchronous programming in Office Add-ins
- Prepend or append content to a message or appointment body on send
- Limits for activation and JavaScript API for Outlook add-ins
- Get, set, or add recipients when composing an appointment or message in Outlook
- Get or set the subject when composing an appointment or message in Outlook

{385}------------------------------------------------

# **Get and set categories**

Article • 04/12/2024

In Outlook, a user can apply categories to messages and appointments as a means of organizing their mailbox data. The user defines the master list of color-coded categories for their mailbox, and can then apply one or more of those categories to any message or appointment item. Each [category](https://learn.microsoft.com/en-us/javascript/api/outlook/office.categorydetails) in the master list is represented by the name and [color](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxenums.categorycolor) that the user specifies. You can use the Office JavaScript API to manage the categories master list on the mailbox and the categories applied to an item.

#### 7 **Note**

Support for this feature was introduced in requirement set 1.8. See **[clients and](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients) [platforms](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients)** that support this requirement set.

### **Manage categories in the master list**

Only categories in the master list on your mailbox are available for you to apply to a message or appointment. You can use the API to add, get, and remove master categories.

#### ) **Important**

For the add-in to manage the categories master list, it must request the **read/write mailbox** permission in the manifest. The markup varies depending on the type of manifest.

- **Add-in only manifest**: Set the **<Permissions>** element to **ReadWriteMailbox**.
- **Unified manifest for Microsoft 365**: Set the "name" property of an object in the "authorization.permissions.resourceSpecific" array to "Mailbox.ReadWrite.User".

### **Add master categories**

The following example shows how to add a category named "Urgent!" to the master list by calling [addAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mastercategories#outlook-office-mastercategories-addasync-member(1)) on [mailbox.masterCategories.](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox#outlook-office-mailbox-mastercategories-member)

{386}------------------------------------------------

```
const masterCategoriesToAdd = [
 {
 "displayName": "Urgent!",
 "color": Office.MailboxEnums.CategoryColor.Preset0
 }
];
Office.context.mailbox.masterCategories.addAsync(masterCategoriesToAdd, 
function (asyncResult) {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
 console.log("Successfully added categories to master list");
 } else {
 console.log("masterCategories.addAsync call failed with error: " +
asyncResult.error.message);
 }
});
```
### **Get master categories**

The following example shows how to get the list of categories by calling [getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mastercategories#outlook-office-mastercategories-getasync-member(1)) on [mailbox.masterCategories.](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox#outlook-office-mailbox-mastercategories-member)

```
JavaScript
Office.context.mailbox.masterCategories.getAsync(function (asyncResult) {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log("Action failed with error: " +
asyncResult.error.message);
 } else {
 const masterCategories = asyncResult.value;
 console.log("Master categories:");
 masterCategories.forEach(function (item) {
 console.log("-- " + JSON.stringify(item));
 });
 }
});
```
### **Remove master categories**

The following example shows how to remove the category named "Urgent!" from the master list by calling [removeAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mastercategories#outlook-office-mastercategories-removeasync-member(1)) on [mailbox.masterCategories.](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox#outlook-office-mailbox-mastercategories-member)

```
JavaScript
const masterCategoriesToRemove = ["Urgent!"];
Office.context.mailbox.masterCategories.removeAsync(masterCategoriesToRemove
```

{387}------------------------------------------------

```
, function (asyncResult) {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
 console.log("Successfully removed categories from master list");
 } else {
 console.log("masterCategories.removeAsync call failed with error: "
+ asyncResult.error.message);
 }
});
```
# **Manage categories on a message or appointment**

You can use the API to add, get, and remove categories for a message or appointment item.

#### ) **Important**

Only categories in the master list on your mailbox are available for you to apply to a message or appointment. See the earlier section **Manage categories in the master list** for more information.

In Outlook on the web or **[new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** , you can't use the API to manage categories on a message in Compose mode.

### **Add categories to an item**

The following example shows how to apply the category named "Urgent!" to the current item by calling [addAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.categories#outlook-office-categories-addasync-member(1)) on item.categories .

```
JavaScript
const categoriesToAdd = ["Urgent!"];
Office.context.mailbox.item.categories.addAsync(categoriesToAdd, function
(asyncResult) {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
 console.log("Successfully added categories");
 } else {
 console.log("categories.addAsync call failed with error: " +
asyncResult.error.message);
 }
});
```

{388}------------------------------------------------

### **Get an item's categories**

The following example shows how to get the categories applied to the current item by calling [getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.categories#outlook-office-categories-getasync-member(1)) on item.categories .

```
JavaScript
Office.context.mailbox.item.categories.getAsync(function (asyncResult) {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log("Action failed with error: " +
asyncResult.error.message);
 } else {
 const categories = asyncResult.value;
 console.log("Categories:");
 categories.forEach(function (item) {
 console.log("-- " + JSON.stringify(item));
 });
 }
});
```
### **Remove categories from an item**

The following example shows how to remove the category named "Urgent!" from the current item by calling [removeAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.categories#outlook-office-categories-removeasync-member(1)) on item.categories .

```
JavaScript
const categoriesToRemove = ["Urgent!"];
Office.context.mailbox.item.categories.removeAsync(categoriesToRemove, 
function (asyncResult) {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
 console.log("Successfully removed categories");
 } else {
 console.log("categories.removeAsync call failed with error: " +
asyncResult.error.message);
 }
});
```
# **See also**

- Outlook permissions

{389}------------------------------------------------

### 6 **Collaborate with us on GitHub**

The source for this content can be found on GitHub, where you can also create and review issues and pull requests. For more information, see [our](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md) [contributor guide](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md).

### **Office Add-ins feedback**

Office Add-ins is an open source project. Select a link to provide feedback:

- [Open a documentation issue](https://github.com/OfficeDev/office-js-docs-pr/issues/new?template=3-customer-feedback.yml&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Foffice%2Fdev%2Fadd-ins%2Foutlook%2Fcategories&pageQueryParams=&contentSourceUrl=https%3A%2F%2Fgithub.com%2FOfficeDev%2Foffice-js-docs-pr%2Fblob%2Fmain%2Fdocs%2Foutlook%2Fcategories.md&documentVersionIndependentId=fc46bd10-718d-fefa-5225-4f029a95af15&feedback=%0A%0A%5BEnter+feedback+here%5D%0A&author=%40o365devx&metadata=*+ID%3A+cdeb3209-033f-5c12-7f08-14adcd02bb66+%0A*+Service%3A+**outlook**%0A*+Sub-service%3A+**add-ins**)
- [Provide product feedback](https://aka.ms/office-addins-dev-questions)

{390}------------------------------------------------

# **Get and set internet headers on a message in an Outlook add-in**

Article • 02/11/2025

# **Background**

A common requirement in Outlook add-ins development is to store custom properties associated with an add-in at different levels. At present, custom properties are stored at the item or mailbox level.

- Item level For properties that apply to a specific item that need to be accessed during subsequent Outlook sessions, use the [CustomProperties](https://learn.microsoft.com/en-us/javascript/api/outlook/office.customproperties) object. For example, store a customer code associated with the person who sent the email. If properties for a specific item are only needed during the current compose session, use the [SessionData](https://learn.microsoft.com/en-us/javascript/api/outlook/office.sessiondata) object.
- Mailbox level For properties that apply to all the mail items in the user's mailbox, use the [RoamingSettings](https://learn.microsoft.com/en-us/javascript/api/outlook/office.roamingsettings) object. For example, store a user's preference to show the temperature in a particular scale.

These types of properties aren't preserved after the item leaves the Exchange server, so the email recipients can't get any properties set on the item. Therefore, developers can't access those settings or other Multipurpose Internet Mail Extensions (MIME) properties to enable better read scenarios.

In Exchange on-premises environments, while there's a way for you to set the internet headers through Exchange Web Services (EWS) requests, in some scenarios, making an EWS request won't work. For example, in Compose mode on Outlook desktop, the item ID isn't synced on  saveAsync  in cached mode.

### **Tip**

To learn more about using these options, see **Get and set add-in metadata for an Outlook add-in**.

# **Purpose of the internet headers API**

Introduced in [Mailbox requirement set 1.8,](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.8/outlook-requirement-set-1.8) the internet headers APIs enable developers to:

{391}------------------------------------------------

- Stamp information on an email that persists after it leaves Exchange across all clients.
- Read information on an email that persisted after the email left Exchange across all clients in mail read scenarios.
- Access the entire MIME header of the email.

# **Supported clients**

To use the internet headers API in your add-in, your Outlook client must support requirement set 1.8 or later. For information on supported clients, see [Outlook client](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#outlook-client-support) [support](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#outlook-client-support).

The internet headers API is also supported in Outlook on Android and on iOS starting in Version 4.2405.0. To learn more about features supported in Outlook on mobile devices, see Outlook JavaScript APIs supported in Outlook on mobile devices.

# **Set internet headers while composing a message**

Use the [item.internetHeaders](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messagecompose#outlook-office-messagecompose-internetheaders-member) property to manage the custom internet headers you place on the current message in Compose mode.

### **Set, get, and remove custom internet headers example**

The following example shows how to set, get, and remove custom internet headers.

```
JavaScript
// Set custom internet headers.
function setCustomHeaders() {
 Office.context.mailbox.item.internetHeaders.setAsync(
```

{392}------------------------------------------------

```
 { "preferred-fruit": "orange", "preferred-vegetable": "broccoli", "best-
vegetable": "spinach" },
 setCallback
 );
}
function setCallback(asyncResult) {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
 console.log("Successfully set headers");
 } else {
 console.log("Error setting headers: " + 
JSON.stringify(asyncResult.error));
 }
}
// Get custom internet headers.
function getSelectedCustomHeaders() {
 Office.context.mailbox.item.internetHeaders.getAsync(
 ["preferred-fruit", "preferred-vegetable", "best-vegetable", 
"nonexistent-header"],
 getCallback
 );
}
function getCallback(asyncResult) {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
 console.log("Selected headers: " + JSON.stringify(asyncResult.value));
 } else {
 console.log("Error getting selected headers: " + 
JSON.stringify(asyncResult.error));
 }
}
// Remove custom internet headers.
function removeSelectedCustomHeaders() {
 Office.context.mailbox.item.internetHeaders.removeAsync(
 ["best-vegetable", "nonexistent-header"],
 removeCallback);
}
function removeCallback(asyncResult) {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
 console.log("Successfully removed selected headers");
 } else {
 console.log("Error removing selected headers: " + 
JSON.stringify(asyncResult.error));
 }
}
setCustomHeaders();
getSelectedCustomHeaders();
removeSelectedCustomHeaders();
getSelectedCustomHeaders();
/* Sample output:
```

{393}------------------------------------------------

```
Successfully set headers
Selected headers: {"best-vegetable":"spinach","preferred-
fruit":"orange","preferred-vegetable":"broccoli"}
Successfully removed selected headers
Selected headers: {"preferred-fruit":"orange","preferred-
vegetable":"broccoli"}
*/
```
### **Get internet headers while reading a message**

Call [item.getAllInternetHeadersAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messageread#outlook-office-messageread-getallinternetheadersasync-member(1)) to get internet headers on the current message in Read mode.

### **Get sender preferences from current MIME headers example**

Building on the example from the previous section, the following code shows how to get the sender's preferences from the current email's MIME headers.

```
JavaScript
Office.context.mailbox.item.getAllInternetHeadersAsync(getCallback);
function getCallback(asyncResult) {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
 console.log("Sender's preferred fruit: " +
asyncResult.value.match(/preferred-fruit:.*/gim)[0].slice(17));
 console.log("Sender's preferred vegetable: " +
asyncResult.value.match(/preferred-vegetable:.*/gim)[0].slice(21));
 } else {
 console.log("Error getting preferences from header: " + 
JSON.stringify(asyncResult.error));
 }
}
/* Sample output:
Sender's preferred fruit: orange
Sender's preferred vegetable: broccoli
*/
```
#### ) **Important**

This sample works for simple cases. For more complex information retrieval (for example, multi-instance headers or folded values as described in **[RFC 2822](https://tools.ietf.org/html/rfc2822)** ), try using an appropriate MIME-parsing library.

{394}------------------------------------------------

# **Recommended practices**

Currently, internet headers are a finite resource on a user's mailbox. When the quota is exhausted, you can't create any more internet headers on that mailbox, which can result in unexpected behavior from clients that rely on this to function.

Apply the following guidelines when you create internet headers in your add-in.

- Create the minimum number of headers required. The header quota is based on the total size of headers applied to a message. In Exchange Online, the header limit is capped at 256 KB, while in an Exchange on-premises environment, the limit is determined by your organization's administrator. For further information on header limits, see [Exchange Online message limits](https://learn.microsoft.com/en-us/office365/servicedescriptions/exchange-online-service-description/exchange-online-limits#message-limits) and [Exchange Server message](https://learn.microsoft.com/en-us/exchange/mail-flow/message-size-limits) [limits.](https://learn.microsoft.com/en-us/exchange/mail-flow/message-size-limits)
- Name headers so that you can reuse and update their values later. As such, avoid naming headers in a variable manner (for example, based on user input, timestamp, etc.).

# **See also**

- Get and set add-in metadata for an Outlook add-in

{395}------------------------------------------------

# **Get and set the recurrence of appointments**

06/18/2025

Sometimes you need to create and update a recurring appointment, such as a weekly status meeting for a team project or a yearly birthday reminder. Use the Office JavaScript API to manage the recurrence patterns of an appointment series in your add-in.

#### 7 **Note**

Support for this feature was introduced in **[requirement set 1.7](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.7/outlook-requirement-set-1.7)**. See **[clients and platforms](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients)** that support this requirement set.

## **Recurrence patterns**

The recurrence pattern of an appointment is made up of a [recurrence type](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxenums.recurrencetype) (such as daily or weekly recurrence) and its applicable [recurrence properties](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recurrenceproperties) (for example, the day of the month the appointment occurs).

|                     | Appointment Recurrence                          |  |
|---------------------|-------------------------------------------------|--|
| Appointment time    |                                                 |  |
| Start:              | 11:00 AM<br>Pacific Time (US & Canada)<br>V     |  |
| End:                | 11:30 AM<br>Pacific Time (US & Canada)<br>>     |  |
| Duration:           | 30 minutes<br>>                                 |  |
| Recurrence pattern  |                                                 |  |
| Daily               | Recur every<br>week (s) on:<br>1                |  |
| Weekly              | Monday<br>Sunday<br>Tuesday<br>Wednesday        |  |
| Monthly             | Thursday<br>Friday<br>Saturday                  |  |
| Yearly              |                                                 |  |
|                     |                                                 |  |
| Range of recurrence |                                                 |  |
| Start:              | End by:<br>Wed 5/29/2024<br>Wed 11/13/2024<br>> |  |
|                     | End after:<br>occurrences<br>25                 |  |
|                     | No end date                                     |  |
|                     | ОК<br>Cancel<br>Remove Recurrence               |  |

The following table lists the available recurrence types, their configurable properties, and descriptions of their usage.

{396}------------------------------------------------

| Recurrence<br>type | Valid recurrence<br>properties                             | Usage                                                                                                                                                                                                                                                                                                                                                    |
|--------------------|------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| daily              | interval                                                   | An appointment occurs every interval days. For example,<br>an appointment occurs every two days.                                                                                                                                                                                                                                                         |
| weekday            | None                                                       | An appointment occurs every weekday.                                                                                                                                                                                                                                                                                                                     |
| monthly            | interval<br>dayOfMonth<br>dayOfWeek<br>weekNumber          | An appointment occurs on day dayOfMonth every interval<br>months. For example, an appointment occurs on the fifth<br>day every four months.<br>An appointment occurs on the weekNumber<br>dayOfWeek<br>every interval months. For example, an appointment<br>occurs on the third Thursday every two months.                                              |
| weekly             | interval<br>days                                           | An appointment occurs on days every interval weeks. For<br>example, an appointment occurs on Tuesday and Thursday<br>every two weeks.                                                                                                                                                                                                                    |
| yearly             | interval<br>dayOfMonth<br>dayOfWeek<br>weekNumber<br>month | An appointment occurs on day dayOfMonth of month<br>every interval years. For example, an appointment occurs<br>on the seventh day of September every four years.<br>An appointment occurs on the weekNumber<br>dayOfWeek of<br>month every interval years. For example, an appointment<br>occurs on the first<br>Thursday of September every two years. |

### **Tip**

You can also use the **[firstDayOfWeek](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recurrenceproperties#firstDayOfWeek)** property with the weekly recurrence type. The specified day will start the list of days displayed in the recurrence dialog.

# **Access the recurrence pattern**

As shown in the following table, how you access the recurrence pattern and what you can do with it depends on:

- Whether you're the appointment organizer or an attendee.
- Whether you're using the add-in in compose or read mode.
- Whether the current appointment is a single occurrence or a series.

{397}------------------------------------------------

| Appointment state                        | Is recurrence editable?            | Is recurrence viewable? |
|------------------------------------------|------------------------------------|-------------------------|
| Appointment organizer - compose series   | Yes (setAsync)                     | Yes (getAsync)          |
| Appointment organizer - compose instance | No (<br>setAsync returns an error) | Yes (getAsync)          |
| Appointment attendee - read series       | No (<br>setAsync not available)    | Yes (item.recurrence)   |
| Appointment attendee - read instance     | No (<br>setAsync not available)    | Yes (item.recurrence)   |
| Meeting request - read series            | No (<br>setAsync not available)    | Yes (item.recurrence)   |
| Meeting request - read instance          | No (<br>setAsync not available)    | Yes (item.recurrence)   |

### **Set recurrence as the organizer**

Along with the recurrence pattern, you also need to determine the start and end dates and times of your appointment series. The [SeriesTime](https://learn.microsoft.com/en-us/javascript/api/outlook/office.seriestime) object is used to manage that information.

The appointment organizer can specify the recurrence pattern for an appointment series in compose mode only. In the following example, the appointment series is set to occur from 10:30 AM to 11:00 AM PST every Tuesday and Thursday during the period November 2, 2019 to December 2, 2019.

```
JavaScript
const seriesTimeObject = new Office.SeriesTime();
seriesTimeObject.setStartDate(2019,10,2);
seriesTimeObject.setEndDate(2019,11,2);
seriesTimeObject.setStartTime(10,30);
seriesTimeObject.setDuration(30);
const pattern = {
 seriesTime: seriesTimeObject,
 recurrenceType: Office.MailboxEnums.RecurrenceType.Weekly,
 recurrenceProperties:
 {
 interval: 1,
 days: [Office.MailboxEnums.Days.Tue, Office.MailboxEnums.Days.Thu]
 },
 recurrenceTimeZone: { name:
Office.MailboxEnums.RecurrenceTimeZone.PacificStandardTime }
};
Office.context.mailbox.item.recurrence.setAsync(pattern, (asyncResult) => {
 console.log(JSON.stringify(asyncResult));
});
```

{398}------------------------------------------------

# **Change recurrence as the organizer**

In the following example, the appointment organizer gets the [Recurrence](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recurrence) object of an appointment series, then sets a new recurrence duration. This is done in compose mode.

```
JavaScript
Office.context.mailbox.item.recurrence.getAsync((asyncResult) => {
 const recurrencePattern = asyncResult.value;
 recurrencePattern.seriesTime.setDuration(60);
 Office.context.mailbox.item.recurrence.setAsync(recurrencePattern, (asyncResult)
=> {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log("Failed to set recurrence.");
 return;
 }
 console.log("Successfully set recurrence.");
 });
});
```
### **Get recurrence as the organizer**

In the following example, the appointment organizer gets the Recurrence object of an appointment to determine whether it's a recurring series. This is done in compose mode.

```
JavaScript
Office.context.mailbox.item.recurrence.getAsync((asyncResult) => {
 const recurrence = asyncResult.value;
 if (recurrence == null) {
 console.log("Non-recurring meeting.");
 } else {
 console.log(JSON.stringify(recurrence));
 }
});
```
The following example shows the results of the getAsync call that retrieves the recurrence of a series.

#### 7 **Note**

In this example, seriesTimeObject is a placeholder for the JSON representing the recurrence.seriesTime property. You should use the **[SeriesTime](https://learn.microsoft.com/en-us/javascript/api/outlook/office.seriestime)** methods to get the 

{399}------------------------------------------------

recurrence date and time properties.

| JSON |                                                                                                                                                                                                                                                           |
|------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| {    | "recurrenceType": "weekly",<br>"recurrenceProperties": {<br>"interval": 1,<br>"days": ["tue","thu"],<br>"firstDayOfWeek": "sun"},<br>"seriesTime": {seriesTimeObject},<br>"recurrenceTimeZone": {<br>"name": "Pacific Standard Time",<br>"offset": -480}} |
|      |                                                                                                                                                                                                                                                           |

### **Get recurrence as an attendee**

In the following example, an appointment attendee gets the Recurrence object of an appointment or meeting request.

```
JavaScript
outputRecurrence(Office.context.mailbox.item);
function outputRecurrence(item) {
 const recurrence = item.recurrence;
 if (recurrence == null) {
 console.log("Non-recurring meeting.");
 } else {
 console.log(JSON.stringify(recurrence));
 }
}
```
The following example shows the value of the item.recurrence property of an appointment series.

#### 7 **Note**

In this example, seriesTimeObject is a placeholder for the JSON representing the recurrence.seriesTime property. You should use the **[SeriesTime](https://learn.microsoft.com/en-us/javascript/api/outlook/office.seriestime)** methods to get the recurrence date and time properties.

{400}------------------------------------------------

```
 "recurrenceType": "weekly",
 "recurrenceProperties": {
 "interval": 1,
 "days": ["tue","thu"],
 "firstDayOfWeek": "sun"},
 "seriesTime": {seriesTimeObject},
 "recurrenceTimeZone": {
 "name": "Pacific Standard Time",
 "offset": -480}}
```
# **Get the recurrence details**

After you've retrieved the recurrence object (either from the getAsync callback or from item.recurrence ), you can get specific properties of the recurrence. For example, get the start and end dates and times of the series by using the [SeriesTime](https://learn.microsoft.com/en-us/javascript/api/outlook/office.seriestime) methods on the recurrence.seriesTime property.

JavaScript

{

```
// Get the date and time information of the series.
const seriesTime = recurrence.seriesTime;
const startTime = recurrence.seriesTime.getStartTime();
const endTime = recurrence.seriesTime.getEndTime();
const startDate = recurrence.seriesTime.getStartDate();
const endDate = recurrence.seriesTime.getEndDate();
const duration = recurrence.seriesTime.getDuration();
// Get the series time zone.
const timeZone = recurrence.recurrenceTimeZone;
// Get the recurrence properties.
const recurrenceProperties = recurrence.recurrenceProperties;
// Get the recurrence type.
const recurrenceType = recurrence.recurrenceType;
```
### **Identify when the recurrence pattern changes**

There may be scenarios where you want your add-in to detect and handle changes to the recurrence pattern of a series. For example, you'd like to update the appointment's location if the series is extended. To implement this, you must create a handler for the [RecurrenceChanged](https://learn.microsoft.com/en-us/javascript/api/office/office.eventtype) event. To add an event handler for the RecurrenceChanged event, call [Office.context.mailbox.item.addHandlerAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods). When a change is detected, the event handler

{401}------------------------------------------------

receives an argument of type [Office.RecurrenceChangedEventArgs](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recurrencechangedeventargs), which provides the updated recurrence object.

The following example shows how to register an event handler for the RecurrenceChanged event.

```
JavaScript
// This sample shows how to register an event handler in Outlook.
Office.onReady(() => {
 // Register an event handler to identify when the recurrence pattern of a
series is updated.

Office.context.mailbox.item.addHandlerAsync(Office.EventType.RecurrenceChanged,
handleEvent, (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(asyncResult.error.message);
 return;
 }
 console.log("Event handler added for the RecurrenceChanged event.");
 });
});
function handleEvent(event) {
 // Get the updated recurrence object.
 const updatedRecurrence = event.recurrence;
 // Perform operations in response to the updated recurrence pattern.
}
```
# **Run sample snippets in Script Lab**

To test how to get and set the recurrence of an appointment with an add-in, install the [Script](https://appsource.microsoft.com/product/office/wa200001603) [Lab for Outlook add-in](https://appsource.microsoft.com/product/office/wa200001603) and run the following sample snippets.

- "Get recurrence (Read)"
- "Get and set recurrence (Appointment Organizer)"

To learn more about Script Lab, see Explore Office JavaScript API using Script Lab.

{402}------------------------------------------------

| 팀<br>ದ್ರಾ           | 901                |                                                                                                                                                                         | Untitled - Appointment |                    |             | Q                        | Search the menus and more |         |                  |                         |                     |                                                               |                  |                   |  | 0               | × |
|---------------------|--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------|--------------------|-------------|--------------------------|---------------------------|---------|------------------|-------------------------|---------------------|---------------------------------------------------------------|------------------|-------------------|--|-----------------|---|
| Appointment<br>File |                    | Scheduling Assistant                                                                                                                                                    | Insert                 | Draw               | Format Text | Review                   | Developer                 | Help    |                  |                         |                     |                                                               |                  |                   |  |                 |   |
| ﺑﺎ<br>Delete        | Teams<br>Meeting ~ | N<br>Send to<br>OneNote                                                                                                                                                 | Invite<br>Attendees    | Busy<br>15 minutes |             | C Recurrence             | Tags<br>V                 | Dictate | Sensitivity<br>V | 00<br>00<br>All<br>Apps | Immersive<br>Reader | New<br>Scheduling Poll                                        | Viva<br>Insights | View<br>Templates |  | Script<br>Lab × |   |
| Actions             | Teams Meet         | OneNote                                                                                                                                                                 | Attendees              |                    | Options     |                          |                           | Voice   | Sensitivity      | Apps                    | Immersive           | Find Time                                                     | Add-in           | My Templates      |  |                 | V |
|                     | Title              |                                                                                                                                                                         |                        |                    |             |                          |                           |         |                  |                         |                     | Script Lab for Outlook<br>                                    |                  |                   |  | V               | × |
| Save &<br>Close     | Start time         | Wed 5/29/2024                                                                                                                                                           |                        | 11:00 AM           |             | Pacific Time (US & Canar |                           |         | All day          | Time zones              |                     |                                                               |                  |                   |  |                 |   |
|                     | End time           | This sample shows how to get and set the item's<br>Wed 5/29/2024<br>11:30 AM<br>1<br>recurrence pattern, if any.<br>Pacific Time (US & Canal ▼<br>C Make Recurring<br>V |                        |                    |             |                          |                           |         |                  |                         |                     |                                                               |                  |                   |  |                 |   |
|                     | Location           |                                                                                                                                                                         |                        |                    |             |                          |                           |         |                  |                         |                     | Required mode: Appointment Organizer                          |                  |                   |  |                 |   |
|                     |                    |                                                                                                                                                                         |                        |                    |             |                          |                           |         |                  |                         |                     | Try it out                                                    |                  |                   |  |                 |   |
|                     |                    |                                                                                                                                                                         |                        |                    |             |                          |                           |         |                  |                         |                     | Get the recurrence pattern                                    |                  |                   |  |                 |   |
|                     |                    |                                                                                                                                                                         |                        |                    |             |                          |                           |         |                  |                         |                     | Note: You can only set the recurrence pattern on a<br>series. |                  |                   |  |                 |   |
|                     |                    |                                                                                                                                                                         |                        |                    |             |                          |                           |         |                  |                         |                     | Set the recurrence pattern                                    |                  |                   |  |                 |   |
|                     |                    |                                                                                                                                                                         |                        |                    |             |                          |                           |         |                  |                         |                     |                                                               |                  |                   |  |                 |   |
|                     |                    |                                                                                                                                                                         |                        |                    |             |                          |                           |         |                  |                         |                     |                                                               |                  |                   |  |                 |   |
|                     |                    |                                                                                                                                                                         |                        |                    |             |                          |                           |         |                  |                         |                     |                                                               |                  |                   |  |                 |   |
|                     |                    |                                                                                                                                                                         |                        |                    |             |                          |                           |         |                  |                         |                     |                                                               |                  |                   |  |                 |   |
|                     |                    |                                                                                                                                                                         |                        |                    |             |                          |                           |         |                  |                         |                     |                                                               |                  |                   |  |                 |   |

# **See also**

- Get or set the time when composing an appointment in Outlook
- Get or set the location when composing an appointment in Outlook

{403}------------------------------------------------

# **Get and set add-in metadata for an Outlook add-in**

Article • 02/11/2025

Manage custom data in your Outlook add-in using roaming settings, custom properties, or session data. These options give access to custom data that's only accessible by your Outlook add-in, but each method stores the data separately from the other. That is, the data stored through roaming settings isn't accessible by custom properties, and vice versa.

The following table provides an overview of the available options to manage custom data in Outlook add-ins.

| Custom<br>data<br>option | Minimum<br>requirement<br>set | Applies<br>to | Description                                                                                                                                                                                                                                                   |
|--------------------------|-------------------------------|---------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Roaming<br>settings      | 1.1                           | Mailbox       | Manages custom data in a user's mailbox. The add-in<br>that sets the custom data can access it from other<br>supported devices where the user's mailbox is set up.<br>Stored data is accessible in subsequent Outlook<br>sessions.                            |
| Custom<br>properties     | 1.1                           | Mail<br>item  | Manages custom data for a mail item in a user's<br>mailbox. The add-in that sets the custom data can<br>access it from the mail item on supported devices<br>where the user's mailbox is set up. Stored data is<br>accessible in subsequent Outlook sessions. |
| Session<br>data          | 1.11                          | Mail<br>item  | Manages custom data for a mail item in the user's<br>current Outlook session. The add-in that sets the<br>custom data can only access it from the mail item<br>while it's being composed.                                                                     |

#### ノ **Expand table**

#### 7 **Note**

For information on requirement sets and their supported clients, see **[Outlook](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets) [JavaScript API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets)**.

To learn more about each custom data option, select the applicable tab.

{404}------------------------------------------------

#### Roaming settings

You can specify data specific to a user's Exchange mailbox using the [RoamingSettings](https://learn.microsoft.com/en-us/javascript/api/outlook/office.roamingsettings) object. Examples of such data include the user's personal data and preferences. Your mail add-in can access roaming settings when it roams on any device it's designed to run on (desktop, tablet, or smartphone).

Changes to this data are stored on an in-memory copy of those settings for the current Outlook session. You should explicitly save all the roaming settings after updating them so that they'll be available the next time the user opens your add-in, on the same or any other supported device.

#### ) **Important**

While the Outlook add-in API limits access to these settings to only the add-in that created them, these settings shouldn't be considered secure storage. They can be accessed by other services, such as Microsoft Graph. They shouldn't be used to store sensitive information, such as user credentials or security tokens.

### **Roaming settings format**

The data in a **RoamingSettings** object is stored as a serialized JavaScript Object Notation (JSON) string.

The following is an example of the structure, assuming there are three defined roaming settings named add-in_setting_name_0 , add-in_setting_name_1 , and addin_setting_name_2 .

```
JSON
{
 "add-in_setting_name_0": "add-in_setting_value_0",
 "add-in_setting_name_1": "add-in_setting_value_1",
 "add-in_setting_name_2": "add-in_setting_value_2"
}
```
### **Loading roaming settings**

A mail add-in typically loads roaming settings in the [Office.onReady](https://learn.microsoft.com/en-us/javascript/api/office#office-office-onready-function(1)) handler. The following JavaScript code example shows how to load existing roaming settings and get the values of two settings, **customerName** and **customerBalance**.

{405}------------------------------------------------

```
JavaScript
```

```
let _mailbox;
let _settings;
let _customerName;
let _customerBalance;
Office.onReady((info) => {
 if (info.host === Office.HostType.Outlook) {
 // Initialize instance variables to access API objects.
 _mailbox = Office.context.mailbox;
 _settings = Office.context.roamingSettings;
 _customerName = _settings.get("customerName");
 _customerBalance = _settings.get("customerBalance");
 }
});
```
### **Creating or assigning a roaming setting**

Continuing with the earlier example, the following JavaScript function, setAddInSetting , shows how to use the [RoamingSettings.set](https://learn.microsoft.com/en-us/javascript/api/outlook/office.roamingsettings) method to set a setting named cookie with today's date. Then, it persists the data by using the [RoamingSettings.saveAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.roamingsettings#outlook-office-roamingsettings-saveasync-member(1)) method to save all the roaming settings to the user's mailbox.

The set method creates the setting if the setting doesn't already exist, and assigns the setting to the specified value. The saveAsync method saves roaming settings asynchronously. This code sample passes a callback function, saveMyAddInSettingsCallback , to saveAsync . When the asynchronous call finishes, saveMyAddInSettingsCallback is called by using one parameter, *asyncResult*. This parameter is an [AsyncResult](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult) object that contains the result of and any details about the asynchronous call. You can use the optional *userContext* parameter to pass any state information from the asynchronous call to the callback function.

JavaScript

```
// Set a roaming setting.
function setAddInSetting() {
 _settings.set("cookie", Date());
 // Save roaming settings to the mailbox, so that they'll be available
in the next session.
 _settings.saveAsync(saveMyAddInSettingsCallback);
}
// Callback function after saving custom roaming settings.
function saveMyAddInSettingsCallback(asyncResult) {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
```

{406}------------------------------------------------

```
 // Handle the failure.
 }
}
```
### **Removing a roaming setting**

Still extending the earlier example, the following JavaScript function, removeAddInSetting , shows how to use the [RoamingSettings.remove](https://learn.microsoft.com/en-us/javascript/api/outlook/office.roamingsettings#outlook-office-roamingsettings-remove-member(1)) method to remove the cookie setting and save all the roaming settings to the mailbox.

```
JavaScript
// Remove an add-in setting.
function removeAddInSetting()
{
 _settings.remove("cookie");
 // Save changes to the roaming settings for the mailbox, so that
they'll be available in the next Outlook session.
 _settings.saveAsync(saveMyAddInSettingsCallback);
}
```
### **Try the code example in Script Lab**

To learn how to create and manage a RoamingSettings object, get the [Script Lab for](https://appsource.microsoft.com/product/office/wa200001603) [Outlook add-in](https://appsource.microsoft.com/product/office/wa200001603) and try out the ["Use add-in settings" sample](https://raw.githubusercontent.com/OfficeDev/office-js-snippets/refs/heads/main/samples/outlook/10-roaming-settings/roaming-settings.yaml) . To learn more about Script Lab, see Explore Office JavaScript API using Script Lab.

# **See also**

- [MAPI Property Overview](https://learn.microsoft.com/en-us/office/client-developer/outlook/mapi/mapi-property-overview)
- Enable SSO in an Office Add-in using nested app authentication (preview)
- Get and set internet headers on a message in an Outlook add-in

{407}------------------------------------------------

# **Create Outlook add-ins for read forms**

Article • 07/18/2024

Read add-ins activate in the Reading Pane or read inspector of Outlook. Unlike compose add-ins (Outlook add-ins that are activated when a user creates a message or appointment), read add-ins are available when users:

- View an email message, meeting request, meeting response, or meeting cancellation.
7 **Note**

Outlook doesn't activate add-ins in read form for certain types of messages, including items that are attachments to another message, items in the Outlook Drafts folder, or items that are encrypted or protected in other ways.

- View a meeting item in which the user is an attendee.
# **Locate a read add-in in Outlook**

The location of an add-in in the Message Read surface depends on your Outlook client.

- **Windows (classic)**, **Mac**: Select the add-in from the ribbon of the Reading Pane or read inspector.

| File                                                                                                                                                                                   | Message                    | Developer                     | Help      |           |             |               |                            |              |                                            |                                                      |                                   |                            |                            |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|-------------------------------|-----------|-----------|-------------|---------------|----------------------------|--------------|--------------------------------------------|------------------------------------------------------|-----------------------------------|----------------------------|----------------------------|
| Share to<br>Teams<br>Teams                                                                                                                                                             | ටිය<br>All<br>Apps<br>Appl | Quick<br>Steps v<br>Quic. I'v | Move<br>V | lagt<br>V | diting<br>V | Immeruve<br>V | Translate<br>V<br>Language | Zoom<br>Zoom | Reply with<br>Scheduling Poll<br>Find Time | 16.90<br>તે મ<br>Translate<br>Message<br>Translation | Report<br>Message v<br>Profection | Vrua<br>Insights<br>Add-In | Script<br>Lab v<br>27<br>V |
| Proposal for Tailspin Toys<br>0<br>Reply All<br>C) Reply<br>-> Forward<br>1<br><br>Adele Vance                                                                                         |                            |                               |           |           |             |               |                            |              |                                            |                                                      |                                   |                            |                            |
| To Diego Siciliani; O Alex Wilber; O Lynne Robbins; O Contoso Sales<br>Mon 10/2/2023 4:13 PM<br>We're putting together a proposal for Tailspin Toys, which will be reviewed next week. |                            |                               |           |           |             |               |                            |              |                                            |                                                      |                                   |                            |                            |
| Thanks,<br>Adele                                                                                                                                                                       |                            |                               |           |           |             |               |                            |              |                                            |                                                      |                                   |                            |                            |

- **Web, [new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** : Select or open a message in a new window, then select the add-in from the message action bar. If your add-in doesn't appear in the action bar, select **Apps** to view your installed add-ins.

{408}------------------------------------------------

To select an add-in from the Appointment Read surface, open a meeting, then select the add-in from the ribbon.

# **Types of add-ins available in read mode**

Read add-ins can be any combination of the following types.

- Add-in commands
- Contextual Outlook add-ins
- [Event-based activation add-ins](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/autolaunch)

# **See also**

- Build your first Outlook add-in
- Outlook add-in APIs

{409}------------------------------------------------

# **Get an Outlook item's attachments from Exchange**

Article • 10/29/2024

The Office JavaScript API includes APIs to get attachments and their contents from messages and appointments in Outlook. The following table lists these attachment APIs, the Outlook modes they operate in, and the minimum Mailbox requirement set they need to operate.

ノ **Expand table**

| API                                                   | Supported<br>Outlook modes | Minimum<br>requirement set |
|-------------------------------------------------------|----------------------------|----------------------------|
| Office.context.mailbox.item.attachments               | Read                       | 1.1                        |
| Office.context.mailbox.item.getAttachmentsAsync       | Compose                    | 1.8                        |
| Office.context.mailbox.item.getAttachmentContentAsync | Read<br>Compose            | 1.8                        |

If the Outlook client in which the add-in is running doesn't support the needed minimum requirement set, you can get an attachment and its contents directly from Exchange instead. Select the tab for the applicable Exchange environment.

| Exchange Online |  |  |  |  |  |  |
|-----------------|--|--|--|--|--|--|
|                 |  |  |  |  |  |  |

In Exchange Online environments, your add-in must perform the following steps to get attachments directly from Exchange.

- 1. Get an access token to [Microsoft Graph](https://learn.microsoft.com/en-us/graph/overview).
- 2. Get the item ID of the applicable message or appointment.
- 3. Use Microsoft Graph to get the attachment and its properties.

Each step is covered in the following sections.

### **Get an access token**

Microsoft Graph provides access to users' Outlook mail data. Before your add-in can obtain data from Microsoft Graph, it must first get an access token for authorization. To get an access token, use nested app authentication (NAA). To learn 

{410}------------------------------------------------

more about NAA, see Enable SSO in an Office Add-in using nested app authentication (preview).

# **Get the item ID of the mail item**

To get information about an attachment using Microsoft Graph, you need the item ID of the message or appointment that includes the attachment. Use the applicable Office JavaScript API to get the item ID.

- **Read mode**: Call [Office.context.mailbox.item.itemId.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties) On non-mobile Outlook clients, because this property returns an ID formatted for Exchange Web Services (EWS), you must use the [Office.context.mailbox.convertToRestId](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox#outlook-office-mailbox-converttorestid-member(1)) method to convert the ID into a REST format that Microsoft Graph can use.

```
JavaScript
// Get the item ID of the current mail item in read mode and
convert it into a REST format.
const itemId = Office.context.mailbox.item.itemId;
const restId = Office.context.mailbox.convertToRestId(itemId,
Office.MailboxEnums.RestVersion.v2_0);
```
- **Compose mode**: The method to get the item ID varies depending on whether the mail item has been saved as a draft.
	- If the item has been saved, call [Office.context.mailbox.item.getItemIdAsync.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods)

```
JavaScript
// Get the item ID of the current mail item being composed.
Office.context.mailbox.item.getItemIdAsync((result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.error(result.error.message);
 return;
 }
 const itemId = result.value;
});
```
#### **Tip**

The getItemIdAsync method was introduced in Mailbox requirement set 1.8. If the Outlook client in which your add-in is running doesn't

{411}------------------------------------------------

support Mailbox 1.8, use Office.context.mailbox.item.saveAsync instead as this method was introduced in Mailbox 1.3.

- If the item hasn't been saved yet, call [Office.context.mailbox.item.saveAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods) to initiate the save and get the item ID.

```
JavaScript
// Save the current mail item being composed to get its ID.
Office.context.mailbox.item.saveAsync((result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 console.error(result.error.message);
 return;
 }
 const itemId = result.value;
});
```
#### 7 **Note**

If your Outlook client is in cached mode, it may take some time for the saved item to sync to the server. Until the item is synced, using the item ID will return an error.

# **Use Microsoft Graph**

Once you've obtained an access token and the item ID of the mail item containing the attachment, you can now make a Microsoft Graph request. For information and examples on how to get an attachment using Microsoft Graph, see [Get attachment.](https://learn.microsoft.com/en-us/graph/api/attachment-get)

# **See also**

- Create Outlook add-ins for read forms
- Manage an item's attachments in a compose form in Outlook
- [Office Add-in sample: Single Sign-On(SSO) in an Outlook add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Outlook-Add-in-SSO)
- [Use the Microsoft Graph API](https://learn.microsoft.com/en-us/graph/use-the-api)
- [Explore the EWS Managed API, EWS, and web services in Exchange](https://learn.microsoft.com/en-us/exchange/client-developer/exchange-web-services/explore-the-ews-managed-api-ews-and-web-services-in-exchange)
- [Get started with EWS Managed API client applications](https://learn.microsoft.com/en-us/exchange/client-developer/exchange-web-services/get-started-with-ews-managed-api-client-applications)

{412}------------------------------------------------

# **Create Outlook add-ins for compose forms**

Article • 10/15/2024

You can create compose add-ins, which are Outlook add-ins activated in compose forms. In contrast with read add-ins (Outlook add-ins that are activated in read mode when a user is viewing a message or appointment), compose add-ins are available in the following user scenarios.

- Composing a new message, meeting request, or appointment in a compose form.
- Viewing or editing an existing appointment, or meeting item in which the user is the organizer.
- Composing an inline response message or replying to a message in a separate compose form.
- Editing a response (**Accept**, **Tentative**, or **Decline**) to a meeting request or meeting item.
- Proposing a new time for a meeting item.
- Forwarding or replying to a meeting request or meeting item.

In each of these scenarios, any add-in command buttons defined by the add-in are shown in compose form.

| 第 00 9 0 个 ↓ · United · Message (HTML) |                                            |                             |                                                     |                          | P Search the menus and more       |                              |                          |                                |                     |                                       |                                               |                                     |                  |                                                                                         |
|----------------------------------------|--------------------------------------------|-----------------------------|-----------------------------------------------------|--------------------------|-----------------------------------|------------------------------|--------------------------|--------------------------------|---------------------|---------------------------------------|-----------------------------------------------|-------------------------------------|------------------|-----------------------------------------------------------------------------------------|
| Message<br>For                         | Insert<br>Options Format Text              | Review Help                 |                                                     |                          |                                   |                              |                          |                                |                     |                                       |                                               |                                     |                  |                                                                                         |
| பு:<br>ੀ<br>Clipboard for              | 同日十世,世 · ·<br>6-4-1533<br>Basic Text<br>To | នៅរ៍<br>Book Names<br>Names | Attach File +<br>Oblick +<br>Signature =<br>Include | cimponent<br>Collaborate | 13<br>Assister<br>Poley =<br>tags | 2<br>Dichally<br>e<br>Triple | 23<br>11<br>Apps<br>Appl | 2<br>Sensibility<br>Sendlivily | E<br>1.400<br>Canad | 1<br>Innership<br>Resder<br>Materchip | 15<br>Pulstus<br>Scheduling Poll<br>Find Time | ల్స్<br>Viva<br>ImpigMats<br>Addrin | 12<br>Coder, Ron | C Help<br>10<br>Company<br>Reference Docs<br>Tuesdal<br>Ack the Community<br>Script Lab |
| De<br>Sand                             | Cc<br>Subject                              |                             |                                                     |                          |                                   |                              |                          |                                |                     |                                       |                                               |                                     |                  |                                                                                         |

# **Types of add-ins available in compose mode**

Compose add-ins are implemented as add-in commands. To activate add-ins for composing email or meeting responses, add-ins include a [MessageComposeCommandSurface extension point element](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#messagecomposecommandsurface) in the manifest. To activate add-ins for composing or editing appointments or meetings where the user is the organizer, add-ins include a [AppointmentOrganizerCommandSurface extension point](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#appointmentorganizercommandsurface) [element](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#appointmentorganizercommandsurface). For more information on manifests, see Office Add-in manifests.

{413}------------------------------------------------

#### 7 **Note**

Add-ins developed for servers or clients that don't support add-in commands define activation rules using the **[Rule](https://learn.microsoft.com/en-us/javascript/api/manifest/rule)** element contained in the **[OfficeApp](https://learn.microsoft.com/en-us/javascript/api/manifest/officeapp)** element. Unless the add-in is being specifically developed for older clients and servers, new add-ins should use add-in commands.

Add-ins that use activation rules aren't supported in an add-in that uses a **Unified manifest for Microsoft 365**.

### **API features available to compose add-ins**

- Add and remove attachments to an item in a compose form in Outlook
- Get, set, or add recipients when composing an appointment or message in Outlook
- Get or set the subject when composing an appointment or message in Outlook
- Insert data in the body when composing an appointment or message in Outlook
- Get or set the location when composing an appointment in Outlook
- Get or set the time when composing an appointment in Outlook
- Manage the sensitivity label of your message or appointment in compose mode
- Manage the delivery date and time of a message

# **See also**

- Get Started with Outlook add-ins for Office

{414}------------------------------------------------

# **Manage an item's attachments in a compose form in Outlook**

Article • 03/12/2025

The Office JavaScript API provides several APIs to manage an item's attachments when the user is composing a message or appointment.

# **Attach a file or Outlook item**

Attach a file or Outlook item to a compose form by using the method that's appropriate for the type of attachment.

- [addFileAttachmentAsync:](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods) Attach a file.
#### 7 **Note**

The addFileAttachmentAsync method was introduced in **[requirement set 1.1](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.1/outlook-requirement-set-1.1)** for Outlook on Windows (classic) and on Mac. Support for addFileAttachmentAsync in Outlook on the web and new Outlook on Windows was introduced in **[requirement set 1.8](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.8/outlook-requirement-set-1.8)**.

- [addFileAttachmentFromBase64Async:](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods) Attach a file using its Base64-encoded string.
- [addItemAttachmentAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods): Attach an Outlook item.

These are asynchronous methods, which means execution can go on without waiting for the action to complete. Depending on the original location and size of the attachment being added, the asynchronous call may take a while to complete.

If there are tasks that depend on the action to complete, you should carry out those tasks in a callback function. This callback function is optional and is invoked when the attachment upload has completed. The callback function takes an [AsyncResult](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult) object as an output parameter that provides any status, error, and returned value from adding the attachment. If the callback requires any extra parameters, you can specify them in the optional options.asyncContext parameter. options.asyncContext can be of any type that your callback function expects.

For example, you can define options.asyncContext as a JSON object that contains one or more key-value pairs. For more examples about passing optional parameters to asynchronous methods in the Office Add-ins platform, see Asynchronous programming 

{415}------------------------------------------------

in Office Add-ins. The following example shows how to use the asyncContext parameter to pass two arguments to a callback function.

```
JavaScript
const options = { asyncContext: { var1: 1, var2: 2 } };
Office.context.mailbox.item.addFileAttachmentAsync("https://contoso.com/rtm/
icon.png", "icon.png", options, callback);
```
To check for the outcome of an asynchronous method call in the callback function, use the status and error properties of the AsyncResult object. If the attaching completes successfully, use the AsyncResult.value property to get the attachment ID. The attachment ID is an integer which you can subsequently use to remove the attachment.

#### 7 **Note**

The attachment ID is valid only within the same session and isn't guaranteed to map to the same attachment across sessions. Examples of when a session is over include when the user closes the add-in, or if the user starts composing in an inline form and subsequently pops out the inline form to continue in a separate window.

#### **Tip**

There are limits to the files or Outlook items you can attach to a mail item, such as the number of attachments and their size. For further guidance, see **Limits for JavaScript API**.

### **Attach a file**

You can attach a file to a message or appointment in a compose form by using the addFileAttachmentAsync method and specifying the URI of the file. You can also use the addFileAttachmentFromBase64Async method, specifying the Base64-encoded string as input. If the file is protected, you can include an appropriate identity or authentication token as a URI query string parameter. Exchange will make a call to the URI to get the attachment, and the web service which protects the file will need to use the token as a means of authentication.

{416}------------------------------------------------

- The URI of the file to be attached must support caching in production. The server hosting the image shouldn't return a Cache-Control header that specifies no-cache , no-store , or similar options in the HTTP response. However, when you're developing the add-in and making changes to files, caching can prevent you from seeing your changes. We recommend using Cache-Control headers during development.
- The addFileAttachmentAsync method doesn't support bitmap (BMP) images if they're added as inline attachments.

The following JavaScript example is a compose add-in that attaches a file, **picture.png**, from a web server to the message or appointment being composed. The callback function takes asyncResult as a parameter, checks for the result status, and gets the attachment ID if the method succeeds.

```
JavaScript
```

```
// Add the specified file attachment to the item
// being composed.
// When the attachment finishes uploading, the
// callback function is invoked and gets the attachment ID.
// You can optionally pass any object that you would
// access in the callback function as an argument to
// the asyncContext parameter.
Office.context.mailbox.item.addFileAttachmentAsync(
 "https://webserver/picture.png",
 "picture.png",
 { asyncContext: { var1: 1, var2: 2 } },
 (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.error(asyncResult.error.message);
 return;
 }
 // Get the ID of the attached file.
 const attachmentID = asyncResult.value;
 console.log(`ID of added attachment: ${attachmentID}`);
 }
);
```
To add an inline Base64-encoded image to the body of a message or appointment being composed, use the [Body API](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body) methods, such as [prependAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body#outlook-office-body-prependasync-member(1)), [setSignatureAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body#outlook-office-body-setsignatureasync-member(1)), or [setAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body#outlook-office-body-setasync-member(1)).

{417}------------------------------------------------

Before inserting the image inline using

Office.context.mailbox.item.body.setAsync , you must first call Office.context.mailbox.item.body.getAsync to get the current body of the mail item. Otherwise, the image won't render in the body once it's inserted. For guidance, see the **[Add inline Base64-encoded image to message or appointment](https://raw.githubusercontent.com/OfficeDev/office-js-snippets/refs/heads/main/samples/outlook/20-item-body/add-inline-base64-image.yaml) [body (Compose)](https://raw.githubusercontent.com/OfficeDev/office-js-snippets/refs/heads/main/samples/outlook/20-item-body/add-inline-base64-image.yaml)** sample in **Script Lab**.

The following is an example of a Base64-encoded image prepended to the body of a mail item.

JavaScript

```
const base64String =
```
"iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAMAAADVRocKAAAAAXNSR0IArs4c6QAAAARnQU1BAAC xjwv8YQUAAAAnUExURQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAN0S+bU AAAAMdFJOUwAQIDBAUI+fr7/P7yEupu8AAAAJcEhZcwAADsMAAA7DAcdvqGQAAAF8SURBVGhD7df LdoMwDEVR6Cspzf9/b20QYOthS5Zn0Z2kVdY6O2WULrFYLBaLxd5ur4mDZD14b8ogWS/dtxV+dmx 9ysA2QUj9TQRWv5D7HyKwuIW9n0vc8tkpHP0W4BOg3wQ8wtlvA+PC1e8Ao8Ld7wFjQtHvAiNC2e8 DdqHqKwCrUPc1gE1AfRVgEXBfB+gF0lcCWoH2tYBOYPpqQCNwfT3QF9i+AegJfN8CtAWhbwJagtS 3AbIg9o2AJMh9M5C+SVGBvx6zAfmT0r+Bv8JMwP4kyFPir+cswF5KL3WLv14zAFBCLf56Tw9cpar FX4upgaJUtPhrOS1QlY5W+vWTXrGgBFB/b72ev3/0igUdQPppP/nfowfKUUEFcP207y/yxKmgAYQ +PywoAFOfCH3A2MdCFzD3kdADBvq10AGG+pXQBgb7pdAEhvuF0AIc/VtoAK7+JciAs38KIuDugyA C/v4hiMCE/i7IwLRBsh68N2WQjMVisVgs9i5bln8LGScNcCrONQAAAABJRU5ErkJggg==";

```
// Add the Base64-encoded image to the beginning of the body.
Office.context.mailbox.item.addFileAttachmentFromBase64Async(base64String, 
"sample.png", { isInline: true }, (attachmentResult) => {
 if (attachmentResult.status === Office.AsyncResultStatus.Failed) {
 console.log(`Failed to attach file: 
${attachmentResult.error.message}`);
 return;
 }
 Office.context.mailbox.item.body.prependAsync('<img src="cid:sample.png"
/>', { coercionType: Office.CoercionType.Html }, (prependResult) => {
 if (prependResult.status === Office.AsyncResultStatus.Failed) {
 console.log(`Failed to prepend image to body: 
${attachmentResult.error.message}`);
 return;
 }
 console.log("Inline Base64-encoded image added to the beginning of the
body.");
 })
});
```
**Attach an Outlook item**

{418}------------------------------------------------

To attach an Outlook item (for example, email, calendar, or contact item) to a message or appointment in a compose form, specify the Exchange Web Services (EWS) ID of the item and use the addItemAttachmentAsync method. To get the EWS ID of the item, use the [item.itemId](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties) property.

The following JavaScript function, addItemAttachment , extends an earlier example, and adds an item as an attachment to the email or appointment being composed. The function takes the EWS ID of the item to be attached as an argument. If attaching succeeds, it gets the attachment ID for further processing.

JavaScript

```
// Adds the specified item as an attachment to the composed item.
// ID is the EWS ID of the item to be attached.
function addItemAttachment(itemId) {
 // When the attachment finishes uploading, the
 // callback function is invoked. Here, the callback
 // function uses only asyncResult as a parameter,
 // and if the attaching succeeds, gets the attachment ID.
 // You can optionally pass any other object you wish to
 // access in the callback function as an argument to
 // the asyncContext parameter.
 Office.context.mailbox.item.addItemAttachmentAsync(
 itemId,
 "Welcome email",
 { asyncContext: { var1: 1, var2: 2 } },
 (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.error(asyncResult.error.message);
 return;
 }
 const attachmentID = asyncResult.value;
 console.log(`ID of added attachment: ${attachmentID}`);
 }
 );
}
```
#### 7 **Note**

You can use a compose add-in to attach an instance of a recurring appointment in Outlook on the web, on mobile devices, or in **[new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** . However, in a supporting Outlook client on Windows or on Mac, attempting to attach an instance would result in attaching the recurring series (the parent appointment).

{419}------------------------------------------------

# **Get attachments**

The following APIs to get attachments in compose mode are available from [requirement](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.8/outlook-requirement-set-1.8) [set 1.8.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.8/outlook-requirement-set-1.8)

- [getAttachmentsAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods)
- [getAttachmentContentAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods)

Use the [getAttachmentsAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods) method to get the attachments of the message or appointment being composed.

#### 7 **Note**

In Outlook on the web and the new Outlook on Windows, users can select the **Upload and share** option to upload an attachment to OneDrive and include a link to the file in the mail item. However, since only a link is included, getAttachmentsAsync doesn't return this type of attachment.

To get an attachment's content, use the [getAttachmentContentAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods) method. The supported formats are listed in the [AttachmentContentFormat](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxenums.attachmentcontentformat) enum.

You should provide a callback function to check for the status and any error by using the AsyncResult output parameter object. You can also pass any additional parameters to the callback function by using the optional asyncContext parameter.

The following JavaScript example gets the attachments and allows you to set up distinct handling for each supported attachment format.

#### JavaScript const item = Office.context.mailbox.item; const options = { asyncContext: { currentItem: item } }; item.getAttachmentsAsync(options, callback); function callback(result) { if (result.value.length > 0) { for (let i = 0 ; i < result.value.length ; i++) { result.asyncContext.currentItem.getAttachmentContentAsync(result.value[i].id , handleAttachmentsCallback); } } } function handleAttachmentsCallback(result) { // Parse string to be a url, an .eml file, a Base64-encoded string, or an

{420}------------------------------------------------

```
.icalendar file.
 switch (result.value.format) {
 case Office.MailboxEnums.AttachmentContentFormat.Base64:
 // Handle file attachment.
 break;
 case Office.MailboxEnums.AttachmentContentFormat.Eml:
 // Handle email item attachment.
 break;
 case Office.MailboxEnums.AttachmentContentFormat.ICalendar:
 // Handle .icalender attachment.
 break;
 case Office.MailboxEnums.AttachmentContentFormat.Url:
 // Handle cloud attachment.
 break;
 default:
 // Handle attachment formats that are not supported.
 }
}
```
#### **Tip**

If the Outlook client in which your add-in is running doesn't support Mailbox requirement set 1.8, you can still get an attachment and its contents from an item being composed using Microsoft Graph or EWS. To learn more, see **Get an Outlook item's attachments from Exchange**.

### **Remove an attachment**

To remove a file or item attachment from a message or appointment item in a compose form, specify the corresponding attachment ID in the [removeAttachmentAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#methods) method.

#### ) **Important**

If you're using requirement set 1.7 or earlier, you should only remove attachments that the same add-in has added in the same session.

Similar to the addFileAttachmentAsync , addItemAttachmentAsync , and getAttachmentsAsync methods, removeAttachmentAsync is an asynchronous method. You should provide a callback function to check for the status and any error by using the AsyncResult output parameter object. You can also pass any additional parameters to the callback function by using the optional asyncContext parameter.

{421}------------------------------------------------

The following JavaScript function, removeAttachment , continues to extend the examples above, and removes the specified attachment from the email or appointment being composed. The function takes as an argument the ID of the attachment to be removed. You can obtain the ID of an attachment after a successful addFileAttachmentAsync , addFileAttachmentFromBase64Async , or addItemAttachmentAsync method call, and use it in a subsequent removeAttachmentAsync method call. You can also call getAttachmentsAsync (introduced in requirement set 1.8) to get the attachments and their IDs for that add-in session.

```
JavaScript
// Removes the specified attachment from the composed item.
function removeAttachment(attachmentId) {
 // When the attachment is removed, the callback function is invoked.
 // Here, the callback function uses an asyncResult parameter and
 // gets the ID of the removed attachment if the removal succeeds.
 // You can optionally pass any object you wish to access in the
 // callback function as an argument to the asyncContext parameter.
 Office.context.mailbox.item.removeAttachmentAsync(
 attachmentId,
 { asyncContext: null },
 (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.error(asyncResult.error.message);
 return;
 }
 console.log(`Removed attachment with the ID: 
${asyncResult.value}`);
 }
 );
}
```
#### **Tip**

The removeAttachmentAsync method doesn't remove inline attachments from a mail item. To remove an inline attachment, first get the item's body, then remove any references of the attachment from its contents. Use the **[Office.Body](https://learn.microsoft.com/en-us/javascript/api/outlook/office.body)** APIs to get and set the body of an item.

# **See also**

- Get an Outlook item's attachments from Exchange
- Create Outlook add-ins for compose forms

{422}------------------------------------------------

- Asynchronous programming in Office Add-ins
- Limits for activation and JavaScript API for Outlook add-ins

{423}------------------------------------------------

# **Get, set, or add recipients when composing an appointment or message in Outlook**

09/09/2025

The Office JavaScript API provides asynchronous methods ([Recipients.getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients#outlook-office-recipients-getasync-member(1)), [Recipients.setAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients#outlook-office-recipients-setasync-member(1)), or [Recipients.addAsync)](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients#outlook-office-recipients-addasync-member(1)) to respectively get, set, or add recipients to a compose form of an appointment or message. These asynchronous methods are available to only compose add-ins. To use these methods, make sure you have set up the add-in manifest appropriately for Outlook to activate the add-in in compose forms, as described in Create Outlook add-ins for compose forms.

Some of the properties that represent recipients in an appointment or message are available for read access in a compose form and in a read form. These properties include [optionalAttendees](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties) and [requiredAttendees](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties) for appointments, and [cc](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties), and [to](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties) for messages.

In a read form, you can access the property directly from the parent object, such as:

JavaScript

Office.context.mailbox.item.cc;

But in a compose form, because both the user and your add-in can be inserting or changing a recipient at the same time, you must use the asynchronous method getAsync to get these properties, as in the following example.

```
JavaScript
Office.context.mailbox.item.cc.getAsync(callback);
```
These properties are available for write access in only compose forms, and not read forms.

As with most asynchronous methods in the JavaScript API for Office, getAsync , setAsync , and addAsync take optional input parameters. For more information on how to specify these optional input parameters, see "Passing optional parameters to asynchronous methods" in Asynchronous programming in Office Add-ins.

# **Get recipients**

This section shows a code sample that gets the recipients of the appointment or message that is being composed, and displays the email addresses of the recipients.

{424}------------------------------------------------

In the Office JavaScript API, because the properties that represent the recipients of an appointment ( optionalAttendees and requiredAttendees ) are different from those of a message ([bcc](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messagecompose#outlook-office-messagecompose-bcc-member), cc , and to ), you should first use the [item.itemType](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties) property to identify whether the item being composed is an appointment or message. In compose mode, all these properties of appointments and messages are [Recipients](https://learn.microsoft.com/en-us/javascript/api/outlook/office.recipients) objects, so you can then call the asynchronous method, Recipients.getAsync , to get the corresponding recipients.

To use getAsync , provide a callback function to check for the status, results, and any error returned by the asynchronous getAsync call. The callback function returns an [asyncResult](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult) output parameter. Use its status and error properties to check for the status and any error messages of the asynchronous call, and its value property to get the actual recipients. Recipients are represented as an array of [EmailAddressDetails](https://learn.microsoft.com/en-us/javascript/api/outlook/office.emailaddressdetails) objects. You can also provide additional information to the callback function using the optional asyncContext parameter in the getAsync call.

Note that because the getAsync method is asynchronous, if there are subsequent actions that depend on successfully getting the recipients, you should organize your code to start such actions only in the corresponding callback function when the asynchronous call has successfully completed.

#### ) **Important**

The getAsync method only returns recipients resolved by the Outlook client. A resolved recipient has the following characteristics.

- If the recipient has a saved entry in the sender's address book, Outlook resolves the email address to the recipient's saved display name.
- A Teams meeting status icon appears before the recipient's name or email address.
- A semicolon appears after the recipient's name or email address.
- The recipient's name or email address is underlined or enclosed in a box.

To resolve an email address once it's added to a mail item, the sender must use the Tab key or select a suggested contact or email address from the auto-complete list.

In Outlook on the web and on Windows (**[new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** and classic), if a user creates a new message by selecting a contact's email address link from a contact or profile card, they must first resolve the email address so that it can be included in the results of the getAsync call.

{425}------------------------------------------------

```
let item;
// Confirms that the Office.js library is loaded.
Office.onReady((info) => {
 if (info.host === Office.HostType.Outlook) {
 item = Office.context.mailbox.item;
 getAllRecipients();
 }
});
// Gets the email addresses of all the recipients of the item being composed.
function getAllRecipients() {
 let toRecipients, ccRecipients, bccRecipients;
 // Verify if the mail item is an appointment or message.
 if (item.itemType === Office.MailboxEnums.ItemType.Appointment) {
 toRecipients = item.requiredAttendees;
 ccRecipients = item.optionalAttendees;
 }
 else {
 toRecipients = item.to;
 ccRecipients = item.cc;
 bccRecipients = item.bcc;
 }
 // Get the recipients from the To or Required field of the item being
composed.
 toRecipients.getAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 write(asyncResult.error.message);
 return;
 }
 // Display the email addresses of the recipients or attendees.
 write(`Recipients in the To or Required field: 
${displayAddresses(asyncResult.value)}`);
 });
 // Get the recipients from the Cc or Optional field of the item being
composed.
 ccRecipients.getAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 write(asyncResult.error.message);
 return;
 }
 // Display the email addresses of the recipients or attendees.
 write(`Recipients in the Cc or Optional field: 
${displayAddresses(asyncResult.value)}`);
 });
 // Get the recipients from the Bcc field of the message being composed, if
applicable.
 if (bccRecipients.length > 0) {
```

{426}------------------------------------------------

```
 bccRecipients.getAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 write(asyncResult.error.message);
 return;
 }
 // Display the email addresses of the recipients.
 write(`Recipients in the Bcc field: 
${displayAddresses(asyncResult.value)}`);
 });
 } else {
 write("Recipients in the Bcc field: None");
 }
}
// Displays the email address of each recipient.
function displayAddresses (recipients) {
 for (let i = 0; i < recipients.length; i++) {
 write(recipients[i].emailAddress);
 }
}
// Writes to a div with id="message" on the page.
function write(message) {
 document.getElementById("message").innerText += message;
}
```
# **Set recipients**

This section shows a code sample that sets the recipients of the appointment or message that is being composed by the user. Setting recipients overwrites any existing recipients. This example first verifies if the mail item is an appointment or message, so that it can call the asynchronous method, Recipients.setAsync , on the appropriate properties that represent recipients of the appointment or message.

When calling setAsync , provide an array as the input argument for the recipients parameter, in one of the following formats.

- An array of strings that are SMTP addresses.
- An array of dictionaries, each containing a display name and email address, as shown in the following code sample.
- An array of EmailAddressDetails objects, similar to the one returned by the getAsync method.

You can optionally provide a callback function as an input argument to the setAsync method, to make sure any code that depends on successfully setting the recipients would execute only when that happens. If you implement a callback function, use the status and error properties 

{427}------------------------------------------------

of the asyncResult output parameter to check the status and any error messages of the asynchronous call. To provide additional information to the callback function, use the optional asyncContext parameter in the setAsync call.

#### 7 **Note**

In Outlook on mobile devices, be mindful of the following:

- The setAsync method is supported starting in Version 4.2530.0.
- The setAsync method isn't supported when a user replies from the reply field at the bottom of a message.

```
JavaScript
let item;
// Confirms that the Office.js library is loaded.
Office.onReady((info) => {
 if (info.host === Office.HostType.Outlook) {
 item = Office.context.mailbox.item;
 setRecipients();
 }
});
// Sets the recipients of the item being composed.
function setRecipients() {
 let toRecipients, ccRecipients, bccRecipients;
 // Verify if the mail item is an appointment or message.
 if (item.itemType === Office.MailboxEnums.ItemType.Appointment) {
 toRecipients = item.requiredAttendees;
 ccRecipients = item.optionalAttendees;
 }
 else {
 toRecipients = item.to;
 ccRecipients = item.cc;
 bccRecipients = item.bcc;
 }
 // Set the recipients in the To or Required field of the item being composed.
 toRecipients.setAsync(
 [{
 "displayName": "Graham Durkin", 
 "emailAddress": "graham@contoso.com"
 },
 {
 "displayName": "Donnie Weinberg",
 "emailAddress": "donnie@contoso.com"
 }],
 (asyncResult) => {
```

{428}------------------------------------------------

```
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(asyncResult.error.message);
 return;
 }
 console.log("Successfully set the recipients in the To or Required
field.");
 // Run additional operations appropriate to your scenario.
 });
 // Set the recipients in the Cc or Optional field of the item being composed.
 ccRecipients.setAsync(
 [{
 "displayName": "Perry Horning", 
 "emailAddress": "perry@contoso.com"
 },
 {
 "displayName": "Guy Montenegro",
 "emailAddress": "guy@contoso.com"
 }],
 (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(asyncResult.error.message);
 return;
 }
 console.log("Successfully set the recipients in the Cc or Optional
field.");
 // Run additional operations appropriate to your scenario.
 });
 // Set the recipients in the Bcc field of the message being composed.
 if (bccRecipients) {
 bccRecipients.setAsync(
 [{
 "displayName": "Lewis Cate", 
 "emailAddress": "lewis@contoso.com"
 },
 {
 "displayName": "Francisco Stitt",
 "emailAddress": "francisco@contoso.com"
 }],
 (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(asyncResult.error.message);
 return;
 }

 console.log("Successfully set the recipients in the Bcc field.");
 // Run additional operations appropriate to your scenario.
 });
 }
}
```

{429}------------------------------------------------

# **Add recipients**

If you don't want to overwrite any existing recipients in an appointment or message, instead of using Recipients.setAsync , use the Recipients.addAsync asynchronous method to append recipients. addAsync works similarly as setAsync in that it requires a recipients input argument. You can optionally provide a callback function, and any arguments for the callback using the asyncContext parameter. Then, check the status, result, and any error of the asynchronous addAsync call using the asyncResult output parameter of the callback function. The following example checks if the item being composed is an appointment, then appends two required attendees to it.

#### 7 **Note**

In Outlook on mobile devices, be mindful of the following:

- The addAsync method is supported starting in Version 4.2530.0.
- The addAsync method isn't supported when a user replies from the reply field at the bottom of a message.

```
JavaScript
```

```
let item;
// Confirms that the Office.js library is loaded.
Office.onReady((info) => {
 if (info.host === Office.HostType.Outlook) {
 item = Office.context.mailbox.item;
 addAttendees();
 }
});
// Adds the specified recipients as required attendees of the appointment.
function addAttendees() {
 if (item.itemType === Office.MailboxEnums.ItemType.Appointment) {
 item.requiredAttendees.addAsync(
 [{
 "displayName": "Kristie Jensen",
 "emailAddress": "kristie@contoso.com"
 },
 {
 "displayName": "Pansy Valenzuela",
 "emailAddress": "pansy@contoso.com"
 }],
 (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(asyncResult.error.message);
 return;
```

{430}------------------------------------------------

```
 }
 console.log("Successfully added the required attendees.");
 // Run additional operations appropriate to your scenario.
 });
 }
}
```
# **See also**

- Create Outlook add-ins for compose forms
- Asynchronous programming in Office Add-ins
- Get or set the subject when composing an appointment or message in Outlook
- Insert data in the body when composing an appointment or message in Outlook
- Get or set the location when composing an appointment in Outlook
- Get or set the time when composing an appointment in Outlook

{431}------------------------------------------------

# **Get or set the subject when composing an appointment or message in Outlook**

Article • 10/15/2024

The Office JavaScript API provides asynchronous methods ([subject.getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.subject#outlook-office-subject-getasync-member(1)) and [subject.setAsync)](https://learn.microsoft.com/en-us/javascript/api/outlook/office.subject#outlook-office-subject-setasync-member(1)) to get and set the subject of an appointment or message that the user is composing. These asynchronous methods are available only to compose add-ins. To use these methods, make sure you have set up the add-in only manifest appropriately for Outlook to activate the add-in in compose forms.

The subject property is available for read access in both compose and read forms of appointments and messages. In a read form, access the property directly from the parent object, as in:

```
JavaScript
```

```
Office.context.mailbox.item.subject;
```
But in a compose form, because both the user and your add-in can be inserting or changing the subject at the same time, you must use the getAsync method to get the subject asynchronously.

JavaScript

Office.context.mailbox.item.subject.getAsync(callback);

The subject property is available for write access in only compose forms and not in read forms.

#### **Tip**

To temporarily set the content displayed in the subject of a message in read mode, use **[Office.context.mailbox.item.display.subject (preview)](https://learn.microsoft.com/en-us/javascript/api/outlook/office.display?view=outlook-js-preview&preserve-view=true#outlook-office-display-subject-member)**.

As with most asynchronous methods in the Office JavaScript API, getAsync and setAsync take optional input parameters. For more information on how to specify these optional input parameters, see "Passing optional parameters to asynchronous methods" in Asynchronous programming in Office Add-ins.

{432}------------------------------------------------

# **Get the subject**

This section shows a code sample that gets the subject of the appointment or message that the user is composing, and displays the subject.

To use item.subject.getAsync , provide a callback function that checks for the status and result of the asynchronous call. You can provide any necessary arguments to the callback function through the optional asyncContext parameter. To obtain the status, results, and any error from the callback function, use the asyncResult output parameter of the callback. If the asynchronous call is successful, use the [AsyncResult.value](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult#office-office-asyncresult-value-member) property to get the subject as a plain text string.

```
JavaScript
let item;
// Confirms that the Office.js library is loaded.
Office.onReady((info) => {
 if (info.host === Office.HostType.Outlook) {
 item = Office.context.mailbox.item;
 getSubject();
 }
});
// Gets the subject of the item that the user is composing.
function getSubject() {
 item.subject.getAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 write(asyncResult.error.message);
 return;
 }
 // Display the subject on the page.
 write(`The subject is: ${asyncResult.value}`);
 });
}
// Writes to a div with id="message" on the page.
function write(message) {
 document.getElementById("message").innerText += message; 
}
```
# **Set the subject**

This section shows a code sample that sets the subject of the appointment or message that the user is composing.

{433}------------------------------------------------

To use item.subject.setAsync , specify a string of up to 255 characters in the data parameter. Optionally, you can provide a callback function and any arguments for the callback function in the asyncContext parameter. Check the callback status, result, and any error message in the asyncResult output parameter of the callback. If the asynchronous call is successful, setAsync inserts the specified subject string as plain text, overwriting any existing subject for that item.

```
JavaScript
let item;
// Confirms that the Office.js library is loaded.
Office.onReady((info) => {
 if (info.host === Office.HostType.Outlook) {
 item = Office.context.mailbox.item;
 setSubject();
 }
});
// Sets the subject of the item that the user is composing.
function setSubject() {
 // Customize the subject with today's date.
 const today = new Date();
 const subject = `Summary for ${today.toLocaleDateString()}`;
 item.subject.setAsync(
 subject,
 { asyncContext: { optionalVariable1: 1, optionalVariable2: 2 } },
 (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 write(asyncResult.error.message);
 return;
 }
 /*
 The subject was successfully set.
 Run additional operations appropriate to your scenario and
 use the optionalVariable1 and optionalVariable2 values as
needed.
 */
 });
}
// Writes to a div with id="message" on the page.
function write(message) {
 document.getElementById("message").innerText += message; 
}
```
**See also**

{434}------------------------------------------------

- Create Outlook add-ins for compose forms
- Asynchronous programming in Office Add-ins
- Get, set, or add recipients when composing an appointment or message in Outlook
- Insert data in the body when composing an appointment or message in Outlook
- Get or set the location when composing an appointment in Outlook
- Get or set the time when composing an appointment in Outlook

{435}------------------------------------------------

# **Get or set the time when composing an appointment in Outlook**

Article • 08/15/2023

The Office JavaScript API provides asynchronous methods ([Time.getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.time#outlook-office-time-getasync-member(1)) and [Time.setAsync)](https://learn.microsoft.com/en-us/javascript/api/outlook/office.time#outlook-office-time-setasync-member(1)) to get and set the start or end time of an appointment being composed. These asynchronous methods are available only to compose add-ins. To use these methods, make sure you have set up the add-in only manifest of the add-in appropriately for Outlook to activate the add-in in compose forms, as described in Create Outlook add-ins for compose forms.

The [start](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties) and [end](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties) properties are available for appointments in both compose and read forms. In a read form, you can access the properties directly from the parent object, as in:

JavaScript

```
Office.context.mailbox.item.start;
Office.context.mailbox.item.end;
```
But in a compose form, because both the user and your add-in can be inserting or changing the time at the same time, you must use the getAsync asynchronous method to get the start or end time.

```
JavaScript
Office.context.mailbox.item.start.getAsync(callback);
Office.context.mailbox.item.end.getAsync(callback);
```
As with most asynchronous methods in the Office JavaScript API, getAsync and setAsync take optional input parameters. For more information on how to specify these optional input parameters, see "Passing optional parameters to asynchronous methods" in Asynchronous programming in Office Add-ins.

# **Get the start or end time**

This section shows a code sample that gets the start time of the appointment being composed and displays the time. You can use the same code, but replace the start property with the end property to get the end time.

{436}------------------------------------------------

To use the item.start.getAsync or item.end.getAsync methods, provide a callback function that checks the status and result of the asynchronous call. Obtain the status, results, and any error using the [asyncResult](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult) output parameter of the callback. If the asynchronous call is successful, use the asyncResult.value property to get the start time as a Date object in UTC format. To provide any necessary arguments to the callback function, use the asyncContext optional parameter of the getAsync call.

```
JavaScript
let item;
// Confirms that the Office.js library is loaded.
Office.onReady((info) => {
 if (info.host === Office.HostType.Outlook) {
 item = Office.context.mailbox.item;
 getStartTime();
 }
});
// Gets the start time of the appointment being composed.
function getStartTime() {
 item.start.getAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 write(asyncResult.error.message);
 return;
 }
 // Display the start time in UTC format on the page.
 write(`The start time in UTC is: ${asyncResult.value.toString()}`);
 // Convert the start time to local time and display it on the page.
 write(`The start time in local time is: 
${asyncResult.value.toLocaleString()}`);
 });
}
// Writes to a div with id="message" on the page.
function write(message) {
 document.getElementById("message").innerText += message;
}
```
### **Set the start or end time**

This section shows a code sample that sets the start time of an appointment being composed. You can use the same code, but replace the start property with the end property to set the end time. Note that changes to the start or end properties may affect other properties of the appointment being composed.

{437}------------------------------------------------

- If the appointment being composed already has an existing start time, setting the start time subsequently adjusts the end time to maintain any previous duration of the appointment.
- If the appointment being composed already has an existing end time, setting the end time subsequently adjusts both the duration and end time.
- If the appointment has been set as an all-day event, setting the start time adjusts the end time to 24 hours later, and clears the checkbox for the all-day event in the appointment.

To use item.start.setAsync or item.end.setAsync , specify a UTC-formatted Date object in the dateTime parameter. If you get a date based on an input by the user in the client, you can use [mailbox.convertToUtcClientTime](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox#outlook-office-mailbox-converttoutcclienttime-member(1)) to convert the value to a Date object in the UTC format. If you provide an optional callback function, include the asyncContext parameter and add any arguments to it. Additionally, check the status, result, and any error message through the asyncResult output parameter of the callback. If the asynchronous call is successful, setAsync inserts the specified start or end time string as plain text, overwriting any existing start or end time for that item.

#### 7 **Note**

In classic Outlook on Windows, the setAsync method can't be used to change the start or end time of a recurring appointment.

#### JavaScript

```
let item;
// Confirms that the Office.js library is loaded.
Office.onReady((info) => {
 if (info.host === Office.HostType.Outlook) {
 item = Office.context.mailbox.item;
 setStartTime();
 }
});
// Sets the start time of the appointment being composed.
function setStartTime() {
 // Get the current date and time, then add two days to the date.
 const startDate = new Date();
 startDate.setDate(startDate.getDate() + 2);
 item.start.setAsync(
 startDate,
 { asyncContext: { optionalVariable1: 1, optionalVariable2: 2 } },
 (asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
```

{438}------------------------------------------------

```
 console.log(asyncResult.error.message);
 return;
 }
 console.log("Successfully set the start time.");
 /*
 Run additional operations appropriate to your scenario and
 use the optionalVariable1 and optionalVariable2 values as
needed.
 */
 });
}
```
# **See also**

- Create Outlook add-ins for compose forms
- Asynchronous programming in Office Add-ins
- Get, set, or add recipients when composing an appointment or message in Outlook
- Get or set the subject when composing an appointment or message in Outlook
- Insert data in the body when composing an appointment or message in Outlook
- Get or set the location when composing an appointment in Outlook

{439}------------------------------------------------

# **Get or set the location when composing an appointment in Outlook**

Article • 04/12/2024

The Office JavaScript API provides properties and methods to manage the location of an appointment that the user is composing. Currently, there are two properties that provide an appointment's location:

- [item.location](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties): Basic API that allows you to get and set the location.
- [item.enhancedLocation:](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox.item#properties) Enhanced API that allows you to get and set the location, and includes specifying the [location type.](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxenums.locationtype) The type is LocationType.Custom if you set the location using item.location .

The following table lists the location APIs and the modes (i.e., Compose or Read) where they are available.

ノ **Expand table**

| API                               | Applicable appointment modes        |
|-----------------------------------|-------------------------------------|
| item.location                     | Attendee/Read                       |
| item.location.getAsync            | Organizer/Compose                   |
| item.location.setAsync            | Organizer/Compose                   |
| item.enhancedLocation.getAsync    | Organizer/Compose,<br>Attendee/Read |
| item.enhancedLocation.addAsync    | Organizer/Compose                   |
| item.enhancedLocation.removeAsync | Organizer/Compose                   |

To use the methods that are available only to compose add-ins, configure the add-in only manifest to activate the add-in in Organizer/Compose mode. See Create Outlook add-ins for compose forms for more details. Activation rules aren't supported in add-ins that use a Unified manifest for Microsoft 365.

### **Use the enhancedLocation API**

You can use the enhancedLocation API to get and set an appointment's location. The location field supports multiple locations and, for each location, you can set the display 

{440}------------------------------------------------

name, type, and conference room email address (if applicable). See [LocationType](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxenums.locationtype) for supported location types.

### **Add location**

The following example shows how to add a location by calling [addAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.enhancedlocation#outlook-office-enhancedlocation-addasync-member(1)) on [mailbox.item.enhancedLocation](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentcompose#outlook-office-appointmentcompose-enhancedlocation-member).

```
JavaScript
let item;
const locations = [
 {
 "id": "Contoso",
 "type": Office.MailboxEnums.LocationType.Custom
 }
];
Office.initialize = function () {
 item = Office.context.mailbox.item;
 // Check for the DOM to load using the jQuery ready method.
 $(document).ready(function () {
 // After the DOM is loaded, app-specific code can run.
 // Add to the location of the item being composed.
 item.enhancedLocation.addAsync(locations);
 });
}
```
### **Get location**

The following example shows how to get the location by calling [getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.enhancedlocation#outlook-office-enhancedlocation-getasync-member(1)) on [mailbox.item.enhancedLocation](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentread#outlook-office-appointmentread-enhancedlocation-member).

```
JavaScript
let item;
Office.initialize = function () {
 item = Office.context.mailbox.item;
 // Checks for the DOM to load using the jQuery ready method.
 $(document).ready(function () {
 // After the DOM is loaded, app-specific code can run.
 // Get the location of the item being composed.
 item.enhancedLocation.getAsync(callbackFunction);
 });
}
function callbackFunction(asyncResult) {
 asyncResult.value.forEach(function (place) {
```

{441}------------------------------------------------

```
 console.log("Display name: " + place.displayName);
 console.log("Type: " + place.locationIdentifier.type);
 if (place.locationIdentifier.type ===
Office.MailboxEnums.LocationType.Room) {
 console.log("Email address: " + place.emailAddress);
 }
 });
}
```
7 **Note**

**[Personal contact groups](https://support.microsoft.com/office/88ff6c60-0a1d-4b54-8c9d-9e1a71bc3023)** added as appointment locations aren't returned by the **[enhancedLocation.getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.enhancedlocation#outlook-office-enhancedlocation-getasync-member(1))** method.

### **Remove location**

The following example shows how to remove the location by calling [removeAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.enhancedlocation#outlook-office-enhancedlocation-removeasync-member(1)) on [mailbox.item.enhancedLocation](https://learn.microsoft.com/en-us/javascript/api/outlook/office.appointmentcompose#outlook-office-appointmentcompose-enhancedlocation-member).

```
JavaScript
let item;
Office.initialize = function () {
 item = Office.context.mailbox.item;
 // Checks for the DOM to load using the jQuery ready method.
 $(document).ready(function () {
 // After the DOM is loaded, app-specific code can run.
 // Get the location of the item being composed.
 item.enhancedLocation.getAsync(callbackFunction);
 });
}
function callbackFunction(asyncResult) {
 asyncResult.value.forEach(function (currentValue) {
 // Remove each location from the item being composed.

item.enhancedLocation.removeAsync([currentValue.locationIdentifier]);
 });
}
```
# **Use the location API**

You can use the location API to get and set an appointment's location.

{442}------------------------------------------------

### **Get the location**

This section shows a code sample that gets the location of the appointment that the user is composing, and displays the location.

To use item.location.getAsync , provide a callback function that checks for the status and result of the asynchronous call. You can provide any necessary arguments to the callback function through the asyncContext optional parameter. You can obtain status, results, and any error using the output parameter asyncResult of the callback. If the asynchronous call is successful, you can get the location as a string using the [AsyncResult.value](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult#office-office-asyncresult-value-member) property.

```
JavaScript
let item;
Office.initialize = function () {
 item = Office.context.mailbox.item;
 // Checks for the DOM to load using the jQuery ready method.
 $(document).ready(function () {
 // After the DOM is loaded, app-specific code can run.
 // Get the location of the item being composed.
 getLocation();
 });
}
// Get the location of the item that the user is composing.
function getLocation() {
 item.location.getAsync(
 function (asyncResult) {
 if (asyncResult.status == Office.AsyncResultStatus.Failed){
 write(asyncResult.error.message);
 }
 else {
 // Successfully got the location, display it.
 write ('The location is: ' + asyncResult.value);
 }
 });
}
// Write to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message;
}
```
### **Set the location**

{443}------------------------------------------------

This section shows a code sample that sets the location of the appointment that the user is composing.

To use item.location.setAsync , specify a string of up to 255 characters in the data parameter. Optionally, you can provide a callback function and any arguments for the callback function in the asyncContext parameter. You should check the status, result, and any error message in the asyncResult output parameter of the callback. If the asynchronous call is successful, setAsync inserts the specified location string as plain text, overwriting any existing location for that item.

#### 7 **Note**

You can set multiple locations by using a semi-colon as the separator (e.g., 'Conference room A; Conference room B').

JavaScript

```
let item;
Office.initialize = function () {
 item = Office.context.mailbox.item;
 // Check for the DOM to load using the jQuery ready method.
 $(document).ready(function () {
 // After the DOM is loaded, app-specific code can run.
 // Set the location of the item being composed.
 setLocation();
 });
}
// Set the location of the item that the user is composing.
function setLocation() {
 item.location.setAsync(
 'Conference room A',
 { asyncContext: { var1: 1, var2: 2 } },
 function (asyncResult) {
 if (asyncResult.status == Office.AsyncResultStatus.Failed){
 write(asyncResult.error.message);
 }
 else {
 // Successfully set the location.
 // Do whatever is appropriate for your scenario,
 // using the arguments var1 and var2 as applicable.
 }
 });
}
// Write to a div with id='message' on the page.
function write(message){
```

{444}------------------------------------------------

# **See also**

- Create your first Outlook add-in
- Asynchronous programming in Office Add-ins

{445}------------------------------------------------

# **Manage the sensitivity label of your message or appointment in compose mode**

08/01/2025

Collaboration in the workplace not only occurs within the organization, but extends to external partners as well. With information being shared beyond an organization's network, it's important to establish measures to prevent data loss and enforce compliance policies. [Microsoft Purview Information Protection](https://learn.microsoft.com/en-us/microsoft-365/compliance/information-protection) helps you implement solutions to classify and protect sensitive information. The use of sensitivity labels in Outlook is a capability you can configure to protect your data.

You can use the Office JavaScript API to implement sensitivity label solutions in your Outlook add-in projects and support the following scenarios.

- Automatically apply sensitivity labels to certain messages and appointments while they're being composed, so that users can focus on their work.
- Restrict additional actions if a certain sensitivity label is applied to a message or appointment, such as preventing users from adding external recipients to a message.
- Add a header or footer to a message or appointment based on its sensitivity label to comply with business and legal policies.

#### 7 **Note**

Support for the sensitivity label feature was introduced in **[requirement set 1.13](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.13/outlook-requirement-set-1.13)**. For information about client support for this feature, see **Supported clients and platforms**.

### **Prerequisites**

To implement the sensitivity label feature in your add-in, you must have a Microsoft 365 E5 subscription. You might qualify for a Microsoft 365 E5 developer subscription through the [Microsoft 365 Developer Program](https://aka.ms/m365devprogram) ; for details, see the [FAQ.](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-) Alternatively, you can [sign up for](https://www.microsoft.com/microsoft-365/try) [a 1-month free trial](https://www.microsoft.com/microsoft-365/try) or [purchase a Microsoft 365 plan](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g) .

### **Supported clients and platforms**

The following table lists client-server combinations that support the use of the sensitivity label feature in Outlook add-ins. Excluded combinations aren't supported.

{446}------------------------------------------------

| Client                                                         | Exchange Online |
|----------------------------------------------------------------|-----------------|
| Web browser (modern UI)                                        | Supported       |
| new Outlook on Windows                                         |                 |
| Windows (classic)<br>Version 2304 (Build 16327.20248) or later | Supported       |
| Mac<br>Version 16.77 (23081600) or later                       | Supported       |
| Android                                                        | Not applicable  |
| iOS                                                            | Not applicable  |

# **Configure the manifest**

To use the sensitivity feature in your Outlook add-in project, you must configure the **read/write item** permission in the manifest of your add-in.

- **Unified manifest for Microsoft 365**: In the ["authorization.permissions.resourceSpecific"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-authorization-permissions#resourcespecific) array, set the "name" property of an object to "MailboxItem.ReadWrite.User" .
- **Add-in only manifest**: Set the [<Permissions> element](https://learn.microsoft.com/en-us/javascript/api/manifest/permissions) to **ReadWriteItem**.

#### 7 **Note**

Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on Mac. To run this type of add-in on Mac, the add-in must first be published to **[AppSource](https://appsource.microsoft.com/)** then deployed in the **Microsoft 365 Admin Center**. For more information, see **Support for add-ins with the unified manifest for Microsoft 365**.

If your add-in will detect and handle the OnSensitivityLabelChanged event, additional manifest configurations are required to enable the event-based activation feature. To learn more, see Detect sensitivity label changes with the OnSensitivityLabelChanged event.

#### 7 **Note**

The OnSensitivityLabelChanged event isn't currently available with the unified manifest for Microsoft 365 in Outlook on the web and the new Outlook on Windows. To handle these

{447}------------------------------------------------

events, implement an add-in only manifest instead. For information about the types of manifests, see **Office Add-ins manifest**.

# **Verify the status of the catalog of sensitivity labels**

Sensitivity labels and policies are configured by an organization's administrator through the [Microsoft Purview compliance portal.](https://learn.microsoft.com/en-us/microsoft-365/compliance/microsoft-365-compliance-center) For guidance on how to configure sensitivity labels in your tenant, see [Create and configure sensitivity labels and their policies.](https://learn.microsoft.com/en-us/microsoft-365/compliance/create-sensitivity-labels)

Before you can get or set the sensitivity label on a message or appointment, you must first ensure that the catalog of sensitivity labels is enabled on the mailbox where the add-in is installed. To check the status of the catalog of sensitivity labels, call [context.sensitivityLabelsCatalog.getIsEnabledAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.sensitivitylabelscatalog#outlook-office-sensitivitylabelscatalog-getisenabledasync-member(1)) in compose mode.

```
JavaScript
// Check whether the catalog of sensitivity labels is enabled.
Office.context.sensitivityLabelsCatalog.getIsEnabledAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
 console.log(asyncResult.value);
 } else {
 console.log("Action failed with error: " + asyncResult.error.message);
 }
});
```
# **Identify available sensitivity labels**

If you want to determine the sensitivity labels available for use on a message or appointment in compose mode, use [context.sensitivityLabelsCatalog.getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.sensitivitylabelscatalog#outlook-office-sensitivitylabelscatalog-getasync-member(1)). The available labels are returned in the form of [SensitivityLabelDetails](https://learn.microsoft.com/en-us/javascript/api/outlook/office.sensitivitylabeldetails) objects, which provide the following details.

- The name of the label.
JavaScript

- The unique identifier (GUID) of the label.
- A description of the label.
- The color assigned to the label.
- The configured [sublabels,](https://learn.microsoft.com/en-us/microsoft-365/compliance/sensitivity-labels#sublabels-grouping-labels) if any.

The following example shows how to identify the sensitivity labels available in the catalog.

// It's recommended to check the status of the catalog of sensitivity labels before

{448}------------------------------------------------

```
// calling other sensitivity label methods.
Office.context.sensitivityLabelsCatalog.getIsEnabledAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded &&
asyncResult.value == true) {
 // Identify available sensitivity labels in the catalog.
 Office.context.sensitivityLabelsCatalog.getAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
 const catalog = asyncResult.value;
 console.log("Sensitivity Labels Catalog:");
 catalog.forEach((sensitivityLabel) => {
 console.log(`Name: ${sensitivityLabel.name}`);
 console.log(`ID: ${sensitivityLabel.id}`);
 console.log(`Tooltip: ${sensitivityLabel.tooltip}`);
 console.log(`Color: ${sensitivityLabel.color}`);
 console.log(`Sublabels: 
${JSON.stringify(sensitivityLabel.children)}`);
 });
 } else {
 console.log("Action failed with error: " +
asyncResult.error.message);
 }
 });
 } else {
 console.log("Action failed with error: " + asyncResult.error.message);
 }
});
```
# **Get the sensitivity label of a message or appointment**

To get the sensitivity label currently applied to a message or appointment in compose mode, call [item.sensitivityLabel.getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.sensitivitylabel#outlook-office-sensitivitylabel-getasync-member(1)) as shown in the following example. This returns the GUID of the sensitivity label.

```
JavaScript
// It's recommended to check the status of the catalog of sensitivity labels
before
// calling other sensitivity label methods.
Office.context.sensitivityLabelsCatalog.getIsEnabledAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded &&
asyncResult.value == true) {
 // Get the current sensitivity label of a message or appointment.
 Office.context.mailbox.item.sensitivityLabel.getAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
 console.log(asyncResult.value);
 } else {
 console.log("Action failed with error: " +
asyncResult.error.message);
 }
```

{449}------------------------------------------------

```
 });
 } else {
 console.log("Action failed with error: " + asyncResult.error.message);
 }
});
```
# **Set the sensitivity label on a message or appointment**

You can set only one sensitivity label on a message or appointment in compose mode. Before you set the label, call [context.sensitivityLabelsCatalog.getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.sensitivitylabelscatalog#outlook-office-sensitivitylabelscatalog-getasync-member(1)). This ensures that the label you want to apply is available for use. It also helps you identify a label's GUID, which you'll need to apply the label to the mail item. After you confirm the label's availability, pass its GUID as a parameter to [item.sensitivityLabel.setAsync,](https://learn.microsoft.com/en-us/javascript/api/outlook/office.sensitivitylabel#outlook-office-sensitivitylabel-setasync-member(1)) as shown in the following example.

```
JavaScript
// It's recommended to check the status of the catalog of sensitivity labels
before
// calling other sensitivity label methods.
Office.context.sensitivityLabelsCatalog.getIsEnabledAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded &&
asyncResult.value == true) {
 // Identify available sensitivity labels in the catalog.
 Office.context.sensitivityLabelsCatalog.getAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
 const catalog = asyncResult.value;
 if (catalog.length > 0) {
 // Get the GUID of the sensitivity label.
 var id = catalog[0].id;
 // Set the mail item's sensitivity label using the label's
GUID.
 Office.context.mailbox.item.sensitivityLabel.setAsync(id,
(asyncResult) => {
 if (asyncResult.status ===
Office.AsyncResultStatus.Succeeded) {
 console.log(asyncResult.status);
 } else {
 console.log("Action failed with error: " +
asyncResult.error.message);
 }
 });
 } else {
 console.log("Catalog list is empty");
 }
 } else {
 console.log("Action failed with error: " +
asyncResult.error.message);
```
}

{450}------------------------------------------------

```
 });
 } else {
 console.log("Action failed with error: " + asyncResult.error.message);
 }
});
```
Instead of using the GUID to set the sensitivity label, you can pass the [SensitivityLabelDetails](https://learn.microsoft.com/en-us/javascript/api/outlook/office.sensitivitylabeldetails) object retrieved from the catalog call, as shown in the following example.

```
JavaScript
// It's recommended to check the status of the catalog of sensitivity labels
before
// calling other sensitivity label methods.
Office.context.sensitivityLabelsCatalog.getIsEnabledAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded &&
asyncResult.value == true) {
 // Identify available sensitivity labels in the catalog.
 Office.context.sensitivityLabelsCatalog.getAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
 const catalog = asyncResult.value;
 if (catalog.length > 0) {
 // Set the mail item's sensitivity label using the
SensitivityLabelDetails object.

Office.context.mailbox.item.sensitivityLabel.setAsync(catalog[0], (asyncResult) =>
{
 if (asyncResult.status ===
Office.AsyncResultStatus.Succeeded) {
 console.log(asyncResult.status);
 } else {
 console.log("Action failed with error: " +
asyncResult.error.message);
 }
 });
 } else {
 console.log("Catalog list is empty");
 }
 } else {
 console.log("Action failed with error: " +
asyncResult.error.message);
 }
 });
 } else {
 console.log("Action failed with error: " + asyncResult.error.message);
 }
});
```

{451}------------------------------------------------

# **Detect sensitivity label changes with the OnSensitivityLabelChanged event**

Take extra measures to protect your data by using the OnSensitivityLabelChanged event. This event enables your add-in to complete tasks in response to sensitivity label changes on a message or appointment. For example, you can prevent users from downgrading the sensitivity label of a mail item if it contains certain attachments.

The OnSensitivityLabelChanged event is available through the event-based activation feature. To learn how to configure, debug, and deploy an event-based add-in that uses this event, see Activate add-ins with events.

#### 7 **Note**

The OnSensitivityLabelChanged event isn't currently available with the unified manifest for Microsoft 365 in Outlook on the web and the new Outlook on Windows. To handle these events, implement an add-in only manifest instead. For information about the types of manifests, see **Office Add-ins manifest**.

# **See also**

- [Learn about sensitivity labels](https://learn.microsoft.com/en-us/microsoft-365/compliance/sensitivity-labels)
- [Get started with sensitivity labels](https://learn.microsoft.com/en-us/microsoft-365/compliance/get-started-with-sensitivity-labels)
- [Create and configure sensitivity labels and their policies](https://learn.microsoft.com/en-us/microsoft-365/compliance/create-sensitivity-labels)
- Activate add-ins with events
- [Office Add-ins code sample: Verify the sensitivity label of a message](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-verify-sensitivity-label)

{452}------------------------------------------------

# **Manage the delivery date and time of a message**

Article • 09/26/2024

The Outlook client gives you the option to delay the delivery of a message, but requires you to keep Outlook and your device running to send it at the specified time. With the Office JavaScript API, you can now implement an Outlook add-in that sends scheduled messages even with your Outlook client closed or with your device turned off. This capability provides your users with the convenience to schedule email marketing campaigns or time a message to be delivered during a colleague or customer's business hours.

#### 7 **Note**

Support for this feature was introduced in **[requirement set 1.13](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.13/outlook-requirement-set-1.13)**. See **[clients and](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients) [platforms](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients)** that support this requirement set.

# **Configure the manifest**

To schedule the delivery of a message, your add-in must be able to activate in message compose mode. This is defined through the [MessageComposeCommandSurface](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#messagecomposecommandsurface) extension point in an add-in only manifest or the **mailCompose** "contexts" property in a Unified manifest for Microsoft 365.

For further guidance on how to configure an Outlook add-in manifest, see Office Add-in manifests.

# **Access the delivery property of a message**

The [item.delayDeliveryTime](https://learn.microsoft.com/en-us/javascript/api/outlook/office.messagecompose#outlook-office-messagecompose-delaydeliverytime-member) property returns a [DelayDeliveryTime](https://learn.microsoft.com/en-us/javascript/api/outlook/office.delaydeliverytime) object that provides you with methods to get or set the delivery date and time of a message.

### **Get the delivery date and time of a message**

To get the delivery date and time of a message in compose mode, call [item.delayDeliveryTime.getAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.delaydeliverytime#outlook-office-delaydeliverytime-getasync-member(1)) as shown in the following example. If a delivery date hasn't been set on a message yet, the call returns 0 . Otherwise, it returns a [JavaScript](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Date) [Date object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Date) .

{453}------------------------------------------------

```
JavaScript
// Gets the delivery date and time of a message.
Office.context.mailbox.item.delayDeliveryTime.getAsync((asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(asyncResult.error.message);
 return;
 }
 const deliveryDate = asyncResult.value;
 if (deliveryDate === 0) {
 console.log("Your message will be delivered immediately when you select
Send.");
 } else {
 const date = new Date(deliveryDate);
 console.log(`Message delivery date and time: ${date.toString()}`);
 }
});
```
# **Set the delivery date and time of a message**

To delay the delivery of a message, pass a [JavaScript Date object](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Date) as a parameter to [item.delayDeliveryTime.setAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.delaydeliverytime#outlook-office-delaydeliverytime-setasync-member(1)) method, as shown in the following example.

```
JavaScript
// Delays the delivery time by five minutes from the current time.
const currentTime = new Date().getTime();
const milliseconds = 5 * 60 * 1000;
const timeDelay = new Date(currentTime + milliseconds);
Office.context.mailbox.item.delayDeliveryTime.setAsync(timeDelay,
(asyncResult) => {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 console.log(asyncResult.error.message);
 return;
 }
 console.log("Message delivery has been scheduled.");
});
```
# **Feature behavior and limitations**

When you schedule the delivery of a message using the

item.delayDeliveryTime.setAsync method, the delay is processed on the server. This allows the message to be sent even if the Outlook client isn't running. In classic Outlook on Windows, the message doesn't appear in the **Outbox** folder, so you won't be able to 

{454}------------------------------------------------

edit the message or cancel its delivery after selecting **Send**. However, you'll be able to review the message from the **Sent Items** folder. In Outlook on the web, on Mac, and in [new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) , the message appears in the **Drafts** folder until the scheduled delivery time. While it's in the **Drafts** folder, you'll be able to edit the message before it's sent.

The item.delayDeliveryTime.setAsync behavior differs from a message scheduled using the native **Delay Delivery** option in the Outlook client, which processes the delay clientside. A message scheduled using this option appears in the **Outbox** folder and is only delivered if the Outlook client from which it was sent is running at the specified delivery time.

# **Try sample snippets in Script Lab**

Get the [Script Lab for Outlook add-in](https://appsource.microsoft.com/product/office/wa200001603) and try out the "Get and set message delivery (Message Compose)" sample snippet. To learn more about Script Lab, see Explore Office JavaScript API using Script Lab.

# **See also**

- Create Outlook add-ins for compose forms

{455}------------------------------------------------

# **Authentication options in Outlook add-ins**

06/24/2025

Your Outlook add-in can access information from anywhere on the Internet, whether from the server that hosts the add-in, from your internal network, or from somewhere else in the cloud. If that information is protected, your add-in needs a way to authenticate your user. Outlook add-ins provide a number of different methods to authenticate, depending on your specific scenario.

# **Single sign-on access token using OBO flow**

Single sign-on (SSO) access tokens provide a seamless way for your Outlook add-in to authenticate and obtain access tokens to call the [Microsoft Graph API](https://learn.microsoft.com/en-us/graph/overview). This capability reduces friction since the user is not required to enter their credentials. You can use the on-behalf-of flow with a middle-tier server, or nested app authentication (described in the next section).

#### 7 **Note**

SSO using the OBO flow is currently supported for Word, Excel, Outlook, and PowerPoint. For more information about support, see **[IdentityAPI requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/identity-api-requirement-sets)**. If you're working with an Outlook add-in, be sure to enable modern authentication for the Microsoft 365 tenancy. For information about how to do this, see **[Enable or disable modern](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online) [authentication for Outlook in Exchange Online](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online)**.

Consider using SSO access tokens if your add-in:

- Is used primarily by Microsoft 365 users
- Needs access to:
	- Microsoft services that are exposed as part of Microsoft Graph
	- A non-Microsoft service that you control

The SSO authentication method uses the [Microsoft identity platform and OAuth 2.0 On-Behalf-](https://learn.microsoft.com/en-us/entra/identity-platform/v2-oauth2-on-behalf-of-flow)[Of flow](https://learn.microsoft.com/en-us/entra/identity-platform/v2-oauth2-on-behalf-of-flow). It requires that the add-in register in the [Application Registration Portal](https://apps.dev.microsoft.com/) and specify any required Microsoft Graph scopes in the add-in manifest, if the add-in only manifest is being used. If the add-in is using the unified manifest for Microsoft 365, there is some manifest configuration, but Microsoft Graph scopes aren't specified. Instead, the needed scopes are specified at runtime in a call to fetch a token to Microsoft Graph.

Using this method, your add-in can obtain an access token scoped to your server back-end API. The add-in uses this as a bearer token in the Authorization header to authenticate a call 

{456}------------------------------------------------

back to your API. At that point your server can:

- Complete the On-Behalf-Of flow to obtain an access token scoped to the Microsoft Graph API
- Use the identity information in the token to establish the user's identity and authenticate to your own back-end services

For a more detailed overview, see the full overview of the SSO authentication method.

For details on using the SSO token in an Outlook add-in, see Authenticate a user with an single-sign-on token in an Outlook add-in.

For a sample add-in that uses the SSO token, see [Outlook Add-in SSO](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Outlook-Add-in-SSO) .

# **Single sign-on access token using nested app authentication**

Nested App Authentication (NAA) enables Single Sign-On (SSO) for Office Add-ins running in the context of native Office applications. Compared with the on-behalf-of flow used with Office.js and getAccessToken() , NAA provides greater flexibility in app architecture, enabling the creation of rich, client-driven applications. NAA makes handling SSO simpler for your addin code. NAA enables you to make Microsoft Graph calls from your add-in client code as an SPA without the need for a middle-tier server. There's no need to use Office.js APIs as NAA is provided by the MSAL.js library.

To enable your Outlook add-in to use NAA, see Enable SSO in an Office Add-in using nested app authentication (preview). NAA works the same across all Office Add-ins.

# **Exchange user identity token**

#### ) **Important**

Legacy Exchange tokens are deprecated. Legacy Exchange **user identity** and **callback** tokens have been turned off for most Exchange Online tenants. Administrators can reenable legacy tokens for tenants and add-ins until June 2025. In October 2025, legacy tokens will be completely turned off for all tenants. For the timeline and details, see our **FAQ page**. This is part of **[Microsoft's Secure Future Initiative](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/)** , which gives organizations the tools needed to respond to the current threat landscape. Exchange user identity tokens will still work for Exchange on-premises. Nested app authentication is the recommended approach for tokens going forward.

{457}------------------------------------------------

Exchange user identity tokens provide a way for your add-in to establish the identity of the user. By verifying the user's identity, you can then perform a one-time authentication into your back-end system, then accept the user identity token as an authorization for future requests. Use the Exchange user identity token:

- When the add-in is used primarily by Exchange on-premises users.
- When the add-in needs access to a non-Microsoft service that you control.
- As a fallback authentication when the add-in is running on a version of Office that doesn't support SSO.

Your add-in can call [getUserIdentityTokenAsync](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox#outlook-office-mailbox-getuseridentitytokenasync-member(1)) to get Exchange user identity tokens. For details on using these tokens, see Authenticate a user with an identity token for Exchange.

# **Access tokens obtained via OAuth2 flows**

Add-ins can also access services from Microsoft and others that support OAuth2 for authorization. Consider using OAuth2 tokens if your add-in:

- Needs access to a service outside of your control.
Using this method, your add-in prompts the user to sign-in to the service either by using the [displayDialogAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.ui#office-office-ui-displaydialogasync-member(1)) method to initialize the OAuth2 flow.

# **Callback tokens**

#### ) **Important**

Legacy Exchange tokens are deprecated. Legacy Exchange **user identity** and **callback** tokens have been turned off for most Exchange Online tenants. Administrators can reenable legacy tokens for tenants and add-ins until June 2025. In October 2025, legacy tokens will be completely turned off for all tenants. For the timeline and details, see our **FAQ page**. This is part of **[Microsoft's Secure Future Initiative](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/)** , which gives organizations the tools needed to respond to the current threat landscape. Exchange user identity tokens will still work for Exchange on-premises. Nested app authentication is the recommended approach for tokens going forward.

Callback tokens provide access to the user's mailbox from your server back-end, either using [Exchange Web Services (EWS),](https://learn.microsoft.com/en-us/exchange/client-developer/exchange-web-services/explore-the-ews-managed-api-ews-and-web-services-in-exchange) or the [Outlook REST API](https://learn.microsoft.com/en-us/previous-versions/office/office-365-api/api/version-2.0/use-outlook-rest-api). Consider using callback tokens if your add-in:

- Needs access to the user's mailbox from your server back-end.

{458}------------------------------------------------

Add-ins obtain callback tokens using one of the [getCallbackTokenAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#methods) methods. The level of access is controlled by the permissions specified in the add-in manifest.

# **See also**

- [Nested app auth requirement set](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/nested-app-auth-requirement-sets)
- Enable SSO in an Office Add-in using nested app authentication (preview)
- Nested app authentication and Outlook legacy tokens deprecation FAQ

{459}------------------------------------------------

# **Authenticate a user with a single-sign-on token in an Outlook add-in**

06/24/2025

#### ) **Important**

Legacy Exchange tokens are deprecated. Legacy Exchange **user identity** and **callback** tokens have been turned off for most Exchange Online tenants. Administrators can reenable legacy tokens for tenants and add-ins until June 2025. In October 2025, legacy tokens will be completely turned off for all tenants. For the timeline and details, see our **FAQ page**. This is part of **[Microsoft's Secure Future Initiative](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/)** , which gives organizations the tools needed to respond to the current threat landscape. Exchange user identity tokens will still work for Exchange on-premises. Nested app authentication is the recommended approach for tokens going forward.

Single sign-on (SSO) provides a seamless way for your add-in to authenticate users (and optionally to obtain access tokens to call the [Microsoft Graph API)](https://learn.microsoft.com/en-us/graph/overview).

Using this method, your add-in can obtain an access token scoped to your server back-end API. The add-in uses this as a bearer token in the Authorization header to authenticate a call back to your API. Optionally, you can also have your server-side code.

- Complete the On-Behalf-Of flow to obtain an access token scoped to the Microsoft Graph API
- Use the identity information in the token to establish the user's identity and authenticate to your own back-end services

For an overview of SSO in Office Add-ins, see Enable single sign-on for Office Add-ins and Authorize to Microsoft Graph in your Office Add-in.

# **Enable modern authentication in your Microsoft 365 tenancy**

To use SSO with an Outlook add-in, you must enable Modern Authentication for the Microsoft 365 tenancy. For information about how to do this, see [Enable or disable modern](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online) [authentication for Outlook in Exchange Online.](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online)

# **Register your add-in**

{460}------------------------------------------------

To use SSO, your Outlook add-in will need to have a server-side web API that is registered with Microsoft Entra ID. For more information, see Register an Office Add-in that uses SSO with the Microsoft identity platform.

### **Provide consent when sideloading an add-in**

When you are developing an add-in, you will have to provide consent in advance. For more information, see [Admin consent.](https://learn.microsoft.com/en-us/entra/identity-platform/quickstart-configure-app-access-web-apis#more-on-api-permissions-and-admin-consent)

# **Update the add-in manifest**

The next step to enable SSO in the add-in is to add some information to the manifest from the add-in's Microsoft identity platform registration. The markup varies depending on the type of manifest.

- **Add-in only manifest**: Add a WebApplicationInfo element at the end of the VersionOverridesV1_1 [VersionOverrides](https://learn.microsoft.com/en-us/javascript/api/manifest/versionoverrides) element. Then, add its required child elements. For detailed information about the markup, see Configure the add-in.
- **Unified manifest for Microsoft 365**: Add a ["webApplicationInfo"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root#webApplicationInfo-property) property to the root { ... } object in the manifest. Give this object a child "id" property set to the application ID of the add-in's web app as it was generated in the Azure portal when you registered the add-in. (See the section Register your add-in earlier in this article.) Also give it a child "resource" property that is set to the same **Application ID URI** that you set when you registered the add-in. This URI should have the form api://<fully-qualified-domainname>/<application-id> . The following is an example.

```
JSON
"webApplicationInfo": {
 "id": "a661fed9-f33d-4e95-b6cf-624a34a2f51d",
 "resource": "api://addin.contoso.com/a661fed9-f33d-4e95-b6cf-
624a34a2f51d"
 },
```
# **Get the SSO token**

The add-in gets an SSO token with client-side script. For more information, see Add client-side code.

{461}------------------------------------------------

# **Use the SSO token at the back-end**

In most scenarios, there would be little point to obtaining the access token, if your add-in does not pass it on to a server-side and use it there. For details on what your server-side could and should do, see Add server-side code.

# **SSO for event-based activation or integrated spam reporting**

There are additional steps to take if your add-in uses event-based activation or integrated spam reporting. For more information, see Use single sign-on (SSO) or cross-origin resource sharing (CORS) in your event-based or spam-reporting Outlook add-in.

# **See also**

- [getAccessToken](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.auth#office-runtime-officeruntime-auth-getaccesstoken-member(1))
- For a sample Outlook add-in that uses the SSO token to access the Microsoft Graph API, see [Outlook Add-in SSO](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Outlook-Add-in-SSO) .
- [SSO API reference](https://learn.microsoft.com/en-us/javascript/api/office/office.auth#office-office-auth-getaccesstoken-member(1))
- [IdentityAPI requirement set](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/identity-api-requirement-sets)
- Use single sign-on (SSO) or cross-origin resource sharing (CORS) in your event-based or spam-reporting Outlook add-in

{462}------------------------------------------------

# **Use single sign-on (SSO) or cross-origin resource sharing (CORS) in your eventbased or spam-reporting Office Add-in**

07/14/2025

When an add-in implements event-based activation or integrated spam reporting, the events run in a separate runtime. To configure single sign-on (SSO) or request external data through cross-origin resource sharing (CORS) in these add-ins, you must configure a well-known URI. Through this resource, Office will be able to identify the add-ins, including their JavaScript files, that support SSO or CORS requests.

#### 7 **Note**

The steps in this article only apply to add-ins that run on Excel, PowerPoint, or Word on Windows, or classic Outlook on Windows. This is because they use a JavaScript file, while these applications on Mac, on the web, and **[new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** use an HTML file that references the same JavaScript file. To learn more, see **Activate add-ins with events** and **Implement an integrated spam-reporting add-in**.

# **List allowed add-ins in a well-known URI**

To list which add-ins are allowed to work with SSO or CORS, create a JSON file that identifies each JavaScript file for each add-in. Then, host that JSON file at a well-known URI. A wellknown URI allows the specification of all hosted JS files that are authorized to obtain tokens for the current web origin. This ensures that the owner of the origin has full control over which hosted JavaScript files are meant to be used in an add-in and which ones are not, preventing any security vulnerabilities around impersonation, for example.

The following example shows how to configure SSO or CORS for two add-ins (a main version and beta version). You can list as many add-ins as necessary depending on how many you provide from your web server.

```
JSON
{
 "allowed":
 [
 "https://addin.contoso.com:8000/main/js/autorun.js",
 "https://addin.contoso.com:8000/beta/js/autorun.js"
```

{463}------------------------------------------------

Host the JSON file under a location named .well-known in the URI at the root of the origin. For example, if the origin is https://addin.contoso.com:8000/ , then the well-known URI is https://addin.contoso.com:8000/.well-known/microsoft-officeaddins-allowed.json . For clarification, this file is to be hosted in your Office Web Add-in, not the web server that you're attempting to make a CORS request to. See the [Outlook-Add-in-SSO-events](https://github.com/OfficeDev/Office-Add-in-samples/blob/main/Samples/auth/Outlook-Add-in-SSO-events/public/.well-known/microsoft-officeaddins-allowed.json) sample for an example using the recommended location.

The origin refers to a pattern of scheme + subdomain + domain + port. The name of the location **must** be .well-known , and the name of the resource file **must** be microsoftofficeaddins-allowed.json . This file must contain a JSON object with an attribute named allowed whose value is an array of all JavaScript files authorized for SSO for their respective add-ins.

After you configure the well-known URI, if your add-in implements SSO, you can then call the [getAccessToken() API](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.auth) to get an access token with the user's identity.

#### ) **Important**

While OfficeRuntime.auth.getAccessToken and Office.auth.getAccessToken perform the same functionality of retrieving an access token, we recommend calling OfficeRuntime.auth.getAccessToken in your event-based or spam-reporting add-in. This API is supported in all client versions that support event-based activation, integrated spam reporting, and SSO. On the other hand, Office.auth.getAccessToken is only supported in classic Outlook on Windows starting from Version 2111 (Build 14701.20000).

### **See also**

- Authenticate a user with a single-sign-on token in an Outlook add-in
- Activate add-ins with events
- Implement an integrated spam-reporting add-in

{464}------------------------------------------------

# **Authenticate a user with an identity token for Exchange**

Article • 04/09/2024

#### ) **Important**

Legacy Exchange user identity tokens and callback tokens will be turned off for all Exchange Online tenants in October 2024 as part of **[Microsoft's Secure Future](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/) [Initiative](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/)** , which gives organizations the tools needed to respond to the current threat landscape. Exchange user identity tokens will still work for Exchange onpremises. Nested app authentication is the recommended approach for tokens going forward. For more information, see our **[blog post about nested app](https://aka.ms/NAApreviewblog) [authentication and legacy Exchange tokens](https://aka.ms/NAApreviewblog)** .

Exchange user identity tokens provide a way for your add-in to uniquely identify an addin user. By establishing the user's identity, you can implement a single sign-on (SSO) authentication scheme for your back-end service that enables customers who are using Outlook add-ins to connect to your service without signing in. See Exchange user identity token for more about when to use this token type. In this article, we'll take a look at a simplistic method of using the Exchange identity token to authenticate a user to your back-end.

#### ) **Important**

This is just a simple example of an SSO implementation. As always, when you're dealing with identity and authentication, you have to make sure that your code meets the security requirements of your organization.

# **Send the ID token with each request**

The first step is for your add-in to obtain the Exchange user identity token from the server by calling [getUserIdentityTokenAsync.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#methods) Then the add-in sends this token with every request it makes to your back-end. This could be in a header, or as part of the request body.

# **Validate the token**

{465}------------------------------------------------

The back-end MUST validate the token before accepting it. This is an important step to ensure that the token was issued by the user's Exchange server. For information on validating Exchange user identity tokens, see Validate an Exchange identity token.

Once validated and decoded, the payload of the token looks something like the following:

```
JSON
{ 
 "aud" : "https://mailhost.contoso.com/IdentityTest.html",
 "iss" : "00000002-0000-0ff1-ce00-000000000000@mailhost.contoso.com",
 "nbf" : "1505749527",
 "exp" : "1505778327",
 "appctxsender":"00000002-0000-0ff1-ce00-
000000000000@mailhost.context.com",
 "isbrowserhostedapp":"true",
 "appctx" : {
 "msexchuid" : "53e925fa-76ba-45e1-be0f-4ef08b59d389",
 "version" : "ExIdTok.V1",
 "amurl" : 
"https://mailhost.contoso.com:443/autodiscover/metadata/json/1"
 }
}
```
# **Map the token to a user in your backend**

Your back-end service can calculate a unique user ID from the token and map it to a user in your internal user system. For example, if you use a database to store users, you could add this unique ID to the user's record in your database.

### **Generate a unique ID**

Use a combination of the msexchuid and amurl properties. For example, you could concatenate the two values together and generate a base 64-encoded string. This value can be reliably generated from the token every time, so you can map an Exchange user identity token back to the user in your system.

### **Check the user**

With the unique ID generated, the next step is to check for a user in your system with that associated ID.

{466}------------------------------------------------

- If the user is found, the back-end treats the request as authenticated, and allows the request to proceed.
- If the user is not found, then the back-end returns an error indicating that the user needs to sign in. The add-in then prompts the user to sign in to the back-end using your existing authentication method. Once the user is authenticated, the Exchange user identity token is submitted with the user authentication details. The back-end can then update the user's record in your system with the unique ID.

#### 6 **Collaborate with us on GitHub**

The source for this content can be found on GitHub, where you can also create and review issues and pull requests. For more information, see [our](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md) [contributor guide](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md).

### **Office Add-ins feedback**

Office Add-ins is an open source project. Select a link to provide feedback:

- [Open a documentation issue](https://github.com/OfficeDev/office-js-docs-pr/issues/new?template=3-customer-feedback.yml&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Foffice%2Fdev%2Fadd-ins%2Foutlook%2Fauthenticate-a-user-with-an-identity-token&pageQueryParams=&contentSourceUrl=https%3A%2F%2Fgithub.com%2FOfficeDev%2Foffice-js-docs-pr%2Fblob%2Fmain%2Fdocs%2Foutlook%2Fauthenticate-a-user-with-an-identity-token.md&documentVersionIndependentId=2b96c6bb-fab4-7f4d-f472-6af63ba79a24&feedback=%0A%0A%5BEnter+feedback+here%5D%0A&author=%40o365devx&metadata=*+ID%3A+eb4018a5-e2f4-e9c0-342e-ee3860e1c57f+%0A*+Service%3A+**outlook**%0A*+Sub-service%3A+**add-ins**)
- [Provide product feedback](https://aka.ms/office-addins-dev-questions)

{467}------------------------------------------------

# **Validate an Exchange identity token**

Article • 05/28/2025

#### ) **Important**

Legacy Exchange tokens are deprecated. Legacy Exchange **user identity** and **callback** tokens have been turned off for most Exchange Online tenants. Administrators can reenable legacy tokens for tenants and add-ins until June 2025. In October 2025, legacy tokens will be completely turned off for all tenants. For the timeline and details, see our **FAQ page**. This is part of **[Microsoft's Secure Future Initiative](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/)** , which gives organizations the tools needed to respond to the current threat landscape. Exchange user identity tokens will still work for Exchange on-premises. Nested app authentication is the recommended approach for tokens going forward.

Your Outlook add-in can send you an Exchange user identity token, but before you trust the request you must validate the token to ensure that it came from the Exchange server that you expect. Exchange user identity tokens are JSON Web Tokens (JWT). The steps required to validate a JWT are described in [RFC 7519 JSON Web Token (JWT)](https://www.rfc-editor.org/rfc/rfc7519.txt) .

We suggest that you use a four-step process to validate the identity token and obtain the user's unique identifier. First, extract the JSON Web Token (JWT) from a Base64-encoded URL string. Second, make sure that the token is well-formed, that it is for your Outlook add-in, that it has not expired, and that you can extract a valid URL for the authentication metadata document. Next, retrieve the authentication metadata document from the Exchange server and validate the signature attached to the identity token. Finally, compute a unique identifier for the user by concatenating the user's Exchange ID with the URL of the authentication metadata document.

# **Extract the JSON Web Token**

The token returned from [getUserIdentityTokenAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#methods) is an encoded string representation of the token. In this form, per RFC 7519, all JWTs have three parts, separated by a period. The format is as follows.

#### JSON

{header}.{payload}.{signature}

The header and payload should be Base64-decoded to obtain a JSON representation of each part. The signature should be Base64-decoded to obtain a byte array containing the binary

{468}------------------------------------------------

signature.

For more information about the contents of the token, see Inside the Exchange identity token.

After you have the three decoded components, you can proceed with validating the content of the token.

# **Validate token contents**

To validate the token contents, you should check the following:

- Check the header and verify that the:
	- typ claim is set to JWT .
	- alg claim is set to RS256 .
	- x5t claim is present.
- Check the payload and verify that the:
	- amurl claim inside the appctx is set to the location of an authorized token signing key manifest file. For example, the expected amurl value for Microsoft 365 is [https://outlook.office365.com:443/autodiscover/metadata/json/1](https://outlook.office365.com/autodiscover/metadata/json/1) . See the next section Verify the domain for additional information.
	- Current time is between the times specified in the nbf and exp claims. The nbf claim specifies the earliest time that the token is considered valid, and the exp claim specifies the expiration time for the token. It is recommended to allow for some variation in clock settings between servers.
	- aud claim is the expected URL for your add-in.
	- version claim inside the appctx claim is set to ExIdTok.V1 .

### **Verify the domain**

When implementing the verification logic described in the previous section, you must also require that the domain of the amurl claim matches the Autodiscover domain for the user. To do so, you'll need to use or implement [Autodiscover for Exchange](https://learn.microsoft.com/en-us/exchange/client-developer/exchange-web-services/autodiscover-for-exchange).

- For Exchange Online, confirm that the amurl is a well-known domain ([https://outlook.office365.com:443/autodiscover/metadata/json/1](https://outlook.office365.com/autodiscover/metadata/json/1) ), or belongs to a geo-specific or specialty cloud ([Office 365 URLs and IP address ranges)](https://learn.microsoft.com/en-us/microsoft-365/enterprise/urls-and-ip-address-ranges?view=o365-worldwide&preserve-view=true).
- If your add-in service has a preexisting configuration with the user's tenant, then you can establish if this amurl is trusted.

{469}------------------------------------------------

- For an [Exchange hybrid deployment](https://learn.microsoft.com/en-us/microsoft-365/enterprise/configure-exchange-server-for-hybrid-modern-authentication?view=o365-worldwide&preserve-view=true), use OAuth-based Autodiscover to verify the domain expected for the user. However, while the user will need to authenticate as part of the Autodiscover flow, your add-in should never collect the user's credentials and do basic authentication.
If your add-in can't verify the amurl using any of these options, you may choose to have your add-in shut down gracefully with an appropriate notification to the user if authentication is necessary for the add-in's workflow.

# **Validate the identity token signature**

After you know that the JWT contains the required claims, you can proceed with validating the token signature.

### **Retrieve the public signing key**

The first step is to retrieve the public key that corresponds to the certificate that the Exchange server used to sign the token. The key is found in the authentication metadata document. This document is a JSON file hosted at the URL specified in the amurl claim.

The authentication metadata document uses the following format.

```
JSON
{
 "id": "_70b34511-d105-4e2b-9675-39f53305bb01",
 "version": "1.0",
 "name": "Exchange",
 "realm": "*",
 "serviceName": "00000002-0000-0ff1-ce00-000000000000",
 "issuer": "00000002-0000-0ff1-ce00-000000000000@*",
 "allowedAudiences": [
 "00000002-0000-0ff1-ce00-000000000000@*"
 ],
 "keys": [
 {
 "usage": "signing",
 "keyinfo": {
 "x5t": "enh9BJrVPU5ijV1qjZjV-fL2bco"
 },
 "keyvalue": {
 "type": "x509Certificate",
 "value": "MIIHNTCC..."
 }
 }
 ],
 "endpoints": [
```

{470}------------------------------------------------

```
 {
 "location": 
"https://by2pr06mb2229.namprd06.prod.outlook.com:444/autodiscover/metadata/json/1"
,
 "protocol": "OAuth2",
 "usage": "metadata"
 }
 ]
}
```
The available signing keys are in the keys array. Select the correct key by ensuring that the x5t value in the keyinfo property matches the x5t value in the header of the token. The public key is inside the value property in the keyvalue property, stored as a Base64-encoded byte array.

After you have the correct public key, verify the signature. The signed data is the first two parts of the encoded token, separated by a period:

JSON

{header}.{payload}

# **Compute the unique ID for an Exchange account**

Create a unique identifier for an Exchange account by concatenating the authentication metadata document URL with the Exchange identifier for the account. When you have this unique identifier, use it to create a single sign-on (SSO) system for your Outlook add-in web service. For details about using the unique identifier for SSO, see Authenticate a user with an identity token for Exchange.

### **Use a library to validate the token**

There are a number of libraries that can do general JWT parsing and validation. Microsoft provides the System.IdentityModel.Tokens.Jwt library that can be used to validate Exchange user identity tokens.

#### ) **Important**

We no longer recommend the Exchange Web Services Managed API because the Microsoft.Exchange.WebServices.Auth.dll, though still available, is now obsolete and relies on unsupported libraries like Microsoft.IdentityModel.Extensions.dll.

{471}------------------------------------------------

### **System.IdentityModel.Tokens.Jwt**

The [System.IdentityModels.Tokens.Jwt](https://www.nuget.org/packages/System.IdentityModel.Tokens.Jwt) library can parse the token and also perform the validation, though you will need to parse the appctx claim yourself and retrieve the public signing key.

```
cs
// Load the encoded token
string encodedToken = "...";
JwtSecurityToken jwt = new JwtSecurityToken(encodedToken);
// Parse the appctx claim to get the auth metadata url
string authMetadataUrl = string.Empty;
var appctx = jwt.Claims.FirstOrDefault(claim => claim.Type == "appctx");
if (appctx != null)
{
 var AppContext = JsonConvert.DeserializeObject<ExchangeAppContext>
(appctx.Value);
 // Token version check
 if (string.Compare(AppContext.Version, "ExIdTok.V1",
StringComparison.InvariantCulture) != 0) {
 // Fail validation
 }
 authMetadataUrl = AppContext.MetadataUrl;
}
// Use System.IdentityModel.Tokens.Jwt library to validate standard parts
JwtSecurityTokenHandler tokenHandler = new JwtSecurityTokenHandler();
TokenValidationParameters tvp = new TokenValidationParameters();
tvp.ValidateIssuer = false;
tvp.ValidateAudience = true;
tvp.ValidAudience = "{URL to add-in}";
tvp.ValidateIssuerSigningKey = true;
// GetSigningKeys downloads the auth metadata doc and
// returns a List<SecurityKey>
tvp.IssuerSigningKeys = GetSigningKeys(authMetadataUrl);
tvp.ValidateLifetime = true;
try
{
 var claimsPrincipal = tokenHandler.ValidateToken(encodedToken, tvp, out
SecurityToken validatedToken);
 // If no exception, all standard checks passed
}
catch (SecurityTokenValidationException ex)
```

```
{
```

{472}------------------------------------------------

```
 // Validation failed
```
The ExchangeAppContext class is defined as follows:

```
cs
using Newtonsoft.Json;
/// <summary>
/// Representation of the appctx claim in an Exchange user identity token.
/// </summary>
public class ExchangeAppContext
{
 /// <summary>
 /// The Exchange identifier for the user
 /// </summary>
 [JsonProperty("msexchuid")]
 public string ExchangeUid { get; set; }
 /// <summary>
 /// The token version
 /// </summary>
 public string Version { get; set; }
 /// <summary>
 /// The URL to download authentication metadata
 /// </summary>
 [JsonProperty("amurl")]
 public string MetadataUrl { get; set; }
}
```
For an example that uses this library to validate Exchange tokens and has an implementation of GetSigningKeys , see [Outlook-Add-In-Token-Viewer](https://github.com/OfficeDev/Outlook-Add-In-Token-Viewer) .

# **See also**

- [Outlook-Add-In-Token-Viewer](https://github.com/OfficeDev/Outlook-Add-In-Token-Viewer)
- [Outlook-Add-in-JavaScript-ValidateIdentityToken](https://github.com/OfficeDev/Outlook-Add-in-JavaScript-ValidateIdentityToken)

}

{473}------------------------------------------------

# **Inside the Exchange identity token**

Article • 04/12/2024

#### ) **Important**

Legacy Exchange user identity tokens and callback tokens will be turned off for all Exchange Online tenants in October 2024 as part of **[Microsoft's Secure Future](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/) [Initiative](https://blogs.microsoft.com/on-the-issues/2023/11/02/secure-future-initiative-sfi-cybersecurity-cyberattacks/)** , which gives organizations the tools needed to respond to the current threat landscape. Exchange user identity tokens will still work for Exchange onpremises. Nested app authentication is the recommended approach for tokens going forward. For more information, see our **[blog post about nested app](https://aka.ms/NAApreviewblog) [authentication and legacy Exchange tokens](https://aka.ms/NAApreviewblog)** .

The Exchange user identity token returned by the [getUserIdentityTokenAsync](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#methods) method provides a way for your add-in code to include the user's identity with calls to your back-end service. This article will discuss the format and contents of the token.

An Exchange user identity token is a base-64 URL-encoded string that is signed by the Exchange server that sent it. The token is not encrypted, and the public key that you use to validate the signature is stored on the Exchange server that issued the token. The token has three parts: a header, a payload, and a signature. In the token string, the parts are separated by a period character ( . ) to make it easy for you to split the token.

Exchange uses a the JSON Web Token (JWT) format for the identity token. For information about JWT tokens, see [RFC 7519 JSON Web Token (JWT)](https://www.rfc-editor.org/rfc/rfc7519.txt) .

# **Identity token header**

The header provides information about the format and signature information of the token. The following example shows what the header of the token looks like.

```
JSON
{
 "typ": "JWT",
 "alg": "RS256",
 "x5t": "Un6V7lYN-rMgaCoFSTO5z707X-4"
}
```
The following table describes the parts of the token header.

{474}------------------------------------------------

| Claim | Value                     | Description                                                                                                                                                     |
|-------|---------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| typ   | JWT                       | Identifies the token as a JSON Web Token. All identity tokens provided<br>by Exchange server are JWT tokens.                                                    |
| alg   | RS256                     | The hashing algorithm that is used to create the signature. All tokens<br>provided by Exchange server use the RSASSA-PKCS1-v1_5 with SHA<br>256 hash algorithm. |
| x5t   | Certificate<br>thumbprint | The X.509 thumbprint of the token.                                                                                                                              |

### **Identity token payload**

The payload contains the authentication claims that identify the email account and identify the Exchange server that sent the token. The following example shows what the payload section looks like.

JSON

```
{ 
 "aud": "https://mailhost.contoso.com/IdentityTest.html", 
 "iss": "00000002-0000-0ff1-ce00-000000000000@mailhost.contoso.com", 
 "nbf": "1331579055", 
 "exp": "1331607855", 
 "appctxsender": "00000002-0000-0ff1-ce00-
000000000000@mailhost.context.com",
 "isbrowserhostedapp": "true",
 "appctx": { 
 "msexchuid": "53e925fa-76ba-45e1-be0f-
4ef08b59d389@mailhost.contoso.com",
 "version": "ExIdTok.V1",
 "amurl": "https://mailhost.contoso.com:443/autodiscover/metadata/json/1"
 } 
}
```
The following table lists the parts of the identity token payload.

| Claim | Description                                                                                                                                                                                                                              |
|-------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| aud   | The URL of the add-in that requested the token. A token is only valid if it is<br>sent from the add-in that is running in the client's webview control. The<br>URL of the add-in is specified in the manifest. The markup depends on the |

{475}------------------------------------------------

| Claim              | Description                                                                                                                                                                                                                                                                                                       |  |
|--------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
|                    | type of manifest.                                                                                                                                                                                                                                                                                                 |  |
|                    | Add-in only manifest: If the add-in uses the Office Add-ins manifests<br>schema v1.1, this URL is the URL specified in the first <sourcelocation><br/>element, under the form type ItemRead or ItemEdit , whichever occurs first<br/>as part of the FormSettings element in the add-in manifest.</sourcelocation> |  |
|                    | Unified manifest for Microsoft 365: The URL is specified in the<br>"extensions.audienceClaimUrl" property.                                                                                                                                                                                                        |  |
| iss                | A unique identifier for the Exchange server that issued the token. All tokens<br>issued by this Exchange server will have the same identifier.                                                                                                                                                                    |  |
| nbf                | The date and time that the token is valid starting from. The value is the<br>number of seconds since January 1, 1970.                                                                                                                                                                                             |  |
| exp                | The date and time that the token is valid until. The value is the number of<br>seconds since January 1, 1970.                                                                                                                                                                                                     |  |
| appctxsender       | A unique identifier for the Exchange server that sent the application<br>context.                                                                                                                                                                                                                                 |  |
| isbrowserhostedapp | Indicates whether the add-in is hosted in a browser.                                                                                                                                                                                                                                                              |  |
| appctx             | The application context for the token.                                                                                                                                                                                                                                                                            |  |

The information in the appctx claim provides you with the unique identifier for the account and the location of the public key used to sign the token. The following table lists the parts of the appctx claim.

| Application context<br>property | Description                                                                                                                               |
|---------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| msexchuid                       | A unique identifier associated with the email account and the Exchange<br>server.                                                         |
| version                         | The version number of the token. For all tokens provided by Exchange,<br>the value is ExIdTok.V1                                          |
| amurl                           | The URL of the authentication metadata document that contains the<br>public key of the X.509 certificate that was used to sign the token. |
|                                 | For more information about how to use the authentication metadata<br>document, see Validate an Exchange identity token.                   |

{476}------------------------------------------------

# **Identity token signature**

The signature is created by hashing the header and payload sections with the algorithm specified in the header and using the self-signed X509 certificate located on the server at the location specified in the payload. Your web service can validate this signature to help make sure that the identity token comes from the server that you expect to send it.

# **See also**

For an example that parses the Exchange user identity token, see [Outlook-Add-In-](https://github.com/OfficeDev/Outlook-Add-In-Token-Viewer)[Token-Viewer](https://github.com/OfficeDev/Outlook-Add-In-Token-Viewer) .

#### 6 **Collaborate with us on GitHub**

The source for this content can be found on GitHub, where you can also create and review issues and pull requests. For more information, see [our](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md) [contributor guide](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md).

### **Office Add-ins feedback**

Office Add-ins is an open source project. Select a link to provide feedback:

[Open a documentation issue](https://github.com/OfficeDev/office-js-docs-pr/issues/new?template=3-customer-feedback.yml&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Foffice%2Fdev%2Fadd-ins%2Foutlook%2Finside-the-identity-token&pageQueryParams=&contentSourceUrl=https%3A%2F%2Fgithub.com%2FOfficeDev%2Foffice-js-docs-pr%2Fblob%2Fmain%2Fdocs%2Foutlook%2Finside-the-identity-token.md&documentVersionIndependentId=7479792f-9182-143b-21b4-d7a5195caddd&feedback=%0A%0A%5BEnter+feedback+here%5D%0A&author=%40o365devx&metadata=*+ID%3A+ef7c5315-00cb-8769-573c-a2c46f3c7a30+%0A*+Service%3A+**outlook**%0A*+Sub-service%3A+**add-ins**)

- [Provide product feedback](https://aka.ms/office-addins-dev-questions)

{477}------------------------------------------------

# **Scenario: Implement single sign-on to your service in an Outlook add-in**

Article • 08/14/2023

In this article we'll explore a recommended method of using the single sign-on access token and the Exchange identity token together to provide a single-sign on implementation to your own backend service. By using both tokens together, you can take advantage of the benefits of the SSO access token when it is available, while ensuring that your add-in will work when it is not, such as when the user switches to a client that does not support them, or if the user's mailbox is on an on-premises Exchange server.

#### 7 **Note**

The Single Sign-on API is currently supported for Word, Excel, Outlook, and PowerPoint. For more information about where the Single Sign-on API is currently supported, see **[IdentityAPI requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/identity-api-requirement-sets)**. If you're working with an Outlook add-in, be sure to enable Modern Authentication for the Microsoft 365 tenancy. For information about how to do this, see **[Enable or disable modern authentication](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online) for Outlook in Exchange Online**.

# **Why use the SSO access token?**

The Exchange identity token is available in all requirement sets of the add-in APIs, so it may be tempting to just rely on this token and ignore the SSO token altogether. However, the SSO token offers some advantages over the Exchange identity token which make it the recommended method to use when it is available.

- The SSO token uses a standard OpenID format and is issued by Azure. This greatly simplifies the process of validating these tokens. In comparison, Exchange identity tokens use a custom format based on the JSON Web Token standard, requiring custom work to validate the token.
- The SSO token can be used by your backend to retrieve an access token for Microsoft Graph without the user having to do any additional sign in action.
- The SSO token provides richer identity information, such as the user's display name.

# **Add-in scenario**

{478}------------------------------------------------

For the purposes of this example, consider an add-in that consists of both the add-in UI and scripts (HTML + JavaScript) and a backend Web API that is called by the add-in. The backend Web API makes calls both to the [Microsoft Graph API](https://learn.microsoft.com/en-us/graph/overview) and the Contoso Data API, a fictional API created by a third party. Like the Microsoft Graph API, the Contoso Data API requires OAuth authentication. The requirement is that the backend Web API should be able to call both APIs without having to prompt the user for their credentials every time an access token expires.

To do this, the backend API creates a secure database of users. Each user will get an entry in the database where the backend can store long-lived refresh tokens for both the Microsoft Graph API and the Contoso Data API. The following JSON markup represents a user's entry in the database.

```
JSON
{
 "userDisplayName": "...",
 "ssoId": "...",
 "exchangeId": "...",
 "graphRefreshToken": "...",
 "contosoRefreshToken": "..."
}
```
The add-in includes either the SSO access token (if it is available) or the Exchange identity token (if the SSO token is not available) with every call it makes to the backend Web API.

### **Add-in startup**

- 1. When the add-in starts, it sends a request to the backend Web API to determine if the user is registered (i.e. has an associated record in the user database) and that the API has refresh tokens for both Graph and Contoso. In this call, the add-in includes both the SSO token (if available) and the identity token.
- 2. The Web API uses the methods in Authenticate a user with an single-sign-on token in an Outlook add-in and Authenticate a user with an identity token for Exchange to validate and generate a unique identifier from both tokens.
- 3. If an SSO token was provided, the Web API then queries the user database for an entry that has an ssoId value that matches the unique identifier generated from the SSO token.
	- If an entry did not exist, continue to the next step.
	- If an entry exists, proceed to step 5.

{479}------------------------------------------------

- 4. The Web API queries the database for an entry that has an exchangeId value that matches the unique identifier generated from the Exchange identity token.
	- If an entry exists and an SSO token was provided, update the user's record in the database to set the ssoId value to the unique identifier generated from the SSO token and proceed to step 5.
	- If an entry exists and no SSO token was provided, proceed to step 5.
	- If no entry exists, create a new entry. Set ssoId to the unique identifier generated from the SSO token (if available), and set exchangeId to the unique identifier generated from the Exchange identity token.
- 5. Check for a valid refresh token in the user's graphRefreshToken value.
	- If the value is missing or invalid and an SSO token was provided, use the [OAuth2 On-Behalf-Of flow](https://learn.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-protocols-oauth-on-behalf-of) to obtain an access token and refresh token for Graph. Save the refresh token in the graphRefreshToken value for the user.
- 6. Check for valid refresh tokens in both graphRefreshToken and contosoRefreshToken .
	- If both values are valid, respond to the add-in to indicate that the user is already registered and configured.
	- If either value is invalid, respond to the add-in to indicate that user setup is required, along with which services (Graph or Contoso) need to be configured.
- 7. The add-in checks the response.
	- If the user is already registered and configured, the add-in continues with normal operation.
	- If user setup is required, the add-in enters "setup" mode and prompts the user to authorize the add-in.

### **Authorize the backend Web API**

The procedure for authorizing the backend Web API to call the Microsoft Graph API and Contoso Data API should ideally only have to happen once, to minimize having to prompt the user for sign-in.

Based on the response from the backend Web API, the add-in may need to authorize the user for the Microsoft Graph API, the Contoso Data API, or both. Since both APIs use OAuth2 authentication, the method is similar for both.

{480}------------------------------------------------

- 1. The add-in notifies the user that it needs them to authorize their use of the API and asks them to click a link or button to start the process.
- 2. Once the flow completes, the add-in sends the refresh token to the backend Web API and includes the SSO token (if available) or the Exchange identity token.
- 3. The backend Web API locates the user in the database and updates the appropriate refresh token.
- 4. The add-in continues with normal operation.

### **Normal operation**

Whenever the add-in calls the backend Web API, it includes either the SSO token or the Exchange identity token. The backend Web API locates the user by this token, then uses the stored refresh tokens to obtain access tokens for the Microsoft Graph API and the Contoso Data API. As long as the refresh tokens are valid, the user will not have to sign in again.

{481}------------------------------------------------

# **Nested app authentication and Outlook legacy tokens deprecation FAQ**

07/28/2025

Exchange user identity tokens and callback tokens are deprecated and will be completely turned off by August 2025. We recommend moving Outlook add-ins that use legacy Exchange tokens to nested app authentication.

# **General FAQ**

### **What is nested app authentication (NAA)?**

Nested app authentication enables single sign-on (SSO) for applications nested inside of supported Microsoft applications such as Outlook. Compared with existing full-trust authentication models, and the on-behalf-of flow, NAA provides better security and greater flexibility in app architecture, enabling the creation of rich, client-driven applications. For more information, see Enable SSO in an Office Add-in using nested app authentication.

### **What is the timeline for shutting down legacy Exchange online tokens?**

Legacy Exchange online tokens have already been turned off for most tenants. We've provided tooling for administrators to reenable Exchange tokens for tenants and add-ins if those add-ins aren't yet migrated to NAA. For more information, see Can I turn legacy tokens back on?.

| Date                                 | Legacy tokens status                                                                                                                                                                                                                                                                                                             |
|--------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Now                                  | Legacy tokens turned off for most tenants. Admins can reenable legacy tokens via<br>PowerShell.                                                                                                                                                                                                                                  |
| August 1 2025<br>- September<br>2025 | Legacy tokens are turned off for all tenants. This process will take several weeks to<br>complete. Admins can no longer reenable legacy tokens via PowerShell. Admins can<br>request an exception through Microsoft Support at<br>https://aka.ms/LegacyTokensByOctober<br>(this link requires you to sign in to your<br>tenant). |
| October 2025                         | Legacy tokens turned off for all tenants. Exceptions are no longer allowed.                                                                                                                                                                                                                                                      |

{482}------------------------------------------------

### **When is NAA generally available for my channel?**

The general availability (GA) date for NAA depends on which channel you are using.

ノ **Expand table**

| Date          | NAA General Availability (GA)                                               |  |
|---------------|-----------------------------------------------------------------------------|--|
| October 2024  | NAA is GA in Current Channel.                                               |  |
| November 2024 | NAA is GA in Monthly Enterprise Channel.                                    |  |
| January 2025  | NAA is GA in Semi-Annual Channel Version 2408 (Build 17928.20392).          |  |
| June 2025     | NAA is GA in Semi-Annual Extended Channel Version 2408 (Build 17928.20604). |  |

### **How do I handle legacy tokens turned off in Semi-Annual Extended Channel, which doesn't support NAA yet?**

Semi-Annual Extended Channel version 2402 doesn't support NAA. To avoid any service interruption to Outlook add-ins on your tenant, we recommend you upgrade to Semi-Annual Extended Channel version 2408. This version is available as of July 8, 2025.

From **now through August 1 2025** we recommend administrators on Semi-Annual Extended Channel **upgrade to version 2408**. Administrators can [request an exception](https://aka.ms/LegacyTokensByOctober) through Microsoft Support if they need more time.

We also recommend to check if your tenant is using any add-ins that require legacy Exchange Online tokens. For more information, see [Find Outlook add-ins that use legacy Exchange](https://github.com/OfficeDev/office-js/tree/release/add-in-ids) [Online tokens](https://github.com/OfficeDev/office-js/tree/release/add-in-ids) .

### **Are COM Add-ins affected by the deprecation of legacy Exchange Online tokens?**

It's very unlikely any COM add-ins are affected by the deprecation of legacy Exchange Online tokens. Outlook web add-ins are primarily affected because they can use Office.js APIs that rely on Exchange tokens. For more information, see How do i know if my outlook add in relies on legacy tokens. The Exchange tokens are used to access Exchange Web Services (EWS) or Outlook REST APIs, both of which are also deprecated. If you suspect a COM add-in might be affected, you can test it by using it on a tenant with Exchange tokens turned off. For more information, see Turn legacy Exchange Online tokens on or off.

{483}------------------------------------------------

# **Microsoft 365 administrator questions**

### **Which add-ins in my organization are impacted?**

Use the Get-AuthenticationPolicy command to get a list of all Outlook add-ins that use legacy Exchange Online tokens on your tenant. For more information, see Turn legacy Exchange Online tokens on or off. Once you have the list of add-ins, you'll need to reach out to the publishers to learn more about their plans to update. In some cases, the add-in may be developed by your own organization. You'll need to reach out to the appropriate development team in your organization.

### **What commands can I use to identify the publisher?**

There are some Exchange Online PowerShell commands you can use to track down additional information about Outlook add-ins.

To find a list of add-ins installed on a user's computer, the user can run the following command.

Get-App | Select-Object -Property ProviderName, DisplayName, AppId

The following screenshot shows an example of running the Get-App command.

|                                                                      | PS C:\> Get-App   Select-Object -Property ProviderName, DisplayName, AppId |                                                                              |
|----------------------------------------------------------------------|----------------------------------------------------------------------------|------------------------------------------------------------------------------|
| ProviderName                                                         | DisplayName                                                                | AppId                                                                        |
| Microsoft Corporation Polls<br>Microsoft Corporation Send to OneNote |                                                                            | afde34e6-58a4-4122-8a52-ef402180a878<br>6b47614e-0125-454b-9f76-bd5aef85ac7b |

The **ProviderName** will help you identify who published the add-in so that you can contact them. The **AppId** can be used to get additional details about the add-in.

To find information about an add-in by AppId use the following command.

Get-App -Identity {identity} | Select-Object -Property ProviderName, DisplayName

{484}------------------------------------------------

The following screenshot shows an example of using the ID of Bing Maps to get more information.

You may also find additional information in the add-in's manifest file. The manifest contains URL endpoints which can also help you identify and contact the publisher. Use the following command to get the manifest.

Get-App -Identity {identity} | Select-Object -Property ManifestXml

The following screenshot shows an example of using the ID to get the XML manifest for Bing Maps.

7 **Note**

Outlook add-ins you deployed from Microsoft AppSource can be identified using a list that we published. No testing is necessary. For more information, see **How do I identify add-ins published to Microsoft AppSource**.

### **How do I identify add-ins published to Microsoft AppSource**

We posted a list of all Outlook add-ins published to the Microsoft AppSource that use legacy tokens as of April 2025. For more information on how to use the list and build a report of Outlook add-ins that potentially use legacy tokens, see [Find Outlook add-ins that use legacy](https://github.com/OfficeDev/office-js/tree/release/add-in-ids) [Exchange Online tokens](https://github.com/OfficeDev/office-js/tree/release/add-in-ids) .

### **How would ISVs know their add-in is using legacy tokens?**

Add-ins may use the legacy tokens to get resources from Exchange through the EWS or Outlook REST APIs. Sometimes an add-in requires Exchange resources for some use cases and not others, making it difficult to figure out whether the add-in requires an update. We recommend reaching out to add-in developers and owners to ask them if their add-in code references the following APIs.

makeEwsRequestAsync

{485}------------------------------------------------

- getUserIdentityTokenAsync
- getCallbackTokenAsync

If you rely on an ISV for your add-in, we recommend you contact them as soon as possible to confirm they have a plan and a timeline for moving off of legacy Exchange tokens. ISV developers should reach out directly to their Microsoft contacts with questions to ensure they're ready for the end of Exchange legacy tokens. If you rely on a developer within your organization, they should review this FAQ and the article Enable SSO in an Office Add-in using nested app authentication. Any questions should be raised on the [OfficeDev/office-js GitHub](https://github.com/OfficeDev/office-js/issues) [issues site](https://github.com/OfficeDev/office-js/issues) .

### **What do I do for add-ins I can't identify?**

It's possible after running Get-AuthenticationPolicy there could be some custom add-ins that you can't identify the owner. For those add-ins you may need to perform a scream test. We recommend that administrators perform a scream test before August 2025 to determine if there are any remaining add-ins that will break when legacy tokens are turned off in August. This will give you time to reach out to publishers of any affected add-ins to address breaking issues before the August deadline.

#### 7 **Note**

You only need to perform the scream test if you turned legacy Exchange Online tokens on by using the Set-AuthenticationPolicy command. If you haven't run this command, then Exchange Online tokens should already be off by default.

Before performing the scream test you may want to let your users know in advance, such as through email, that there will be a test to turn off legacy tokens and that it may affect some Outlook add-ins. You should consider providing users the following information.

- The expected time period of the test.
- If there are known Outlook add-ins that will break, such as add-ins deployed from Microsoft AppSource that you've already identified.
- That in general, Outlook add-ins shouldn't break. However, if they do see issues, ask users to report the name, and description of the add-in, along with any error information observed.

Use the following steps to perform the test.

- 1. Run the following command to turn off legacy Exchange Online tokens on your tenant. For details on how to use this command, see Turn legacy Exchange Online tokens on or

{486}------------------------------------------------

off.

Set-AuthenticationPolicy -BlockLegacyExchangeTokens -Identity "LegacyExchangeTokens"

- 2. Wait a suitable amount of time for users to report any issues with add-ins. It takes approximately 24 hours for the command to turn off legacy Exchange Online tokens for all users. It may take another day or two for users to report any issues with Outlook addins.
- 3. Identify any affected Outlook add-ins. If users submit issues identifying breaking issues, be sure to get the name and description of the Outlook add-in affected. Also capture the error, or behavior so this information can be passed along to the publisher.
- 4. If any business-critical add-ins are broken, turn tokens back on using the following command. For details on how to use this command, see Turn legacy Exchange Online tokens on or off.

Set-AuthenticationPolicy -AllowLegacyExchangeTokens -Identity "LegacyExchangeTokens"

It takes approximately 24 hours for tokens to turn back on for all users on the tenant.

- 5. If there are no reports of breaking issues, we recommend you leave legacy Exchange Online tokens off as a security best practice.
### **Can I turn Exchange Online legacy tokens back on?**

Yes, there are PowerShell commands you can use to turn legacy tokens on or off in any tenant. For more information on how to turn legacy tokens on or off, see Turn legacy Exchange Online tokens on or off.

In August 2025, legacy tokens will be turned off and you won't be able to turn them back on. Admins can request an exception through Microsoft Support at <https://aka.ms/LegacyTokensByOctober> (this link requires you to sign in to your tenant). In

October 2025, it won't be possible to turn on legacy tokens and they'll be disabled for all tenants.

### **How does the admin consent flow work?**

Independent software vendors (ISVs) are updating their add-ins to use Entra ID tokens and Microsoft Graph scopes. When the add-in requests an access token, it must have admin or user consent. If the administrator consents, all users on the tenant can use the add-in for the scopes the add-in requires. Otherwise, each end-user will be prompted for consent, if [user consent is](https://learn.microsoft.com/en-us/microsoft-365/admin/misc/user-consent) [enabled.](https://learn.microsoft.com/en-us/microsoft-365/admin/misc/user-consent) For a better experience because the users aren't prompted, complete admin consent.

{487}------------------------------------------------

One option for consent is that the ISV provides you with an admin consent URI.

- 1. The add-in developer provides an admin consent URI. If this is not in the documentation they provide, you need to contact them for more information.
- 2. The administrator browses to the admin consent URI.
- 3. The administrator is prompted to sign in and consent to a list of scopes that the add-in requires.
- 4. Once complete, the browser redirects to a web page from the ISV, which should show the consent was successful.

As an alternative, the ISV may provide an updated app manifest that will prompt for admin consent as part of central deployment. In this scenario, when you deploy the updated app manifest, you'll be prompted to consent before the deployment can complete. There is no need for an admin consent URI.

Finally, if the add-in is published in the Microsoft 365 store, the update will deploy automatically and the administrator will be prompted to consent to the scopes. If the administrator doesn't consent, users won't be able to use the updated add-in.

### **What if the add-in doesn't work after admin consent?**

Ensure you don't disable features, or revoke permissions that the add-in requires. For an example, see [modifying mailbox policy properties](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/outlook-on-the-web/configure-outlook-web-app-mailbox-policy-properties). The add-in uses delegated permissions and therefore has access to the same resources as the signed-in user. However, if a policy or setting blocks the user from a particular resource or action, the add-in will also be blocked.

### **How do I deploy add-in updates from an ISV?**

If you have an add-in that uses legacy Exchange tokens, you should reach out to your ISV for information about their timeline to migrate their add-in to use NAA. Once the ISV migrates their add-in, they will most likely provide an admin consent URL. For more information, see How does the admin consent flow work? .

The ISV may also provide you with an updated app manifest to deploy through centralized deployment. During centralized deployment, this may prompt you to consent to any Microsoft Graph scopes the add-in requires. In this scenario you won't need to use an admin consent URI.

If the add-in is deployed from Microsoft AppSource, most likely you'll be prompted to consent to Microsoft Graph scopes when the ISV rolls out updates to the add-in. Until you consent, users on the tenant won't be able to use the new version of the add-in with NAA.

{488}------------------------------------------------

### **Where do I find which add-ins have consent?**

Once the admin or a user consents, it will be listed in the Microsoft Entra admin center. You can find app registrations using the following steps.

- 1. Go to <https://entra.microsoft.com/#home>and sign in as admin on your tenant.
- 2. In the left navigation pane, select **Applications** > **Enterprise applications**.
- 3. On the **Enterprise applications** page, in the **Manage** section, select **All applications**.
- 4. Select the Add-in. This will open an overview page. In the overview page, select **Permissions**. There are two views for permissions; Admin consent, and User consent. Select User consent to see any individual consents.

### **Is there a list of publishers that have updated their add-ins?**

Some widely used Outlook add-in publishers have already updated their add-ins as listed below.

- [Appfluence Priority Matrix for Outlook](https://appsource.microsoft.com/product/office/wa104381735)
- [Atlassian Jira Cloud for Outlook](https://marketplace.atlassian.com/apps/1220666/jira-cloud-for-outlook-official?tab=overview&hosting=cloud)
- [Box for Outlook](https://appsource.microsoft.com/product/office/WA200000015)
- [Clickup for Outlook](https://appsource.microsoft.com/product/office/WA104382026)
- [iEnterprises® Outlook Connector](https://ienterprises.com/connector/outlook-connector)
- [HubStar Connect](https://www.hubstar.com/solutions/connect/)
- [SalesForce for Outlook](https://appsource.microsoft.com/product/office/wa104379334)
- [LawToolBox](https://lawtoolbox.com/lawtoolbox-for-copilot/)
- [OnePlace Solutions](https://www.oneplacesolutions.com/oneplacemail-sharepoint-app-for-outlook.html)
- [Set-OutlookSignatures Benefactor Circle](https://set-outlooksignatures.com/)
- [Wrike](https://appsource.microsoft.com/product/office/wa104381120)
- [Zoho CRM for Email](https://appsource.microsoft.com/product/office/WA104379468)
- [Zoho Recruit for Email](https://appsource.microsoft.com/product/office/WA200001485)
- [Zoho Projects for Email](https://appsource.microsoft.com/product/office/WA200006712)
- [Zoho Sign for Outlook](https://appsource.microsoft.com/product/office/WA200002326)
- [Zoho WorkDrive for Email](https://appsource.microsoft.com/product/office/WA200006673)
- [Invoice and Time Tracking Zoho Invoice](https://appsource.microsoft.com/product/office/WA104381067)

If the publisher updated their manifest, and the add-in is deployed through the Microsoft store, you'll be prompted as an administrator to upgrade and deploy the updates. If the publisher updated their manifest, and the add-in is deployed through central deployment, you'll need to deploy the new manifest as an administrator. In some cases the publisher may have an admin consent URI you need to use to consent to new scopes for the add-in. Reach out to publishers if you need more information about updating an add-in.

{489}------------------------------------------------

### **Some add-ins are breaking. Can I tell if this is because Exchange tokens were turned off?**

If you notice that an add-in has issues and suspect it may be affected by Exchange tokens turned off, please take the following actions.

### **Check the list of known add-ins**

We posted a list of add-ins that were known to be using legacy Exchange tokens as of October 2024. If an add-in is on this list, you should reach out to the publisher to see if there are updates available. For more information, see [Find Outlook add-ins that use legacy Exchange](https://github.com/OfficeDev/office-js/tree/release/add-in-ids) [Online tokens](https://github.com/OfficeDev/office-js/tree/release/add-in-ids)

### **Check if tokens are off by using Script Lab**

Check if legacy Exchange Online tokens are off for a user by using the Script Lab add-in.

- 1. Install [Script Lab for Outlook](https://appsource.microsoft.com/en-us/product/office/WA200001603) .
- 2. Sign in to Outlook with the user account/mailbox that is affected. Exchange tokens can be off for one user, but not another until the rollout is complete.
- 3. From an existing or new email, open Script Lab from the **Apps** menu, and choose **Code** from the Script Lab menu.

- 4. In the Script Lab task pane, select the backstage icon (it has three lines).

{490}------------------------------------------------

- 5. Select **Samples** and then search for the **Get a user identity token** sample. Select this sample to open it in the code editor.
- 6. After the code for the sample is loaded, select **Run** > **Run in this pane**.
- 7. After the code runs, select **Get token**.
If legacy Exchange Online tokens are on, you'll see a token displayed in the console as a Base64-encoded string.

{491}------------------------------------------------

If legacy Exchange Online tokens are off, you'll see an error displayed in the console as shown below.

{492}------------------------------------------------

| Script Lab for Ou                                                                                                                                                                                                                                                                               |  |  |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|
| O Get a callback token                                                                                                                                                                                                                                                                          |  |  |
| This sample shows how to get a callback token<br>to call Outlook services from an add-in's backend<br>service.                                                                                                                                                                                  |  |  |
| Important: Exchange user identity and callback<br>tokens are only supported in Exchange on-<br>premises environments. Additionally, the Outlook<br>REST v2.0 endpoint has been deprecated. Use<br>nested app authentication (NAA) to get an<br>access token instead.<br>Try it out<br>Get token |  |  |
| Last updated 25 seconds ago                                                                                                                                                                                                                                                                     |  |  |
| Auto-scroll                                                                                                                                                                                                                                                                                     |  |  |
| "status":"failed","error":<br>{"name":"GenericTokenError","message":"An<br>internal error has<br>occurred.","code":9018}}                                                                                                                                                                       |  |  |

The actual error and code can vary, but often you will see error code 9017 or 9018 along with the following error descriptions.

- GenericTokenError: An internal error has occurred.
- InternalServerError: The Exchange server returned an error. Please look at the diagnostics object for more information.

If an add-in is affected by Exchange tokens turned off, you can turn them back on. For more information, see Can I turn Exchange Online legacy tokens back on?.

# **Outlook add-in migration FAQ**

### **Why is Microsoft making Outlook add-ins migrate?**

Switching to Microsoft Graph using Entra ID tokens is a big improvement in security for Outlook and Exchange customers. Entra ID (formerly Azure Active Directory) is a leading cloudbased identity and access management service. Customers can take advantage of zero trust features such as conditional access, MFA requirements, continual token monitoring, real time safety heuristics, and more that aren't available with legacy Exchange tokens. Customers store important business data stored in Exchange, so it's vital that we ensure this data is protected.

{493}------------------------------------------------

Migrating the whole Outlook ecosystem to use Entra ID tokens with Microsoft Graph greatly improves security for customer data.

### **Does my Outlook add-in have to migrate to NAA?**

No. Outlook add-ins don't have to use NAA, although NAA offers the best authentication experience for users and the best security posture for organizations. If add-ins aren't using legacy Exchange tokens, they won't be affected by the deprecation of Exchange tokens. Addins using MSAL.js or other SSO methods that rely on Entra ID will continue to work.

### **How do I know if my Outlook add-in relies on legacy tokens?**

To find out whether your add-in uses legacy Exchange user identity tokens and callback tokens, search your code for calls to the following APIs.

- makeEwsRequestAsync
- getUserIdentityTokenAsync
- getCallbackTokenAsync

If your add-in calls any of these APIs, you should adopt NAA and migrate to using Entra ID tokens to access Microsoft Graph instead.

### **Which Outlook add-ins are in scope?**

Many major add-ins are in scope. If your add-in is using EWS or Outlook REST to access Exchange Online resources, it almost certainly needs to migrate off of legacy Outlook tokens to NAA. If your add-in is for Exchange on-premises only (for example, Exchange 2019), it's not affected by this change.

### **What will happen to my Outlook add-ins if I don't migrate to NAA?**

If you don't migrate your Outlook add-ins to NAA, they'll stop working as expected in Exchange Online. When Exchange tokens are turned off, Exchange Online will block legacy token issuance. Any add-in that uses legacy tokens won't be able to access Exchange online resources. When your add-in calls an API that requests an Exchange token, such as getUserIdentityTokenAsync , it gets a generic error similar to the following with error codes such as 9017 or 9018.

- "GenericTokenError: An internal error has occurred."

{494}------------------------------------------------

- "InternalServerError: The Exchange server returned an error. Please look at the diagnostics object for more information."
If your add-in only works on-premises or if your add-in is on a deprecation path, you may not need to update. However, most add-ins that access Exchange resources through EWS or Outlook REST must migrate to continue functioning as expected.

### **How do I migrate my Outlook add-ins to NAA?**

To support NAA in your Outlook add-in, please refer to the following documentation and sample.

- Enable SSO in an Office Add-in using nested app authentication.
- [Outlook add-in with SSO using nested app authentication](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Outlook-Add-in-SSO-NAA) .

### **How do I keep up with the latest guidance?**

We'll update this FAQ as any new information becomes available. We'll share additional guidance moving forward on the Office Add-ins community call and the [M365 developer](https://devblogs.microsoft.com/microsoft365dev/) [blog](https://devblogs.microsoft.com/microsoft365dev/) . Finally, you can ask questions about NAA and legacy Exchange Online token deprecation on the [OfficeDev/office-js GitHub issues site](https://github.com/OfficeDev/office-js/issues) . Please put "NAA" in the title so we can group and prioritize issues.

If you submit an issue, please include the following information.

- Outlook client version.
- Outlook release channel audience (for client).
- Screen capture of the issue.
- The platform where the issue occurs (Windows, Outlook (new), Mac, iOS, Android).
- Session id where the issue is encountered.
- Type of account being used.
- Version of msal-browser.
- Logs from msal-browser.

# **Developer questions**

### **How do I get more debug information from MSAL and NAA?**

Use the following code to enable debug information in the msalConfig when you initialize the nestable public client application. This will log additional details to the console.

{495}------------------------------------------------

JavaScript

```
const msalConfig = {
 auth: {...},
 system: {
 loggerOptions: {
 logLevel: LogLevel.Verbose,
 loggerCallback: (level, message, containsPii) => {
 switch (level) {
 case LogLevel.Error:
 console.error(message);
 return;
 case LogLevel.Info:
 console.info(message);
 return;
 case LogLevel.Verbose:
 console.debug(message);
 return;
 case LogLevel.Warning:
 console.warn(message);
 return;
 }
 },
 }
 }
};
```
### **Test your updated add-in**

Once you've updated your add-in to use NAA, you should test it on all platforms you support, such as Mac, mobile, web, and Outlook on Windows.

### **Test when Exchange tokens turned off**

To test that your add-in works correctly when Exchange tokens are turned off, deploy your add-in to a tenant with tokens turned off and test it. To turn tokens off, see Turn legacy Exchange Online tokens on or off.

If you've implemented a pattern where your code uses Exchange tokens but then falls over if they are unavailable, be sure you are checking for the correct errors. When a call to get an Exchange token fails, check the [asyncResult.diagnostics.](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult) If either of the following errors is returned, switch to NAA.

- GenericTokenError: An internal error has occurred.
- InternalServerError: The Exchange server returned an error. Please look at the diagnostics object for more information.

{496}------------------------------------------------

### **Test fallback code for Trident+ webview**

If your Outlook add-in supports Outlook 2016 or Outlook 2019 on Windows, test that it works correctly when the Trident+ (Internet Explorer 11) webview is used. When the Trident+ webview is used, your code must fall back to MSAL v2 to open a dialog and sign in the user. For more information on how to implement the fallback pattern, see [Outlook add-in with SSO using](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Outlook-Add-in-SSO-NAA-IE) [nested app authentication including Internet Explorer fallback](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Outlook-Add-in-SSO-NAA-IE) .

#### 7 **Note**

Support for Outlook 2016 and Outlook 2019 ends October 2025. For more information, see **[End of support for Office 2016 and Office 2019](https://support.microsoft.com/office/818c68bc-d5e5-47e5-b52f-ddf636cf8e16)** .

#### **Testing in Trident+ and WebView2**

Outlook 2016 and Outlook 2019 on Windows use the Trident+ or WebView2 based on various OS conditions.

- For more information on when Trident+ or Webview2 is used, see Browsers and webview controls used by Office Add-ins.
- For more information on how to determine which webview is running, see Support older Microsoft webviews and Office versions

#### 7 **Note**

Support for Outlook 2016 and Outlook 2019 ends October 2025. For more information, see **[End of support for Office 2016 and Office 2019](https://support.microsoft.com/office/818c68bc-d5e5-47e5-b52f-ddf636cf8e16)** .

### **What tokens does MSAL return and are there minimum scopes to request?**

When you request a token through MSAL, it always returns three tokens.

| Token    | Purpose                                                           | Scopes             | AuthencationResult<br>property |
|----------|-------------------------------------------------------------------|--------------------|--------------------------------|
| ID token | Provides information about the user<br>to the client (task pane). | profile and openid | authResult.idToken             |

{497}------------------------------------------------

| Token            | Purpose                                                                                  | Scopes                                    | AuthencationResult<br>property |
|------------------|------------------------------------------------------------------------------------------|-------------------------------------------|--------------------------------|
| Refresh<br>token | Refreshes the ID and access tokens<br>when they expire.                                  | offline_access                            | Not available.                 |
| Access<br>token  | Authenticates the user for specific<br>scopes to a resource, such as<br>Microsoft Graph. | Any resource scopes,<br>such as user.read | authResult.accessToken         |

MSAL always returns these three tokens. It requests the profile , openid , and offline_access as default scopes even if your token request doesn't include them. This ensures the ID and refresh tokens are requested. However, you must include at least one resource scope, such as user.read so that you get an access token. If not, the request can fail.

### **Should I validate the ID token from MSAL?**

No. This is a legacy authentication pattern that was used with Exchange tokens to authorize access to your own resources. Passing the ID token over a network call to enable or authorize access to a service is a security anti-pattern. The ID token is intended only for the client (task pane) and there is no way for the service to reliably use the token to be sure the user has authorized access. For more information about ID token claims, see [ID token claims reference.](https://learn.microsoft.com/en-us/entra/identity-platform/id-token-claims-reference)

It's very important that you always request an access token to your own services. The access token also includes the same ID claims, so you don't need to pass the ID token. Instead create a custom scope for your service. For more information about app registration settings for your own services, see [Protected web API: App registration](https://learn.microsoft.com/en-us/entra/identity-platform/scenario-protected-web-api-app-registration). When your service receives the access token, it can validate it, and use ID claims from inside the access token.

### **Why am I getting errors from conditional access policies?**

The **approved client app Conditional Access grant** is deprecated and will retire in March 2026. MSAL NAA does not support this policy and will return errors (even if you grant the add-in an exception to this policy.) To migrate off of this policy, see [Migrate approved client app to](https://learn.microsoft.com/en-us/entra/identity/conditional-access/migrate-approved-client-app) [application protection policy in Conditional Access](https://learn.microsoft.com/en-us/entra/identity/conditional-access/migrate-approved-client-app).

Some conditional access policies will cause issues for add-ins using MSAL NAA depending on what they require from the client. Often these are related to device management policies. For more information, see device management types in [How to create and assign app protection](https://learn.microsoft.com/en-us/intune/intune-service/apps/app-protection-policies) [policies.](https://learn.microsoft.com/en-us/intune/intune-service/apps/app-protection-policies)

Sometimes you need to handle claims challenges based on policies. To learn more on how to handle a claims challenge in your add-in, see [Claims challenges, claims requests and client](https://learn.microsoft.com/en-us/entra/identity-platform/claims-challenge)

{498}------------------------------------------------

### **Why is the ID token not refreshed?**

There is a known issue where MSAL sometimes doesn't refresh the ID token after it expires. This shouldn't cause any issues in your add-in since the ID token is only intended for use in your task pane to get basic user identity information, such as name and email. There's no reason to validate the ID token or check the expiration claim. If you need to authenticate the user to your own resources, use the access token which also contains user identity information. The ID token must never be passed outside of your client code that received it.

### **How do I determine if the user is an online or on-premise account?**

You can determine if the signed-in user has an Exchange Online account or on-premise Exchange account by using the [Office.UserProfile.accountType](https://learn.microsoft.com/en-us/javascript/api/outlook/office.userprofile) property. If the account type property value is **enterprise**, then the mailbox is on an on-premises Exchange server. Note that volume-licensed perpetual Outlook 2016 doesn't support the **accountType** property. To work around this, call the [ResolveNames](https://learn.microsoft.com/en-us/exchange/client-developer/web-service-reference/resolvenames-operation) operation in Exchange Web Service (EWS) in the Exchange on-premise server to get the recipient types.

#### 7 **Note**

Support for Outlook 2016 and Outlook 2019 ends October 2025. For more information, see **[End of support for Office 2016 and Office 2019](https://support.microsoft.com/office/818c68bc-d5e5-47e5-b52f-ddf636cf8e16)** .

The **accountType** property requires mailbox requirement set 1.6. On older Outlook clients you'll need to use the Autodiscover service as follows.

Call the Autodiscover endpoint for the outlook.office365.com domain. https://outlook.office365.com/autodiscover/autodiscover.json/v1.0/{email}? Protocol=EWS&ServerLocation=true

- For **online** accounts, the service will return a result with the ServerLocation key set to Exchange Online.
- For **on-premise** accounts, the service will not return a ServerLocation key.

7 **Note**

{499}------------------------------------------------

For customers that use vanity URLs, you need to specifically configure your add-in to call the Autodiscover service on the vanity URL endpoint.

### **How do I deploy my add-in to Microsoft AppSource**

If you're publishing a new add-in to Microsoft AppSource, it will need to go through a certification process. For more information, see Publish your Office Add-in to Microsoft AppSource. If you're updating the manifest of an add-in that is already published to Microsoft AppSource, you need to go through the certification process again. You can update the addin's source code on your web server any time without a need to go through the certification process.

If you're add-in uses SSO through NAA, your add-in must be in compliance with the following publishing guidelines.

- 1000.3 Authentication options
- 1120.3 Functionality

Be sure to handle admin consent properly. See Publish an add-in that requires admin consent for Microsoft Graph scopes

For additional deployment details, see [Make your solutions available in Microsoft AppSource](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/submit-to-appsource-via-partner-center) [and within Office.](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/submit-to-appsource-via-partner-center) If you update your add-in (change the manifest) you need to go through the certification process again. You can update your web server code any time without a need for review.

### **Users get an unexplained error when signing in**

When your add-in requests a token, users may see a sign-in popup dialog showing one of the following errors.

- **Something went wrong.** [*error code*]
- **You can't get there from here**

Check to see if the admin has any conditional access policies applied that enforce specific client restrictions, such as mobile location, or platform type. Also the **approved client app Conditional Access grant** is deprecated and will cause these errors with NAA token requests. An admin must completely remove this policy and switch over to the newer **application protection policy grant** for NAA to work. For more information, see [Migrate approved client](https://learn.microsoft.com/en-us/entra/identity/conditional-access/migrate-approved-client-app) [app to application protection policy in Conditional Access.](https://learn.microsoft.com/en-us/entra/identity/conditional-access/migrate-approved-client-app)

{500}------------------------------------------------

# **Related content**

- Enable SSO in an Office Add-in using nested app authentication.
- [Outlook add-in with SSO using nested app authentication](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Outlook-Add-in-SSO-NAA) .

{501}------------------------------------------------

# **Turn legacy Exchange Online tokens on or off**

07/11/2025

Legacy Exchange Online tokens are deprecated and will be turned off across Microsoft 365 tenants starting February 17th, 2025. If you're a developer migrating your Outlook add-in from legacy tokens to Entra ID tokens and nested app authentication, you'll need to test updates to your add-in. Use the Exchange Online PowerShell cmdlets to turn off legacy tokens in a test tenant to confirm that your updated Outlook add-in is working correctly.

For more information about deprecation of legacy Exchange Online tokens, see [Nested app](https://aka.ms/NAAFAQ) [authentication and Outlook legacy tokens deprecation FAQ](https://aka.ms/NAAFAQ) .

# **Connect to Exchange Online PowerShell**

To run the commands you need to connect to Exchange Online PowerShell.

- 1. Open PowerShell.
- 2. Run the command Import-Module -Name ExchangeOnlineManagement . For more information about this command, see [Exchange Online PowerShell.](https://learn.microsoft.com/en-us/powershell/exchange/exchange-online-powershell)
- 3. To be sure you are on the latest version of the module, run the command Update-Module -Name ExchangeOnlineManagement .
- 4. Run the command Connect-ExchangeOnline . Sign in with your Microsoft 365 administrator credentials.

# **Turn off legacy Exchange Online tokens**

The Set-AuthenticationPolicy command controls the issuance of legacy Exchange Online tokens. When issuance is turned off, add-ins can no longer request user identity tokens or callback tokens. Existing tokens already issued will continue to work until they expire. It can take up to 24 hours before all request from Outlook add-ins for legacy Exchange Online tokens are blocked.

To turn legacy tokens off, run the following command.

Set-AuthenticationPolicy -BlockLegacyExchangeTokens -Identity "LegacyExchangeTokens"

The command turns off legacy tokens for the entire tenant. If an Outlook add-in requests a legacy token, it won't be issued a token.

{502}------------------------------------------------

#### 7 **Note**

If you've confirmed that your tenant is not using any add-ins that require legacy Exchange Online tokens, we recommend you turn off legacy Exchange Online tokens as a security best practice. For more information on how to determine if you tenant has add-ins using legacy tokens, see the **Nested app authentication and Outlook legacy tokens deprecation FAQ**.

# **Turn on legacy Exchange Online tokens**

To turn legacy tokens on, run the following command. It can take up to 24 hours before all requests from Outlook add-ins for legacy tokens are allowed.

Set-AuthenticationPolicy -AllowLegacyExchangeTokens -Identity "LegacyExchangeTokens"

Important notes about this command.

- Legacy Exchange tokens issued to Outlook add-ins before token blocking was implemented in your organization will remain valid until they expire.
- If you turn on legacy Exchange Online tokens, then they won't be turned off in February 2025 when Microsoft turns them off for all tenants. For more information, see Nested app authentication and Outlook legacy tokens deprecation FAQ.
- You'll only be able to turn tokens back on until August 2025 when all legacy tokens in all tenants will be forced off. For more information, see the [Nested app authentication and](https://aka.ms/NAAFAQ) [Outlook legacy tokens deprecation FAQ](https://aka.ms/NAAFAQ) .
- Although the -Identity parameter is required, it doesn't affect any specific authentication policy. The command always applies to the entire organization regardless of what value you use. We show the value as LegacyExchangeTokens in the examples to keep the intent clear.

# **Get the status of legacy Exchange Online tokens and add-ins that use them**

To view the status of legacy Exchange Online tokens, run the following command.

Get-AuthenticationPolicy -AllowLegacyExchangeTokens

The command returns whether AllowLegacyExchangeTokens is true or false, such as the following example in PowerShell.

{503}------------------------------------------------

```
Console
```

```
PS C:\> Get-AuthenticationPolicy -AllowLegacyExchangeTokens
AllowLegacyExchangeTokens: False
Allowed: []
Blocked: []
PS C:\>
```
The **Allowed** and **Blocked** sections list the IDs of any add-ins that made recent requests. If an add-in ID is listed in the **Allowed** list, it was granted an Exchange token. If an add-in ID is listed in the **Blocked** list, it was denied an access token because access tokens are turned off. The following example shows the Script Lab ID being granted a token on May 16, and also blocked from a token on February 25th. Tokens were turned off for the tenant in February, and turned on in May, so Script Lab appears in both sections.

```
Console
PS C:\> Get-AuthenticationPolicy -AllowLegacyExchangeTokens
AllowLegacyExchangeTokens: True
Allowed:
[
 { "49d3b812-abda-45b9-b478-9bc464ce5b9c" : "2025-05-16" }
]
Blocked:
[
 { "49d3b812-abda-45b9-b478-9bc464ce5b9c" : "2025-02-25" }
]
```
The report only shows a single entry per add-in. If multiple calls from many users are made from a single add-in for Exchange tokens, those calls appear in the report as one request. The date updates every seven days. In the previous example, the report shows Script lab being granted tokens on May 16. The date won't change unless Script Lab continues to make token requests on May 23rd at which point the report will update the date.

To confirm an add-in is no longer requesting Exchange tokens, run the command after seven days and check that the date doesn't change.

If you have IDs listed in **Allowed** or **Blocked** that are requesting legacy tokens, identify the publisher and reach out to them to ensure they are migrating their add-in away from legacy tokens. For more information on identifying publishers, see Commands to identify the publisher in the FAQ.

```
7 Note
```

{504}------------------------------------------------

The Get-AuthenticationPolicy -AllowLegacyExchangeTokens command is the only way to view legacy token status. Other commands, such as Get-AuthenticationPolicy | Format-Table -Auto Name , don't return the legacy token status.

The Get-AuthenticationPolicy command only shows the legacy token status as set by the administrator. If the administrator has never changed the settings, the command returns (Not Set) . If the token status is (Not Set) when the February deployment by Microsoft to turn off legacy tokens is implemented, the token status will still be (Not Set) even though legacy tokens are off. The following table shows the behavior of legacy Exchange Online tokens based on the token status when the change is applied.

ノ **Expand table**

| Legacy token  | Legacy token behavior  | Legacy token behavior | Legacy token behavior |
|---------------|------------------------|-----------------------|-----------------------|
| admin setting | before February change | after February change | after August change   |
| (Not Set)     | Tokens on              | Tokens off            | Tokens off            |
| False         | Tokens off             | Tokens off            | Tokens off            |
| True          | Tokens on              | Tokens on             | Tokens off            |

# **See also**

- [Nested app authentication and Outlook legacy tokens deprecation FAQ](https://aka.ms/NAAFAQ)
- Enable SSO in an Office Add-in using nested app authentication
- [Set-AuthenticationPolicy](https://learn.microsoft.com/en-us/powershell/module/exchange/set-authenticationpolicy)
- [Remove-AuthenticationPolicy](https://learn.microsoft.com/en-us/powershell/module/exchange/remove-authenticationpolicy)
- [Get-AuthenticationPolicy](https://learn.microsoft.com/en-us/powershell/module/exchange/get-authenticationpolicy)

{505}------------------------------------------------

# **Deploy and install Outlook add-ins for testing**

07/23/2025

As part of the process of developing an Outlook add-in, you'll probably find yourself iteratively deploying and installing the add-in for testing, which involves the following steps.

- 1. Creating a manifest file that describes the add-in.
- 2. Deploying the add-in UI files to a web server.
- 3. Installing the add-in in your mailbox.
- 4. Testing the add-in, making appropriate changes to the UI or manifest files, and repeating steps 2 and 3 to test the changes.

#### 7 **Note**

**[Custom panes have been deprecated](https://devblogs.microsoft.com/microsoft365dev/make-your-add-ins-available-in-the-office-ribbon/)** so please ensure that you're using **a supported add-in extension point**.

# **Create a manifest file for the add-in**

Each add-in is described by a manifest, a document that gives the server information about the add-in, provides descriptive information about the add-in for the user, and identifies the location of the add-in UI HTML file. You can store the manifest in a local folder or server, as long as the location is accessible by the Exchange server of the mailbox that you're testing with. We'll assume that you store your manifest in a local folder. For information about how to create a manifest file, see Office Add-in manifests.

# **Deploy an add-in to a web server**

You can use HTML and JavaScript to create the add-in. The resulting source files are stored on a web server that can be accessed by the Exchange server that hosts the add-in. After initially deploying the source files for the add-in, you can update the add-in UI and behavior by replacing the HTML files or JavaScript files stored on the web server with a new version of the HTML file.

# **Install the add-in**

{506}------------------------------------------------

After preparing the add-in manifest file and deploying the add-in UI to a web server that can be accessed, you can sideload the add-in for a mailbox on an Exchange server by using an Outlook client, or install the add-in by running remote Windows PowerShell cmdlets.

### **Sideload the add-in**

PowerShell

You can install an add-in if your mailbox is on Exchange. Sideloading add-ins requires at minimum the **My Custom Apps** role for your Exchange Server. In order to test your add-in, or install add-ins in general by specifying a URL or file name for the add-in manifest, you should request your Exchange administrator to provide the necessary permissions.

The Exchange administrator can run the following PowerShell cmdlet to assign a single user the necessary permissions. In this example, wendyri is the user's email alias.

New-ManagementRoleAssignment -Role "My Custom Apps" -User "wendyri"

If necessary, the administrator can run the following cmdlet to assign multiple users the similar necessary permissions.

```
PowerShell
$users = Get-Mailbox *$users | ForEach-Object { New-ManagementRoleAssignment -Role
"My Custom Apps" -User $_.Alias}
```
For more information about the My Custom Apps role, see [My Custom Apps role.](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/add-ins-for-outlook/specify-who-can-install-and-manage-add-ins)

Using Microsoft 365 or Visual Studio to develop add-ins assigns you the organization administrator role which allows you to install add-ins by file or URL in the EAC, or by Powershell cmdlets.

### **Install an add-in by using remote PowerShell**

After you create a remote Windows PowerShell session on your Exchange server, you can install an Outlook add-in by using the New-App cmdlet with the following PowerShell command.

```
PowerShell
New-App -URL:"http://<fully-qualified URL">
```

{507}------------------------------------------------

The fully qualified URL is the location of the add-in manifest file that you prepared for your add-in.

Use the following additional PowerShell cmdlets to manage the add-ins for a mailbox.

- Get-App Lists the add-ins that are enabled for a mailbox.
- Set-App Enables or disables a add-in on a mailbox.
- Remove-App Removes a previously installed add-in from an Exchange server.

# **Client versions**

Deciding what versions of the Outlook client to test depends on your development requirements.

- If you're developing an add-in for private use, or only for members of your organization, then it is important to test the versions of Outlook that your company uses. Keep in mind that some users may use Outlook on the web, so testing your company's standard browser versions is also important.
- If you're developing an add-in to list in [AppSource](https://appsource.microsoft.com/) , you must test the required versions as specified in the Commercial marketplace certification policies 1120.3. This includes:
	- The latest version of Outlook on Windows and the version prior to the latest.
	- The latest version of Outlook on Mac.
	- The latest version of Outlook on iOS and Android (if your add-in supports mobile form factor).
	- The browser versions specified in the Commercial marketplace validation policy 1120.3.

#### 7 **Note**

If your add-in does not support one of the above clients due to **requesting an API requirement set** that the client does not support, that client would be removed from the list of required clients.

# **Outlook on the web and Exchange server versions**

Consumer and Microsoft 365 account users see the modern UI version when they access Outlook on the web and no longer see the classic version which has been deprecated. However, on-premises Exchange servers continue to support classic Outlook on the web. Therefore, during the validation process, your submission may receive a warning that the addin is not compatible with classic Outlook on the web. In that case, you should consider testing your add-in in an on-premises Exchange environment. This warning won't block your

{508}------------------------------------------------

submission to AppSource but your customers may experience a sub-optimal experience if they use Outlook on the web in an on-premises Exchange environment.

To mitigate this, we recommend you test your add-in in Outlook on the web connected to your own private on-premises Exchange environment. For more information, see [Establish an](https://learn.microsoft.com/en-us/Exchange/plan-and-deploy/plan-and-deploy#establish-an-exchange-server-test-environment) [Exchange Server test environment](https://learn.microsoft.com/en-us/Exchange/plan-and-deploy/plan-and-deploy#establish-an-exchange-server-test-environment) and [Outlook on the web in Exchange Server.](https://learn.microsoft.com/en-us/exchange/clients/outlook-on-the-web/outlook-on-the-web)

Alternatively, you can opt to pay for and use a service that hosts and manages on-premises Exchange servers. A couple of options are:

- [Rackspace](https://www.rackspace.com/applications/email-productivity)
- [Hostway](https://hostway.com/microsoft-exchange/)

Furthermore, if you don't want your add-ins to be available for users who are connected to onpremises Exchange, you can set the [requirement set](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#exchange-server-support) in the add-in manifest to be 1.6 or higher. Such add-ins will not be tested or validated on the classic Outlook on the web UI.

# **See also**

- Troubleshoot user errors with Office Add-ins

{509}------------------------------------------------

# **Sideload Outlook add-ins for testing**

Article • 05/19/2025

Sideload your Outlook add-in for testing in Outlook on the web, on Windows ([new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) or classic), on Mac, or on mobile devices without having to first put it in an add-in catalog.

The sideloading process differs depending on the type of manifest your add-in uses. Select the tab for the applicable manifest. For more information on Office Add-in manifests, see Office Add-ins manifest.

#### ) **Important**

If your Outlook add-in supports mobile, sideload the manifest using the instructions in this article for your Outlook client on the web, on Windows, or on Mac, then follow the guidance in **Testing your add-ins on mobile**.

Unified manifest for Microsoft 365

The process to sideload an add-in that uses the unified app manifest for Microsoft 365 varies depending on the tool you used to create your add-in project. For more information, see Sideload Office Add-ins that use the unified manifest for Microsoft 365.

# **Locate a sideloaded add-in**

To learn how to access a sideloaded add-in in your Outlook client, see [Use add-ins in](https://support.microsoft.com/office/1ee261f9-49bf-4ba6-b3e2-2ba7bcab64c8) [Outlook](https://support.microsoft.com/office/1ee261f9-49bf-4ba6-b3e2-2ba7bcab64c8) .

# **See also**

- Add-ins for Outlook on mobile devices

{510}------------------------------------------------

# **Limits for activation and JavaScript API for Outlook add-ins**

07/14/2025

To provide a satisfactory experience for users of Outlook add-ins, you should be aware of certain activation and API usage guidelines, and implement your add-ins to stay within these limits. These guidelines exist so that an individual add-in can't require Exchange Server or Outlook to spend an unusually long period of time to process its activation rules or calls to the Office JavaScript API, affecting the overall user experience for Outlook and other add-ins. These limits apply to designing activation rules in the add-in manifest, and using custom properties, roaming settings, recipients, Exchange Web Services (EWS) requests and responses, and asynchronous calls.

#### 7 **Note**

You must also verify that your add-in performs within certain runtime resource usage limits. For more information, see **Runtimes in Office Add-ins**.

### **Limits on where add-ins activate**

To learn more about where add-ins do and don't activate, see the "Mailbox items available to add-ins" section of Outlook add-ins overview.

# **Limits for JavaScript API**

Each Outlook client enforces certain limits in the JavaScript object model, as described in the following table.

| Feature              | Limit               | Related API                                                      | Description                                                                                                                                                                                                  |
|----------------------|---------------------|------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Custom<br>properties | 2,500<br>characters | CustomProperties object<br>Item.loadCustomPropertiesAsync method | Limit for all custom<br>properties for an<br>appointment or message<br>item. All the Outlook clients<br>return an error if the total<br>size of all custom properties<br>of an add-in exceeds this<br>limit. |

{511}------------------------------------------------

| Feature                  | Limit                                                                                                                                                                                                                                                                                                                | Related API                                                | Description                                                                                                                            |
|--------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| Roaming<br>settings      | 32 KB number<br>of characters                                                                                                                                                                                                                                                                                        | RoamingSettings object<br>Context.roamingSettings property | Limit for all roaming settings<br>for the add-in. All the<br>Outlook clients return an<br>error if your settings exceed<br>this limit. |
| Session data             | 50,000<br>characters                                                                                                                                                                                                                                                                                                 | Office.SessionData<br>Item.sessionData method              | For a specific mail item, the<br>limit of an entire SessionData<br>object per add-in.                                                  |
| Internet<br>headers      | 256 KB per<br>message in<br>Exchange<br>Online<br>Header size<br>limit<br>determined<br>by the<br>organization's<br>administrators<br>in Exchange<br>on-premises                                                                                                                                                     | InternetHeaders.setAsync method                            | The total size limit of headers<br>that can be applied to a<br>message.                                                                |
| Exchange<br>Web Services | 5 MB number<br>of characters<br>in Outlook on<br>the web, on<br>Windows<br>(starting in<br>Version 2303<br>(Build<br>16225.10000)),<br>on Mac<br>(starting in<br>Version 16.73<br>(23042601)),<br>and in new<br>Outlook on<br>Windows<br>1 MB of<br>characters in<br>earlier<br>versions of<br>Outlook on<br>Windows | Mailbox.makeEwsRequestAsync method                         | Limit for a request or<br>response to a<br>Mailbox.makeEwsRequestAsync<br>call.                                                        |

{512}------------------------------------------------

| Feature              | Limit                               | Related API                                 | Description                                                                                                                                  |
|----------------------|-------------------------------------|---------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------|
|                      | (classic) and<br>on Mac             |                                             |                                                                                                                                              |
| Item multi<br>select | 100 messages                        | Mailbox.getSelectedItemsAsync method        | The maximum number of<br>selected messages on which<br>an Outlook add-in can<br>activate.                                                    |
| Recipients           | Varies across<br>Outlook<br>clients | Item.requiredAttendees property             | Limit for the recipients<br>specified in each property or                                                                                    |
|                      |                                     | Item.optionalAttendees property             | method. To learn about the<br>recipient limits for a specific<br>Outlook client, see the API<br>documentation for the<br>property or method. |
|                      |                                     | Item.to property                            |                                                                                                                                              |
|                      |                                     | Item.cc property                            |                                                                                                                                              |
|                      |                                     | Recipients.addAsync method                  |                                                                                                                                              |
|                      |                                     | Recipients.getAsync method                  |                                                                                                                                              |
|                      |                                     | Recipients.setAsync method                  |                                                                                                                                              |
| Display name         | 255 characters                      | EmailAddressDetails.displayName<br>property | Limit for the length of a<br>display name in an                                                                                              |
|                      |                                     | Recipients object                           | appointment or message.                                                                                                                      |
|                      |                                     | Item.requiredAttendees property             |                                                                                                                                              |
|                      |                                     | Item.optionalAttendees property             |                                                                                                                                              |
|                      |                                     | Item.to property                            |                                                                                                                                              |
|                      |                                     | Item.cc property                            |                                                                                                                                              |
| Set the<br>subject   | 255 characters                      | DisplayedSubject.setAsync (preview)         | Limit for the subject in the<br>new appointment form, or                                                                                     |
|                      |                                     | Mailbox.displayNewAppointmentForm<br>method | for setting the subject of an<br>appointment or message.                                                                                     |
|                      |                                     | Subject.setAsync method                     |                                                                                                                                              |
| Set the<br>location  | 255 characters                      | Location.setAsync method                    | Limit for setting the location<br>of an appointment or<br>meeting request.                                                                   |
| Body in a new        | 32 KB number                        | Mailbox.displayNewAppointmentForm           | Limit for the body in a new                                                                                                                  |
| appointment          | of characters                       | method                                      | appointment form.                                                                                                                            |

{513}------------------------------------------------

| Feature                                    | Limit                                                                                              | Related API                                                                                                       | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|--------------------------------------------|----------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| form                                       |                                                                                                    |                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Display the<br>body of an<br>existing item | 32 KB number<br>of characters                                                                      | Mailbox.displayAppointmentForm<br>method<br>Mailbox.displayMessageForm method                                     | For Outlook on the web,<br>mobile devices, and new<br>Outlook on Windows<br>: limit<br>for the body in an existing<br>appointment or message<br>form.                                                                                                                                                                                                                                                                                                                                                                 |
| Set the body                               | 1 MB number<br>of characters                                                                       | Body.prependAsync method<br>Body.setAsync<br>Body.setSelectedDataAsync method<br>DisplayedBody.setAsync (preview) | Limit for setting the body of<br>an appointment or message<br>item.                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| Set the<br>signature                       | 30,000<br>characters                                                                               | Body.setSignatureAsync method                                                                                     | Limit for the length of a<br>signature in an appointment<br>or message.                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Number of<br>attachments                   | 499 files in<br>Outlook on<br>the web and<br>new Outlook<br>on Windows                             | Item.addFileAttachmentAsync method<br>ReplyFormData.attachments                                                   | Limit for the number of files<br>that can be attached to an<br>item for sending. Outlook on<br>the web and new Outlook on<br>Windows<br>generally limit<br>attaching up to 499 files<br>through the user interface<br>and addFileAttachmentAsync<br>method. Outlook on<br>Windows (classic) and on<br>Mac don't specifically limit<br>the number of file<br>attachments. However, all<br>Outlook clients observe the<br>limit for the size of<br>attachments (see the "Size of<br>attachments" row in this<br>table). |
| Size of<br>attachments                     | Dependent on<br>Exchange<br>Server in<br>classic<br>Outlook on<br>Windows and<br>Outlook on<br>Mac | Item.addFileAttachmentAsync method<br>ReplyFormData.attachments                                                   | Limit for the size of all the<br>attachments added to a mail<br>item. In classic Outlook on<br>Windows and Outlook on<br>Mac, the limit is configured<br>by an administrator on the<br>Exchange Server of the user's<br>mailbox. In these clients, this<br>also limits the number of                                                                                                                                                                                                                                  |

{514}------------------------------------------------

| Feature                                          | Limit                                                              | Related API                                                                                                                                                                                                                                                                                                            | Description                                                                                                                                                                                                                                             |
|--------------------------------------------------|--------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                                  | 25 MB in<br>Outlook on<br>the web and<br>new Outlook<br>on Windows |                                                                                                                                                                                                                                                                                                                        | attachments of an item. For<br>Outlook on the web and new<br>Outlook on Windows<br>, the<br>lesser of the two limits—the<br>number of attachments and<br>the size of all attachments—<br>restricts the actual<br>attachments of an item.                |
| Attachment<br>filename                           | 255 characters                                                     | Item.addFileAttachmentAsync method<br>ReplyFormAttachment.name                                                                                                                                                                                                                                                         | Limit for the length of the<br>filename of an attachment to<br>be added to an item.                                                                                                                                                                     |
| Attachment<br>URI                                | 2,048<br>characters                                                | Item.addFileAttachmentAsync method<br>Item.addFileAttachmentFromBase64Async<br>method<br>ReplyFormData.url                                                                                                                                                                                                             | Limit of the URI of the<br>filename to be added as an<br>attachment to an item.                                                                                                                                                                         |
| Base64-<br>encoded<br>string of an<br>attachment | 27,892,122<br>characters<br>(about 25 MB)                          | Item.addFileAttachmentFromBase64Async<br>method<br>ReplyFormAttachment.base64file                                                                                                                                                                                                                                      | Limit of the Base64-encoded<br>string to be added as an<br>attachment to an item.                                                                                                                                                                       |
| Attachment<br>ID                                 | 100 characters                                                     | Item.addItemAttachmentAsync method<br>Item.removeAttachmentAsync method                                                                                                                                                                                                                                                | Limit for the length of the ID<br>of the attachment to be<br>added to or removed from<br>an item.                                                                                                                                                       |
| Asynchronous<br>calls                            | 3 calls                                                            | Item.addFileAttachmentAsync method<br>Item.addItemAttachmentAsync method<br>Item.removeAttachmentAsync method<br>Body.getTypeAsync method<br>Body.prependAsync method<br>Body.setSelectedDataAsync method<br>CustomProperties.saveAsync method<br>Item.LoadCustomPropertiesAsync<br>method<br>Location.getAsync method | For Outlook on the web and<br>on mobile devices, and new<br>Outlook on Windows<br>: limit<br>of the number of<br>simultaneous asynchronous<br>calls at any one time, as<br>browsers allow only a limited<br>number of asynchronous<br>calls to servers. |

{515}------------------------------------------------

| Feature            | Limit               | Related API                                 | Description                                                                          |
|--------------------|---------------------|---------------------------------------------|--------------------------------------------------------------------------------------|
|                    |                     | Location.setAsync method                    |                                                                                      |
|                    |                     | Mailbox.getCallbackTokenAsync method        |                                                                                      |
|                    |                     | Mailbox.getUserIdentityTokenAsync<br>method |                                                                                      |
|                    |                     | Mailbox.makeEwsRequestAsync method          |                                                                                      |
|                    |                     | Recipients.addAsync method                  |                                                                                      |
|                    |                     | Recipients.getAsync method                  |                                                                                      |
|                    |                     | Recipients.setAsync method                  |                                                                                      |
|                    |                     | RoamingSettings.saveAsync method            |                                                                                      |
|                    |                     | Subject.getAsync method                     |                                                                                      |
|                    |                     | Subject.setAsync method                     |                                                                                      |
|                    |                     | Time.getAsync method                        |                                                                                      |
|                    |                     | Time.setAsync method                        |                                                                                      |
| Append-on<br>send  | 5,000<br>characters | Body.appendOnSendAsync method               | Limit of the content to be<br>appended to a message or<br>appointment body on send.  |
| Prepend-on<br>send | 5,000<br>characters | Body.prependOnSendAsync method              | Limit of the content to be<br>prepended to a message or<br>appointment body on send. |

# **Limits of activation rules for contextual Outlook add-ins**

### ) **Important**

Entity-based contextual Outlook add-ins are now retired. As an alternative solution, implement regular expression rules in your contextual add-in. For guidance on how to implement these rules, see **Contextual Outlook add-ins**.

Follow these guidelines when designing activation rules for contextual Outlook add-ins.

{516}------------------------------------------------

- Limit the size of the manifest to 256 KB. You can't install the Outlook add-in for an Exchange mailbox if you exceed that limit.
#### 7 **Note**

Outlook add-in features that depend on activation rules aren't supported when the add-in uses a **unified app manifest for Microsoft 365**.

- Specify up to 15 activation rules for the add-in. You can't install the add-in if you exceed that limit.
- When you use regular expressions in the [ItemHasRegularExpressionMatch](https://learn.microsoft.com/en-us/javascript/api/manifest/rule#itemhasregularexpressionmatch-rule) rule, be aware of the following limits and guidelines that generally apply to any Outlook application and those described in the tables of the succeeding sections that differ depending on the application.
	- Specify up to only five regular expressions in activation rules in an add-in. You can't install an add-in if you exceed that limit.
	- Specify regular expressions such that the results you anticipate are returned by the getRegExMatches method call within the first 50 matches.
	- **Important**: Text is highlighted based on strings that result from matching the regular expression. However, the highlighted occurrences may not exactly match what should result from actual regular expression assertions like negative look-ahead (?!text) , look-behind (?<=text) , and negative look-behind (?<!text) . For example, if you use the regular expression under(?!score) on "Like under, under score, and underscore", the string "under" is highlighted for all occurrences instead of just the first two.

### **Differences in the support for regular expressions**

The following table lists the limits and describes the differences in the support for regular expressions across Outlook clients. The support is independent of any specific type of device and item body.

|                 | Outlook on the web, on new<br>Windows client, and on mobile<br>devices                                                                              | Outlook on Windows (classic) and on Mac                                                                                                                                   |
|-----------------|-----------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Regex<br>engine | Clients use regular expression<br>evaluation that's part of JavaScript. It's<br>provided by the browser and supports a<br>superset of ECMAScript 5. | Clients use the C++ regular expression engine<br>provided as part of the Visual Studio standard<br>template library. This engine complies with<br>ECMAScript 5 standards. |

{517}------------------------------------------------

|                                      | Outlook on the web, on new<br>Windows client, and on mobile<br>devices                                                                                                                                                                    | Outlook on Windows (classic) and on Mac                                                                                                                                                                                                                                                                                                                         |
|--------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Results<br>returned                  | You should test each regex thoroughly<br>on each Outlook client. If a regex<br>returns different results, rewrite the<br>regex.                                                                                                           | Because of the different regex engines, a regex<br>that includes a custom character class based on<br>predefined character classes may return<br>different results in Outlook on Windows<br>(classic) and on Mac versus in Outlook on the<br>web, on mobile devices, and in new Outlook on<br>Windows                                                           |
|                                      |                                                                                                                                                                                                                                           | As an example, the regex [\s\S]{0,100}<br>matches any number, between 0 and 100, of<br>single characters that is a whitespace or a non<br>whitespace. This regex returns different results<br>depending on your Outlook client.                                                                                                                                 |
|                                      |                                                                                                                                                                                                                                           | As a workaround, you should rewrite the regex<br>as (\s\ \S){0,100}<br>. This regex matches any<br>number, between 0 and 100, of white space or<br>non-white space.                                                                                                                                                                                             |
|                                      |                                                                                                                                                                                                                                           | You should test each regex thoroughly on each<br>Outlook client. If a regex returns different<br>results, rewrite the regex.                                                                                                                                                                                                                                    |
| Evaluation<br>time limit<br>settings | In Outlook on the web, on Mac (new UI),<br>on mobile devices, and on the new<br>Outlook on Windows, the<br>ActivationAlertThreshold and<br>ActivationRetryLimit evaluation limit<br>settings for regular expressions aren't<br>supported. | In Outlook on Windows (classic) and on Mac<br>(classic UI), by default, the evaluation of all<br>regular expressions for an add-in is limited to<br>one second. Exceeding this limit causes<br>reevaluation of up to three times. If evaluation<br>fails three times, the user must switch to a<br>different mail item then switch back to retry<br>evaluation. |
|                                      |                                                                                                                                                                                                                                           | However, administrators can override these<br>evaluation limits by configuring the<br>ActivationAlertThreshold and<br>ActivationRetryLimit settings. For guidance<br>on how to configure these settings, see<br>Evaluation response time for regular<br>expressions in Outlook add-ins.                                                                         |

### **Limits on the size of the item body evaluated**

The following table lists the limits and describes the differences in the portion of the item body to which each Outlook client applies a regular expression. Some of these limits depend on the

{518}------------------------------------------------

type of device and item body, if the regular expression is applied on the item body.

|  | ノ | Expand table |  |
|--|---|--------------|--|

|                               | Outlook on the web<br>and on new<br>Windows client                                 | Outlook on Windows (classic) and<br>on Mac                                                                                                                                                                                                | Outlook on mobile devices                                                                                                                      |
|-------------------------------|------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|
| Form<br>factor                | Any supported<br>device other than<br>Android<br>smartphones, iPad,<br>and iPhone. | Any supported device.                                                                                                                                                                                                                     | Android smartphones, iPad,<br>or iPhone.                                                                                                       |
| Plain<br>text<br>item<br>body | Activates the add-in<br>only if the body <<br>500,000 characters.                  | Applies the regex on the first 1 MB of<br>the data of the body, but not on the<br>rest of the body over that limit.                                                                                                                       | Activates the add-in only if<br>the body < 16,000<br>characters.                                                                               |
| HTML<br>item<br>body          | Activates the add-in<br>only if the body <<br>500,000 characters.                  | Applies the regex on the first 512 KB<br>of the data of the body, but not on the<br>rest of the body over that limit. (The<br>actual number of characters depends<br>on the encoding which can range from<br>1 to 4 bytes per character.) | Applies the regex on the first<br>64,000 characters (including<br>HTML tag characters), but<br>not on the rest of the body<br>over that limit. |

### **Limits on the matches returned**

The following table lists the limits and describes the differences in the matches that each Outlook client returns after evaluating a regular expression. The support is independent of any specific type of device, but may depend on the type of item body, if the regular expression is applied on the item body.

|                                 | Outlook on the web, on new<br>Windows client, and on mobile<br>devices                                                                                                                                                                                                 | Outlook on Windows (classic) and on Mac                                                                                                                                                                                                                            |
|---------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Order of<br>returned<br>matches | Assume the getRegExMatches method<br>returns different matches for the same<br>regular expression applied on the same<br>mail item in Outlook on Windows<br>(classic) and on Mac versus in Outlook<br>on the web, on mobile devices, and in<br>new Outlook on Windows. | Assume the getRegExMatches method returns<br>different matches for the same regular<br>expression applied on the same mail item in<br>Outlook on Windows (classic) and on Mac versus<br>in Outlook on the web, on mobile devices, and<br>in new Outlook on Windows |

{519}------------------------------------------------

|                         | Outlook on the web, on new<br>Windows client, and on mobile<br>devices                                         | Outlook on Windows (classic) and on Mac                                                                                                                                                                                                                                                                                                                         |
|-------------------------|----------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Plain text<br>item body | getRegExMatches returns any matches<br>that are up to 3,072 (3 KB) characters,<br>for a maximum of 50 matches. | The getRegExMatches method returns any<br>matches that are up to 1,536 (1.5 KB) characters,<br>for a maximum of 50 matches.                                                                                                                                                                                                                                     |
|                         |                                                                                                                | Note: getRegExMatches doesn't return matches<br>in any specific order in the returned array. In<br>general, assume the order of matches for the<br>same regular expression applied on the same<br>mail item in Outlook on Windows (classic) and<br>on Mac is different from that in Outlook on the<br>web, on mobile devices, and in new Outlook on<br>Windows. |
| HTML<br>item body       | getRegExMatches returns any matches<br>that are up to 3,072 (3 KB) characters,<br>for a maximum of 50 matches. | getRegExMatches returns any matches that are<br>up to 3,072 (3 KB) characters, for a maximum of<br>50 matches.                                                                                                                                                                                                                                                  |
|                         |                                                                                                                | Note: getRegExMatches doesn't return matches<br>in any specific order in the returned array. In<br>general, assume the order of matches for the<br>same regular expression applied on the same<br>mail item in Outlook on Windows (classic) and<br>on Mac is different from that in Outlook on the<br>web, on mobile devices, and in new Outlook on<br>Windows. |

# **See also**

- Deploy and install Outlook add-ins for testing
- Privacy, permissions, and security for Outlook add-ins
- Resource limits and performance optimization for Office Add-ins

{520}------------------------------------------------

# **Compare Outlook add-in support in Outlook on Mac with other Outlook clients**

08/15/2025

You can create and run an Outlook add-in the same way in Outlook on Mac as in the other clients, including Outlook on the web, Windows ([new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) and classic), iOS, and Android, without customizing the JavaScript for each client. The same calls from the add-in to the Office JavaScript API generally work the same way, except for the areas described in the following table.

For more information, see Deploy and install Outlook add-ins for testing.

| Area                                                 | Outlook on the web, Windows (new and<br>classic), and mobile devices                                                                                                                                                                    | Outlook on Mac                                                                                                                                                                                                                                                                                        |
|------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Supported<br>versions of                             | All APIs in Office.js.                                                                                                                                                                                                                  | All APIs in Office.js.                                                                                                                                                                                                                                                                                |
| office.js                                            |                                                                                                                                                                                                                                         | NOTE: In Outlook on Mac, only<br>Version 16.35 (20030802) or later<br>supports saving a meeting. Otherwise,<br>the saveAsync method fails when<br>called from a meeting in compose<br>mode. See Cannot save a meeting as<br>a draft in Outlook for Mac by using<br>Office JS API<br>for a workaround. |
| Instances of a<br>recurring<br>appointment<br>series | Can get the item ID and other<br>properties of a master appointment or<br>appointment instance of a recurring<br>series.<br>Can use<br>mailbox.displayAppointmentForm to<br>display an instance or the master of a<br>recurring series. | Can get the item ID and other<br>properties of the master<br>appointment, but not those of<br>an instance of a recurring<br>series.<br>Can display the master<br>appointment of a recurring<br>series. Without the item ID,<br>cannot display an instance of a<br>recurring series.                   |
| Recipient type of<br>an appointment<br>attendee      | Can use EmailAddressDetails.recipientType to<br>identify the recipient type of an attendee.                                                                                                                                             | EmailAddressDetails.recipientType<br>returns undefined for appointment<br>attendees.                                                                                                                                                                                                                  |
| Version string of                                    | The format of the version string returned by                                                                                                                                                                                            | The diagnostics.hostVersion call                                                                                                                                                                                                                                                                      |
| the client                                           | diagnostics.hostVersion depends on the                                                                                                                                                                                                  | returns the version of the Outlook                                                                                                                                                                                                                                                                    |

{521}------------------------------------------------

| Area                                                                     | Outlook on the web, Windows (new and<br>classic), and mobile devices                                                                                                                                                                                                                                                                                                                                                                                                              | Outlook on Mac                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|--------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| application                                                              | Outlook client.<br>Outlook on Windows: Returns the<br>version of the Outlook client. For<br>example, 16.0.4454.1002 .<br>Outlook on the web and new Outlook<br>on Windows: Returns the version of the<br>Exchange Server. For example,<br>15.0.918.2                                                                                                                                                                                                                              | client. For example, 16.0 (140325) .                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Custom<br>properties of an<br>item                                       | If the network goes down, an add-in can still<br>access cached custom properties.                                                                                                                                                                                                                                                                                                                                                                                                 | Because Outlook on Mac does not<br>cache custom properties, if the<br>network goes down, add-ins would<br>not be able to access them.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| Attachment<br>details                                                    | The content type and attachment names in<br>an AttachmentDetails object depend on the<br>type of client:<br>A JSON example of<br>AttachmentDetails.contentType :<br>"contentType": "image/x-png" .<br>AttachmentDetails.name does not<br>contain any filename extension. As an<br>example, if the attachment is a<br>message that has the subject "RE:<br>Summer activity", the JSON object that<br>represents the attachment name would<br>be "name":<br>"RE: Summer activity" . | A JSON example of<br>AttachmentDetails.contentType :<br>"contentType" "image/png"<br>AttachmentDetails.name always<br>includes a filename extension.<br>Attachments that are mail items<br>have a .eml extension, and<br>appointments have a .ics<br>extension. As an example, if an<br>attachment is an email with the<br>subject "RE: Summer activity",<br>the JSON object that represents<br>the attachment name would be<br>"name": "RE: Summer<br>activity.eml" .<br>NOTE: If a file is<br>programmatically attached (e.g<br>through an add-in) without an<br>extension then the<br>AttachmentDetails.name will not<br>contain the extension as part of<br>filename. |
| String<br>representing the<br>time zone in the<br>dateTimeCreated<br>and | As an example: Thu<br>Mar 13 2014 14:09:11<br>GMT+0800 (China Standard Time)                                                                                                                                                                                                                                                                                                                                                                                                      | As an example: Thu<br>Mar 13 2014<br>14:09:11 GMT+0800 (CST)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

{522}------------------------------------------------

| Area                                | Outlook on the web, Windows (new and<br>classic), and mobile devices          | Outlook on Mac                       |
|-------------------------------------|-------------------------------------------------------------------------------|--------------------------------------|
| dateTimeModified<br>properties      |                                                                               |                                      |
|                                     |                                                                               |                                      |
| Time accuracy of<br>dateTimeCreated | If an add-in uses the following code, the<br>accuracy is up to a millisecond. | The accuracy is up to only a second. |
| and                                 | JSON.stringify(Office.context.mailbox.item,                                   |                                      |
| dateTimeModified                    | null, 4);                                                                     |                                      |

# **Add-in support in Outlook on new Mac UI**

Outlook add-ins are now supported in the new Mac UI (available from Outlook version 16.38.506). For requirement sets currently supported in the new Mac UI, see [Outlook API](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#outlook-client-support) [requirement set client support.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#outlook-client-support)

To learn more about the new Mac UI, see [The new Outlook for Mac](https://support.microsoft.com/office/6283be54-e74d-434e-babb-b70cefc77439) .

You can determine which UI version you're on, as follows:

#### **Classic UI**

**New UI**

{523}------------------------------------------------

# **Support for add-ins with the unified manifest for Microsoft 365**

Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on Mac. To run this type of add-in, it must first be published to [AppSource](https://appsource.microsoft.com/) then deployed in the Microsoft 365 admin center. An add-in only manifest is then generated from the unified manifest, which enables the add-in to be installed in Outlook on Mac.

7 **Note**

Custom add-ins or line-of-business (LOB) add-ins that use the unified manifest can be deployed in the **[Integrated apps portal](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/test-and-deploy-microsoft-365-apps)** of the Microsoft 365 admin center, but they won't be installable in Outlook on Mac.

For more information, see the "Client and platform support" section of Office Add-ins with the unified app manifest for Microsoft 365.

{524}------------------------------------------------

# **Debug function commands in Outlook add-ins**

Article • 06/10/2024

#### 7 **Note**

The technique in this article can be used only on a Windows development computer. If you're developing on a Mac, see **Debug function commands**.

This article describes how to use the Office Add-in Debugger Extension in Visual Studio Code to debug function commands. Function commands are initiated through an add-in command button on the ribbon. For more information about add-in commands, see Add-in commands.

This article assumes that you already have an add-in project that you'd like to debug. To create an add-in with a function command to practice debugging, follow the steps in Tutorial: Build a message compose Outlook add-in.

# **Mark your add-in for debugging**

If you used the Yeoman generator for Office Add-ins to create your add-in project, skip to the Configure and run the debugger section later in this article. When you run npm start to build your add-in and start the local server, the command also sets the UseDirectDebugger value of the

HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\Developer\[Add-in ID] registry key to mark your add-in for debugging.

Otherwise, if you used another tool to create your add-in, perform the following steps.

- 1. Navigate to the
HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\Developer\[Add-in ID] registry key. Replace [Add-in ID] with the **<Id>** from your add-in's manifest.

7 **Note**

If the Developer key (folder) doesn't already exist under HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\ , complete the following steps to create it.

{525}------------------------------------------------

- a. Right-click the **WEF** key (folder) and select **New** > **Key**.
- b. Name the new key **Developer**.
- 2. Set the key's UseDirectDebugger value to 1 .

# **Configure and run the debugger**

Now that you've enabled debugging on your add-in, you're ready to configure and run the debugger. For instructions on how to do this, select one of the following options that applies to your webview control. For information about how to determine what webview control is used on your development computer, see Browsers and webview controls used by Office Add-ins.

- If your add-in runs in the embedded webview control from Edge Legacy (EdgeHTML), see Debug add-ins using developer tools in Microsoft Edge Legacy.
- If your add-in runs in the embedded webview control from Microsoft Edge Chromium (WebView2), see Debug add-ins on Windows using Visual Studio Code and Microsoft Edge WebView2 (Chromium-based).

# **See also**

- Add-in commands
- Overview of debugging Office Add-ins
- [Debug event-based and spam-reporting add-ins](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/debug-autolaunch)

### 6 **Collaborate with us on GitHub**

The source for this content can be found on GitHub, where you can also create and review issues and pull requests. For more information, see [our](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md) [contributor guide](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md).

### **Office Add-ins feedback**

Office Add-ins is an open source project. Select a link to provide feedback:

- [Open a documentation issue](https://github.com/OfficeDev/office-js-docs-pr/issues/new?template=3-customer-feedback.yml&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Foffice%2Fdev%2Fadd-ins%2Foutlook%2Fdebug-ui-less&pageQueryParams=&contentSourceUrl=https%3A%2F%2Fgithub.com%2FOfficeDev%2Foffice-js-docs-pr%2Fblob%2Fmain%2Fdocs%2Foutlook%2Fdebug-ui-less.md&documentVersionIndependentId=94f1407b-3626-1286-47a0-4c6dc60d8ff2&feedback=%0A%0A%5BEnter+feedback+here%5D%0A&author=%40o365devx&metadata=*+ID%3A+94f1407b-3626-1286-47a0-4c6dc60d8ff2+%0A*+Service%3A+**outlook**%0A*+Sub-service%3A+**add-ins**)
- [Provide product feedback](https://aka.ms/office-addins-dev-questions)

{526}------------------------------------------------

# **Troubleshoot event-based and spamreporting add-ins**

08/06/2025

As you develop your event-based or spam-reporting add-in, you may encounter issues, such as your add-in not loading or an event not occurring. The following sections provide guidance on how to troubleshoot your add-in.

# **Review feature prerequisites**

- Verify that the add-in is installed on a supported client. Some clients only support certain events or aspects of event-based activation or integrated spam reporting. For more information, see Supported events and Implement an integrated spam-reporting add-in.
- Verify that your client supports the minimum requirement set needed. The integrated spam reporting feature was introduced in [requirement set 1.14](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.14/outlook-requirement-set-1.14). See the Supported Events for details about build numbers and requirement sets for event-based activation.
- Review the expected behavior and limitations of the feature.
	- Event-based activation behavior and limitations
	- Smart Alerts behavior and scenarios
	- Integrated spam-reporting behavior and limitations

# **Check manifest and JavaScript requirements**

- Ensure that the following conditions are met in your add-in's manifest.
	- Verify that your add-in's source file location URL is publicly available and isn't blocked by a firewall. This URL is specified in the [SourceLocation element](https://learn.microsoft.com/en-us/javascript/api/manifest/sourcelocation) of the add-in only manifest or the ["extensions.runtimes.code.page"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtime-code#page) property of the unified manifest for Microsoft 365.
	- Verify that the <Runtimes> element (add-in only manifest) or

"extensions.runtimes.code" property (unified manifest) correctly references the HTML or JavaScript file containing the event handlers. Classic Outlook on Windows and other Windows-based Office applications use the JavaScript file during runtime, while Office on the web, the new Outlook Mac UI, and [new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) use the HTML file. For an example of how this is configured in the manifest, see the "Configure the manifest" section of Automatically set the subject of a new message or appointment.

{527}------------------------------------------------

For Windows clients (except for new Outlook on Windows), you must bundle all your event-handling JavaScript code into this JavaScript file referenced in the manifest. Note that a large JavaScript bundle may cause issues with the performance of your add-in. We recommend preprocessing heavy operations, so that they're not included in your event-handling code.

- For Windows clients (except for new Outlook on Windows), when the JavaScript function specified in the manifest to handle an event runs, code in Office.onReady() and Office.initialize isn't run. We recommend adding any startup logic needed by event handlers, such as checking the user's client version, to the event handlers instead.
- Verify that your event-handling JavaScript file calls Office.actions.associate . This ensures that the event handler name specified in the manifest is mapped to its JavaScript counterpart. The following code is an example.

```
JavaScript
Office.actions.associate("onNewMessageComposeHandler",
onNewMessageComposeHandler);
```
- In classic Outlook on Windows versions prior to Version 2403 (Build 17425.20000), the JavaScript code of event-based and spam-reporting add-ins only supports [ECMAScript](https://262.ecma-international.org/7.0/) [2016](https://262.ecma-international.org/7.0/) and earlier specifications. Some examples of programming syntax to avoid are as follows.
	- Avoid using async and await statements in your code. Including these in your JavaScript code will cause the add-in to time out.
	- Avoid using the [conditional (ternary) operator](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Operators/Conditional_Operator) as it will prevent your add-in from loading.

If your add-in has only one JavaScript file referenced by Outlook on the web, on Windows (new and classic), and on Mac, you must limit your code to ECMAScript 2016 to ensure that your add-in runs in earlier versions of classic Outlook on Windows. However, if you have a separate JavaScript file referenced by Outlook on the web, on Mac, recent versions of classic Outlook on Windows, and the new Outlook on Windows, you can implement a later ECMAScript specification in that file.

# **Debug your add-in**

- As you make changes to your add-in, be aware that:
	- If you update the manifest, remove the add-in, then sideload it again. For information on how to remove a sideloaded add-in from Outlook, see Sideload Outlook add-ins for testing. If you're using Outlook on Windows, you must also close and reopen Outlook.

{528}------------------------------------------------

- If you make changes to files other than the manifest, close and reopen the Office client on Windows or on Mac, or refresh the browser tab running Office on the web.
- If you're still unable to see your changes after performing these steps, clear your Office cache.
- As you test your add-in in Office on Windows (excluding the new Outlook on Windows):
	- For event-based add-ins, check [Event Viewer](https://learn.microsoft.com/en-us/shows/inside/event-viewer) for any reported add-in errors.
		- 1. In Event Viewer, select **Windows Logs** > **Application**.
		- 2. From the **Actions** panel, select **Filter Current Log**.
		- 3. From the **Logged** dropdown, select your preferred log time frame.
		- 4. Select the **Error** checkbox.
		- 5. In the **Event IDs** field, enter **63**.
		- 6. Select **OK** to apply your filters.

| Logged:        | Last hour                                                                                                                                                           | V     |
|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------|
| Event level:   | Critical<br>Warning<br>Verbose                                                                                                                                      |       |
|                | Error<br>Information                                                                                                                                                |       |
| By log         | Event logs:<br>Application                                                                                                                                          |       |
| By source      | Event sources:                                                                                                                                                      |       |
|                | Includes/Excludes Event IDs: Enter ID numbers and/or ID ranges separated by commas. To<br>exclude criteria, type a minus sign first. For example 1,3,5-99,-76<br>63 |       |
| Task category: |                                                                                                                                                                     |       |
| Keywords:      |                                                                                                                                                                     |       |
| User:          | <all users=""></all>                                                                                                                                                |       |
| Computer(s):   | < All Computers>                                                                                                                                                    |       |
|                |                                                                                                                                                                     | Clear |

- Verify that the **bundle.js** file is downloaded to the following folder in File Explorer. The text enclosed in [] represents your applicable Office and add-in information.
text

```
%LOCALAPPDATA%\Microsoft\Office\16.0\Wef\{[Office profile GUID]}\[Office
account encoding]\Javascript\[Add-in ID]_[Add-in Version]_[locale]
```

{529}------------------------------------------------

- **Tip**
- For readability, this article refers to the file name as **bundle.js**, but exact name depends on the Office application.
	- Excel: **bundle_excel.js**
	- Outlook: **bundle.js**.
	- PowerPoint: **bundle_powerpoint.js**
	- Word: **bundle_word.js**
- There's no direct method to determine the Office profile GUID and account encoding used in the **bundle.js** file path. The most effective approach to locate your add-in's **bundle.js** file is to manually inspect each folder until you locate the **Javascript** folder that contains your add-in's ID.
- The **bundle.js** file is downloaded to the local **Wef** folder when the add-in is first installed. It's refreshed every time the Office application starts or is restarted. If the **bundle.js** file doesn't appear in the **Wef** folder and your add-in is installed or sideloaded, restart Office. For Outlook, you may need to **remove your addin**, then **sideload** it again.
- As you test your add-in on desktop clients (excluding new Outlook on Windows) enable runtime logging to identify possible manifest and add-in installation issues. For guidance on how to use runtime logging, see Debug your add-in with runtime logging.
- Set breakpoints in your code to debug your add-in. For platform-specific instructions, see Debug event-based and spam-reporting add-ins.

# **Seek additional help**

If you still need help after performing the recommended troubleshooting steps, [open a GitHub](https://github.com/OfficeDev/office-js/issues/new?assignees=&labels=&template=bug_report.md&title=) [issue](https://github.com/OfficeDev/office-js/issues/new?assignees=&labels=&template=bug_report.md&title=) . Include screenshots, video recordings, or runtime logs to supplement your report.

# **See also**

- Activate add-ins with events
- Implement an integrated spam-reporting add-in

{530}------------------------------------------------

# **Debug event-based or spam-reporting add-ins**

07/16/2025

This article discusses the key debugging stages to enable and set breakpoints in your code as you implement event-based activation or integrated spam reporting in your add-in. Before you proceed, we recommend reviewing the troubleshooting guide for additional steps on how to resolve development errors.

To begin debugging, select the tab for your applicable client.

Windows (classic)

If you used the Yeoman generator for Office Add-ins to create your add-in project (for example, by completing an event-based activation walkthrough), follow the **Created with Yeoman generator** option throughout this article. Otherwise, follow the **Other** steps.

# **Mark your add-in for debugging and set the debugger port**

1. Get your add-in's ID from the manifest.

- **Add-in only manifest**: Use the value of the **<Id>** element child of the root **<OfficeApp>** element.
- **Unified manifest for Microsoft 365**: Use the value of the "id" property of the root anonymous { ... } object.
- 2. In the registry, mark your add-in for debugging.
	- **Created with Yeoman generator**: In a command line window, navigate to the root of your add-in folder then run the following command.

command line

npm start

In addition to building the code and starting the local server, this command sets the data of the

HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\Developer\[Add-in

{531}------------------------------------------------

ID]\UseDirectDebugger registry DWORD value for this add-in to 1 . [Add-in ID] is your add-in's ID from the manifest.

- **Other**: In the
HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\Developer\[Add-in ID]\UseDirectDebugger registry DWORD value, where [Add-in ID] is your addin's ID from the manifest, set its data to 1 .

#### 7 **Note**

If the Developer key (folder) doesn't already exist under

HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\ , complete the following steps to create it.

- a. Right-click (or select and hold) the **WEF** key (folder) and select **New** > **Key**.
- b. Name the new key **Developer**.
- 3. In the registry key

HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\Developer\[Add-in ID] , where [Add-in ID] is your add-in's ID from the manifest, create a new DWORD value with the following configuration.

- **Value name**: DebuggerPort
- **Value data (hexadecimal)**: 00002407

This sets the debugger port to 9223 .

- 4. Start your Office application or restart it if it's already open.
- 5. Perform the action to initiate the event you're developing for, such as creating a new message to initiate the OnNewMessageCompose event or reporting spam messages. The **Debug Event-based handler** dialog should appear. Do *not* interact with the dialog yet.

{532}------------------------------------------------

# **Configure and attach the debugger**

You can debug your add-in using the Microsoft Edge Inspect tool or Visual Studio Code.

### **Debug with Microsoft Edge**

- 1. Open Microsoft Edge and go to **edge://inspect/#devices**.
- 2. In the **Remote Target** section, look for your add-in using its ID from the manifest. Then, select **Inspect**.

The DevTools window appears.

#### 7 **Note**

It may take some time for your add-in to appear in the **Remote Target** section. You may need to refresh the page for the add-in to appear.

#### 3. In the **Sources** tab, go to **file://** >

**Users/[User]/AppData/Local/Microsoft/Office/16.0/Wef/{[Office profile GUID]}/[Office account encoding]/Javascript/[Add-in ID]_[Add-in Version]_[locale]** > **bundle.js**. For readability, this article refers to the file name as **bundle.js**, but exact name depends on the Office application.

- Excel: **bundle_excel.js**
- Outlook: **bundle.js**
- PowerPoint: **bundle_powerpoint.js**
- Word: **bundle_word.js**

{533}------------------------------------------------

There's no direct method to determine the Office profile GUID or mail account encoding used in the **bundle.js** file path. If you're debugging multiple add-ins simultaneously, the easiest way to access an add-in's **bundle.js** file from the DevTools window is to locate the add-in's ID in the file path.

- 4. In the **bundle.js** file, place breakpoints where you want the debugger to stop.
- 5. Run the debugger.

### **Debug with Visual Studio Code**

To debug your add-in in Visual Studio Code, you must have at least version 1.56.1 installed.

### **Configure the debugger**

Configure the debugger in Visual Studio Code. Follow the steps applicable to your add-in project.

### **Created with Yeoman generator**

- 1. In the command line, run the following to open your add-in project in Visual Studio Code.

```
command line
code .
```
- 2. In Visual Studio Code, open the **./.vscode/launch.json** file and add the following excerpt to your list of configurations. Save your changes.

```
JSON
{
 "name": "Direct Debugging",
 "type": "node",
 "request": "attach",
 "port": 9223,
 "timeout": 600000,
 "trace": true
}
```

{534}------------------------------------------------

#### **Other**

- 1. Create a new folder called **Debugging** (perhaps in your **Desktop** folder).
- 2. Open Visual Studio Code.
- 3. Go to **File** > **Open Folder**, navigate to the folder you created, then choose **Select Folder**.
- 4. On the Activity Bar, select **Run and Debug** ( Ctrl + Shift + D ).

- 5. Select the **create a launch.json file** link.
- 6. In the **Select Environment** dropdown, select **Edge: Launch** to create a launch.json file.
- 7. Add the following excerpt to your list of configurations. Save your changes.

```
JSON
{
 "name": "Direct Debugging",
 "type": "node",
 "request": "attach",
 "port": 9223,
 "timeout": 600000,
```

{535}------------------------------------------------

### **Attach the debugger**

}

The **bundle.js** file of an add-in contains the JavaScript code of your add-in. It's created when an Office on Windows application is opened. When Office starts, the **bundle.js** file of each installed add-in is cached in the **Wef** folder of your machine.

- 1. To find the add-in's **bundle.js** file, navigate to the following folder in File Explorer. The text enclosed in [] represents your applicable Office and add-in information.
text

%LOCALAPPDATA%\Microsoft\Office\16.0\Wef\{[Office profile GUID]}\[Office account encoding]\Javascript\[Add-in ID]_[Add-in Version]_[locale]

### **Tip**

- For readability, this article refers to the file name as **bundle.js**, but exact name depends on the Office application.
	- Excel: **bundle_excel.js**
	- Outlook: **bundle.js**.
	- PowerPoint: **bundle_powerpoint.js**
	- Word: **bundle_word.js**
- There's no direct method to determine the Office profile GUID and account encoding used in the **bundle.js** file path. The most effective approach to locate your add-in's **bundle.js** file is to manually inspect each folder until you locate the **Javascript** folder that contains your add-in's ID.
- The **bundle.js** file is downloaded to the local **Wef** folder when the add-in is first installed. It's refreshed every time the Office application starts or is restarted. If the **bundle.js** file doesn't appear in the **Wef** folder and your add-in is installed or sideloaded, restart Office. For Outlook, you may need to **remove your add-in**, then **sideload** it again.
- 2. Open **bundle.js** in Visual Studio Code.
- 3. Place breakpoints in **bundle.js** where you want the debugger to stop.

{536}------------------------------------------------

- 4. In the **DEBUG** dropdown, select **Direct Debugging**, then select the **Start Debugging** icon.
# **Run the debugger**

After confirming that the debugger is attached, return to the Office application. In the **Debug Event-based handler** dialog, select **OK**.

You can now reach your breakpoints to debug your event-based activation or spamreporting code.

#### ) **Important**

Starting in Version 2403 (Build 17425.20000), event-based and spam-reporting addins use the **[V8 JavaScript engine](https://v8.dev/)** to run JavaScript, regardless of whether debugging is turned on or off. In earlier versions, the Chakra JavaScript engine is used when debugging is off, but the V8 engine may be used when debugging is turned on.

# **Stop the debugger**

To stop debugging the rest of the current Office on Windows session, in the **Debug Eventbased handler** dialog, choose **Cancel**. To re-enable debugging, restart the Office application.

To prevent the **Debug Event-based handler** dialog from popping up and stop debugging for subsequent sessions, delete the associated registry key,

HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\Developer\[Add-in ID]\UseDirectDebugger , or set its value to 0 .

{537}------------------------------------------------

# **Stop the local server**

When you want to stop the local web server and uninstall the add-in, follow the applicable instructions:

- To stop the server, run the following command. If you used npm start , the following command should also uninstall the add-in.

| command line |  |
|--------------|--|
|--------------|--|

npm stop

- If you manually sideloaded the add-in, see Remove a sideloaded add-in.
# **See also**

- Activate add-ins with events
- Implement an integrated spam-reporting add-in
- Troubleshoot event-based and spam-reporting add-ins
- Debug your add-in with runtime logging

{538}------------------------------------------------

### **Handle date values in Outlook add-ins**

Article • 04/17/2025

The Office JavaScript API uses the JavaScript [Date](https://www.w3schools.com/jsref/jsref_obj_date.asp) object for most of the storage and retrieval of dates and times.

The Date object provides methods such as [getUTCDate](https://www.w3schools.com/jsref/jsref_getutcdate.asp) , [getUTCHour](https://www.w3schools.com/jsref/jsref_getutchours.asp) , [getUTCMinutes](https://www.w3schools.com/jsref/jsref_getutcminutes.asp) , and [toUTCString](https://www.w3schools.com/jsref/jsref_toutcstring.asp) , which return the requested date or time value according to Universal Coordinated Time (UTC) time.

It also provides other methods such as [getDate](https://www.w3schools.com/jsref/jsref_getutcdate.asp) , [getHour](https://www.w3schools.com/jsref/jsref_getutchours.asp) , [getMinutes](https://www.w3schools.com/jsref/jsref_getminutes.asp) , and [toString](https://www.w3schools.com/jsref/jsref_tostring_date.asp) , which return the requested date or time according to "local time".

The concept of "local time" is largely determined by the browser and operating system on the client computer. For instance, on most browsers running on a Windows-based client computer, a JavaScript call to getDate , returns a date based on the time zone set in Windows on the client computer.

The following example creates myLocalDate , which is a Date object in local time, and calls toUTCString to convert that date to a date string in UTC.

```
JavaScript
// Create and get the current date represented 
// in the client computer time zone.
const myLocalDate = new Date (); 
// Convert the Date value in the client computer time zone
// to a date string in UTC, and display the string.
document.write ("The current UTC time is " + 
 myLocalDate.toUTCString());
```
While you can use the JavaScript Date object to get a date or time value based on UTC or the client computer time zone, the Date object is limited in one respect - it doesn't provide methods to return a date or time value for any other specific time zone. For example, if your client computer is set to be on Eastern Standard Time (EST), there is no Date method that allows you to get the hour value other than in EST or UTC, such as Pacific Standard Time (PST).

### **Date-related features for Outlook add-ins**

The aforementioned JavaScript limitation has an implication for you when you use the Office JavaScript API to handle date or time values in add-ins that run in Outlook on Windows ([new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) or classic), on Mac, on the web, or on mobile devices.

#### **Time zones for Outlook clients**

For clarity, let's define the time zones in question.

| ノ Expand table |
|----------------|
|----------------|

| Time zone                                   | Description                                                                                                                                                                                                                                                                               |
|---------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Client computer time                        | This is set on the operating system of the client computer. Most browsers use the client computer time zone to display date                                                                                                                                                               |
| zone                                        | or time values of the JavaScript Date object.                                                                                                                                                                                                                                             |
|                                             | Outlook on Windows (classic) and Outlook on Mac use this time zone to display date or time values in the user interface.                                                                                                                                                                  |
|                                             | For example, on a client computer running Windows, classic Outlook uses the time zone set on Windows as the local time<br>zone. On the Mac, if the user changes the time zone on the client computer, Outlook on Mac would prompt the user to<br>update the time zone in Outlook as well. |
| Exchange Admin<br>Center (EAC) time<br>zone | The user sets this time zone value (and the preferred language) when they log on to Outlook on the web, new Outlook on<br>Windows, or mobile devices the first time.                                                                                                                      |
|                                             | Outlook on the web, new Outlook on Windows, and mobile devices use this time zone to display date or time values in the<br>user interface.                                                                                                                                                |

{539}------------------------------------------------

Because Outlook on Windows (classic) and Outlook on Mac use the client computer time zone, and the user interface of Outlook on the web, new Outlook on Windows, and mobile devices uses the EAC time zone, the local time for the same add-in installed on the same mailbox can be different depending on which platform your Outlook client is running. As an Outlook add-in developer, you should appropriately input and output date values so that those values are always consistent with the time zone that the user expects on the corresponding client.

#### **Date-related API**

The following are the properties and methods in the Office JavaScript API that support date-related features.

|  | ノ Expand table |  |
|--|----------------|--|
|--|----------------|--|

| API member                                                                                      | Time zone representation                                                                                                                                                                                                                                                                                                                                                                                  | Example in Outlook on<br>the web, on new<br>Windows client, and on<br>mobile devices                                                                                                                                   | Example in Outlook on<br>Windows (classic) and on<br>Mac                                                                                                                                |            |                                                                       |            |                                                                       |
|-------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------|-----------------------------------------------------------------------|------------|-----------------------------------------------------------------------|
| Office.context.mailbox.userProfile.timeZone                                                     | In Outlook on Windows (classic) and<br>Outlook on Mac, this property returns<br>the client computer time zone. In<br>Outlook on the web, on mobile<br>devices, and in new Outlook on<br>Windows, this property returns the<br>EAC time zone.                                                                                                                                                              | PST                                                                                                                                                                                                                    | EST                                                                                                                                                                                     |            |                                                                       |            |                                                                       |
| Office.context.mailbox.item.dateTimeCreated and<br>Office.context.mailbox.item.dateTimeModified | Each of these properties returns a<br>JavaScript Date object. This Date<br>value is UTC-correct, as shown in the<br>following example - myUTCDate has                                                                                                                                                                                                                                                     | If the item is created at 9<br>AM UTC:<br>Office.mailbox.item.                                                                                                                                                         | If the item creation time is<br>9 AM UTC:<br>Office.mailbox.item.                                                                                                                       |            |                                                                       |            |                                                                       |
|                                                                                                 | the same value in Outlook on the web,<br>on Windows (new and classic), on<br>Mac, and on mobile devices.                                                                                                                                                                                                                                                                                                  | dateTimeCreated.getHours<br>returns 4am EST.                                                                                                                                                                           | dateTimeCreated.getHours<br>returns 4am EST.                                                                                                                                            |            |                                                                       |            |                                                                       |
|                                                                                                 | const myDate =                                                                                                                                                                                                                                                                                                                                                                                            | If the item is modified at                                                                                                                                                                                             | If the item is modified at                                                                                                                                                              |            |                                                                       |            |                                                                       |
|                                                                                                 |                                                                                                                                                                                                                                                                                                                                                                                                           | Office.mailbox.item.dateTimeCreated;                                                                                                                                                                                   | const myUTCDate =<br>myDate.getUTCDate;                                                                                                                                                 | 11 AM UTC: | Office.mailbox.item.<br>dateTimeModified.getHours<br>returns 6am EST. | 11 AM UTC: | Office.mailbox.item.<br>dateTimeModified.getHours<br>returns 6am EST. |
|                                                                                                 | However, calling myDate.getDate<br>returns a date value in the client<br>computer time zone, which is<br>consistent with the time zone used to<br>display date times values in the<br>Outlook on Windows (classic) and on<br>Mac interfaces, but may be different<br>from the EAC time zone that Outlook<br>on the web, on mobile devices, and in<br>new Outlook on Windows use in its<br>user interface. | Notice that if you want to<br>display the creation or<br>modification time in the<br>user interface, you would<br>want to first convert the<br>time to PST to be<br>consistent with the rest of<br>the user interface. |                                                                                                                                                                                         |            |                                                                       |            |                                                                       |
| Office.context.mailbox.displayNewAppointmentForm Each of the start and end                      | parameters requires a JavaScript Date<br>object. The arguments should be UTC<br>correct regardless of the time zone<br>used in the user interface of Outlook<br>on the web, on Windows (new and<br>classic), on Mac, or on mobile devices.                                                                                                                                                                | If the start and end times<br>for the appointment form<br>are 9 AM UTC and 11 AM<br>UTC, then you should<br>ensure that the start and<br>end arguments are UTC<br>correct, which means:                                | If the start and end times<br>for the appointment form<br>are 9 AM UTC and 11 AM<br>UTC, then you should<br>ensure that the start and<br>end arguments are UTC<br>correct, which means: |            |                                                                       |            |                                                                       |
|                                                                                                 |                                                                                                                                                                                                                                                                                                                                                                                                           | start.getUTCHours<br>returns 9am UTC<br>end.getUTCHours<br>returns 11am UTC                                                                                                                                            | start.getUTCHours<br>returns 9am UTC<br>end.getUTCHours<br>returns 11am UTC                                                                                                             |            |                                                                       |            |                                                                       |

{540}------------------------------------------------

### **Helper methods for date-related scenarios**

The local time for a user in Outlook on the web, on mobile devices, and in new Outlook on Windows can be different from that in Outlook on Windows (classic) and Outlook on Mac, but the JavaScript **Date** object supports converting to only the client computer time zone or UTC. To overcome this, the Office JavaScript API provides two helper methods: [Office.context.mailbox.convertToLocalClientTime](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#methods) and [Office.context.mailbox.convertToUtcClientTime.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/office.context.mailbox#methods)

These helper methods take care of any need to handle date or time differently for the following two date-related scenarios in Outlook on the web, on Windows (new and classic), on Mac, and on mobile devices, thus reinforcing "write-once" for different clients of your add-in.

### **Scenario A: Displaying item creation or modified time**

If you are displaying the item creation time ( Item.dateTimeCreated ) or modification time ( Item.dateTimeModified in the user interface, first use convertToLocalClientTime to convert the Date object provided by these properties to obtain a dictionary representation in the appropriate local time. Then display the parts of the dictionary date. The following is an example of this scenario.

JavaScript

```
// This date is UTC-correct.
const myDate = Office.context.mailbox.item.dateTimeCreated;
// Call helper method to get date in dictionary format, 
// represented in the appropriate local time.
// In Outlook on Windows (classic) and Outlook on Mac, this dictionary format 
// is in the client computer time zone.
// In Outlook on the web, on mobile devices, or in new Outlook on Windows,
// this dictionary format is in the EAC time zone.
const myLocalDictionaryDate = Office.context.mailbox.convertToLocalClientTime(myDate);
// Display different parts of the dictionary date.
document.write ("The item was created at " + myLocalDictionaryDate["hours"] + 
 ":" + myLocalDictionaryDate["minutes"]);)
```
Note that convertToLocalClientTime takes care of the difference between Outlook on Windows (classic) or Outlook on Mac and Outlook on the web, on mobile devices, or new Outlook on Windows.

- If convertToLocalClientTime detects the current application is Outlook on Windows (classic) or Outlook on Mac, the method converts the Date representation to a dictionary representation in the same client computer time zone, consistent with the rest of the Outlook on Windows (classic) or Outlook on Mac user interface.
- If convertToLocalClientTime detects the current application is Outlook on the web, on mobile devices, or new Outlook on Windows, the method converts the UTC-correct Date representation to a dictionary format in the EAC time zone, consistent with the rest of the user interfaces of these Outlook clients.

### **Scenario B: Displaying start and end dates in a new appointment form**

If you are obtaining as input different parts of a date-time value represented in the local time, and would like to provide this dictionary input value as a start or end time in an appointment form, first use the convertToUtcClientTime helper method to convert the dictionary value to a UTC-correct Date object.

In the following example, assume myLocalDictionaryStartDate and myLocalDictionaryEndDate are date-time values in dictionary format that you have obtained from the user. These values are based on the local time, dependent on the client platform.

JavaScript

const myUTCCorrectStartDate = Office.context.mailbox.convertToUtcClientTime(myLocalDictionaryStartDate); const myUTCCorrectEndDate = Office.context.mailbox.convertToUtcClientTime(myLocalDictionaryEndDate);

{541}------------------------------------------------

The resultant values, myUTCCorrectStartDate and myUTCCorrectEndDate , are UTC-correct. Then, pass these Date objects as arguments for the start and end parameters of the Mailbox.displayNewAppointmentForm method to display the new appointment form.

Note that convertToUtcClientTime takes care of the difference between Outlook on Windows (classic) or on Mac and Outlook on the web, on mobile devices, or new Outlook on Windows:

- If convertToUtcClientTime detects the current application is Outlook on Windows (classic) or on Mac, the method simply converts the dictionary representation to a Date object. This Date object is UTC-correct, as expected by displayNewAppointmentForm .
- If convertToUtcClientTime detects the current application is Outlook on the web, on mobile devices, or new Outlook on Windows, the method converts the dictionary format of the date and time values expressed in the EAC time zone to a Date object. This Date object is UTC-correct, as expected by displayNewAppointmentForm .

### **See also**

- Deploy and install Outlook add-ins for testing