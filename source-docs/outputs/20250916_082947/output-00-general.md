
# **Runtimes in Office Add-ins**

07/03/2025

Office Add-ins execute in runtimes embedded in Office. As an interpreted language, JavaScript must run in a JavaScript runtime. [Node.js](https://nodejs.org/) and modern browsers are examples of such runtimes.

# **Types of runtimes**

There are two types of runtimes used by Office Add-ins:

- **JavaScript-only runtime**: A JavaScript engine supplemented with support for [WebSockets](https://developer.mozilla.org/docs/Web/API/WebSockets_API) , [Full CORS (Cross-Origin Resource Sharing)](https://developer.mozilla.org/docs/Web/HTTP/CORS) , and client-side storage of data. It doesn't support [local storage](https://developer.mozilla.org/docs/Web/API/Window/localStorage) or cookies.
- **Browser runtime**: Includes all the features of a JavaScript-only runtime and adds support for [local storage](https://developer.mozilla.org/docs/Web/API/Window/localStorage) , a [rendering engine](https://developer.mozilla.org/docs/Glossary/Rendering_engine) that renders HTML, and cookies.

Details about these types are later in this article at JavaScript-only runtime and Browser runtime.

The following table shows the possible features of an add-in, according to each type of runtime.

| ノ | Expand table |  |
|---|--------------|--|
|   |              |  |

| Type of<br>runtime | Add-in feature                                                                                               |
|--------------------|--------------------------------------------------------------------------------------------------------------|
| JavaScript-only    | Excel custom functions<br>(except when the runtime is shared or the add-in is running in Office on the web)  |
|                    | Excel, PowerPoint, or Word event-based task<br>(only when the add-in is running on Windows)                  |
|                    | Outlook event-based task<br>(only when the add-in is running in classic Outlook on Windows)                  |
|                    | Outlook integrated spam reporting feature<br>(only when the add-in is running in classic Outlook on Windows) |
| browser            | task pane                                                                                                    |
|                    | dialog                                                                                                       |
|                    | function command                                                                                             |


| Type of<br>runtime | Add-in feature                                                                                                                                                                    |
|--------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                    | Excel custom functions<br>(when the runtime is shared or the add-in is running in Office on the web)                                                                              |
|                    | Excel, PowerPoint, or Word event-based task<br>(only when the add-in is running on Mac or the web)                                                                                |
|                    | Outlook event-based task<br>(when the add-in is running in Outlook on Mac or Outlook on the web or in the new                                                                     |
|                    | Outlook on Windows<br>)<br>Outlook integrated spam reporting feature<br>(only when the add-in is running in Outlook on Mac or on the web or in the new<br>Outlook on Windows<br>) |

The following table shows the same information organized by which type of runtime is used for the various possible features of an add-in.

ノ **Expand table**

| Add-in feature                               | Type of runtime on                                                                        | Type of runtime | Type of runtime on                                             |        |         |         |         |
|----------------------------------------------|-------------------------------------------------------------------------------------------|-----------------|----------------------------------------------------------------|--------|---------|---------|---------|
|                                              | Excel custom functions                                                                    | Windows         | JavaScript-only<br>(but browser when the<br>runtime is shared) | on Mac | browser | the web | browser |
| Outlook event-based tasks                    | JavaScript-only<br>(classic Outlook on<br>Windows)<br>browser<br>(new Outlook on Windows) | browser         | browser                                                        |        |         |         |         |
| Event-based tasks on other<br>applications   | JavaScript-only                                                                           | browser         | browser                                                        |        |         |         |         |
| Outlook integrated spam<br>reporting feature | JavaScript-only<br>(classic Outlook on<br>Windows)<br>browser<br>(new Outlook on Windows) | browser         | browser                                                        |        |         |         |         |
| task pane                                    | browser                                                                                   | browser         | browser                                                        |        |         |         |         |


| Add-in feature   | Type of runtime on | Type of runtime | Type of runtime on |        |         |         |         |
|------------------|--------------------|-----------------|--------------------|--------|---------|---------|---------|
|                  | dialog             | Windows         | browser            | on Mac | browser | the web | browser |
| function command | browser            | browser         | browser            |        |         |         |         |

In Office on the web, everything always runs in a browser type runtime. With one exception, everything in an add-in on the web runs in the *same* browser process: the browser process in which the user has opened Office on the web. The exception is when a dialog is opened with a call of [Office.ui.displayDialogAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.ui#office-office-ui-displaydialogasync-member(1)) and the [DialogOptions.displayInIFrame](https://learn.microsoft.com/en-us/javascript/api/office/office.dialogoptions#office-office-dialogoptions-displayiniframe-member) option is *not* passed and set to true . When the option isn't passed (so it has the default false value), the dialog opens in its own process. The same principle applies to the [OfficeRuntime.displayWebDialog](https://learn.microsoft.com/en-us/javascript/api/office-runtime#office-runtime-officeruntime-displaywebdialog-function(1)) method and the [OfficeRuntime.DisplayWebDialogOptions.displayInIFrame](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.displaywebdialogoptions#office-runtime-officeruntime-displaywebdialogoptions-displayiniframe-member) option.

When an add-in is running on a platform other than the web, the following principles apply.

- A dialog runs in its own runtime process.
- An Outlook event-based or spam-reporting add-in runs in its own runtime process.

#### 7 **Note**

The **event-based activation** and **integrated spam reporting** features in Outlook must use the same runtime. Multiple runtimes aren't currently supported in Outlook.

- By default, task panes, function commands, and Excel custom functions each run in their own runtime process. However, for some Office host applications, the add-in manifest can be configured so that any two, or all three, can run in the same runtime. See Shared runtime.
Depending on the host Office application and the features used in the add-in, there may be many runtimes in an add-in. Each usually will run in its own process but not necessarily simultaneously. The following are examples.

- A PowerPoint or Word add-in that doesn't share any runtimes, and includes the following features, has as many as three runtimes.
	- A task pane
	- A function command
	- A dialog (A dialog can be launched from either the task pane or the function command.)


#### 7 **Note**

It's not a good practice to have multiple dialogs open simultaneously, but if the add-in enables the user to open one from the task pane and another from the function command at the same time, this add-in would have four runtimes. A task pane, and a given invocation of a function command can have only one open dialog at a time; but if the function command is invoked multiple times, a new dialog is opened on top of its predecessor with each invocation, so there could be many runtimes. The remainder of this list ignores the possibility of multiple open dialogs.

- An Excel add-in that doesn't share any runtimes, and includes the following features, has as many as *four* runtimes.
	- A task pane
	- A function command
	- A custom function
	- A dialog (A dialog can be launched from either the task pane, the function command, or a custom function.)
- An Excel add-in with the same features and is configured to share the same runtime across the task pane, function command, and custom function, has *two* runtimes. A shared runtime can open only one dialog at a time.
- An Excel add-in with the same features, except that it has no dialog, and is configured to share the same runtime across the task pane, function command, and custom function, has *one* runtime.
- An Outlook add-in that has the following features has as many as *four* runtimes. Shared runtimes aren't supported in Outlook.
	- A task pane
	- A function command
	- An event-based task or integrated spam reporting feature
	- A dialog (A dialog can be launched from either the task pane or the function command, but not from an event-based task.)

## **Share data across runtimes**

#### 7 **Note**


- If you know that your add-in will only be used in Office on the web and that it won't open any dialogs with the displayInIFrame option set to true , then you can ignore this section. Since everything in your add-in runs in the same runtime process, you can just use global variables to share data between features.
- As noted above in **Types of runtimes**, the type of runtime used by a feature varies partly by platform. It's a good practice to avoid having add-in code that branches based on platform, so the guidance in this section recommends techniques that will work cross-platform. There is only one case, noted below, in which branching code is required.

For Excel, PowerPoint, and Word add-ins, use a Shared runtime when any two or more features, except dialogs, need to share data. In Outlook, or scenarios where sharing a runtime isn't feasible, you need alternative methods. The parts of the add-in that are in separate runtime processes don't share global data automatically and are treated by the add-in's web application server as separate sessions, so [Window.sessionStorage](https://developer.mozilla.org/docs/Web/API/Window/sessionStorage) can't be used to share data between them. *The following guidance assumes that you're not using a shared runtime.*

- Pass data between a dialog and its parent task pane, function command, or custom function by using the [Office.ui.messageParent](https://learn.microsoft.com/en-us/javascript/api/office/office.ui#office-office-ui-messageparent-member(1)) and [Dialog.messageChild](https://learn.microsoft.com/en-us/javascript/api/office/office.dialog#office-office-dialog-messagechild-member(1)) methods.
#### 7 **Note**

The OfficeRuntime.storage methods can't be called in a dialog, so this isn't an option for sharing data between a dialog and another runtime.

- To share data between a task pane and a function command, store data in [Window.localStorage](https://developer.mozilla.org/docs/Web/API/Window/localStorage) , which is shared across all runtimes that access the same specific [origin](https://developer.mozilla.org/docs/Glossary/Origin) .
#### 7 **Note**

LocalStorage isn't accessible in a JavaScript-only runtime and, thus, it isn't available in Excel custom functions. It also can't be used to share data with an Outlook eventbased tasks (since those tasks use a JavaScript-only runtime on some platforms).

Starting in Version 115 of Chromium-based browsers, such as Chrome and Edge, **[storage partitioning](https://developer.chrome.com/docs/privacy-sandbox/storage-partitioning/)** is enabled to prevent specific side-channel cross-site tracking (see also **[Microsoft Edge browser policies](https://learn.microsoft.com/en-us/deployedge/microsoft-edge-policies#defaultthirdpartystoragepartitioningsetting)**). This means that data stored by storage


APIs, such as local storage, are only available to contexts with the same origin and the same top-level site.

#### **Tip**

Data in Window.localStorage persists between sessions of the add-in and is shared by add-ins with the same origin. Both of these characteristics are often undesirable for an add-in.

- To ensure that each session of a given add-in starts fresh call the **[Window.localStorage.clear](https://developer.mozilla.org/docs/Web/API/Storage/clear)** method when the add-in starts.
- To allow some stored values to persist, but reinitialize other values, use **[Window.localStorage.setItem](https://developer.mozilla.org/docs/Web/API/Storage/setItem)** when the add-in starts for each item that should be reset to an initial value.
- To delete an item entirely, call **[Window.localStorage.removeItem](https://developer.mozilla.org/docs/Web/API/Storage/removeItem)** .
- To share data between an Excel custom function and any other runtime, use [OfficeRuntime.storage](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.storage).
- To share data between an Outlook event-based task and a task pane or function command, you must branch your code by the value of the [Office.context.platform](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-platform-member) property.
	- When the value is PC (Windows), store and retrieve data using the [Office.sessionData](https://learn.microsoft.com/en-us/javascript/api/outlook/office.sessiondata) APIs.
	- When the value is Mac , use Window.localStorage as described earlier in this list.

Other ways to share data include the following:

- Store shared data in an online database that is accessible to all the runtimes.
- Store shared data in a cookie for the add-in's domain to share it between browser runtimes. JavaScript-only runtimes don't support cookies.

For more information, see Persist add-in state and settings and Get and set add-in metadata for an Outlook add-in.

## **JavaScript-only runtime**

The JavaScript-only runtime that is used in Office Add-ins is a modification of an open source runtime originally created for [React Native](https://reactnative.dev/) . It contains a JavaScript engine supplemented with support for [WebSockets](https://developer.mozilla.org/docs/Web/API/WebSockets_API) , [Full CORS (Cross-Origin Resource Sharing)](https://developer.mozilla.org/docs/Web/HTTP/CORS) , and


[OfficeRuntime.storage](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.storage). It doesn't have a rendering engine, and it doesn't support cookies or [local storage](https://developer.mozilla.org/docs/Web/API/Window/localStorage) .

This type of runtime is used in event-based and spam-reporting add-ins in classic Outlook on Windows only and in Excel custom functions *except* when the custom functions are sharing a runtime.

- When used for an Excel custom function, the runtime starts up when either the worksheet recalculates or the custom function calculates. It doesn't shut down until the workbook is closed.
- When used in an Outlook event-based or spam-reporting add-in, the runtime starts up when the event occurs. It ends when the first of the following occurs.
	- The event handler calls the completed method of its event parameter.
	- Five minutes have elapsed since the triggering event.
	- The user changes focus from the window where the event was triggered, such as a message compose window (only applies to event-based add-ins).

#### 7 **Note**

The **event-based activation** and **integrated spam reporting** features in Outlook must use the same runtime. Multiple runtimes aren't currently supported in Outlook.

A JavaScript-only runtime uses less memory and starts up faster than a browser runtime, but has fewer features.

#### ) **Important**

In Office for Windows versions before 2403 (Build 16.0.17425.20000) and perpetual license Office through Office 2021, the JavaScript-only runtime directly supports the ECMAScript 2016 standard of JavaScript. However, you can use later versions of JavaScript or TypeScript. For information about how to do this, see **Support for recent versions of JavaScript**.

## **Browser runtime**

Office Add-ins use a different browser type runtime depending on the platform in which Office is running (web, Mac, or Windows), and on the version and build of Windows and Office. For example, if the user is running Office on the web in a FireFox browser, then the Firefox runtime is used. If the user is running Office on Mac, then the Safari runtime is used. If the user is


running Office on Windows, then either an Edge or Internet Explorer provides the runtime, depending on the version of Windows and Office. Details can be found in Browsers and webview controls used by Office Add-ins.

All of these runtimes include an HTML rendering engine and provide support for [WebSockets](https://developer.mozilla.org/docs/Web/API/WebSockets_API) , [Full CORS (Cross-Origin Resource Sharing)](https://developer.mozilla.org/docs/Web/HTTP/CORS) , and [local storage](https://developer.mozilla.org/docs/Web/API/Window/localStorage) , and cookies.

A browser runtime lifespan varies depending on the feature that it implements and on whether it's being shared or not.

- When an add-in with a task pane is launched, a browser runtime starts, unless it's a shared runtime that is already running. If it's a shared runtime, it shuts down when the document is closed. If it isn't a shared runtime, it shuts down when the task pane is closed.
- When a dialog is opened, a browser runtime starts. It shuts down when the dialog is closed.
- When a function command is executed (which happens when a user selects its button or menu item), a browser runtime starts, unless it's a shared runtime that is already running. If it's a shared runtime, it shuts down when the document is closed. If it isn't a shared runtime, it shuts down when the first of the following occurs.
	- The function command calls the completed method of its event parameter.
	- Five minutes have elapsed since the triggering event. (If a dialog was opened in the function command and it's still open when the parent runtime times out, the dialog runtime stays running until the dialog is closed.)
- When an Excel custom function is using a shared runtime, then a browser-type runtime starts when the custom function calculates if the shared runtime hasn't already started for some other reason. It shuts down when the document is closed.

#### 7 **Note**

When a runtime is being **shared**, it's possible for your code to close the task pane without shutting down the add-in. See **Show or hide the task pane of your Office Add-in** for more information.

A browser runtime has more features than a JavaScript-only runtime, but starts up slower and uses more memory.

### **Shared runtime**


A "shared runtime" isn't a type of runtime. It refers to a browser-type runtime that's being shared by features of the add-in that would otherwise each have their own runtime. Specifically, you have the option of configuring the add-in's task pane and function commands to share a runtime. In an Excel add-in, you can also configure custom functions to share the runtime of a task pane or function command or both. When you do this, the custom functions are running in a browser-type runtime, instead of a JavaScript-only runtime as it otherwise would. See Configure your add-in to use a shared runtime for information about the benefits and limitations of sharing runtimes and instructions for configuring the add-in to use a shared runtime. In brief, the JavaScript-only runtime uses less memory and starts up faster, but has fewer features.

#### 7 **Note**

- You can share runtimes only in Excel, PowerPoint, and Word.
- You can't configure a dialog to share a runtime. Each dialog always has its own, except when the dialog is launched in Office on the web with the displayInIFrame option set to true .
- A shared runtime never uses the original Microsoft Edge WebView (EdgeHTML) runtime. If the conditions for using Microsoft Edge with WebView2 (Chromiumbased) are met (as specified in **Browsers and webview controls used by Office Addins**), then that runtime is used. Otherwise, the Internet Explorer 11 runtime is used.

# **Support older Microsoft webviews and Office versions**

Article • 01/07/2025

Office Add-ins are web applications that are displayed inside iframes when running on Office on the web. Office Add-ins are displayed using an embedded browser control (also known as a webview) when running in Office on Windows or Office on the Mac. The embedded browser controls are supplied by the operating system or by a browser installed on the user's computer.

#### ) **Important**

**Webviews from Internet Explorer and Microsoft Edge Legacy are still used in Office Add-ins**

Some combinations of platforms and Office versions, including volume-licensed perpetual versions through Office 2019, still use the webview controls that come with Internet Explorer 11 (called "Trident") and Microsoft Edge Legacy (called "EdgeHTML") to host add-ins, as explained in **Browsers and webview controls used by Office Add-ins**. Internet Explorer 11 was disabled in Windows 10 and Windows 11 in February 2023, and the UI for launching it was removed; but it's still installed on with those operating systems. So, Trident and other functionality from Internet Explorer can still be called programmatically by Office.

We recommend (but don't require) that you support these combinations, at least in a minimal way, by providing users of your add-in a graceful failure message when your add-in is launched in these webviews. Keep these additional points in mind:

- Office on the web no longer opens in Internet Explorer or Microsoft Edge Legacy. Consequently, **[AppSource](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/submit-to-appsource-via-partner-center)** doesn't test add-ins in Office on the web on these browsers.
- AppSource still tests for combinations of platform and Office *desktop* versions that use Trident or EdgeHTML. However, it only issues a warning when the add-in doesn't support these webviews; the add-in isn't rejected by AppSource.
- The **Script Lab tool** no longer supports Trident.

If you plan to support older versions of Windows and Office, your add-in must work in the embeddable browser controls used by these versions. For example, browser controls 


based on Internet Explorer 11 (IE11) or Microsoft Edge Legacy (EdgeHTML-based). For information about which combinations of Windows and Office use these browser controls, see Browsers and webview controls used by Office Add-ins.

## **Determine the webview the add-in is running in at runtime**

Your add-in can discover the webview that it's running in by reading the [window.navigator.userAgent](https://developer.mozilla.org/docs/Web/API/Navigator/userAgent) property. This enables the add-in to either provide an alternate experience or gracefully fail. The following is an example that determines whether the add-in is running in Trident or EdgeHTML.

```
JavaScript
if (navigator.userAgent.indexOf("Trident") !== -1) {
 /*
 Trident is the webview in use. Do one of the following:
 1. Provide an alternate add-in experience that doesn't use any of
the HTML5
 features that aren't supported in Trident (Internet Explorer 11).
 2. Enable the add-in to gracefully fail by adding a message to the
UI that
 says something similar to:
 "This add-in won't run in your version of Office. Please upgrade
either to
 perpetual Office 2021 (or later) or to a Microsoft 365 account."
 */
} else if (navigator.userAgent.indexOf("Edge") !== -1) {
 /*
 EdgeHTML is the browser in use. Do one of the following:
 1. Provide an alternate add-in experience that's supported in
EdgeHTML (Microsoft Edge Legacy).
 2. Enable the add-in to gracefully fail by adding a message to the
UI that
 says something similar to:
 "This add-in won't run in your version of Office. Please upgrade
either to
 perpetual Office 2021 (or later) or to a Microsoft 365 account."
 */
} else {
 /* 
 A webview other than Trident or EdgeHTML is in use.
 Provide a full-featured version of the add-in here.
 */
}
```


Microsoft Edge (Chromium) returns edg/ followed by one or more version digits and zero or more . separators as the user agent; for example, edg/76.0.167.1 . **Note that the e isn't present at the end of name! It's "edg", not "edge".**

This JavaScript should be as early in the add-in startup process as possible. The following is an example of an add-in home page that advises users to upgrade Office when Trident is detected.

```
HTML
<!doctype html>
<html lang="en" data-framework="typescript">
<head>
 <meta charset="UTF-8" />
 <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <title>Contoso Task Pane Add-in</title>
 <!-- Office JavaScript API -->
 <script type="text/javascript"
src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
</head>
<body>
 <div id="main">
 <!-- 
 The add-in UI is here. 
 -->
 </div>
 <!-- 
 The script below makes the following div display if the
 webview is Trident, and hides the regular div. 
 -->
 <div id="tridentmessage" style="display: none; padding: 10;">
 This add-in will not run in your version of Office. Please upgrade
either to 
 perpetual Office 2021 (or later) or to a Microsoft 365 account.
 </div>
 <script>
 if (navigator.userAgent.indexOf("Trident") !== -1) {
 var tridentMessage = document.getElementById("tridentmessage");
 var normalUI = document.getElementById("main");
 tridentMessage.style.display = "block";
 normalUI.style.display = "none";
 } 
 </script>
</body>
</html>
```


#### ) **Important**

It's not always a good practice to read the userAgent property. Be sure you're familiar with the article, **[Browser detection using the user agent](https://developer.mozilla.org/docs/Web/HTTP/Browser_detection_using_the_user_agent)** , including the recommendations and alternatives to reading userAgent . In particular, if you're providing an alternate add-in experience to support the use of Trident, consider using feature detection instead of testing for the user agent. But if you're just providing a notification that the add-in doesn't work in Trident, as in this case, using userAgent is appropriate.

As of July 24th, 2023, the non-English versions of the article are all out-of-date to varying degrees; some are over 12 years out-of-date.

As of the same date, the text and tables in the section **[Which part of the user](https://developer.mozilla.org/docs/Web/HTTP/Browser_detection_using_the_user_agent#which_part_of_the_user_agent_contains_the_information_you_are_looking_for) [agent contains the information you are looking for?](https://developer.mozilla.org/docs/Web/HTTP/Browser_detection_using_the_user_agent#which_part_of_the_user_agent_contains_the_information_you_are_looking_for)** of the *English* version of the article no longer mention Trident or Internet Explorer 11. In the table for **Browser Name and version**, the row for Internet Explorer 11 was the following:

ノ **Expand table**

| Engine               | Must contain          | Must not contain |
|----------------------|-----------------------|------------------|
| Internet Explorer 11 | Trident/7.0; .*rv:xyz |                  |

In the table for **Rendering engine**, the row for Trident was the following:

ノ **Expand table**

| Engin<br>e | Must<br>contain | Comment                                                               |
|------------|-----------------|-----------------------------------------------------------------------|
| Tride      | Trident/xy      | Internet Explorer places this fragment in the comments section of the |
| nt         | z               | User-Agent string.                                                    |

## **Review webview and Office version support information**

For more information on how to support specific webviews and Office versions, select the applicable tab.

Trident (Internet Explorer)


The JavaScript engine associated with Trident doesn't support JavaScript versions later than ES5. To use more modern versions of JavaScript or to use TypeScript, see Support for recent versions of JavaScript.

#### ) **Important**

Trident doesn't support some HTML5 features such as media, recording, and location. If your add-in must support Trident, then you must either design the add-in to avoid these unsupported features or the add-in must detect when Trident is being used and provide an alternate experience that doesn't use the unsupported features. For more information, see **Determine the webview the add-in is running in at runtime**.

### **Test an add-in on Trident (Internet Explorer)**

See Trident testing.

### **Support for recent versions of JavaScript**

If you want to use the syntax and features of a version of JavaScript that is newer than the one supported in the webview or runtime that your code is running in, or you want to use TypeScript, you must use a transpiler or a polyfill or both. For example, a transpiler will convert syntax or operators, such as the => operator, that is unknown in ES5, to ES5. A polyfill replaces methods, types, and classes from a newer version of JavaScript into equivalent functionality in an older version.

The following subsections assume that the target JavaScript standard is ES5, but the information applies with other targets too. For example, if your target is ECMAScript 2016, just replace "ES5" with "ECMAScript 2016" (and "post-ES5" with "post-ECMAScript 2016") in these subsections.

#### **Use a transpiler**

You can write your code in either TypeScript or modern JavaScript and then transpile it at build-time into ES5 JavaScript. The resulting ES5 files are what you upload to your add-in's web application.

There are two popular transpilers. Both of them can work with source files that are TypeScript or post-ES5 JavaScript. They also work with React files (.jsx and .tsx).


- [babel](https://babeljs.io/)
- [tsc](https://www.typescriptlang.org/index.html)

See the documentation for either of them for information about installing and configuring the transpiler in your add-in project. We recommend that you use a task runner, such as [Grunt](https://gruntjs.com/) or [WebPack](https://webpack.js.org/) to automate the transpilation. For a sample addin that uses tsc, see [Office Add-in Microsoft Graph React](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-Microsoft-Graph-React) . For a sample that uses babel, see [Offline Storage Add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/Excel.OfflineStorageAddin) .

#### 7 **Note**

If you're using Visual Studio (not Visual Studio Code), tsc is probably easiest to use. You can install support for it with a nuget package. For more information, see **[JavaScript and TypeScript in Visual Studio](https://learn.microsoft.com/en-us/visualstudio/javascript/javascript-in-visual-studio)**. To use babel with Visual Studio, create a build script or use the Task Runner Explorer in Visual Studio with tools like the **[WebPack Task Runner](https://marketplace.visualstudio.com/items?itemName=MadsKristensen.WebPackTaskRunner)** or **[NPM Task Runner](https://marketplace.visualstudio.com/items?itemName=MadsKristensen.NPMTaskRunner)** .

### **Use a polyfill**

A [polyfill](https://en.wikipedia.org/wiki/Polyfill_(programming)) is earlier-version JavaScript that duplicates functionality from more recent versions of JavaScript. The polyfill works in webviews that don't support the later JavaScript versions. For example, the string method startsWith wasn't part of the ES5 version of JavaScript, and so it won't run in Trident (Internet Explorer 11). There are polyfill libraries, written in ES5, that define and implement a startsWith method. We recommend the [core-js](https://github.com/zloirock/core-js) polyfill library.

To use a polyfill library, load it like any other JavaScript file or module. For example, you can use a <script> tag in the add-in's home page HTML file (for example <script src="/js/core-js.js"></script> ), or you can use an import statement in a JavaScript file (for example, import 'core-js'; ). When the JavaScript engine sees a method like startsWith , it will first look to see if there's a method of that name built into the language. If there is, it will call the native method. If, and only if, the method isn't builtin, the engine will look in all loaded files for it. So, the polyfilled version isn't used in browsers that support the native version.

Importing the entire core-js library will import all core-js features. You can also import only the polyfills that your Office Add-in requires. For instructions about how to do this, see [CommonJS APIs](https://github.com/zloirock/core-js#commonjs-api) . The core-js library has most of the polyfills that you need. There are a few exceptions detailed in the [Missing Polyfills](https://github.com/zloirock/core-js#missing-polyfills) section of the core-js


documentation. For example, it doesn't support fetch , but you can use the [fetch](https://github.com/github/fetch) polyfill.

For a sample add-in that uses core.js, see [Word Add-in Angular2 StyleChecker](https://github.com/OfficeDev/Word-Add-in-Angular2-StyleChecker) .

### **See also**

- Browsers and webview controls used by Office Add-ins
- [ECMAScript 6 compatibility table](http://compat-table.github.io/compat-table/es6/)
- [Can I use... Support tables for HTML5, CSS3, etc](https://caniuse.com/)

# **Manage both a unified manifest and an add-in only manifest version of your Office Add-in**

Article • 06/10/2024

Microsoft is making a number of improvements to the Microsoft 365 developer platform. These improvements provide more consistency in the development, deployment, installation, and administration of all types of extensions of Microsoft 365, including Office Add-ins.

One important improvement we're working on is the ability to create a single unit of distribution for all your Microsoft 365 extensions by using the same manifest format: the JSON-formatted unified manifest for Microsoft 365.

### **Tip**

For information about converting an existing add-in to use the unified manifest, see **Convert an add-in to use the unified manifest for Microsoft 365**.

After you've created a version of your add-in that uses the unified manifest, you must link the existing add-in and the app built using the unified manifest to ensure users don't see two copies of the add-in UI inside of Outlook.

### 7 **Note**

The configuration described below doesn't take effect for up to 24 hours after the new version is installed on a user's computer. During that period, the UI of both versions is visible. For example, if both versions have a custom ribbon button, both buttons appear on the ribbon.

Use the following steps.

- 1. Open the extension object in the "extensions" array.
- 2. Create an "alternatives" array property, if there isn't one already.
- 3. In the "alternatives" array, create an "alternate" object that has a "hide" property.
- 4. If the existing add-in is marketed through AppSource, give the "hide" object a "storeOfficeAddin" property. Otherwise, skip to step 6.


- 5. Give the "storeOfficeAddin" object two properties:
	- An "officeAddinId" with the GUID of the old add-in as its value.
	- An "assetId" with the AppSource asset ID as its value.

The following is an example:

```
JSON
"extensions": [
 ...
 {
 ...
 "alternates": [
 ...
 {
 ...
 "hide": {
 "storeOfficeAddin": {
 "officeAddinId": "b5a2794d-4aa5-4023-a84b-
c60a3cbd33d4",
 "assetId": "WA999999999"
 }
 }
 }
 ]
 }
]
```
#### 7 **Note**

- The asset ID of the add-in in your unified manifest must match with an existing add-in that has been published by your seller account on Partner Center. If the asset ID of the add-in that you have linked in your unified manifest doesn't match an existing offer published by your seller account, the unified manifest submission will fail. You'll need to update the manifest to use the correct add-in asset ID and re-submit the unified manifest.
- An existing add-in can only be hidden by a single unified manifest. At this time, you may not use multiple unified manifests to hide the same add-in. If you try to hide an already linked add-in using a different unified manifest, the submission will fail. You'll need to remove the linking and re-submit the unified manifest.


- 6. If the old add-in isn't distributed through AppSource, then give the "hide" object a "customOfficeAddin" property.
- 7. Give the "customOfficeAddin" object an "officeAddinId" property with the GUID of the old add-in as its value. The following is an example.

```
JSON
"extensions": [
 ...
 {
 ...
 "alternates": [
 ...
 {
 ...
 "hide": {
 "customOfficeAddin": {
 "officeAddinId": "b5a2794d-4aa5-4023-a84b-
c60a3cbd33d4"
 }
 }
 }
 ]
 }
]
```
Don't remove the existing add-in from AppSource or the Microsoft 365 Admin Center, or earlier versions of Office will no longer be able to use your add-in.

## **Maintain both versions for the immediate future**

Generally, add-ins that use the unified manifest can be installed only on Microsoft 365 Version 2307 (Build 16626.20132) and later. However, there are two exceptions which enable these add-ins to be installed on older versions of Microsoft 365 and on perpetual license versions of Office.

- The user's Microsoft 365 administrator deploys the add-in for all users.
- The user installs the add-in on another Microsoft 365 client app that *is* version Version 2307 (Build 16626.20132) and later. This makes the add-in available on the same user's other Office clients, including older or perpetual license.

If you have users on older or perpetual license versions for which these exceptions don't apply, then you will need to maintain both versions of the add-in. When all of your users 


are working with Office versions that support the unified manifest, you can remove the XML version from deployment.

There are also some scenarios where you might want to maintain both both versions of the add-in for an extended period. For example, there are two features of add-ins that aren't supported with the unified manifest because they're little used or deprecated. You may choose to maintain a version of your add-in that uses these features. The following are the features that aren't supported in the unified manifest.

- Outlook modules aren't supported. But you can provide a nearly identical experience using the unified manifest by [including a Teams Tab with your add-in in](https://learn.microsoft.com/en-us/microsoftteams/platform/m365-apps/combine-office-add-in-and-teams-app) [a single app](https://learn.microsoft.com/en-us/microsoftteams/platform/m365-apps/combine-office-add-in-and-teams-app).
- Outlook contextual add-ins (also known as "activation rules") aren't supported. But you can provide similar experiences using the unified manifest and [Event-based](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/autolaunch) [activation](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/autolaunch).

The critical requirement for making two versions available is to be sure that the two of them appear distinct in the Outlook UI.

- Give the new version a different name from the existing add-in.
- Create and use different icons for the new version.
- Be sure that the "id" property of the unified manifest in the new version is a different GUID from the **<Id>** element in the add-in only manifest of the existing add-in.

### 7 **Note**

If you use the same name and icon, the old and new solutions appear indistinguishable in the Outlook UI for add-in installation.

### 6 **Collaborate with us on GitHub**

The source for this content can be found on GitHub, where you can also create and review issues and pull requests. For more information, see [our](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md) [contributor guide](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md).

### **Office Add-ins feedback**

Office Add-ins is an open source project. Select a link to provide feedback:

- [Open a documentation issue](https://github.com/OfficeDev/office-js-docs-pr/issues/new?template=3-customer-feedback.yml&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Foffice%2Fdev%2Fadd-ins%2Fconcepts%2Fduplicate-legacy-metaos-add-ins&pageQueryParams=&contentSourceUrl=https%3A%2F%2Fgithub.com%2FOfficeDev%2Foffice-js-docs-pr%2Fblob%2Fmain%2Fdocs%2Fconcepts%2Fduplicate-legacy-metaos-add-ins.md&documentVersionIndependentId=4a895150-a17f-9748-f11d-06661e1c4300&feedback=%0A%0A%5BEnter+feedback+here%5D%0A&author=%40o365devx&metadata=*+ID%3A+4a895150-a17f-9748-f11d-06661e1c4300+%0A*+Service%3A+**microsoft-365**%0A*+Sub-service%3A+**add-ins**)
- [Provide product feedback](https://aka.ms/office-addins-dev-questions)

# **Develop Office Add-ins**

Article • 05/19/2025

#### **Tip**

Please review **Office Add-ins platform overview** before reading this article.

All Office Add-ins are built upon the Office Add-ins platform. For any add-in you build, you'll need to understand important concepts like application and platform availability, Office JavaScript API programming patterns, how to specify an add-in's settings and capabilities in the manifest file, how to design the UI and user experience, and more. Core development concepts like these are covered here in the **Development lifecycle** > **Develop** section of the documentation. Review the information here before exploring the application-specific documentation that corresponds to the add-in you're building (for example, Excel).

## **Create an Office Add-in**

You can create an Office Add-in by using the Yeoman generator for Office Add-ins, Visual Studio, Microsoft 365 Agents Toolkit, or the Office Add-ins Development Kit.

### **Yeoman generator**

The Yeoman generator for Office Add-ins can be used to create a Node.js Office Add-in project that can be managed with Visual Studio Code or any other editor. The generator can create Office Add-ins for any of the following:

- Excel
- OneNote
- Outlook
- PowerPoint
- Project
- Word
- Excel custom functions

Create your project using HTML, CSS and JavaScript (or TypeScript), or using React. If you choose React, you can choose between JavaScript and Typescript as well. For more information about creating add-ins with the generator, see Yeoman generator for Office Add-ins.

## **Visual Studio**


Visual Studio can be used to create Office Add-ins for Excel, Outlook, Word, and PowerPoint. An Office Add-in project gets created as part of a Visual Studio solution and uses HTML, CSS, and JavaScript. For more information about creating add-ins with Visual Studio, see Develop Office Add-ins with Visual Studio.

## **Agents Toolkit**

The Agents Toolkit can be used to create almost any kind of Microsoft 365 extension. For details about creating an add-in, see Create Office Add-in projects with Microsoft 365 Agents Toolkit.

## **Office Add-ins Development Kit (preview)**

The Office Add-ins Development Kit is an extension for Visual Studio Code. It lets you create new add-in projects and load samples directly from the IDE. Download the extension from the [Visual Studio Marketplace](https://marketplace.visualstudio.com/items?itemName=msoffice.microsoft-office-add-in-debugger) or learn more in the article Create Office Add-in projects using Office Add-ins Development Kit for Visual Studio Code.

## **Understand the two parts of an Office Add-in**

An Office Add-in consists of two parts.

- The add-in manifest that defines the settings and capabilities of the add-in.
- The web application that defines the UI and functionality of add-in components such as task panes, content add-ins, and dialog boxes.

The web application uses the Office JavaScript API to interact with content in the Office document where the add-in is running. Your add-in can also do other things that web applications typically do, like call external web services, facilitate user authentication, and more.

## **Define an add-in's settings and capabilities**

An Office Add-in's manifest defines the settings and capabilities of the add-in. You'll configure the manifest to specify things such as:

- Metadata that describes the add-in (for example, ID, version, description, display name, default locale).
- Office applications where the add-in will run.
- Permissions that the add-in requires.


- How the add-in integrates with Office, including any custom UI that the add-in creates (for example, a custom tab or custom ribbon buttons).
- Location of images that the add-in uses for branding and command iconography.
- Dimensions of the add-in (for example, dimensions for content add-ins, requested height for Outlook add-ins).
- Rules that specify when the add-in activates in the context of a message or appointment (for Outlook add-ins only).
- Keyboard shortcuts (for Excel and Word add-ins only).

For detailed information about the manifest, see Office Add-ins manifest.

### **Interact with content in an Office document**

An Office Add-in can use the Office JavaScript APIs to interact with content in the Office document where the add-in is running.

#### **Access the Office JavaScript API library**

The Office JavaScript API library can be accessed via the Office JS content delivery network (CDN) at: https://appsforoffice.microsoft.com/lib/1/hosted/office.js . To use Office JavaScript APIs within any of your add-in's web pages, you must reference the CDN in a <script> tag in the <head> tag of the page.

```
HTML
<head>
 ...
 <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"
type="text/javascript"></script>
</head>
```
#### 7 **Note**

To use preview APIs, reference the preview version of the Office JavaScript API library on the CDN: https://appsforoffice.microsoft.com/lib/beta/hosted/office.js .

For more information about accessing the Office JavaScript API library, including how to get IntelliSense, see Referencing the Office JavaScript API library from its content delivery network (CDN).

#### **API models**


The Office JavaScript API includes two distinct models:

- **Application-specific** APIs provide strongly-typed objects that can be used to interact with objects that are native to a specific Office application. For example, you can use the Excel JavaScript APIs to access worksheets, ranges, tables, charts, and more. Applicationspecific APIs are currently available for the following Office applications.
	- Excel
	- OneNote
	- PowerPoint
	- Word

This API model uses [promises](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise) and allows you to specify multiple operations in each request you send to the Office application. Batching operations in this manner can significantly improve add-in performance in Office applications on the web. Applicationspecific APIs were introduced with Office 2016.

#### 7 **Note**

There's also an application-specific API for **[Visio](https://learn.microsoft.com/en-us/office/dev/add-ins/reference/overview/visio-javascript-reference-overview)**, but you can use it only in SharePoint Online pages to interact with Visio diagrams that have been embedded in the page. Office Web Add-ins are not supported in Visio.

See Using the application-specific API model to learn more about this API model.

- **Common** APIs can be used to access features such as UI, dialogs, and client settings that are common across multiple types of Office applications. This API model uses [callbacks](https://developer.mozilla.org/docs/Glossary/Callback_function) , which allow you to specify only one operation in each request sent to the Office application. Common APIs were introduced with Office 2013 and can be used to interact with any supported Office applications. For details about the Common API object model, which includes APIs for interacting with Outlook, PowerPoint, and Project, see Common JavaScript API object model.
#### 7 **Note**

Custom functions without a **shared runtime** run in a **JavaScript-only runtime** that prioritizes execution of calculations. These functions use a slightly different programming model.

### **API requirement sets**


Requirement sets are named groups of API members. Requirement sets can be specific to Office applications, such as the ExcelApi 1.7 requirement set (a set of APIs that can only be used in Excel), or common to multiple applications, such as the DialogApi 1.1 requirement set (a set of APIs that can be used in any Office application that supports the Dialog API).

Your add-in can use requirement sets to determine whether the Office application supports the API members that it needs to use. For more information about this, see Specify Office applications and API requirements.

Requirement set support varies by Office application, version, and platform. For detailed information about the platforms, requirement sets, and Common APIs that each Office application supports, see [Office client application and platform availability for Office Add-ins.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets)

#### **Explore APIs with Script Lab**

Script Lab is an add-in that enables you to explore the Office JavaScript API and run code snippets while you're working in an Office program such as Excel or Word. It's available for free via AppSource and is a useful tool to include in your development toolkit as you prototype and verify the functionality you want in your add-in. In Script Lab, you can access a library of builtin samples to quickly try out APIs or even use a sample as the starting point for your own code.

The following one-minute video shows Script Lab in action.

| F            |                                                                                                |                                        |           |                              |                                        | Book1 - Excel |         |          |                   |                                | ×<br>0<br>Michael Saunders<br>■ |           |       |        |
|--------------|------------------------------------------------------------------------------------------------|----------------------------------------|-----------|------------------------------|----------------------------------------|---------------|---------|----------|-------------------|--------------------------------|---------------------------------|-----------|-------|--------|
| File         |                                                                                                | Home                                   | Insert    | Draw                         | Page Layout                            | Formulas      | Data    | Review   | View              | Load Test                      | Script Lab                      | Q Tell me | Share | 0      |
| Script<br>A4 | Run                                                                                            | Tutorial<br>About Script Lab<br>♪<br>: | Help<br>× | Reference<br>Docs<br>fr<br>V | Ask the<br>Community<br>About the APIs |               |         |          |                   |                                |                                 |           |       | A<br>V |
| 1            | A                                                                                              | B                                      | C         |                              | D<br>E                                 |               |         |          |                   |                                |                                 |           |       | ×      |
| 2<br>3       |                                                                                                |                                        |           |                              |                                        |               |         |          | 62<br>all         | 8<br>同                         |                                 |           |       |        |
| 4<br>5       |                                                                                                |                                        |           |                              |                                        |               | Script  | Template | Style             | Libraries                      |                                 |           |       |        |
| б<br>7       |                                                                                                |                                        |           |                              |                                        |               | 1       |          |                   | Excel.run(async (context) => { |                                 |           |       |        |
| 8            |                                                                                                |                                        |           |                              |                                        |               | 3<br>4  |          | // your code here |                                |                                 |           |       |        |
| 9<br>10      | const range = context.workbook.getSelectedRange();<br>range.format.fill.color = "yellow";<br>5 |                                        |           |                              |                                        |               |         |          |                   |                                |                                 |           |       |        |
| 11<br>12     |                                                                                                |                                        |           |                              |                                        |               | 6       | });      |                   |                                |                                 |           |       |        |
| 13<br>14     |                                                                                                |                                        |           |                              |                                        |               | 8<br>ರಿ |          |                   |                                |                                 |           |       |        |
| 15           |                                                                                                |                                        |           |                              |                                        |               |         |          |                   |                                |                                 |           |       |        |

For more information about Script Lab, see Explore Office JavaScript APIs using Script Lab.


## **Extend the Office UI**

An Office Add-in can extend the Office UI by using add-in commands and HTML containers such as task panes, content add-ins, or dialog boxes.

- Add-in commands can be used to add a custom tab, custom buttons and menus to the default ribbon in Office, or to extend the default context menu that appears when users right-click (or select and hold) text in an Office document or an object in Excel. When users select an add-in command, they initiate the task that the add-in command specifies, such as running JavaScript code, opening a task pane, or launching a dialog box.
- HTML containers like task panes, content add-ins, and dialog boxes can be used to display custom UI and expose additional functionality within an Office application. The content and functionality of each task pane, content add-in, or dialog box derives from a web page that you specify. Those web pages can use the Office JavaScript API to interact with content in the Office document where the add-in is running, and can also do other things that web pages typically do, like call external web services, facilitate user authentication, and more.

The following image shows an add-in command on the ribbon, a task pane to the right of the document, and a dialog box or content add-in over the document.


For more information about extending the Office UI and designing the add-in's UX, see Office UI elements for Office Add-ins.

## **Next steps**

This article has outlined the different ways to create Office Add-ins, introduced the ways that an add-in can extend the Office UI, described the API sets, and introduced Script Lab as a valuable tool for exploring Office JavaScript APIs and prototyping add-in functionality. Now that you've explored this introductory information, consider continuing your Office Add-ins journey along the following paths.

## **Create an Office Add-in**

You can quickly create a basic add-in for Excel, OneNote, Outlook, PowerPoint, Project, or Word by completing a 5-minute quick start. If you've previously completed a quick start and want to create a slightly more complex add-in, you should try the tutorial.


#### **Learn more**

Learn more about developing, testing, and publishing Office Add-ins by exploring this documentation.

### **Tip**

For any add-in that you build, you'll use information in the **Development lifecycle** section of this documentation, along with information in the application-specific section that corresponds to the type of add-in you're building (for example, **Excel**).

## **See also**

- Office Add-ins platform overview
- [Learn about the Microsoft 365 Developer Program](https://aka.ms/m365devprogram)
- Design Office Add-ins
- Test and debug Office Add-ins
- Publish Office Add-ins

# **Office JavaScript API reference documentation**

06/13/2025

An add-in can use the Office JavaScript APIs to interact with objects in Office client applications.

- **Application-specific** APIs provide strongly-typed objects that can be used to interact with objects that are native to a specific Office application.
- **Common** APIs can be used to access features such as UI, dialogs, and client settings that are common across multiple Office applications.

You should use application-specific APIs whenever feasible, and use Common APIs only for scenarios that aren't supported by application-specific APIs. For more detailed information about these two API models, see Develop Office Add-ins.

### **API reference**

**Excel API reference** [JavaScript APIs for building Excel add-ins](https://learn.microsoft.com/en-us/javascript/api/excel)

**Outlook API reference** [JavaScript APIs for building Outlook add-ins](https://learn.microsoft.com/en-us/javascript/api/outlook)

**Word API reference** [JavaScript APIs for building Word add-ins](https://learn.microsoft.com/en-us/javascript/api/word)


**PowerPoint API reference** [JavaScript APIs for building PowerPoint add-ins](https://learn.microsoft.com/en-us/javascript/api/powerpoint)

**OneNote API reference** [JavaScript APIs for building OneNote add-ins](https://learn.microsoft.com/en-us/javascript/api/onenote)

**Common API reference** [JavaScript APIs that can be used by any Office Add-in](https://learn.microsoft.com/en-us/javascript/api/office)

**Note**: There's currently no application-specific JavaScript API for Project; you'll use Common APIs to create Project add-ins.


# **Understanding the Office JavaScript API**

Article • 05/18/2023

An Office Add-in can use the Office JavaScript APIs to interact with content in the Office document where the add-in is running.

## **Accessing the Office JavaScript API library**

The Office JavaScript API library can be accessed via the Office JS content delivery network (CDN) at: https://appsforoffice.microsoft.com/lib/1/hosted/office.js . To use Office JavaScript APIs within any of your add-in's web pages, you must reference the CDN in a <script> tag in the <head> tag of the page.

```
HTML
<head>
 ...
 <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"
type="text/javascript"></script>
</head>
```
#### 7 **Note**

To use preview APIs, reference the preview version of the Office JavaScript API library on the CDN: https://appsforoffice.microsoft.com/lib/beta/hosted/office.js .

For more information about accessing the Office JavaScript API library, including how to get IntelliSense, see Referencing the Office JavaScript API library from its content delivery network (CDN).

## **API models**

The Office JavaScript API includes two distinct models:

- **Application-specific** APIs provide strongly-typed objects that can be used to interact with objects that are native to a specific Office application. For example, you can use the Excel JavaScript APIs to access worksheets, ranges, tables, charts, and more. Application-specific APIs are currently available for the following Office applications.


- Excel
- OneNote
- PowerPoint
- Word

This API model uses [promises](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise) and allows you to specify multiple operations in each request you send to the Office application. Batching operations in this manner can significantly improve add-in performance in Office applications on the web. Application-specific APIs were introduced with Office 2016.

#### 7 **Note**

There's also an application-specific API for **[Visio](https://learn.microsoft.com/en-us/office/dev/add-ins/reference/overview/visio-javascript-reference-overview)**, but you can use it only in SharePoint Online pages to interact with Visio diagrams that have been embedded in the page. Office Web Add-ins are not supported in Visio.

See Using the application-specific API model to learn more about this API model.

- **Common** APIs can be used to access features such as UI, dialogs, and client settings that are common across multiple types of Office applications. This API model uses [callbacks](https://developer.mozilla.org/docs/Glossary/Callback_function) , which allow you to specify only one operation in each request sent to the Office application. Common APIs were introduced with Office 2013 and can be used to interact with any supported Office applications. For details about the Common API object model, which includes APIs for interacting with Outlook, PowerPoint, and Project, see Common JavaScript API object model.
#### 7 **Note**

Custom functions without a **shared runtime** run in a **JavaScript-only runtime** that prioritizes execution of calculations. These functions use a slightly different programming model.

### **API requirement sets**

Requirement sets are named groups of API members. Requirement sets can be specific to Office applications, such as the ExcelApi 1.7 requirement set (a set of APIs that can only be used in Excel), or common to multiple applications, such as the DialogApi 1.1 requirement set (a set of APIs that can be used in any Office application that supports the Dialog API).


Your add-in can use requirement sets to determine whether the Office application supports the API members that it needs to use. For more information about this, see Specify Office applications and API requirements.

Requirement set support varies by Office application, version, and platform. For detailed information about the platforms, requirement sets, and Common APIs that each Office [application supports, see Office client application and platform availability for Office](https://learn.microsoft.com/en-us/javascript/api/requirement-sets) Add-ins.

#### 7 **Note**

If you plan to **publish** your add-in to AppSource and make it available within the Office experience, make sure that you conform to the **Commercial marketplace certification policies**. For example, to pass validation, your add-in must work across all platforms that support the methods that you define (for more information, see **section 1120.3** and the **[Office Add-in application and availability page](https://learn.microsoft.com/en-us/javascript/api/requirement-sets)**).

### **See also**

- Office JavaScript API reference
- Loading the DOM and runtime environment
- Referencing the Office JavaScript API library
- Initialize your Office Add-in
- Runtimes in Office Add-ins


# **Application-specific API model**

Article • 02/12/2025

This article describes how to use the API model for building add-ins in Excel, OneNote, PowerPoint, Visio, and Word. It introduces core concepts that are fundamental to using the promise-based APIs.

#### 7 **Note**

This model isn't supported by Outlook or Project clients. Use the **Common API model** to work with those applications. For full platform availability notes, see **[Office client application and platform availability for Office Add-ins](https://learn.microsoft.com/en-us/javascript/api/requirement-sets)**.

#### **Tip**

The examples in this page use the Excel JavaScript APIs, but the concepts also apply to OneNote, PowerPoint, Visio, and Word JavaScript APIs. For complete code samples that show how you could use these and other concepts in various Office applications, see **Office Add-in code samples**.

## **Asynchronous nature of the promise-based APIs**

Office Add-ins are websites which appear inside a webview control within Office applications, such as Excel. This control is embedded within the Office application on desktop-based platforms, such as Office on Windows, and runs inside an HTML iframe in Office on the web. Due to performance considerations, the Office.js APIs cannot interact synchronously with the Office applications across all platforms. Therefore, the sync() API call in Office.js returns a [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise) that is resolved when the Office application completes the requested read or write actions. Also, you can queue up multiple actions, such as setting properties or invoking methods, and run them as a batch of commands with a single call to sync() , rather than sending a separate request for each action. The following sections describe how to accomplish this using the run() and sync() APIs.

## ***.run function**


Excel.run , OneNote.run , PowerPoint.run , and Word.run execute a function that specifies the actions to perform against Excel, Word, and OneNote. *.run automatically creates a request context that you can use to interact with Office objects. When *.run completes, a promise is resolved, and any objects that were allocated at runtime are automatically released.

The following example shows how to use Excel.run . The same pattern is also used with OneNote, PowerPoint, Visio, and Word.

```
JavaScript
Excel.run(function (context) {
 // Add your Excel JS API calls here that will be batched and sent to the
workbook.
 console.log('Your code goes here.');
}).catch(function (error) {
 // Catch and log any errors that occur within `Excel.run`.
 console.log('error: ' + error);
 if (error instanceof OfficeExtension.Error) {
 console.log('Debug info: ' + JSON.stringify(error.debugInfo));
 }
});
```
## **Request context**

The Office application and your add-in run in different processes. Since they use different runtime environments, add-ins require a RequestContext object in order to connect your add-in to objects in Office such as worksheets, ranges, paragraphs, and tables. This RequestContext object is provided as an argument when calling *.run .

# **Proxy objects**

The Office JavaScript objects that you declare and use with the promise-based APIs are proxy objects. Any methods that you invoke or properties that you set or load on proxy objects are simply added to a queue of pending commands. When you call the sync() method on the request context (for example, context.sync() ), the queued commands are dispatched to the Office application and run. These APIs are fundamentally batchcentric. You can queue up as many changes as you wish on the request context, and then call the sync() method to run the batch of queued commands.

For example, the following code snippet declares the local JavaScript [Excel.Range](https://learn.microsoft.com/en-us/javascript/api/excel/excel.range) object, selectedRange , to reference a selected range in the Excel workbook, and then sets some


properties on that object. The selectedRange object is a proxy object, so the properties that are set and the method that is invoked on that object will not be reflected in the Excel document until your add-in calls context.sync() .

JavaScript

```
const selectedRange = context.workbook.getSelectedRange();
selectedRange.format.fill.color = "#4472C4";
selectedRange.format.font.color = "white";
selectedRange.format.autofitColumns();
```
### **Performance tip: Minimize the number of proxy objects created**

Avoid repeatedly creating the same proxy object. Instead, if you need the same proxy object for more than one operation, create it once and assign it to a variable, then use that variable in your code.

JavaScript

```
// BAD: Repeated calls to .getRange() to create the same proxy object.
worksheet.getRange("A1").format.fill.color = "red";
worksheet.getRange("A1").numberFormat = "0.00%";
worksheet.getRange("A1").values = [[1]];
// GOOD: Create the range proxy object once and assign to a variable.
const range = worksheet.getRange("A1");
range.format.fill.color = "red";
range.numberFormat = "0.00%";
range.values = [[1]];
// ALSO GOOD: Use a "set" method to immediately set all the properties
// without even needing to create a variable!
worksheet.getRange("A1").set({
 numberFormat: [["0.00%"]],
 values: [[1]],
 format: {
 fill: {
 color: "red"
 }
 }
});
```
**sync()**


Calling the sync() method on the request context synchronizes the state between proxy objects and objects in the Office document. The sync() method runs any commands that are queued on the request context and retrieves values for any properties that should be loaded on the proxy objects. The sync() method executes asynchronously and returns a [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise) , which is resolved when the sync() method completes.

The following example shows a batch function that defines a local JavaScript proxy object ( selectedRange ), loads a property of that object, and then uses the JavaScript promises pattern to call context.sync() to synchronize the state between proxy objects and objects in the Excel document.

```
JavaScript
await Excel.run(async (context) => {
 const selectedRange = context.workbook.getSelectedRange();
 selectedRange.load('address');
 await context.sync();
 console.log('The selected range is: ' + selectedRange.address);
});
```
In the previous example, selectedRange is set and its address property is loaded when context.sync() is called.

Since sync() is an asynchronous operation, you should always return the Promise object to ensure the sync() operation completes before the script continues to run. If you're using TypeScript or ES6+ JavaScript, you can await the context.sync() call instead of returning the promise.

#### **Performance tip: Minimize the number of sync calls**

In the Excel JavaScript API, sync() is the only asynchronous operation, and it can be slow under some circumstances, especially for Excel on the web. To optimize performance, minimize the number of calls to sync() by queueing up as many changes as possible before calling it. For more information about optimizing performance with sync() , see Avoid using the context.sync method in loops.

### **load()**

Before you can read the properties of a proxy object, you must explicitly load the properties to populate the proxy object with data from the Office document, and then call context.sync() . For example, if you create a proxy object to reference a selected range, and then want to read the selected range's address property, you need to load 


the address property before you can read it. To request properties of a proxy object be loaded, call the load() method on the object and specify the properties to load. The following example shows the Range.address property being loaded for myRange .

#### JavaScript

```
await Excel.run(async (context) => {
 const sheetName = 'Sheet1';
 const rangeAddress = 'A1:B2';
 const myRange =
context.workbook.worksheets.getItem(sheetName).getRange(rangeAddress);
 myRange.load('address');
 await context.sync();

 console.log (myRange.address); // ok
 //console.log (myRange.values); // not ok as it was not loaded
 console.log('done');
});
```
#### 7 **Note**

If you're only calling methods or setting properties on a proxy object, you don't need to call the load() method. The load() method is only required when you want to read properties on a proxy object.

Just like requests to set properties or invoke methods on proxy objects, requests to load properties on proxy objects get added to the queue of pending commands on the request context, which will run the next time you call the sync() method. You can queue up as many load() calls on the request context as necessary.

#### **Scalar and navigation properties**

There are two categories of properties: **scalar** and **navigational**. Scalar properties are assignable types such as strings, integers, and JSON structs. Navigation properties are read-only objects and collections of objects that have their fields assigned, instead of directly assigning the property. For example, name and position members on the [Excel.Worksheet](https://learn.microsoft.com/en-us/javascript/api/excel/excel.worksheet) object are scalar properties, whereas protection and tables are navigation properties.

Your add-in can use navigational properties as a path to load specific scalar properties. The following code queues up a load command for the name of the font used by an


Excel.Range object, without loading any other information.

You can also set the scalar properties of a navigation property by traversing the path. For example, you could set the font size for an Excel.Range by using someRange.format.font.size = 10; . You don't need to load the property before you set it.

Please be aware that some of the properties under an object may have the same name as another object. For example, format is a property under the Excel.Range object, but format itself is an object as well. So, if you make a call such as range.load("format") , this is equivalent to range.format.load() (an undesirable empty load() statement). To avoid this, your code should only load the "leaf nodes" in an object tree.

### **Load from a collection**

When working with a collection, use load on the collection to load properties for every object in the collection. Use load exactly as you would for an individual object in that collection.

The following sample code shows the name property being loaded and logged for every chart in the "Sample" worksheet.

```
JavaScript
await Excel.run(async (context) => {
 const sheet = context.workbook.worksheets.getItem("Sample");
 const chartCollection = sheet.charts;
 // Load the name property on every chart in the chart collection.
 chartCollection.load("name");
 await context.sync();
 chartCollection.items.forEach((chart) => {
 console.log(chart.name);
 });
});
```
You normally don't include the items property of the collection in the load arguments. All the items are loaded if you load any item properties. However, if you will be looping 


over the items in the collection, but don't need to load any particular property of the items, you need to load the items property.

The following sample code shows the name property being set for every chart in the "Sample" worksheet.

```
JavaScript
await Excel.run(async (context) => {
 const sheet = context.workbook.worksheets.getItem("Sample");
 const chartCollection = sheet.charts;
 // Load the items property from the chart collection to set properties
on individual charts.
 chartCollection.load("items");
 await context.sync();
 chartCollection.items.forEach((chart, index) => {
 chart.name = `Sample chart ${index}`;
 });
});
```
#### **Calling load without parameters (not recommended)**

If you call the load() method on an object (or collection) without specifying any parameters, all scalar properties of the object or the collection's objects will be loaded. Loading unneeded data will slow down your add-in. You should always explicitly specify which properties to load.

#### ) **Important**

The amount of data returned by a parameter-less load statement can exceed the size limits of the service. To reduce the risks to older add-ins, some properties are not returned by load without explicitly requesting them. The following properties are excluded from such load operations.

- Excel.Range.numberFormatCategories
### **ClientResult**

Methods in the promise-based APIs that return primitive types have a similar pattern to the load / sync paradigm. As an example, Excel.TableCollection.getCount gets the number of tables in the collection. getCount returns a ClientResult<number> , meaning


the value property in the returned [ClientResult](https://learn.microsoft.com/en-us/javascript/api/office/officeextension.clientresult) is a number. Your script can't access that value until context.sync() is called.

The following code gets the total number of tables in an Excel workbook and logs that number to the console.

```
JavaScript
const tableCount = context.workbook.tables.getCount();
// This sync call implicitly loads tableCount.value.
// Any other ClientResult values are loaded too.
await context.sync();
// Trying to log the value before calling sync would throw an error.
console.log (tableCount.value);
```
### **set()**

JavaScript

Setting properties on an object with nested navigation properties can be cumbersome. As an alternative to setting individual properties using navigation paths as described above, you can use the object.set() method that is available on objects in the promise-based JavaScript APIs. With this method, you can set multiple properties of an object at once by passing either another object of the same Office.js type or a JavaScript object with properties that are structured like the properties of the object on which the method is called.

The following code sample sets several format properties of a range by calling the set() method and passing in a JavaScript object with property names and types that mirror the structure of properties in the Range object. This example assumes that there is data in range **B2:E2**.

```
await Excel.run(async (context) => {
 const sheet = context.workbook.worksheets.getItem("Sample");
 const range = sheet.getRange("B2:E2");
 range.set({
 format: {
 fill: {
 color: '#4472C4'
 },
 font: {
 name: 'Verdana',
 color: 'white'
 }
```


```
 }
 });
 range.format.autofitColumns();
 await context.sync();
});
```
### **Some properties cannot be set directly**

Some properties cannot be set, despite being writable. These properties are part of a parent property that must be set as a single object. This is because that parent property relies on the subproperties having specific, logical relationships. These parent properties must be set using object literal notation to set the entire object, instead of setting that object's individual subproperties. One example of this is found in [PageLayout.](https://learn.microsoft.com/en-us/javascript/api/excel/excel.pagelayout) The zoom property must be set with a single [PageLayoutZoomOptions](https://learn.microsoft.com/en-us/javascript/api/excel/excel.pagelayoutzoomoptions) object, as shown here.

JavaScript

```
// PageLayout.zoom.scale must be set by assigning PageLayout.zoom to a
PageLayoutZoomOptions object.
sheet.pageLayout.zoom = { scale: 200 };
```
In the previous example, you would *not* be able to directly assign zoom a value: sheet.pageLayout.zoom.scale = 200; . That statement throws an error because zoom is not loaded. Even if zoom were to be loaded, the set of scale will not take effect. All context operations happen on zoom , refreshing the proxy object in the add-in and overwriting locally set values.

This behavior differs from navigational properties like [Range.format.](https://learn.microsoft.com/en-us/javascript/api/excel/excel.range#excel-excel-range-format-member) Properties of format can be set using object navigation, as shown here.

JavaScript

```
// This will set the font size on the range during the next
`content.sync()`.
range.format.font.size = 10;
```
You can identify a property that cannot have its subproperties directly set by checking its read-only modifier. All read-only properties can have their non-read-only subproperties directly set. Writeable properties like PageLayout.zoom must be set with an object at that level. In summary:

- Read-only property: Subproperties can be set through navigation.


- Writable property: Subproperties cannot be set through navigation (must be set as part of the initial parent object assignment).
## ***OrNullObject methods and properties**

Some accessor methods and properties throw an exception when the desired object doesn't exist. For example, if you attempt to get an Excel worksheet by specifying a worksheet name that isn't in the workbook, the getItem() method throws an ItemNotFound exception. The application-specific libraries provide a way for your code to test for the existence of document entities without requiring exception handling code. This is accomplished by using the *OrNullObject variations of methods and properties. These variations return an object whose isNullObject property is set to true , if the specified item doesn't exist, rather than throwing an exception.

For example, you can call the getItemOrNullObject() method on a collection such as **Worksheets** to retrieve an item from the collection. The getItemOrNullObject() method returns the specified item if it exists; otherwise, it returns an object whose isNullObject property is set to true . Your code can then evaluate this property to determine whether the object exists.

#### 7 **Note**

The *OrNullObject variations do not ever return the JavaScript value null . They return ordinary Office proxy objects. If the the entity that the object represents does not exist then the isNullObject property of the object is set to true . Do not test the returned object for nullity or falsity. It is never null , false , or undefined .

The following code sample attempts to retrieve an Excel worksheet named "Data" by using the getItemOrNullObject() method. If a worksheet with that name does not exist, a new sheet is created. Note that the code does not load the isNullObject property. Office automatically loads this property when context.sync is called, so you do not need to explicitly load it with something like dataSheet.load('isNullObject') .

#### JavaScript

```
await Excel.run(async (context) => {
 let dataSheet = context.workbook.worksheets.getItemOrNullObject("Data");

 await context.sync();

 if (dataSheet.isNullObject) {
```


```
 dataSheet = context.workbook.worksheets.add("Data");
 }

 // Set `dataSheet` to be the second worksheet in the workbook.
 dataSheet.position = 1;
});
```
## **Undo support**

Undo is partially supported by the application-specific Office JavaScript APIs. This means that users may be able to revert changes made by add-ins through the undo command. If a particular API doesn't support undo, the application's undo stack is cleared. This means that you won't be able to undo the effects of that API or anything prior to calling that API.

API support for undo is continuing to expand but is currently incomplete. We advise against designing your add-in in such a way that it relies on undo support.

### **See also**

- Common JavaScript API object model
- Resource limits and performance optimization for Office Add-ins


# **Common JavaScript API object model**

Article • 03/21/2023

#### ) **Important**

This article applies to the **Common APIs**, the Office JavaScript API model that was introduced with Office 2013. These APIs include features such as UI, dialogs, and client settings that are common across multiple types of Office applications. Outlook add-ins exclusively use Common APIs, especially the subset of APIs exposed through the **[Mailbox](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox)** object.

You should only use Common APIs for scenarios that aren't supported by **application-specific APIs**. To learn when to use Common APIs instead of application-specific APIs, see **Understanding the Office JavaScript API**.

Office JavaScript APIs give access to the Office client application's underlying functionality. Most of this access goes through a few important objects. The Context object gives access to the runtime environment after initialization. The Document object gives the user control over an Excel, PowerPoint, or Word document. The Mailbox object gives an Outlook add-in access to messages, appointments, and user profiles. Understanding the relationships between these high-level objects is the foundation of an Office Add-in.

### **Context object**

**Applies to:** All add-in types

When an add-in is initialized, it has many different objects that it can interact with in the runtime environment. The add-in's runtime context is reflected in the API by the [Context](https://learn.microsoft.com/en-us/javascript/api/office/office.context) object. The **Context** is the main object that provides access to the most important objects of the API, such as the [Document](https://learn.microsoft.com/en-us/javascript/api/office/office.document) and [Mailbox](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox) objects, which in turn provide access to document and mailbox content.

For example, in task pane or content add-ins, you can use the [document](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-document-member) property of the **Context** object to access the properties and methods of the **Document** object to interact with the content of Word documents, Excel worksheets, or Project schedules. Similarly, in Outlook add-ins, you can use the [mailbox](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-mailbox-member) property of the **Context** object to access the properties and methods of the **Mailbox** object to interact with the message, meeting request, or appointment content.


The **Context** object also provides access to the [contentLanguage](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-contentlanguage-member) and [displayLanguage](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-displaylanguage-member) properties that let you determine the locale (language) used in the document or item, or by the Office application. The [roamingSettings](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-roamingsettings-member) property lets you access the members of the [RoamingSettings](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-roamingsettings-member) object, which stores settings specific to your add-in for individual users' mailboxes. Finally, the **Context** object provides a [ui](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-ui-member) property that enables your add-in to launch pop-up dialogs.

### **Document object**

**Applies to:** Content and task pane add-in types

To interact with document data in Excel, PowerPoint, and Word, the API provides the [Document](https://learn.microsoft.com/en-us/javascript/api/office/office.document) object. You can use Document object members to access data from the following ways.

- Read and write to active selections in the form of text, contiguous cells (matrices), or tables.
- Tabular data (matrices or tables).
- Bindings (created with the "add" methods of the Bindings object).
- Custom XML parts (only for Word).
- Settings or add-in state persisted per add-in on the document.

You can also use the Document object to interact with data in Project documents. The Project-specific functionality of the API is documented in the members [ProjectDocument](https://learn.microsoft.com/en-us/javascript/api/office/office.document) abstract class. For more information about creating task pane add-ins for Project, see Task pane add-ins for Project.

All these forms of data access start from an instance of the abstract Document object.

You can access an instance of the Document object when the task pane or content add-in is initialized by using the [document](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-document-member) property of the Context object. The Document object defines common data access methods shared across Word and Excel documents, and also provides access to the CustomXmlParts object for Word documents.

The Document object supports four ways for developers to access document contents.

- Selection-based access
- Binding-based access


- Custom XML part-based access (Word only)
- Entire document-based access (PowerPoint and Word only)

To help you understand how selection- and binding-based data access methods work, we will first explain how the data-access APIs provide consistent data access across different Office applications.

### **Consistent data access across Office applications**

**Applies to:** Content and task pane add-in types

To create extensions that seamlessly work across different Office documents, the Office JavaScript API abstracts away the particularities of each Office application through common data types and the ability to coerce different document contents into three common data types.

#### **Common data types**

In both selection-based and binding-based data access, document contents are exposed through data types that are common across all the supported Office applications. Three main data types are supported.

| ノ | Expand table |  |
|---|--------------|--|
|   |              |  |

| Data<br>type | Description                                                                                                                                                                     | Host application support                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Text         | Provides a string representation of<br>the data in the selection or<br>binding.                                                                                                 | In Excel, Project, and PowerPoint, only plain text is<br>supported. In Word, three text formats are<br>supported: plain text, HTML, and Office Open XML<br>(OOXML). When text is selected in a cell in Excel,<br>selection-based methods read and write to the<br>entire contents of the cell, even if only a portion of<br>the text is selected in the cell. When text is<br>selected in Word and PowerPoint, selection-based<br>methods read and write only to the run of<br>characters that are selected. Project and<br>PowerPoint support only selection-based data<br>access. |
| Matrix       | Provides the data in the selection<br>or binding as a two dimensional<br>Array, which in JavaScript is<br>implemented as an array of arrays.<br>For example, two rows of string | Matrix data access is supported only in Excel and<br>Word.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |


| Data<br>type | Description                                                                                                                                                     | Host application support                                  |
|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------|
|              | values in two columns would be<br>[['a', 'b'], ['c', 'd']] , and a<br>single column of three rows would<br>be [['a'],<br>['b'], ['c']] .                        |                                                           |
| Table        | Provides the data in the selection<br>or binding as a TableData object.<br>The TableData object exposes the<br>data through the headers and<br>rows properties. | Table data access is supported only in Excel and<br>Word. |

#### **Data type coercion**

The data access methods on the Document and [Binding](https://learn.microsoft.com/en-us/javascript/api/office/office.binding) objects support specifying the desired data type using the *coercionType* parameter of these methods, and corresponding [CoercionType](https://learn.microsoft.com/en-us/javascript/api/office/office.coerciontype) enumeration values. Regardless of the actual shape of the binding, the different Office applications support the common data types by trying to coerce the data into the requested data type. For example, if a Word table or paragraph is selected, the developer can specify to read it as plain text, HTML, Office Open XML, or a table, and the API implementation handles the necessary transformations and data conversions.

#### **Tip**

**When should you use the matrix versus table coercionType for data access?** If you need your tabular data to grow dynamically when rows and columns are added, and you must work with table headers, you should use the table data type (by specifying the *coercionType* parameter of a Document or Binding object data access method as "table" or Office.CoercionType.Table ). Adding rows and columns within the data structure is supported in both table and matrix data, but appending rows and columns is supported only for table data. If you aren't planning on adding rows and columns, and your data doesn't require header functionality, then you should use the matrix data type (by specifying the *coercionType* parameter of the data access method as "matrix" or Office.CoercionType.Matrix ), which provides a simpler model of interacting with the data.

If the data can't be coerced to the specified type, the [AsyncResult.status](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult#office-office-asyncresult-status-member) property in the callback returns "failed" , and you can use the [AsyncResult.error](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult#office-office-asyncresult-error-member) property to access an


# **Work with selections using the Document object**

The Document object exposes methods that let you to read and write to the user's current selection in a "get and set" fashion. To do that, the Document object provides the getSelectedDataAsync and setSelectedDataAsync methods.

For code examples that demonstrate how to perform tasks with selections, see Read and write data to the active selection in a document or spreadsheet.

# **Work with bindings using the Bindings and Binding objects**

Binding-based data access enables content and task pane add-ins to consistently access a particular region of a document or spreadsheet through an identifier associated with a binding. The add-in first needs to establish the binding by calling one of the methods that associates a portion of the document with a unique identifier: [addFromPromptAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#office-office-bindings-addfrompromptasync-member(1)), [addFromSelectionAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#office-office-bindings-addfromselectionasync-member(1)), or [addFromNamedItemAsync.](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#office-office-bindings-addfromnameditemasync-member(1)) After the binding is established, the add-in can use the provided identifier to access the data contained in the associated region of the document or spreadsheet. Creating bindings provides the following value to your add-in.

- Permits access to common data structures across supported Office applications, such as: tables, ranges, or text (a contiguous run of characters).
- Enables read/write operations without requiring the user to make a selection.
- Establishes a relationship between the add-in and the data in the document. Bindings are persisted in the document, and can be accessed at a later time.

Establishing a binding also allows you to subscribe to data and selection change events that are scoped to that particular region of the document or spreadsheet. This means that the add-in is only notified of changes that happen within the bound region as opposed to general changes across the whole document or spreadsheet.

The [Bindings](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings) object exposes a [getAllAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#office-office-bindings-getallasync-member(1)) method that gives access to the set of all bindings established on the document or spreadsheet. An individual binding can be accessed by its ID using either the [Bindings.getBindingByIdAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#office-office-bindings-getbyidasync-member(1)) method or [Office.select](https://learn.microsoft.com/en-us/javascript/api/office) function. You can establish new bindings as well as remove existing ones by 


using one of the following methods of the Bindings object: [addFromSelectionAsync,](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#office-office-bindings-addfromselectionasync-member(1)) [addFromPromptAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#office-office-bindings-addfrompromptasync-member(1)), [addFromNamedItemAsync,](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#office-office-bindings-addfromnameditemasync-member(1)) or [releaseByIdAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#office-office-bindings-releasebyidasync-member(1)).

There are three different types of bindings that you specify with the *bindingType* parameter when you create a binding with the addFromSelectionAsync , addFromPromptAsync or addFromNamedItemAsync methods.

#### ノ **Expand table**

| Binding<br>type   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                      | Host application support                                                                                                                                                                                                                                                     |
|-------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Text<br>binding   | Binds to a region of the document that can be<br>represented as text.                                                                                                                                                                                                                                                                                                                                                                            | In Word, most contiguous<br>selections are valid, while in Excel<br>only single cell selections can be<br>the target of a text binding. In<br>Excel, only plain text is supported.<br>In Word, three formats are<br>supported: plain text, HTML, and<br>Open XML for Office. |
| Matrix<br>binding | Binds to a fixed region of a document that<br>contains tabular data without headers. Data in a<br>matrix binding is written or read as a two<br>dimensional Array, which in JavaScript is<br>implemented as an array of arrays. For example,<br>two rows of string values in two columns can be<br>written or read as [['a',<br>'b'], ['c', 'd']] , and<br>a single column of three rows can be written or<br>read as [['a'],<br>['b'], ['c']] . | In Excel, any contiguous selection<br>of cells can be used to establish a<br>matrix binding. In Word, only<br>tables support matrix binding.                                                                                                                                 |
| Table<br>binding  | Binds to a region of a document that contains a<br>table with headers. Data in a table binding is<br>written or read as a TableData object. The<br>TableData object exposes the data through the<br>headers and rows properties.                                                                                                                                                                                                                 | Any Excel or Word table can be<br>the basis for a table binding. After<br>you establish a table binding, each<br>new row or column a user adds to<br>the table is automatically included<br>in the binding.                                                                  |

After a binding is created by using one of the three "add" methods of the Bindings object, you can work with the binding's data and properties by using the methods of the corresponding object: [MatrixBinding](https://learn.microsoft.com/en-us/javascript/api/office/office.matrixbinding), [TableBinding](https://learn.microsoft.com/en-us/javascript/api/office/office.tablebinding), or [TextBinding](https://learn.microsoft.com/en-us/javascript/api/office/office.textbinding). All three of these objects inherit the [getDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#office-office-binding-getdataasync-member(1)) and [setDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#office-office-binding-setdataasync-member(1)) methods of the Binding object that enable to you interact with the bound data.

For code examples that demonstrate how to perform tasks with bindings, see Bind to regions in a document or spreadsheet.


## **Work with custom XML parts using the CustomXmlParts and CustomXmlPart objects**

**Applies to:** Task pane add-ins for Word

The [CustomXmlParts](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlparts) and [CustomXmlPart](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlpart) objects of the API provide access to custom XML parts in Word documents, which enable XML-driven manipulation of the contents of the document. For demonstrations of working with the CustomXmlParts and CustomXmlPart objects, see the [Word-add-in-Work-with-custom-XML-parts](https://github.com/OfficeDev/Word-Add-in-Work-with-custom-XML-parts) code sample.

## **Work with the entire document using the getFileAsync method**

**Applies to:** Task pane add-ins for Word and PowerPoint

The [Document.getFileAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.document#office-office-document-getfileasync-member(1)) method and members of the [File](https://learn.microsoft.com/en-us/javascript/api/office/office.file) and [Slice](https://learn.microsoft.com/en-us/javascript/api/office/office.slice) objects to provide functionality for getting entire Word and PowerPoint document files in slices (chunks) of up to 4 MB at a time. For more information, see [Get the whole document](https://learn.microsoft.com/en-us/office/dev/add-ins/word/get-the-whole-document-from-an-add-in-for-word) [from an add-in for PowerPoint or Word](https://learn.microsoft.com/en-us/office/dev/add-ins/word/get-the-whole-document-from-an-add-in-for-word).

# **Mailbox object**

### **Applies to:** Outlook add-ins

Outlook add-ins primarily use a subset of the API exposed through the [Mailbox](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox) object. To access the objects and members specifically for use in Outlook add-ins, such as the [Item](https://learn.microsoft.com/en-us/javascript/api/outlook/office.item) object, use the [mailbox](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-mailbox-member) property of the **Context** object to access the **Mailbox** object, as shown in the following line of code.

```
JavaScript
```

```
// Access the Item object.
const item = Office.context.mailbox.item;
```
Additionally, Outlook add-ins can use the following objects.

- **Office** object: for initialization.
- **Context** object: for access to content and display language properties.


- **RoamingSettings** object: for saving Outlook add-in-specific custom settings to the user's mailbox where the add-in is installed.
For information about using JavaScript in Outlook add-ins, see Outlook add-ins.

#### 6 **Collaborate with us on GitHub**

The source for this content can be found on GitHub, where you can also create and review issues and pull requests. For more information, see [our](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md) [contributor guide](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md).

#### **Office Add-ins feedback**

Office Add-ins is an open source project. Select a link to provide feedback:

- [Open a documentation issue](https://github.com/OfficeDev/office-js-docs-pr/issues/new?template=3-customer-feedback.yml&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Foffice%2Fdev%2Fadd-ins%2Fdevelop%2Foffice-javascript-api-object-model&pageQueryParams=&contentSourceUrl=https%3A%2F%2Fgithub.com%2FOfficeDev%2Foffice-js-docs-pr%2Fblob%2Fmain%2Fdocs%2Fdevelop%2Foffice-javascript-api-object-model.md&documentVersionIndependentId=3054e7c5-d5eb-a22e-141d-b5edaa4bfcf1&feedback=%0A%0A%5BEnter+feedback+here%5D%0A&author=%40o365devx&metadata=*+ID%3A+f33e44c8-bb7e-0f63-5dc7-ba05fc122afd+%0A*+Service%3A+**microsoft-365**%0A*+Sub-service%3A+**add-ins**)
- [Provide product feedback](https://aka.ms/office-addins-dev-questions)


# **Asynchronous programming in Office Add-ins**

Article • 12/31/2024

#### ) **Important**

This article applies to the **Common APIs**, the Office JavaScript API model that was introduced with Office 2013. These APIs include features such as UI, dialogs, and client settings that are common across multiple types of Office applications. Outlook add-ins exclusively use Common APIs, especially the subset of APIs exposed through the **[Mailbox](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox)** object.

You should only use Common APIs for scenarios that aren't supported by **application-specific APIs**. To learn when to use Common APIs instead of application-specific APIs, see **Understanding the Office JavaScript API**.

Why does the Office Add-ins API use asynchronous programming? JavaScript is a single-threaded language. If a script invokes a long-running synchronous process of the Office client, all subsequent scripts are blocked until that process completes. Being asynchronous makes sure that Office Add-ins are responsive and fast.

The names of all asynchronous methods in the Common APIs end with "Async", such as the Document.getSelectedDataAsync , Binding.getDataAsync , or

Item.loadCustomPropertiesAsync methods. When an "Async" method is called, it runs immediately. The rest of the script continues while the operation completes on the client-side. The optional callback function that you pass to an "Async" method runs as soon as the data or requested operation is ready. This generally occurs promptly, but there can be a slight delay.

The following diagram shows the flow of an "Async" method that reads the data the user selected in a document. When the "Async" call is made, the JavaScript thread is free to perform any additional client-side processing (although none is shown in the diagram). When the "Async" method returns, the callback resumes on the thread. The add-in can then access data, do something with it, and display the result. The pattern is the same across platforms.


## **Write the callback function for an "Async" method**

The callback function you pass as the *callback* argument to an "Async" method must declare a single parameter. The add-in runtime uses that parameter to provide access to an [AsyncResult](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult) object for the callback function.

The callback function can either be an anonymous function or a named function. An anonymous function is useful if you are only going to use its code once - because it has no name, you can't reference it in another part of your code. A named function is useful if you want to reuse the callback function for more than one "Async" method.

### **Write an anonymous callback function**

The following anonymous callback function declares a single parameter named result for the data returned by the client. It retrieves and writes that data from the [AsyncResult.value](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult#office-office-asyncresult-value-member) property when the callback returns.

```
JavaScript
function (result) {
 write('Selected data: ' + result.value);
}
```


The following example shows this anonymous callback function in the context of a full "Async" method call to the Document.getSelectedDataAsync(coercionType, callback) method.

- The first *coercionType* argument, Office.CoercionType.Text , specifies to return the selected data as a string of text.
- The second *callback* argument is the anonymous function passed inline to the method. When the function runs, it uses the *result* parameter to access the value property of the AsyncResult object. It then displays the data selected by the user in the document.

```
JavaScript
Office.context.document.getSelectedDataAsync(Office.CoercionType.Text, 
 function (result) {
 write('Selected data: ' + result.value);
 }
});
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message; 
}
```
You can also use the parameter of your callback function to access other properties of the AsyncResult object. Use the [AsyncResult.status](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult#office-office-asyncresult-status-member) property to determine if the call succeeded or failed. If your call failed, use the [AsyncResult.error](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult#office-office-asyncresult-error-member) property to access an [Error](https://learn.microsoft.com/en-us/javascript/api/office/office.error) object to help decide what to do.

For more information on the getSelectedDataAsync method, see Read and write data to the active selection in a document or spreadsheet.

### **Write a named callback function**

Alternatively, you can write a named function and pass its name to the *callback* parameter of an "Async" method. Here, the previous example is rewritten to pass a function named writeDataCallback as the *callback* parameter.

```
JavaScript
Office.context.document.getSelectedDataAsync(Office.CoercionType.Text, 
 writeDataCallback);
// Callback to write the selected data to the add-in UI.
```


```
function writeDataCallback(result) {
 write('Selected data: ' + result.value);
}
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message;
}
```
## **Differences in what's returned to the AsyncResult.value property**

The asyncContext , status , and error properties of the AsyncResult object return the same kinds of information to the callback functions passed to all "Async" methods. However, what's returned to the AsyncResult.value property varies depending on the functionality of the "Async" method.

For example, the addHandlerAsync methods (of the [Binding,](https://learn.microsoft.com/en-us/javascript/api/office/office.binding) [CustomXmlPart,](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlpart) [Document](https://learn.microsoft.com/en-us/javascript/api/office/office.document), [RoamingSettings,](https://learn.microsoft.com/en-us/javascript/api/outlook/office.roamingsettings) and [Settings](https://learn.microsoft.com/en-us/javascript/api/office/office.settings) objects) are used to add event handler functions. The AsyncResult.value property in those callback functions always returns **undefined**, since no data or object is accessed when you add an event handler.

On the other hand, if you call the Document.getSelectedDataAsync method, it returns the data the user selected in the document as the AsyncResult.value property in the callback. Or, if you call the [Bindings.getAllAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#office-office-bindings-getallasync-member(1)) method, it returns an array of all of the Binding objects in the document.

For a description of what's returned to the AsyncResult.value property for an Async method, see the **callback** section of that method's reference topic.

### **Asynchronous programming patterns**

The Common APIs in the Office JavaScript API support two kinds of asynchronous programming patterns.

- Nested callbacks
- Promises

#### 7 **Note**

In the current version of the Office JavaScript API, *built-in* support for the promises pattern only works with code for **bindings in Excel spreadsheets and Word**


**documents**. However, you can wrap other functions that have callbacks inside your own custom Promise -returning function. For more information, see **Wrap Common APIs in Promise-returning functions**.

### **Asynchronous programming using nested callback functions**

Frequently, you need to perform two or more asynchronous operations to complete a task. To accomplish that, you can nest one "Async" call inside another.

The following code example nests two asynchronous calls.

- First, the [Bindings.getByIdAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#office-office-bindings-getbyidasync-member(1)) method is called to access a binding in the document named "MyBinding". The AsyncResult object returned to the result parameter of that callback provides access to the specified binding object from the AsyncResult.value property.
- Then, the binding object accessed from the first result parameter is used to call the [Binding.getDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#office-office-binding-getdataasync-member(1)) method.
- Finally, the result2 parameter of the callback passed to the Binding.getDataAsync method is used to display the data in the binding.

```
JavaScript
function readData() {
 Office.context.document.bindings.getByIdAsync("MyBinding", function
(result) {
 result.value.getDataAsync({ coercionType: 'text' }, function
(result2) {
 write(result2.value);
 });
 });
}
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message; 
}
```
This basic nested callback pattern can be used for all asynchronous methods in the Common APIs.

### **Asynchronous programming using the promises pattern to access data in bindings**


Instead of passing a callback function and waiting for the function to return before the script continues, the promises programming pattern immediately returns a Promise object that represents its intended result. However, unlike true synchronous programming, under the covers the fulfillment of the promised result is actually deferred until the Office Add-ins runtime environment completes the request. An *onError* handler is provided to cover situations when the request can't be fulfilled.

The Common APIs provide the [Office.select](https://learn.microsoft.com/en-us/javascript/api/office#Office_select_expression__callback_) function to support the promises pattern when working with existing binding objects. The promise object returned to the Office.select function only supports the four methods directly accessible from the [Binding](https://learn.microsoft.com/en-us/javascript/api/office/office.binding) object.

- [getDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#office-office-binding-getdataasync-member(1))
- [setDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#office-office-binding-setdataasync-member(1))
- [addHandlerAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#office-office-binding-addhandlerasync-member(1))
- [removeHandlerAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#office-office-binding-removehandlerasync-member(1))

The promises pattern for working with bindings takes this form.

#### Office.select( *selectorExpression* , *onError* ). *BindingObjectAsyncMethod* ;

The *selectorExpression* parameter takes the form "bindings#bindingId" , where *bindingId* is the name ( id ) of a binding that you created in the document or spreadsheet (using one of the "addFrom" methods of the Bindings collection: addFromNamedItemAsync , addFromPromptAsync , or addFromSelectionAsync ). The example *selectorExpression* of bindings#cities specifies that you want to access the binding with an **id** of 'cities'.

The *onError* parameter is an error handling function which takes a single parameter of type AsyncResult . This is used to access an Error object if the select function fails to access the specified binding. The following example shows a basic error handler function that can be passed to the *onError* parameter.

```
JavaScript
function onError(result){
 const err = result.error;
 write(err.name + ": " + err.message);
}
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message; 
}
```


Replace the *BindingObjectAsyncMethod* placeholder with a call to any of the four Binding object methods supported by the promise object: getDataAsync , setDataAsync , addHandlerAsync , or removeHandlerAsync . Calls to these methods don't support additional promises. In that case, you must use the nested callback function pattern.

After a Binding object promise is fulfilled, it can be reused in the chained method call as if it were a binding. If it's successful, the add-in runtime won't asynchronously retry fulfilling the promise. If the Binding object promise can't be fulfilled, the add-in runtime will try again to access the binding object the next time one of its asynchronous methods is invoked.

The following example uses the select function to retrieve a binding with the id " cities " from the Bindings collection, and then calls the [addHandlerAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#office-office-binding-addhandlerasync-member(1)) method to add an event handler for the [dataChanged](https://learn.microsoft.com/en-us/javascript/api/office/office.bindingdatachangedeventargs) event of the binding.

```
JavaScript
```

```
function addBindingDataChangedEventHandler() {
 Office.select("bindings#cities", function onError(){/* error handling
code */}).addHandlerAsync(Office.EventType.BindingDataChanged,
 function (eventArgs) {
 doSomethingWithBinding(eventArgs.binding);
 });
}
```
#### ) **Important**

The Binding object promise returned by the Office.select function provides access to only the four methods of the Binding object. If you need to access any of the other members of the Binding object, instead you must use the Document.bindings property and Bindings.getByIdAsync or Bindings.getAllAsync methods to retrieve the Binding object.

## **Pass optional parameters to asynchronous methods**

The common syntax for all "Async" methods follows this pattern.

*asyncMethod* ( *requiredParameters* , [ *optionalParameters* ], *callbackFunction* );


All asynchronous methods support optional parameters. These are passed in as a JavaScript object. The object that contains the optional parameters is an *unordered* collection of key-value pairs. You can create the object that contains optional parameters inline, or by creating an options object and passing that in as the *options* parameter.

### **Pass optional parameters inline**

Here is an example of the [Document.setSelectedDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.document#office-office-document-setselecteddataasync-member(1)) method with optional parameters defined inline. The two optional parameters, *coercionType* and *asyncContext*, are defined as an anonymous JavaScript object.

```
JavaScript
Office.context.document.setSelectedDataAsync(
 "<html><body>hello world</body></html>",
 {coercionType: "html", asyncContext: 42},
 function(asyncResult) {
 write(asyncResult.status + " " + asyncResult.asyncContext);
 }
)
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message; 
}
```
### **Pass optional parameters in a named object**

Alternatively, you can create a named object that specifies the optional parameters separately from the method call and then pass the object as the *options* argument. The following example shows one way of creating an options object, where parameter1 , value1 , and so on, are placeholders for the actual parameter names and values.

```
JavaScript
const options = {
 parameter1: value1,
 parameter2: value2,
 ...
 parameterN: valueN
};
```
Which looks like the following example when used to specify the [ValueFormat](https://learn.microsoft.com/en-us/javascript/api/office/office.valueformat) and [FilterType](https://learn.microsoft.com/en-us/javascript/api/office/office.filtertype) parameters.


JavaScript

```
const options = {
 valueFormat: "unformatted",
 filterType: "all"
};
```
Here's another way of creating the options object.

```
JavaScript
const options = {};
options[parameter1] = value1;
options[parameter2] = value2;
...
options[parameterN] = valueN;
```
Which looks like the following example when used to specify the ValueFormat and

FilterType parameters:

```
JavaScript
const options = {};
options["ValueFormat"] = "unformatted";
options["FilterType"] = "all";
```
The following example shows how to call to the Document.setSelectedDataAsync method by specifying optional parameters in an options object.

```
JavaScript
const options = {
 coercionType: "html",
 asyncContext: 42
};
document.setSelectedDataAsync(
 "<html><body>hello world</body></html>",
 options,
 function(asyncResult) {
 write(asyncResult.status + " " + asyncResult.asyncContext);
 }
)
// Function that writes to a div with id='message' on the page.
function write(message){
```


In both optional parameter examples, the *callback* parameter is specified as the last parameter (following the inline optional parameters, or following the *options* argument object). Alternatively, you can specify the *callback* parameter inside either the inline JavaScript object, or in the options object. However, you can pass the *callback* parameter in only one location: either in the options object (inline or created externally), or as the last parameter, but not both.

### **Wrap Common APIs in Promise -returning functions**

The Common API (and Outlook API) methods do not return [Promises](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise) . Therefore, you cannot use [await](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Operators/await) to pause the execution until the asynchronous operation completes. If you need await behavior, wrap the method call in an explicitly created Promise .

The basic pattern is to create an asynchronous method that returns a Promise object immediately and *resolves* that Promise object when the inner method completes, or *rejects* the object if the method fails. The following is a simple example.

```
JavaScript
function getDocumentFilePath() {
 return new OfficeExtension.Promise(function (resolve, reject) {
 try {
 Office.context.document.getFilePropertiesAsync(function
(asyncResult) {
 resolve(asyncResult.value.url);
 });
 }
 catch (error) {
 reject(WordMarkdownConversion.errorHandler(error));
 }
 })
}
```
When this function needs to be awaited, it can be either called with the await keyword or passed to a then function.

7 **Note**


This technique is especially useful when you need to call a Common API inside a call of the run function in an application-specific object model. For an example of the getDocumentFilePath function being used in this way, see the file **[Home.js in](https://github.com/OfficeDev/Word-Add-in-MarkdownConversion/blob/master/Word-Add-in-JavaScript-MDConversionWeb/Home.js) [the sample Word-Add-in-JavaScript-MDConversion](https://github.com/OfficeDev/Word-Add-in-MarkdownConversion/blob/master/Word-Add-in-JavaScript-MDConversionWeb/Home.js)** .

### **See also**

- Understanding the Office JavaScript API
- Office JavaScript API
- Runtimes in Office Add-ins


# **Office JavaScript API support for content and task pane add-ins**

Article • 02/12/2025

#### ) **Important**

This article applies to the **Common APIs**, the Office JavaScript API model that was introduced with Office 2013. These APIs include features such as UI, dialogs, and client settings that are common across multiple types of Office applications. Outlook add-ins exclusively use Common APIs, especially the subset of APIs exposed through the **[Mailbox](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox)** object.

You should only use Common APIs for scenarios that aren't supported by **application-specific APIs**. To learn when to use Common APIs instead of application-specific APIs, see **Understanding the Office JavaScript API**.

You can use the Office JavaScript API to create task pane or content add-ins for Office client applications. The objects and methods that content and task pane add-ins support are categorized as follows:

- 1. **Common objects shared with other Office Add-ins.** These objects include [Office](https://learn.microsoft.com/en-us/javascript/api/office), [Context,](https://learn.microsoft.com/en-us/javascript/api/office/office.context) and [AsyncResult.](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult) The Office object is the root object of the Office JavaScript API. The Context object represents the add-in's runtime environment. Both Office and Context are the fundamental objects for any Office Add-in. The AsyncResult object represents the results of an asynchronous operation, such as the data returned to the getSelectedDataAsync method, which reads what a user has selected in a document.
- 2. **The Document object.** The majority of the API available to content and task pane add-ins is exposed through the methods, properties, and events of the [Document](https://learn.microsoft.com/en-us/javascript/api/office/office.document) object. A content or task pane add-in can use the [Office.context.document](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-document-member) property to access the **Document** object, and through it, can access the key members of the API for working with data in documents, such as the [Bindings](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings) and [CustomXmlParts](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlparts) objects, and the [getSelectedDataAsync,](https://learn.microsoft.com/en-us/javascript/api/office/office.document#office-office-document-getselecteddataasync-member(1)) [setSelectedDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.document#office-office-document-setselecteddataasync-member(1)), and [getFileAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.document#office-office-document-getfileasync-member(1)) methods. The Document object also provides the [mode](https://learn.microsoft.com/en-us/javascript/api/office/office.document#office-office-document-mode-member) property for determining whether a document is read-only or in edit mode, the [url](https://learn.microsoft.com/en-us/javascript/api/office/office.document#office-office-document-url-member) property to get the URL of the current document, and access to the [Settings](https://learn.microsoft.com/en-us/javascript/api/office/office.settings) object. The Document object also supports adding event handlers for the [SelectionChanged](https://learn.microsoft.com/en-us/javascript/api/office/office.documentselectionchangedeventargs) event, so you can detect when a user changes their selection in the document.


A content or task pane add-in can access the Document object only after the DOM and runtime environment has been loaded, typically in the event handler for the [Office.initialize](https://learn.microsoft.com/en-us/javascript/api/office) event. For information about the flow of events when an add-in is initialized, and how to check that the DOM and runtime and loaded successfully, see Loading the DOM and runtime environment.

- 3. **Objects for working with specific features.** To work with specific features of the API, use the following objects and methods.
	- The methods of the [Bindings](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings) object to create or get bindings, and the methods and properties of the [Binding](https://learn.microsoft.com/en-us/javascript/api/office/office.binding) object to work with data.
	- The [CustomXmlParts,](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlparts) [CustomXmlPart](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlpart) and associated objects to create and manipulate custom XML parts in Word documents.
	- The [File](https://learn.microsoft.com/en-us/javascript/api/office/office.file) and [Slice](https://learn.microsoft.com/en-us/javascript/api/office/office.slice) objects to create a copy of the entire document, break it into chunks or "slices", and then read or transmit the data in those slices.
	- The [Settings](https://learn.microsoft.com/en-us/javascript/api/office/office.settings) object to save custom data, such as user preferences, and add-in state.

#### ) **Important**

Some of the API members aren't supported across all Office applications that can host content and task pane add-ins. To determine which members are supported, see any of the following:

For a summary of Office JavaScript API support across Office client applications, see Understanding the Office JavaScript API.

## **Read and write to an active selection in a document, spreadsheet, or presentation**

You can read or write to the user's current selection in a document, spreadsheet, or presentation. Depending on the Office application for your add-in, you can specify the type of data structure to read or write as a parameter in the [getSelectedDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.document#office-office-document-getselecteddataasync-member(1)) and [setSelectedDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.document#office-office-document-setselecteddataasync-member(1)) methods of the [Document](https://learn.microsoft.com/en-us/javascript/api/office/office.document) object. For example, you can specify any type of data (text, HTML, tabular data, or Office Open XML) for Word, text and tabular data for Excel, and text for PowerPoint and Project. You can also create event handlers to detect changes to the user's selection. The following example gets data from the selection as text using the getSelectedDataAsync method.


```
JavaScript
Office.context.document.getSelectedDataAsync(
 Office.CoercionType.Text, function (asyncResult) {
 if (asyncResult.status == Office.AsyncResultStatus.Failed) {
 write('Action failed. Error: ' + asyncResult.error.message);
 }
 else {
 write('Selected data: ' + asyncResult.value);
 }
 });
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message;
}
```
For more details and examples, see Read and write data to the active selection in a document or spreadsheet.

### **Bind to a region in a document or spreadsheet**

You can use the getSelectedDataAsync and setSelectedDataAsync methods to read or write to the user's *current* selection in a document, spreadsheet, or presentation. However, if you would like to access the same region in a document across sessions of running your add-in without requiring the user to make a selection, you should first bind to that region. You can also subscribe to data and selection change events for that bound region.

You can add a binding by using [addFromNamedItemAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#office-office-bindings-addfromnameditemasync-member(1)), [addFromPromptAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#office-office-bindings-addfrompromptasync-member(1)), or [addFromSelectionAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#office-office-bindings-addfromselectionasync-member(1)) methods of the [Bindings](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings) object. These methods return an identifier that you can use to access data in the binding, or to subscribe to its data change or selection change events.

The following is an example that adds a binding to the currently selected text in a document, by using the Bindings.addFromSelectionAsync method.

```
JavaScript
Office.context.document.bindings.addFromSelectionAsync(
 Office.BindingType.Text, { id: 'myBinding' }, function (asyncResult) {
 if (asyncResult.status == Office.AsyncResultStatus.Failed) {
 write('Action failed. Error: ' + asyncResult.error.message);
 } else {
 write('Added new binding with type: ' +
 asyncResult.value.type + ' and id: ' + asyncResult.value.id);
```


```
 }
});
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message; 
}
```
For more details and examples, see Bind to regions in a document or spreadsheet.

## **Get entire documents**

If your task pane add-in runs in PowerPoint or Word, you can use the [Document.getFileAsync,](https://learn.microsoft.com/en-us/javascript/api/office/office.document#office-office-document-getfileasync-member(1)) [File.getSliceAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.file#office-office-file-getsliceasync-member(1)), and [File.closeAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.file#office-office-file-closeasync-member(1)) methods to get an entire presentation or document.

When you call Document.getFileAsync you get a copy of the document in a [File](https://learn.microsoft.com/en-us/javascript/api/office/office.file) object. The File object provides access to the document in "chunks" represented as [Slice](https://learn.microsoft.com/en-us/javascript/api/office/office.slice) objects. When you call getFileAsync , you can specify the file type (text or compressed Open Office XML format), and size of the slices (up to 4MB). To access the contents of the File object, you then call File.getSliceAsync which returns the raw data in the [Slice.data](https://learn.microsoft.com/en-us/javascript/api/office/office.slice#office-office-slice-data-member) property. If you specified compressed format, you will get the file data as a byte array. If you are transmitting the file to a web service, you can transform the compressed raw data to a base64-encoded string before submission. Finally, when you are finished getting slices of the file, use the File.closeAsync method to close the document.

For more details, see how to [get the whole document from an add-in for PowerPoint or](https://learn.microsoft.com/en-us/office/dev/add-ins/word/get-the-whole-document-from-an-add-in-for-word) [Word.](https://learn.microsoft.com/en-us/office/dev/add-ins/word/get-the-whole-document-from-an-add-in-for-word)

## **Read and write custom XML parts of a Word document**

Using the Open Office XML file format and content controls, you can add custom XML parts to a Word document and bind elements in the XML parts to content controls in that document. When you open the document, Word reads and automatically populates bound content controls with data from the custom XML parts. Users can also write data into the content controls, and when the user saves the document, the data in the controls will be saved to the bound XML parts. Task pane add-ins for Word, can use the [Document.customXmlParts](https://learn.microsoft.com/en-us/javascript/api/office/office.document#office-office-document-customxmlparts-member) property,[CustomXmlParts,](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlparts) [CustomXmlPart,](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlpart) and [CustomXmlNode](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlnode) objects to read and write data dynamically to the document.


Custom XML parts may be associated with namespaces. To get data from custom XML parts in a namespace, use the [CustomXmlParts.getByNamespaceAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlparts#office-office-customxmlparts-getbynamespaceasync-member(1)) method.

You can also use the [CustomXmlParts.getByIdAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlparts#office-office-customxmlparts-getbyidasync-member(1)) method to access custom XML parts by their GUIDs. After getting a custom XML part, use the [CustomXmlPart.getXmlAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlpart#office-office-customxmlpart-getxmlasync-member(1)) method to get the XML data.

To add a new custom XML part to a document, use the Document.customXmlParts property to get the custom XML parts that are in the document, and call the [CustomXmlParts.addAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlparts#office-office-customxmlparts-addasync-member(1)) method.

For detailed information about how to manage custom XML parts with a task pane addin, see Understand when and how to use Office Open XML in your Word add-in.

### **Persisting add-in settings**

Often you need to save custom data for your add-in, such as a user's preferences or the add-in's state, and access that data the next time the add-in is opened. You can use common web programming techniques to save that data, such as browser cookies or HTML 5 web storage. Alternatively, if your add-in runs in Excel, PowerPoint, or Word, you can use the methods of the [Settings](https://learn.microsoft.com/en-us/javascript/api/office/office.settings) object. Data created with the Settings object is stored in the spreadsheet, presentation, or document that the add-in was inserted into and saved with. This data is available to only the add-in that created it.

To avoid roundtrips to the server where the document is stored, data created with the Settings object is managed in memory at run time. Previously saved settings data is loaded into memory when the add-in is initialized, and changes to that data are only saved back to the document when you call the [Settings.saveAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.settings#office-office-settings-saveasync-member(1)) method. Internally, the data is stored in a serialized JSON object as name/value pairs. You use the [get,](https://learn.microsoft.com/en-us/javascript/api/office/office.settings#office-office-settings-get-member(1)) [set](https://learn.microsoft.com/en-us/javascript/api/office/office.settings#office-office-settings-set-member(1)), and [remove](https://learn.microsoft.com/en-us/javascript/api/office/office.settings#office-office-settings-remove-member(1)) methods of the **Settings** object, to read, write, and delete items from the inmemory copy of the data. The following line of code shows how to create a setting named themeColor and set its value to 'green'.

#### JavaScript

```
Office.context.document.settings.set('themeColor', 'green');
```
Because settings data created or deleted with the set and remove methods is acting on an in-memory copy of the data, you must call saveAsync to persist changes to settings data into the document your add-in is working with.


For more details about working with custom data using the methods of the Settings object, see Persisting add-in state and settings.

## **Permissions model and governance**

Your add-in uses the app manifest to request permission to access the level of functionality it requires from the Office JavaScript API. The method varies depending on the type of manifest.

- **Unified manifest for Microsoft 365**: Use the "authorization.permissions.resourceSpecific" property. For example, if your add-in requires read/write access to the document, its manifest must specify Document.ReadWrite.User as the value in its "authorization.permissions.resourceSpecific.name" property. The following example requests the **read document** permission, which allows only methods that can read (but not write to) the document.

```
JSON
"authorization": {
 "permissions": {
 "resourceSpecific": [
 ...
 {
 "name": "Document.Read.User",
 "type": "Delegated"
 },
 ]
 }
},
```
#### 7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word addins.

- **Add-in only manifest**: Use the Permissions element in the manifest For example, if your add-in requires read/write access to the document, its manifest must specify ReadWriteDocument as the text value in its Permissions element. Because permissions exist to protect a user's privacy and security, as a best practice you should request the minimum level of permissions it needs for its features. The


following example shows how to request the **read document** permission in a task pane's manifest.

```
XML
<?xml version="1.0" encoding="utf-8"?>
<OfficeApp xmlns="http://schemas.microsoft.com/office/appforoffice/1.0"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:type="TaskPaneApp">
 <!-- Other manifest elements omitted. -->
 <Permissions>ReadDocument</Permissions>
 ...
</OfficeApp>
```
For more information, see Requesting permissions for API use in add-ins.

### **See also**

- Office JavaScript API
- [Schema reference for Office Add-ins manifests](https://learn.microsoft.com/en-us/openspecs/office_file_formats/ms-owemxml/c6a06390-34b8-4b42-82eb-b28be12494a8)
- Troubleshoot user errors with Office Add-ins
- Runtimes in Office Add-ins


# **Bind to regions in a document or spreadsheet**

08/01/2025

#### ) **Important**

This article applies to the **Common APIs**, the Office JavaScript API model that was introduced with Office 2013. These APIs include features such as UI, dialogs, and client settings that are common across multiple types of Office applications. Outlook add-ins exclusively use Common APIs, especially the subset of APIs exposed through the **[Mailbox](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailbox)** object.

You should only use Common APIs for scenarios that aren't supported by **applicationspecific APIs**. To learn when to use Common APIs instead of application-specific APIs, see **Understanding the Office JavaScript API**.

Bindings let your add-in consistently access specific regions of a document or spreadsheet. Think of a binding as a bookmark that remembers a specific location, even if users change their selection or navigate elsewhere in the document. Specifically, here are what bindings offer your add-in.

- **Access common data structures** across supported Office applications, such as tables, ranges, or text.
- **Read and write data** without requiring users to make a selection first.
- **Create persistent relationships** between your add-in and document data. Bindings are saved with the document and work across sessions.

To create a binding, call one of these [Bindings](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings) object methods to associate a document region with a unique identifier: [addFromPromptAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#addFromPromptAsync_bindingType__options__callback_), [addFromSelectionAsync,](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#addFromSelectionAsync_bindingType__options__callback_) or [addFromNamedItemAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#addFromNamedItemAsync_itemName__bindingType__options__callback_). Once you've established the binding, use its identifier to read from or write to that region anytime.

You can also subscribe to data and selection change events for specific bound regions. This means your add-in only gets notified about changes within the bound area, not the entire document.

## **Choose the right binding type**

Office supports [three different types of bindings.](https://learn.microsoft.com/en-us/javascript/api/office/office.bindingtype) You specify the type with the *bindingType* parameter when creating a binding using [addFromSelectionAsync,](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#addFromSelectionAsync_bindingType__options__callback_) [addFromPromptAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#addFromPromptAsync_bindingType__options__callback_), or 


[addFromNamedItemAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#addFromNamedItemAsync_itemName__bindingType__options__callback_).

### **Text Binding**

**[Text Binding](https://learn.microsoft.com/en-us/javascript/api/office/office.textbinding)** - Binds to a document region that can be represented as text.

In Word, most contiguous selections work. In Excel, only single cell selections can use text binding. Excel supports only plain text, while Word supports three formats: plain text, HTML, and Open XML for Office.

### **Matrix Binding**

**[Matrix Binding](https://learn.microsoft.com/en-us/javascript/api/office/office.matrixbinding)** - Binds to a fixed region containing tabular data without headers.

Data in a matrix binding is read or written as a two-dimensional **Array** (an array of arrays in JavaScript). For example, two rows of **string** values in two columns would look like [['a', 'b'], ['c', 'd']] , and a single column of three rows would be [['a'], ['b'], ['c']] .

In Excel, any contiguous selection of cells works for matrix binding. In Word, only tables support matrix binding.

### **Table Binding**

**[Table Binding](https://learn.microsoft.com/en-us/javascript/api/office/office.tablebinding)** - Binds to a document region containing a table with headers.

Data in a table binding is read or written as a [TableData](https://learn.microsoft.com/en-us/javascript/api/office/office.tabledata) object. The TableData object exposes data through the headers and rows properties.

Any Excel or Word table can be the basis for a table binding. After you establish a table binding, new rows or columns that users add to the table are automatically included in the binding.

After creating a binding with one of the three "addFrom" methods, you can work with the binding's data and properties using the corresponding object: [MatrixBinding](https://learn.microsoft.com/en-us/javascript/api/office/office.matrixbinding), [TableBinding](https://learn.microsoft.com/en-us/javascript/api/office/office.tablebinding), or [TextBinding.](https://learn.microsoft.com/en-us/javascript/api/office/office.textbinding) All three objects inherit the [getDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#getDataAsync_options__callback_) and [setDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#setDataAsync_data__options__callback_) methods from the Binding object for interacting with bound data.

#### 7 **Note**

**Should you use matrix or table bindings?** When working with tabular data that includes a total row, use matrix binding if your add-in needs to access values in the total row or detect when a user selects the total row. Table bindings don't include total rows in their


**[TableBinding.rowCount](https://learn.microsoft.com/en-us/javascript/api/office/office.tablebinding)** property or in the rowCount and startRow properties of **[BindingSelectionChangedEventArgs](https://learn.microsoft.com/en-us/javascript/api/office/office.bindingselectionchangedeventargs)** in event handlers. To work with total rows, you must use matrix binding.

## **Create a binding from the current selection**

The following example adds a text binding called myBinding to the current selection using the [addFromSelectionAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#addFromSelectionAsync_bindingType__options__callback_) method.

```
JavaScript
```

```
Office.context.document.bindings.addFromSelectionAsync(Office.BindingType.Text, { 
id: 'myBinding' }, function (asyncResult) {
 if (asyncResult.status == Office.AsyncResultStatus.Failed) {
 write('Action failed. Error: ' + asyncResult.error.message);
 } else {
 write('Added new binding with type: ' + asyncResult.value.type + ' and id:
' + asyncResult.value.id);
 }
});
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message; 
}
```
In this example, the binding type is text, so a [TextBinding](https://learn.microsoft.com/en-us/javascript/api/office/office.textbinding) is created for the selection. Different binding types expose different data and operations. [Office.BindingType](https://learn.microsoft.com/en-us/javascript/api/office/office.bindingtype) is an enumeration of available binding types.

The second optional parameter specifies the ID of the new binding. If you don't specify an ID, one is generated automatically.

The anonymous function passed as the final *callback* parameter runs when the binding creation is complete. The function receives a single parameter, asyncResult , which provides access to an [AsyncResult](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult) object with the call's status. The AsyncResult.value property contains a reference to a [Binding](https://learn.microsoft.com/en-us/javascript/api/office/office.binding) object of the specified type for the newly created binding. You can use this [Binding](https://learn.microsoft.com/en-us/javascript/api/office/office.binding) object to get and set data.

## **Create a binding from a prompt**

The following function adds a text binding called myBinding using the [addFromPromptAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#addFromPromptAsync_bindingType__options__callback_) method. This method lets users specify the range for the binding using the application's built


in range selection prompt.

JavaScript

```
function bindFromPrompt() {
 Office.context.document.bindings.addFromPromptAsync(Office.BindingType.Text, {
id: 'myBinding' }, function (asyncResult) {
 if (asyncResult.status == Office.AsyncResultStatus.Failed) {
 write('Action failed. Error: ' + asyncResult.error.message);
 } else {
 write('Added new binding with type: ' + asyncResult.value.type + ' and
id: ' + asyncResult.value.id);
 }
 });
}
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message;
}
```
In this example, the binding type is text, so a [TextBinding](https://learn.microsoft.com/en-us/javascript/api/office/office.textbinding) is created for the user's selection in the prompt.

The second parameter contains the ID of the new binding. If you don't specify an ID, one is generated automatically.

The anonymous function passed as the third *callback* parameter runs when the binding creation is complete. When the callback function runs, the [AsyncResult](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult) object contains the call's status and the newly created binding.

The following screenshot shows the built-in range selection prompt in Excel.

## **Add a binding to a named item**

The following function adds a binding to the existing myRange named item as a "matrix" binding using the [addFromNamedItemAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#addFromNamedItemAsync_itemName__bindingType__options__callback_) method and assigns the binding's id as "myMatrix".


```
JavaScript
```

```
function bindNamedItem() {
 Office.context.document.bindings.addFromNamedItemAsync("myRange", "matrix",
{id:'myMatrix'}, function (result) {
 if (result.status == 'succeeded'){
 write('Added new binding with type: ' + result.value.type + ' and id:
' + result.value.id);
 }
 else
 write('Error: ' + result.error.message);
 });
}
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message; 
}
```
**For Excel**, the itemName parameter of [addFromNamedItemAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#addFromNamedItemAsync_itemName__bindingType__options__callback_) refers to an existing named range, a range specified with A1 reference style ( "A1:A3" ), or a table. By default, Excel assigns the names "Table1" for the first table, "Table2" for the second table, and so on. To assign a meaningful name to a table in the Excel UI, use the **Table Name** property on the **Table Tools | Design** tab.

7 **Note**

In Excel, when specifying a table as a named item, you must fully qualify the name to include the worksheet name in this format (e.g., "Sheet1!Table1" ).

The following function creates a binding in Excel to the first three cells in column A ( "A1:A3" ), assigns the ID "MyCities" , and then writes three city names to that binding.

```
JavaScript
function bindingFromA1Range() {
 Office.context.document.bindings.addFromNamedItemAsync("A1:A3", "matrix", { 
id: "MyCities" },
 function (asyncResult) {
 if (asyncResult.status == "failed") {
 write('Error: ' + asyncResult.error.message);
 } else {
 // Write data to the new binding.
 Office.select("bindings#MyCities").setDataAsync([['Berlin'],
['Munich'], ['Duisburg']], { coercionType: "matrix" },
 function (asyncResult) {
 if (asyncResult.status == "failed") {
```


```
 write('Error: ' + asyncResult.error.message);
 }
 });
 }
 });
}
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message; 
}
```
**For Word**, the itemName parameter of [addFromNamedItemAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#addFromNamedItemAsync_itemName__bindingType__options__callback_) refers to the Title property of a Rich Text content control. (You can't bind to content controls other than the Rich Text content control.)

By default, a content control has no Title value assigned. To assign a meaningful name in the Word UI, after inserting a **Rich Text** content control from the **Controls** group on the **Developer** tab, use the **Properties** command in the **Controls** group to display the **Content Control Properties** dialog. Then set the Title property of the content control to the name you want to reference from your code.

The following function creates a text binding in Word to a rich text content control named "FirstName" , assigns the **id** "firstName" , and then displays that information.

```
JavaScript
function bindContentControl() {
 Office.context.document.bindings.addFromNamedItemAsync('FirstName', 
 Office.BindingType.Text, {id:'firstName'},
 function (result) {
 if (result.status === Office.AsyncResultStatus.Succeeded) {
 write('Control bound. Binding.id: '
 + result.value.id + ' Binding.type: ' + result.value.type);
 } else {
 write('Error:', result.error.message);
 }
 });
}
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message; 
}
```
### **Get all bindings**

The following example gets all bindings in a document using the [getAllAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#getAllAsync_options__callback_) method.


```
JavaScript
```

```
Office.context.document.bindings.getAllAsync(function (asyncResult) {
 let bindingString = '';
 for (let i in asyncResult.value) {
 bindingString += asyncResult.value[i].id + '\n';
 }
 write('Existing bindings: ' + bindingString);
});
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message; 
}
```
The anonymous function passed as the callback parameter runs when the operation is complete. The function is called with a single parameter, asyncResult , which contains an array of the bindings in the document. The array is iterated to build a string that contains the IDs of the bindings. The string is then displayed in a message box.

## **Get a binding by ID using getByIdAsync**

The following example uses the [getByIdAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#getByIdAsync_id__options__callback_) method to get a binding in a document by specifying its ID. This example assumes that a binding named 'myBinding' was added to the document using one of the methods described earlier in this article.

```
JavaScript
Office.context.document.bindings.getByIdAsync('myBinding', function (asyncResult) 
{
 if (asyncResult.status == Office.AsyncResultStatus.Failed) {
 write('Action failed. Error: ' + asyncResult.error.message);
 }
 else {
 write('Retrieved binding with type: ' + asyncResult.value.type + ' and id:
' + asyncResult.value.id);
 }
});
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message; 
}
```
In this example, the first id parameter is the ID of the binding to retrieve.


The anonymous function passed as the second *callback* parameter runs when the operation is completed. The function is called with a single parameter, *asyncResult*, which contains the call's status and the binding with the ID "myBinding".

## **Get a binding by ID using Office.select**

The following example uses the [Office.select](https://learn.microsoft.com/en-us/javascript/api/office) function to get a [Binding](https://learn.microsoft.com/en-us/javascript/api/office/office.binding) object promise in a document by specifying its ID in a selector string. It then calls the [getDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#getDataAsync_options__callback_) method to get data from the specified binding. This example assumes that a binding named 'myBinding' was added to the document using one of the methods described earlier in this article.

```
JavaScript
Office.select("bindings#myBinding", function onError(){}).getDataAsync(function
(asyncResult) {
 if (asyncResult.status == Office.AsyncResultStatus.Failed) {
 write('Action failed. Error: ' + asyncResult.error.message);
 } else {
 write(asyncResult.value);
 }
});
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message; 
}
```
If the select function promise successfully returns a [Binding](https://learn.microsoft.com/en-us/javascript/api/office/office.binding) object, that object exposes only the following four methods: [getDataAsync,](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#getDataAsync_options__callback_) [setDataAsync,](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#setDataAsync_data__options__callback_) [addHandlerAsync,](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#addHandlerAsync_eventType__handler__options__callback_) and [removeHandlerAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#removeHandlerAsync_eventType__options__callback_). If the promise can't return a Binding object, the onError callback can be used to access an [asyncResult.](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult)error object to get more information. If you need to call a member of the Binding object other than the four methods exposed by the [Binding](https://learn.microsoft.com/en-us/javascript/api/office/office.binding) object promise returned by the select function, instead use the [getByIdAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#getByIdAsync_id__options__callback_) method by using the [Document.bindings](https://learn.microsoft.com/en-us/javascript/api/office/office.document) property and [getByIdAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#getByIdAsync_id__options__callback_) method to retrieve the [Binding](https://learn.microsoft.com/en-us/javascript/api/office/office.binding) object.

## **Release a binding by ID**

The following example uses the [releaseByIdAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.bindings#releaseByIdAsync_id__options__callback_) method to release a binding in a document by specifying its ID.

```
JavaScript
```

```
Office.context.document.bindings.releaseByIdAsync('myBinding', function
(asyncResult) {
```


```
 write('Released myBinding!');
});
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message; 
}
```
In this example, the first id parameter is the ID of the binding to release.

The anonymous function passed as the second parameter is a callback that runs when the operation is complete. The function is called with a single parameter, [asyncResult](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult), which contains the call's status.

### **Read data from a binding**

The following example uses the [getDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#getDataAsync_options__callback_) method to get data from an existing binding.

```
JavaScript
myBinding.getDataAsync(function (asyncResult) {
 if (asyncResult.status == Office.AsyncResultStatus.Failed) {
 write('Action failed. Error: ' + asyncResult.error.message);
 } else {
 write(asyncResult.value);
 }
});
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message; 
}
```
myBinding is a variable that contains an existing text binding in the document. Alternatively, you could use [Office.select](https://learn.microsoft.com/en-us/javascript/api/office) to access the binding by its ID, and start your call to the [getDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#getDataAsync_options__callback_) method, like this:

JavaScript Office.select("bindings#myBindingID").getDataAsync

The anonymous function passed into the method is a callback that runs when the operation is complete. The [AsyncResult.](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult)value property contains the data within myBinding . The type of the value depends on the binding type. The binding in this example is a text binding, so the value


will contain a string. For additional examples of working with matrix and table bindings, see the [getDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#getDataAsync_options__callback_) method topic.

## **Write data to a binding**

The following example uses the [setDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#setDataAsync_data__options__callback_) method to set data in an existing binding.

JavaScript

```
myBinding.setDataAsync('Hello World!', function (asyncResult) { });
```
myBinding is a variable that contains an existing text binding in the document.

In this example, the first parameter is the value to set on myBinding . Because this is a text binding, the value is a string . Different binding types accept different types of data.

The anonymous function passed into the method is a callback that runs when the operation is complete. The function is called with a single parameter, asyncResult , which contains the result's status.

## **Detect changes to data or selection in a binding**

The following function attaches an event handler to the [DataChanged](https://learn.microsoft.com/en-us/javascript/api/office/office.binding) event of a binding with an ID of "MyBinding".

```
JavaScript
function addHandler() {
Office.select("bindings#MyBinding").addHandlerAsync(
 Office.EventType.BindingDataChanged, dataChanged);
}
function dataChanged(eventArgs) {
 write('Bound data changed in binding: ' + eventArgs.binding.id);
}
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message;
}
```
The myBinding is a variable that contains an existing text binding in the document.

The first *eventType* parameter of [addHandlerAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#addHandlerAsync_eventType__handler__options__callback_) specifies the name of the event to subscribe to. [Office.EventType](https://learn.microsoft.com/en-us/javascript/api/office/office.eventtype) is an enumeration of available event type values.

Office.EventType.BindingDataChanged evaluates to the string "bindingDataChanged".


The dataChanged function passed as the second *handler* parameter is an event handler that runs when the data in the binding is changed. The function is called with a single parameter, *eventArgs*, which contains a reference to the binding. This binding can be used to retrieve the updated data.

Similarly, you can detect when a user changes selection in a binding by attaching an event handler to the [SelectionChanged](https://learn.microsoft.com/en-us/javascript/api/office/office.bindingselectionchangedeventargs) event of a binding. To do that, specify the eventType parameter of [addHandlerAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#addHandlerAsync_eventType__handler__options__callback_) as Office.EventType.BindingSelectionChanged or "bindingSelectionChanged" .

You can add multiple event handlers for a given event by calling [addHandlerAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#addHandlerAsync_eventType__handler__options__callback_) again and passing in an additional event handler function for the handler parameter. The name of each event handler function must be unique.

### **Remove an event handler**

To remove an event handler for an event, call [removeHandlerAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#removeHandlerAsync_eventType__options__callback_) passing in the event type as the first *eventType* parameter, and the name of the event handler function to remove as the second *handler* parameter. For example, the following function removes the dataChanged event handler function added in the previous section's example.

```
JavaScript
function removeEventHandlerFromBinding() {
 Office.select("bindings#MyBinding").removeHandlerAsync(
 Office.EventType.BindingDataChanged, {handler:dataChanged});
}
```
#### ) **Important**

If the optional *handler* parameter is omitted when **[removeHandlerAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.binding#removeHandlerAsync_eventType__options__callback_)** is called, all event handlers for the specified eventType will be removed.

### **See also**

- Understanding the Office JavaScript API
- Asynchronous programming in Office Add-ins
- Read and write data to the active selection in a document or spreadsheet


# **Referencing the Office JavaScript API library**

Article • 01/16/2025

The Office JavaScript API library provides the APIs that your add-in can use to interact with the Office application. The simplest way to reference the library is to use the content delivery network (CDN) by adding the following <script> tag within the <head> section of your HTML page.

```
HTML
<head>
 ...
 <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"
type="text/javascript"></script>
</head>
```
This will download and cache the Office JavaScript API files the first time your add-in loads to make sure that it is using the most up-to-date implementation of Office.js and its associated files for the specified version.

#### ) **Important**

You must reference the Office JavaScript API from inside the <head> section of the page to ensure that the API is fully initialized prior to any body elements.

### **Office.js-specific web API behavior**

Office.js replaces the default [Window.history](https://developer.mozilla.org/docs/Web/API/History) methods of replaceState and pushState with null . This is done to support older Microsoft webviews and Office versions. If your add-in relies on these methods and doesn't need to run on Office versions that use the Internet Explorer 11 browser control, replace the Office.js library reference with the following workaround.

```
HTML
<script type="text/javascript">
 // Cache the history method values.
 window._historyCache = {
 replaceState: window.history.replaceState,
 pushState: window.history.pushState
 };
```


```
</script>
<script type="text/javascript"
src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
<script type="text/javascript">
 // Restore the history method values after loading Office.js
 window.history.replaceState = window._historyCache.replaceState;
 window.history.pushState = window._historyCache.pushState;
</script>
```
Thank you to [@stepper and the Stack Overflow community](https://stackoverflow.com/questions/42642863/office-js-nullifies-browser-history-functions-breaking-history-usage) for suggesting and verifying this workaround.

## **API versioning and backward compatibility**

In the previous HTML snippet, the /1/ in front of office.js in the CDN URL specifies the latest incremental release within version 1 of Office.js. Because the Office JavaScript API maintains backward compatibility, the latest release will continue to support API members that were introduced earlier in version 1.

If you plan to publish your Office Add-in from AppSource, you must use this CDN reference. Local references are only appropriate for internal, development, and debugging scenarios.

7 **Note**

To use preview APIs, reference the preview version of the Office JavaScript API library on the CDN: https://appsforoffice.microsoft.com/lib/beta/hosted/office.js .

## **Enabling IntelliSense for a TypeScript project**

In addition to referencing the Office JavaScript API as described previously, you can also enable IntelliSense for TypeScript add-in project by using the type definitions from [DefinitelyTyped](https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/office-js) . To do so, run the following command in a Node-enabled system prompt (or git bash window) from the root of your project folder. You must have [Node.js](https://nodejs.org/) installed (which includes npm).

```
command line
npm install --save-dev @types/office-js
```


## **Preview APIs**

New JavaScript APIs are first introduced in "preview" and later become part of a specific numbered requirement set after sufficient testing occurs and user feedback is acquired.

#### 7 **Note**

Preview APIs are subject to change and are not intended for use in a production environment. We recommend that you try them out in test and development environments only. Do not use preview APIs in a production environment or within business-critical documents.

To use preview APIs:

- You must use the preview version of the Office JavaScript API library from the **[Office.js content delivery network (CDN)](https://appsforoffice.microsoft.com/lib/beta/hosted/office.js)** . The **[type definition file](https://appsforoffice.microsoft.com/lib/beta/hosted/office.d.ts)** for TypeScript compilation and IntelliSense is found at the CDN and **[DefinitelyTyped](https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/office-js-preview/index.d.ts)** . You can install these types with npm install --save-dev @types/office-js-preview .
- You may need to join the **[Microsoft 365 Insider program](https://aka.ms/MSFT365InsiderProgram)** for access to more recent Office builds.

## **CDN references for other Microsoft 365 environments**

#### [21Vianet operates and manages an Office 365 service powered by licensed Microsoft](https://learn.microsoft.com/en-us/microsoft-365/admin/services-in-china/services-in-china?view=o365-21vianet&preserve-view=true)

[technologies](https://learn.microsoft.com/en-us/microsoft-365/admin/services-in-china/services-in-china?view=o365-21vianet&preserve-view=true) to provide Office 365 services for China compliant with local laws and regulations. Add-ins developed for use within this cloud environment should use corresponding CDN. Use https://appsforoffice.cdn.partner.office365.cn/appsforoffice/lib/1/hosted/office.js instead of the standard CDN reference. This ensures continued compliance and provides better add-in performance.

### **See also**

- Understanding the Office JavaScript API
- Office JavaScript API
- Guidance for deploying Office Add-ins on government clouds
- [Microsoft software license terms for the Microsoft Office JavaScript (Office.js) API library](https://github.com/OfficeDev/office-js/blob/release/LICENSE.md)


# **Specify Office applications and API requirements with the unified manifest**

Article • 02/12/2025

#### 7 **Note**

For information about specifying requirements with the add-in only manifest, see **Specify Office hosts and API requirements with the add-in only manifest**.

Your Office Add-in might depend on a specific Office application (also called an Office host) or on specific members of the Office JavaScript Library (office.js). For example, your add-in might:

- Run in a single Office application (e.g., Word or Excel), or several applications.
- Make use of Office JavaScript APIs that are only available in some versions of Office. For example, the volume-licensed perpetual version of Excel 2016 doesn't support all Excel-related APIs in the Office JavaScript library.
- Be designed for use only in a mobile form factor.

In these situations, you need to ensure that your add-in is never installed on Office applications or Office versions in which it cannot run.

There are also scenarios in which you want to control which features of your add-in are visible to users based on their Office application and Office version. Three examples are:

- Your add-in has features that are useful in both Word and PowerPoint, such as text manipulation, but it has some additional features that only make sense in PowerPoint, such as slide management features. You need to hide the PowerPointonly features when the add-in is running in Word.
- Your add-in has a feature that requires an Office JavaScript API method that is supported in some versions of an Office application, such as Microsoft 365 subscription Excel, but isn't supported in others, such as volume-licensed perpetual Excel 2016. But your add-in has other features that require only Office JavaScript API methods that *are* supported in volume-licensed perpetual Excel 2016. In this scenario, you need the add-in to be installable on that version of Excel 2016, but the feature that requires the unsupported method should be hidden from those users.
- Your add-in has features that are supported in desktop Office, but not in mobile Office.


This article helps you understand how to ensure that your add-in works as expected and reaches the broadest audience possible.

#### 7 **Note**

For a high-level view of where Office Add-ins are currently supported, see the **[Office client application and platform availability for Office Add-ins](https://learn.microsoft.com/en-us/javascript/api/requirement-sets)** page.

#### **Tip**

Many of the tasks described in this article are done for you, in whole or in part, when you create your add-in project with a tool, such as the **Yeoman generator for Office Add-ins** or one of the Office Add-in templates in Visual Studio. In such cases, please interpret the task as meaning that you should verify that it has been done.

## **Use the latest Office JavaScript API library**

Your add-in should load the most current version of the Office JavaScript API library from the content delivery network (CDN). To do this, be sure you have the following <script> tag in the first HTML file your add-in opens. Using /1/ in the CDN URL ensures that you reference the most recent version of Office.js.

HTML

```
<script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"
type="text/javascript"></script>
```
# **Specify which Office applications can host your add-in**

To specify the Office applications on which your add-in can be installed, use the "extensions.requirements.scopes" array. Specify any subset of "mail", "workbook", "document", and "presentation". The following table shows which Office application and platform combinations correspond to these values. It also shows what kind of add-in can be installed for each scope.


| Name         | Office client applications                                        | Available add-in<br>types |
|--------------|-------------------------------------------------------------------|---------------------------|
| document     | Word on the web, Windows, Mac, iPad                               | Task pane                 |
| mail         | Outlook on the web, Windows (new<br>and classic),<br>Android, iOS | Mail                      |
| presentation | PowerPoint on the web, Windows, Mac, iPad                         | Task pane, Content        |
| workbook     | Excel on the web, Windows, Mac, iPad                              | Task pane, Content        |

#### 7 **Note**

Content add-ins have an "extensions.contentRuntimes" property. They can't have an "extensions.runtimes" property so they can't be combined with a Task pane or Mail add-in. For more information about Content add-ins, see **Content Office Addins**.

For example, the following JSON specifies that the add-in can install on any release of Excel, which includes Excel on the web, Windows, and iPad, but can't be installed on any other Office application.

```
JSON
"extensions": [
 {
 "requirements": {
 "scopes": [ "workbook" ],
 },
 ...
 }
]
```
#### 7 **Note**

Office applications are supported on different platforms and run on desktops, web browsers, tablets, and mobile devices. You usually can't specify which platform can be used to run your add-in. For example, if you specify "workbook", both Excel on the web and on Windows can be used to run your add-in. However, if you specify "mail", your add-in won't run on Outlook mobile clients unless you define the **[mobile extension point](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#mobilemessagereadcommandsurface)**.


## **Specify which Office APIs your add-in needs**

You can't explicitly specify the Office versions and builds or the platforms on which your add-in should be installable, and you wouldn't want to because you would have to revise your manifest whenever support for the add-in features that your add-in uses is extended to a new version or platform. Instead, specify in the manifest the APIs that your add-in needs. Office prevents the add-in from being installed on combinations of Office version and platform that don't support the APIs and ensures that the add-in won't appear in **My Add-ins**.

#### ) **Important**

Only use the "requirements" property that is a direct child of "extensions" to specify the API members that your add-in must have to be of any significant value at all. If your add-in uses an API for some features, but has other useful features that don't require the API, you should design the add-in so that it's installable on platform and Office version combinations that don't support the API but provides a diminished experience on those combinations. For this purpose, use "requirements" properties that aren't direct children of "extensions". For more information, see **Design for alternate experiences**.

### **Requirement sets**

To simplify the process of specifying the APIs that your add-in needs, Office groups most APIs together in requirement sets. The APIs in the Common API Object Model are grouped by the development feature that they support. For example, all the APIs connected to table bindings are in the requirement set called "TableBindings 1.1". The APIs in the Application specific object models are grouped by when they were released for use in production add-ins.

Requirement sets are versioned. For example, the APIs that support Dialog Boxes are in the requirement set DialogApi 1.1. When additional APIs that enable messaging from a task pane to a dialog were released, they were grouped into DialogApi 1.2, along with all the APIs in DialogApi 1.1. *Each version of a requirement set is a superset of all earlier versions.*

Requirement set support varies by Office application, the version of the Office application, and the platform on which it is running. For example, DialogApi 1.2 isn't supported on volume-licensed perpetual versions of Office before Office 2021, but DialogApi 1.1 is supported on all perpetual versions back to Office 2016. You want your add-in to be installable on every combination of platform and Office version that


supports the APIs that it uses, so you should always specify in the manifest the *minimum* version of each requirement set that your add-in requires. Details about how to do this are later in this article.

#### **Tip**

For more information about requirement set versioning, see **Office requirement sets availability**, and for the complete lists of requirement sets and information about the APIs in each, start with **[Office Add-in requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/office-add-in-requirement-sets)**. The reference topics for most Office.js APIs also specify the requirement set they belong to (if any).

### **extensions.requirements.capabilities property**

Use the "requirements.capabilities" property to specify the minimum requirement sets that must be supported by the Office application to install your add-in. If the Office application or platform doesn't support the requirement sets or API members specified in the "requirements.capabilities" property, the add-in won't run in that application or platform, and won't display in **My Add-ins**.

#### **Tip**

All APIs in the application-specific models are in requirement sets, but some of those in the Common API model aren't. If your add-in requires an API that isn't in any requirement set, you can implement a runtime check for the availability of the API and display a message to the add-in's users if it isn't supported. For more information, see **Check for API availability at runtime**.

The following code example shows how to configure an add-in that is installable in all Office application and platform combinations that support the following:

- TableBindings requirement set, which has a minimum version of "1.1".
- OOXML requirement set, which has a minimum version of "1.1".

```
JSON
"extensions": [
 {
 "requirements": {
 "capabilities": [ 
 {
 "name": "TableBindings",
```


```
 "minVersion": "1.1"
 },
 {
 "name": "OOXML",
 "minVersion": "1.1"
 }
 ],
 },
 ...
 }
]
```
### **Tip**

For more information and another example of using the "extensions.requirements" property, see the "extensions.requirements" section in **[Specify Office Add-in](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/requirements-property-unified-manifest#extensionsrequirements) [requirements in the unified manifest for Microsoft 365](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/requirements-property-unified-manifest#extensionsrequirements)**.

### **Specify the form factors on which your add-in can be installed**

For an Outlook add-in, you can specify whether the add-in should be installable on desktop (includes tablets) or mobile form factors. To configure this, use the "extensions.requirements.formFactors" property. The following example show how to make the Outlook add-in installable on both form factors.

```
JSON
"extensions": [
 {
 "requirements": {
 ...
 "formFactors": [
 "desktop",
 "mobile"
 ]
 },
 ...
 }
]
```
### **Design for alternate experiences**


The extensibility features that the Office Add-in platform provides can be usefully divided into three kinds:

- Extensibility features that are available immediately after the add-in is installed. An example of this kind of feature is Add-in Commands, which are custom ribbon buttons and menus.
- Extensibility features that are available only when the add-in is running and that are implemented with Office.js JavaScript APIs; for example, Dialog Boxes.
- Extensibility features that are available only at runtime but are implemented with a combination of Office.js JavaScript and manifest configuration. Examples of these are Excel custom functions, single sign-on, and custom contextual tabs.

If your add-in uses a specific extensibility feature for some of its functionality but has other useful functionality that doesn't require the extensibility feature, you should design the add-in so that it's installable on platform and Office version combinations that don't support the extensibility feature. It can provide a valuable, albeit diminished, experience on those combinations.

You implement this design differently depending on how the extensibility feature is implemented:

- For features implemented entirely with JavaScript, see Check for API availability at runtime.
- For features that require you to configure the manifest, see the "Filter features" section of [Specify Office Add-in requirements in the unified manifest for Microsoft](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/requirements-property-unified-manifest#filter-features) [365.](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/requirements-property-unified-manifest#filter-features)

## **See also**

- Office Add-ins manifest
- [Office Add-in requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/office-add-in-requirement-sets)
- [Specify Office Add-in requirements in the unified manifest for Microsoft 365](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/requirements-property-unified-manifest)


# **Specify Office applications and API requirements with the add-in only manifest**

Article • 02/12/2025

#### 7 **Note**

For information about specifying requirements with the **unified manifest for Microsoft 365**, see **Specify Office hosts and API requirements with the unified manifest**.

Your Office Add-in might depend on a specific Office application (also called an Office host) or on specific members of the Office JavaScript Library (office.js). For example, your add-in might:

- Run in a single Office application (for example, Word or Excel), or several applications.
- Make use of Office JavaScript APIs that are only available in some versions of Office. For example, the volume-licensed perpetual version of Excel 2016 doesn't support all Excel-related APIs in the Office JavaScript library.

In these situations, you need to ensure that your add-in is never installed on Office applications or Office versions in which it cannot run.

There are also scenarios in which you want to control which features of your add-in are visible to users based on their Office application and Office version. Two examples are:

- Your add-in has features that are useful in both Word and PowerPoint, such as text manipulation, but it has some additional features that only make sense in PowerPoint, such as slide management features. You need to hide the PowerPointonly features when the add-in is running in Word.
- Your add-in has a feature that requires an Office JavaScript API method that is supported in some versions of an Office application, such as Microsoft 365 subscription Excel, but is not supported in others, such as volume-licensed perpetual Excel 2016. But your add-in has other features that require only Office JavaScript API methods that *are* supported in volume-licensed perpetual Excel 2016. In this scenario, you need the add-in to be installable on that version of Excel 2016, but the feature that requires the unsupported method should be hidden from those users.


This article helps you understand which options you should choose to ensure that your add-in works as expected and reaches the broadest audience possible.

#### 7 **Note**

For a high-level view of where Office Add-ins are currently supported, see the **[Office client application and platform availability for Office Add-ins](https://learn.microsoft.com/en-us/javascript/api/requirement-sets)** page.

#### **Tip**

Many of the tasks described in this article are done for you, in whole or in part, when you create your add-in project with a tool, such as the **Yeoman generator for Office Add-ins** or one of the Office Add-in templates in Visual Studio. In such cases, please interpret the task as meaning that you should verify that it has been done.

### **Use the latest Office JavaScript API library**

Your add-in should load the most current version of the Office JavaScript API library from the content delivery network (CDN). To do this, be sure you have the following <script> tag in the first HTML file your add-in opens. Using /1/ in the CDN URL ensures that you reference the most recent version of Office.js.

HTML

```
<script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"
type="text/javascript"></script>
```
# **Specify which Office applications can host your add-in**

By default, an add-in is installable in all Office applications supported by the specified add-in type (that is, Mail, Task pane, or Content). For example, a task pane add-in is installable by default on Access, Excel, OneNote, PowerPoint, Project, and Word.

To ensure that your add-in is installable in only a subset of Office applications, use the [Hosts](https://learn.microsoft.com/en-us/javascript/api/manifest/hosts) and [Host](https://learn.microsoft.com/en-us/javascript/api/manifest/host) elements in the add-in only manifest.


For example, the following **<Hosts>** and **<Host>** declaration specifies that the add-in can install on any release of Excel, which includes Excel on the web, Windows, and iPad, but can't be installed on any other Office application.

| XML                                                    |  |
|--------------------------------------------------------|--|
| <hosts><br/><host name="Workbook"></host><br/></hosts> |  |

The **<Hosts>** element can contain one or more **<Host>** elements. There should be a separate **<Host>** element for each Office application on which the add-in should be installable. The Name attribute is required and can be set to one of the following values.

#### ノ **Expand table**

| Name         | Office client applications                                             | Available add-in<br>types |
|--------------|------------------------------------------------------------------------|---------------------------|
| Document     | Word on the web, Windows, Mac, iPad                                    | Task pane                 |
| Mailbox      | Outlook on the web, Windows (new<br>and classic), Mac,<br>Android, iOS | Mail                      |
| Notebook     | OneNote on the web                                                     | Task pane, Content        |
| Presentation | PowerPoint on the web, Windows, Mac, iPad                              | Task pane, Content        |
| Project      | Project on Windows                                                     | Task pane                 |
| Workbook     | Excel on the web, Windows, Mac, iPad                                   | Task pane, Content        |
| Database     | Access (obsolete)                                                      | Task pane                 |

#### 7 **Note**

Office applications are supported on different platforms and run on desktops, web browsers, tablets, and mobile devices. You usually can't specify which platform can be used to run your add-in. For example, if you specify Workbook , both Excel on the web and on Windows can be used to run your add-in. However, if you specify Mailbox , your add-in won't run on Outlook mobile clients unless you define the **[mobile extension point](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#mobilemessagereadcommandsurface)**.


It isn't possible for an add-in only manifest to apply to more than one type: Mail, Task pane, or Content. This means that if you want your add-in to be installable on Outlook and on one of the other Office applications, you must create *two* add-ins, one with a Mail type manifest and the other with a Task pane or Content type manifest.

## **Specify which Office versions and platforms can host your add-in**

You can't explicitly specify the Office versions and builds or the platforms on which your add-in should be installable, and you wouldn't want to because you would have to revise your manifest whenever support for the add-in features that your add-in uses is extended to a new version or platform. Instead, specify in the manifest the APIs that your add-in needs. Office prevents the add-in from being installed on combinations of Office version and platform that don't support the APIs and ensures that the add-in won't appear in **My Add-ins**.

#### ) **Important**

Only use the base manifest to specify the API members that your add-in must have to be of any significant value at all. If your add-in uses an API for some features but has other useful features that don't require the API, you should design the add-in so that it's installable on platform and Office version combinations that don't support the API but provides a diminished experience on those combinations. For more information, see **Design for alternate experiences**.

### **Requirement sets**

To simplify the process of specifying the APIs that your add-in needs, Office groups most APIs together in requirement sets. The APIs in the Common API Object Model are grouped by the development feature that they support. For example, all the APIs connected to table bindings are in the requirement set called "TableBindings 1.1". The APIs in the Application specific object models are grouped by when they were released for use in production add-ins.

Requirement sets are versioned. For example, the APIs that support Dialog Boxes are in the requirement set DialogApi 1.1. When additional APIs that enable messaging from a task pane to a dialog were released, they were grouped into DialogApi 1.2, along with


all the APIs in DialogApi 1.1. *Each version of a requirement set is a superset of all earlier versions.*

Requirement set support varies by Office application, the version of the Office application, and the platform on which it is running. For example, DialogApi 1.2 isn't supported on volume-licensed perpetual versions of Office before Office 2021, but DialogApi 1.1 is supported on all perpetual versions back to Office 2016. You want your add-in to be installable on every combination of platform and Office version that supports the APIs that it uses, so you should always specify in the manifest the *minimum* version of each requirement set that your add-in requires. Details about how to do this are later in this article.

#### **Tip**

For more information about requirement set versioning, see **Office requirement sets availability**, and for the complete lists of requirement sets and information about the APIs in each, start with **[Office Add-in requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/office-add-in-requirement-sets)**. The reference topics for most Office.js APIs also specify the requirement set they belong to (if any).

#### 7 **Note**

Some requirement sets also have manifest elements associated with them. See **Specifying requirements in a VersionOverrides element** for information about when this fact is relevant to your add-in design.

### **Requirements element**

Use the [Requirements](https://learn.microsoft.com/en-us/javascript/api/manifest/requirements) element and its child element [Sets](https://learn.microsoft.com/en-us/javascript/api/manifest/sets) to specify the minimum requirement sets that must be supported by the Office application to install your add-in.

All APIs in the application specific models are in requirement sets, but some of those in the Common API model are not. Use the [Methods](https://learn.microsoft.com/en-us/javascript/api/manifest/methods) to specify the setless API members that your add-in requires. You can't use the **<Methods>** element with Outlook add-ins.

If the Office application or platform doesn't support the requirement sets or API members specified in the **<Requirements>** element, the add-in won't run in that application or platform, and won't display in **My Add-ins**.


The **<Requirements>** element is optional for all add-ins, except for Outlook addins. When the xsi:type attribute of the root OfficeApp element is MailApp , there must be a **<Requirements>** element that specifies the minimum version of the Mailbox requirement set that the add-in requires. For more information, see **[Outlook JavaScript API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets)**.

The following code example shows how to configure an add-in that is installable in all Office applications that support the following:

- TableBindings requirement set, which has a minimum version of "1.1".
- OOXML requirement set, which has a minimum version of "1.1".
- Document.getSelectedDataAsync method.

```
XML
<OfficeApp ... >
 ...
 <Requirements>
 <Sets DefaultMinVersion="1.1">
 <Set Name="TableBindings" MinVersion="1.1"/>
 <Set Name="OOXML" MinVersion="1.1"/>
 </Sets>
 <Methods>
 <Method Name="Document.getSelectedDataAsync"/>
 </Methods>
 </Requirements>
 ...
</OfficeApp>
```
Note the following about this example.

- The **<Requirements>** element contains the **<Sets>** and **<Methods>** child elements.
- The **<Sets>** element can contain one or more **<Set>** elements. DefaultMinVersion specifies the default MinVersion value of all child **<Set>** elements.
- A [Set](https://learn.microsoft.com/en-us/javascript/api/manifest/set) element specifies a requirement set that the Office application must support to make the add-in installable. The Name attribute specifies the name of the requirement set. The MinVersion specifies the minimum version of the requirement set. MinVersion overrides the value of the DefaultMinVersion attribute in the parent **<Sets>**.
- The **<Methods>** element can contain one or more [Method](https://learn.microsoft.com/en-us/javascript/api/manifest/method) elements. You can't use the **<Methods>** element with Outlook add-ins.
- The **<Method>** element specifies an individual method that the Office application must support to make the add-in installable. The Name attribute is required and


specifies the name of the method qualified with its parent object.

## **Design for alternate experiences**

The extensibility features that the Office Add-in platform provides can be usefully divided into three kinds:

- Extensibility features that are available immediately after the add-in is installed. You can make use of this kind of feature by configuring a [VersionOverrides](https://learn.microsoft.com/en-us/javascript/api/manifest/versionoverrides) element in the manifest. An example of this kind of feature is Add-in Commands, which are custom ribbon buttons and menus.
- Extensibility features that are available only when the add-in is running and that are implemented with Office.js JavaScript APIs; for example, Dialog Boxes.
- Extensibility features that are available only at runtime but are implemented with a combination of Office.js JavaScript and configuration in a **<VersionOverrides>** element. Examples of these are Excel custom functions, single sign-on, and custom contextual tabs.

If your add-in uses a specific extensibility feature for some of its functionality but has other useful functionality that doesn't require the extensibility feature, you should design the add-in so that it's installable on platform and Office version combinations that don't support the extensibility feature. It can provide a valuable, albeit diminished, experience on those combinations.

You implement this design differently depending on how the extensibility feature is implemented:

- For features implemented entirely with JavaScript, see Check for API availability at runtime.
- For features that require you to configure a **<VersionOverrides>** element, see Specifying requirements in a VersionOverrides element.

### **Specify requirements in a VersionOverrides element**

The [VersionOverrides](https://learn.microsoft.com/en-us/javascript/api/manifest/versionoverrides) element was added to the manifest schema primarily, but not exclusively, to support features that must be available immediately after an add-in is installed, such as add-in commands (custom ribbon buttons and menus). Office must know about these features when it parses the add-in manifest.

Suppose your add-in uses one of these features, but the add-in is valuable, and should be installable, even on Office versions that don't support the feature. In this scenario, identify the feature using a [Requirements](https://learn.microsoft.com/en-us/javascript/api/manifest/requirements) element (and its child [Sets](https://learn.microsoft.com/en-us/javascript/api/manifest/sets) and [Methods](https://learn.microsoft.com/en-us/javascript/api/manifest/methods)


elements) that you include as a child of the **<VersionOverrides>** element itself instead of as a child of the base OfficeApp element. The effect of doing this is that Office will allow the add-in to be installed, but Office will ignore certain of the child elements of the **<VersionOverrides>** element on Office versions where the feature isn't supported.

Specifically, the child elements of the **<VersionOverrides>** that override elements in the base manifest, such as a **<Hosts>** element, are ignored and the corresponding elements of the base manifest are used instead. However, there can be child elements in a **<VersionOverrides>** that actually implement additional features rather than override settings in the base manifest. Two examples are the WebApplicationInfo and EquivalentAddins . These parts of the **<VersionOverrides>** will *not* be ignored, assuming the platform and version of Office support the corresponding feature.

For information about the descendent elements of the **<Requirements>** element, see Requirements element earlier in this article.

The following is an example.

```
XML
<VersionOverrides ... >
 ...
 <Requirements>
 <Sets DefaultMinVersion="1.1">
 <Set Name="WordApi" MinVersion="1.2"/>
 </Sets>
 </Requirements>
 <Hosts>
 <!-- ALL MARKUP INSIDE THE HOSTS ELEMENT IS IGNORED WHEREVER WordApi
1.2 IS NOT SUPPORTED -->
 <Host xsi:type="Workbook">
 <!-- markup for custom add-in commands -->
 </Host>
 </Hosts>
</VersionOverrides>
```
#### 2 **Warning**

If your add-in includes **add-in commands**, use great care before including a **<Requirements>** element in a **<VersionOverrides>**. On platform and version combinations that don't support the requirement, *none* of the add-in commands will be installed, *even those that invoke functionality that doesn't need the requirement*. Consider, for example, an add-in that has two custom ribbon buttons. One of them calls Office JavaScript APIs that are available in requirement set


**ExcelApi 1.4** (and later). The other calls APIs that are only available in **ExcelApi 1.9** (and later). If you put a requirement for **ExcelApi 1.9** in the **<VersionOverrides>**, then when 1.9 isn't supported, *neither* button will appear on the ribbon. A better strategy in this scenario would be to use the technique described in **Check for API availability at runtime**. The code invoked by the second button first uses isSetSupported to check for support of **ExcelApi 1.9**. If it isn't supported, the code gives the user a message saying that this feature of the add-in isn't available on their version of Office.

#### **Tip**

There's no point to repeating a **<Requirement>** element in a **<VersionOverrides>** that already appears in the base manifest. If the requirement is specified in the base manifest, then the add-in can't install where the requirement isn't supported so Office doesn't even parse the **<VersionOverrides>** element.

### **See also**

- Office Add-ins manifest
- [Office Add-in requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/office-add-in-requirement-sets)
- [Word-Add-in-Get-Set-EditOpen-XML](https://github.com/OfficeDev/Word-Add-in-Get-Set-EditOpen-XML)


# **Understanding platform-specific requirement sets**

Article • 11/19/2024

The Office Add-ins platform allows you to build solutions that extend Office applications and interact with content in Office documents. Your solution can run in Office across several platforms, including Windows, Mac, iPad, and in a browser. We've provided requirement sets that help you declare which APIs and platforms your add-in supports. Requirement sets are named groups of API members which are usually supported on all available platforms. However, with platform-specific requirement sets, APIs are implemented and made available first in the target platforms.

Each application that supports Office Add-ins has its usual set of available platforms. For a comprehensive listing, see [Office client application and platform availability for Office](https://learn.microsoft.com/en-us/javascript/api/requirement-sets) [Add-ins](https://learn.microsoft.com/en-us/javascript/api/requirement-sets). For the purpose of this discussion, we'll focus on Excel, Outlook, PowerPoint, and Word.

Cross-platform requirement sets are available on Windows, Mac, and in a browser. Depending on the features being made available, a requirement set may also be supported on iPad or mobile platforms.

However, platform-specific requirement sets provide support for a subset of the usual platforms. For example, online-only requirement sets provide APIs that are only available when the add-in runs in a web browser. Similarly, desktop-only requirement sets provide APIs that may only be available when the add-in runs in Windows and Mac. See the specific requirement set page for actual platform support.

## **Current platform-specific requirement sets**

At present, platform-specific requirement sets are available in Excel and Word. Excel includes an online-only requirement set. Word includes online-only and desktop-only requirement sets. For the full list, see [Special requirement sets](https://learn.microsoft.com/en-us/javascript/api/overview#special-requirement-sets).

Note that in Outlook, platform-specific behavior may be found in extension points. For example, [MobileOnlineMeetingCommandSurface](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#mobileonlinemeetingcommandsurface) and

[MobileLogEventAppointmentAttendee](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint#mobilelogeventappointmentattendee) are only available to add-ins running in Outlook on Android and on iOS.

## **Why platform-specific requirement sets?**


We're providing platform-specific requirement sets for a few reasons.

- 1. **Feature availability.** Some features aren't implemented in the Office applications UI on a particular platform. As such, the API can only be made available on supported platforms. Having these types of APIs in a platform-specific requirement set means that developers can use those APIs in their add-ins. This is especially useful for cases where the feature may never be implemented in other platforms.
- 2. **Platform-specific add-ins.** Developers who have add-ins focused on a particular platform don't need to wait for those APIs to be implemented in other platforms. These developers are able to incorporate those APIs into their solutions and ship to their customers much sooner.
- 3. **Tailored experiences.** Customers can use an Office application differently depending on the platform for several reasons, like feature availability or comfort level, for example. Let's say that on the Windows version, a customer completes one set of tasks but on an iPad, they complete a different set of tasks. You can have your add-in provide a tailored experience based on your users' usual scenarios per platform.

To help you decide if platform-specific requirement sets can work for you, consider the following.

## **API promotion to cross-platform requirement set**

When APIs in a platform-specific requirement set are supported cross-platform, they're added to the next requirement set targeted for release. Even after the new requirement is made generally available, those APIs *still remain* in the platform-specific requirement set.

## **How to use a platform-specific requirement set**

The following sections describe where you can specify your minimum requirement set. For more information about these options, see Specify which Office versions and platforms can host your add-in.

### **Manifest**

When you note a requirement set in the [Set element](https://learn.microsoft.com/en-us/javascript/api/manifest/set) of your add-in manifest, you're indicating the minimum set of APIs that your add-in needs. Combined with supported 


Office host applications and other information, this determines whether or not your add-in activates in an Office client.

When you declare a platform-specific requirement set, your add-in activates only when it's run in Office on that platform. For example, if you have the WordApiDesktop 1.1 requirement set in your manifest, your add-in will only activate in Word on Windows and on Mac.

Keep in mind that in the case where the APIs become supported cross-platform, you'll need to update your add-in manifest to add a cross-platform requirement set and remove the platform-specific requirement set. If your add-in is available in AppSource or the Office store, you'll need to resubmit it for validation.

### **Code**

Another option is to implement a runtime check in your code. This way, you can make new features available to your customers on those platforms. The runtime check also ensures that the platform-specific code doesn't run on unsupported platforms and cross-platform features continue to work for your customers. The following code is an example that checks for a specific requirement set.

```
JavaScript
if (Office.context.requirements.isSetSupported("WordApiDesktop", "1.1")) {
 // Any API exclusive to this WordApiDesktop requirement set.
}
```
Whenever platform-specific APIs become available cross-platform, enable your customers on all supported platforms to use those features by implementing one of the following options.

- Remove the runtime check. But note that customers on older Office clients, especially on Windows, may hit errors if their client doesn't support the new APIs yet.
- Update the runtime code to check for the cross-platform requirement set.

A variation is to do a runtime check for a particular API. This means that the encapsulated code should run on any platforms that support that API. If the API was first released in a platform-specific requirement set then promoted to a cross-platform one, you shouldn't need to update your code unless you made assumptions about the supported platforms. The following code is an example.


```
if (Office.context.document.setSelectedDataAsync)
{
 // Run code that uses document.setSelectedDataAsync.
}
```
## **Notify customers on AppSource**

If your add-in is in AppSource or the Office store, be sure to notify customers about any platform-specific behavior.

**Details + support** > **Products supported** on your add-in's AppSource page should automatically show the appropriate supported platforms based on the requirements you declared in the manifest.

However, if your add-in is supported cross-platform but you also implemented platform-specific behaviors, you should point out those feature differences in the **Overview** section on your add-in's AppSource page.

## **Exceptions**

The following are exceptions to the approach described.

### **Online-only requirement sets**

An online-only requirement set is a superset of the latest numbered requirement set. For each Office application with an online-only requirement set, 1.1 is the only version. It's invalid to specify an online-only requirement set in the [Set element](https://learn.microsoft.com/en-us/javascript/api/manifest/set) of your add-in manifest.

To check for APIs that are only supported in these requirement sets and to prevent your add-in from trying to run the code on unsupported platforms, add code similar to the following:

```
JavaScript
if (Office.context.requirements.isSetSupported("ExcelApiOnline", "1.1")) {
 // Any API exclusive to the ExcelApiOnline requirement set.
}
```
JavaScript


```
if (Office.context.requirements.isSetSupported("WordApiOnline", "1.1")) {
 // Any API exclusive to the WordApiOnline requirement set.
}
```
When APIs in an online-only requirement set are supported cross-platform, they're added to the next released requirement set. After the new requirement set is made generally available, those APIs are *removed* from the online-only requirement set.

Follow the guidance in the earlier Code section to adjust your add-in implementation accordingly.

### **Desktop-only HiddenDocument requirement sets in Word**

It's important to note that while the HiddenDocument requirement sets in Word are desktop-only, it's invalid to specify a HiddenDocument requirement set in the [Set](https://learn.microsoft.com/en-us/javascript/api/manifest/set) [element](https://learn.microsoft.com/en-us/javascript/api/manifest/set) of your add-in manifest.

To check for APIs that are only supported in these requirement sets and to prevent your add-in from trying to run the code on unsupported platforms, add code similar to the following:

```
JavaScript
if (Office.context.requirements.isSetSupported("WordApiHiddenDocument", 
"1.5")) {
 // Any API exclusive to this WordApiHiddenDocument requirement set.
}
```
## **See also**

- Understanding the Office JavaScript API
- Office versions and requirement sets
- Specify Office applications and API requirements
- [Office client application and platform availability for Office Add-ins](https://learn.microsoft.com/en-us/javascript/api/requirement-sets)


# **Check for API availability at runtime**

Article • 02/12/2025

If your add-in uses a specific extensibility feature for some of its functionality, but has other useful functionality that doesn't require the extensibility feature, you should design the add-in so that it's installable on platform and Office version combinations that don't support the extensibility feature. It can provide a valuable, albeit diminished, experience on those combinations.

When the difference in the two experiences consists entirely of differences in the Office JavaScript Library APIs that are called, and not in any features that are configured in the manifest, then you test at runtime to discover whether the user's Office client supports an API requirement set. You can also test at runtime whether APIs that aren't in a set are supported.

#### 7 **Note**

To provide alternate experiences with features that require manifest configuration, follow the guidance in **Specify Office hosts and API requirements with the unified manifest** or **Specify Office applications and API requirements with the add-in only manifest**.

## **Check for requirement set support**

The [isSetSupported](https://learn.microsoft.com/en-us/javascript/api/office/office.requirementsetsupport#office-office-requirementsetsupport-issetsupported-member(1)) method is used to check for requirement set support. Pass the requirement set's name and the minimum version as parameters. If the requirement set is supported, isSetSupported returns true . The following code shows an example.

```
JavaScript
```

```
if (Office.context.requirements.isSetSupported("WordApi", "1.2")) {
 // Code that uses API members from the WordApi 1.2 requirement set.
} else {
 // Provide diminished experience here.
 // For example, run alternate code when the user's Word is
 // volume-licensed perpetual Word 2016 (which doesn't support WordApi
1.2).
}
```
About this code, note:


- The first parameter is required. It's a string that represents the name of the requirement set. For more information about available requirement sets, see [Office](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/office-add-in-requirement-sets) [Add-in requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/office-add-in-requirement-sets).
- The second parameter is optional. It's a string that specifies the minimum requirement set version that the Office application must support in order for the code within the if statement to run (for example, "1.9"). If not used, version "1.1" is assumed.

#### 2 **Warning**

When calling the isSetSupported method, the value of the second parameter (if specified) should be a string, not a number. The JavaScript parser can't differentiate between numeric values such as 1.1 and 1.10, whereas it can for string values such as "1.1" and "1.10".

The following table shows the requirement set names for the application-specific API models.

ノ **Expand table**

| Office application | RequirementSetName |
|--------------------|--------------------|
| Excel              | ExcelApi           |
| OneNote            | OneNoteApi         |
| Outlook            | Mailbox            |
| PowerPoint         | PowerPointApi      |
| Word               | WordApi            |

The following is an example of using the method with one of the Common API model requirement sets.

```
JavaScript
if (Office.context.requirements.isSetSupported('CustomXmlParts')) {
 // Run code that uses API members from the CustomXmlParts requirement
set.
} else {
 // Run alternate code when the user's Office application doesn't support
the CustomXmlParts requirement set.
}
```


#### 7 **Note**

The isSetSupported method and the requirement sets for these applications are available in the latest Office.js file on the CDN. If you don't use Office.js from the CDN, your add-in might generate exceptions if you are using an old version of the library in which isSetSupported is undefined. For more information, see **Use the latest Office JavaScript API library**.

### **Check for setless API support**

When your add-in depends on a method that isn't part of a requirement set, called a setless API, use a runtime check to determine whether the method is supported by the Office application, as shown in the following code example. For a complete list of methods that don't belong to a requirement set, see [Office Add-in requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/office-add-in-requirement-sets#methods-that-arent-part-of-a-requirement-set).

#### 7 **Note**

We recommend that you limit the use of this type of runtime check in your add-in's code.

The following code example checks whether the Office application supports document.setSelectedDataAsync .

#### JavaScript

```
if (Office.context.document.setSelectedDataAsync) {
 // Run code that uses `document.setSelectedDataAsync`.
}
```
### **See also**

- Office requirement sets availability
- Specify Office hosts and API requirements with the unified manifest
- Specify Office hosts and API requirements with the add-in only manifest


# **Load the DOM and runtime environment**

Article • 05/20/2023

Before running its own custom logic, an add-in must ensure that both the DOM and the Office Add-ins runtime environment are loaded.

### **Startup of a content or task pane add-in**

The following figure shows the flow of events involved in starting a content or task pane add-in in Excel, PowerPoint, Project, or Word.

The following events occur when a content or task pane add-in starts.

- 1. The user opens a document that already contains an add-in or inserts an add-in in the document.


- 2. The Office client application reads the add-in's manifest from AppSource, an app catalog on SharePoint, or the shared folder catalog it originates from.
- 3. The Office client application opens the add-in's HTML page in a webview control.

The next two steps, steps 4 and 5, occur asynchronously and in parallel. For this reason, your add-in's code must make sure that both the DOM and the add-in runtime environment have finished loading before proceeding.

- 4. The webview control loads the DOM and HTML body, and calls the event handler for the window.onload event.
- 5. The Office client application loads the runtime environment, which downloads and caches the Office JavaScript API library files from the content distribution network (CDN) server, and then calls the add-in's event handler for the [initialize](https://learn.microsoft.com/en-us/javascript/api/office#Office_initialize_reason_) event of the [Office](https://learn.microsoft.com/en-us/javascript/api/office) object, if a handler has been assigned to it. At this time it also checks to see if any callbacks (or chained then() method) have been passed (or chained) to the Office.onReady handler. For more information about the distinction between Office.initialize and Office.onReady , see Initialize your add-in.
- 6. When the DOM and HTML body finish loading and the add-in finishes initializing, the main function of the add-in can proceed.

### **Startup of an Outlook add-in**

The following figure shows the flow of events involved in starting an Outlook add-in running on the desktop, tablet, or smartphone.


The following events occur when an Outlook add-in starts.

- 1. When Outlook starts, Outlook reads the manifests for Outlook add-ins that have been installed for the user's email account.
- 2. The user selects an item in Outlook.
- 3. If the selected item satisfies the activation conditions of an Outlook add-in, Outlook activates the add-in and makes its button visible in the UI.
- 4. If the user clicks the button to start the Outlook add-in, Outlook opens the HTML page in a webview control. The next two steps, steps 5 and 6, occur in parallel.
- 5. The webview control loads the DOM and HTML body, and calls the event handler for the onload event.
- 6. Outlook loads the runtime environment, which downloads and caches the JavaScript API for JavaScript library files from the content distribution network (CDN) server, and then calls the event handler for the [initialize](https://learn.microsoft.com/en-us/javascript/api/office#Office_initialize_reason_) event of the [Office](https://learn.microsoft.com/en-us/javascript/api/office) object of the add-in, if a handler has been assigned to it. At this time it also checks


to see if any callbacks (or chained then() methods) have been passed (or chained) to the Office.onReady handler. For more information about the distinction between Office.initialize and Office.onReady , see Initialize your add-in.

- 7. When the DOM and HTML body finish loading and the add-in finishes initializing, the main function of the add-in can proceed.
### **See also**

- Understanding the Office JavaScript API
- Initialize your Office Add-in
- Runtimes in Office Add-ins

#### 6 **Collaborate with us on GitHub**

The source for this content can be found on GitHub, where you can also create and review issues and pull requests. For more information, see [our](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md) [contributor guide](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md).

#### **Office Add-ins feedback**

Office Add-ins is an open source project. Select a link to provide feedback:

[Open a documentation issue](https://github.com/OfficeDev/office-js-docs-pr/issues/new?template=3-customer-feedback.yml&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Foffice%2Fdev%2Fadd-ins%2Fdevelop%2Floading-the-dom-and-runtime-environment&pageQueryParams=&contentSourceUrl=https%3A%2F%2Fgithub.com%2FOfficeDev%2Foffice-js-docs-pr%2Fblob%2Fmain%2Fdocs%2Fdevelop%2Floading-the-dom-and-runtime-environment.md&documentVersionIndependentId=2d98dd01-b671-d532-3bcb-88d40d6ef3d1&feedback=%0A%0A%5BEnter+feedback+here%5D%0A&author=%40o365devx&metadata=*+ID%3A+af6ccc36-8ea8-af6e-8731-059ce81d8628+%0A*+Service%3A+**microsoft-365**%0A*+Sub-service%3A+**add-ins**)

[Provide product feedback](https://aka.ms/office-addins-dev-questions)


# **Initialize your Office Add-in**

Article • 08/18/2023

Office Add-ins often have start-up logic to do things such as:

- Check that the user's version of Office supports all the Office APIs that your code calls.
- Ensure the existence of certain artifacts, such as a worksheet with a specific name.
- Prompt the user to select some cells in Excel, and then insert a chart initialized with those selected values.
- Establish bindings.
- Use the Office Dialog API to prompt the user for default add-in settings values.

However, an Office Add-in can't successfully call any Office JavaScript APIs until the library has been loaded. This article describes the two ways your code can ensure that the library has been loaded.

- Initialize with Office.onReady() .
- Initialize with Office.initialize .

### **Tip**

We recommend that you use Office.onReady() instead of Office.initialize . Although Office.initialize is still supported, Office.onReady() provides more flexibility. You can assign only one handler to Office.initialize and it's called only once by the Office infrastructure. You can call Office.onReady() in different places in your code and use different callbacks.

For information about the differences in these techniques, see **Major differences between Office.initialize and Office.onReady()**.

For more details about the sequence of events when an add-in is initialized, see Loading the DOM and runtime environment.

# **Initialize with Office.onReady()**


Office.onReady() is an asynchronous function that returns a [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise) object while it checks to see if the Office.js library is loaded. When the library is loaded, it resolves the Promise as an object that specifies the Office client application with an Office.HostType enum value ( Excel , Word , etc.) and the platform with an Office.PlatformType enum value ( PC , Mac , OfficeOnline , etc.). The Promise resolves immediately if the library is already loaded when Office.onReady() is called.

One way to call Office.onReady() is to pass it a callback function. Here's an example.

JavaScript

```
Office.onReady(function(info) {
 if (info.host === Office.HostType.Excel) {
 // Do Excel-specific initialization (for example, make add-in task
pane's
 // appearance compatible with Excel "green").
 }
 if (info.platform === Office.PlatformType.PC) {
 // Make minor layout changes in the task pane.
 }
 console.log(`Office.js is now ready in ${info.host} on 
${info.platform}`);
});
```
Alternatively, you can chain a then() method to the call of Office.onReady() , instead of passing a callback. For example, the following code checks to see that the user's version of Excel supports all the APIs that the add-in might call.

```
JavaScript
Office.onReady()
 .then(function() {
 if (!Office.context.requirements.isSetSupported('ExcelApi', '1.7'))
{
 console.log("Sorry, this add-in only works with newer versions
of Excel.");
 }
 });
```
Here's the same example using the async and await keywords in TypeScript.

```
TypeScript
(async () => {
 await Office.onReady();
 if (!Office.context.requirements.isSetSupported('ExcelApi', '1.7')) {
 console.log("Sorry, this add-in only works with newer versions of
```


```
Excel.");
 }
})();
```
If you're using additional JavaScript frameworks that include their own initialization handler or tests, these should *usually* be placed within the response to Office.onReady() . For example, [JQuery's](https://jquery.com/) $(document).ready() method would be referenced as follows:

```
JavaScript
Office.onReady(function() {
 // Office is ready.
 $(document).ready(function () {
 // The document is ready.
 });
});
```
However, there are exceptions to this practice. For example, suppose you want to open your add-in in a browser (instead of sideload it in an Office application) in order to debug your UI with browser tools. In this scenario, once Office.js determines that it is running outside of an Office host application, it will call the callback and resolve the promise with null for both the host and platform.

Another exception would be if you want a progress indicator to appear in the task pane while the add-in is loading. In this scenario, your code should call the jQuery ready and use its callback to render the progress indicator. Then the Office.onReady callback can replace the progress indicator with the final UI.

# **Initialize with Office.initialize**

An initialize event fires when the Office.js library is loaded and ready for user interaction. You can assign a handler to Office.initialize that implements your initialization logic. The following is an example that checks to see that the user's version of Excel supports all the APIs that the add-in might call.

```
JavaScript
Office.initialize = function () {
 if (!Office.context.requirements.isSetSupported('ExcelApi', '1.7')) {
 console.log("Sorry, this add-in only works with newer versions of
Excel.");
 }
};
```


If you're using additional JavaScript frameworks that include their own initialization handler or tests, these should *usually* be placed within the Office.initialize event (the exceptions described in the **Initialize with Office.onReady()** section earlier apply in this case also). For example, [JQuery's](https://jquery.com/) $(document).ready() method would be referenced as follows:

```
JavaScript
Office.initialize = function () {
 // Office is ready.
 $(document).ready(function () {
 // The document is ready.
 });
 };
```
For task pane and content add-ins, Office.initialize provides an additional *reason* parameter. This parameter specifies how an add-in was added to the current document. You can use this to provide different logic for when an add-in is first inserted versus when it already existed within the document.

```
JavaScript
Office.initialize = function (reason) {
 $(document).ready(function () {
 switch (reason) {
 case 'inserted': console.log('The add-in was just inserted.');
 case 'documentOpened': console.log('The add-in is already part
of the document.');
 }
 });
 };
```
For more information, see [Office.initialize Event](https://learn.microsoft.com/en-us/javascript/api/office) and [InitializationReason Enumeration.](https://learn.microsoft.com/en-us/javascript/api/office/office.initializationreason)

## **Major differences between Office.initialize and Office.onReady**

- You can assign only one handler to Office.initialize and it's called only once by the Office infrastructure; but you can call Office.onReady() in different places in your code and use different callbacks. For example, your code could call Office.onReady() as soon as your custom script loads with a callback that runs initialization logic; and your code could also have a button in the task pane, whose


script calls Office.onReady() with a different callback. If so, the second callback runs when the button is clicked.

- The Office.initialize event fires at the end of the internal process in which Office.js initializes itself. And it fires *immediately* after the internal process ends. If the code in which you assign a handler to the event executes too long after the event fires, then your handler doesn't run. For example, if you are using the WebPack task manager, it might configure the add-in's home page to load polyfill files after it loads Office.js but before it loads your custom JavaScript. By the time your script loads and assigns the handler, the initialize event has already happened. But it's never "too late" to call Office.onReady() . If the initialize event has already happened, the callback runs immediately.
#### 7 **Note**

Even if you have no start-up logic, you should either call Office.onReady() or assign an empty function to Office.initialize when your add-in JavaScript loads. Some Office application and platform combinations won't load the task pane until one of these happens. The following examples show these two approaches.

JavaScript

Office.onReady();

JavaScript

```
Office.initialize = function () {};
```
## **Debug initialization**

For information about debugging the Office.initialize and Office.onReady() functions, see Debug the initialize and onReady functions.

## **See also**

- Understanding the Office JavaScript API
- Loading the DOM and runtime environment


# **Automatically open a task pane with a document**

Article • 02/12/2025

You can use add-in commands in your Office Add-in to extend the Office UI by adding buttons to the Office app ribbon. When users click your command button, an action occurs, such as opening a task pane.

Some scenarios require that a task pane open automatically when a document opens, without explicit user interaction. You can use the autoopen task pane feature, introduced in the [AddInCommands 1.1 requirement set,](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/add-in-commands-requirement-sets) to automatically open a task pane when your scenario requires it.

#### 7 **Note**

To configure a task pane to open immediately when the add-in is installed, but not necessarily whenever the document is opened later, see **Automatically open a task pane when an add-in is installed**.

## **How is the autoopen feature different from inserting a task pane?**

When a user launches add-ins that don't use add-in commands, the add-ins are inserted into the document, and persist in that document. As a result, when other users open the document, they're prompted to install the add-in, and the task pane opens. The challenge with this model is that in many cases, users don't want the add-in to persist in the document. For example, a student who uses a dictionary add-in in a Word document might not want their classmates or teachers to be prompted to install that add-in when they open the document.

With the autoopen feature, you can explicitly define or allow the user to define whether a specific task pane add-in persists in a specific document.

### **Support and availability**

The autoopen feature is currently supported in the following products and platforms.


| Products   | Platforms                                                                                                        |
|------------|------------------------------------------------------------------------------------------------------------------|
| Word       | Supported platforms for all supported products:                                                                  |
| Excel      | Office on the web                                                                                                |
| PowerPoint | Office on Windows (Version 1705 (Build 8121.1000) or later)<br>Office on Mac (Version 15.34 (17051500) or later) |

### **Best practices**

Apply the following best practices when you use the autoopen feature.

- Use the autoopen feature when it will help make your add-in users more efficient, such as:
	- When the document needs the add-in in order to function properly. For example, a spreadsheet that includes stock values that are periodically refreshed by an add-in. The add-in should open automatically when the spreadsheet is opened to keep the values up to date.
	- When the user will most likely always use the add-in with a particular document. For example, an add-in that helps users fill in or change data in a document by pulling information from a backend system.
- Allow users to turn on or turn off the autoopen feature. Include an option in your UI for users to choose to no longer automatically open the add-in task pane.
- Use requirement set detection to determine whether the autoopen feature is available, and provide a fallback behavior if it isn't.
- Don't use the autoopen feature to artificially increase usage of your add-in. If it doesn't make sense for your add-in to open automatically with certain documents, this feature can annoy users.

#### 7 **Note**

If Microsoft detects abuse of the autoopen feature, your add-in might be rejected from AppSource.

- Don't use this feature to pin multiple task panes. You can only set one pane of your add-in to open automatically with a document.


### **Implement the autoopen feature**

- Specify the task pane to be opened automatically.
- Tag the document to automatically open the task pane.

#### ) **Important**

The pane that you designate to open automatically will only open if the add-in is already installed on the user's device. If the user does not have the add-in installed when they open a document, the autoopen feature will not work and the setting will be ignored. If you also require the add-in to be distributed with the document you need to set the visibility property to 1; this can only be done using OpenXML, an example is provided later in this article.

### **Step 1: Specify the task pane to open**

Configure the manifest to specify the task pane page that should open automatically. The process depends on what type of manifest the add-in uses.

Unified manifest for Microsoft 365

#### 7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word addins.

To specify the task pane to open automatically, find the runtime object in the "runtimes" array whose "code.page" property is set to the URL of the page that you want to open automatically. Ensure that the "actions" array in this same runtime object has at least one action whose "type" value is "openPage". Add a "view" property to this action object and set it to

"Office.AutoShowTaskpaneWithDocument". You can only set this value on one action object and it must be an action of type "openPage". If you set this value on multiple actions, the first occurrence of the value will be recognized and the others will be ignored.

The following example shows a "view" value set to "Office.AutoShowTaskpaneWithDocument".


```
JSON
"runtimes": [
 {
 ...
 "code": {
 "page": "https://contoso.com/taskpane.html"
 },
 "actions": [
 {
 "id": "ShowTaskPane",
 "type": "openPage",
 "view": "Office.AutoShowTaskpaneWithDocument"
 }
 ]
 }
]
```
### **Step 2: Tag the document to automatically open the task pane**

You can tag the document to trigger the autoopen feature in one of two ways. Pick the alternative that works best for your scenario.

### **Tag the document on the client side**

Use the Office.js [settings.set](https://learn.microsoft.com/en-us/javascript/api/office/office.settings) method to set **Office.AutoShowTaskpaneWithDocument** to true , as shown in the following example.

```
JavaScript
Office.context.document.settings.set("Office.AutoShowTaskpaneWithDocument", 
true);
Office.context.document.settings.saveAsync();
```
Use this method if you need to tag the document as part of your add-in interaction (for example, as soon as the user creates a binding, or chooses an option to indicate that they want the pane to open automatically).

### **Use Open XML to tag the document**

You can use Open XML to create or modify a document and add the appropriate Open Office XML markup to trigger the autoopen feature. For a sample that shows you how to do this, see [Office-OOXML-EmbedAddin](https://github.com/OfficeDev/Office-OOXML-EmbedAddin) .


Add two Open XML parts to the document.

- A webextension part
- A taskpane part

The following example shows how to add the webextension part.

```
XML
<we:webextension
xmlns:we="http://schemas.microsoft.com/office/webextensions/webextension/201
0/11" id="[ADD-IN ID PER MANIFEST]">
 <we:reference id="[GUID or AppSource asset ID]" version="[your add-in
version]" store="[Pointer to store or catalog]" storeType="[Store or catalog
type]"/>
 <we:alternateReferences/>
 <we:properties>
 <we:property name="Office.AutoShowTaskpaneWithDocument" value="true"/>
 </we:properties>
 <we:bindings/>
 <we:snapshot
xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships
"/>
</we:webextension>
```
The webextension part includes a property bag and a property named

**Office.AutoShowTaskpaneWithDocument** that must be set to true .

The webextension part also includes a reference to the store or catalog with attributes for id , storeType , store , and version . Of the storeType values, only four are relevant to the autoopen feature. The values for the other three attributes depend on the value for storeType , as shown in the following table.

ノ **Expand table**

| storeType<br>value  | id value                                                     | store value                                       | version<br>value                                             |
|---------------------|--------------------------------------------------------------|---------------------------------------------------|--------------------------------------------------------------|
| OMEX<br>(AppSource) | The<br>AppSource<br>asset ID of<br>the add-in<br>(see Note). | The locale of AppSource; for example, "en<br>us". | The version in<br>the<br>AppSource<br>catalog (see<br>Note). |


| storeType<br>value                                      | id value                                                     | store value                                                                                                                                                                    | version<br>value                          |
|---------------------------------------------------------|--------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
| WOPICatalog<br>(partner WOPI<br>hosts)                  | The<br>AppSource<br>asset ID of<br>the add-in<br>(see Note). | "wopicatalog". Use this value for add-ins that<br>are published in App Source and are installed<br>in WOPI hosts. For more information, see<br>Integrating with Office Online. | The version in<br>the add-in<br>manifest. |
| FileSystem (a<br>network share)                         | The GUID of<br>the add-in in<br>the add-in<br>manifest.      | The path of the network share; for example,<br>"\\MyComputer\MySharedFolder".                                                                                                  | The version in<br>the add-in<br>manifest. |
| EXCatalog<br>(deployment via<br>the Exchange<br>server) | The GUID of<br>the add-in in<br>the add-in<br>manifest.      | "EXCatalog". EXCatalog row is the row to use<br>with add-ins that use Centralized<br>Deployment in the Microsoft 365 admin<br>center.                                          | The version in<br>the add-in<br>manifest. |
| Registry (System<br>registry)                           | The GUID of<br>the add-in in<br>the add-in<br>manifest.      | "developer"                                                                                                                                                                    | The version in<br>the add-in<br>manifest. |

#### 7 **Note**

To find the asset ID and version of an add-in in AppSource, go to the AppSource landing page for the add-in. The asset ID appears in the address bar in the browser. The version is listed in the **Details** section of the page.

For more information about the webextension markup, see [\[MS-OWEXML\] 2.2.5.](https://learn.microsoft.com/en-us/openspecs/office_standards/ms-owexml/d4081e0b-5711-45de-b708-1dfa1b943ad1) [WebExtensionReference](https://learn.microsoft.com/en-us/openspecs/office_standards/ms-owexml/d4081e0b-5711-45de-b708-1dfa1b943ad1).

The following example shows how to add the taskpane part.

```
XML
<wetp:taskpane dockstate="right" visibility="0" width="350" row="4"
xmlns:wetp="http://schemas.microsoft.com/office/webextensions/taskpanes/2010
/11">
 <wetp:webextensionref
xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships
" r:id="rId1" />
</wetp:taskpane>
```


Note that in this example, the visibility attribute is set to "0". This means that after the webextension and taskpane parts are added, the first time the document is opened, the user has to install the add-in from the **Add-in** button on the ribbon. Thereafter, the add-in task pane opens automatically when the file is opened. Also, when you set visibility to "0", you can use Office.js to enable users to turn on or turn off the autoopen feature. Specifically, your script sets the

**Office.AutoShowTaskpaneWithDocument** document setting to true or false . (For details, see Tag the document on the client side.)

If visibility is set to "1", the task pane opens automatically the first time the document is opened. The user is prompted to trust the add-in, and when trust is granted, the add-in opens. Thereafter, the add-in task pane opens automatically when the file is opened. However, when visibility is set to "1", you can't use Office.js to enable users to turn on or turn off the autoopen feature.

Setting visibility to "1" is a good choice when the add-in and the template or content of the document are so closely integrated that the user would not opt out of the autoopen feature.

#### 7 **Note**

If you want to distribute your add-in with the document, so that users are prompted to install it, you must set the visibility property to 1. You can only do this via Open XML.

An easy way to write the XML is to first run your add-in and tag the document on the client side to write the value, and then save the document and inspect the XML that is generated.Office will detect and provide the appropriate attribute values. You can also use the [Open XML SDK Productivity Tool](https://www.nuget.org/packages/Open-XML-SDK) to generate C# code to programmatically add the markup based on the XML you generate.

### **Test and verify opening task panes**

You can deploy a test version of your add-in that will automatically open a task pane using Centralized Deployment via the Microsoft 365 admin center. The following example shows how add-ins are inserted from the Centralized Deployment catalog using the EXCatalog store version.


```
<we:webextension
xmlns:we="http://schemas.microsoft.com/office/webextensions/webextension/201
0/11" id="{52811C31-4593-43B8-A697-EB873422D156}">
 <we:reference id="af8fa5ba-4010-4bcc-9e03-a91ddadf6dd3"
version="1.0.0.0" store="EXCatalog" storeType="EXCatalog"/>
 <we:alternateReferences/>
 <we:properties/>
 <we:bindings/>
 <we:snapshot
xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships
"/>
</we:webextension>
```
You can test the previous example by using your Microsoft 365 subscription to try out Centralized Deployment and verify that your add-in works as expected. If you don't already have a Microsoft 365 subscription, you might qualify for a Microsoft 365 E5 developer subscription through the [Microsoft 365 Developer Program](https://aka.ms/m365devprogram) ; for details, see the [FAQ.](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-) Alternatively, you can [sign up for a 1-month free trial](https://www.microsoft.com/microsoft-365/try) or [purchase a](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g) [Microsoft 365 plan](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g) .

## **See also**

- For a sample that shows you how to use the autoopen feature, see [Auto-open a](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/office-add-in-commands/auto-open-task-pane) [task pane with a document](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/office-add-in-commands/auto-open-task-pane) .
- Automatically open a task pane when an add-in is installed
- [Learn about the Microsoft 365 Developer Program](https://aka.ms/m365devprogram)


# **Automatically open a task pane when an add-in is installed**

Article • 02/12/2025

You can configure your add-in's task pane to launch immediately after it's installed. This feature increases usage.

By default, task pane add-ins that do *not* include any add-in commands open the task pane immediately upon installation. However, when an add-in has one or more add-in commands, then the user is notified of new add-in, but the add-in doesn't launch automatically. This historic default behavior is changing so add-ins that do have add-in commands will launch automatically in some situations. In addition, if the add-in has more than one task pane page, it's possible for you to control whether the add-in launches upon installation and, if so, which page opens in the task pane.

#### 7 **Note**

- This feature applies only to add-ins installed by an end-user, not to centrally deployed add-ins.
- This feature doesn't apply to Content add-ins or Mail (Outlook) add-ins.
- This feature applies only to add-ins that have at least one add-in command of **the type "task pane command"**.

### **New behavior**

The new behavior is as follows:

- If the add-in has just one task pane command, then the add-in's ribbon tab is selected and the task pane opens automatically upon installation. You don't need to configure anything.
- If the add-in has multiple task pane commands, and one is configured to be the default (see Configure default task pane), then the add-in's ribbon tab is selected and the default task pane opens automatically upon installation.
- If the add-in has multiple task pane commands, but none is configured to be the default, then the add-in's ribbon tab is selected automatically upon installation and a callout appears near it notifying the user of the new add-in, but no task pane is opened. This is the same as the historic default behavior.


#### 7 **Note**

If for any reason, the add-in command that launches the task pane cannot be manually selected by a user at start up, such as when it's **configured to be disabled** at start up, then it won't be automatically opened regardless of configuration.

### **Configure default task pane in the manifest**

The process for specifying the default task pane depends on the type of manifest the add-in uses.

Unified manifest for Microsoft 365

#### 7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word addins.

To specify the default task pane, find the runtime object in the "runtimes" array whose "code.page" property is set to the URL of the page that you want to be the default. Ensure that the "actions" array in this same runtime object has at least one action whose "type" value is "openPage". Add a "view" property to this action object and set it to "Office.AutoShowTaskpaneWithDocument". You can only set this value on one action object and it must be an action of type "openPage". If you set this value on multiple actions, the first occurrence of the value will be recognized as the default and the others will be ignored.

The following example shows a "view" value set to "Office.AutoShowTaskpaneWithDocument".

```
JSON
"runtimes": [
 {
 ...
 "code": {
 "page": "https://contoso.com/taskpane.html"
 },
 "actions": [
 {
 "id": "ShowTaskPane",
```


```
 "type": "openPage",
 "view": "Office.AutoShowTaskpaneWithDocument"
 }
 ]
 }
]
```
#### **Tip**

If you want your add-in to automatically launch whenever the user reopens the document, you need to take further configuration steps. For details and advice about when to use this feature, see **Automatically open a task pane with a document**.

### **See also**

- Automatically open a task pane with a document


# **Configure your Office Add-in to use a shared runtime**

Article • 03/12/2025

#### ) **Important**

The shared runtime is only supported in some Office applications. For more information, see **[Shared runtime requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/shared-runtime-requirement-sets)**.

You can configure your Office Add-in to run all of its code in a single shared runtime. With a shared runtime, you'll have better coordination across your add-in and access to the DOM and CORS from all parts of your add-in. You'll also have access to additional features, such as running code when the document opens or activating ribbon buttons in certain contexts. To configure your add-in to use a shared runtime, follow the instructions in this article.

### **Create the add-in project**

If you're starting a new project, use the Yeoman generator for Office Add-ins to create an Excel, PowerPoint, or Word add-in project.

#### **Tip**

If you're using the Yeoman generator to create custom functions in Excel, select the following options:

- **Project type**: Excel Custom Functions using a Shared Runtime
- **Script type**: JavaScript

If your add-in uses an add-in only manifest, you can also use the steps in this article to update a Visual Studio project to use the shared runtime. However, you may need to update the XML schemas for the manifest. For more information, see Troubleshoot development errors with Office Add-ins.

## **Configure the manifest**


Follow these steps to configure a new or existing project to use a shared runtime. These steps assume you have generated your project using the Yeoman generator for Office Add-ins. Select the tab for the type of manifest your add-in is using.

Unified manifest for Microsoft 365

#### 7 **Note**

Implementing a shared runtime with the unified manifest for Microsoft 365 is in public developer preview. This shouldn't be used in production add-ins. We invite you to try it out in test or development environments. For more information, see the **[Public developer preview app manifest schema](https://learn.microsoft.com/en-us/microsoftteams/platform/resources/schema/manifest-schema-dev-preview)**.

- 1. Open your add-in project in Visual Studio Code.
- 2. Open the **manifest.json** file.
- 3. Add the following object to the "extensions.runtimes" array. Note the following about this markup.
	- The [SharedRuntime 1.1 requirement set](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/shared-runtime-requirement-sets#sharedruntime-api-11) is specified in the "requirements.capabilities" object. This configures your add-in to run in a shared runtime on supported clients. For a list of clients that support the SharedRuntime 1.1 requirement set, see [Shared runtime requirement](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/shared-runtime-requirement-sets) [sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/shared-runtime-requirement-sets).
	- The "id" of the runtime is set to the descriptive name "SharedRuntime".
	- The "lifetime" property is set to "long", so that your add-in can take advantage of features, such as starting your add-in when the document opens, continuing to run code after the task pane is closed, or using CORS and DOM from custom functions. If you set the property to "short" in this example, your add-in will start when one of your ribbon buttons is pressed, but it may shut down after your ribbon handler is done running. Similarly, your add-in will start when the task pane is opened, but it may shut down when the task pane is closed.

#### JSON

```
"runtimes": [
 "requirements": {
 "capabilities": [
 {
 "name": "SharedRuntime",
 "minVersion": "1.1"
```


```
4. Save your changes.
    }
    ]
    },
    "id": "SharedRuntime",
    "type": "general",
    "code": {
    "page": "https://localhost:3000/taskpane.html"
    },
    "lifetime": "long",
    "actions": [
    ...
    ]
   ]
```
### **Configure the webpack.config.js file**

The **webpack.config.js** will build multiple runtime loaders. You need to modify it to load only the shared runtime via the **taskpane.html** file.

- 1. Start Visual Studio Code and open the add-in project you generated.
- 2. Open the **webpack.config.js** file.

JavaScript

- 3. If your **webpack.config.js** file has the following **functions.html** plugin code, remove it.

```
JavaScript
new HtmlWebpackPlugin({
 filename: "functions.html",
 template: "./src/functions/functions.html",
 chunks: ["polyfill", "functions"]
 })
```
- 4. If your **webpack.config.js** file has the following **commands.html** plugin code, remove it.

```
new HtmlWebpackPlugin({
 filename: "commands.html",
 template: "./src/commands/commands.html",
 chunks: ["polyfill", "commands"]
 })
```


- 5. If your project used either the **functions** or **commands** chunks, add them to the chunks list as shown next (the following code is for if your project used both chunks).

```
JavaScript
 new HtmlWebpackPlugin({
 filename: "taskpane.html",
 template: "./src/taskpane/taskpane.html",
 chunks: ["polyfill", "taskpane", "commands", "functions"]
 })
```
- 6. Save your changes and rebuild the project.
command line

npm run build

#### 7 **Note**

If your project has a **functions.html** file or **commands.html** file, they can be removed. The **taskpane.html** will load the **functions.js** and **commands.js** code into the shared runtime via the webpack updates you just made.

## **Test your Office Add-in changes**

Confirm that you're using the shared runtime correctly by using the following instructions.

- 1. Open the **taskpane.js** file.
- 2. Replace the entire contents of the file with the following code. This will display a count of how many times the task pane has been opened. Adding the onVisibilityModeChanged event is only supported in a shared runtime.

```
JavaScript
/*global document, Office*/
let _count = 0;
Office.onReady(() => {
 document.getElementById("sideload-msg").style.display = "none";
 document.getElementById("app-body").style.display = "flex";
```


```
 updateCount(); // Update count on first open.
 Office.addin.onVisibilityModeChanged((args) => {
 if (args.visibilityMode === Office.VisibilityMode.taskpane) {
 updateCount(); // Update count on subsequent opens.
 }
 });
});
function updateCount() {
 _count++;
 document.getElementById("run").textContent = "Task pane opened " +
_count + " times.";
}
```
- 3. Save your changes and run the project.

```
command line
npm start
```
Each time you open the task pane, the count of how many times it has been opened will be incremented. The value of **_count** won't be lost because the shared runtime keeps your code running even when the task pane is closed.

When you're ready to stop the dev server and uninstall the add-in, run the following command.

## **About the shared runtime**

On Windows or on Mac, your add-in will run code for ribbon buttons, custom functions, and the task pane in separate runtime environments. This creates limitations, such as not being able to easily share global data, and not being able to access all CORS functionality from a custom function.

However, you can configure your Office Add-in to share code in the same runtime (also referred to as a shared runtime). This enables better coordination across your add-in and access to the task pane DOM and CORS from all parts of your add-in.

Configuring a shared runtime enables the following scenarios.


- Your Office Add-in can use additional UI features.
	- Change the availability of add-in commands
	- Run code in your Office Add-in when the document opens
	- Show or hide the task pane of your Office Add-in
	- Add custom keyboard shortcuts to your Office Add-ins (supported in Excel and Word add-ins only)
- The following are available for Excel add-ins only.
	- Create custom contextual tabs in Office Add-ins
	- Custom functions will have full CORS support.
	- Custom functions can call Office.js APIs to read spreadsheet document data.

For Office on Windows, the shared runtime uses WebView2 (Microsoft Edge Chromiumbased) if the conditions for using it are met as explained in Browsers and webview controls used by Office Add-ins. Otherwise, it uses Trident (Internet Explorer 11). Additionally, any buttons that your add-in displays on the ribbon will run in the same shared runtime. The following image shows how custom functions, the ribbon UI, and the task pane code will all run in the same runtime.

| button<br>button       | Ribbon    |                   |
|------------------------|-----------|-------------------|
| <br>Custom<br>function | Task pane | :<br>browser<br>: |

### **Multiple task panes**

Don't design your add-in to use multiple task panes if you are planning to use a shared runtime. A shared runtime only supports the use of one task pane. Note that any task pane without a <TaskpaneID> is considered a different task pane.

## **See also**


- Call Excel APIs from a custom function
- Add custom keyboard shortcuts to your Office Add-ins
- Create custom contextual tabs in Office Add-ins
- Change the availability of add-in commands
- Run code in your Office Add-in when the document opens
- Show or hide the task pane of your Office Add-in
- Tutorial: Share data and events between Excel custom functions and the task pane
- Runtimes in Office Add-ins


## **Activate add-ins with events**

08/01/2025

Event-based activation automatically triggers your add-in to complete their tasks without explicitly launching it. This allows the add-in to validate, insert, or refresh critical content without any manual operations. The add-in is opened in the background to avoid disrupting the user. You can also integrate event-based activation with the task pane and function commands.

### **Overview**

While the particular steps to add event-based functionality to your add-in vary by platform and manifest type, the general flow is as follows.

- 1. Update the manifest with an extension for the event.
- 2. Connect the event in the manifest with a JavaScript function to handle the event.
- 3. Have the event handler function perform its actions, then call event.completed when it finishes.
- 4. Call [Office.actions.associate](https://learn.microsoft.com/en-us/javascript/api/office/office.actions#office-office-actions-associate-member(1)) to connect the event handler function with the ID specified in the manifest.

### **Try out event-based activation**

Discover how to streamline workflows and improve user experiences with event-based activation. Try out the samples to see the feature in action.

### **Outlook samples**

- Automatically set the subject of a new message or appointment
- Automatically check for an attachment before a message is sent
- Automatically update your signature when switching between mail accounts
- [Encrypt attachments, process meeting request attendees, and react to appointment date/time changes](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-encrypt-attachments) [using Outlook event-based activation](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-encrypt-attachments)
- [Set your signature using Outlook event-based activation](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-set-signature)
- [Identify and tag external recipients using Outlook event-based activation](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-tag-external)
- [Verify the color categories of a message or appointment before it's sent using Smart Alerts](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-check-item-categories)
- [Verify the sensitivity label of a message](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-verify-sensitivity-label)

### **Word samples**

- Add headers when a document opens
### **Supported events**

The following tables list events that are currently available and the supported clients for each event. When an event is raised, the handler receives an event object which may include details specific to the type of event. The **Description** column includes a link to the related object where applicable.


### **Excel, PowerPoint, Word events**

ノ **Expand table**

| Event canonical name<br>and add-in only<br>manifest name | Unified manifest for<br>Microsoft 365 name | Description                                                                                        | Supported clients and<br>channels                                                                       |
|----------------------------------------------------------|--------------------------------------------|----------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------|
| OnDocumentOpened                                         | Not yet supported                          | Occurs when a user opens a document or<br>creates a new document, spreadsheet, or<br>presentation. | Windows (Build >=<br>16.0.18324.20032)<br>Office on the web<br>Office on Mac will be<br>available later |

#### **Outlook events**

Support for this feature in Outlook was introduced in [requirement set 1.10](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.10/outlook-requirement-set-1.10), with additional events now available in subsequent requirement sets. The following table lists each event's minimum requirement set and the clients and platforms that support it. For more information on Outlook clients and the requirement sets they support, see [Requirement sets supported by Exchange servers and Outlook clients](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets#requirement-sets-supported-by-exchange-servers-and-outlook-clients).

|                                                       |                                            |                                                                                                                        | ノ Expand table                                                                                                              |
|-------------------------------------------------------|--------------------------------------------|------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|
| Event canonical name<br>and add-in only manifest name | Unified manifest for Microsoft<br>365 name | Description                                                                                                            | Minimum<br>requirement<br>set and<br>supported<br>clients                                                                   |
| OnNewMessageCompose                                   | newMessageComposeCreated                   | On composing a new message<br>(includes reply, reply all, and<br>forward) but not on editing, for<br>example, a draft. | 1.10<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI<br>2<br>Android<br>3<br>2 3<br>iOS |
| OnNewAppointmentOrganizer                             | newAppointmentOrganizerCreated             | On creating a new appointment but<br>not on editing an existing one.                                                   | 1.10<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI                                    |


| Event canonical name<br>and add-in only manifest name | Unified manifest for Microsoft<br>365 name | Description                                                                                                                        | Minimum<br>requirement<br>set and<br>supported<br>clients                                                                   |
|-------------------------------------------------------|--------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------|
| OnMessageAttachmentsChanged                           | messageAttachmentsChanged                  | On adding or removing attachments<br>while composing a message.<br>Event-specific data object:<br>AttachmentsChangedEventArgs      | 1.11<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI                                    |
| OnAppointmentAttachmentsChanged                       | appointmentAttachmentsChanged              | On adding or removing attachments<br>while composing an appointment.<br>Event-specific data object:<br>AttachmentsChangedEventArgs | 1.11<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI                                    |
| OnMessageRecipientsChanged                            | messageRecipientsChanged                   | On adding or removing recipients<br>while composing a message.<br>Event-specific data object:<br>RecipientsChangedEventArgs        | 1.11<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI<br>2<br>Android<br>3<br>2 3<br>iOS |
| OnAppointmentAttendeesChanged                         | appointmentAttendeesChanged                | On adding or removing attendees<br>while composing an appointment.<br>Event-specific data object:<br>RecipientsChangedEventArgs    | 1.11<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI                                    |
| OnAppointmentTimeChanged                              | appointmentTimeChanged                     | On changing date/time while<br>composing an appointment.<br>Event-specific data object:                                            | 1.11<br>Web<br>browser                                                                                                      |


| Event canonical name<br>and add-in only manifest name | Unified manifest for Microsoft<br>365 name | Description                                                                                                                                                                                                                                                                     | Minimum<br>requirement<br>set and<br>supported<br>clients                                |
|-------------------------------------------------------|--------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|
|                                                       |                                            | AppointmentTimeChangedEventArgs<br>Important: If you drag and drop an<br>appointment to a different date/time<br>slot on the calendar, the<br>OnAppointmentTimeChanged event<br>doesn't occur. It only occurs when<br>the date/time is directly changed<br>from an appointment. | Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI                           |
| OnAppointmentRecurrenceChanged                        | appointmentRecurrenceChanged               | On adding, changing, or removing<br>the recurrence details while<br>composing an appointment. If the<br>date/time is changed, the<br>OnAppointmentTimeChanged event also<br>occurs.<br>Event-specific data object:<br>RecurrenceChangedEventArgs                                | 1.11<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI |
| OnInfoBarDismissClicked                               | infoBarDismissClicked                      | On dismissing a notification while<br>composing a message or<br>appointment item. Only the add-in<br>that added the notification will be<br>notified.<br>Event-specific data object:<br>InfobarClickedEventArgs                                                                 | 1.11<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI |
| OnMessageSend                                         | messageSending                             | On sending a message item. To learn<br>more, try the Smart Alerts<br>walkthrough.                                                                                                                                                                                               | 1.12<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI |
| OnAppointmentSend                                     | appointmentSending                         | On sending an appointment item. To<br>learn more, see Handle<br>OnMessageSend and<br>OnAppointmentSend events in your<br>Outlook add-in with Smart Alerts.                                                                                                                      | 1.12<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )                       |


| Event canonical name<br>and add-in only manifest name | Unified manifest for Microsoft<br>365 name | Description                                                                                                                                                                                           | Minimum<br>requirement<br>set and<br>supported<br>clients                                                                             |
|-------------------------------------------------------|--------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------|
|                                                       |                                            |                                                                                                                                                                                                       | New<br>2<br>Mac UI                                                                                                                    |
| OnMessageCompose                                      | messageComposeOpened                       | On composing a new message<br>(includes reply, reply all, and<br>forward) or editing a draft.                                                                                                         | 1.12<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI                                              |
| OnAppointmentOrganizer                                | appointmentOrganizerOpened                 | On creating a new appointment or<br>editing an existing one.                                                                                                                                          | 1.12<br>Web<br>browser<br>Windows<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI                                              |
| OnMessageFromChanged                                  | messageFromChanged                         | On changing the mail account in the<br>From field of a message being<br>composed. To learn more, see<br>Automatically update your signature<br>when switching between Exchange<br>accounts.           | 1.13<br>Web<br>4<br>browser<br>Windows<br>4<br>(new<br>and<br>1<br>classic )<br>New<br>2<br>Mac UI<br>2<br>Android<br>3<br>2 3<br>iOS |
| OnAppointmentFromChanged                              | appointmentFromChanged                     | On changing the mail account in the<br>organizer field of an appointment<br>being composed. To learn more, see<br>Automatically update your signature<br>when switching between Exchange<br>accounts. | 1.13<br>New<br>2<br>Mac UI                                                                                                            |
| OnSensitivityLabelChanged                             | sensitivityLabelChanged                    | On changing the sensitivity label<br>while composing a message or<br>appointment. To learn how to<br>manage the sensitivity label of a mail<br>item, see Manage the sensitivity                       | 1.13<br>Web<br>4<br>browser<br>Windows<br>4<br>(new                                                                                   |


| Event canonical name<br>and add-in only manifest name | Unified manifest for Microsoft<br>365 name | Description                                                                            | Minimum<br>requirement<br>set and<br>supported<br>clients |
|-------------------------------------------------------|--------------------------------------------|----------------------------------------------------------------------------------------|-----------------------------------------------------------|
|                                                       |                                            | label of your message or<br>appointment in compose mode.                               | and<br>1<br>classic )<br>New                              |
|                                                       |                                            | Event-specific data object:<br>SensitivityLabelChangedEventArgs                        | 2<br>Mac UI                                               |
| OnMessageReadWithCustomAttachment                     | Not available                              | On opening a message that contains<br>a specific attachment type in read<br>mode.      | 5<br>Preview<br>Windows<br>1<br>(classic )                |
| OnMessageReadWithCustomHeader                         | Not available                              | On opening a message that contains<br>a specific internet header name in<br>read mode. | 5<br>Preview<br>Windows<br>1<br>(classic )                |

#### 7 **Note**

 Event-based add-ins in classic Outlook on Windows require a minimum of Windows 10 Version 1903 (Build 18362) or Windows Server 2019 Version 1903 to run. 1

 Add-ins that use the unified manifest for Microsoft 365 aren't directly supported in Outlook on Mac and on mobile devices. To run this type of add-in on Mac and on mobile platforms, the add-in must first be published to **[AppSource](https://appsource.microsoft.com/)** then deployed in the **Microsoft 365 Admin Center**. For more information, see the "Client and platform support" section of **Office Add-ins with the unified app manifest for Microsoft 365**. 2

 For more information, see **Implement event-based activation in Outlook mobile add-ins**. 3

 The OnMessageFromChanged and OnSensitivityLabelChanged events aren't currently available with the unified manifest for Microsoft 365 in Outlook on the web and the new Outlook on Windows. To handle these events, implement an add-in only manifest instead. For information about the types of manifests, see **Office Add-ins manifest**. 4

 To preview the OnMessageReadWithCustomAttachment and OnMessageReadWithCustomHeader events, you must install classic Outlook on Windows Version 2312 (Build 17110.10000) or later. Then, join the **[Microsoft 365](https://techcommunity.microsoft.com/blog/microsoft365insiderblog/join-the-microsoft-365-insider-program-on-windows/4206638) [Insider program](https://techcommunity.microsoft.com/blog/microsoft365insiderblog/join-the-microsoft-365-insider-program-on-windows/4206638)** and select the **Beta Channel** option to access Office beta builds. 5

#### **Event-based activation in Outlook on mobile devices**

Outlook on mobile supports APIs up to Mailbox requirement set 1.5. However, support is now enabled for additional APIs and features introduced in later requirement sets, such as the OnNewMessageCompose event. To learn more, see Implement event-based activation in Outlook mobile add-ins.

### **Behavior and limitations**


As you develop an event-based add-in, be mindful of the following feature behaviors and limitations.

- Event-based add-ins work only when deployed by an administrator. If users install them directly from AppSource or the Office Store, they will not automatically launch (for workarounds to the AppSource limitation, see AppSource listing options for your event-based add-in). Admin deployments are done by uploading the manifest to the Microsoft 365 admin center.
- APIs that interact with the UI or display UI elements are not supported for Word, PowerPoint, and Excel on Windows. This is because the event handler runs in a JavaScript-only runtime. For more information, see Runtimes in Office Add-ins.
- Event-based add-ins require an internet connection to be able to launch when a specific event occurs. Addin event handlers are expected to be short-running, lightweight, and as noninvasive as possible. After activation, your add-in will time out within approximately 300 seconds, the maximum length of time allowed for running event-based add-ins. To signal that your add-in has completed processing a launch event, your associated event handler must call the [event.completed](https://learn.microsoft.com/en-us/javascript/api/outlook/office.mailboxevent#outlook-office-mailboxevent-completed-member(1)) method. (Note that code included after the event.completed statement isn't guaranteed to run.) Each time an event that your add-in handles is triggered, the add-in is reactivated and runs the associated event handler, and the timeout window is reset. The add-in ends after it times out, or the user closes the compose window or sends the item.
- The behavior of multiple add-ins that subscribe to the same event isn't deterministic. Outlook launches the add-ins in no particular order. For Excel, PowerPoint, and Word, only one random add-in will be activated. For example, if multiple Word add-ins that handle OnDocumentOpened , only one of those handlers will run.
- Currently, only five event-based add-ins can be actively running.
- In all supported Outlook clients, the user must remain on the current mail item where the add-in was activated for it to complete running. Navigating away from the current item (for example, switching to another compose window or tab) terminates the add-in operation. However, an add-in that activates on the OnMessageSend event handles item switching differently depending on which Outlook client it's running on. To learn more, see the "User navigates away from current message" section of Handle OnMessageSend and OnAppointmentSend events in your Outlook add-in with Smart Alerts.
- In addition to item switching, an event-based add-in also ceases operation when the user sends the message or appointment they're composing.

### **Event-based add-in limitations in the new Outlook on Windows**

In the new Outlook on Windows, you must keep the main window of the client open for the add-in to process the mail item. If the main window is minimized, the add-in will pause or stop working.

### **Event-based add-in limitations in Excel, PowerPoint, Word, and classic Outlook on Windows**

When developing an event-based add-in to run on a Windows client, be mindful of the following:

- Imports aren't supported in the JavaScript file where you implement the handling for event-based activation.
- Only the JavaScript file referenced in the manifest is supported for event-based activation. You must bundle your event-handling JavaScript code into this single file. The location of the referenced JavaScript file in the manifest varies depending on the type of manifest your add-in uses.


- **Add-in only manifest**: <Override> child element of the <Runtime> node
- **Unified manifest for Microsoft 365**: "script" property of the "code" object

Note that a large JavaScript bundle may cause issues with the performance of your add-in. We recommend preprocessing heavy operations, so that they're not included in your event-handling code.

- When the JavaScript function specified in the manifest to handle an event runs, code in Office.onReady() and Office.initialize isn't run. We recommend adding any startup logic needed by event handlers, such as checking the user's client version, to the event handlers instead.
### **Event-based add-in limitations in Excel, PowerPoint, and Word**

The following platforms or features are not yet supported.

- Office on Mac
- The unified manifest for Microsoft 365

### **Unsupported APIs**

Some Office.js APIs that change or alter the UI aren't allowed from event-based add-ins. The following are blocked APIs.

| API                         | Methods                                                                                            |  |  |
|-----------------------------|----------------------------------------------------------------------------------------------------|--|--|
| Office.devicePermission     | requestPermissionsAsync                                                                            |  |  |
| Office.context.auth *       | getAccessToken<br>getAccessTokenAsync                                                              |  |  |
| Office.context.mailbox      | displayAppointmentForm<br>displayMessageForm<br>displayNewAppointmentForm<br>displayNewMessageForm |  |  |
| Office.context.mailbox.item | close                                                                                              |  |  |
| Office.context.ui           | displayDialogAsync<br>messageParent                                                                |  |  |

#### ノ **Expand table**

#### 7 **Note**

* **[OfficeRuntime.auth](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.auth)** is supported in all versions that support event-based activation and single sign-on (SSO), while **[Office.auth](https://learn.microsoft.com/en-us/javascript/api/office/office.auth)** is only supported in certain Outlook builds. For more information, see **Use single sign-on (SSO) or cross-origin resource sharing (CORS) in your event-based or spam-reporting Outlook add-in**.


### **Preview features in event handlers (classic Outlook on Windows)**

Classic Outlook on Windows includes a local copy of the production and beta versions of Office.js instead of loading from the content delivery network (CDN). By default, the local production copy of the API is referenced. To reference the local beta copy of the API, you must configure your computer's registry. This will enable you to test [preview features](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/preview-requirement-set/outlook-requirement-set-preview) in your event handlers in classic Outlook on Windows.

- 1. In the registry, navigate to
HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\Outlook\Options\WebExt\Developer . If the key doesn't exist, create it.

- 2. Create an entry named EnableBetaAPIsInJavaScript and set its value to 1 .
### **Enable single sign-on (SSO)**

To enable SSO in your event-based add-in, you must add its JavaScript file to a well-known URI. For guidance on how to configure this resource, see Use single sign-on (SSO) or cross-origin resource sharing (CORS) in your event-based or spam-reporting Office Add-in.

### **Request external data**

You can request external data by using an API like [Fetch](https://developer.mozilla.org/docs/Web/API/Fetch_API) or by using [XMLHttpRequest (XHR)](https://developer.mozilla.org/docs/Web/API/XMLHttpRequest) , a standard web API that issues HTTP requests to interact with servers.

#### 7 **Note**

If your add-in will operate in a JavaScript-only runtime, use absolute URLs in your Fetch API calls. Relative URLs in Fetch API calls aren't supported in a JavaScript-only runtime.

Be aware that you must use additional security measures when using XMLHttpRequest objects, requiring [Same](https://developer.mozilla.org/docs/Web/Security/Same-origin_policy) [Origin Policy](https://developer.mozilla.org/docs/Web/Security/Same-origin_policy) and [CORS (Cross-Origin Resource Sharing)](https://developer.mozilla.org/docs/Web/HTTP/CORS) .

#### 7 **Note**

Full CORS support is available in Office on the web, Mac, and Windows (starting in Version 2201, Build 16.0.14813.10000) clients.

To make CORS requests from your event-based add-in, you must add the add-in and its JavaScript file to a wellknown URI. For guidance on how to configure this resource, see Use single sign-on (SSO) or cross-origin resource


### **Troubleshoot your add-in**

As you develop your event-based add-in, you may need to troubleshoot issues, such as your add-in not loading or the event not occurring. For guidance on how to troubleshoot an event-based add-in, see Troubleshoot eventbased and spam-reporting add-ins.

### **Deploy your add-in**

Event-based add-ins are restricted to admin-managed deployments only, even if they're acquired from AppSource. If users acquire the add-in from AppSource or the in-app Office Store, they won't be able to activate the event-based function of the add-in. To learn more about listing your event-based add-in in AppSource, see AppSource listing options for your event-based add-in.

Admin deployments are done by uploading the manifest to the Microsoft 365 admin center. To do so, follow these steps.

- 1. In the admin portal, expand the **Settings** section in the navigation pane then select **Integrated apps**.
- 2. On the **Integrated apps** page, choose the **Upload custom apps** action.

#### ) **Important**

Add-ins that use the **Smart Alerts feature** can only be published to AppSource if the manifest's send mode property is set to the **prompt user** or **soft block** option. If an add-in's send mode property is set to **block**, it can only be deployed by an organization's admin as it will fail AppSource validation.

For more information about how to deploy an add-in, please refer to [Deploy and publish Office Add-ins in the](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/office-addins) [Microsoft 365 admin center.](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/office-addins)

### **Deploy manifest updates**

Because event-based add-ins are deployed by admins, any change you make to the manifest requires admin consent through the Microsoft 365 admin center. Until the admin accepts your changes, users in their organization are blocked from using the add-in. To learn more about the admin consent process, see Admin consent for installing event-based add-ins.


### **See also**

- Troubleshoot event-based and spam-reporting add-ins
- Debug event-based and spam-reporting add-ins
- AppSource listing options for your event-based add-in
- Handle OnMessageSend and OnAppointmentSend events in your Outlook add-in with Smart Alerts


# **Run code in your Office Add-in when the document opens**

Article • 07/11/2023

#### ) **Important**

The shared runtime is only supported in some Office applications. For more information, see **[Shared runtime requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/shared-runtime-requirement-sets)**.

You can configure your Office Add-in to load and run code as soon as the document is opened. This is useful if you need to register event handlers, pre-load data for the task pane, synchronize UI, or perform other tasks before the add-in is visible.

#### 7 **Note**

The configuration is implemented with a method that your code calls at runtime. This means that the add-in *won't* run the *first time* a user opens the document. The add-in must be opened manually for the first time on any document. After the method runs, either in **[Office.initialize](https://learn.microsoft.com/en-us/javascript/api/office#office-office-initialize-function(1))**, **[Office.onReady](https://learn.microsoft.com/en-us/javascript/api/office#office-office-onready-function(1))**, or because the user takes a code path that runs it; then whenever the document is reopened, the add-in loads immediately and any code in the Office.initialize or Office.onReady method runs.

#### 7 **Note**

This article requires that your Office Add-in is configured to use a **shared runtime**. For more information, see **Configure your Office Add-in to use a shared runtime**.

## **Configure your add-in to load when the document opens**

The following code configures your add-in to load and start running when the document is opened.

JavaScript


#### 7 **Note**

The setStartupBehavior method is asynchronous.

## **Place startup code in Office.initialize or Office.onReady**

When your add-in is configured to load on document open, it will run immediately. The Office.initialize event handler will be called. Place your startup code in the Office.initialize or Office.onReady event handler.

The following Excel add-in code shows how to register an event handler for change events from the active worksheet. If you configure your add-in to load on document open, this code will register the event handler when the document is opened. You can handle change events before the task pane is opened.

```
JavaScript
// This is called as soon as the document opens.
// Put your startup code here.
Office.initialize = () => {
 // Add the event handler.
 Excel.run(async context => {
 let sheet = context.workbook.worksheets.getActiveWorksheet();
 sheet.onChanged.add(onChange);
 await context.sync();
 console.log("A handler has been registered for the onChanged event.");
 });
};
/**
 * Handle the changed event from the worksheet.
 *
 * @param event The event information from Excel
 */
async function onChange(event) {
 await Excel.run(async (context) => { 
 await context.sync();
 console.log("Change type of event: " + event.changeType);
 console.log("Address of event: " + event.address);
 console.log("Source of event: " + event.source);
```


The following PowerPoint add-in code shows how to register an event handler for selection change events from the PowerPoint document. If you configure your add-in to load on document open, this code will register the event handler when the document is opened. You can handle change events before the task pane is opened.

```
JavaScript
// This is called as soon as the document opens.
// Put your startup code here.
Office.onReady(info => {
 if (info.host === Office.HostType.PowerPoint) {

Office.context.document.addHandlerAsync(Office.EventType.DocumentSelectionCh
anged, onChange);
 console.log("A handler has been registered for the onChanged event.");
 }
});
/**
 * Handle the changed event from the PowerPoint document.
 *
 * @param event The event information from PowerPoint
 */
async function onChange(event) {
 console.log("Change type of event: " + event.type);
}
```
## **Configure your add-in for no load behavior on document open**

There may be scenarios when you want to turn off the "run on document open" behavior. The following code configures your add-in not to start when the document is opened. Instead, it will start when the user engages it in some way, such as choosing a ribbon button or opening the task pane. This code has no effect if the method hasn't previously been called on the current document, with Office.StartupBehavior.load as the parameter.

#### 7 **Note**

If add-in calls the method, with Office.StartupBehavior.load as the parameter, in Office.initialize or Office.onReady , the behavior is turned on again. So, in this


scenario, turning it off only applies to the *next* time the document is opened, not *all* subsequent openings.

JavaScript

Office.addin.setStartupBehavior(Office.StartupBehavior.none);

### **Get the current load behavior**

There may be scenarios in which your add-in needs to know if it's configured to start automatically the next time the current document is opened. To determine what the current startup behavior is, run the following method, which returns an [Office.StartupBehavior](https://learn.microsoft.com/en-us/javascript/api/office/office.startupbehavior) value.

#### JavaScript

let behavior = await Office.addin.getStartupBehavior();

### **See also**

- Configure your Office Add-in to use a shared runtime
- Share data and events between Excel custom functions and task pane tutorial
- Work with Events using the Excel JavaScript API
- Runtimes in Office Add-ins


# **Office Add-ins manifest**

Article • 02/12/2025

Every Office add-in has a manifest. There are two types of manifests:

- **Add-in only manifest**: This type of manifest can be used for production add-ins in Excel, OneNote, Outlook, PowerPoint, Project, and Word. It can't be used for an app that combines an add-in with some other kind of extension of the Microsoft 365 platform. Its format is XML.
- **Unified manifest for Microsoft 365**: This is an expanded version of the JSONformatted manifest that has been used for years as the manifest for Teams Apps. Add-ins that use this manifest can be combined with other kinds of extensions of the Microsoft 365 platform in a single app that's installable as a unit. You can use this type of manifest for production Outlook add-ins. It's available for preview in Excel, PowerPoint, and Word add-ins.

#### 7 **Note**

Office Add-ins that use the unified manifest for Microsoft 365 are *directly* supported in Office on the web, in **[new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** , and in Office on Windows connected to a Microsoft 365 subscription, Version 2304 (Build 16320.00000) or later.

When the app package that contains the unified manifest is deployed in **[AppSource](https://appsource.microsoft.com/)** or the **Microsoft 365 Admin Center** then an add-in only manifest is generated from the unified manifest and stored. This add-in only manifest enables the add-in to be installed on platforms that don't directly support the unified manifest, including Office on Mac, Office on mobile, subscription versions of Office on Windows earlier than 2304 (Build 16320.00000), and perpetual versions of Office on Windows.

The remainder of this article is applicable to both types of manifest.

#### **Tip**

- For an overview that is specific to the add-in only manifest, see **Office Add-ins with an add-in only manifest**.
- For an overview that's specific to the unified manifest, see **Office Add-ins with the unified manifest for Microsoft 365**.


- If you have some familiarity with the add-in only manifest, the article **Compare the add-in only manifest with the unified manifest for Microsoft 365** explains the unified manifest by comparing it with the add-in only manifest.
The manifest file of an Office Add-in describes how your add-in should be activated when an end user installs and uses it with Office documents and applications.

A manifest file enables an Office Add-in to do the following:

- Describe itself by providing an ID, version, description, display name, and default locale.
- Specify the images used for branding the add-in and iconography used for add-in commands in the Office app ribbon.
- Specify how the add-in integrates with Office, including any custom UI, such as ribbon buttons the add-in creates.
- Specify the requested default dimensions for content add-ins, and requested height for Outlook add-ins.
- Declare permissions that the Office Add-in requires, such as reading or writing to the document.

#### 7 **Note**

If you plan to **publish** your add-in to AppSource and make it available within the Office experience, make sure that you conform to the **Commercial marketplace certification policies**. For example, to pass validation, your add-in must work across all platforms that support the methods that you define (for more information, see **section 1120.3** and the **[Office Add-in application and availability page](https://learn.microsoft.com/en-us/javascript/api/requirement-sets)**).

## **Hosting requirements**

All image URIs, such as those used for add-in commands, must support caching in production. The server hosting the image shouldn't return a Cache-Control header specifying no-cache , no-store , or similar options in the HTTP response. However, when you're developing the add-in and making changes to image files, the caching can prevent you from seeing your changes, so using Cache-Control headers is advisable in development.


All URLs to code or content files in the add-in should be **SSL-secured (HTTPS)**. While not strictly required in all add-in scenarios, using an HTTPS endpoint for your add-in is strongly recommended. Add-ins that are not SSL-secured (HTTPS) generate unsecure content warnings and errors during use. If you plan to run your add-in in Office on the web or publish your add-in to AppSource, it must be SSL-secured. If your add-in accesses external data and services, it should be SSL-secured to protect data in transit. Self-signed certificates can be used for development and testing, so long as the certificate is trusted on the local machine.

## **Best practices for submitting to AppSource**

Make sure that the add-in ID is a valid and unique GUID. Various GUID generator tools are available on the web that you can use to create a unique GUID.

Add-ins submitted to AppSource must also include a support URL in the manifest. For more information, see Validation policies for apps and add-ins submitted to AppSource.

## **Specify domains you want to open in the addin window**

When running in Office on the web or [new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) , your task pane can be navigated to any URL. However, in desktop platforms, if your add-in tries to go to a URL in a domain other than the domain that hosts the start page (as specified in the manifest file), that URL opens in a new browser window outside the add-in pane of the Office application.

To override this (desktop Office) behavior, specify each domain you want to open in the add-in window in the manifest. If the add-in tries to go to a URL in a domain that is in the list, then it opens in the task pane in both Office on the web and desktop. If it tries to go to a URL that isn't in the list, then, in desktop Office, that URL opens in a new browser window (outside the add-in pane).

#### 7 **Note**

There are two exceptions to this behavior.

- It applies only to the root pane of the add-in. If there is an iframe embedded in the add-in page, the iframe can be directed to any URL regardless of whether it is listed in the manifest, even in desktop Office.


- When a dialog is opened with the **[displayDialogAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.ui?view=common-js&preserve-view=true#office-office-ui-displaydialogasync-member(1))** API, the URL that is passed to the method must be in the same domain as the add-in, but the dialog can then be directed to any URL regardless of whether it is listed in the manifest, even in desktop Office.
## **Specify domains from which Office.js API calls are made**

Your add-in can make Office.js API calls from the add-in's domain referenced in the manifest file. If you have other iframes within your add-in that need to access Office.js APIs, add the domain of that source URL to the manifest file. If an iframe with a source not listed in the manifest attempts to make an Office.js API call, then the add-in will receive a permission denied error.

### **See also**

- Specify Office applications and API requirements
- Localization for Office Add-ins


# **Office Add-ins with the unified app manifest for Microsoft 365**

09/02/2025

This article introduces the unified app manifest for Microsoft 365. It assumes that you're familiar with Office Add-ins manifest.

#### **Tip**

- For an overview of the add-in only manifest, see **Office Add-ins with the add-in only manifest**.
- If you're familiar with the add-in only manifest, you might get a grasp on the JSONformatted unified manifest easier by reading **Compare the add-in only manifest with the unified manifest for Microsoft 365**.

Microsoft is making a number of improvements to the Microsoft 365 developer platform. These improvements provide more consistency in the development, deployment, installation, and administration of all types of extensions of Microsoft 365, including Office Add-ins. These changes are compatible with existing add-ins.

One important improvement is the ability to create a single unit of distribution for all your Microsoft 365 extensions by using the same manifest format and schema.

We've taken an important first step toward these goals by making it possible for you to create Outlook add-ins with a unified manifest for Microsoft 365.

#### 7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word add-ins.

#### **Tip**

Ready to get started with the unified manifest? Begin with **[Build an Outlook add-in with](https://learn.microsoft.com/en-us/office/dev/add-ins/quickstarts/outlook-quickstart-json-manifest) [the unified manifest for Microsoft 365](https://learn.microsoft.com/en-us/office/dev/add-ins/quickstarts/outlook-quickstart-json-manifest)**.

## **Key properties of the unified manifest**


The main reference documentation for the version of the unified app manifest is at [Microsoft](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema) [365 app manifest schema reference](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema). In this article, we provide a brief description of the meaning of base properties when the Teams App is (or includes) an Office Add-in. This is followed by some basic documentation for the ["extensions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root#extensions) property and its descendant properties. There is a full sample manifest for an add-in at Sample unified manifest.

### **Base properties**

Each of the base properties listed in the following table has more extensive documentation at [Microsoft 365 app manifest schema](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root). Base properties not included in this table have no meaning for Office Add-ins.

ノ **Expand table**

| JSON property        | Purpose                                                                                                             |  |
|----------------------|---------------------------------------------------------------------------------------------------------------------|--|
| "$schema"            | Identifies the manifest schema.                                                                                     |  |
| "manifestVersion"    | Version of the manifest schema.                                                                                     |  |
| "id"                 | GUID of the Teams app/add-in.                                                                                       |  |
| "version"            | Version of the Teams app/add-in. The format must be n.n.n where each n can be<br>no more than five digits.          |  |
| "name"               | Public short and long names of the Teams app/add-in. The short name appears at<br>the top of an add-in's task pane. |  |
| "description"        | Public short and long descriptions of the Teams app/add-in.                                                         |  |
| "developer"          | Information about the developer of the Teams app/add-in.                                                            |  |
| "localizationInfo"   | Configures the default locale and other supported locales.                                                          |  |
| "validDomains"       | See Specify safe domains.                                                                                           |  |
| "webApplicationInfo" | Identifies the Teams app/add-in's web app as it is known in Microsoft Entra ID.                                     |  |
| "authorization"      | Identifies any Microsoft Graph permissions that the add-in needs.                                                   |  |

### **"extensions" property**

We're working hard to complete reference documentation for the "extensions" property and its descendant properties. In the meantime, the following provides some basic documentation. Most, but not all, of the properties have an equivalent element (or attribute) in the add-in only manifest for add-ins. For the most part, the description, and restrictions, that apply to the XML


element or attribute also apply to its JSON property equivalent in the unified manifest. The tables in the ' "extensions" property' section of Compare the add-in only manifest with the unified manifest for Microsoft 365 can help you determine the XML equivalent of a JSON property.

#### 7 **Note**

This table contains only some selected representative descendant properties of "extensions" . *It isn't an exhaustive list of all child properties of "extensions" .* For the full reference of the unified manifest, see the **[Microsoft 365 app manifest schema reference](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema)**.

ノ **Expand table**

| JSON property                     | Purpose                                                                                                                                                                                |
|-----------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| "requirements.capabilities"       | Identifies the requirement sets that the add-in needs to be<br>installable.                                                                                                            |
| "requirements.scopes"             | Identifies the Office applications in which the add-in can be<br>installed. For example, "mail" means the add-in can be installed<br>in Outlook.                                       |
| "ribbons"                         | The ribbons that the add-in customizes.                                                                                                                                                |
| "ribbons.contexts"                | Specifies the command surfaces that the add-in customizes. For<br>example, "mailRead" or "mailCompose"                                                                                 |
| "ribbons.fixedControls"           | Configures and adds the button of an integrated spam-reporting<br>add-in to the Outlook ribbon.                                                                                        |
| "ribbons.spamPreProcessingDialog" | Configures the preprocessing dialog shown after the button of a<br>spam-reporting add-in is selected from the Outlook ribbon.                                                          |
| "ribbons.tabs"                    | Configures custom ribbon tabs.                                                                                                                                                         |
| "alternates"                      | Specifies backwards compatibility with an equivalent COM add-in,<br>XLL, or both. Also specifies the main icons that are used to<br>represent the add-in on older versions of Office.  |
| "runtimes"                        | Configures the embedded runtimes that the add-in uses,<br>including various kinds of add-ins that have little or no UI, such as<br>custom function-only add-ins and function commands. |
| "autoRunEvents"                   | Configures an event handler for a specified event.                                                                                                                                     |
| "keyboardShortcuts" (developer    | Defines custom keyboard shortcuts or key combinations to run                                                                                                                           |
| preview)                          | specific actions.                                                                                                                                                                      |


## **Specify safe domains**

There is a "validDomains" array in the manifest file that is used to tell Office which domains your add-in should be allowed to navigate to. As noted in Specify domains you want to open in the add-in window, when running in Office on the web, your task pane can be navigated to any URL. However, in desktop platforms, if your add-in tries to go to a URL in a domain other than the domain that hosts the start page, that URL opens in a new browser window outside the add-in pane of the Office application.

To override this behavior in desktop platforms, add each domain you want to open in the addin window to the list of domains specified in the "validDomains" array. If the add-in tries to go to a URL in a domain that is in the list, then it opens in the task pane in both Office on the web and desktop. If it tries to go to a URL that isn't in the list, then in Office on desktop, that URL opens in a new browser window (outside the add-in task pane).

## **Client and platform support**

Add-ins that use the unified manifest can be installed if the Office platform *directly* supports it.

To run an add-in on platforms that don't directly support the unified manifest, you must publish the add-in to [AppSource](https://appsource.microsoft.com/) . Then, deploy the add-in in the Microsoft 365 admin center. This way, an add-in only manifest is generated from the unified manifest and stored. The addin only manifest is then used to install the add-in on platforms that don't directly support the unified manifest.

The following tables lists which Office platforms directly support add-ins that use the unified manifest.

ノ **Expand table**

| Client/platform                                                                                            | Support for add-ins with the<br>unified manifest |
|------------------------------------------------------------------------------------------------------------|--------------------------------------------------|
| Office on the web                                                                                          | Directly supported                               |
| Office on Windows (Version 2304 (Build 16320.00000) or later)<br>connected to a Microsoft 365 subscription | Directly supported                               |
| new Outlook on Windows                                                                                     | Directly supported                               |
| Office on Windows (prior to Version 2304 (Build 16320.00000))<br>connected to a Microsoft 365 subscription | Not directly supported                           |
| Office on Windows (perpetual versions)                                                                     | Not directly supported                           |


**Client/platform Support for add-ins with the unified manifest**

Office on Mac Not directly supported

Office on mobile Not directly supported

#### 7 **Note**

If you're deploying an add-in in the **Microsoft 365 admin center** and require it to run on platforms that don't directly support the unified manifest, the add-in must be a published AppSource add-in. Custom add-ins or line-of-business (LOB) add-ins that use the unified manifest can be deployed in the **[Integrated apps portal](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/test-and-deploy-microsoft-365-apps)** of the Microsoft 365 admin center, but they won't be installable on Office versions that don't directly support the unified manifest.

# **Sample unified manifest**

The following is an example of a unified app manifest for an add-in. It doesn't contain every possible manifest property.

```
JSON
{
 "$schema": "https://developer.microsoft.com/json-
schemas/teams/vDevPreview/MicrosoftTeams.schema.json",
 "id": "00000000-0000-0000-0000-000000000000",
 "version": "1.0.0",
 "manifestVersion": "devPreview",
 "name": {
 "short": "Name of your app (<=30 chars)",
 "full": "Full name of app, if longer than 30 characters (<=100 chars)"
 },
 "description": {
 "short": "Short description of your app (<= 80 chars)",
 "full": "Full description of your app (<= 4000 chars)"
 },
 "icons": {
 "outline": "outline.png",
 "color": "color.png"
 },
 "accentColor": "#230201",
 "developer": {
 "name": "Contoso",
 "websiteUrl": "https://www.contoso.com",
 "privacyUrl": "https://www.contoso.com/privacy",
 "termsOfUseUrl": "https://www.contoso.com/servicesagreement"
```


```
 },
 "localizationInfo": {
 "defaultLanguageTag": "en-us",
 "additionalLanguages": [
 {
 "languageTag": "es-es",
 "file": "es-es.json"
 }
 ]
 },
 "webApplicationInfo": {
 "id": "00000000-0000-0000-0000-000000000000",
 "resource": "api://www.contoso.com/prodapp"
 },
 "authorization": {
 "permissions": {
 "resourceSpecific": [
 {
 "name": "Mailbox.ReadWrite.User",
 "type": "Delegated"
 }
 ]
 }
 },
 "extensions": [
 {
 "requirements": {
 "scopes": [ "mail" ],
 "capabilities": [
 {
 "name": "Mailbox", "minVersion": "1.1"
 }
 ]
 },
 "runtimes": [
 {
 "requirements": {
 "capabilities": [
 {
 "name": "MailBox",
 "minVersion": "1.10"
 }
 ]
 },
 "id": "eventsRuntime",
 "type": "general",
 "code": {
 "page": "https://contoso.com/events.html",
 "script": "https://contoso.com/events.js"
 },
 "lifetime": "short",
 "actions": [
 {
 "id": "onMessageSending",
 "type": "executeFunction"
```


```
 },
 {
 "id": "onNewMessageComposeCreated",
 "type": "executeFunction"
 }
 ]
 },
 {
 "requirements": {
 "capabilities": [
 {
 "name": "MailBox", "minVersion": "1.1"
 }
 ]
 },
 "id": "commandsRuntime",
 "type": "general",
 "code": {
 "page": "https://contoso.com/commands.html",
 "script": "https://contoso.com/commands.js"
 },
 "lifetime": "short",
 "actions": [
 {
 "id": "action1",
 "type": "executeFunction"
 },
 {
 "id": "action2",
 "type": "executeFunction"
 },
 {
 "id": "action3",
 "type": "executeFunction"
 }
 ]
 }
 ],
 "ribbons": [
 {
 "contexts": [
 "mailCompose"
 ],
 "tabs": [
 {
 "builtInTabId": "TabDefault",
 "groups": [
 {
 "id": "dashboard",
 "label": "Controls",
 "controls": [
 {
 "id": "control1",
            "type": "button",
            "label": "Action 1",
```


```
 "icons": [
 {
 "size": 16,
             "url": "test_16.png"
 },
            {
 "size": 32,
             "url": "test_32.png"
 },
            {
 "size": 80,
             "url": "test_80.png"
 }
 ],
           "supertip": {
 "title": "Action 1 Title",
            "description": "Action 1 Description"
 },
           "actionId": "action1"
 },
 {
 "id": "menu1",
           "type": "menu",
           "label": "My Menu",
           "icons": [
 {
 "size": 16,
             "url": "test_16.png"
 },
            {
 "size": 32,
             "url": "test_32.png"
 },
            {
 "size": 80,
             "url": "test_80.png"
 }
 ],
           "supertip": {
 "title": "My Menu",
            "description": "Menu with 2 actions"
 },
           "items": [
 {
 "id": "menuItem1",
             "type": "menuItem",
             "label": "Action 2",
             "supertip": {
 "title": "Action 2 Title",
              "description": "Action 2 Description"
 },
             "actionId": "action2"
 },
            {
 "id": "menuItem2",
```


```
 "type": "menuItem",
            "label": "Action 3",
            "icons": [
 {
 "size": 16,
              "url": "test_16.png"
 },
             {
 "size": 32,
              "url": "test_32.png"
 },
             {
 "size": 80,
              "url": "test_80.png"
 }
 ],
            "supertip": {
 "title": "Action 3 Title",
             "description": "Action 3 Description"
 },
            "actionId": "action3"
 }
 ]
 }
 ]
 }
 ],
 }
 ]
 },
 {
 "contexts": [ "mailRead" ],
 "tabs": [
 {
 "builtInTabId": "TabDefault",
 "groups": [
 {
 "id": "dashboard",
 "label": "Controls",
 "controls": [
 {
 "id": "control1",
          "type": "button",
          "label": "Action 1",
          "icons": [
 {
 "size": 16,
            "url": "test_16.png"
 },
           {
 "size": 32,
            "url": "test_32.png"
 },
           {
 "size": 80,
```


```
 "url": "test_80.png"
 }
 ],
           "supertip": {
 "title": "Action 1 Title",
            "description": "Action 1 Description"
 },
           "actionId": "action1"
 }
 ]
 }
 ],
 "customMobileRibbonGroups" [
 {
 "id": "myMobileGroup",
 "label": "Contoso Actions",
 "controls": [
 {
 "id": "msgReadFunctionButton",
           "type": "mobileButton",
           "label": "Action 1",
           "icons": [
 {
 "size": 16,
             "url": "test_16.png"
 },
            {
 "size": 32,
             "url": "test_32.png"
 },
            {
 "size": 80,
             "url": "test_80.png"
 }
 ],
           "supertip": {
 "title": "Action 1 Title",
            "description": "Action 1 Description"
 },
           "actionId": "action1"
 }
 ]
 }
 ]
 "customMobileRibbonGroups": [
 {
 "id": "mobileDashboard",
 "label": "Controls",
 "controls": [
 {
 "id": "control1",
           "type": "mobileButton",
           "label": "Action 1",
           "icons": [
 {
```


```
 "size": 16,
             "url": "test_16.png"
 },
            {
 "size": 32,
             "url": "test_32.png"
 },
            {
 "size": 80,
             "url": "test_80.png"
 }
 ],
           "supertip": {
 "title": "Action 1 Title",
            "description": "Action 1 Description"
 },
           "actionId": "action1"
 }
 ]
 }
 ]
 }
 ]
 }
 ],
 "autoRunEvents": [
 {
 "requirements": {
 "capabilities": [
 {
 "name": "MailBox", "minVersion": "1.10"
 }
 ]
 },
 "events": [
 {
 "type": "newMessageComposeCreated",
 "actionId": "onNewMessageComposeCreated"
 },
 {
 "type": "messageSending",
 "actionId": "onMessageSending",
 "options": {
 "sendMode": "promptUser"
 }
 }
 ]
 }
 ],
 "alternates": [
 {
 "requirements": {
 "scopes": [ "mail" ]
 },
 "prefer": {
```


```
 "comAddin": {
 "progId": "ContosoExtension"
 }
 },
 "hide": {
 "storeOfficeAddin": {
 "officeAddinId": "00000000-0000-0000-0000-000000000000",
 "assetId": "WA000000000"
 }
 },
 "alternateIcons": {
 "icon": {
 "size": 64,
 "url": "https://contoso.com/assets/icon64x64.jpg"
 },
 "highResolutionIcon": {
 "size": 64,
 "url": "https://contoso.com/assets/icon128x128.jpg"
 }
 }
 }
 ]
 }
 ]
}
```
### **See also**

- Create add-in commands with the unified manifest for Microsoft 365
- [Microsoft 365 app manifest schema reference](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema)


# **Compare the add-in only manifest with the unified manifest for Microsoft 365**

09/02/2025

This article is intended to help readers who are familiar with the add-in only manifest understand the unified manifest by comparing the two. Readers should also see Office Add-ins with the unified manifest for Microsoft 365.

#### 7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word add-ins.

# **Schemas and general points**

There is just one schema for the [unified manifest](https://raw.githubusercontent.com/OfficeDev/microsoft-teams-app-schema/preview/DevPreview/MicrosoftTeams.schema.json) , in contrast to the add-in only manifest which has a total of seven [schemas.](https://learn.microsoft.com/en-us/openspecs/office_file_formats/ms-owemxml/c6a06390-34b8-4b42-82eb-b28be12494a8)

## **Conceptual mapping of the unified and add-in only manifests**

This section describes the unified manifest for readers who are familiar with the add-in only manifest. Some points to keep in mind:

- The unified manifest is JSON-formatted.
- JSON doesn't distinguish between attribute and element value like XML does. Typically, the JSON that maps to an XML element makes both the element value and each of the attributes a child property. The following example shows some XML markup and its JSON equivalent.

```
XML
JSON
<MyThing color="blue">Some text</MyThing>
"myThing" : {
 "color": "blue",
```


```
 "text": "Some text"
```
}

- There are many places in the add-in only manifest where an element with a plural name has children with the singular version of the same name. For example, the markup to configure a custom menu includes an <Items> element which can have multiple <Item> element children. The JSON equivalent of these plural elements is a property with an array as its value. The members of the array are *anonymous* objects, not properties named "item" or "item1", "item2", etc. The following is an example.

```
JSON
"items": [
 {
 -- markup for a menu item is here --
 },
 {
 -- markup for another menu item is here --
 }
]
```
### **Top-level structure**

The root level of the unified manifest, which roughly corresponds to the <OfficeApp> element in the add-in only manifest, is an anonymous object.

The children of <OfficeApp> are commonly divided into two notional categories. The <VersionOverrides> element is one category. The other consists of all the other children of <OfficeApp> , which are collectively referred to as the base manifest. So too, the unified manifest has a similar division. There is a top-level ["extensions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root#extensions) property that roughly corresponds in its purposes and child properties to the <VersionOverrides> element. The unified manifest also has over 10 other top-level properties that collectively serve the same purposes as the base manifest of the add-in only manifest. These other properties can be thought of collectively as the base manifest of the unified manifest.

### **Base manifest**

The base manifest properties specify characteristics of the add-in that *any* type of extension of Microsoft 365 is expected to have. This includes Teams tabs and message extensions, not just Office add-ins. These characteristics include a public name and a unique ID. The following table shows a mapping of some critical top-level properties in the unified manifest to the XML elements in the current manifest, where the mapping principle is the *purpose* of the markup.


| JSON property        | Purpose                                                                           | XML elements                                                                           | Comments                                                                                                                                                                   |
|----------------------|-----------------------------------------------------------------------------------|----------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| "$schema"            | Identifies the<br>manifest schema.                                                | attributes of<br><officeapp> and<br/><versionoverrides></versionoverrides></officeapp> | None                                                                                                                                                                       |
| "id"                 | GUID of the add<br>in.                                                            | <id></id>                                                                              | None                                                                                                                                                                       |
| "version"            | Version of the<br>add-in.                                                         | <version></version>                                                                    | None                                                                                                                                                                       |
| "manifestVersion"    | Version of the<br>manifest schema.                                                | attributes of<br><officeapp></officeapp>                                               | None                                                                                                                                                                       |
| "name"               | Public name of<br>the add-in.                                                     | <displayname></displayname>                                                            | None                                                                                                                                                                       |
| "description"        | Public description<br>of the add-in.                                              | <description></description>                                                            | None                                                                                                                                                                       |
| "accentColor"        | None                                                                              | None                                                                                   | This property has no equivalent<br>in the add-in only manifest and<br>isn't used in the unified manifest.<br>But it must be present.                                       |
| "developer"          | Identifies the<br>developer of the<br>add-in.                                     | <providername></providername>                                                          | None                                                                                                                                                                       |
| "localizationInfo"   | Configures the<br>default locale and<br>other supported<br>locales.               | <defaultlocale> and<br/><override></override></defaultlocale>                          | None                                                                                                                                                                       |
| "webApplicationInfo" | Identifies the<br>add-in's web app<br>as it is known in<br>Microsoft Entra<br>ID. | <webapplicationinfo></webapplicationinfo>                                              | In the add-in only manifest, the<br><webapplicationinfo> element is<br/>inside <versionoverrides><br/>, not<br/>the base manifest.</versionoverrides></webapplicationinfo> |
| "authorization"      | Identifies any<br>Microsoft Graph<br>permissions that<br>the add-in needs.        | <webapplicationinfo></webapplicationinfo>                                              | In the add-in only manifest, the<br><webapplicationinfo> element is<br/>inside <versionoverrides><br/>, not<br/>the base manifest.</versionoverrides></webapplicationinfo> |

The <Hosts> , <Requirements> , and <ExtendedOverrides> elements are part of the base manifest in the add-in only manifest. But concepts and purposes associated with these elements are


configured inside the "extensions" property of the unified manifest.

### **"extensions" property**

The "extensions" property in the unified manifest primarily represents characteristics of the add-in that wouldn't be relevant to other kinds of Microsoft 365 extensions. For example, the Office applications that the add-in extends (such as, Excel, PowerPoint, Word, and Outlook) are specified inside the "extensions" property, as are customizations of the Office application ribbon. The configuration purposes of the "extensions" property closely match those of the <VersionOverrides> element in the add-in only manifest.

#### 7 **Note**

The <VersionOverrides> section of the add-in only manifest has a "double jump" system for many string resources. Strings, including URLs, are specified and assigned an ID in the <Resources> child of <VersionOverrides> . Elements that require a string have a resid attribute that matches the ID of a string in the <Resources> element. The "extensions" property of the unified manifest simplifies things by defining strings directly as property values. There is nothing in the unified manifest that is equivalent to the <Resources> element.

The following table shows a mapping of *some* high-level child properties of the "extensions" property in the unified manifest to XML elements in the current manifest. Dot notation is used to reference child properties.

#### 7 **Note**

This table contains only some selected representative descendant properties of "extensions" . *It isn't an exhaustive list of all child properties of "extensions" .* For the full reference of the unified manifest, see **[Microsoft 365 app manifest schema reference](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema)**.

ノ **Expand table**

| JSON property               | Purpose                                                                                    | XML elements                                        | Comments |
|-----------------------------|--------------------------------------------------------------------------------------------|-----------------------------------------------------|----------|
| "requirements.capabilities" | Identifies the<br>requirement sets that<br>the add-in needs to<br>be installable. that the | <requirements> and<br/><sets></sets></requirements> | None     |


| JSON property                              | Purpose                                                                                                                                                                                                     | XML elements                                                                                                                        | Comments                                                                                                                                                 |
|--------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                            | add-in needs to be<br>installable.                                                                                                                                                                          |                                                                                                                                     |                                                                                                                                                          |
| "requirements.scopes"                      | Identifies the Office<br>applications in which<br>the add-in can be<br>installed.                                                                                                                           | <hosts></hosts>                                                                                                                     | None                                                                                                                                                     |
| "ribbons"                                  | The ribbons that the<br>add-in customizes.                                                                                                                                                                  | <hosts> ,<br/>ExtensionPoints, and<br/>various *FormFactor<br/>elements</hosts>                                                     | The "ribbons" property<br>is an array of<br>anonymous objects<br>that each merge the<br>purposes of the these<br>three elements. See<br>"ribbons" table. |
| "alternates"                               | Specifies backwards<br>compatibility with an<br>equivalent COM add<br>in, XLL, or both.                                                                                                                     | <equivalentaddins></equivalentaddins>                                                                                               | See the<br>EquivalentAddins - See<br>also for background<br>information.                                                                                 |
| "runtimes"                                 | Configures the<br>embedded runtimes<br>that the add-in uses,<br>including various<br>kinds of add-ins that<br>have little or no UI,<br>such as custom<br>function-only add-ins<br>and function<br>commands. | <runtimes> .<br/><functionfile> , and<br/><extensionpoint> (of<br/>type CustomFunctions)</extensionpoint></functionfile></runtimes> | None.                                                                                                                                                    |
| "autoRunEvents"                            | Configures an event<br>handler for a specified<br>event.                                                                                                                                                    | <extensionpoint> (of<br/>type LaunchEvent)</extensionpoint>                                                                         | None.                                                                                                                                                    |
| "keyboardShortcuts"<br>(developer preview) | Defines custom<br>keyboard shortcuts or<br>key combinations to<br>run specific actions.                                                                                                                     | <extendedoverrides></extendedoverrides>                                                                                             | None.                                                                                                                                                    |

#### **"ribbons" table**

The following table maps the child properties of the anonymous child objects in the "ribbons" array onto XML elements in the current manifest.


| JSON property             | Purpose                                                                                                                                            | XML elements                                                                                                                     | Comments                                                                                                                                       |
|---------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|
| "contexts"                | Specifies the<br>command<br>surfaces that the<br>add-in<br>customizes.                                                                             | Various *CommandSurface<br>elements, such as<br>PrimaryCommandSurface and<br>MessageReadCommandSurface                           | None.                                                                                                                                          |
| "tabs"                    | Configures<br>custom ribbon<br>tabs.                                                                                                               | <customtab></customtab>                                                                                                          | The names and<br>hierarchy of the<br>descendant<br>properties of<br>"tabs" closely<br>match the<br>descendants of<br><customtab> .</customtab> |
| "fixedControls"           | Configures and<br>adds the button<br>of an integrated<br>spam-reporting<br>add-in to the<br>Outlook ribbon.                                        | <control> child element of<br/><reportphishingcustomization></reportphishingcustomization></control>                             | None.                                                                                                                                          |
| "spamPreProcessingDialog" | Configures the<br>preprocessing<br>dialog shown<br>after the button<br>of a spam<br>reporting add-in<br>is selected from<br>the Outlook<br>ribbon. | <preprocessingdialog> child<br/>element of<br/><reportphishingcustomization></reportphishingcustomization></preprocessingdialog> | None.                                                                                                                                          |

For a full sample unified manifest, see Sample unified manifest.

## **Next steps**

- Build your first Outlook add-in


# **Convert an add-in to use the unified manifest for Microsoft 365**

Article • 05/19/2025

To add Teams capabilities or a Copilot extension to an add-in that uses the add-in only manifest, or to just future proof the add-in, you need to convert it to use the unified manifest for Microsoft 365.

#### 7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word add-ins.

There are three basic tasks to converting an add-in project from the add-in only manifest to the unified manifest.

- Ensure that your manifest is ready to convert.
- Convert the XML-formatted add-in only manifest itself to the JSON format of the unified manifest.
- Package the new manifest and two icon image files (described later) into a zip file for sideloading or deployment. *Depending on how you sideload the converted add-in, this task may be done for you automatically.*

#### 7 **Note**

Office Add-ins that use the unified manifest for Microsoft 365 are *directly* supported in Office on the web, in **[new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** , and in Office on Windows connected to a Microsoft 365 subscription, Version 2304 (Build 16320.00000) or later.

When the app package that contains the unified manifest is deployed in **[AppSource](https://appsource.microsoft.com/)** or the **Microsoft 365 Admin Center** then an add-in only manifest is generated from the unified manifest and stored. This add-in only manifest enables the add-in to be installed on platforms that don't directly support the unified manifest, including Office on Mac, Office on mobile, subscription versions of Office on Windows earlier than 2304 (Build 16320.00000), and perpetual versions of Office on Windows.

#### 7 **Note**

- Add-ins that use the unified manifest can be sideloaded only on Office Version 2304 (Build 16320.20000) or later.


- Projects created in Visual Studio, as distinct from Visual Studio Code, can't be converted at this time.
- If you **created the project with Teams Toolkit or Microsoft 365 Agents Toolkit** or with the "unified manifest" option in the **Office Yeoman Generator**, it already uses the unified manifest.

### **Ensure that your manifest is ready to convert**

The following sections describe conditions that must be met before you convert the manifest.

### **Uninstall the existing version of the add-in**

To avoid conflicts with UI control names and other problems, be sure the existing add-in isn't installed on the computer where you do the conversion. If you experience any difficulties uninstalling the add-in, see Remove a ghost add-in.

### **Ensure that you have two special image files**

If your add-in only manifest doesn't already have both **<IconUrl>** and **<HighResolutionIconUrl>** (in that order) elements, then add them just below the **<Description>** element. The values of the **DefaultValue** attribute should be the full URLs of image files. The images must be a specified size as shown in the following table.

ノ **Expand table**

| Office application               | <iconurl></iconurl> | <highresolutioniconurl></highresolutioniconurl> |
|----------------------------------|---------------------|-------------------------------------------------|
| Outlook                          | 64x64 pixels        | 128x128 pixels                                  |
| All other Office<br>applications | 32x32 pixels        | 64x64 pixels                                    |

The following markup is an example.

| XML                                                                                                                                                                                                                                                                                                                                                                                                     |  |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| <officeapp <br="" xmlns="http://schemas.microsoft.com/office/appforoffice/1.1">xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="MailApp"&gt;<br/><id>01234567-89ab-cdef-0123-4567-89abcdef0123</id><br/><version>1.0</version><br/><providername>Contoso</providername><br/><defaultlocale>en-us</defaultlocale><br/><displayname defaultvalue="Great Add-in"></displayname></officeapp> |  |
|                                                                                                                                                                                                                                                                                                                                                                                                         |  |


```
 <Description DefaultValue="A great add-in."/>
 <IconUrl DefaultValue="https://localhost:3000/assets/icon-64.png" />
 <HighResolutionIconUrl DefaultValue="https://localhost:300/assets/icon-128.png"
/>
 <!-- Other markup omitted -->
```
### **Reduce the number of add-in commands as needed**

An add-in that uses the unified manifest may not have more than 20 add-in commands. If the total number of **[<Action>](https://learn.microsoft.com/en-us/javascript/api/manifest/action)** [elements](https://learn.microsoft.com/en-us/javascript/api/manifest/action) in the add-in only manifest is greater than 20, you must redesign the add-in to have no more than 20.

### **Update the add-in ID, version, domain, and function names in the manifest**

- 1. Change the value of the <ID> element to a new random GUID.
- 2. Update the value of the <Version> element and ensure that it conforms to the [semver](https://semver.org/) [standard](https://semver.org/) (MAJOR.MINOR.PATCH). Each segment can have no more than five digits. For example, change the value 1.0.0.0 to 1.0.1 . The semver standard's prerelease and metadata version string extensions aren't supported.
- 3. Be sure that the domain segment of the add-in's URLs in the manifest are pointing to https://localhost:3000 .
- 4. If your manifest has any **<FunctionName>** elements, make sure their values have fewer than 65 characters.

#### ) **Important**

The value of this element must exactly match the name of an action that's mapped to a function in a JavaScript or TypeScript file with the **[Office.actions.associate](https://learn.microsoft.com/en-us/javascript/api/office/office.actions#office-office-actions-associate-member(1))** function. If you change it in the manifest, be sure to change it in the actionId parameter passed to associate() too.

### **Shorten string values as needed**

Review and change, as needed, manifest values in light of the following effects of the conversion.


- The first 30 characters of <DisplayName> becomes the value of ["name.short"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-name#short) in the unified manifest.
- The first 100 characters of <DisplayName> becomes the value of ["name.full"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-name#full) in the unified manifest.
- The first 250 characters of <Description> becomes the value of ["description.short"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-description#short) in the unified manifest.
- The first 4000 characters of <Description> becomes the value of ["description.full"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-description#full) in the unified manifest.
- The first 32 characters of the <ProviderName> becomes the value of ["developer.name"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-developer#name) in the unified manifest.

### **Verify that the modified add-in only manifest works**

- 1. Validate the modified add-in only manifest. See Validate an Office Add-in's manifest.
- 2. Verify that the add-in can be sideloaded and run. See Sideload an Office Add-in for testing.

Resolve any problems before you attempt to convert the project.

## **Conversion tools and options**

There are several ways to carry out the remaining tasks, depending on the IDE and other tools you want to use for your project, and on the tool you used to create the project.

- Convert projects created with the Yeoman generator for Office Add-ins (aka "Yo Office")
- Convert NodeJS and npm projects that weren't created with the Yeoman generator for Office Add-ins (Yo Office)

#### 7 **Note**

Conversion of the manifest is one of the effects of importing the add-in project into Agents Toolkit if you do so using the toolkit's importation feature. For details, see **Import an add-in project to Agents Toolkit**

### **Convert projects created with the Yeoman generator for Office Add-ins (aka "Yo Office")**

If the project was created with the Yeoman generator for Office Add-ins, convert it using the following steps.


- 1. In the root of the project, open a command prompt or bash shell and run the following command. This converts the manifest and updates the package.json to specify current tooling packages. The new unified manifest is in the root of the project and the old addin only manifest is in a backup.zip file. For details about this command, see [Office-Addin-](https://www.npmjs.com/package/office-addin-project)[Project](https://www.npmjs.com/package/office-addin-project) .

```
command line
npx office-addin-project convert -m <relative-path-to-XML-manifest>
```
- 2. Run npm install .
- 3. To sideload the add-in, see Sideload add-ins created with the Yeoman generator for Office Add-ins (Yo Office).

### **Convert NodeJS and npm projects that weren't created with the Yeoman generator for Office Add-ins (Yo Office)**

If your project wasn't created with Yo Office, use the office-addin-manifest-converter tool.

In the root of the project, open a command prompt or bash shell and run the following command. This command puts the unified manifest in a subfolder with the same name as the filename stem of the original add-in only manifest. For example, if the manifest is named **MyManifest.xml**, the unified manifest is created at **.\MyManifest\MyManifest.json**. For more details about this command, see [Office-Addin-Manifest-Converter](https://www.npmjs.com/package/office-addin-manifest-converter) .

command line

npx office-addin-manifest-converter convert <relative-path-to-XML-manifest>

Once you have the unified manifest created, there are two ways to create the zip file and sideload it. For more information, see Sideload other NodeJS and npm projects.

#### 7 **Note**

If the original add-in only manifest used any **<Override>** elements to localize strings in the manifest, then the conversion process produces JSON string files for each localized language. These files must also be included in the zip file, and they must be at the relative path indicated in the **["localizationInfo.additionalLanguages.file"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-localization-info-additional-languages#file)** property.


## **Next steps**

Consider whether to maintain both the old and new versions of the add-in. See Manage both a unified manifest and an add-in only manifest version of your Office Add-in.


# **Office Add-ins with the add-in only manifest**

07/11/2025

This article introduces the XML-formatted add-in only manifest for Office Add-ins. It assumes that you're familiar with the Office Add-ins manifest.

#### **Tip**

For an overview of the unified manifest for Microsoft 365, see **Office Add-ins with the unified manifest for Microsoft 365**.

### **Schema versions**

Not all Office clients support the latest features, and some Office users will have an older version of Office. Having schema versions lets developers build add-ins that are backwards compatible, using the newest features where they are available but still functioning on older versions.

The **<VersionOverrides>** element in the manifest is an example of this. All elements defined inside **<VersionOverrides>** will override the same element in the other part of the manifest. This means that, whenever possible, Office will use what is in the **<VersionOverrides>** section to set up the add-in. However, if the version of Office doesn't support a certain version of **<VersionOverrides>**, Office will ignore it and depend on the information in the rest of the manifest.

This approach means that developers don't have to create multiple individual manifests, but rather keep everything defined in one file.

The current versions of the schema are:

ノ **Expand table**

| Version | Description                                                                                                                                                               |
|---------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| v1.0    | Supports version 1.0 of the Office JavaScript API. For example, in Outlook add<br>ins, this supports the read form.                                                       |
| v1.1    | Supports version 1.1 of the Office JavaScript API and <versionoverrides>. For<br/>example, in Outlook add-ins, this adds support for the compose form.</versionoverrides> |


| Version                               | Description                                                                                   |
|---------------------------------------|-----------------------------------------------------------------------------------------------|
| <versionoverrides></versionoverrides> | Supports later versions of the Office JavaScript API. This supports add-in                    |
| 1.0                                   | commands.                                                                                     |
| <versionoverrides></versionoverrides> | Supported by Outlook only. This version of <versionoverrides> adds support</versionoverrides> |
| 1.1                                   | for newer features, such as pinnable task panes and mobile add-ins.                           |

Even if your add-in manifest uses the **<VersionOverrides>** element, it is still important to include the v1.1 manifest elements to allow your add-in to work with older clients that do not support **<VersionOverrides>**.

#### 7 **Note**

Office uses a schema to validate manifests. The schema requires that elements in the manifest appear in a specific order. If you include elements out of the required order, you may get errors when sideloading your add-in. See **How to find the proper order of manifest elements** elements in the required order.

### **Required elements**

The following table specifies the elements that are required for the three types of Office Addins.

#### 7 **Note**

There is also a mandatory order in which elements must appear within their parent element. For more information see **How to find the proper order of add-in only manifest elements**.

### **Required elements by Office Add-in type**

ノ **Expand table**

| Element   | Content  | Task pane | Mail<br>(Outlook) |
|-----------|----------|-----------|-------------------|
| OfficeApp | Required | Required  | Required          |
| Id        | Required | Required  | Required          |
| Version   | Required | Required  | Required          |


| Element                                                                                 | Content        | Task pane     | Mail<br>(Outlook) |
|-----------------------------------------------------------------------------------------|----------------|---------------|-------------------|
| ProviderName                                                                            | Required       | Required      | Required          |
| DefaultLocale                                                                           | Required       | Required      | Required          |
| DisplayName                                                                             | Required       | Required      | Required          |
| Description                                                                             | Required       | Required      | Required          |
| SupportUrl**                                                                            | Required       | Required      | Required          |
| DefaultSettings (ContentApp)<br>DefaultSettings (TaskPaneApp)                           | Required       | Required      | Not available     |
| SourceLocation (ContentApp)<br>SourceLocation (TaskPaneApp)<br>SourceLocation (MailApp) | Required       | Required      | Required          |
| DesktopSettings                                                                         | Not available  | Not available | Required          |
| Permissions (ContentApp)<br>Permissions (TaskPaneApp)<br>Permissions (MailApp)          | Required       | Required      | Required          |
| Rule (RuleCollection)<br>Rule (MailApp)                                                 | Not available  | Not available | Required          |
| Requirements (MailApp)*                                                                 | Not applicable | Not available | Required          |
| Set*<br>Sets (Requirements)*<br>Sets (MailAppRequirements)*                             | Required       | Required      | Required          |
| Form*<br>FormSettings*                                                                  | Not available  | Not available | Required          |
| Hosts*                                                                                  | Required       | Required      | Optional          |

**Added in the Office Add-in Manifest Schema version 1.1.*

*** SupportUrl is only required for add-ins that are distributed through AppSource.*

## **Root element**

The root element for the Office Add-in manifest is **<OfficeApp>**. This element also declares the default namespace, schema version and the type of add-in. Place all other elements in the manifest within its open and close tags. The following is an example of the root element.


```
<OfficeApp
 xmlns="http://schemas.microsoft.com/office/appforoffice/1.1"
 xmlns:xsi="https://www.w3.org/2001/XMLSchema-instance"
 xmlns:bt="http://schemas.microsoft.com/office/officeappbasictypes/1.0"

xmlns:mailappor="http://schemas.microsoft.com/office/mailappversionoverrides/1.0"
 xsi:type="MailApp">
 <!-- The rest of the manifest. -->
</OfficeApp>
```
## **Version**

XML

This is the version of the specific add-in. If a developer updates something in the manifest, the version must be incremented as well. This way, when the new manifest is installed, it will overwrite the existing one and the user will get the new functionality. If this add-in was submitted to the store, the new manifest will have to be re-submitted and re-validated. Then, users of this add-in will get the new updated manifest automatically in a few hours, after it is approved.

If the add-in's requested permissions change, users will be prompted to upgrade and reconsent to the add-in. If the admin installed this add-in for the entire organization, the admin will have to re-consent first. Users will be unable to use the add-in until consent is granted.

## **Hosts**

Office add-ins specify the **<Hosts>** element like the following:

```
XML
<OfficeApp>
...
 <Hosts>
 <Host Name="Mailbox" />
 </Hosts>
...
</OfficeApp>
```
This is separate from the **<Hosts>** element inside the **<VersionOverrides>** element, which is discussed in Create add-in commands with the add-in only manifest.


## **Specify safe domains with the AppDomains element**

There is an [AppDomains](https://learn.microsoft.com/en-us/javascript/api/manifest/appdomains) element of the add-in only manifest file that is used to tell Office which domains your add-in should be allowed to navigate to. As noted in Specify domains you want to open in the add-in window, when running in Office on the web, your task pane can be navigated to any URL. However, in desktop platforms, if your add-in tries to go to a URL in a domain other than the domain that hosts the start page (as specified in the [SourceLocation](https://learn.microsoft.com/en-us/javascript/api/manifest/sourcelocation) element), that URL opens in a new browser window outside the add-in pane of the Office application.

To override this (desktop Office) behavior, add each domain you want to open in the add-in window in the list of domains specified in the **<AppDomains>** element. If the add-in tries to go to a URL in a domain that is in the list, then it opens in the task pane in both Office on the web and desktop. If it tries to go to a URL that isn't in the list, then in desktop Office that URL opens in a new browser window (outside the add-in pane).

The following table describes browser behavior when your add-in attempts to navigate to a URL outside of the add-in's default domain.

ノ **Expand table**

| Office client                                         | Domain defined in<br>AppDomains? | Browser behavior                         |
|-------------------------------------------------------|----------------------------------|------------------------------------------|
| All clients                                           | Yes                              | Link opens in add-in task<br>pane.       |
| Office 2016 on Windows (volume<br>licensed perpetual) | No                               | Link opens in Internet<br>Explorer 11.   |
| Other clients                                         | No                               | Link opens in user's default<br>browser. |

The following add-in only manifest example hosts its main add-in page in the https://www.contoso.com domain as specified in the **<SourceLocation>** element. It also specifies the https://www.northwindtraders.com domain in an [AppDomain](https://learn.microsoft.com/en-us/javascript/api/manifest/appdomain) element within the **<AppDomains>** element list. If the add-in goes to a page in the www.northwindtraders.com domain, that page opens in the add-in pane, even in Office desktop.

```
XML
<?xml version="1.0" encoding="UTF-8"?>
<OfficeApp xmlns="http://schemas.microsoft.com/office/appforoffice/1.1"
```


```
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:type="TaskPaneApp">
 <!--IMPORTANT! Id must be unique for each add-in. If you copy this manifest
ensure that you change this id to your own GUID. -->
 <Id>c6890c26-5bbb-40ed-a321-37f07909a2f0</Id>
 <Version>1.0</Version>
 <ProviderName>Contoso, Ltd</ProviderName>
 <DefaultLocale>en-US</DefaultLocale>
 <DisplayName DefaultValue="Northwind Traders Excel" />
 <Description DefaultValue="Search Northwind Traders data from Excel"/>
 <SupportUrl DefaultValue="[Insert the URL of a page that provides support
information for the app]" />
 <AppDomains>
 <AppDomain>https://www.northwindtraders.com</AppDomain>
 </AppDomains>
 <DefaultSettings>
 <SourceLocation DefaultValue="https://www.contoso.com/search_app/Default.aspx"
/>
 </DefaultSettings>
 <Permissions>ReadWriteDocument</Permissions>
</OfficeApp>
```
## **Version overrides in the manifest**

The optional [VersionOverrides](https://learn.microsoft.com/en-us/javascript/api/manifest/versionoverrides) element contains child markup that enables additional add-in features. Some of these are:

- Customizing the Office ribbon and menus.
- Customizing how Office works with the embedded runtimes in which add-ins run.
- Configuring how the add-in interacts with Azure Active Directory and Microsoft Graph for Single Sign-on.

Some descendant elements of VersionOverrides have values that override values of the parent OfficeApp element. For example, the Hosts element in VersionOverrides overrides the Hosts element in OfficeApp .

The VersionOverrides element has its own schema, actually four of them, depending on the type of add-in and the features it uses. The schemas are:

- [Task pane 1.0](https://learn.microsoft.com/en-us/openspecs/office_file_formats/ms-owemxml/82e93ec5-de22-42a8-86e3-353c8336aa40)
- [Content 1.0](https://learn.microsoft.com/en-us/openspecs/office_file_formats/ms-owemxml/c9cb8dca-e9e7-45a7-86b7-f1f0833ce2c7)
- [Mail 1.0](https://learn.microsoft.com/en-us/openspecs/office_file_formats/ms-owemxml/578d8214-2657-4e6a-8485-25899e772fac)
- [Mail 1.1](https://learn.microsoft.com/en-us/openspecs/office_file_formats/ms-owemxml/8e722c85-eb78-438c-94a4-edac7e9c533a)

When a VersionOverrides element is used, then the OfficeApp element must have a xmlns attribute that identifies the appropriate schema. The possible values of the attribute are the following:


- http://schemas.microsoft.com/office/taskpaneappversionoverrides
- http://schemas.microsoft.com/office/contentappversionoverrides
- http://schemas.microsoft.com/office/mailappversionoverrides

The VersionOverrides element itself must also have an xmlns attribute specifying the schema. The possible values are the three above and the following:

- http://schemas.microsoft.com/office/mailappversionoverrides/1.1
The VersionOverrides element also must have an xsi:type attribute that specifies the schema version. The possible values are the following:

- VersionOverridesV1_0
- VersionOverridesV1_1

The following are examples of VersionOverrides used, respectively, in a task pane add-in and a mail add-in. Note that when a mail VersionOverrides with version 1.1 is used, it must be the last child of a parent VersionOverrides of type 1.0. The values of child elements in the inner VersionOverrides override the values of the same-named elements in the parent VersionOverrides and the grandparent OfficeApp element.

```
XML
```

```
<VersionOverrides
xmlns="http://schemas.microsoft.com/office/taskpaneappversionoverrides"
xsi:type="VersionOverridesV1_0">
 <!-- Child elements are omitted. -->
</VersionOverrides>
```
#### XML

```
<VersionOverrides
xmlns="http://schemas.microsoft.com/office/mailappversionoverrides"
xsi:type="VersionOverridesV1_0">
 <!-- Other child elements are omitted. -->
 <VersionOverrides
xmlns="http://schemas.microsoft.com/office/mailappversionoverrides/1.1"
xsi:type="VersionOverridesV1_1">
 <!-- Child elements are omitted. -->
 </VersionOverrides>
</VersionOverrides>
```
For an example of a manifest that includes a VersionOverrides element, see Manifest v1.1 XML file examples and schemas.


## **Requirements**

The **<Requirements>** element specifies the set of APIs available to the add-in. For detailed information about requirement sets, see Office requirement sets availability. For example, in an Outlook add-in, the requirement set must be Mailbox and a value of 1.1 or above.

The **<Requirements>** element can also appear in the **<VersionOverrides>** element, allowing the add-in to specify a different requirement when loaded in clients that support **<VersionOverrides>**.

The following example uses the **DefaultMinVersion** attribute of the **<Sets>** element to require office.js version 1.1 or higher, and the **MinVersion** attribute of the **<Set>** element to require the Mailbox requirement set version 1.1.

```
XML
<OfficeApp>
...
 <Requirements>
 <Sets DefaultMinVersion="1.1">
 <Set Name="MailBox" MinVersion="1.1" />
 </Sets>
 </Requirements>
...
</OfficeApp>
```
# **Localization**

Some aspects of the add-in need to be localized for different locales, such as the name, description and the URL that's loaded. These elements can easily be localized by specifying the default value and then locale overrides in the **<Resources>** element within the **<VersionOverrides>** element. The following shows how to override an image, a URL, and a string.

```
XML
<Resources>
 <bt:Images>
 <bt:Image id="icon1_16x16"
DefaultValue="https://contoso.com/images/app_icon_small.png" >
 <bt:Override Locale="ar-sa"
Value="https://contoso.com/images/app_icon_small_arsa.png" />
 <!-- Add information for other locales. -->
 </bt:Image>
 </bt:Images>
```


```
 <bt:Urls>
 <bt:Url id="residDesktopFuncUrl"
DefaultValue="https://contoso.com/urls/page_appcmdcode.html" >
 <bt:Override Locale="ar-sa"
Value="https://contoso.com/urls/page_appcmdcode.html?lcid=ar-sa" />
 <!-- Add information for other locales. -->
 </bt:Url>
 </bt:Urls>
 <bt:ShortStrings>
 <bt:String id="residViewTemplates" DefaultValue="Launch My Add-in">
 <bt:Override Locale="ar-sa" Value="<add localized value here>" />
 <!-- Add information for other locales. -->
 </bt:String>
 </bt:ShortStrings>
</Resources>
```
The [schema reference](https://learn.microsoft.com/en-us/openspecs/office_file_formats/ms-owemxml/c6a06390-34b8-4b42-82eb-b28be12494a8) contains full information on which elements can be localized.

### **Manifest v1.1 XML file examples and schemas**

The following sections show examples of manifest v1.1 XML files for content, task pane, and mail (Outlook) add-ins.

```
Add-in manifest schemas
  XML
Task pane
  <?xml version="1.0" encoding="utf-8"?>
  <OfficeApp xmlns="http://schemas.microsoft.com/office/appforoffice/1.1"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:bt="http://schemas.microsoft.com/office/officeappbasictypes/1.0"
  xmlns:ov="http://schemas.microsoft.com/office/taskpaneappversionoverrides"
  xsi:type="TaskPaneApp">
   <!-- See https://github.com/OfficeDev/Office-Add-in-Commands-Samples for
  documentation. -->
   <!-- BeginBasicSettings: Add-in metadata, used for all versions of Office
  unless override provided. -->
   <!-- IMPORTANT! Id must be unique for your add-in. If you copy this
  manifest, ensure that you change this ID to your own GUID. -->
   <Id>e504fb41-a92a-4526-b101-542f357b7acb</Id>
   <Version>1.0.0.0</Version>
   <ProviderName>Contoso</ProviderName>
   <DefaultLocale>en-US</DefaultLocale>
   <!-- The display name of your add-in. Used on the store and various placed
```


```
of the Office UI such as the add-in's dialog. -->
 <DisplayName DefaultValue="Add-in Commands Sample" />
 <Description DefaultValue="Sample that illustrates add-in commands basic
control types and actions." />
 <!-- Icon for your add-in. Used on installation screens and the add-in's
dialog. -->
 <IconUrl DefaultValue="https://contoso.com/assets/icon-32.png" />
 <HighResolutionIconUrl DefaultValue="https://contoso.com/assets/hi-res-
icon.png" />
 <SupportUrl DefaultValue="[Insert the URL of a page that provides support
information for the app]" />
 <!-- Domains that are allowed when navigating. For example, if you use
ShowTaskpane and then have an href link, navigation is only allowed if the
domain is on this list. -->
 <AppDomains>
 <AppDomain>AppDomain1</AppDomain>
 <AppDomain>AppDomain2</AppDomain>
 </AppDomains>
 <!-- End Basic Settings. -->
 <!-- BeginTaskPaneMode integration. Any client that doesn't understand
commands will use this section.
 This section will also be used if there are no VersionOverrides. -->
 <Hosts>
 <Host Name="Document"/>
 </Hosts>
 <DefaultSettings>
 <SourceLocation
DefaultValue="https://commandsimple.azurewebsites.net/Taskpane.html" />
 </DefaultSettings>
 <!-- EndTaskPaneMode integration. -->
 <Permissions>ReadWriteDocument</Permissions>
 <!-- BeginAddinCommandsMode integration. -->
 <VersionOverrides
xmlns="http://schemas.microsoft.com/office/taskpaneappversionoverrides"
xsi:type="VersionOverridesV1_0">
 <Hosts>
 <!-- Each host can have a different set of commands. Cool huh!? -->
 <!-- Workbook=Excel, Document=Word, Presentation=PowerPoint -->
 <!-- Make sure the hosts you override match the hosts declared in the
top section of the manifest. -->
 <Host xsi:type="Document">
 <!-- Form factor. DesktopFormFactor is supported. Other form factors
are available depending on the host and feature. -->
 <DesktopFormFactor>
 <!-- This code enables a customizable message to be displayed when
the add-in is loaded successfully upon individual install. -->
 <GetStarted>
 <!-- Title of the Getting Started callout. The resid attribute
points to a ShortString resource. -->
 <Title resid="Contoso.GetStarted.Title"/>
 <!-- Description of the Getting Started callout. resid points to a
LongString resource. -->
```


```
 <Description resid="Contoso.GetStarted.Description"/> 
 <!-- Points to a URL resource which details how the add-in should
be used. -->
 <LearnMoreUrl resid="Contoso.GetStarted.LearnMoreUrl"/>
 </GetStarted>
 <!-- Function file is an HTML page that includes, or loads, the
JavaScript where functions for ExecuteAction will be called. Think of the
FunctionFile as the "code behind" ExecuteFunction. -->
 <FunctionFile resid="Contoso.FunctionFile.Url" />
 <!-- PrimaryCommandSurface==Main Office app ribbon. -->
 <ExtensionPoint xsi:type="PrimaryCommandSurface">
 <!-- Use OfficeTab to extend an existing Tab. Use CustomTab to
create a new tab. -->
 <!-- Documentation includes all the IDs currently tested to work.
-->
 <CustomTab id="Contoso.Tab1">
 <!--Group ID-->
 <Group id="Contoso.Tab1.Group1">
 <!--Label for your group. resid must point to a ShortString
resource. -->
 <Label resid="Contoso.Tab1.GroupLabel" />
 <Icon>
 <!-- Each size needs its own icon resource or it will look
distorted when resized. -->
 <!-- Icons. Required sizes: 16, 32, 80; optional: 20, 24,
40, 48, 64. You should provide as many sizes as possible for a great user
experience. -->
 <!-- Use PNG icons and remember that all URLs on the
resources section must use HTTPS. -->
 <bt:Image size="16" resid="Contoso.TaskpaneButton.Icon16" />
 <bt:Image size="32" resid="Contoso.TaskpaneButton.Icon32" />
 <bt:Image size="80" resid="Contoso.TaskpaneButton.Icon80" />
 </Icon>
 <!-- Control. It can be of type "Button" or "Menu". -->
 <Control xsi:type="Button" id="Contoso.FunctionButton">
 <!-- Label for your button. resid must point to a
ShortString resource. -->
 <Label resid="Contoso.FunctionButton.Label" />
 <Supertip>
 <!-- ToolTip title. resid must point to a ShortString
resource. -->
 <Title resid="Contoso.FunctionButton.Label" />
 <!-- ToolTip description. resid must point to a LongString
resource. -->
 <Description resid="Contoso.FunctionButton.Tooltip" />
 </Supertip>
 <Icon>
 <bt:Image size="16" resid="Contoso.FunctionButton.Icon16"
/>
 <bt:Image size="32" resid="Contoso.FunctionButton.Icon32"
/>
 <bt:Image size="80" resid="Contoso.FunctionButton.Icon80"
/>
```


```
 </Icon>
 <!-- This is what happens when the command is triggered
(e.g., click on the ribbon button). -->
 <!-- Supported actions are ExecuteFunction or ShowTaskpane.
-->
 <!-- Look at the FunctionFile.html page for reference on how
to implement the function. -->
 <Action xsi:type="ExecuteFunction">
 <!-- Name of the function to call. This function needs to
exist in the global DOM namespace of the function file. -->
 <FunctionName>writeText</FunctionName>
 </Action>
 </Control>
 <Control xsi:type="Button" id="Contoso.TaskpaneButton">
 <Label resid="Contoso.TaskpaneButton.Label" />
 <Supertip>
 <Title resid="Contoso.TaskpaneButton.Label" />
 <Description resid="Contoso.TaskpaneButton.Tooltip" />
 </Supertip>
 <Icon>
 <bt:Image size="16" resid="Contoso.TaskpaneButton.Icon16"
/>
 <bt:Image size="32" resid="Contoso.TaskpaneButton.Icon32"
/>
 <bt:Image size="80" resid="Contoso.TaskpaneButton.Icon80"
/>
 </Icon>
 <Action xsi:type="ShowTaskpane">
 <TaskpaneId>Button2Id1</TaskpaneId>
 <!-- Provide a URL resource ID for the location that will
be displayed on the task pane. -->
 <SourceLocation resid="Contoso.Taskpane1.Url" />
 </Action>
 </Control>
 <!-- Menu example. -->
 <Control xsi:type="Menu" id="Contoso.Menu">
 <Label resid="Contoso.Dropdown.Label" />
 <Supertip>
 <Title resid="Contoso.Dropdown.Label" />
 <Description resid="Contoso.Dropdown.Tooltip" />
 </Supertip>
 <Icon>
 <bt:Image size="16" resid="Contoso.TaskpaneButton.Icon16"
/>
 <bt:Image size="32" resid="Contoso.TaskpaneButton.Icon32"
/>
 <bt:Image size="80" resid="Contoso.TaskpaneButton.Icon80"
/>
 </Icon>
 <Items>
 <Item id="Contoso.Menu.Item1">
 <Label resid="Contoso.Item1.Label"/>
 <Supertip>
 <Title resid="Contoso.Item1.Label" />
```


```
 <Description resid="Contoso.Item1.Tooltip" />
 </Supertip>
               <Icon>
 <bt:Image size="16"
resid="Contoso.TaskpaneButton.Icon16" />
 <bt:Image size="32"
resid="Contoso.TaskpaneButton.Icon32" />
 <bt:Image size="80"
resid="Contoso.TaskpaneButton.Icon80" />
 </Icon>
               <Action xsi:type="ShowTaskpane">
 <TaskpaneId>MyTaskPaneID1</TaskpaneId>
 <SourceLocation resid="Contoso.Taskpane1.Url" />
 </Action>
 </Item>
 <Item id="Contoso.Menu.Item2">
 <Label resid="Contoso.Item2.Label"/>
 <Supertip>
 <Title resid="Contoso.Item2.Label" />
 <Description resid="Contoso.Item2.Tooltip" />
 </Supertip>
               <Icon>
 <bt:Image size="16"
resid="Contoso.TaskpaneButton.Icon16" />
 <bt:Image size="32"
resid="Contoso.TaskpaneButton.Icon32" />
 <bt:Image size="80"
resid="Contoso.TaskpaneButton.Icon80" />
 </Icon>
               <Action xsi:type="ShowTaskpane">
 <TaskpaneId>MyTaskPaneID2</TaskpaneId>
 <SourceLocation resid="Contoso.Taskpane2.Url" />
 </Action>
 </Item>
 </Items>
 </Control>
 </Group>
 <!-- Label of your tab. -->
 <!-- If validating with XSD, it needs to be at the end. -->
 <Label resid="Contoso.Tab1.TabLabel" />
 </CustomTab>
 </ExtensionPoint>
 </DesktopFormFactor>
 </Host>
 </Hosts>
 <!-- You can use resources across hosts and form factors. -->
 <Resources>
 <bt:Images>
 <bt:Image id="Contoso.TaskpaneButton.Icon16"
DefaultValue="https://myCDN/Images/Button16x16.png" />
```


```
 <bt:Image id="Contoso.TaskpaneButton.Icon32"
DefaultValue="https://myCDN/Images/Button32x32.png" />
 <bt:Image id="Contoso.TaskpaneButton.Icon80"
DefaultValue="https://myCDN/Images/Button80x80.png" />
 <bt:Image id="Contoso.FunctionButton.Icon"
DefaultValue="https://myCDN/Images/ButtonFunction.png" />
 </bt:Images>
 <bt:Urls>
 <bt:Url id="Contoso.FunctionFile.Url"
DefaultValue="https://commandsimple.azurewebsites.net/FunctionFile.html" />
 <bt:Url id="Contoso.Taskpane1.Url"
DefaultValue="https://commandsimple.azurewebsites.net/Taskpane.html" />
 <bt:Url id="Contoso.Taskpane2.Url"
DefaultValue="https://commandsimple.azurewebsites.net/Taskpane2.html" />
 </bt:Urls>
 <!-- ShortStrings max characters=125. -->
 <bt:ShortStrings>
 <bt:String id="Contoso.FunctionButton.Label" DefaultValue="Execute
Function" />
 <bt:String id="Contoso.TaskpaneButton.Label" DefaultValue="Show Task
Pane" />
 <bt:String id="Contoso.Dropdown.Label" DefaultValue="Dropdown" />
 <bt:String id="Contoso.Item1.Label" DefaultValue="Show Task Pane 1" />
 <bt:String id="Contoso.Item2.Label" DefaultValue="Show Task Pane 2" />
 <bt:String id="Contoso.Tab1.GroupLabel" DefaultValue="Test Group" />
 <bt:String id="Contoso.Tab1.TabLabel" DefaultValue="Test Tab" />
 </bt:ShortStrings>
 <!-- LongStrings max characters=250. -->
 <bt:LongStrings>
 <bt:String id="Contoso.FunctionButton.Tooltip" DefaultValue="Click to
execute function." />
 <bt:String id="Contoso.TaskpaneButton.Tooltip" DefaultValue="Click to
show a task pane." />
 <bt:String id="Contoso.Dropdown.Tooltip" DefaultValue="Click to show
options on this menu." />
 <bt:String id="Contoso.Item1.Tooltip" DefaultValue="Click to show Task
Pane 1." />
 <bt:String id="Contoso.Item2.Tooltip" DefaultValue="Click to show Task
Pane 2." />
 </bt:LongStrings>
 </Resources>
 </VersionOverrides>
 <!-- EndAddinCommandsMode integration. -->
</OfficeApp>
```
## **Validate an Office Add-in's manifest**

For information about validating a manifest against the [XML Schema Definition (XSD),](https://learn.microsoft.com/en-us/openspecs/office_file_formats/ms-owemxml/c6a06390-34b8-4b42-82eb-b28be12494a8) see Validate an Office Add-in's manifest.


## **See also**

- How to find the proper order of add-in only manifest elements
- Create add-in commands with the add-in only manifest
- Specify Office applications and API requirements
- Localization for Office Add-ins
- [Schema reference for XML Office Add-ins manifests](https://learn.microsoft.com/en-us/openspecs/office_file_formats/ms-owemxml/c6a06390-34b8-4b42-82eb-b28be12494a8)
- Make your Office Add-in compatible with an existing COM or VSTO add-in
- Requesting permissions for API use in add-ins
- Validate an Office Add-in's manifest

# **Warnings and dependencies in the Node.js and npm world**

07/04/2025

COM and VSTO add-in developers who are new to the world of [Node Package Manager](https://www.npmjs.com/) [(npm)](https://www.npmjs.com/) and open source development are often surprised and alarmed at certain aspects of this kind of development. This article is intended to reassure such developers about things they may find disconcerting.

# **npm dependency tree**

npm is the standard package manager for the JavaScript runtime environment Node.js. It's used to streamline JavaScript development workflows by enabling developers to install open source libraries and tools (collectively called "packages"), and to manage package dependencies.

The npm dependency tree is a hierarchical structure that represents all the packages your Node.js project depends on. Each node in the tree is a package, and its children are the packages it depends on. This structure can become deeply nested, especially in large projects or when using packages with many transitive dependencies.

When you run npm install , npm reads the package.json and package-lock.json files in a development project to build this tree and fetch the required packages.

# **Understand npm install warnings**

When you run npm install , it's common to see a flurry of warnings in the console. This can be surprising at first, but it's a normal part of working in the Node.js and open source ecosystem. Microsoft tools that call npm install , including the Yeoman Generator for Office Add-ins, report these same warnings.

It's beyond the scope of this article to discuss every kind of warning that npm install might report, but there are two kinds that are especially likely to be disconcerting to developers who are new to the Node.js world.

### **Deprecation warnings**

These warnings mean that the managers of a package somewhere in the dependency tree are no longer maintaining it and they may remove it from the Internet at some future time. Neither 


you, nor Microsoft, has any control over the package deprecation warnings, but you can almost always ignore them. Deprecation doesn't mean that the package has stopped working. It still works and because installation puts a copy of it on your computer, it'll continue to work with your project in the future even if the package is removed from the Internet. The package isn't a web service.

It's very unlikely, but possible, that you'll see a deprecation warning for a package that's at the *top* of the dependency tree. These are the packages that are explicitly listed in the "dependencies" or "devDependencies" sections of the project's package.json file. You can ignore deprecation warnings for "devDependencies" for the same reason given earlier: the code is copied to your development computer. Packages in the "dependencies" section are used by your add-in at runtime, but even deprecation warnings for these can be ignored in projects that are created with Microsoft tools like the Yeoman Generator for Office Add-ins and Microsoft 365 Agent Toolkit because these tools include copies of the libraries in bundles of JavaScript code that your add-in's web server will serve.

#### 7 **Note**

One situation in which the deprecation of a library in the "dependencies" section is a matter of concern is the following:

- The library is in the "dependencies" section only so you can use it while testing and debugging locally.
- Your plan, when you deploy the add-in for staging or production, is to not include a copy of the library in the code that your server hosts.
- Instead, you plan to have the add-in load the library from a web service that hosts npm libraries, such as unpkg.com or cdn.jsdelivr.net.

If this describes your deployment strategy, then there's a danger that your deployed addin will stop working if the deprecated library is removed from the web service. So, treat the deprecation warning as a notice that you need to redesign your add-in so that it doesn't use the deprecated library.

#### **Security or audit warnings**

Security warnings, also called audit warnings, mean that there's a version of the package in the dependency tree that has a known security vulnerability that a hacker could take advantage of. Microsoft periodically checks for these warnings in projects created by our tools and fixes them, usually by updating the library to a newer version that doesn't have the vulnerability. But new vulnerabilities are discovered and reported almost daily to the security alert databases that


npm install monitors, and Microsoft cannot always fix them right away. For this reason, it isn't uncommon that running npm install in an add-in project reports security vulnerabilities.

When the dependency can be traced to a top-level package in the "devDependencies" section of package.json, then you can ignore it. The code is only running on your computer, and you're not going to hack yourself.

If the dependency traces to a top-level package in the "dependencies" section, or you cannot determine the top-level package, then you should try to fix the vulnerability before you deploy the add-in to production. There's lots of good information on the Internet about how to deal with vulnerabilities in npm packages. We'll mention one technique here. Some vulnerabilities can be fixed automatically by npm. Just run the command npm audit fix in the folder where the package.json file is. If there's a newer version of the package that doesn't have the vulnerability and the newer version doesn't have any breaking changes relative to the vulnerable version, then npm will automatically update the package to the safe version.

Another strategy is to take a few minutes every couple of weeks to create a new add-in project with the same Microsoft tool as you created your original project. (Choose the same options for project type,, language, Office application, etc.) If npm install no longer reports the security vulnerability on the new project, then Microsoft has fixed it in the project template. You can move the fix to your project with the following steps.

- 1. Copy the "dependencies" section of from the new project over the same section in the **package.json** of the original project.
- 2. Delete the **node_modules** folder from the original project.
- 3. Run npm install in the original project.

# **Errors**

An npm *error*, as distinct from a warning, immediately stops the processing of the npm command, including npm install . You must diagnose and fix the problem. Sometimes the error is a side effect of a temporary network problem when npm tries to fetch a package. Try rerunning npm install .

#### 7 **Note**

Running npm install is the last thing that the Yeoman Generator for Office Add-ins does when it creates a project. If an error is reported, you don't need to rerun the generator because the project has been fully created. You can just rerun npm install at the command line.


# **Tutorial: Share code between both a VSTO Add-in and an Office Add-in with a shared code library**

Article • 05/19/2025

Visual Studio Tools for Office (VSTO) Add-ins are great for extending Office to provide solutions for your business or others. They've been around for a long time and there are thousands of solutions built with VSTO. However, they only run on Office on Windows. You can't run VSTO Add-ins on Mac, on the web, or on mobile platforms.

#### ) **Important**

COM and VSTO add-ins aren't supported in the **[new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** . These addins are still supported in the classic Outlook on Windows desktop client. To learn more, see **Develop Outlook add-ins for new Outlook on Windows**.

Office Add-ins use HTML, JavaScript, and additional web technologies to build Office solutions on all platforms. Migrating your existing VSTO Add-in to an Office Add-in is a great way to make your solution available across all platforms.

You may want to maintain both your VSTO Add-in and a new Office Add-in that both have the same functionality. This enables you to continue servicing your customers that use the VSTO Add-in on Office on Windows. This also enables you to provide the same functionality in an Office Add-in for customers across all platforms. You can also Make your Office Add-in compatible with the existing VSTO Add-in.

However, it's best to avoid rewriting all the code from your VSTO Add-in for the Office Add-in. This tutorial shows how to avoid rewriting code by using a shared code library for both addins.

## **Shared code library**

This tutorial walks you through the steps of identifying and sharing common code between your VSTO Add-in and a modern Office Add-in. It uses a very simple VSTO Add-in example for the steps so that you can focus on the skills and techniques you'll need to work with your own VSTO Add-ins.

The following diagram shows how the shared code library works for migration. Common code is refactored into a new shared code library. The code can remain written in its original language, such as C# or VB. This means you can continue using the code in the existing VSTO


Add-in by creating a project reference. When you create the Office Add-in, it will also use the shared code library by calling into it through REST APIs.

Skills and techniques in this tutorial:

- Create a shared class library by refactoring code into a .NET class library.
- Create a REST API wrapper using ASP.NET Core for the shared class library.
- Call the REST API from the Office Add-in to access shared code.

# **Prerequisites**

To set up your development environment:

- 1. Install [Visual Studio 2022](https://visualstudio.microsoft.com/downloads/) .
- 2. Install the following workloads.
	- ASP.NET and web development
	- .NET Core cross-platform development
	- Office/SharePoint development
	- The following **Individual** components.
		- Visual Studio Tools for Office (VSTO)
		- .NET Core 9.0 Runtime

You also need the following:


- A Microsoft 365 account. You might qualify for a Microsoft 365 E5 developer subscription, which includes Office apps, through the [Microsoft 365 Developer Program](https://aka.ms/m365devprogram) ; for details, see the [FAQ](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-). Alternatively, you can [sign up for a 1-month free trial](https://www.microsoft.com/microsoft-365/try) or [purchase a](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g) [Microsoft 365 plan](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g) .
- A Microsoft Azure Tenant. A trial subscription can be acquired here: [Microsoft Azure](https://account.windowsazure.com/SignUp) .

# **The Cell analyzer VSTO Add-in**

This tutorial uses the [VSTO Add-in shared library for Office Add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/VSTO-shared-code-migration) PnP solution. The **/start** folder contains the VSTO Add-in solution that you'll migrate. Your goal is to migrate the VSTO Add-in to a modern Office Add-in by sharing code when possible.

#### 7 **Note**

The sample uses C#, but you can apply the techniques in this tutorial to a VSTO Add-in written in any .NET language.

- 1. Download the [VSTO Add-in shared library for Office Add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/VSTO-shared-code-migration) sample to a working folder on your computer.
- 2. Start Visual Studio and open the **/start/Cell-Analyzer.sln** solution.
- 3. On the **Debug** menu, choose **Start Debugging**.

The add-in is a custom task pane for Excel. You can select any cell with text, and then choose the **Show unicode** button. In the **Result** section, the add-in displays a list of each character in the text along with its corresponding Unicode number.

# **Analyze types of code in the VSTO Add-in**

The first technique to apply is to analyze the add-in for which parts of code can be shared. In general, the project breaks down into three types of code.


### **UI code**

UI code interacts with the user. In VSTO UI code works through Windows Forms. Office Add-ins use HTML, CSS, and JavaScript for UI. Because of these differences, you can't share UI code with the Office Add-in. The UI needs to be recreated in JavaScript.

### **Document code**

In VSTO, code interacts with the document through .NET objects, such as Microsoft.Office.Interop.Excel.Range . However, Office Add-ins use the Office JavaScript library (also called Office.js). Although these are similar, they aren't exactly the same. So again, you can't share document interaction code with the Office Add-in.

### **Logic code**

Business logic, algorithms, helper functions, and similar code often make up the heart of a VSTO Add-in. This code works independently of the UI and document code to perform analysis, connect to backend services, run calculations, and more. This is the code that can be shared so that you don't have to rewrite it in JavaScript.

Let's examine the VSTO Add-in. In the following code, each section is identified as DOCUMENT, UI, or ALGORITHM code.

```
C#
// *** UI CODE ***
private void btnUnicode_Click(object sender, EventArgs e)
{
 // *** DOCUMENT CODE ***
 Microsoft.Office.Interop.Excel.Range rangeCell;
 rangeCell = Globals.ThisAddIn.Application.ActiveCell;
 string cellValue = "";
 if (null != rangeCell.Value)
 {
 cellValue = rangeCell.Value.ToString();
 }
 // *** ALGORITHM CODE ***
 //convert string to Unicode listing
 string result = "";
 foreach (char c in cellValue)
 {
 int unicode = c;
 result += $"{c}: {unicode}\r\n";
```


```
 }
 // *** UI CODE ***
 //Output the result
 txtResult.Text = result;
}
```
Using this approach, you can see that one section of code can be shared with the Office Addin. The following code needs to be refactored into a separate class library.

```
C#
// *** ALGORITHM CODE ***
//convert string to Unicode listing
string result = "";
foreach (char c in cellValue)
{
 int unicode = c;
 result += $"{c}: {unicode}\r\n";
}
```
## **Create a shared class library**

VSTO Add-ins are created in Visual Studio as .NET projects, so we'll reuse .NET as much as possible to keep things simple. Our next technique is to create a class library and refactor shared code into that class library.

- 1. If you haven't already, start Visual Studio 2019 and open the **\start\Cell-Analyzer.sln** solution.
- 2. Right-click (or select and hold) the solution in **Solution Explorer** and choose **Add > New Project**.
- 3. In the **Add a new project dialog**, choose **Class Library (.NET Framework)**, and choose **Next**.

#### 7 **Note**

Don't use the .NET Core class library because it won't work with your VSTO project.

- 4. In the **Configure your new project** dialog, set the following fields.
	- Set the **Project name** to **CellAnalyzerSharedLibrary**.
	- Leave the **Location** at its default value.


- Set the **Framework** to **4.7.2**.
- 5. Choose **Create**.
- 6. After the project is created, rename the **Class1.cs** file to **CellOperations.cs**. A prompt to rename the class appears. Rename the class name so that it matches the file name.
- 7. Add the following code to the CellOperations class to create a method named GetUnicodeFromText .

```
C#
public class CellOperations
{
 static public string GetUnicodeFromText(string value)
 {
 string result = "";
 foreach (char c in value)
 {
 int unicode = c;
 result += $"{c}: {unicode}\r\n";
 }
 return result;
 }
}
```
### **Use the shared class library in the VSTO Add-in**

Now you need to update the VSTO Add-in to use the class library. This is important that both the VSTO Add-in and Office Add-in use the same shared class library so that future bug fixes or features are made in one location.

- 1. In **Solution Explorer**, right-click (or select and hold) the **Cell-Analyzer** project and choose **Add Reference**.
- 2. Select **CellAnalyzerSharedLibrary**, and choose **OK**.
- 3. In **Solution Explorer**, expand the **Cell-Analyzer** project, right-click (or select and hold) the **CellAnalyzerPane.cs** file and choose **View Code**.
- 4. In the btnUnicode_Click method, delete the following lines of code.

```
C#
//Convert to Unicode listing
string result = "";
```


```
foreach (char c in cellValue)
{
 int unicode = c;
 result += $"{c}: {unicode}\r\n";
}
```
- 5. Update the line of code under the //Output the result comment to read as follows:

```
C#
//Output the result
txtResult.Text =
CellAnalyzerSharedLibrary.CellOperations.GetUnicodeFromText(cellValue);
```
- 6. On the **Debug** menu, choose **Start Debugging**. The custom task pane should work as expected. Enter some text in a cell, and then test that you can convert it to a Unicode list with the add-in.
# **Create a REST API wrapper**

The VSTO Add-in can use the shared class library directly since they are both .NET projects. However the Office Add-in won't be able to use .NET since it uses JavaScript. Next, you'll create a REST API wrapper. This enables the Office Add-in to call a REST API, which then passes the call along to the shared class library.

- 1. In **Solution Explorer**, right-click (or select and hold) the **Cell-Analyzer** project and choose **Add > New Project**.
- 2. In the **Add a new project dialog**, choose **ASP.NET Core Web Application**, and choose **Next**.
- 3. In the **Configure your new project** dialog, set the following fields.
	- Set the **Project name** to **CellAnalyzerRESTAPI**.
	- In the **Location** field, leave the default value.
- 4. Choose **Create**.
- 5. In the **Create a new ASP.NET Core web application** dialog, select **ASP.NET Core 3.1** for the version, and select **API** in the list of projects.
- 6. Leave all other fields at default values and choose the **Create** button.
- 7. After the project is created, expand the **CellAnalyzerRESTAPI** project in **Solution Explorer**.


- 8. Right-click (or select and hold) **Dependencies** and choose **Add Reference**.
- 9. Select **CellAnalyzerSharedLibrary**, and choose **OK**.
- 10. Right-click (or select and hold) the **Controllers** folder and choose **Add > Controller**.
- 11. In the **Add New Scaffolded Item** dialog, choose **API Controller Empty**, then choose **Add**.
- 12. In the **Add Empty API Controller** dialog, name the controller **AnalyzeUnicodeController**, then choose **Add**.
- 13. Open the **AnalyzeUnicodeController.cs** file and add the following code as a method to the AnalyzeUnicodeController class.

```
C#
[HttpGet]
public ActionResult<string> AnalyzeUnicode(string value)
{
 if (value == null)
 {
 return BadRequest();
 }
 return CellAnalyzerSharedLibrary.CellOperations.GetUnicodeFromText(value);
}
```
- 14. Right-click (or select and hold) the **CellAnalyzerRESTAPI** project and choose **Set as Startup Project**.
- 15. On the **Debug** menu, choose **Start Debugging**.
- 16. A browser will launch. Enter the following URL to test that the REST API is working: https://localhost:<ssl port number>/api/analyzeunicode?value=test . You can reuse the port number from the URL in the browser that Visual Studio launched. You should see a string returned with Unicode values for each character.

# **Create the Office Add-in**

When you create the Office Add-in, it will make a call to the REST API. But first, you need to get the port number of the REST API server and save it for later.

#### **Save the SSL port number**


- 1. If you haven't already, start Visual Studio 2019, and open the **\start\Cell-Analyzer.sln** solution.
- 2. In the **CellAnalyzerRESTAPI** project, expand **Properties**, and open the **launchSettings.json** file.
- 3. Find the line of code with the **sslPort** value, copy the port number, and save it somewhere.

#### **Add the Office Add-in project**

To keep things simple, keep all the code in one solution. Add the Office Add-in project to the existing Visual Studio solution. However, if you're familiar with the Yeoman generator for Office Add-ins and Visual Studio Code, you can also run yo office to build the project. The steps are very similar.

- 1. In **Solution Explorer**, right-click (or select and hold) the **Cell-Analyzer** solution and choose **Add > New Project**.
- 2. In the **Add a new project dialog**, choose **Excel Web Add-in**, and choose **Next**.
- 3. In the **Configure your new project** dialog, set the following fields.
	- Set the **Project name** to **CellAnalyzerOfficeAddin**.
	- Leave the **Location** at its default value.
	- Set the **Framework** to **4.7.2** or later.
- 4. Choose **Create**.
- 5. In the **Choose the add-in type** dialog, select **Add new functionalities to Excel**, and choose **Finish**.

Two projects will be created:

- **CellAnalyzerOfficeAddin** This project configures the manifest XML files that describes the add-in so Office can load it correctly. It contains the ID, name, description, and other information about the add-in.
- **CellAnalyzerOfficeAddinWeb** This project contains web resources for your add-in, such as HTML, CSS, and scripts. It also configures an IIS Express instance to host your add-in as a web application.

## **Add UI and functionality to the Office Add-in**

- 1. In **Solution Explorer**, expand the **CellAnalyzerOfficeAddinWeb** project.
- 2. Open the **Home.html** file, and replace the <body> contents with the following HTML.

HTML


```
<button id="btnShowUnicode" onclick="showUnicode()">Show Unicode</button>
<p>Result:</p>
<div id="txtResult"></div>
```
- 3. Open the **Home.js** file, and replace the entire contents with the following code.

```
JavaScript
(function () {
 "use strict";
 // The initialize function must be run each time a new page is loaded.
 Office.initialize = function (reason) {
 $(document).ready(function () {
 });
 };
})();
function showUnicode() {
 Excel.run(function (context) {
 const range = context.workbook.getSelectedRange();
 range.load("values");
 return context.sync(range).then(function (range) {
 const url = "https://localhost:<ssl port number>/api/analyzeunicode?
value=" + range.values[0][0];
 $.ajax({
 type: "GET",
 url: url,
 success: function (data) {
 let htmlData = data.replace(/\r\n/g, '<br>');
 $("#txtResult").html(htmlData);
 },
 error: function (data) {
 $("#txtResult").html("error occurred in ajax call.");
 }
 });
 });
 });
}
```
- 4. In the previous code, enter the **sslPort** number you saved previously from the **launchSettings.json** file.
In the previous code, the returned string will be processed to replace carriage return line feeds with <br> HTML tags. You may occasionally run into situations where a return value that works perfectly fine for .NET in the VSTO Add-in will need to be adjusted on the Office Add-in side to work as expected. In this case, the REST API and shared class library are only concerned with returning the string. The showUnicode() function is responsible for formatting return values correctly for presentation.


### **Allow CORS from the Office Add-in**

The Office.js library requires CORS on outgoing calls, such as the one made from the ajax call to the REST API server. Use the following steps to allow calls from the Office Add-in to the REST API.

- 1. In **Solution Explorer**, select the **CellAnalyzerOfficeAddinWeb** project.
- 2. From the **View** menu, choose **Properties Window**, if the window isn't already displayed.
- 3. In the properties window, copy the value of the **SSL URL**, and save it somewhere. This is the URL that you need to allow through CORS.
- 4. In the **CellAnalyzerRESTAPI** project, open the **Startup.cs** file.
- 5. Add the following code to the top of the ConfigureServices method. Be sure to substitute the URL SSL you copied previously for the builder.WithOrigins call.

```
C#
services.AddCors(options =>
{
 options.AddPolicy(MyAllowSpecificOrigins,
 builder =>
 {
 builder.WithOrigins("<your URL SSL>")
 .AllowAnyMethod()
 .AllowAnyHeader();
 });
});
```
#### 7 **Note**

Leave the trailing / from the end of the URL when you use it in the builder.WithOrigins method. For example, it should appear similar to https://localhost:44000 . Otherwise, you'll get a CORS error at runtime.

- 6. Add the following field to the Startup class.
C#

readonly string MyAllowSpecificOrigins = "_myAllowSpecificOrigins";


- 7. Add the following code to the configure method just before the line of code for app.UseEndpoints .

```
C#
app.UseCors(MyAllowSpecificOrigins);
```
When done, your Startup class should look similar to the following code (your localhost URL may be different).

```
C#
public class Startup
{
 public Startup(IConfiguration configuration)
 {
 Configuration = configuration;
 }
 readonly string MyAllowSpecificOrigins = "_myAllowSpecificOrigins";
 public IConfiguration Configuration { get; }
 // NOTE: The following code configures CORS for the localhost:44397 port.
 // This is for development purposes. In production code, you should update
this to 
 // use the appropriate allowed domains.
 public void ConfigureServices(IServiceCollection services)
 {
 services.AddCors(options =>
 {
 options.AddPolicy(MyAllowSpecificOrigins,
 builder =>
 {
 builder.WithOrigins("https://localhost:44397")
 .AllowAnyMethod()
 .AllowAnyHeader();
 });
 });
 services.AddControllers();
 }
 // This method gets called by the runtime. Use this method to configure the
```

```
HTTP request pipeline.
 public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
 {
 if (env.IsDevelopment())
 {
```

```
 app.UseDeveloperExceptionPage();
```

```
 }
```


```
 app.UseHttpsRedirection();
 app.UseRouting();
 app.UseAuthorization();
 app.UseCors(MyAllowSpecificOrigins);
 app.UseEndpoints(endpoints =>
 {
 endpoints.MapControllers();
 });
 }
}
```
### **Run the add-in**

- 1. In **Solution Explorer**, right-click (or select and hold) the top node **Solution 'Cell-Analyzer'** and choose **Set Startup Projects**.
- 2. In the **Solution 'Cell-Analyzer' Property Pages** dialog, select **Multiple startup projects**.
- 3. Set the **Action** property to **Start** for each of the following projects.
	- CellAnalyzerRESTAPI
	- CellAnalyzerOfficeAddin
	- CellAnalyzerOfficeAddinWeb
- 4. Choose **OK**.
- 5. From the **Debug** menu, choose **Start Debugging**.

Excel will run and sideload the Office Add-in. You can test that the localhost REST API service is working correctly by entering a text value into a cell, and choosing the **Show Unicode** button in the Office Add-in. It should call the REST API and display the unicode values for the text characters.

# **Publish to an Azure App Service**

You eventually want to publish the REST API project to the cloud. In the following steps you'll see how to publish the **CellAnalyzerRESTAPI** project to a Microsoft Azure App Service. See Prerequisites for information on how to get an Azure account.

- 1. In **Solution Explorer**, right-click (or select and hold) the **CellAnalyzerRESTAPI** project and choose **Publish**.
- 2. In the **Pick a publish target** dialog, select **Create New**, and choose **Create Profile**.


- 3. In the **App Service** dialog, select the correct account, if it isn't already selected.
- 4. The fields for the **App Service** dialog will be set to defaults for your account. Generally, the defaults work fine, but you can change them if you prefer different settings.
- 5. In the **App Service** dialog, choose **Create**.
- 6. The new profile will be displayed in a **Publish** page. Choose **Publish** to build and deploy the code to the App Service.

You can now test the service. Open a browser and enter a URL that goes directly to the new service. For example, use https://<myappservice>.azurewebsites.net/api/analyzeunicode? value=test , where *myappservice* is the unique name you created for the new App Service.

#### **Use the Azure App Service from the Office Add-in**

The final step is to update the code in the Office Add-in to use the Azure App Service instead of localhost.

- 1. In **Solution Explorer**, expand the **CellAnalyzerOfficeAddinWeb** project, and open the **Home.js** file.
- 2. Change the url constant to use the URL for your Azure App Service as shown in the following line of code. Replace <myappservice> with the unique name you created for the new App Service.

```
JavaScript
const url = "https://<myappservice>.azurewebsites.net/api/analyzeunicode?
value=" + range.values[0][0];
```
- 3. In **Solution Explorer**, right-click (or select and hold) the top node **Solution 'Cell-Analyzer'** and choose **Set Startup Projects**.
- 4. In the **Solution 'Cell-Analyzer' Property Pages** dialog, select **Multiple startup projects**.
- 5. Enable the **Start** action for each of the following projects.
	- CellAnalyzerOfficeAddinWeb
	- CellAnalyzerOfficeAddin
- 6. Choose **OK**.
- 7. From the **Debug** menu, choose **Start Debugging**.

Excel will run and sideload the Office Add-in. To test that the App Service is working correctly, enter a text value into a cell, and choose **Show Unicode** in the Office Add-in. It should call the 


service and display the unicode values for the text characters.

# **Conclusion**

In this tutorial, you learned how to create an Office Add-in that uses shared code with the original VSTO add-in. You learned how to maintain both VSTO code for Office on Windows, and an Office Add-in for Office on other platforms. You refactored VSTO C# code into a shared library and deployed it to an Azure App Service. You created an Office Add-in that uses the shared library, so that you don't have to rewrite the code in JavaScript.

# **Office Add-ins prompts for GitHub Copilot**

Article • 06/06/2024

The Office Add-ins prompt library is a collection of prompt examples to use with [GitHub](https://github.com/features/copilot/plans) [Copilot](https://github.com/features/copilot/plans) when you develop Office add-ins. GitHub Copilot is an AI pair-programmer that helps you write code. It's available as an extension for many code editors, such as [Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=GitHub.copilot) and [Visual Studio](https://marketplace.visualstudio.com/items?itemName=GitHub.copilotvs) . You can install and launch the extensions directly through your code editor.

Copy the prompts from this article and enter them into the GitHub Copilot chat to begin experimenting. You can also open the prompt list in your code editor by downloading the file from GitHub at [Office Add-ins prompts for GitHub Copilot on GitHub](https://github.com/OfficeDev/office-js-docs-pr/blob/main/docs/resources/resources-github-copilot-prompt-library.md) .

#### ) **Important**

The prompts in this article are designed to work in English with GitHub Copilot. They've been tested to ensure that Copilot returns relevant responses, but generative AI can inherently return variable responses. Always review code produced by GitHub Copilot for accuracy before publishing or distributing your add-in to users.

We encourage you to customize your own prompts for developing Office Add-ins with GitHub Copilot. To contribute your ideas to this prompt library, review the guidance for [contributing to the Office Add-ins](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md) documentation through GitHub. You can also share your prompts and feedback through the survey at [Office Add-ins prompts feedback](https://aka.ms/promptfeedback) .

# **Prompt examples**

The following sections contain prompts for multiple scenarios when developing and publishing add-ins.

#### **Tip**

Switch out the phrases between asterisks in the prompts to experiment with related scenarios.


# **Guidance for getting started**

code

Show me the typical structure of an Office Add-in project and explain the functionality of each file. Explain the steps and commands to get started in *Visual Studio Code*.

### **Create an add-in project**

#### **Import a document as a Word template**

code

Create an Office JavaScript add-in for *Word* to *import a document as a template*. List the steps to follow in *Visual Studio Code* to create the add-in and insert code snippets in the correct files.

#### **Create a custom function in Excel**

code

Create an Office JavaScript Add-in for *Excel* to *create a custom function in Excel*. List the steps to follow in *Visual Studio Code* to create the add-in and insert code snippets in the correct files.

#### **Insert graphics into a PowerPoint presentation slide**

code

Create an Office JavaScript Add-in for *PowerPoint* to *insert graphics into a presentation slide*. List the steps to follow in *Visual Studio Code* to create the add-in and insert code snippets in the correct files.

# **Implement a feature for Excel add-ins**

**Add a new worksheet**


```
code
```
Add a new worksheet *at the end* using the Excel JavaScript API.

### **Get data from a table**

code

Retrieve the data in the range *A1:B3 on the first worksheet* using the Excel JavaScript API.

### **Create a chart**

code

Insert a line chart titled *"My chart"* into the current worksheet using the data *in the range A1:B3* using the Excel JavaScript API.

### **Create a custom function to conduct calculations in Excel**

code

Create a JavaScript custom function in Excel that conducts a calculation.

### **Handle an event**

code

Handle an event *when selection changes in worksheet* using Excel JavaScript API.

### **Create shapes**

code

Create *a yellow square* shape in the worksheet using the Excel JavaScript API.


#### **Insert a copy of an existing workbook into the current one**

code

Insert a workbook template as base64 in the current workbook using insertWorksheetsFromBase64 Excel JavaScript API.

# **Implement a feature for Word add-ins**

#### **Insert a paragraph**

code

Insert a paragraph with the content *"My paragraph"* at the start of the document using the Word JavaScript API.

### **Apply a style to a paragraph**

code

Apply the style *"Heading1"* to the first paragraph in the document using the Word JavaScript API.

### **Change the font**

code

Change the font formatting of *the selected document text* using the Word JavaScript API.

### **Insert table into a document**

code

Insert a table named "Sample table" with sample data in the document using the Word JavaScript API.


#### **Insert a content control**

code

Insert a content control labeled *"Sample Content Control"* into the first paragraph and *set the content control's color to red* using the Word JavaScript API.

#### **Add a comment**

code

Insert a comment into the document selection using the Word JavaScript API

### **Insert a document into the target document at a specific location**

code

```
Import a file from local storage as a template to the current
document using the Word JavaScript insertFileFromBase64 API.
```
# **Implement a feature for Excel, PowerPoint, or Word add-ins**

### **Add a dialog**

code

```
Show a dialog in the application *when a user clicks a button 
in the add-in* using the Office JavaScript API.
```
#### **Get an access token**

code

Get an access token in an Office Add-in using the Office JavaScript API to authenticate the user with external services or APIs.


# **Guidance for publishing add-ins**

#### **Distribute an add-in to an organization**

code

Tell me how to deploy and distribute the local Office JavaScript add-in code to *all employees in my organization* after development. Provide the steps to follow.

#### **Distribute an add-in to the add-in store**

#### code

Tell me how to deploy and distribute the local Office JavaScript add-in code to the *add-in store* after development. Provide the steps to follow.

### **See also**

- [GitHub Copilot](https://github.com/features/copilot/plans)
#### 6 **Collaborate with us on GitHub**

The source for this content can be found on GitHub, where you can also create and review issues and pull requests. For more information, see [our](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md) [contributor guide](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md).

#### **Office Add-ins feedback**

Office Add-ins is an open source project. Select a link to provide feedback:

- [Open a documentation issue](https://github.com/OfficeDev/office-js-docs-pr/issues/new?template=3-customer-feedback.yml&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Foffice%2Fdev%2Fadd-ins%2Fresources%2Fresources-github-copilot-prompt-library&pageQueryParams=&contentSourceUrl=https%3A%2F%2Fgithub.com%2FOfficeDev%2Foffice-js-docs-pr%2Fblob%2Fmain%2Fdocs%2Fresources%2Fresources-github-copilot-prompt-library.md&documentVersionIndependentId=a80631a8-83dd-5ab5-b30b-11316765130e&feedback=%0A%0A%5BEnter+feedback+here%5D%0A&author=%40o365devx&metadata=*+ID%3A+a80631a8-83dd-5ab5-b30b-11316765130e+%0A*+Service%3A+**microsoft-365**%0A*+Sub-service%3A+**add-ins**)
- [Provide product feedback](https://aka.ms/office-addins-dev-questions)

# **Office Add-ins glossary**

Article • 02/12/2025

This is a glossary of terms commonly used throughout the Office Add-ins documentation.

### **add-in**

Office Add-ins are web applications that extend Office applications. These web applications add new functionality to the Office application, such as bring in external data, automate processes, or embed interactive objects in Office documents.

Office Add-ins differ from VBA, COM, and VSTO add-ins because they offer crossplatform support (usually web, Windows, Mac, and iPad) and are based on standard web technologies (HTML, CSS, and JavaScript). The primary programming language of an Office Add-in is JavaScript or TypeScript.

### **add-in commands**

**Add-in commands** are UI elements, such as buttons and menus, that extend the Office UI for your add-in. When users select an add-in command element, they initiate actions such as running JavaScript code or displaying the add-in in a task pane. Add-in commands let your add-in look and feel like a part of Office, which gives users more confidence in your add-in. See Add-in commands to learn more.

See also: ribbon, ribbon button.

# **application**

**Application** refers to an Office application. The Office applications that support Office Add-ins are Excel, OneNote, Outlook, PowerPoint, Project, and Word.

See also: client, host, Office application, Office client.

# **application-specific API**

Application-specific APIs provide strongly-typed objects that interact with objects that are native to a specific Office application. For example, you call the Excel JavaScript APIs for access to worksheets, ranges, tables, charts, and more. Application-specific APIs are


currently available for Excel, OneNote, PowerPoint, Visio, and Word. See Applicationspecific API model to learn more.

See also: Common API.

### **client**

**Client** typically refers to an Office application. The Office applications, or clients, that support Office Add-ins are Excel, OneNote, Outlook, PowerPoint, Project, and Word.

See also: application, host, Office application, Office client, Office desktop application, Office desktop client, desktop client, desktop.

### **Common API**

Common APIs are used to access features such as UI, dialogs, and client settings that are common across multiple Office applications. This API model uses [callbacks](https://developer.mozilla.org/docs/Glossary/Callback_function) , which allow you to specify only one operation in each request sent to the Office application.

Common APIs were introduced with Office 2013. Some Common APIs are legacy APIs from the early 2010s. Excel, PowerPoint, and Word all have Common API functionality, but most of this functionality has been replaced or superseded by the applicationspecific API model. The application-specific APIs are preferred when possible.

Other Common APIs, such as the Common APIs related to Outlook, UI, and authentication, are the modern and preferred APIs for these purposes. For details about the Common API object model, see Common JavaScript API object model.

See also: application-specific API.

#### **content add-in**

**Content add-ins** are webviews, or web browser views, that are embedded directly into Excel, OneNote, or PowerPoint documents. Content add-ins give users access to interface controls that run code to modify documents or display data from a data source. Use content add-ins when you want to embed functionality directly into the document. See Content Office Add-ins to learn more.

See also: webview.

# **content delivery network (CDN)**


A **content delivery network** or **CDN** is a distributed network of servers and data centers. It typically provides higher resource availability and performance when compared to a single server or data center.

### **Contoso**

**Contoso** Ltd. (also known as Contoso and Contoso University) is a fictional company used by Microsoft as an example company and domain.

### **custom function**

A **custom function** is a user-defined function that is packaged with an Excel add-in. Custom functions enable developers to add new functions, beyond the typical Excel features, by defining those functions in JavaScript as part of an add-in. Users within Excel can access custom functions just as they would any native function in Excel. See Create custom functions in Excel to learn more.

#### 7 **Note**

**Custom function** is a general term that is interchangeable with **user-defined function**. Both terms apply to VBA, COM, and Office.js add-ins. The Office Add-ins documentation uses the term **custom function** when referring to custom functions that use Office JavaScript APIs.

### **custom functions runtime**

A **custom functions runtime** is a JavaScript-only runtime that runs custom functions on some combinations of Office host and platform. It has no UI and cannot interact with Office.js APIs. If your add-in only has custom functions, this is a good lightweight runtime to use. If your custom functions need to interact with the task pane or Office.js APIs, configure a shared runtime. See Configure your Office Add-in to use a shared runtime to learn more.

See also: runtime, shared runtime.

### **custom functions-only add-in**

An add-in that contains a custom function, but no UI such as a task pane. The custom functions in this kind of add-in run in a JavaScript-only runtime. A custom function that 


does include a UI can use either a shared runtime or a combination of a JavaScript-only runtime and an HTML-supporting runtime. We recommend that if you have a UI, you use a shared runtime.

See also: custom function, custom functions runtime.

### **function command**

Function commands are buttons or menu items that run JavaScript functions. Unlike task pane commands, function commands don't display any user interface other than the command button or menu item itself.

See also: add-in commands.

### **host**

**<Host>** typically refers to an Office application. The Office applications, or hosts, that support Office Add-ins are Excel, OneNote, Outlook, PowerPoint, Project, and Word.

See also: application, client, Office application, Office client.

# **Long-Term Service Channel (LTSC)**

**LTSC** refers to the perpetual version of Office available through a volume-licensing agreement between Microsoft and your company.

See also: perpetual, volume-licensed, volume-licensed perpetual, volume licensing.

# **Office application, Office client**

**Office client** refers to an Office application. The Office applications, or clients, that support Office Add-ins are Excel, OneNote, Outlook, PowerPoint, Project, and Word.

See also: application, client, host, Office desktop application, Office desktop client, desktop client, desktop.

# **Office cache**

The **Office cache** stores resources and data used by Office Add-ins. This cache prevents an add-in from repeatedly downloding the resources it needs, thereby improving its performance.


# **Office desktop application, Office desktop client, desktop client, desktop**

**Office desktop client** refers to an Office application that runs natively on Windows or on Mac. The Office desktop clients that support Office Add-ins are Excel on Windows and on Mac, Outlook on Windows ([new](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627) and classic) and on Mac, PowerPoint on Windows and on Mac, Project on Windows, and Word on Windows and on Mac.

See also: application, client, Office application, Office client.

# **perpetual**

**Perpetual** refers to versions of Office available through a volume-licensing agreement or retail channels.

Other Microsoft content may use the term **non-subscription** to represent this concept.

See also: retail, retail perpetual, volume-licensed, volume-licensed perpetual, volume licensing.

# **platform**

A **platform** usually refers to the operating system running the Office application. Platforms that support Office Add-ins include Windows, Mac, iPad, and web browsers.

# **quick start**

A **quick start** is a high-level description of key skills and knowledge required for the basic operation of a particular program. In the Office Add-ins documentation, a quick start is an introduction to developing an add-in for a particular application, such as Outlook. A quick start contains a series of steps that an add-in developer can complete in approximately 5 minutes, resulting in a functioning add-in and functional development environment.

See also: tutorial.

# **requirement set**


Requirement sets are named groups of API members. Requirement sets can be specific to Office applications, such as the ExcelApi 1.7 requirement set (a set of APIs that can only be used in Excel), or common to multiple applications, such as the DialogApi 1.1 requirement set (a set of APIs that can be used in any Office application that supports the Dialog API).

Your add-in can use requirement sets to determine whether the Office application supports the API members that it needs to use. For more information about this, see Specify Office applications and API requirements.

Requirement set support varies by Office application, version, and platform. For detailed information about the platforms, requirement sets, and Common APIs that each Office application supports, see [Office client application and platform availability for Office](https://learn.microsoft.com/en-us/javascript/api/requirement-sets) [Add-ins](https://learn.microsoft.com/en-us/javascript/api/requirement-sets).

### **retail, retail perpetual**

**Retail** refers to perpetual versions of Office available through retail channels. These do not include versions provided by a Microsoft 365 subscription nor volume-licensing agreement.

Other Microsoft content may use the term **one-time purchase** or **consumer** to represent this concept.

See also: perpetual.

### **ribbon, ribbon button**

A **ribbon** is a command bar that organizes an application's features into a series of tabs or buttons at the top of a window. A **ribbon button** is one of the buttons within this series. See [Show or hide the ribbon in Office](https://support.microsoft.com/office/d946b26e-0c8c-402d-a0f7-c6efa296b527#ID0EBBD=Newer_Versions) for more information.

### **runtime**

A **runtime** is the host environment (including a JavaScript engine and usually also an HTML rendering engine) that the add-in runs in. In Office on Windows and Office on Mac, the runtime is an embedded browser control (or webview) such as Internet Explorer, Edge Legacy, Edge WebView2, or Safari. Different parts of an add-in run in separate runtimes. For example, add-in commands, custom functions, and task pane code typically use separate runtimes unless you configure a shared runtime. See


Runtimes in Office Add-ins and Browsers and webview controls used by Office Add-ins for more information.

See also: custom functions runtime, shared runtime, webview.

# **setless API**

An API in the Office JavaScript Library that is not included in any requirement set.

See also requirement set.

### **shared runtime**

A **shared runtime**, enables code in your task pane, function commands, and custom functions, to run in the same runtime and continue running even when the task pane is closed. Code in dialogs generally runs in a separate runtime even when the add-in is configured to use a shared runtime. See shared runtime and [Tips for using the shared](https://devblogs.microsoft.com/microsoft365dev/tips-for-using-the-shared-javascript-runtime-in-your-office-add-in%e2%80%af/) [runtime in your Office Add-in](https://devblogs.microsoft.com/microsoft365dev/tips-for-using-the-shared-javascript-runtime-in-your-office-add-in%e2%80%af/) to learn more.

See also: custom functions runtime, runtime.

# **subscription**

**Subscription** refers to versions of Office available with a Microsoft 365 subscription.

### **task pane**

Task panes are interface surfaces, or webviews, that typically appear on the right side of the window within Excel, Outlook, PowerPoint, and Word. Task panes give users access to interface controls that run code to modify documents or emails, or display data from a data source. Use task panes when you don't need to or can't embed functionality directly into the document. See Task panes in Office Add-ins to learn more.

See also: webview.

# **tutorial**

A **tutorial** is a teaching aid designed to help people learn to use a product or procedure. In the Office Add-ins context, a tutorial guides an add-in developer through the


complete add-in development process for a particular application, such as Excel. This involves following 20 or more steps and is a greater time investment than a quick start.

See also: quick start.

# **volume-licensed, volume-licensed perpetual, volume licensing**

**Volume-licensed** refers to a perpetual version of Office available through a volumelicensing agreement between Microsoft and your company.

Other Microsoft content may use the term **commercial** to represent this concept.

See also: Long-Term Service Channel (LTSC), perpetual.

### **web add-in**

**Web add-in** is a legacy term for an Office Add-in. This term may be used when the Microsoft 365 documentation needs to distinguish modern Office Add-ins from other types of add-ins like VBA, COM, or VSTO.

See also: add-in.

### **web cache**

The **web cache** temporarily stores web-based resources and data used by an individual Office Add-in.

See also: Office cache, Wef cache.

### **webview**

A **webview** is an element or view that displays web content inside an application. Content add-ins and task panes both contain embedded web browsers and are examples of webviews in Office Add-ins.

See also: content add-in, task pane.

# **Wef cache**

The **Wef cache** locally stores resources and data for all installed Office Add-ins.


# **XLL**

An **XLL** add-in is an Excel add-in file that provides user-defined functions and has the file extension **.xll**. An XLL file is a type of dynamic link library (DLL) file that can only be opened by Excel. XLL add-in files must be written in C or C++. Custom functions are the modern equivalent of XLL user-defined functions. Custom functions offer support across platforms and are backwards compatible with XLL files. See Extend custom functions with XLL user-defined functions for more information.

See also: custom function.

### **Yeoman generator, Yo Office**

The Yeoman generator for Office Add-ins uses the open source [Yeoman](https://github.com/yeoman/yo) tool to generate an Office Add-in via the command line. yo office is the command that runs the Yeoman generator for Office Add-ins. The Office Add-ins quick starts and tutorials use the Yeoman generator.

### **See also**

- Office Add-ins additional resources

# **Add-in only manifest reference for Office Add-ins**

Article • 08/05/2024

This section contains information about every element used by an Office Add-in's add-in only manifest. To learn more about how the manifest describes your add-in to an Office application, see Office Add-ins with an add-in only manifest.

ノ **Expand table**

### **Elements**

**Name Category** [Action](https://learn.microsoft.com/en-us/javascript/api/manifest/action?view=common-js-preview) VersionOverrides [AllFormFactors](https://learn.microsoft.com/en-us/javascript/api/manifest/allformfactors?view=common-js-preview) VersionOverrides [AllowSnapshot](https://learn.microsoft.com/en-us/javascript/api/manifest/allowsnapshot?view=common-js-preview) General [AlternateId](https://learn.microsoft.com/en-us/javascript/api/manifest/alternateid?view=common-js-preview) General [AppDomain](https://learn.microsoft.com/en-us/javascript/api/manifest/appdomain?view=common-js-preview) General [AppDomains](https://learn.microsoft.com/en-us/javascript/api/manifest/appdomains?view=common-js-preview) General [CitationText](https://learn.microsoft.com/en-us/javascript/api/manifest/citationtext?view=common-js-preview) General [Control](https://learn.microsoft.com/en-us/javascript/api/manifest/control?view=common-js-preview) VersionOverrides [Control (Button)](https://learn.microsoft.com/en-us/javascript/api/manifest/control-button?view=common-js-preview) VersionOverrides [Control (Menu)](https://learn.microsoft.com/en-us/javascript/api/manifest/control-menu?view=common-js-preview) VersionOverrides [Control (MobileButton)](https://learn.microsoft.com/en-us/javascript/api/manifest/control-mobilebutton?view=common-js-preview) VersionOverrides [CustomTab](https://learn.microsoft.com/en-us/javascript/api/manifest/customtab?view=common-js-preview) VersionOverrides [DefaultLocale](https://learn.microsoft.com/en-us/javascript/api/manifest/defaultlocale?view=common-js-preview) General [DefaultSettings](https://learn.microsoft.com/en-us/javascript/api/manifest/defaultsettings?view=common-js-preview) General [Description](https://learn.microsoft.com/en-us/javascript/api/manifest/description?view=common-js-preview) General [DesktopFormFactor](https://learn.microsoft.com/en-us/javascript/api/manifest/desktopformfactor?view=common-js-preview) VersionOverrides [DesktopSettings](https://learn.microsoft.com/en-us/javascript/api/manifest/desktopsettings?view=common-js-preview) General


| Name                      | Category         |
|---------------------------|------------------|
| Dictionary                | General          |
| DictionaryHomePage        | General          |
| DisableEntityHighlighting | General          |
| DisplayName               | General          |
| Enabled                   | VersionOverrides |
| EquivalentAddin           | General          |
| EquivalentAddins          | General          |
| Event                     | VersionOverrides |
| ExtendedPermission        | VersionOverrides |
| ExtendedPermissions       | VersionOverrides |
| ExtensionPoint            | VersionOverrides |
| ExtendedOverrides         | General          |
| FileName                  | General          |
| Form                      | General          |
| FormSettings              | General          |
| FunctionFile              | VersionOverrides |
| GetStarted                | VersionOverrides |
| Group                     | VersionOverrides |
| HighResolutionIconUrl     | General          |
| Host                      | General          |
| Hosts                     | General          |
| Icon                      | VersionOverrides |
| IconUrl                   | General          |
| Id                        | General          |
| Image                     | VersionOverrides |
| Images                    | VersionOverrides |


| Name                  | Category         |
|-----------------------|------------------|
| Item                  | VersionOverrides |
| Items                 | VersionOverrides |
| LaunchEvent           | VersionOverrides |
| LaunchEvents          | VersionOverrides |
| LongStrings           | VersionOverrides |
| Metadata              | General          |
| Method                | General          |
| Methods               | General          |
| MobileFormFactor      | VersionOverrides |
| Namespace             | General          |
| OfficeApp             | General          |
| OfficeMenu            | VersionOverrides |
| OfficeTab             | VersionOverrides |
| OverriddenByRibbonApi | VersionOverrides |
| Override              | General          |
| Page                  | VersionOverrides |
| Permissions           | General          |
| PhoneSettings         | General          |
| ProgId                | General          |
| ProviderName          | General          |
| QueryUri              | General          |
| RequestedHeight       | General          |
| RequestedWidth        | General          |
| Requirements          | General          |
| Resources             | VersionOverrides |
| Rule                  | General          |


| Name                              | Category         |
|-----------------------------------|------------------|
| Runtime                           | VersionOverrides |
| Runtimes                          | VersionOverrides |
| Scopes                            | VersionOverrides |
| Script                            | VersionOverrides |
| Set                               | General          |
| Sets                              | General          |
| ShortStrings                      | VersionOverrides |
| SourceLocation                    | General          |
| SourceLocation (custom functions) | VersionOverrides |
| String                            | VersionOverrides |
| Supertip                          | VersionOverrides |
| SupportsSharedFolders             | VersionOverrides |
| SupportUrl                        | General          |
| TabletSettings                    | General          |
| TargetDialect                     | General          |
| TargetDialects                    | General          |
| Tokens                            | General          |
| Token                             | General          |
| Type                              | General          |
| Url                               | VersionOverrides |
| Urls                              | VersionOverrides |
| Version                           | General          |
| VersionOverrides                  | General          |
| VersionOverrides 1.0 Content      | VersionOverrides |
| VersionOverrides 1.0 Mail         | VersionOverrides |
| VersionOverrides 1.1 Mail         | VersionOverrides |


| Name                          | Category         |
|-------------------------------|------------------|
| VersionOverrides 1.0 TaskPane | VersionOverrides |
| WebApplicationInfo            | VersionOverrides |


# **How to find the proper order of manifest elements**

06/13/2025

The XML elements in the manifest of an Office Add-in must be under the proper parent element *and* in a specific order, relative to each other, under the parent.

The required ordering is specified in the XSD files in the [Schemas](https://learn.microsoft.com/en-us/openspecs/office_file_formats/ms-owemxml/c6a06390-34b8-4b42-82eb-b28be12494a8) folder. The XSD files are categorized into subfolders for taskpane, content, and mail add-ins.

For example, in the <OfficeApp> element, the <Id> , <Version> , <ProviderName> must appear in that order. If an <AlternateId> element is added, it must be between the <Id> and <Version> element. Your manifest will not be valid and your add-in will not load, if any element is in the wrong order.

#### 7 **Note**

The **validator within office-addin-manifest** uses the same error message when an element is out-of-order as it does when an element is under the wrong parent. The error says the child element is not a valid child of the parent element. If you get such an error but the reference documentation for the child element indicates that it *is* valid for the parent, then the problem is likely that the child has been placed in the wrong order.

The following sections show the manifest elements in the order in which they must appear. There are differences depending on whether the type attribute of the <OfficeApp> element is TaskPaneApp , ContentApp , or MailApp . To keep these sections from becoming too unwieldy, the highly complex <VersionOverrides> element is broken out into separate sections.

#### 7 **Note**

Not all of the elements shown are mandatory. If the minOccurs value for a element is **0** in the **[schema](https://learn.microsoft.com/en-us/openspecs/office_file_formats/ms-owemxml/4e112d0a-c8ab-46a6-8a6c-2a1c1d1299e3)**, the element is optional.

# **Basic task pane add-in element ordering**

XML

```
<OfficeApp xsi:type="TaskPaneApp">
 <Id>
```


 <AlternateID> <Version> <ProviderName> <DefaultLocale> <DisplayName> <Override> <Description> <Override> <IconUrl> <Override> <HighResolutionIconUrl> <Override> <SupportUrl> <AppDomains> <AppDomain> <Hosts> <Host> <Requirements> <Sets> <Set> <Methods> <Method> <DefaultSettings> <SourceLocation> <Override> <Permissions> <Dictionary> <TargetDialects> <QueryUri> <CitationText> <DictionaryName> <DictionaryHomePage> <VersionOverrides>* <ExtendedOverrides>

*See Task pane add-in element ordering within VersionOverrides for the ordering of children elements of VersionOverrides.

## **Basic mail add-in element ordering**

```
XML
<OfficeApp xsi:type="MailApp">
 <Id>
 <AlternateId>
 <Version>
 <ProviderName>
 <DefaultLocale>
 <DisplayName>
 <Override>
 <Description>
```


```
 <Override>
 <IconUrl>
 <Override>
 <HighResolutionIconUrl>
 <Override>
 <SupportUrl>
 <AppDomains>
 <AppDomain>
 <Hosts>
 <Host>
 <Requirements>
 <Sets>
 <Set>
 <FormSettings>
 <Form>
 <DesktopSettings>
 <SourceLocation>
 <RequestedHeight>
 <TabletSettings>
 <SourceLocation>
 <RequestedHeight>
 <PhoneSettings>
 <SourceLocation>
 <Permissions>
 <Rule>
 <DisableEntityHighlighting>
 <VersionOverrides>*
```
*See Mail add-in element ordering within VersionOverrides Ver. 1.0 and Mail add-in element ordering within VersionOverrides Ver. 1.1 for the ordering of children elements of VersionOverrides.

### **Basic content add-in element ordering**

```
XML
<OfficeApp xsi:type="ContentApp">
 <Id>
 <AlternateId>
 <Version>
 <ProviderName>
 <DefaultLocale>
 <DisplayName>
 <Override>
 <Description>
 <Override>
 <IconUrl >
 <Override>
 <HighResolutionIconUrl>
 <Override>
 <SupportUrl>
```


```
 <AppDomains>
 <AppDomain>
 <Hosts>
 <Host>
 <Requirements>
 <Sets>
 <Set>
 <Methods>
 <Method>
 <DefaultSettings>
 <SourceLocation>
 <Override>
 <RequestedWidth>
 <RequestedHeight>
 <Permissions>
 <AllowSnapshot>
 <VersionOverrides>*
```
*See Content add-in element ordering within VersionOverrides for the ordering of children elements of VersionOverrides.

## **Task pane add-in element ordering within VersionOverrides**

XML <VersionOverrides> <Description> <Requirements> <Sets> <Set> <Hosts> <Host> <Runtimes> <Runtime> <AllFormFactors> <ExtensionPoint> <Script> <SourceLocation> <Page> <SourceLocation> <Metadata> <SourceLocation> <Namespace> <DesktopFormFactor> <GetStarted> <Title> <Description> <LearnMoreUrl> <FunctionFile>


```
 <ExtensionPoint>
 <OfficeTab>
 <Group>
 <Label>
            <Icon>
 <Image>
 <Control>
            <Label>
            <Supertip>
 <Title>
              <Description>
 <Icon>
 <Image> 
 <Action>
 <TaskpaneId>
              <SourceLocation>
              <Title>
              <FunctionName>
 <Enabled>
            <Items>
 <Item>
              <Label>
              <Supertip>
 <Title>
               <Description>
 <Action>
 <TaskpaneId>
               <SourceLocation>
               <Title>
               <FunctionName>
 <CustomTab>
 <Group> (can be below <OfficeGroup>)
 <OverriddenByRibbonApi>
            <Label>
            <Icon>
 <Image>
 <Control>
 <OverriddenByRibbonApi>
              <Label>
              <Supertip>
 <Title>
               <Description>
 <Icon>
 <Image> 
 <Action>
 <TaskpaneId>
               <SourceLocation>
               <Title>
               <FunctionName>
 <Enabled>
              <Items>
 <Item>
 <OverriddenByRibbonApi>
                 <Label>
                 <Supertip>
```


```
 <Title>
                     <Description>
 <Action>
                     <TaskpaneId>
                     <SourceLocation>
                     <Title>
                     <FunctionName>
 <OfficeGroup> (can be above <Group>)
           <Label>
           <InsertAfter> (or <InsertBefore>)
 <OfficeMenu>
 <Control>
 <Label>
             <Supertip>
 <Title>
               <Description>
 <Icon>
 <Image> 
 <Action>
 <TaskpaneId>
               <SourceLocation>
               <Title>
               <FunctionName>
 <Enabled>
             <Items>
 <Item>
 <Label>
                 <Supertip>
 <Title>
                   <Description>
 <Action>
 <TaskpaneId>
                   <SourceLocation>
                   <Title>
                   <FunctionName>
 <Resources>
 <Images>
 <Image>
 <Override>
 <Urls>
 <Url>
 <Override>
 <ShortStrings>
 <String>
 <Override>
 <LongStrings>
 <String>
 <Override>
 <WebApplicationInfo>
 <Id>
 <Resource>
 <Scopes>
 <Scope>
 <EquivalentAddins>
 <EquivalentAddin>
```


```
 <ProgId>
 <DisplayName>
 <FileName>
 <Type>
 <Effect>
```
## **Mail add-in element ordering within VersionOverrides Ver. 1.0**

XML <VersionOverrides> <Description> <Requirements> <Sets> <Set> <Hosts> <Host> <DesktopFormFactor> <ExtensionPoint> <OfficeTab> <Group> <Label> <Control> <Label> <Supertip> <Title> <Description> <Icon> <Image> <Action> <SourceLocation> <FunctionName> <CustomTab> <Group> <Label> <Icon> <Image> <Control> <Label> <Supertip> <Title> <Description> <Icon> <Image> <Action> <TaskpaneId> <SourceLocation> <Title> <FunctionName> <Items>


```
 <Item>
 <Label>
                 <Supertip>
 <Title>
                  <Description>
 <Action>
 <TaskpaneId>
                  <SourceLocation>
                  <Title>
                  <FunctionName>
 <Label>
 <OfficeMenu>
 <Control>
 <Label>
            <Supertip>
 <Title>
             <Description>
 <Icon>
 <Image>
 <Action>
 <TaskpaneId>
             <SourceLocation>
             <Title>
             <FunctionName>
 <Items>
 <Item>
 <Label>
               <Supertip>
 <Title>
                 <Description>
 <Action>
 <TaskpaneId>
                 <SourceLocation>
                 <Title>
                 <FunctionName>
 <Resources>
 <Images>
 <Image>
 <Override>
 <Urls>
 <Url>
 <Override>
 <ShortStrings>
 <String>
 <Override>
 <LongStrings>
 <String>
 <Override>
 <VersionOverrides>*
```
* A VersionOverrides with type value VersionOverridesV1_1 , instead of VersionOverridesV1_0 , can be nested at the end of the outer VersionOverrides. See Mail add-in element ordering within VersionOverrides Ver. 1.1 for the ordering of elements in VersionOverridesV1_1 .


## **Mail add-in element ordering within VersionOverrides Ver. 1.1**

XML

```
<VersionOverrides>
 <Description>
 <Requirements>
 <Sets>
 <Set>
 <Hosts>
 <Host>
 <DesktopFormFactor>
 <ExtensionPoint>
 <OfficeTab>
 <Group>
 <Label>
          <Tooltip>
          <Control>
 <Label>
            <Supertip>
 <Title>
             <Description>
 <Icon>
 <Image>
 <Action>
 <SourceLocation>
             <FunctionName>
 <CustomTab>
 <Group>
 <Label>
          <Icon>
 <Image>
 <Control>
 <Label>
            <Supertip>
 <Title>
             <Description>
 <Icon>
 <Image> 
 <Action>
 <TaskpaneId>
             <SourceLocation>
             <Title>
             <FunctionName>
 <Items>
 <Item>
 <Label>
               <Supertip>
 <Title>
                 <Description>
 <Action>
```


```
 <TaskpaneId>
                  <SourceLocation>
                  <Title>
                  <FunctionName>
 <Label>
 <OfficeMenu>
 <Control>
 <Label>
           <Supertip>
 <Title>
            <Description>
 <Icon>
 <Image> 
 <Action>
 <TaskpaneId>
            <SourceLocation>
            <Title>
            <FunctionName>
 <Items>
 <Item>
 <Label>
              <Supertip>
 <Title>
                <Description>
 <Action>
 <TaskpaneId>
                <SourceLocation>
                <Title>
                <FunctionName>
 <SourceLocation>
 <Label>
 <CommandSurface>
 <MobileFormFactor>
 <ExtensionPoint>
 <Group>
 <Label>
 <Control>
 <Label>
           <Icon>
 <Image>
 <Action>
 <SourceLocation>
            <FunctionName>
 <Control>
 <Label>
 <Icon>
 <Image>
 <Action>
 <SourceLocation>
           <FunctionName>
 <Resources>
 <Images>
 <Image>
 <Override>
 <Urls>
```


```
 <Url>
 <Override>
 <ShortStrings>
 <String>
 <Override>
 <LongStrings>
 <String>
 <Override>
 <WebApplicationInfo>
 <Id>
 <Resource>
 <Scopes>
 <Scope>
 <EquivalentAddins>
 <EquivalentAddin>
 <ProgId>
 <DisplayName>
 <FileName>
 <Type> 
 <ConnectedServiceControls>
 <ConnectedServiceControlsScopes>
 <Scope>
 <ExtendedPermissions>
 <ExtendedPermission>
```
## **Content add-in element ordering within VersionOverrides**

<VersionOverrides> <WebApplicationInfo> <Id> <Resource> <Scopes> <Scope>

# **See also**

XML

- [Reference for Office Add-ins manifests (v1.1)](https://learn.microsoft.com/en-us/javascript/api/manifest)
- [Official schema definitions](https://learn.microsoft.com/en-us/openspecs/office_file_formats/ms-owemxml/c6a06390-34b8-4b42-82eb-b28be12494a8)


# **Referencing the Office JavaScript API library**

Article • 01/16/2025

The Office JavaScript API library provides the APIs that your add-in can use to interact with the Office application. The simplest way to reference the library is to use the content delivery network (CDN) by adding the following <script> tag within the <head> section of your HTML page.

```
HTML
<head>
 ...
 <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"
type="text/javascript"></script>
</head>
```
This will download and cache the Office JavaScript API files the first time your add-in loads to make sure that it is using the most up-to-date implementation of Office.js and its associated files for the specified version.

#### ) **Important**

You must reference the Office JavaScript API from inside the <head> section of the page to ensure that the API is fully initialized prior to any body elements.

### **Office.js-specific web API behavior**

Office.js replaces the default [Window.history](https://developer.mozilla.org/docs/Web/API/History) methods of replaceState and pushState with null . This is done to support older Microsoft webviews and Office versions. If your add-in relies on these methods and doesn't need to run on Office versions that use the Internet Explorer 11 browser control, replace the Office.js library reference with the following workaround.

```
HTML
<script type="text/javascript">
 // Cache the history method values.
 window._historyCache = {
 replaceState: window.history.replaceState,
 pushState: window.history.pushState
 };
```


```
</script>
<script type="text/javascript"
src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
<script type="text/javascript">
 // Restore the history method values after loading Office.js
 window.history.replaceState = window._historyCache.replaceState;
 window.history.pushState = window._historyCache.pushState;
</script>
```
Thank you to [@stepper and the Stack Overflow community](https://stackoverflow.com/questions/42642863/office-js-nullifies-browser-history-functions-breaking-history-usage) for suggesting and verifying this workaround.

# **API versioning and backward compatibility**

In the previous HTML snippet, the /1/ in front of office.js in the CDN URL specifies the latest incremental release within version 1 of Office.js. Because the Office JavaScript API maintains backward compatibility, the latest release will continue to support API members that were introduced earlier in version 1.

If you plan to publish your Office Add-in from AppSource, you must use this CDN reference. Local references are only appropriate for internal, development, and debugging scenarios.

7 **Note**

To use preview APIs, reference the preview version of the Office JavaScript API library on the CDN: https://appsforoffice.microsoft.com/lib/beta/hosted/office.js .

# **Enabling IntelliSense for a TypeScript project**

In addition to referencing the Office JavaScript API as described previously, you can also enable IntelliSense for TypeScript add-in project by using the type definitions from [DefinitelyTyped](https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/office-js) . To do so, run the following command in a Node-enabled system prompt (or git bash window) from the root of your project folder. You must have [Node.js](https://nodejs.org/) installed (which includes npm).

```
command line
npm install --save-dev @types/office-js
```


# **Preview APIs**

New JavaScript APIs are first introduced in "preview" and later become part of a specific numbered requirement set after sufficient testing occurs and user feedback is acquired.

#### 7 **Note**

Preview APIs are subject to change and are not intended for use in a production environment. We recommend that you try them out in test and development environments only. Do not use preview APIs in a production environment or within business-critical documents.

To use preview APIs:

- You must use the preview version of the Office JavaScript API library from the **[Office.js content delivery network (CDN)](https://appsforoffice.microsoft.com/lib/beta/hosted/office.js)** . The **[type definition file](https://appsforoffice.microsoft.com/lib/beta/hosted/office.d.ts)** for TypeScript compilation and IntelliSense is found at the CDN and **[DefinitelyTyped](https://raw.githubusercontent.com/DefinitelyTyped/DefinitelyTyped/master/types/office-js-preview/index.d.ts)** . You can install these types with npm install --save-dev @types/office-js-preview .
- You may need to join the **[Microsoft 365 Insider program](https://aka.ms/MSFT365InsiderProgram)** for access to more recent Office builds.

# **CDN references for other Microsoft 365 environments**

#### [21Vianet operates and manages an Office 365 service powered by licensed Microsoft](https://learn.microsoft.com/en-us/microsoft-365/admin/services-in-china/services-in-china?view=o365-21vianet&preserve-view=true)

[technologies](https://learn.microsoft.com/en-us/microsoft-365/admin/services-in-china/services-in-china?view=o365-21vianet&preserve-view=true) to provide Office 365 services for China compliant with local laws and regulations. Add-ins developed for use within this cloud environment should use corresponding CDN. Use https://appsforoffice.cdn.partner.office365.cn/appsforoffice/lib/1/hosted/office.js instead of the standard CDN reference. This ensures continued compliance and provides better add-in performance.

## **See also**

- Understanding the Office JavaScript API
- Office JavaScript API
- Guidance for deploying Office Add-ins on government clouds
- [Microsoft software license terms for the Microsoft Office JavaScript (Office.js) API library](https://github.com/OfficeDev/office-js/blob/release/LICENSE.md)


# **Privacy and security for Office Add-ins**

07/24/2025

# **Process security**

Office Add-ins are secured by an add-in runtime environment, a multiple-tier permissions model, and performance governors. This framework protects the user's experience in the following ways.

- Access to the Office client application's UI frame is managed.
- Only indirect access to the Office client application's UI thread is allowed.
- Modal interactions aren't allowed for example, calls to JavaScript alert , confirm , and prompt methods aren't allowed because they're modal.

Further, the runtime framework provides the following benefits to ensure that an Office Add-in can't damage the user's environment.

- Isolates the process the add-in runs in.
- Doesn't require .dll or .exe replacement or ActiveX components.
- Makes add-ins easy to install and uninstall.

Also, the use of memory, CPU, and network resources by Office Add-ins is governable to ensure that good performance and reliability are maintained.

#### 7 **Note**

In some scenarios, different features of an add-in run in separate runtimes. For simplicity, this article uses the singular "runtime." For more information, see **Runtimes in Office Addins**.

The following sections briefly describe how the runtime architecture supports running add-ins in Office clients on Windows-based devices, on Mac OS X devices, and in web browsers.

### **Clients on Windows and OS X devices**

In supported clients for desktop and tablet devices, such as Excel on Windows, and Outlook on Windows (classic) and on Mac, Office Add-ins are supported by integrating an in-process component, the Office Add-ins runtime, which manages the add-in lifecycle and enables


interoperability between the add-in and the client application. The add-in webpage itself is hosted out-of-process. On a Windows desktop or tablet device, the add-in webpage is hosted inside an Internet Explorer or Microsoft Edge control which, in turn, is hosted inside an add-in runtime process that provides security and performance isolation.

On Windows desktops, Protected Mode in Internet Explorer must be enabled for the Restricted Site Zone. This is typically enabled by default. If it is disabled, an [error will occur](https://learn.microsoft.com/en-us/office/troubleshoot/office-suite-issues/apps-for-office-not-start) when you try to launch an add-in.

On a macOS desktop, the add-in web page is hosted inside a sandboxed WebKit runtime host process which helps provide similar level of security and performance protection.


The Office Add-ins runtime manages interprocess communication, the translation of JavaScript API calls and events into native ones, as well as UI remoting support to enable the add-in to be rendered inside the document, in a task pane, or adjacent to an email message, meeting request, or appointment.

### **Web clients**

In supported web clients, Office Add-ins are hosted in an **iframe** that runs using the HTML5 **sandbox** attribute. ActiveX components or navigating the main page of the web client are not allowed. Office Add-ins support is enabled in the web clients by the integration of the JavaScript API for Office. In a similar way to the desktop client applications, the JavaScript API manages the add-in lifecycle and interoperability between the add-in and the web client. This interoperability is implemented by using a special cross-frame post message communication infrastructure. The same JavaScript library (Office.js) that is used on desktop clients is available to interact with the web client. The following figure shows the infrastructure that supports addins in Office running in the browser, and the relevant components (the web client, **iframe**, Office Add-ins runtime, and JavaScript API for Office) required to support them.


# **Add-in integrity in AppSource**

You can make your Office Add-ins available to the public by publishing them to AppSource. AppSource enforces the following measures to maintain the integrity of add-ins.

- Requires the host server of an Office Add-in to always use Secure Sockets Layer (SSL) to communicate.
- Requires a developer to provide proof of identity, a contractual agreement, and a compliant privacy policy to submit add-ins.
- Supports a user-review system for available add-ins to promote a self-policing community.

# **Optional connected experiences**

End users and IT admins can turn off [optional connected experiences in Office](https://learn.microsoft.com/en-us/deployoffice/privacy/optional-connected-experiences) desktop and mobile clients. For Office Add-ins, the impact of disabling the **Optional connected experiences** setting is that users can no longer access add-ins or the Microsoft 365 and Copilot store through these clients. However, certain Microsoft add-ins that are considered essential or business-critical, and add-ins deployed by an organization's IT admin through [Centralized](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/centralized-deployment-of-add-ins) [Deployment](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/centralized-deployment-of-add-ins) will still be available. In Outlook, the availability of add-ins when the **Optional**


**connected experiences** setting is turned off varies depending on the client. For more information, see Optional connected experiences in Outlook.

Note that if an IT admin disables the [use of connected experiences in Office,](https://learn.microsoft.com/en-us/deployoffice/privacy/manage-privacy-controls#policy-setting-for-most-connected-experiences) it has the same effect on add-ins as turning off just optional connected experiences.

### **Optional connected experiences in Outlook**

The following table describes the availability of add-ins on Outlook clients when optional connected experiences is turned off.

ノ **Expand table**

| Client                                   | Behavior when optional connected experiences is turned off                                                                                                                                                                                                                                  |
|------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Web browser<br>new Outlook<br>on Windows | Admin-deployed add-ins remain visible and usable. While users can still access<br>the Microsoft 365 and Copilot store and install add-ins, these add-ins can't be<br>used until the Optional connected experiences setting is turned on. Additionally,<br>sideloaded add-ins can't be used. |
| Windows                                  | All add-ins remain visible and usable. However, the Microsoft 365 and Copilot                                                                                                                                                                                                               |
| (classic)                                | store is inaccessible.                                                                                                                                                                                                                                                                      |
| Mac                                      | Add-ins don't appear in the ribbon and the Microsoft 365 and Copilot store is<br>inaccessible.                                                                                                                                                                                              |
| Android<br>iOS                           | The Get Add-ins dialog shows only admin-deployed add-ins.                                                                                                                                                                                                                                   |

# **Addressing end users' privacy concerns**

This section describes the protection offered by the Office Add-ins platform from the customer's (end user's) perspective, and provides guidelines for how to support users' expectations and how to securely handle users' personally identifiable information (PII).

### **End users' perspective**

Office Add-ins are built using web technologies that run in a browser control or **iframe**. Because of this, using add-ins is similar to browsing to web sites on the Internet or intranet. Add-ins can be external to an organization (if you acquire the add-in from AppSource) or internal (if you acquire the add-in from an Exchange Server add-in catalog, SharePoint app catalog, or file share on an organization's network). Add-ins have limited access to the network 


and most add-ins can read or write to the active document or mail item. The add-in platform applies certain constraints before a user or administrator installs or starts an add-in. But as with any extensibility model, users should be cautious before starting an unknown add-in.

#### 7 **Note**

Users may see a security prompt to trust the domain the first time an add-in is loaded. This will happen if the add-in's domain host is outside of the domain of Exchange onpremise or Office Online Server.

The add-in platform addresses end users' privacy concerns in the following ways.

- Data communicated with the web server that hosts a content, Outlook or task pane addin as well as communication between the add-in and any web services it uses must be encrypted using the Secure Socket Layer (SSL) protocol.
- Before a user installs an add-in from AppSource, the user can view the privacy policy and requirements of that add-in. In addition, Outlook add-ins that interact with users' mailboxes surface the specific permissions that they require; the user can review the terms of use, requested permissions and privacy policy before installing an Outlook addin.
- When sharing a document, users also share add-ins that have been inserted in or associated with that document. If a user opens a document that contains an add-in that the user hasn't used before, the Office client application prompts the user to grant permission for the add-in to run in the document. In an organizational environment, the Office client application also prompts the user if the document comes from an external source.
- Add-ins running in the following Office applications are blocked from accessing a user's device capabilities.
	- Office on the web (Excel, Outlook, PowerPoint, and Word) running in Chromium-based browsers, such as Microsoft Edge or Google Chrome
	- [new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)

A user's device capabilities include their camera, geolocation, and microphone. To learn more, see [View, manage, and install add-ins for Excel, PowerPoint, and Word](https://support.microsoft.com/office/16278816-1948-4028-91e5-76dca5380f8d) .

- Users can enable or disable the access to AppSource. For content and task pane add-ins, users manage access to trusted add-ins and catalogs from the **Trust Center** on the host


Office client (opened from **File** > **Options** > **Trust Center** > **Trust Center Settings** > **Trusted Add-in Catalogs**).

In Outlook, access to manage add-ins depends on the user's Outlook client. To learn more, see [Use add-ins in Outlook](https://support.microsoft.com/office/1ee261f9-49bf-4ba6-b3e2-2ba7bcab64c8) .

Administrators can also manage access to AppSource [through the admin center](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/manage-addins-in-the-admin-center).

- The design of the add-in platform provides security and performance for end users in the following ways.
	- An Office Add-in runs in a web browser control that is hosted in an add-in runtime environment separate from the Office client application. This design provides both security and performance isolation from the client application.
	- Running in a web browser control allows the add-in to do almost anything a regular web page running in a browser can do but, at the same time, restricts the add-in to observe the same-origin policy for domain isolation and security zones.

#### **End users' perspective in Outlook**

The following points address end users' privacy concerns specific to Outlook.

- End user's messages that are protected by Outlook's Information Rights Management (IRM) won't interact with add-ins in the following instances.
	- When the IRM-protected message is accessed from Outlook on mobile devices.
	- When the IRM-protected message contains a sensitivity label with the **Allow programmatic access** custom policy option set to false .

For more information on IRM support in add-ins, see Mail items protected by IRM.

- Granting the **restricted** permission allows the Outlook add-in to have limited access on only the current item. Granting the **read item** permission allows the Outlook add-in to access personal identifiable information, such as sender and recipient names and email addresses, on only the current item. For more information on Outlook add-in permissions, see Understanding Outlook add-in permissions.
- Manifest files of installed Outlook add-ins are secured in the user's email account.
- Outlook on Windows (classic) and on Mac monitor the performance of installed Outlook add-ins, exercise governance control, and make add-ins unavailable when they exceed limits in the following areas.


- Response time to activate
- Number of failures to activate or reactivate
- Memory usage
- CPU usage

### **Developer guidelines to handle PII**

The following lists some specific PII protection guidelines for you as a developer of Office Addins.

- The [Settings](https://learn.microsoft.com/en-us/javascript/api/office/office.settings) object is intended for persisting add-in settings and state data across sessions for a content or task pane add-in, but don't store passwords and other sensitive PII in the **Settings** object. The data in the **Settings** object isn't visible to end users, but it is stored as part of the document's file format which is readily accessible. You should limit your add-in's use of PII and store any PII required by your add-in on the server hosting your add-in as a user-secured resource.
- Using some applications can reveal PII. Make sure that you securely store data for your users' identity, location, access times, and any other credentials so that data won't become available to other users of the add-in.
- If your add-in is available in AppSource, the AppSource requirement for HTTPS protects PII transmitted between your web server and the client computer or device. However, if you re-transmit that data to other servers, make sure you observe the same level of protection.
- If you store users' PII, make sure you reveal that fact, and provide a way for users to inspect and delete it. If you submit your add-in to AppSource, you can outline the data you collect and how it's used in the privacy statement.

# **Developers' permission choices and security practices**

Follow these general guidelines to support the security model of Office Add-ins, and drill down on more details for each add-in type.

### **Request the necessary permissions**


The add-in platform provides a permissions model that your add-in uses to declare the level of access to a user's data that it requires for its features. Each permission level corresponds to the subset of the JavaScript API for Office your add-in is allowed to use for its features. For example, the **write document** permission for content and task pane add-ins allows access to the [Document.setSelectedDataAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.document) method that lets an add-in write to the user's document, but doesn't allow access to any of the methods for reading data from the document. This permission level makes sense for add-ins that only need to write to a document, such as an add-in where the user can query for data to insert into their document.

As a best practice, you should request permissions based on the principle of *least privilege*. That is, you should request permission to access only the minimum subset of the API that your add-in requires to function correctly. For example, if your add-in needs only to read data in a user's document for its features, you should request no more than the **read document** permission. (But, keep in mind that requesting insufficient permissions will result in the add-in platform blocking your add-in's use of some APIs and will generate errors at run time.)

You specify permissions in the manifest of your add-in, as shown in the example in this section below, and end users can see the requested permission level of an add-in before they decide to install or activate the add-in for the first time. Additionally, Outlook add-ins that request the **read/write mailbox** permission require explicit administrator privilege to install.

To see an example of how to request permissions in the manifest, open the tab for the type of manifest your add-in uses.

Unified manifest for Microsoft 365

#### 7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word add-ins.

The following example shows how a task pane add-in specifies the **read document** permission in its manifest. To keep permissions as the focus, other elements in the manifest aren't displayed.

```
JSON
"authorization": {
 "permissions": {
 "resourceSpecific": [
 ...
 {
 "name": "Document.Read.User",
```


```
 "type": "Delegated"
 },
 ]
 }
}
```
For more information about permissions for task pane and content add-ins, see Requesting permissions for API use in add-ins.

For more information about permissions for Outlook add-ins, see Understanding Outlook addin permissions.

### **Follow the same-origin policy**

Because Office Add-ins are webpages that run in a web browser control, they must follow the same-origin policy enforced by the browser. By default, a webpage in one domain can't make [XmlHttpRequest](https://www.w3.org/TR/XMLHttpRequest/) web service calls to another domain other than the one where it is hosted.

One way to overcome this limitation is to use JSON/P -- provide a proxy for the web service by including a **script** tag with a **src** attribute that points to some script hosted on another domain. You can programmatically create the **script** tags, dynamically creating the URL to which to point the **src** attribute, and passing parameters to the URL via URI query parameters. Web service providers create and host JavaScript code at specific URLs, and return different scripts depending on the URI query parameters. These scripts then execute where they are inserted and work as expected.

The following is an example of JSON/P in the Outlook add-in example.

```
JavaScript
// Dynamically create an HTML SCRIPT element that obtains the details for the
specified video.
function loadVideoDetails(videoIndex) {
 // Dynamically create a new HTML SCRIPT element in the webpage.
 const script = document.createElement("script");
 // Specify the URL to retrieve the indicated video from a feed of a current
list of videos,
 // as the value of the src attribute of the SCRIPT element. 
 script.setAttribute("src", "https://gdata.youtube.com/feeds/api/videos/" + 
 videos[videoIndex].Id + "?alt=json-in-
script&callback=videoDetailsLoaded");
 // Insert the SCRIPT element at the end of the HEAD section.
 document.getElementsByTagName('head')[0].appendChild(script);
}
```


Exchange and SharePoint provide client-side proxies to enable cross-domain access. In general, same origin policy on an intranet isn't as strict as on the Internet. For more information, see [Same Origin Policy Part 1: No Peeking](https://learn.microsoft.com/en-us/archive/blogs/ieinternals/same-origin-policy-part-1-no-peeking) and Addressing same-origin policy limitations in Office Add-ins.

### **Prevent malicious cross-site scripting**

A bad actor could attack the origin of an add-in by entering malicious script through the document or fields in the add-in. A developer should process user input to avoid executing a malicious user's JavaScript within their domain. The following are some good practices to follow to handle user input from a document or mail message, or via fields in an add-in.

- Instead of the DOM property [innerHTML](https://developer.mozilla.org/docs/Web/API/Element/innerHTML) , use the [innerText](https://developer.mozilla.org/docs/Web/API/Node/innerText) and [textContent](https://developer.mozilla.org/docs/DOM/Node.textContent) properties where appropriate. Do the following for Internet Explorer and Firefox crossbrowser support.

```
JavaScript
```
var text = x.innerText || x.textContent

For information about the differences between **innerText** and **textContent**, see [Node.textContent](https://developer.mozilla.org/docs/DOM/Node.textContent) . For more information about DOM compatibility across common browsers, see [W3C DOM Compatibility - HTML](https://www.quirksmode.org/dom/w3c_html.html#t07) .

- If you must use **innerHTML**, make sure the user's input doesn't contain malicious content before passing it to **innerHTML**. For more information and an example of how to use **innerHTML** safely, see [innerHTML](https://developer.mozilla.org/docs/Web/API/Element/innerHTML) property.
- If you are using jQuery, use the [.text()](https://api.jquery.com/text/) method instead of the [.html()](https://api.jquery.com/html/) method.
- Use the [toStaticHTML](https://developer.mozilla.org/docs/Web/HTML/Reference) method to remove any dynamic HTML elements and attributes in users' input before passing it to **innerHTML**.
- Use the [encodeURIComponent](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/encodeuricomponent) or [encodeURI](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/encodeuri) function to encode text that is intended to be a URL that comes from or contains user input.
- See [Developing secure add-ins](https://learn.microsoft.com/en-us/previous-versions/windows/apps/hh849625(v=win.10)) for more best practices to create more secure web solutions.

## **Prevent "clickjacking"**

Because Office Add-ins are rendered in an iframe when running in a browser with Office client applications, use the following tips to minimize the risk of [clickjacking](https://en.wikipedia.org/wiki/Clickjacking) -- a technique used by 


hackers to fool users into revealing confidential information.

First, identify sensitive actions that your add-in can perform. These include any actions that an unauthorized user could use with malicious intent, such as initiating a financial transaction or publishing sensitive data. For example, your add-in might let the user send a payment to a user-defined recipient.

Second, for sensitive actions, your add-in should confirm with the user before it executes the action. This confirmation should detail what effect the action will have. It should also detail how the user can prevent the action, if necessary, whether by choosing a specific button marked "Don't Allow" or by ignoring the confirmation.

Third, to ensure that no threat actor can hide or mask the confirmation, you should display it outside the context of the add-in (that is, not in an HTML dialog box).

The following are some examples of how you could get confirmation.

- Send an email to the user that contains a confirmation link.
- Send a text message to the user that includes a confirmation code that the user can enter in the add-in.
- Open a confirmation dialog in a new browser window to a page that cannot be iframed. This is typically the pattern that is used by login pages. Use the dialog API to create a new dialog.

Also, ensure that the address you use for contacting the user couldn't have been provided by a threat actor. For example, for payment confirmations use the address on file for the authorized user's account.

### **Request permission to access device capabilities (applies to Office on the web and new Outlook on Windows)**

If an add-in requires access to a user's device capabilities, such as their camera, geolocation, or microphone, the developer must configure it to request permission from the user. This applies to the following Office applications.

- Office on the web (Excel, Outlook, PowerPoint, and Word) running in Chromium-based browsers, such as Microsoft Edge or Google Chrome
- [new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)

To request permission, the add-in must implement the [device permission API.](https://learn.microsoft.com/en-us/javascript/api/office/office.devicepermission)


For information on how the user is prompted for permission, see [View, manage, and install](https://support.microsoft.com/office/16278816-1948-4028-91e5-76dca5380f8d) [add-ins for Excel, PowerPoint, and Word](https://support.microsoft.com/office/16278816-1948-4028-91e5-76dca5380f8d) .

#### 7 **Note**

- Add-ins that run in Office desktop clients or in browsers not based on Chromium automatically show a dialog requesting for a user's permission. The developer doesn't need to implement the device permission API on these platforms.
- Add-ins that run in Safari are blocked from accessing a user's device capabilities. The device permission API isn't supported in Safari.

### **Other security practices**

Developers should also take note of the following security practices.

- Developers shouldn't use ActiveX controls in Office Add-ins as ActiveX controls don't support the cross-platform nature of the add-in platform.
- Content and task pane add-ins assume the same SSL settings that the browser uses by default, and allows most content to be delivered only by SSL. Outlook add-ins require all content to be delivered by SSL. Developers must specify in the **<SourceLocation>** element of the add-in manifest a URL that uses HTTPS, to identify the location of the HTML file for the add-in.

To make sure add-ins aren't delivering content by using HTTP, when testing add-ins, developers should make sure the following settings are selected in **Internet Options** in **Control Panel** and no security warnings appear in their test scenarios.

- Make sure the security setting, **Display mixed content**, for the **Internet** zone is set to **Prompt**. You can do that by selecting the following in **Internet Options**: on the **Security** tab, select the **Internet** zone, select **Custom level**, scroll to look for **Display mixed content**, and select **Prompt** if it isn't already selected.
- Make sure **Warn if Changing between Secure and not secure mode** is selected in the **Advanced** tab of the **Internet Options** dialog box.
- To make sure that add-ins don't use excessive CPU core or memory resources and cause any denial of service on a client computer, the add-in platform establishes resource usage limits. As part of testing, developers should verify whether an add-in performs within the resource usage limits.


- Before publishing an add-in, developers should make sure that any personal identifiable information that they expose in their add-in files is secure.
- Developers shouldn't embed keys that they use to access APIs or services from Microsoft and others (such as Bing, Google, or Facebook) directly in the HTML pages of their add-in. Instead, they should create a custom web service or store the keys in some other form of secure web storage that they can then call to pass the key value to their add-in.
- Developers should do the following when submitting an add-in to AppSource.
	- Host the add-in they are submitting on a web server that supports SSL.
	- Produce a statement outlining a compliant privacy policy.
	- Be ready to sign a contractual agreement upon submitting the add-in.

Other than resource usage rules, developers for Outlook add-ins should also make sure their add-ins observe limits for specifying activation rules and using the JavaScript API. For more information, see Limits for activation and JavaScript API for Outlook add-ins.

# **IT administrators' control**

In a corporate setting, IT administrators have ultimate authority over enabling or disabling access to AppSource and any private catalogs.

The management and enforcement of Office settings is done with group policy settings. These are configurable through the [Office Deployment Tool](https://learn.microsoft.com/en-us/deployoffice/overview-office-deployment-tool), in conjunction with the [Office](https://learn.microsoft.com/en-us/deployoffice/admincenter/overview-office-customization-tool) [Customization Tool](https://learn.microsoft.com/en-us/deployoffice/admincenter/overview-office-customization-tool).

ノ **Expand table**

| Setting name                               | Description                                                                                                                                                                                    |
|--------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Allow Unsecure web<br>add-ins and Catalogs | Allows users to run non-secure Office Add-ins, which are Office Add-ins that<br>have webpage or catalog locations that are not SSL-secured (https://) and are<br>not in users' Internet zones. |
| Block Web Add-ins                          | Allows you to prevent users from running Office Add-ins that use web<br>technologies.                                                                                                          |
| Block the Office Store                     | Allows you to prevent users from getting or running Office Add-ins that come<br>from AppSource                                                                                                 |

To specify permissions to install and manage Outlook add-ins in an organization that uses Exchange Online, configure administrative and user roles in the Exchange admin center. For more information, see [Specify the administrators and users who can install and manage add](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/add-ins-for-outlook/specify-who-can-install-and-manage-add-ins)[ins for Outlook in Exchange Online.](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/add-ins-for-outlook/specify-who-can-install-and-manage-add-ins)


# **See also**

- Requesting permissions for API use in add-ins
- Understanding Outlook add-in permissions
- Limits for activation and JavaScript API for Outlook add-ins
- Addressing same-origin policy limitations in Office Add-ins
- [Same Origin Policy](https://www.w3.org/Security/wiki/Same_Origin_Policy)
- [Same Origin Policy Part 1: No Peeking](https://learn.microsoft.com/en-us/archive/blogs/ieinternals/same-origin-policy-part-1-no-peeking)
- [Same origin policy for JavaScript](https://developer.mozilla.org/docs/Web/Security/Same-origin_policy)
- [IE Protect Mode](https://learn.microsoft.com/en-us/office/troubleshoot/office-suite-issues/apps-for-office-not-start)
- [Privacy controls for Microsoft 365 Apps](https://learn.microsoft.com/en-us/deployoffice/privacy/overview-privacy-controls)


# **Requesting permissions for API use in add-ins**

06/17/2025

This article describes the different permission levels that you declare in your add-in's manifest to specify the level of JavaScript API access your add-in requires for its features.

#### ) **Important**

This article applies to only non-Outlook add-ins. To learn about permission levels for Outlook add-ins, see **Understanding Outlook add-in permissions**.

## **Permissions model**

A five-level JavaScript API access-permissions model provides the basis for privacy and security for users of your add-ins. The following figure shows the five levels of API permissions you can declare in your add-in's manifest.

These permissions specify the subset of the API that the add-in runtime allows your add-in to use when a user inserts, and then activates (trusts) your add-in. To declare the permission level your add-in requires, specify one of the permission values in the manifest. The markup varies depending on the type of manifest.


- **Unified manifest for Microsoft 365**: Use the ["authorization.permissions.resourceSpecific"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root-authorization-permissions#resourcespecific) property. The following example requests the **write document** permission, which allows only methods that can write to (but not read) the document.

```
JSON
"authorization": {
 "permissions": {
 "resourceSpecific": [
 ...
 {
 "name": "Document.Write.User",
 "type": "Delegated"
 },
 ]
 } 
},
```
#### 7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word add-ins.

- **Add-in only manifest**: Use the [Permissions](https://learn.microsoft.com/en-us/javascript/api/manifest/permissions) element of the manifest. The following example requests the **write document** permission, which allows only methods that can write to (but not read) the document.
XML

<Permissions>WriteDocument</Permissions>

As a best practice, you should request permissions based on the principle of *least privilege*. That is, you should request permission to access only the minimum subset of the API that your add-in requires to function correctly. For example, if your add-in needs only to read data in a user's document for its features, you should request no more than the **read document** permission.

The following table describes the subsets of the Common and Application-specific JavaScript APIs that are enabled by each permission level.

ノ **Expand table**

| Permission<br>canonical<br>name | Add-in only<br>manifest name | Unified manifest name    | Enabled<br>subset of<br>the<br>Application<br>specific<br>APIs | Enabled subset of the Common APIs                                                                                                                                 |
|---------------------------------|------------------------------|--------------------------|----------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| restricted                      | Restricted                   | Document.Restricted.User | None                                                           | The methods of the Settings object, and the<br>Document.getActiveViewAsync method. This<br>is the minimum permission level that can be<br>requested by an add-in. |


| Permission<br>canonical<br>name | Add-in only<br>manifest name | Unified manifest name | Enabled<br>subset of<br>the<br>Application<br>specific<br>APIs             | Enabled subset of the Common APIs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------------|------------------------------|-----------------------|----------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| read<br>document                | ReadDocument                 | Document.Read.User    | All and only<br>APIs that<br>read the<br>document or<br>its<br>properties. | In addition to the API allowed by the<br>restricted permission, adds access to the API<br>members necessary to read the document<br>and manage bindings. This includes the use<br>of:<br>The Document.getSelectedDataAsync<br>method to get the selected text, HTML<br>(Word only), or tabular data, but not<br>the underlying Open Office XML<br>(OOXML) code that contains all of the<br>data in the document.<br>The Document.getFileAsync method to<br>get all of the text in the document, but<br>not the underlying OOXML binary<br>copy of the document<br>The Binding.getDataAsync method for<br>reading bound data in the document.<br>The addFromNamedItemAsync,<br>addFromPromptAsync, and<br>addFromSelectionAsync methods of<br>the Bindings object for creating<br>bindings in the document.<br>The getAllAsync, getByIdAsync, and<br>releaseByIdAsync methods of the<br>Bindings object for accessing and<br>removing bindings in the document.<br>The Document.getFilePropertiesAsync<br>method to access document file<br>properties, such as the URL of the<br>document.<br>The Document.goToByIdAsync method<br>to navigate to named objects and<br>locations in the document.<br>For task pane add-ins for Project, all of<br>the "get" methods of the<br>ProjectDocument object. |


| Permission<br>canonical<br>name | Add-in only<br>manifest name | Unified manifest name   | Enabled<br>subset of<br>the<br>Application<br>specific<br>APIs                            | Enabled subset of the Common APIs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------------|------------------------------|-------------------------|-------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| read all<br>document            | ReadAllDocument              | Document.ReadAll.User   | Same as<br>read<br>document.                                                              | In addition to the API allowed by the<br>restricted and read document permissions,<br>allows the following additional access to<br>document data.<br>The Document.getSelectedDataAsync<br>and Document.getFileAsync methods<br>can access the underlying OOXML<br>code of the document (which in<br>addition to the text may include<br>formatting, links, embedded graphics,<br>comments, revisions, and so forth).                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| write<br>document               | WriteDocument                | Document.Write.User     | All and only<br>APIs that<br>write to the<br>document or<br>its<br>properties.            | In addition to the API allowed by the<br>restricted permission, adds access to the<br>following API members.<br>The Document.setSelectedDataAsync<br>method to write to the user's selection<br>in the document.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| read/write<br>document          | ReadWriteDocument            | Document.ReadWrite.User | All<br>Application<br>specfic APIs,<br>including<br>those that<br>subscribe to<br>events. | In addition to the API allowed by the<br>restricted, read document, read all<br>document, and write document<br>permissions, includes access to all remaining<br>API supported by add-ins, including<br>methods for subscribing to events. You must<br>declare the read/write document permission<br>to access these additional API members:<br>The Binding.setDataAsync method for<br>writing to bound regions of the<br>document<br>The TableBinding.addRowsAsync<br>method for adding rows to bound<br>tables.<br>The TableBinding.addColumnsAsync<br>method for adding columns to bound<br>tables.<br>The<br>TableBinding.deleteAllDataValuesAsync<br>method for deleting all data in a<br>bound table.<br>The setFormatsAsync,<br>clearFormatsAsync, and<br>setTableOptionsAsync methods of the<br>TableBinding object for setting<br>formatting and options on bound<br>tables. |


| Permission<br>canonical<br>name | Add-in only<br>manifest name | Unified manifest name | Enabled<br>subset of<br>the<br>Application<br>specific<br>APIs | Enabled subset of the Common APIs                                                                                                                                                                                                                                                                                                                                |
|---------------------------------|------------------------------|-----------------------|----------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                 |                              |                       |                                                                | All of the members of the<br>CustomXmlNode, CustomXmlPart,<br>CustomXmlParts, and<br>CustomXmlPrefixMappings objects<br>All of the methods for subscribing to<br>the events supported by add-ins,<br>specifically the addHandlerAsync and<br>removeHandlerAsync methods of the<br>Binding, CustomXmlPart, Document,<br>ProjectDocument, and Settings<br>objects. |

### **See also**

- Privacy and security for Office Add-ins


# **Develop your Office Add-in to work with ITP when using third-party cookies**

Article • 08/08/2024

If your Office Add-in requires third-party cookies, those cookies are blocked if the Runtime that loaded your add-in uses Intelligent Tracking Prevention (ITP). You may be using third-party cookies to authenticate users, or for other scenarios, such as storing settings.

If your Office Add-in and website must rely on third-party cookies, use the following steps to work with ITP.

- 1. Set up [OAuth 2.0 Authorization](https://tools.ietf.org/html/rfc6749)  so that the authenticating domain (in your case, the third-party that expects cookies) forwards an authorization token to your website. Use the token to establish a first-party session with a server-set Secure and [HttpOnly cookie](https://developer.mozilla.org/docs/Web/HTTP/Cookies#Secure_and_HttpOnly_cookies) .
- 2. Use the [Storage Access API](https://webkit.org/blog/8124/introducing-storage-access-api/)  so that the third-party can request permission to get access to its first-party cookies. Current versions of Office on Mac and Office on the web both support this API.

#### 7 **Note**

If you're using cookies for purposes other than authentication, consider using localStorage for your scenario.

However, note that starting in Version 115 of Chromium-based browsers, such as Chrome and Edge, **[storage partitioning](https://developer.chrome.com/docs/privacy-sandbox/storage-partitioning/)** is enabled to prevent specific side-channel cross-site tracking (see also **[Microsoft Edge browser policies](https://learn.microsoft.com/en-us/deployedge/microsoft-edge-policies#defaultthirdpartystoragepartitioningsetting)**). This means that data stored by storage APIs, such as local storage, are only available to contexts with the same origin and the same top-level site.

The following code sample shows how to use the Storage Access API.

#### JavaScript

```
function displayLoginButton() {
 const button = createLoginButton();
 button.addEventListener("click", function(ev) {
 document.requestStorageAccess().then(function() {
 authenticateWithCookies(); 
 }).catch(function() {
 // User must have previously interacted with this domain loaded in a
```


```
top frame.
 // Also you should have previously written a cookie when domain was
loaded in the top frame.
 console.error("User cancelled or requirements were not met.");
 });
 });
}
if (document.hasStorageAccess) { 
 document.hasStorageAccess().then(function(hasStorageAccess) { 
 if (!hasStorageAccess) { 
 displayLoginButton(); 
 } else { 
 authenticateWithCookies(); 
 } 
 }); 
} else { 
 authenticateWithCookies(); 
}
```
## **About ITP and third-party cookies**

Third-party cookies are cookies that are loaded in an iframe, where the domain is different from the top level frame. ITP could affect complex authentication scenarios, where a pop-up dialog is used to enter credentials and then the cookie access is needed by an add-in iframe to complete the authentication flow. ITP could also affect silent authentication scenarios, where you have previously used a pop-up dialog to authenticate, but subsequent use of the add-in tries to authenticate through a hidden iframe.

When developing Office Add-ins on Mac, access to third-party cookies is blocked by the MacOS Big Sur SDK. This is because WKWebView ITP is enabled by default on the Safari browser, and WKWebView blocks all third-party cookies. Office on Mac Version 16.44 (20121301) or later is integrated with the MacOS Big Sur SDK.

In the Safari browser, end users can toggle the **Prevent cross-site tracking** checkbox under **Preference** > **Privacy** to turn off ITP. However, ITP can't be turned off for the embedded WKWebView control.

# **Google Chrome third-party cookie support**

Google Chrome is working to give users more control of their browsing experience. Users will be able to block third-party cookies in their Chrome browser. This will prevent your add-in from using any such cookies. This may cause issues when the add-in authenticates the user, such as multiple sign-on requests or errors.


For improved authentication experiences, see [Using device state for an improved SSO](https://devblogs.microsoft.com/identity/managed-devices-for-blocked-third-party-cookies/) [experience on browsers with blocked third-party cookies](https://devblogs.microsoft.com/identity/managed-devices-for-blocked-third-party-cookies/) .

For more information about the Google Chrome rollout, see [A new path for Privacy](https://privacysandbox.com/news/privacy-sandbox-update) [Sandbox on the web](https://privacysandbox.com/news/privacy-sandbox-update) .

### **See also**

- [Handle ITP in Safari and other browsers where third-party cookies are blocked](https://learn.microsoft.com/en-us/azure/active-directory/develop/reference-third-party-cookies-spas)
- [Tracking Prevention in WebKit](https://webkit.org/tracking-prevention/)
- [Chrome's "Privacy Sandbox"](https://blog.chromium.org/2020/01/building-more-private-web-path-towards.html)
- [Introducing the Storage Access API](https://blogs.windows.com/msedgedev/2020/07/08/introducing-storage-access-api/)


# **Addressing same-origin policy limitations in Office Add-ins**

Article • 01/09/2024

The same-origin policy enforced by the browser or webview control prevents a script loaded from one domain from getting or manipulating properties of a webpage from another domain. This means that, by default, the domain of a requested URL must be the same as the domain of the current webpage. For example, this policy will prevent a webpage in one domain from making [XmlHttpRequest](https://www.w3.org/TR/XMLHttpRequest/) web-service calls to a domain other than the one where it is hosted.

Because Office Add-ins are hosted in a webview control, the same-origin policy applies to script running in their web pages as well.

The same-origin policy can be an unnecessary handicap in many situations, such as when a web application hosts content and APIs across multiple subdomains. There are a few common techniques for securely overcoming same-origin policy enforcement. This article can only provide the briefest introduction to some of them. Please use the links provided to get started in your research of these techniques.

### **Use JSONP for anonymous access**

One way to overcome same-origin policy limitations is to use [JSONP](https://www.w3schools.com/js/js_json_jsonp.asp) to provide a proxy for the web service. You do this by including a script tag with a src attribute that points to some script hosted on any domain. You can programmatically create the script tags, dynamically create the URL to point the src attribute to, and then pass parameters to the URL via URI query parameters. Web service providers create and host JavaScript code at specific URLs, and return different scripts depending on the URI query parameters. These scripts then execute where they are inserted and work as expected.

The following is an example of JSONP that uses a technique that will work in any Office Add-in.

```
JavaScript
// Dynamically create an HTML SCRIPT element that obtains the details for
the specified video.
function loadVideoDetails(videoIndex) {
 // Dynamically create a new HTML SCRIPT element in the webpage.
 const script = document.createElement("script");
 // Specify the URL to retrieve the indicated video from a feed of a
current list of videos,
```


```
 // as the value of the src attribute of the SCRIPT element. 
 script.setAttribute("src", "https://gdata.youtube.com/feeds/api/videos/"
+ 
 videos[videoIndex].Id + "?alt=json-in-
script&callback=videoDetailsLoaded");
 // Insert the SCRIPT element at the end of the HEAD section.
 document.getElementsByTagName('head')[0].appendChild(script);
}
```
## **Implement server-side code using a tokenbased authorization scheme**

Another way to address same-origin policy limitations is to provide server-side code that uses [OAuth 2.0](https://oauth.net/2/) flows to enable one domain to get authorized access to resources hosted on another.

# **Use cross-origin resource sharing (CORS)**

To learn more about cross-origin resource sharing, see the many resources available on the web, such as [Cross-Origin Resource Sharing (CORS)](https://web.dev/cross-origin-resource-sharing/) .

#### 7 **Note**

For information on how to use CORS in an Outlook add-in that implements eventbased activation or integrated spam reporting (preview), see **Use single sign-on [(SSO) or cross-origin resource sharing (CORS) in your event-based or spam](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/use-sso-in-event-based-activation)reporting Outlook add-in**.

# **Build your own proxy using IFRAME and POST MESSAGE (Cross-Window Messaging)**

For an example of how to build your own proxy using IFRAME and POST MESSAGE, see [Cross-Window Messaging](https://johnresig.com/blog/cross-window-messaging/) .

### **See also**

- Privacy and security for Office Add-ins


# **Wildcard trusted domains**

Article • 05/07/2025

Besides its own domain, an add-in can access resources in certain other domains such as authentication points for major identity providers and in any domain listed in the manifest. The latter domains are specified in the [AppDomains](https://learn.microsoft.com/en-us/javascript/api/manifest/appdomains) element of the add-in only manifest or the ["validDomains"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root#validdomains) property of the unified manifest. Wildcards aren't allowed in the add-in only manifest. They are allowed in the unified manifest because some Teams apps and other Microsoft 365 apps honor them; but Office Add-ins don't honor "validDomains" that contain wildcards.

Windows administrators can make Office Add-ins, *running on Windows only*, honor domains that include a wildcard by setting the

**HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\AllowedAppDomains** registry key with the domain. The following is an example.

```
[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\AllowedAppDomains]
"AppDomain1"="https://*.contoso.com"
```
Administrators can use a *.reg file to do automate the process. The following is an example of such a file.

```
Windows Registry Editor Version 5.00
```

```
[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\AllowedAppDomains]
"AppDomain1"="https://*.europe.contoso.com"
```

```
[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\AllowedAppDomains]
"AppDomain2"="https://*.africa.contoso.com"
```
7 **Note**

- The domains are honored only in add-ins running on Windows desktop versions of Office. They aren't honored when an add-in is running in Office on the web even on computers where the registry change has been made.
- The registry setting affects *all* add-ins running on the computer: they all trust the domains in the registry key.


# **Persist add-in state and settings**

08/28/2025

Office Add-ins are essentially web applications running in the stateless environment of a browser iframe or a webview control. (For brevity hereafter, this article uses "browser control" to mean "browser or webview control".) When in use, your add-in may need to persist data to maintain the continuity of certain operations or features across sessions. For example, your add-in may have custom settings or other values that it needs to save and reload the next time it's initialized, such as a user's preferred view or default location. To do that, you can:

- Use techniques provided by the underlying browser control.
- Use the application-specific Office JavaScript APIs for Excel, Word, and Outlook that store data.

If you need to persist state across documents, such as tracking user preferences across any documents they open, you'll need to use a different approach. For example, you could use SSO to obtain the user identity, and then save the user ID and their settings to an online database.

# **Browser storage**

Persist data across add-in instances with tools from the underlying browser control, such as browser cookies or HTML5 web storage ([localStorage](https://developer.mozilla.org/docs/Web/API/Window/localStorage) or [sessionStorage](https://developer.mozilla.org/docs/Web/API/Window/sessionStorage) ).

Some browsers or the user's browser settings may block browser-based storage techniques. You should test for availability as documented in [Using the Web Storage API](https://developer.mozilla.org/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API) .

### **Storage partitioning**

As a best practice, any private data should be stored in partitioned localStorage . [Office.context.partitionKey](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-partitionkey-member) provides a key for use with local storage. This ensures that data stored in local storage is only available in the same context.

#### 7 **Note**

The partition key is undefined in environments without partitioning, such as the webview controls for Office on Windows. Where it is defined, the partition key is a hash of the following two domains.

- The domain that the top-level browser window is at, such as excel.cloud.microsoft in the case of Excel on the web.
- The domain of the add-in, such as myAddin.contoso.com .


So, each of the following would be a different partition:

- excel.cloud.microsoft + myAddin.contoso.com
- word.cloud.microsoft + myAddin.contoso.com
- word.cloud.microsoft + myOtherAddin.contoso.com

The following example shows how to use the partition key with localStorage .

```
JavaScript
// Store the value "Hello" in local storage with the key "myKey1".
setInLocalStorage("myKey1", "Hello");
// ... 
// Retrieve the value stored in local storage under the key "myKey1".
const message = getFromLocalStorage("myKey1");
console.log(message);
// ...
function setInLocalStorage(key: string, value: string) {
 const myPartitionKey = Office.context.partitionKey;
 // Check if local storage is partitioned. 
 // If so, use the partition to ensure the data is only accessible by your add-
in.
 if (myPartitionKey) {
 localStorage.setItem(myPartitionKey + key, value);
 } else {
 localStorage.setItem(key, value);
 }
}
function getFromLocalStorage(key: string) {
 const myPartitionKey = Office.context.partitionKey;
 // Check if local storage is partitioned.
 if (myPartitionKey) {
 return localStorage.getItem(myPartitionKey + key);
 } else {
 return localStorage.getItem(key);
 }
}
```
Starting in Version 115 of Chromium-based browsers, such as Chrome and Edge, [storage](https://developer.chrome.com/docs/privacy-sandbox/storage-partitioning/) [partitioning](https://developer.chrome.com/docs/privacy-sandbox/storage-partitioning/) is enabled to prevent specific side-channel cross-site tracking (see also [Microsoft](https://learn.microsoft.com/en-us/deployedge/microsoft-edge-policies#defaultthirdpartystoragepartitioningsetting) [Edge browser policies)](https://learn.microsoft.com/en-us/deployedge/microsoft-edge-policies#defaultthirdpartystoragepartitioningsetting). Similar to the Office key-based partitioning, data stored by storage


APIs, such as local storage, is only available to contexts with the same origin and the same toplevel site.

# **Application-specific settings and persistence**

Excel, Word, and Outlook provide application-specific APIs to save settings and other data. Use these instead of the Common APIs mentioned later in this article so that your add-in follows consistent patterns and is optimized for the targeted application.

### **Settings in Excel and Word**

The application-specific JavaScript APIs for Excel and for Word also provide access to the custom settings. Settings are unique to a single Excel file and add-in pairing. For more information, see [Excel.SettingCollection](https://learn.microsoft.com/en-us/javascript/api/excel/excel.settingcollection) and [Word.SettingCollection.](https://learn.microsoft.com/en-us/javascript/api/word/word.settingcollection)

The following example shows how to create and access a setting in Excel. The process is functionally equivalent in Word, which uses [Document.settings](https://learn.microsoft.com/en-us/javascript/api/word/word.document#word-word-document-settings-member) instead of Workbook.settings .

```
JavaScript
await Excel.run(async (context) => {
 const settings = context.workbook.settings;
 settings.add("NeedsReview", true);
 const needsReview = settings.getItem("NeedsReview");
 needsReview.load("value");
 await context.sync();
 console.log("Workbook needs review : " + needsReview.value);
});
```
#### **Custom XML data in Excel and Word**

The Open XML **.xlsx** and **.docx** file formats let your add-in embed custom XML data in the Excel workbook or Word document. This data persists with the file, independent of the add-in.

A [Word.Document](https://learn.microsoft.com/en-us/javascript/api/word/word.document#word-word-document-customxmlparts-member) and [Excel.Workbook](https://learn.microsoft.com/en-us/javascript/api/excel/excel.workbook#excel-excel-workbook-customxmlparts-member) contain a CustomXmlPartCollection , which is a list of CustomXmlParts . These give access to the XML strings and a corresponding unique ID. By storing these IDs as settings, your add-in can maintain the keys to its XML parts between sessions.

The following samples show how to use custom XML parts with an Excel workbook. The first code block demonstrates how to embed XML data. It stores a list of reviewers, then uses the workbook's settings to save the XML's id for future retrieval. The second block shows how to 


access that XML later. The "ContosoReviewXmlPartId" setting is loaded and passed to the workbook's customXmlParts . The XML data is then printed to the console. The process is functionally equivalent in Word, which uses [Document.customXmlParts](https://learn.microsoft.com/en-us/javascript/api/word/word.document#word-word-document-customxmlparts-member) instead of Workbook.customXmlParts .

```
JavaScript
await Excel.run(async (context) => {
 // Add reviewer data to the document as XML
 const originalXml = "<Reviewers xmlns='http://schemas.contoso.com/review/1.0'>
<Reviewer>Juan</Reviewer><Reviewer>Hong</Reviewer><Reviewer>Sally</Reviewer>
</Reviewers>";
 const customXmlPart = context.workbook.customXmlParts.add(originalXml);
 customXmlPart.load("id");
 await context.sync();
 // Store the XML part's ID in a setting
 const settings = context.workbook.settings;
 settings.add("ContosoReviewXmlPartId", customXmlPart.id);
});
```
#### 7 **Note**

CustomXMLPart.namespaceUri is only populated if the top-level custom XML element contains the xmlns attribute.

#### **Custom properties in Excel and Word**

The [Excel.DocumentProperties.custom](https://learn.microsoft.com/en-us/javascript/api/excel/excel.documentproperties#excel-excel-documentproperties-custom-member) and [Word.DocumentProperties.customProperties](https://learn.microsoft.com/en-us/javascript/api/word/word.documentproperties#word-word-documentproperties-customproperties-member) properties represent collections of key-value pairs for user-defined properties. The following Excel example shows how to create a custom property named **Introduction** with the value "Hello", then retrieve it.

```
JavaScript
await Excel.run(async (context) => {
 const customDocProperties = context.workbook.properties.custom;
 customDocProperties.add("Introduction", "Hello");
 await context.sync();
});
// ...
await Excel.run(async (context) => {
 const customDocProperties = context.workbook.properties.custom;
 const customProperty = customDocProperties.getItem("Introduction");
```


```
 customProperty.load(["key", "value"]);
 await context.sync();
 console.log("Custom key : " + customProperty.key); // "Introduction"
 console.log("Custom value : " + customProperty.value); // "Hello"
});
```
#### **Tip**

In Excel, custom properties can also be set at the worksheet level with the **[Worksheet.customProperties](https://learn.microsoft.com/en-us/javascript/api/excel/excel.worksheet#excel-excel-worksheet-customproperties-member)** property. These are similar to document-level custom properties, except that the same key can be repeated across different worksheets.

### **How to save settings in an Outlook add-in**

For information about how to save settings in an Outlook add-in, see Get and set add-in metadata for an Outlook add-in and Get and set internet headers on a message in an Outlook add-in.

### **Common API settings and persistence**

The Common APIs provide objects to save add-in state across sessions. The saved settings values are associated with the [Id](https://learn.microsoft.com/en-us/javascript/api/manifest/id) of the add-in that created them. Internally, the data accessed with the Settings , CustomProperties , or RoamingSettings objects is stored as a serialized JavaScript Object Notation (JSON) object that contains name/value pairs. The name (key) for each value must be a string , and the stored value can be a JavaScript string , number , date , or object , but not a **function**.

This example of the property bag structure contains three defined **string** values named firstName , location , and defaultView .

```
JSON
{
 "firstName":"Erik",
 "location":"98052",
 "defaultView":"basic"
}
```
After the settings property bag is saved during the previous add-in session, it can be loaded when the add-in is initialized or at any point after that during the add-in's current session. During the session, the settings are managed in entirely in memory using the get , set , and


remove methods of the object that corresponds to the kind of settings you're creating (**Settings**, **CustomProperties**, or **RoamingSettings**).

#### ) **Important**

To persist any additions, updates, or deletions made during the add-in's current session to the storage location, you must call the saveAsync method of the corresponding object used to work with that kind of settings. The get , set , and remove methods operate only on the in-memory copy of the settings property bag. If your add-in is closed without calling saveAsync , any changes made to settings during that session will be lost.

### **How to save add-in state and settings per document for content and task pane add-ins**

To persist state or custom settings of a content or task pane add-in for Word, Excel, or PowerPoint, use the [Settings](https://learn.microsoft.com/en-us/javascript/api/office/office.settings) object and its methods. The property bag created with the methods of the Settings object are available only to the instance of the content or task pane add-in that created it, and only from the document in which it is saved.

The Settings object is automatically loaded as part of the [Document](https://learn.microsoft.com/en-us/javascript/api/office/office.document) object, and is available when the task pane or content add-in is activated. After the Document object is instantiated, you can access the Settings object with the [settings](https://learn.microsoft.com/en-us/javascript/api/office/office.document#office-office-document-settings-member) property of the Document object. During the lifetime of the session, you can use the Settings.get , Settings.set , and Settings.remove methods to read, write, or remove persisted settings and add-in state from the in-memory copy of the property bag.

Because the set and remove methods operate against only the in-memory copy of the settings property bag, to save new or changed settings back to the document the add-in is associated with, you must call the [Settings.saveAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.settings#office-office-settings-saveasync-member(1)) method.

#### **Create or update a setting value**

The following code example shows how to use the [Settings.set](https://learn.microsoft.com/en-us/javascript/api/office/office.settings#office-office-settings-set-member(1)) method to create a setting called 'themeColor' with a value 'green' . The first parameter of the set method is the casesensitive *name* (Id) of the setting to set or create. The second parameter is the *value* of the setting.

JavaScript

Office.context.document.settings.set('themeColor', 'green');


The setting with the specified name is created if it doesn't already exist, or its value is updated if it does exist. Use the Settings.saveAsync method to persist the new or updated settings to the document.

#### **Get the value of a setting**

The following example shows how use the [Settings.get](https://learn.microsoft.com/en-us/javascript/api/office/office.settings#office-office-settings-get-member(1)) method to get the value of a setting called "themeColor". The only parameter of the get method is the case-sensitive *name* of the setting.

```
JavaScript
write('Current value for mySetting: ' +
Office.context.document.settings.get('themeColor'));
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message;
}
```
The get method returns the value that was previously saved for the setting *name* that was passed in. If the setting doesn't exist, the method returns **null**.

#### **Remove a setting**

The following example shows how to use the [Settings.remove](https://learn.microsoft.com/en-us/javascript/api/office/office.settings#office-office-settings-remove-member(1)) method to remove a setting with the name "themeColor". The only parameter of the remove method is the case-sensitive *name* of the setting.

```
JavaScript
Office.context.document.settings.remove('themeColor');
```
Nothing will happen if the setting doesn't exist. Use the Settings.saveAsync method to persist removal of the setting from the document.

### **Save your settings**

To save any additions, changes, or deletions your add-in made to the in-memory copy of the settings property bag during the current session, you must call the [Settings.saveAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.settings#office-office-settings-saveasync-member(1)) method to store them in the document. The only parameter of the saveAsync method is *callback*, which is a callback function with a single parameter.


```
Office.context.document.settings.saveAsync(function (asyncResult) {
 if (asyncResult.status == Office.AsyncResultStatus.Failed) {
 write('Settings save failed. Error: ' + asyncResult.error.message);
 } else {
 write('Settings saved.');
 }
});
// Function that writes to a div with id='message' on the page.
function write(message){
 document.getElementById('message').innerText += message;
}
```
The anonymous function passed into the saveAsync method as the *callback* parameter is executed when the operation is completed. The *asyncResult* parameter of the callback provides access to an AsyncResult object that contains the status of the operation. In the example, the function checks the AsyncResult.status property to see if the save operation succeeded or failed, and then displays the result in the add-in's page.

### **How to save custom XML to the document**

JavaScript

A custom XML part is an available storage option for when you want to store information that has a structured character or need the data to be accessible across instances of your add-in. Note that data stored this way can also be accessed by other add-ins. You can persist custom XML markup in a task pane add-in for Word (and for Excel and Word using application-specific API as mentioned in the previous paragraph). In Word, you can use the [CustomXmlPart](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlpart) object and its methods. The following code creates a custom XML part and displays its ID and then its content in divs on the page. Note that there must be an xmlns attribute in the XML string.

```
JavaScript
function createCustomXmlPart() {
 const xmlString = "<Reviewers xmlns='http://schemas.contoso.com/review/1.0'>
<Reviewer>Juan</Reviewer><Reviewer>Hong</Reviewer><Reviewer>Sally</Reviewer>
</Reviewers>";
 Office.context.document.customXmlParts.addAsync(xmlString,
 (asyncResult) => {
 $("#xml-id").text("Your new XML part's ID: " + asyncResult.value.id);
 asyncResult.value.getXmlAsync(
 (asyncResult) => {
 $("#xml-blob").text(asyncResult.value);
 }
 );
 }
```


 ); }

To retrieve a custom XML part, use the [getByIdAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.customxmlparts#office-office-customxmlparts-getbyidasync-member(1)) method, but the ID is a GUID that is generated when the XML part is created, so you can't know when coding what the ID is. For that reason, it's a good practice when creating an XML part to immediately store the ID of the XML part as a setting and give it a memorable key. The following method shows how to do this.

```
JavaScript
function createCustomXmlPartAndStoreId() {
 const xmlString = "<Reviewers xmlns='http://schemas.contoso.com/review/1.0'>
<Reviewer>Juan</Reviewer><Reviewer>Hong</Reviewer><Reviewer>Sally</Reviewer>
</Reviewers>";
 Office.context.document.customXmlParts.addAsync(xmlString,
 (asyncResult) => {
 Office.context.document.settings.set('ReviewersID',
asyncResult.value.id);
 Office.context.document.settings.saveAsync();
 }
 );
}
```
The following code shows how to retrieve the XML part by first getting its ID from a setting.

```
JavaScript
function getReviewers() {
 const reviewersXmlId = Office.context.document.settings.get('ReviewersID');
 Office.context.document.customXmlParts.getByIdAsync(reviewersXmlId,
 (asyncResult) => {
 asyncResult.value.getXmlAsync(
 (asyncResult) => {
 $("#xml-blob").text(asyncResult.value);
 }
 );
 }
 );
}
```
# **See also**

- Understanding the Office JavaScript API
- Outlook add-ins
- Get and set add-in metadata for an Outlook add-in


- Get and set internet headers on a message in an Outlook add-in
- [Excel-Add-in-JavaScript-PersistCustomSettings](https://github.com/OfficeDev/Excel-Add-in-JavaScript-PersistCustomSettings)


# **Overview of authentication and authorization in Office Add-ins**

Article • 06/23/2023

Office Add-ins allow anonymous access by default, but you can require users to sign in to use your add-in with a Microsoft account, a Microsoft 365 Education or work account, or other common account. This task is called user authentication because it enables the add-in to know who the user is.

Your add-in can also get the user's consent to access their Microsoft Graph data (such as their Microsoft 365 profile, OneDrive files, and SharePoint data) or data in other external sources such as Google, Facebook, LinkedIn, SalesForce, and GitHub. This task is called add-in (or app) authorization, because it's the *add-in* that is being authorized, not the user.

# **Key resources for authentication and authorization**

This documentation explains how to build and configure Office Add-ins to successfully implement authentication and authorization. However, many concepts and security technologies mentioned are outside the scope of this documentation. For example, general security concepts such as OAuth flows, token caching, or identity management are not explained here. This documentation also doesn't document anything specific to Microsoft Azure or the Microsoft identity platform. We recommend you refer to the following resources if you need more information in those areas.

- [Microsoft identity platform](https://learn.microsoft.com/en-us/azure/active-directory/develop)
- [Microsoft identity platform support and help options for developers](https://learn.microsoft.com/en-us/azure/active-directory/develop/developer-support-help-options)
- [OAuth 2.0 and OpenID Connect protocols on the Microsoft identity platform](https://learn.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-protocols)

## **SSO scenarios**

Using Single Sign-on (SSO) is convenient for the user because they only have to sign in once to Office. They don't need to sign in separately to your add-in. SSO isn't supported on all versions of Office, so you'll still need to implement an alternative sign-in approach, by using the Microsoft identity platform. For more information on supported Office versions, see [Identity API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/identity-api-requirement-sets)


### **Get the user's identity through SSO**

Often your add-in only needs the user's identity. For example, you may just want to personalize your add-in and display the user's name on the task pane. Or you might want a unique ID to associate the user with their data in your database. This can be accomplished by just getting the access token for the user from Office.

To get the user's identity through SSO, call the [getAccessToken](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.auth#office-runtime-officeruntime-auth-getaccesstoken-member(1)) method. The method returns an access token that is also an identity token containing several claims that are unique to the current signed in user, including preferred_username , name , sub , and oid . For more information on these properties, see [Microsoft identity platform ID tokens](https://learn.microsoft.com/en-us/azure/active-directory/develop/id-tokens). For an example of the token returned by [getAccessToken](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.auth#office-runtime-officeruntime-auth-getaccesstoken-member(1)), see Example access token.

If the user isn't signed in, Office will open a dialog box and use the Microsoft identity platform to request the user to sign in. Then the method will return an access token, or throw an error if unable to sign in the user.

In a scenario where you need to store data for the user, refer to Microsoft identity [platform ID tokens for information about how to get a value from the token to uni](https://learn.microsoft.com/en-us/azure/active-directory/develop/id-tokens)quely identify the user. Use that value to look up the user in a user table or user database that you maintain. Use the database to store user-relative information such as the user's preferences or the state of the user's account. Since you're using SSO, your users don't sign-in separately to your add-in, so you don't need to store a password for the user.

Before you begin implementing user authentication with SSO, be sure that you're thoroughly familiar with the article Enable single sign-on for Office Add-ins.

### **Access your Web APIs through SSO**

If your add-in has server-side APIs that require an authorized user, call the [getAccessToken](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.auth#office-runtime-officeruntime-auth-getaccesstoken-member(1)) method to get an access token. The access token provides access to your own web server (configured through a Microsoft Azure app registration). When you call APIs on your web server, you also pass the access token to authorize the user.

The following code shows how to construct an HTTPS GET request to the add-in's web server API to get some data. The code runs on the client side, such as in a task pane. It first gets the access token by calling getAccessToken . Then it constructs an AJAX call with the correct authorization header and URL for the server API.

JavaScript

function getOneDriveFileNames() {


```
 let accessToken = await Office.auth.getAccessToken();
 $.ajax({
 url: "/api/data",
 headers: { "Authorization": "Bearer " + accessToken },
 type: "GET"
 })
 .done(function (result) {
 //... work with data from the result...
 });
}
```
The following code shows an example /api/data handler for the REST call from the previous code example. The code is ASP.NET code running on a web server. The [Authorize] attribute will require that a valid access token is passed from the client, or it'll return an error to the client.

```
C#
 [Authorize]
 // GET api/data
 public async Task<HttpResponseMessage> Get()
 {
 //... obtain and return data to the client-side code...
 }
```
### **Access Microsoft Graph through SSO**

In some scenarios, not only do you need the user's identity, but you also need to access [Microsoft Graph](https://learn.microsoft.com/en-us/graph) resources on behalf of the user. For example, you may need to send an email, or create a chat in Teams on behalf of the user. These actions and more can be accomplished through Microsoft Graph. You'll need to follow these steps:

- 1. Get the access token for the current user through SSO by calling [getAccessToken.](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.auth#office-runtime-officeruntime-auth-getaccesstoken-member(1)) If the user isn't signed in, Office will open a dialog box and sign in the user with the Microsoft identity platform. After the user signs in, or if the user is already signed in, the method returns an access token.
- 2. Pass the access token to your server-side code.
- 3. On the server-side, use the [OAuth 2.0 On-Behalf-Of flow](https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) to exchange the access token for a new access token containing the necessary delegated user identity and permissions to call Microsoft Graph.


For best security to avoid leaking the access token, always perform the On-Behalf-Of flow on the server-side. Call Microsoft Graph APIs from your server, not the client. Don't return the access token to the client-side code.

Before you begin implementing SSO to access Microsoft Graph in your add-in, be sure that you're thoroughly familiar with the following articles.

- Enable single sign-on for Office Add-ins
- Authorize to Microsoft Graph with SSO

You should also read at least one of the following articles that'll walk you through building an Office Add-in to use SSO and access Microsoft Graph. Even if you don't carry out the steps, they contain valuable information about how you implement SSO and the On-Behalf-Of flow.

- Create an ASP.NET Office Add-in that uses single sign-on which walks you through the sample at [Office Add-in ASP.NET SSO](https://github.com/OfficeDev/PnP-OfficeAddins/tree/main/Samples/auth/Office-Add-in-ASPNET-SSO) .
- Create an Node.js Office Add-in that uses single sign-on which walks you through the sample at [Office Add-in NodeJS SSO](https://github.com/OfficeDev/PnP-OfficeAddins/tree/main/Samples/auth/Office-Add-in-NodeJS-SSO) .

# **Non-SSO scenarios**

In some scenarios, you may not want to use SSO. For example, you may need to authenticate using a different identity provider than the Microsoft identity platform. Also, SSO isn't supported in all scenarios. For example, older versions of Office don't support SSO. In this case, you'd need to fall back to an alternate authentication system for your add-in.

### **Authenticate with the Microsoft identity platform**

Your add-in can sign in users using the [Microsoft identity platform](https://learn.microsoft.com/en-us/azure/active-directory/develop) as the authentication provider. Once you've signed in the user, you can then use the Microsoft identity platform to authorize the add-in to [Microsoft Graph](https://learn.microsoft.com/en-us/graph) or other services managed by Microsoft. Use this approach as an alternate sign-in method when SSO through Office is unavailable. Also, there are scenarios in which you want to have your users sign in to your add-in separately even when SSO is available; for example, if you want them to have the option of signing in to the add-in with a different ID from the one with which they're currently signed in to Office.

It's important to note that the Microsoft identity platform doesn't allow its sign-in page to open in an iframe. When an Office Add-in is running in *Office on the web*, the task


pane is an iframe. This means that you'll need to open the sign-in page by using a dialog box opened with the Office dialog API. This affects how you use authentication helper libraries. For more information, see Authentication with the Office dialog API.

For information about implementing authentication with the Microsoft identity platform, see [Microsoft identity platform (v2.0) overview.](https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-overview) The documentation contains many tutorials and guides, as well as links to relevant samples and libraries. As explained in Authentication with the Office dialog API, you may need to adjust the code in the samples to run in the Office dialog box.

### **Access to Microsoft Graph without SSO**

You can get authorization to Microsoft Graph data for your add-in by obtaining an access token to Microsoft Graph from the Microsoft identity platform. You can do this without relying on SSO through Office (or if SSO failed or isn't supported). For more information, see Access to Microsoft Graph without SSO which has more details and links to samples.

### **Access to non-Microsoft data sources**

Popular online services, including Google, Facebook, LinkedIn, SalesForce, and GitHub, let developers give users access to their accounts in other applications. This gives you the ability to include these services in your Office Add-in. For an overview of the ways that your add-in can do this, see Authorize external services in your Office Add-in.

#### ) **Important**

Before you begin coding, find out if the data source allows its sign-in page to open in an iframe. When an Office Add-in is running in *Office on the web*, the task pane is an iframe. If the data source doesn't allow its sign-in page to open in an iframe, then you'll need to open the sign-in page in a dialog box opened with the Office dialog API. For more information, see **Authentication with the Office dialog API**.

### **See also**

- [Microsoft identity platform documentation](https://learn.microsoft.com/en-us/azure/active-directory/develop/)
- [Microsoft identity platform access tokens](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens)
- [OAuth 2.0 and OpenID Connect protocols on the Microsoft identity platform](https://learn.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-protocols)
- [Microsoft identity platform and OAuth 2.0 On-Behalf-Of flow](https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow)
- [JSON web token (JWT)](https://en.wikipedia.org/wiki/JSON_Web_Token)


- [JSON web token viewer](https://jwt.ms/)

# **Office Add-ins platform overview**

Article • 02/19/2025

You can use the Office Add-ins platform to build solutions that extend Office applications and interact with content in Office documents. With Office Add-ins, you can use familiar web technologies such as HTML, CSS, and JavaScript to extend and interact with Outlook, Excel, Word, PowerPoint, OneNote, and Project. Your solution can run in Office across multiple platforms, including Windows, Mac, iPad, and in a browser.

Office Add-ins can do almost anything a webpage can do inside a browser. Use the Office Add-ins platform to:

- **Add new functionality to Office clients** Bring external data into Office, automate Office documents, expose functionality from Microsoft and others in Office clients, and more. For example, use Microsoft Graph API to connect to data that drives productivity.
- **Create new rich, interactive objects that can be embedded in Office documents** Embed maps, charts, and interactive visualizations that users can add to their own Excel spreadsheets and PowerPoint presentations.

### **How are Office Add-ins different from COM and VSTO add-ins?**

COM and VSTO add-ins are earlier Office integration solutions that run only in Office on Windows. Unlike COM and VSTO add-ins, Office Add-ins are web add-ins: the application (for example, Excel), reads the add-in manifest and connects the add-in's custom ribbon buttons and menu commands in the UI. When needed, it loads the add


in's JavaScript and HTML code, which runs in the context of a browser or webview control in a sandbox.

Office Add-ins provide the following advantages over add-ins built using VBA, COM, or VSTO.

- Cross-platform support: Office Add-ins run in Office on the web, Windows, Mac, and iPad.
- Centralized deployment and distribution: Admins can deploy Office Add-ins centrally across an organization.
- Easy access via AppSource: You can make your solution available to a broad audience by submitting it to AppSource.
- Based on standard web technology: You can use any library you like to build Office Add-ins.


#### ) **Important**

COM and VSTO add-ins aren't supported in the **[new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** . These add-ins are still supported in the classic Outlook on Windows desktop client. To learn more, see **Develop Outlook add-ins for new Outlook on Windows**.

#### **Components of an Office Add-in**

An Office Add-in includes two basic components: a manifest file and your own web application. The manifest defines various settings, including how your add-in integrates with Office clients. Your web application needs to be hosted on a web server, or web hosting service, such as Microsoft Azure.

#### **Manifest**

The manifest specifies settings and capabilities of the add-in, such as:

- The add-in's display name, description, ID, version, and default locale.
- How the add-in integrates with Office.
- The permission level and data access requirements for the add-in.

#### **Web app**

The most basic Office Add-in consists of a static HTML page that is displayed inside an Office application, but that doesn't interact with either the Office document or any other Internet resource. However, to create an experience that interacts with Office documents 


or allows the user to interact with online resources from an Office client application, you can use any technologies, both client and server side, that your hosting provider supports (such as ASP.NET, PHP, or Node.js). To interact with Office clients and documents, you use the Office.js JavaScript APIs.

## **Extending and interacting with Office clients**

Office Add-ins can do the following within an Office client application.

- Extend functionality (any Office application)
- Create new objects (Excel or PowerPoint)

#### **Extend Office functionality**

You can add new functionality to Office applications via the following:


- Custom ribbon buttons and menu commands (collectively called "add-in commands").
- Insertable task panes.

Custom UI and task panes are specified in the add-in manifest.

#### **Custom buttons and menu commands**

You can add custom ribbon buttons and menu items to the ribbon in Office on the web and on Windows. This makes it easy for users to access your add-in directly from their Office application. Custom buttons and menu items can launch different actions such as showing a task pane with custom HTML or executing a JavaScript function.

#### **Task panes**

You can use task panes in addition to add-in commands to enable users to interact with your solution. Clients that don't support add-in commands (Office on iPad) run your add-in as a task pane. In Excel, Word, and PowerPoint, users launch task pane add-ins via the **Home** > **Add-ins** button. In Outlook, users launch task pane add-ins via the addin button or via the **All Apps** button on the ribbon.


#### **Extend Outlook functionality**

Users can run Outlook add-ins when they view, reply, or create emails, meeting requests, meeting responses, meeting cancellations, or appointments. Outlook add-ins can do the following:

- Extend the Office app ribbon.
- Display contextually next to an Outlook item when you're viewing or composing it.
- Perform a task when a specific event occurs, such as when a user creates a new message.

#### 7 **Note**

Add-ins that interact with the user's calendar, meetings, or appointments are available only if the user opens the calendar in Outlook, not Teams.

For an overview of Outlook add-ins, see Outlook add-ins overview.

#### **Create new objects in Office documents**


You can embed web-based objects called content add-ins within Excel and PowerPoint documents. With content add-ins, you can integrate rich, web-based data visualizations, media (such as a YouTube video player or a picture gallery), and other external content.

### **Office JavaScript APIs**

The Office JavaScript APIs contain objects and members for building add-ins and interacting with Office content and web services. There's a common object model that's shared by Excel, Outlook, Word, PowerPoint, OneNote, and Project. There are also more extensive application-specific object models for Excel, OneNote, PowerPoint, and Word. These APIs provide access to well-known objects such as paragraphs and workbooks, which makes it easier to create an add-in for a specific application.

## **Code samples**

Learn how to build the simplest Office Add-in with only a manifest, HTML web page, and a logo. The following samples will help you get started in the Office application you're interested in.

- [Excel "Hello world" add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/hello-world/excel-hello-world)
- [Outlook "Hello world" add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/hello-world/outlook-hello-world)


- [PowerPoint "Hello world" add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/hello-world/powerpoint-hello-world)
- [Word "Hello world" add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/hello-world/word-hello-world)

#### **Next steps**

For a more detailed introduction to developing Office Add-ins, see Develop Office Addins.

#### **See also**

- Core concepts for Office Add-ins
- Develop Office Add-ins
- Design Office Add-ins
- Test and debug Office Add-ins
- Publish Office Add-ins
- [Learn about the Microsoft 365 Developer Program](https://aka.ms/m365devprogram)


# **Beginner's guide**

06/27/2025

Want to get started building your own cross-platform Office extensions? The following steps show you what to read first, what tools to install, and recommended tutorials to complete.

#### 7 **Note**

If you're experienced in creating VSTO add-ins for Office, we recommend that you immediately turn to **VSTO add-in developer's guide**, which is a superset of the information in this article.

## **Step 0: Prerequisites**

- Office Add-ins are essentially web applications embedded in Office. So, you should first have a basic understanding of web applications and how they are hosted on the web. There's an enormous amount of information about this on the Internet, in books, and in online courses. A good way to start if you have no prior knowledge of web applications at all is to search for "What is a web app?" on Bing.
- The primary programming language you'll use in creating Office Add-ins is JavaScript or TypeScript. You can think of TypeScript as a strongly-typed version of JavaScript. If you are not familiar with either of these languages, but you have experience with VBA, VB.Net, C#, you'll probably find TypeScript easier to learn. Again, there's a wealth of information about these languages on the Internet, in books, and in online courses.

## **Step 1: Begin with fundamentals**

We know you're eager to start coding, but there are some things about Office Add-ins that you should read before you open your IDE or code editor.

- Office Add-ins platform overview: Find out what Office Web Add-ins are and how they differ from older ways of extending Office, such as VSTO add-ins.
- Develop Office Add-ins: Get an overview of Office Add-in development and lifecycle including tooling, creating an add-in UI, and using the JavaScript APIs to interact with the Office document.
- ["Hello world" samples](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/hello-world) : Learn how to build the simplest Office Add-in with only a manifest, HTML web page, and a logo. These samples will help you understand the fundamental parts of an Office Add-in.


There are a lot of links in those articles, but if you're a beginner with Office Add-ins, we recommend that you come back here when you've read them and continue with the next section.

## **Step 2: Explore and try out existing samples**

You've got the big picture now, so dive in by installing our Script Lab add-in to try out code samples in the various Office applications. The samples available in Script Lab show how to use many of the Office JavaScript APIs.

### **Step 3: Install tools and create your first add-in**

Next, create an add-in using one of our quick starts. For the purpose of learning the platform, we recommend the Excel quick start.

## **Step 4: Code**

You can't learn to drive by reading the owner's manual, so start coding with this Excel tutorial. You'll be using the Office JavaScript library and some JSON or XML in the add-in's manifest. There's no need to memorize anything, because you'll be getting more background about both in a later steps.

### **Step 5: Understand the JavaScript library**

For an overview of the Office JavaScript library, see Develop Office Add-ins.

Then return to Script Lab and use it like a playground: make your own code changes to the local copy of any samples you try and see how the results are affected.

### **Step 6: Understand the manifest**

Get an understanding of the purposes of the add-in manifest and an introduction to its XML markup or JSON in Office Add-ins manifest.

### **Step 7: Create a Partner Center account**

If you plan to publish your add-in to AppSource, create a [Partner Center account](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/open-a-developer-account). This could take some time. Get this process going as soon as possible to avoid release delays.


### **Next Steps**

Congratulations on finishing the beginner's learning path for Office Add-ins! Here are some suggestions for further exploration of our documentation:

- Tutorials or quick starts for other Office applications:
	- OneNote quick start
	- [Outlook tutorial](https://learn.microsoft.com/en-us/outlook/add-ins/addin-tutorial)
	- PowerPoint tutorial
	- Project quick start
	- Word tutorial
- Scenarios and other code samples:
	- Excel: Create a spreadsheet from your web page and embed your add-in
	- [Outlook: Report spam or phishing emails](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/outlook-spam-reporting)
	- Word: Import a document template
	- Word: Manage citations
	- Office Add-in code samples
- Other important subjects:
	- Develop Office Add-ins
	- Best practices for developing Office Add-ins
	- Design Office Add-ins
	- Test and debug Office Add-ins
	- Deploy and publish Office Add-ins
	- Resources
	- [Learn about the Microsoft 365 Developer Program](https://aka.ms/m365devprogram)


# **Set up your development environment**

Article • 05/19/2025

This guide helps you set up tools so you can create Office Add-ins by following our quick starts or tutorials. If you already have these installed, you're ready to begin a quick start, such as this Excel React quick start.

#### **Get Microsoft 365**

You need a Microsoft 365 account. You might qualify for a Microsoft 365 E5 developer subscription, which includes all Office apps, through the [Microsoft 365 Developer Program](https://aka.ms/m365devprogram) ; for details, see the [FAQ](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-). Alternatively, you can [sign up for a 1-month free trial](https://www.microsoft.com/microsoft-365/try) or [purchase a](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g) [Microsoft 365 plan](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g) .

#### **Install the environment**

There are three kinds of development environments to choose from. The scaffolding of Office Add-in projects that is created in the three environments is different, so if multiple people will be working on an add-in project, they must all use the same environment.

- **Node.js environment**: Recommended. In this environment, your tools are installed and run at a command line. The server-side of the web application part of the add-in is written in JavaScript or TypeScript and is hosted in a Node.js runtime. There are many helpful add-in development tools in this environment, such as an Office linter and a bundler/task-runner called webpack. The project creation and scaffolding tool is a command line tool called the Office Yeoman Generator (also called "Yo Office"), though you can still use the Visual Studio Code extensions mentioned in the next option.
- **Visual Studio Code**: Choose this environment if you use Visual Studio Code and would prefer to create projects from extensions rather than command line tools. The project creation and scaffolding tools are Microsoft 365 Agents Toolkit or Office Add-ins Development Kit extensions.
- **Visual Studio environment**: Choose this environment only if your development computer is Windows, and you want to develop the server-side of the add-in with a .NET based language and framework, such as ASP.NET. The add-in project templates in Visual Studio aren't updated as frequently as those in the Node.js environment. More information later on the **Visual Studio environment** tab.


Visual Studio for Mac doesn't include the project scaffolding templates for Office Add-ins, so if your development computer is a Mac, you should work with the Node.js environment.

Select the tab for the environment you choose.

Node.js environment

The main tools to be installed are:

- Node.js
- npm
- A code editor of your choice
- Office Yeoman Generator (Yo Office)
- The Office JavaScript linter

This guide assumes that you know how to use a command-line tool.

#### **Install Node.js and npm**

Node.js is a JavaScript runtime you use to develop modern Office Add-ins.

Install Node.js by [downloading the latest recommended version from their website](https://nodejs.org/) . Follow the installation instructions for your operating system.

npm is an open source software registry from which to download the packages used in developing Office Add-ins. It's usually installed automatically when you install Node.js. To check if you already have npm installed and see the installed version, run the following in the command line.

```
command line
```
npm -v

If, for any reason, you want to install it manually, run the following in the command line.

command line

npm install npm -g

**Tip**


You may wish to use a Node version manager to allow you to switch between multiple versions of Node.js and npm, but this isn't strictly necessary. For details on how to do this, **[see npm's instructions](https://docs.npmjs.com/downloading-and-installing-node-js-and-npm)** .

#### **Install a code editor**

You can use any code editor or IDE that supports client-side development to build your web part, such as:

- [Visual Studio Code](https://code.visualstudio.com/) (recommended)
- [Atom](https://atom.io/)
- [Webstorm](https://www.jetbrains.com/webstorm)

#### **Install the Yeoman generator — Yo Office**

The project creation and scaffolding tool is Yeoman generator for Office Add-ins, affectionately known as **Yo Office**. You need to install the latest version of [Yeoman](https://github.com/yeoman/yo) and Yo Office. To install these tools globally, run the following command via the command prompt.

command line

```
npm install -g yo generator-office
```
#### **Install and use the Office JavaScript linter**

Microsoft provides a JavaScript linter to help you catch common errors when using the Office JavaScript library. If you create an add-in project with either the Yeoman generator for Office Add-ins or Agents Toolkit, then the linter is installed and configured for you. Skip to Run the linter.

If you created your project manually, install and configure the linter with the following steps.

- 1. In the root of the project, run the following two commands (after you've installed Node.js and npm).
command line

```
npm install office-addin-lint --save-dev
npm install eslint-plugin-office-addins --save-dev
```


- 2. In the root of the project, create a text file named **eslint.config.js** (or **.mjs**), if there isn't one already there. Be sure to inherit the recommended configuration for eslint-plugin-office-addins . The plugins object should include a mapping to the eslint-plugin-office-addins plugin object. The following is a simple example that includes settings for TypeScript. Your **eslint.config.js** file may have additional properties and configurations.

```
JavaScript
 const officeAddins = require("eslint-plugin-office-addins");
 const tsParser = require("@typescript-eslint/parser");
 const tsEsLint = require("typescript-eslint");
 export default [
 ...tsEsLint.configs.recommended,
 ...officeAddins.configs.recommended,
 {
 plugins: {
 "office-addins": officeAddins,
 },
 languageOptions: {
 parser: tsParser,
 },
 },
 ];
```
- 3. In the root of the project, open the **package.json** file and be sure that the scripts array has the following member.
JSON "lint": "office-addin-lint check",

#### **Run the linter**

Run the linter with the following command either in the terminal of an editor, such as Visual Studio Code, or in a command prompt. Problems found by the linter appear in the terminal or prompt, and also appear directly in the code when you're using an editor that supports linter messages, such as Visual Studio Code.

```
command line
npm run lint
```


## **Install Script Lab**

Script Lab is a tool for quickly prototyping code that calls the Office JavaScript Library APIs. Script Lab is itself an Office Add-in and can be installed from AppSource at [Script Lab](https://appsource.microsoft.com/marketplace/apps?search=script%20lab&page=1) . There's a version for Excel, PowerPoint, and Word, and a separate version for Outlook. For information about how to use Script Lab, see Explore Office JavaScript API using Script Lab.

#### **Next steps**

Try creating your own add-in or use Script Lab to try built-in samples.

#### **Create an Office Add-in**

You can quickly create a basic add-in for Excel, OneNote, Outlook, PowerPoint, Project, or Word by completing a 5-minute quick start. If you've previously completed a quick start and want to create a slightly more complex add-in, you should try a tutorial.

#### **Explore the APIs with Script Lab**

Explore the library of built-in samples in Script Lab to get a sense for the capabilities of the Office JavaScript APIs.

## **See also**

- Core concepts for Office Add-ins
- Developing Office Add-ins
- Design Office Add-ins
- Test and debug Office Add-ins
- Publish Office Add-ins
- [Learn about the Microsoft 365 Developer Program](https://aka.ms/m365devprogram)


# **Build an Excel task pane add-in**

05/07/2025

In this article, you'll walk through the process of building an Excel task pane add-in. You'll use either the Office Add-ins Development Kit or the Yeoman generator to create your Office Addin. Select the tab for the one you'd like to use and then follow the instructions to create your add-in and test it locally. If you'd like to create the add-in project within Visual Studio Code, we recommend the Office Add-ins Development Kit.

Office Add-ins Development Kit

### **Prerequisites**

- Download and install [Visual Studio Code](https://code.visualstudio.com/) .
- Node.js (the latest LTS version). Visit the [Node.js site](https://nodejs.org/)  to download and install the right version for your operating system. To verify if you've already installed these tools, run the commands node -v and npm -v in your terminal.
- Office connected to a Microsoft 365 subscription. You might qualify for a Microsoft 365 E5 developer subscription through the [Microsoft 365 Developer Program](https://developer.microsoft.com/microsoft-365/dev-program), see [FAQ](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-) for details. Alternatively, you can [sign up for a 1-month free trial](https://www.microsoft.com/microsoft-365/try?rtc=1) or [purchase a](https://www.microsoft.com/microsoft-365/buy/compare-all-microsoft-365-products) [Microsoft 365 plan](https://www.microsoft.com/microsoft-365/buy/compare-all-microsoft-365-products) .

## **Create the add-in project**

Click the following button to create an add-in project using the Office Add-ins Development Kit for Visual Studio Code. You'll be prompted to install the extension if don't already have it. A page that contains the project description will open in Visual Studio Code.

#### **[Create an add-in in Visual Studio Code](vscode://msoffice.microsoft-office-add-in-debugger/open-specific-sample?sample-id=excel-get-started-with-dev-kit)**

In the prompted page, select **Create** to create the add-in project. In the **Workspace folder** dialog that opens, select the folder where you want to create the project.


The Office Add-ins Development Kit will create the project. It will then open the project in a *second* Visual Studio Code window. Close the original Visual Studio Code window.

#### 7 **Note**

If you use VSCode Insiders, or you have problems opening the project page in VSCode, install the extension manually by following **[these steps](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/development-kit-overview?tabs=vscode)**, and find the sample in the sample gallery.

#### **Explore the project**

The add-in project that you've created with the Office Add-ins Development Kit contains sample code for a basic task pane add-in. If you'd like to explore the components of your add-in project, open the project in your code editor and review the files listed below. When you're ready to try out your add-in, proceed to the next section.

- 1. The **./manifest.xml** or **./manifest.json** file in the root directory of the project defines the settings and capabilities of the add-in.
- 2. The **./src/taskpane/taskpane.html** file contains the HTML markup for the task pane.


- 3. The **./src/taskpane/taskpane.css** file contains the CSS that's applied to content in the task pane.
- 4. The **./src/taskpane/taskpane.js** file contains the Office JavaScript API code that facilitates interaction between the task pane and the Office client application.

# **Try it out**

- 1. Open the extension by selecting the Office Add-ins Development Kit icon in the **Activity Bar**.
- 2. Select **Preview Your Office Add-in (F5)**
- 3. In the Quick Pick menu, select the option **{Office Application} Desktop (Edge Chromium)**, where '{Office Application}' is the appropriate application, such as "Excel" or "Word". This will launch the add-in and debug the code.

The development kit checks that the prerequisites are met before debugging starts. Check the terminal for detailed information if there are issues with your environment. After this process, the Office desktop application launches and sideloads the add-in. Please note that the first time you run a project, it may make take a few minutes to install the dependencies. You'll need to install the certificate when prompted.

## **Stop testing your Office Add-in**

Once you are finished testing and debugging the add-in, *always* close the add-in by following these steps. (Closing the Office application or web server window doesn't reliably deregister the add-in.)

- 1. Open the extension by selecting the Office Add-ins Development Kit icon in the **Activity Bar**.
- 2. Select **Stop Previewing Your Office Add-in**. This closes the web server and removes the add-in from the registry and cache.
- 3. Close the Office application window.

# **Troubleshooting**

If you have problems running the add-in, take these steps.

- Close any open instances of Office.
- Close the previous web server started for the add-in with the **Stop Previewing Your Office Add-in** Office Add-ins Development Kit extension option.


The article Troubleshoot development errors with Office Add-ins contains solutions to common problems. If you're still having issues, [create a GitHub issue](https://aka.ms/officedevkitnewissue) and we'll help you.

For information on running the add-in on Office on the web, see Sideload Office Add-ins to Office on the web.

For information on debugging on older versions of Office, see Debug add-ins using developer tools in Microsoft Edge Legacy.

#### **Next steps**

Congratulations, you've successfully created an Excel task pane add-in! Next, learn more about the capabilities of an Excel add-in and build a more complex add-in by following along with the Excel add-in tutorial.

#### **Code samples**

- [Excel "Hello world" add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/hello-world/excel-hello-world) : Learn how to build a simple Office Add-in with only a manifest, HTML web page, and a logo.
### **See also**

- Office Add-ins platform overview
- Develop Office Add-ins
- Excel JavaScript object model in Office Add-ins
- [Excel add-in code samples](https://developer.microsoft.com/microsoft-365/gallery/?filterBy=Excel,Samples)
- Excel JavaScript API reference
- Using Visual Studio Code to publish

# **Enable single sign-on (SSO) in an Office Add-in**

Article • 05/21/2024

Users sign in to Office using either their personal Microsoft account or their Microsoft 365 Education or work account. Take advantage of this and use single sign-on (SSO) to authenticate and authorize the user to your add-in without requiring them to sign in a second time.

## **How SSO works at runtime**

The following diagram shows how the SSO process works. The blue elements represent Office or the Microsoft identity platform. The gray elements represent the code you write and include the client-side code (task pane) and the server-side code for your addin.


- 1. In the add-in, your JavaScript code calls the Office.js API [getAccessToken](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.auth#office-runtime-officeruntime-auth-getaccesstoken-member(1)). If the user is already signed in to Office, the Office host will return the access token with the claims of the signed in user.
- 2. If the user is not signed in, the Office host application opens a dialog box for the user to sign in. Office redirects to the Microsoft identity platform to complete the sign-in process.
- 3. If this is the first time the current user has used your add-in, they are prompted to consent.
- 4. The Office host application requests the **access token** from the Microsoft identity platform for the current user.
- 5. The Microsoft identity platform returns the access token to Office. Office will cache the token on your behalf so that future calls to **getAccessToken** simply return the cached token.
- 6. The Office host application returns the **access token** to the add-in as part of the result object returned by the getAccessToken call.
- 7. The token is both an **access token** and an **identity token**. You can use it as an identity token to parse and examine claims about the user, such as the user's name and email address.
- 8. Optionally, the add-in can use the token as an **access token** to make authenticated HTTPS requests to APIs on the server-side. Because the access token contains


identity claims, the server can store information associated with the user's identity; such as the user's preferences.

## **Requirements and Best Practices**

### **Don't cache the access token**

Never cache or store the access token in your client-side code. Always call [getAccessToken](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.auth#office-runtime-officeruntime-auth-getaccesstoken-member(1)) when you need an access token. Office will cache the access token (or request a new one if it expired.) This will help to avoid accidentally leaking the token from your add-in.

### **Enable modern authentication for Outlook**

If you're working with an Outlook add-in, be sure to enable Modern Authentication for the Microsoft 365 tenancy. For information about how to do this, see [Enable or disable](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online) [modern authentication for Outlook in Exchange Online.](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online)

### **Implement a fallback authentication system**

You should *not* rely on SSO as your add-in's only method of authentication. You should implement an alternate authentication system that your add-in can fall back to in certain error situations. For example, if your add-in is loaded on an older version of Office that does not support SSO, the getAccessToken call will fail.

For Excel, Word, and PowerPoint add-ins you will typically want to fall back to using the Microsoft identity platform. For more information, see Authenticate with the Microsoft identity platform.

For Outlook add-ins, there is a recommended fallback system. For more information, see Scenario: Implement single sign-on to your service in an Outlook add-in.

You can also use a system of user tables and authentication, or you can leverage one of the social login providers. For more information about how to do this with an Office Add-in, see Authorize external services in your Office Add-in.

For code samples that use the Microsoft identity platform as the fallback system, see [Office Add-in NodeJS SSO](https://github.com/OfficeDev/PnP-OfficeAddins/tree/main/Samples/auth/Office-Add-in-NodeJS-SSO) and [Office Add-in ASP.NET SSO](https://github.com/OfficeDev/PnP-OfficeAddins/tree/main/Samples/auth/Office-Add-in-ASPNET-SSO) .

## **Develop an SSO add-in**


This section describes the tasks involved in creating an Office Add-in that uses SSO. These tasks are described here independently of language or framework. For step-bystep instructions, see:

- Create a Node.js Office Add-in that uses single sign-on
- Create an ASP.NET Office Add-in that uses single sign-on

### **Register your add-in with the Microsoft identity platform**

To work with SSO you need to register your add-in with the Microsoft identity platform. This will enable the Microsoft identity platform to provide authentication and authorization services for your add-in. Creating the app registration includes the following tasks.

- Get an application (client) ID to identify your add-in to the Microsoft identity platform.
- Generate a client secret to act as a password for your add-in when requesting a token.
- Specify the permissions that your add-in requires. The Microsoft Graph "profile" and "openid" permissions are always required. You may need additional permissions depending on what your add-in needs to do.
- Grant the Office applications trust to the add-in.
- Pre-authorize the Office applications to the add-in with the default scope *access_as_user*.

For more details about this process, see Register an Office Add-in that uses SSO with the Microsoft identity platform.

### **Configure the add-in**

Your manifest must provide Office with certain information about how the add-in is registered in Microsoft Entra ID. The configuration depends on which type of manifest the add-in uses.

#### Unified manifest

There should be a "webApplicationInfo" property in the root of the manifest. It has a required child "id" property which must be set to the application ID (a GUID) of the add-in in the Microsoft identity platform. For SSO, it must also have a child "resource" property that is set to the URI of the add-in. This is the same **Application ID URI** (including the api: protocol) that you set when you registered the add-in


with the Microsoft identity platform. The URI must end with the client ID specified in the "webApplicationInfo.id" property. The following is an example:

```
JSON
```

```
"webApplicationInfo": {
    "id": "a661fed9-f33d-4e95-b6cf-624a34a2f51d",
    "resource": "api://addin.contoso.com/a661fed9-f33d-4e95-b6cf-
624a34a2f51d"
},
```
### 7 **Note**

Experienced add-in developers should note that, there is no unified manifest property corresponding to the **<Scopes>** element in the add-in only manifest. Microsoft Graph and other API permissions are requested at runtime in your code.

### **Include the Identity API requirement set**

To use SSO your add-in requires the Identity API 1.3 requirement set. For more information, see [IdentityAPI](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/identity-api-requirement-sets).

## **Add client-side code**

Add JavaScript to the add-in to:

- Call [getAccessToken](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.auth#office-runtime-officeruntime-auth-getaccesstoken-member(1)).
- Parse the access token or pass it to the add-in's server-side code.

The following code shows a simple example of calling getAccessToken and parsing the token for the user name and other credentials.

### 7 **Note**

This example handles only one kind of error explicitly. For examples of more elaborate error handling, see **[Office Add-in NodeJS SSO](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-NodeJS-SSO)** and **[Office Add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-ASPNET-SSO) [ASP.NET SSO](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-ASPNET-SSO)** .


```
async function getUserData() {
 try {
 let userTokenEncoded = await OfficeRuntime.auth.getAccessToken();
 let userToken = jwt_decode(userTokenEncoded); // Using the
https://www.npmjs.com/package/jwt-decode library.
 console.log(userToken.name); // user name
 console.log(userToken.preferred_username); // email
 console.log(userToken.oid); // user id 
 }
 catch (exception) {
 if (exception.code === 13003) {
 // SSO is not supported for domain user accounts, only
 // Microsoft 365 Education or work account, or a Microsoft
account.
 } else {
 // Handle error
 }
 }
}
```
### **When to call getAccessToken**

If your add-in requires a signed in user, then you should call getAccessToken from inside Office.initialize . You should also pass allowSignInPrompt: true in the options parameter of getAccessToken . For example; OfficeRuntime.auth.getAccessToken( { allowSignInPrompt: true }); This will ensure that if the user is not yet signed in, that Office prompts the user through the UI to sign in now.

If the add-in has some functionality that doesn't require a signed in user, then you can call getAccessToken *when the user takes an action that requires a signed in user*. There is no significant performance degradation with redundant calls of getAccessToken because Office caches the access token and will reuse it, until it expires, without making another call to the [Microsoft identity platform](https://learn.microsoft.com/en-us/azure/active-directory/develop/) whenever getAccessToken is called. So you can add calls of getAccessToken to all functions and handlers that initiate an action where the token is needed.

#### ) **Important**

As a best security practice, always call getAccessToken when you need an access token. Office will cache it for you. Don't cache or store the access token using your own code.

### **Pass the access token to server-side code**


If you need to access web APIs on your server, or additional services such as Microsoft Graph, you'll need to pass the access token to your server-side code. The access token provides access (for the authenticated user) to your web APIs. Also the server-side code can parse the token for identity information if it needs it. (See **Use the access token as an identity token** below.) There are many libraries available for different languages and platforms that can help simplify the code you write. For more information, see [Overview](https://learn.microsoft.com/en-us/azure/active-directory/develop/msal-overview) [of the Microsoft Authentication Library (MSAL)](https://learn.microsoft.com/en-us/azure/active-directory/develop/msal-overview).

If you need to access Microsoft Graph data, your server-side code should do the following:

- Validate the access token (see **Validate the access token** below).
- Initiate the [OAuth 2.0 On-Behalf-Of flow](https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow) with a call to the Microsoft identity platform that includes the access token, some metadata about the user, and the credentials of the add-in (its ID and secret). The Microsoft identity platform will return a new access token that can be used to access Microsoft Graph.
- Get data from Microsoft Graph by using the new token.
- If you need to cache the new access token for multiple calls, we recommend using [Token cache serialization in MSAL.NET.](https://learn.microsoft.com/en-us/azure/active-directory/develop/msal-net-token-cache-serialization?tabs=aspnet)

#### ) **Important**

As a best security practice, always use the server-side code to make Microsoft Graph calls, or other calls that require passing an access token. Never return the OBO token to the client to enable the client to make direct calls to Microsoft Graph. This helps protect the token from being intercepted or leaked. For more information on the proper protocol flow, see the **[OAuth 2.0 protocol diagram](https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow#protocol-diagram)**

The following code shows an example of passing the access token to the server-side. The token is passed in an Authorization header when sending a request to a server-side web API. This example sends JSON data, so it uses the POST method, but GET is sufficient to send the access token when you are not writing to the server.

```
JavaScript
```

```
$.ajax({
 type: "POST",
 url: "/api/DoSomething",
 headers: {
 "Authorization": "Bearer " + accessToken
 },
 data: { /* some JSON payload */ },
 contentType: "application/json; charset=utf-8"
}).done(function (data) {
```


```
 // Handle success
}).fail(function (error) {
 // Handle error
}).always(function () {
 // Cleanup
});
```
For more details about getting authorized access to the user's Microsoft Graph data, see Authorize to Microsoft Graph in your Office Add-in.

#### **Validate the access token**

Web APIs on your server must validate the access token if it is sent from the client. The token is a JSON Web Token (JWT), which means that validation works just like token validation in most standard OAuth flows. There are a number of libraries available that can handle JWT validation, but the basics include:

- Checking that the token is well-formed
- Checking that the token was issued by the intended authority
- Checking that the token is targeted to the Web API

Keep in mind the following guidelines when validating the token.

- Valid SSO tokens will be issued by the Azure authority, https://login.microsoftonline.com . The iss claim in the token should start with this value.
- The token's aud parameter will be set to the application ID of the add-in's Azure app registration.
- The token's scp parameter will be set to access_as_user .

For more information on token validation, see [Microsoft identity platform access tokens.](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens#validating-tokens)

### **Use the access token as an identity token**

If your add-in needs to verify the user's identity, the access token returned from getAccessToken() contains information that can be used to establish the identity. The following claims in the token relate to identity.

- name The user's display name.
- preferred_username The user's email address.
- oid A GUID representing the ID of the user in the Microsoft identity system.
- tid A GUID representing the tenant tha the user is signing in to.


For more details on these and other claims, see [Microsoft identity platform ID tokens.](https://learn.microsoft.com/en-us/azure/active-directory/develop/id-tokens) If you need to construct a unique ID to represent the user in your system, refer to [Using](https://learn.microsoft.com/en-us/azure/active-directory/develop/id-tokens#using-claims-to-reliably-identify-a-user-subject-and-object-id) [claims to reliably identify a user](https://learn.microsoft.com/en-us/azure/active-directory/develop/id-tokens#using-claims-to-reliably-identify-a-user-subject-and-object-id) for more information.

### **Example access token**

The following is a typical decoded payload of an access token. For information about the properties, see [Microsoft identity platform access tokens](https://learn.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-tokens).

```
JavaScript
{
 aud: "2c3caa80-93f9-425e-8b85-0745f50c0d24",
 iss: "https://login.microsoftonline.com/fec4f964-8bc9-4fac-b972-
1c1da35adbcd/v2.0",
 iat: 1521143967,
 nbf: 1521143967,
 exp: 1521147867,
 aio: 
"ATQAy/8GAAAA0agfnU4DTJUlEqGLisMtBk5q6z+6DB+sgiRjB/Ni73q83y0B86yBHU/WFJnlMQJ
8",
 azp: "e4590ed6-62b3-5102-beff-bad2292ab01c",
 azpacr: "0",
 e_exp: 262800,
 name: "Mila Nikolova",
 oid: "6467882c-fdfd-4354-a1ed-4e13f064be25",
 preferred_username: "milan@contoso.com",
 scp: "access_as_user",
 sub: "XkjgWjdmaZ-_xDmhgN1BMP2vL2YOfeVxfPT_o8GRWaw",
 tid: "fec4f964-8bc9-4fac-b972-1c1da35adbcd",
 uti: "MICAQyhrH02ov54bCtIDAA",
 ver: "2.0"
}
```
## **Using SSO with an Outlook add-in**

There are some small, but important differences in using SSO in an Outlook add-in from using it in an Excel, PowerPoint, or Word add-in. Be sure to read Authenticate a user with a single sign-on token in an Outlook add-in and Scenario: Implement single sign-on to your service in an Outlook add-in.

## **Google Chrome 3rd party cookie support**

Google Chrome is phasing out 3rd party cookies in 2024 and introducing a feature named Tracking Prevention. If Tracking Prevention is enabled in the Chrome browser, 


your add-in will not be able to use any 3rd party cookies. Your add-in may encounter issues when authenticating the user, such as multiple sign-on requests, or errors.

For improved authentication experiences, see [Using device state for an improved SSO](https://devblogs.microsoft.com/identity/managed-devices-for-blocked-third-party-cookies/) [experience on browsers with blocked third-party cookies](https://devblogs.microsoft.com/identity/managed-devices-for-blocked-third-party-cookies/) .

For more information about the Google Chrome rollout, see the following resources:

- [The next step toward phasing out third-party cookies in Chrome](https://blog.google/products/chrome/privacy-sandbox-tracking-protection/) .
- [The Privacy Sandbox Timeline for the Web](https://privacysandbox.com/open-web/#the-privacy-sandbox-timeline)

## **See also**

- [Microsoft identity platform documentation](https://learn.microsoft.com/en-us/azure/active-directory/develop/)
- Requirement sets
- [IdentityAPI](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/identity-api-requirement-sets)

### 6 **Collaborate with us on GitHub**

The source for this content can be found on GitHub, where you can also create and review issues and pull requests. For more information, see [our](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md) [contributor guide](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md).

### **Office Add-ins feedback**

Office Add-ins is an open source project. Select a link to provide feedback:

- [Open a documentation issue](https://github.com/OfficeDev/office-js-docs-pr/issues/new?template=3-customer-feedback.yml&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Foffice%2Fdev%2Fadd-ins%2Fdevelop%2Fsso-in-office-add-ins%3Ftabs%3Djsonmanifest&pageQueryParams=%3Ftabs%3Djsonmanifest&contentSourceUrl=https%3A%2F%2Fgithub.com%2FOfficeDev%2Foffice-js-docs-pr%2Fblob%2Fmain%2Fdocs%2Fdevelop%2Fsso-in-office-add-ins.md&documentVersionIndependentId=abda21d9-6e80-8319-c56f-004658014e3c&feedback=%0A%0A%5BEnter+feedback+here%5D%0A&author=%40o365devx&metadata=*+ID%3A+cb06c24b-9d11-9cc5-2e98-561601452638+%0A*+Service%3A+**microsoft-365**%0A*+Sub-service%3A+**add-ins**)
- [Provide product feedback](https://aka.ms/office-addins-dev-questions)


# **Single sign-on (SSO) quick start**

Article • 05/16/2025

In this article, you'll use the Yeoman generator for Office Add-ins to create an Office Add-in for Excel, Outlook, Word, or PowerPoint that uses single sign-on (SSO).

#### 7 **Note**

The SSO template provided by the Yeoman generator for Office Add-ins only runs on localhost and cannot be deployed. If you're building a new Office Add-in with SSO for production purposes, follow the instructions in **Create a Node.js Office Add-in that uses single sign-on**.

### **Prerequisites**

- [Node.js](https://nodejs.org/) (the latest [LTS](https://nodejs.org/en/about/previous-releases) version).
- The latest version of [Yeoman](https://github.com/yeoman/yo) and the Yeoman generator for Office Add-ins. To install these tools globally, run the following command via the command prompt.

command line

npm install -g yo generator-office

#### 7 **Note**

Even if you've previously installed the Yeoman generator, we recommend you update your package to the latest version from npm.

- If you're using a Mac and don't have the Azure CLI installed on your machine, you must install [Homebrew](https://brew.sh/) . The SSO configuration script that you'll run during this quick start will use Homebrew to install the Azure CLI, and will then use the Azure CLI to configure SSO within Azure.
## **Create the add-in project**


The Yeoman generator can create an SSO-enabled Office Add-in for Excel, Outlook, Word, or PowerPoint with script type of JavaScript or TypeScript. The following instructions specify JavaScript and Excel , but you should choose the script type and Office client application that best suits your scenario.

Run the following command to create an add-in project using the Yeoman generator. A folder that contains the project will be added to the current directory.

command line

yo office

7 **Note**

When you run the yo office command, you may receive prompts about the data collection policies of Yeoman and the Office Add-in CLI tools. Use the information that's provided to respond to the prompts as you see fit.

When prompted, provide the following information to create your add-in project.

- **Choose a project type:** Office Add-in Task Pane project supporting single sign-on (localhost)
- **Choose a script type:** JavaScript
- **What do you want to name your add-in?** My Office Add-in
- **Which Office client application would you like to support?** Choose Excel , Outlook , Word , or Powerpoint .

After you complete the wizard, the generator creates the project and installs supporting Node components.


## **Explore the project**

The add-in project that you've created with the Yeoman generator contains code for an SSOenabled task pane add-in.

### **Configuration**

The following files specify configuration settings for the add-in.

- The **./manifest.xml** or **manifest.json** file in the root directory of the project defines the settings and capabilities of the add-in.
- The **./.ENV** file in the root directory of the project defines constants that are used by the add-in project.

### **Task pane**

The following files define the add-in's task pane UI and functionality.

- The **./src/taskpane/taskpane.html** file contains the HTML markup for the task pane.
- The **./src/taskpane/taskpane.css** file contains the CSS that's applied to content in the task pane.
- The **./src/taskpane/taskpane.js** file contains code to initialize the add-in and also code that uses the Office JavaScript API library to add the data from Microsoft Graph to the Office document.

### **Authentication**

The following files facilitate the SSO process and write data to the Office document.

- In a JavaScript project, the **./src/helpers/documentHelper.js** file contains code that encapsulates the user's profile information for insertion into the current Office document. There's no such file in a TypeScript project. Instead, the code that gathers the profile information is inline in the **./src/taskpane/taskpane.ts** file.
- The **./src/helpers/fallbackauthdialog.html** file is the UI-less page that loads the JavaScript for the fallback authentication strategy. The <script> tag to load the JavaScript is inserted into the file when Webpack.config.js runs.
- The **./src/helpers/fallbackauthdialog.js** file contains the JavaScript for the fallback authentication strategy that signs in the user with msal.js.


- The **./src/helpers/message-helper.js** file contains JavaScript that shows or hides error messages to the user.
- The **./src/helpers/middle-tier-calls.js** file contains the JavaScript that calls your web API for fetching data.
- The **./src/helpers/sso-helper.js** file contains the JavaScript call to the SSO API, getAccessToken , receives the access token, and includes it in a call to Microsoft Graph for the data. In the event of an error or in scenarios when SSO authentication isn't supported, it invokes the fallback strategy.

## **Configure SSO**

Now that your add-in project is created and contains the code that's necessary to facilitate the SSO process, complete the following steps to configure SSO for your add-in.

- 1. Go to the root folder of the project.
command line cd "My Office Add-in"

- 2. Run the following command to configure SSO for the add-in.
npm run configure-sso

#### 2 **Warning**

This command will fail if your tenant is configured to require two-factor authentication. In this scenario, you'll need to manually complete the Azure app registration and SSO configuration steps by following all the steps in the **Create a Node.js Office Add-in that uses single sign-on** tutorial.

- 3. A web browser window will open and prompt you to sign in to Azure. Sign in to Azure using your Microsoft 365 administrator credentials. These credentials will be used to register a new application in Azure and configure the settings required by SSO.
7 **Note**


If you sign in to Azure using non-administrator credentials during this step, the configure-sso script won't be able to provide administrator consent for the add-in to users within your organization. SSO will therefore not be available to users of the add-in and they'll be prompted to sign-in.

- 4. After you enter your credentials, close the browser window and return to the command prompt. As the SSO configuration process continues, you'll see status messages being written to the console. As described in the console messages, files within the add-in project that the Yeoman generator created are automatically updated with data that's required by the SSO process.
## **Test your add-in**

If you've created an Excel, Word, or PowerPoint add-in, complete the steps in the following section to try it. If you've created an Outlook add-in, complete the steps in the Outlook section instead.

### **Excel, Word, and PowerPoint**

Complete the following steps to test an Excel, Word, or PowerPoint add-in.

- 1. When the SSO configuration process completes, run the following command to build the project, start the local web server, and sideload your add-in in the previously selected Office client application.
#### 7 **Note**

- Office Add-ins should use HTTPS, not HTTP, even while you're developing. If you're prompted to install a certificate after you run one of the following commands, accept the prompt to install the certificate that the Yeoman generator provides. You may also have to run your command prompt or terminal as an administrator for the changes to be made.
- If this is your first time developing an Office Add-in on your machine, you may be prompted in the command line to grant Microsoft Edge WebView a loopback exemption ("Allow localhost loopback for Microsoft Edge WebView?"). When prompted, enter Y to allow the exemption. Note that you'll need administrator privileges to allow the exemption. Once allowed, you shouldn't be prompted for an exemption when you sideload Office Add-ins in


the future (unless you remove the exemption from your machine). To learn more, see **["We can't open this add-in from localhost" when loading an Office](https://learn.microsoft.com/en-us/office/troubleshoot/office-suite-issues/cannot-open-add-in-from-localhost) [Add-in or using Fiddler](https://learn.microsoft.com/en-us/office/troubleshoot/office-suite-issues/cannot-open-add-in-from-localhost)**.

- When you first use Yeoman generator to develop an Office Add-in, your default browser opens a window where you'll be prompted to sign in to your Microsoft 365 account. If a sign-in window doesn't appear and you encounter a sideloading or login timeout error, run atk auth login m365 .
command line

npm start

- 2. When Excel, Word, or PowerPoint opens when you run the previous command, make sure you're signed in with a user account that's a member of the same Microsoft 365 organization as the Microsoft 365 administrator account that you used to connect to Azure while configuring SSO in step 3 of the previous section. Doing so establishes the appropriate conditions for SSO to succeed.
- 3. In the Office client application, choose the **Home** tab, and then choose **Show Taskpane** to open the add-in task pane.


| AutoSave ( off                | le                   |                      | >                               |                    |          |                                              | excel add-in 65304515-b3f5-4abf-940c-6c40 |                 |                   | B              |                                            | D      | ×   |
|-------------------------------|----------------------|----------------------|---------------------------------|--------------------|----------|----------------------------------------------|-------------------------------------------|-----------------|-------------------|----------------|--------------------------------------------|--------|-----|
| File                          | Home<br>Insert       | Draw                 | Page Layout                     |                    | Formulas | Data                                         | Review<br>View                            | Help            | Team              | Script Lab     | ાજુ                                        | L      | (5) |
| 98<br>B ×<br>V<br>Clipboard   | A<br>Font<br>><br>17 | ==<br>Alignment<br>4 | V<br>Protect<br>><br>Protection | 6/2<br>Number<br>> |          | Format as Table ~<br>Cell Styles v<br>Styles | Conditional Formatting ×                  | 工<br>Cells<br>V | Q<br>Editing<br>> | ldeas<br>Ideas | Logo<br>Show<br>Taskpane<br>Commands Group |        | A   |
| A1                            | レ                    | X                    | fx                              |                    |          |                                              |                                           |                 |                   |                |                                            |        | V   |
| A<br>1<br>2<br>3<br>4<br>5    | B                    | C                    | D                               |                    | E        | F                                            | G                                         | H               |                   |                |                                            | K      | A   |
| ნ<br>7<br>8<br>9<br>10<br>স্থ | Sheet1               | (+)                  |                                 |                    |          |                                              | a a c<br>4                                |                 |                   |                |                                            | ▶      | P   |
| Co Accessibility: Good to go  |                      |                      |                                 |                    |          |                                              |                                           |                 | E<br>m            |                |                                            | + 100% |     |

- 4. At the bottom of the task pane, choose the **Get My User Profile Information** button to initiate the SSO process.
- 5. If a dialog window appears to request permissions on behalf of the add-in, this means that SSO is not supported for your scenario and the add-in has instead fallen back to an alternate method of user authentication. This may occur when the tenant administrator hasn't granted consent for the add-in to access Microsoft Graph, or when the user isn't signed in to Office with a valid Microsoft account or Microsoft 365 Education or Work account. Choose **Accept** to continue.


| My SSO Office Add-in - https://localhost:3000/fallbackauthdialog.html                                                                                                                                                                                                                                      |  |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| Microsoft                                                                                                                                                                                                                                                                                                  |  |
| toby.miller@contoso.com                                                                                                                                                                                                                                                                                    |  |
| Permissions requested                                                                                                                                                                                                                                                                                      |  |
| My SSO Office Add-in<br>unverified                                                                                                                                                                                                                                                                         |  |
| This application is not published by Microsoft or your<br>organization.                                                                                                                                                                                                                                    |  |
| This app would like to:                                                                                                                                                                                                                                                                                    |  |
| Sign you in and read your profile<br>>                                                                                                                                                                                                                                                                     |  |
| Maintain access to data you have given it access to<br>>                                                                                                                                                                                                                                                   |  |
| Accepting these permissions means that you allow this app to use your<br>data as specified in their terms of service and privacy statement. The<br>publisher has not provided links to their terms for you to review. You<br>can change these permissions at https://myapps.microsoft.com. Show<br>details |  |
| Cancel<br>Accept                                                                                                                                                                                                                                                                                           |  |
|                                                                                                                                                                                                                                                                                                            |  |

After a user accepts this permissions request, they won't be prompted again in the future.

- 6. The add-in retrieves profile information for the signed-in user and writes it to the document. The following image shows an example of profile information written to an Excel worksheet.


|   | A | B                       |
|---|---|-------------------------|
| 1 |   |                         |
| 2 |   |                         |
| 3 |   |                         |
| 4 |   |                         |
| 5 |   | Toby Miller             |
| б |   | toby.miller@contoso.com |
| 7 |   |                         |
| 8 |   |                         |
| 9 |   |                         |

- 7. When you want to stop the local web server and uninstall the add-in, follow the applicable instructions:
	- To stop the server, run the following command. If you used npm start , the following command also uninstalls the add-in.

| command line |  |  |  |  |  |  |
|--------------|--|--|--|--|--|--|
| npm stop     |  |  |  |  |  |  |

- If you manually sideloaded the add-in, see Remove a sideloaded add-in.
### **Outlook**

Complete the following steps to try out an Outlook add-in.

- 1. When the SSO configuration process completes, run the following command to build the project and start the local web server.
#### 7 **Note**

- Office Add-ins should use HTTPS, not HTTP, even while you're developing. If you're prompted to install a certificate after you run one of the following commands, accept the prompt to install the certificate that the Yeoman generator provides. You may also have to run your command prompt or terminal as an administrator for the changes to be made.
- If this is your first time developing an Office Add-in on your machine, you may be prompted in the command line to grant Microsoft Edge WebView a loopback exemption ("Allow localhost loopback for Microsoft Edge


WebView?"). When prompted, enter Y to allow the exemption. Note that you'll need administrator privileges to allow the exemption. Once allowed, you shouldn't be prompted for an exemption when you sideload Office Add-ins in the future (unless you remove the exemption from your machine). To learn more, see **["We can't open this add-in from localhost" when loading an Office](https://learn.microsoft.com/en-us/office/troubleshoot/office-suite-issues/cannot-open-add-in-from-localhost) [Add-in or using Fiddler](https://learn.microsoft.com/en-us/office/troubleshoot/office-suite-issues/cannot-open-add-in-from-localhost)**.

- When you first use Yeoman generator to develop an Office Add-in, your default browser opens a window where you'll be prompted to sign in to your Microsoft 365 account. If a sign-in window doesn't appear and you encounter a sideloading or login timeout error, run atk auth login m365 .
command line

npm start

- 2. Outlook will start and sideload the add-in. Make sure that you're signed in to Outlook with a user that's a member of the same Microsoft 365 organization as the Microsoft 365 administrator account that you used to connect to Azure while configuring SSO in step 3 of the previous section. Doing so establishes the appropriate conditions for SSO to succeed.
- 3. In Outlook, compose a new message.
- 4. In the message compose window, choose the **Show Taskpane** button to open the add-in task pane.


|      | 目やひ↑↓↓↓・・                                                             | Untitled - Message (HTML)        |                     |                | 图<br>X<br>-        |
|------|-----------------------------------------------------------------------|----------------------------------|---------------------|----------------|--------------------|
| File | Help<br>Message<br>Insert<br>Draw<br>Options<br>Format Text<br>Review | ‍റ്റ Tell me what you want to do |                     |                |                    |
| 品、必  | 11 × × B I リ ೭ × Δ × ミ × ミ × 雪 × 雪 × 雪<br>Calibri (Body)              |                                  | 0 ~ Zr ! ↓ ↓ 門 ~ 匿~ | 。<br>ଥିବା ବିଧା | Show Taskpane<br>V |
| D    | To                                                                    |                                  |                     |                |                    |
| Send | Cc                                                                    |                                  |                     |                |                    |
|      | Bcc                                                                   |                                  |                     |                |                    |
|      | Subject                                                               |                                  |                     |                |                    |
|      |                                                                       |                                  |                     |                |                    |
|      |                                                                       |                                  |                     |                |                    |
|      |                                                                       |                                  |                     |                |                    |
|      |                                                                       |                                  |                     |                |                    |
|      |                                                                       |                                  |                     |                |                    |
| ব    |                                                                       |                                  |                     |                | ▲                  |

- 5. At the bottom of the task pane, choose the **Get My User Profile Information** button to initiate the SSO process.
- 6. If a dialog window appears to request permissions on behalf of the add-in, this means that SSO is not supported for your scenario and the add-in has instead fallen back to an alternate method of user authentication. This may occur when the tenant administrator hasn't granted consent for the add-in to access Microsoft Graph, or when the user isn't signed in to Office with a valid Microsoft account or Microsoft 365 Education or Work account. Choose **Accept** to continue.


After a user accepts this permissions request, they won't be prompted again in the future.

- 7. The add-in retrieves profile information for the signed-in user and writes it to the body of the email message.

| 5 Ca 1 1 8 × =<br>ர                 |                   |      |         |   |             |   |        |        |         |
|-------------------------------------|-------------------|------|---------|---|-------------|---|--------|--------|---------|
| File                                | Message<br>Insert | Draw | Options |   | Format Text |   | Review | Help   | TE<br>C |
| 28                                  | Calibri (Body)    | >    | 11<br>> | B | I           | U | 0 -    | A<br>> | =       |
| D                                   | To                |      |         |   |             |   |        |        |         |
| Send                                | Cc                |      |         |   |             |   |        |        |         |
|                                     | Bcc               |      |         |   |             |   |        |        |         |
|                                     | Subject           |      |         |   |             |   |        |        |         |
| Toby Miller toby.miller@contoso.com |                   |      |         |   |             |   |        |        |         |

- 8. When you want to stop the local web server and uninstall the add-in, follow the applicable instructions:
	- To stop the server, run the following command. If you used npm start , the following command should also uninstall the add-in.

- If you manually sideloaded the add-in, see Remove a sideloaded add-in.
## **Next steps**

Congratulations, you've successfully created a task pane add-in that uses SSO when possible, and uses an alternate method of user authentication when SSO is not supported. To learn


about customizing your add-in to add new functionality that requires different permissions, see [Customize your Node.js SSO-enabled add-in.](https://learn.microsoft.com/en-us/office/dev/add-ins/quickstarts/sso-quickstart-customize)

## **Troubleshooting**

- Ensure your environment is ready for Office development by following the instructions in Set up your development environment.
- Some of the sample code uses ES6 JavaScript. This isn't compatible with older versions of Office that use the Trident (Internet Explorer 11) browser engine. For information on how to support those platforms in your add-in, see Support older Microsoft webviews and Office versions. If you don't already have a Microsoft 365 subscription to use for development, you might qualify for a Microsoft 365 E5 developer subscription through the [Microsoft 365 Developer Program](https://aka.ms/m365devprogram) ; for details, see the [FAQ.](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-) Alternatively, you can [sign up for a 1-month free trial](https://www.microsoft.com/microsoft-365/try) or [purchase a Microsoft 365 plan](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g) .
- The automatic npm install step Yo Office performs may fail. If you see errors when trying to run npm start , navigate to the newly created project folder in a command prompt and manually run npm install . For more information about Yo Office, see Create Office Addin projects using the Yeoman Generator.

### **See also**

- Enable single sign-on for Office Add-ins
- [Customize your Node.js SSO-enabled add-in](https://learn.microsoft.com/en-us/office/dev/add-ins/quickstarts/sso-quickstart-customize)
- Create a Node.js Office Add-in that uses single sign-on
- Troubleshoot error messages for single sign-on (SSO)
- Using Visual Studio Code to publish


# **Register an Office Add-in that uses single sign-on (SSO) with the Microsoft identity platform**

Article • 11/13/2023

This article explains how to register an Office Add-in with the Microsoft identity platform so that you can use SSO. Register the add-in when you begin developing it so that when you progress to testing or production, you can change the existing registration or create separate registrations for development, testing, and production versions of the add-in.

The following table itemizes the information that you need to carry out this procedure and the corresponding placeholders that appear in the instructions.

| Information                                                                                                                                                                                                                                                                                                                                                                          | Examples                                 | Placeholder                                        |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|----------------------------------------------------|
| A human readable name for the add-in. (Uniqueness<br>recommended, but not required.)                                                                                                                                                                                                                                                                                                 | Contoso Marketing<br>Excel Add-in (Prod) | <add-in-name></add-in-name>                        |
| An application ID which Azure generates for you as part<br>of the registration process.                                                                                                                                                                                                                                                                                              | c6c1f32b-5e55-4997-<br>881a-753cc1d563b7 | <app-id></app-id>                                  |
| The fully qualified domain name (except for protocol) of<br>the add-in. You must use a domain that you own. For<br>this reason, you cannot use certain well-known domains<br>such as azurewebsites.net or cloudapp.net<br>. The<br>domain must be the same, including any subdomains,<br>as is used in the URLs in the <resources> section of<br/>the add-in's manifest.</resources> | localhost:6789 ,<br>addins.contoso.com   | <fully<br>qualified<br/>domain-name&gt;</fully<br> |
| The permissions to the Microsoft identity platform and<br>Microsoft Graph that your add-in needs. (<br>profile is<br>always required.)                                                                                                                                                                                                                                               | profile ,<br>Files.Read.All              | N/A                                                |

#### U **Caution**

**Sensitive information**: The application ID URI ( <fully-qualified-domain-name> ) is logged as part of the authentication process when an add-in using SSO is activated in Office running inside of Microsoft Teams. The URI mustn't contain sensitive information.


## **Register the add-in with Microsoft identity platform**

You need to create an app registration in Azure that represents your web server. This enables authentication support so that proper access tokens can be issued to the client code in JavaScript. This registration supports both SSO in the client, and fallback authentication using the Microsoft Authentication Library (MSAL).

- 1. Sign in to the [Azure portal](https://portal.azure.com/) with the *admin* credentials to your Microsoft 365 tenancy. For example, **MyName@contoso.onmicrosoft.com**.
- 2. Select **App registrations**. If you don't see the icon, search for "app registration" in the search bar.

The **App registrations** page appears.

- 3. Select **New registration**.


| ==<br>Microsoft Azure                                                                  | Search resources, services, and docs (G+/)                                                                                                                                                                                                                                                                                                                  |  |
|----------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| Home >                                                                                 |                                                                                                                                                                                                                                                                                                                                                             |  |
| App registrations<br>2                                                                 |                                                                                                                                                                                                                                                                                                                                                             |  |
| New registration<br>G<br>Authentication Library (MSAL) and Microsoft Graph. Learn more | Endpoints 29 Troubleshooting () Refresh<br>& Preview features<br>& Got feedback?<br>Starting June 30th, 2020 we will no longer add any netive Directory Authentication Library (ADAL) and Azure AD Graph. We will continue<br>to provide technical support and security updates but we will no longer provide feature will need to be upgraded to Microsoft |  |
| All applications<br>Owned applications                                                 | Deleted applications                                                                                                                                                                                                                                                                                                                                        |  |
| Start typing a display name or application (client) ID to filter these r               | Add filters                                                                                                                                                                                                                                                                                                                                                 |  |

The **Register an application** page appears.

- 4. On the **Register an application** page, set the values as follows.
	- Set **Name** to <add-in-name> .
	- Set **Supported account types** to **Accounts in any organizational directory (any Azure AD directory - multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)**.
	- Set **Redirect URI** to use the platform **Single-page application (SPA)** and the URI to https://<fully-qualified-domain-name>/dialog.html .


| ==<br>Microsoft Azure                                                          | Search resources, services, and docs (G+/)                                                                                            |   |
|--------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------|---|
| Home > App registrations >                                                     |                                                                                                                                       |   |
| Register an application                                                        |                                                                                                                                       | × |
|                                                                                |                                                                                                                                       |   |
| * Name                                                                         |                                                                                                                                       |   |
| The user-facing display name for this application (this can be changed later). |                                                                                                                                       |   |
| contoso-office-add-in-sso                                                      |                                                                                                                                       |   |
|                                                                                |                                                                                                                                       |   |
| Supported account types                                                        |                                                                                                                                       |   |
| Who can use this application or access this API?                               |                                                                                                                                       |   |
|                                                                                | Accounts in this organizational directory only (Contoso only - Single tenant)                                                         |   |
|                                                                                | Accounts in any orqanizational directory (Any Azure AD directory - Multitenant)                                                       |   |
|                                                                                | Accounts in any organizational directory (Any Azure AD directory - Multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)    |   |
| Personal Microsoft accounts only                                               |                                                                                                                                       |   |
| Help me choose                                                                 |                                                                                                                                       |   |
|                                                                                |                                                                                                                                       |   |
| Redirect URI (optional)                                                        |                                                                                                                                       |   |
|                                                                                | We'll return the authentication response to this URI after successfully authenticating this now is optional and it can be             |   |
| changed later, but a value is required for most authentication scenarios.      |                                                                                                                                       |   |
| Single-page application (SPA)                                                  | https://localhost:44355/dialog.html                                                                                                   |   |
|                                                                                |                                                                                                                                       |   |
|                                                                                |                                                                                                                                       |   |
|                                                                                |                                                                                                                                       |   |
|                                                                                |                                                                                                                                       |   |
|                                                                                |                                                                                                                                       |   |
|                                                                                |                                                                                                                                       |   |
|                                                                                | Register an app you're working on here. Integrate gallery apps from outside your organization by adding from Enterprise applications. |   |
|                                                                                |                                                                                                                                       |   |
| By proceeding, you agree to the Microsoft Platform Policies ra                 |                                                                                                                                       |   |
| Register                                                                       |                                                                                                                                       |   |

- 5. Select **Register**. A message is displayed stating that the application registration was created.
- 6. Copy and save the values for the **Application (client) ID** and the **Directory (tenant) ID**. You'll use both of them in later procedures.


## **Add a client secret**

Sometimes called an *application password*, a client secret is a string value your app can use in place of a certificate to identity itself.

- 1. From the left pane, select **Certificates & secrets**. Then on the **Client secrets** tab, select **New client secret**.

| =<br>Microsoft Azure                                                                                       |    | Search resources, services, and docs (G+/)                |                    |                                                                                                                                           |           | >- | 13 |  | 803 | 2         | ್ನಿ | NestorW@M365x63284<br>CONTOSO (M365X63284053.ON.                                                                                         |   |
|------------------------------------------------------------------------------------------------------------|----|-----------------------------------------------------------|--------------------|-------------------------------------------------------------------------------------------------------------------------------------------|-----------|----|----|--|-----|-----------|-----|------------------------------------------------------------------------------------------------------------------------------------------|---|
| Home > App registrations > contoso-office-add-in-sso<br>contoso-office-add-in-sso   Certificates & secrets |    |                                                           |                    |                                                                                                                                           |           |    |    |  |     |           |     |                                                                                                                                          |   |
|                                                                                                            |    |                                                           |                    | 2                                                                                                                                         |           |    |    |  |     |           |     |                                                                                                                                          | × |
| Search                                                                                                     | << | & Got feedback?                                           |                    |                                                                                                                                           |           |    |    |  |     |           |     |                                                                                                                                          |   |
| Overview<br>13                                                                                             |    |                                                           |                    | scheme). For a higher level of assurance, we recommend using a certificate (instead of a client secret) as a credential.                  |           |    |    |  |     |           |     | Credentials enable confidential applications to identication service when receiving tokens at a web addressable location (using an HTTPS |   |
| Quickstart<br>ની કે<br>Integration assistant                                                               |    |                                                           |                    |                                                                                                                                           |           |    |    |  |     |           |     |                                                                                                                                          |   |
| Manaqe                                                                                                     |    |                                                           |                    | Application registration certificates, secrets and federated credentials can be found in the tabs below.                                  |           |    |    |  |     |           |     |                                                                                                                                          | × |
| Branding & properties<br>মিনিট                                                                             |    | Certificates (0)                                          | Client secrets (0) | Federated credentials (0)                                                                                                                 |           |    |    |  |     |           |     |                                                                                                                                          |   |
| P<br>Authentication<br>Certificates & secrets                                                              |    |                                                           |                    | A secret string that the application uses to prove its identity when requesting a token. Also can be referred to as application password. |           |    |    |  |     |           |     |                                                                                                                                          |   |
| Token configuration                                                                                        |    | - New client secret                                       |                    |                                                                                                                                           |           |    |    |  |     |           |     |                                                                                                                                          |   |
| API permissions<br>や                                                                                       |    | Description                                               |                    | Expires                                                                                                                                   | Value (1) |    |    |  |     | Secret ID |     |                                                                                                                                          |   |
| Expose an API<br>্ব<br>的<br>App roles                                                                      |    | No client secrets have been created for this application. |                    |                                                                                                                                           |           |    |    |  |     |           |     |                                                                                                                                          |   |
| Owners<br>13                                                                                               |    |                                                           |                    |                                                                                                                                           |           |    |    |  |     |           |     |                                                                                                                                          |   |
| Roles and administrators<br>8                                                                              |    |                                                           |                    |                                                                                                                                           |           |    |    |  |     |           |     |                                                                                                                                          |   |
| o   Manifest                                                                                               |    |                                                           |                    |                                                                                                                                           |           |    |    |  |     |           |     |                                                                                                                                          |   |
| Support + Troubleshooting                                                                                  |    |                                                           |                    |                                                                                                                                           |           |    |    |  |     |           |     |                                                                                                                                          |   |
| 19<br>Troubleshooting                                                                                      |    |                                                           |                    |                                                                                                                                           |           |    |    |  |     |           |     |                                                                                                                                          |   |
| 0<br>New support request                                                                                   |    |                                                           |                    |                                                                                                                                           |           |    |    |  |     |           |     |                                                                                                                                          |   |

The **Add a client secret** pane appears.

- 2. Add a description for your client secret.
- 3. Select an expiration for the secret or specify a custom lifetime.
	- Client secret lifetime is limited to two years (24 months) or less. You can't specify a custom lifetime longer than 24 months.


- Microsoft recommends that you set an expiration value of less than 12 months.

| Add a client secret |                       | X |
|---------------------|-----------------------|---|
| Description         | Contoso app secret    |   |
| Expires             | Recommended: 6 months |   |

- 4. Select **Add**. The new secret is created and the value is temporarily displayed.
#### ) **Important**

*Record the secret's value* for use in your client application code. This secret value is *never displayed again* after you leave this pane.

### **Expose a web API**

- 1. From the left pane, select **Expose an API**.
The **Expose an API** pane appears.

| =<br>Microsoft Azure                                 | NestorW@M365x63284<br>>--<br>2<br>Search resources, services, and docs (G+/)<br>803<br>ar<br>CONTOSO (M365X63284053.ON.)                                                                                              |  |  |  |  |  |  |
|------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|--|--|--|--|
| Home > App registrations > contoso-office-add-in-sso |                                                                                                                                                                                                                       |  |  |  |  |  |  |
|                                                      | contoso-office-add-in-sso   Expose an API<br>2<br>×                                                                                                                                                                   |  |  |  |  |  |  |
| Search<br><<                                         | & Got feedback?                                                                                                                                                                                                       |  |  |  |  |  |  |
| 器<br>Overview<br>& Quickstart                        | Application ID URI ① Set                                                                                                                                                                                              |  |  |  |  |  |  |
| Integration assistant                                | Scopes defined by this API                                                                                                                                                                                            |  |  |  |  |  |  |
| Manage                                               | Define custom scopes to restrict access to data and functionality protected by the API. An application that requires access to parts of this<br>API can request that a user or admin consent to one or more of these. |  |  |  |  |  |  |
| Branding & properties<br>lg<br>ନ<br>Authentication   | Adding a scope here creates only delegated permissions of you are looking to create application-only scopes, assignable to<br>application type. Go to App roles.                                                      |  |  |  |  |  |  |
| Certificates & secrets                               | —  Add a scope                                                                                                                                                                                                        |  |  |  |  |  |  |
| Token confiquration                                  | Admin consent displa<br>Scopes<br>Who can consent<br>User consent display<br>State                                                                                                                                    |  |  |  |  |  |  |
| API permissions                                      | No scopes have been defined                                                                                                                                                                                           |  |  |  |  |  |  |
| Expose an API                                        |                                                                                                                                                                                                                       |  |  |  |  |  |  |
| App roles                                            | Authorized client applications                                                                                                                                                                                        |  |  |  |  |  |  |
| Owners                                               | Authorizing a client application indicates that this API trusts the application and users should not be client calls                                                                                                  |  |  |  |  |  |  |
| Roles and administrators<br>f                        | this API.                                                                                                                                                                                                             |  |  |  |  |  |  |
| 0 Manifest                                           |                                                                                                                                                                                                                       |  |  |  |  |  |  |
| Support + Troubleshooting                            | Add a client application                                                                                                                                                                                              |  |  |  |  |  |  |
| Troubleshooting                                      | Client Id<br>Scopes                                                                                                                                                                                                   |  |  |  |  |  |  |
| 0<br>New support request                             | No client applications have been authorized                                                                                                                                                                           |  |  |  |  |  |  |

- 2. Select **Set** to generate an application ID URI.


| ==<br>Microsoft Azure                                | Search resources, services, and docs (G+/)                                                                                                                                                                            | >_                   |  |                      | NestorW@M365x63284<br>CONTOSO (M365X63284053.ON |
|------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------|--|----------------------|-------------------------------------------------|
| Home > App registrations > contoso-office-add-in-sso |                                                                                                                                                                                                                       |                      |  |                      |                                                 |
|                                                      | contoso-office-add-in-sso   Expose an API<br>な                                                                                                                                                                        |                      |  |                      | ×                                               |
| Search<br><<                                         | ్యా<br>Got feedback?                                                                                                                                                                                                  |                      |  |                      |                                                 |
| 瑪 Overview<br>& Quickstart                           | Application ID URI (1)<br>Set                                                                                                                                                                                         |                      |  |                      |                                                 |
| Integration assistant<br>ని                          | Scopes defined by this API                                                                                                                                                                                            |                      |  |                      |                                                 |
| Manage                                               | Define custom scopes to restrict access to data and functionality protected by the API. An application that requires access to parts of this<br>API can request that a user or admin consent to one or more of these. |                      |  |                      |                                                 |
| Branding & properties                                | Adding a scope here creates only delegated permissions if you are looking to create application-only scopes, use 'app roles assignable to                                                                             |                      |  |                      |                                                 |
| ନି<br>Authentication                                 | application type. Go to App roles.                                                                                                                                                                                    |                      |  |                      |                                                 |
| Certificates & secrets                               | - Add a scope                                                                                                                                                                                                         |                      |  |                      |                                                 |
| 1<br>Token confiquration                             | Scopes<br>Who can consent                                                                                                                                                                                             | Admin consent displa |  | User consent display | State                                           |
| API permissions<br>φ                                 | No scopes have been defined                                                                                                                                                                                           |                      |  |                      |                                                 |
| Expose an API                                        |                                                                                                                                                                                                                       |                      |  |                      |                                                 |
| App roles                                            | Authorized client applications                                                                                                                                                                                        |                      |  |                      |                                                 |
| Owners                                               | Authorizing a client application indicates that this API trusts the application and users should not be client calls                                                                                                  |                      |  |                      |                                                 |
| Roles and administrators                             | this API.                                                                                                                                                                                                             |                      |  |                      |                                                 |
| 0 Manifest                                           |                                                                                                                                                                                                                       |                      |  |                      |                                                 |
| Support + Troubleshooting                            | ー Add a client application                                                                                                                                                                                            |                      |  |                      |                                                 |
| ্<br>Troubleshooting                                 | Client Id<br>Scopes                                                                                                                                                                                                   |                      |  |                      |                                                 |
| ਿੰ<br>New support request                            | No client applications have been authorized                                                                                                                                                                           |                      |  |                      |                                                 |

The section for setting the application ID URI appears with a generated Application ID URI in the form api://<app-id> .

- 3. Update the application ID URI to api://<fully-qualified-domain-name>/<app-id> .

| Edit the App ID URI                                        |
|------------------------------------------------------------|
| Application ID URI                                         |
| api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69 |
| Save<br>Discard                                            |

- The **Application ID URI** is pre-filled with app ID (GUID) in the format api://<app-id> .
- The application ID URI format should be: api://<fully-qualified-domainname>/<app-id>
- Insert the fully-qualified-domain-name between api:// and <app-id> (which is a GUID). For example, api://contoso.com/<app-id> .
- If you're using localhost, then the format should be api://localhost: <port>/<app-id> . For example, api://localhost:3000/c6c1f32b-5e55-4997- 881a-753cc1d563b7 .

[For additional application ID URI details, see Application manifest identifierUris](https://learn.microsoft.com/en-us/azure/active-directory/develop/reference-app-manifest#identifieruris-attribute) attribute.

7 **Note**


If you get an error saying that the domain is already owned but you own it, follow the procedure at **Quickstart: Add a custom domain name to Azure Active Directory** [to register it, and then repeat this step. (This error can also](https://learn.microsoft.com/en-us/azure/active-directory/add-custom-domain) occur if you are not signed in with credentials of an admin in the Microsoft 365 tenancy. See step 2. Sign out and sign in again with admin credentials and repeat the process from step 3.)

### **Add a scope**

- 1. On the **Expose an API** page, select **Add a scope**.

| Microsoft Azure<br>=                                 | Search resources, services, and docs (G+/)                                                                                                                                      | >---                 |  |  | 50 | 2 | ਕੇ                   | NestorW@M365x63284<br>CONTOSO (M365X63284053.ON, |   |
|------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------|--|--|----|---|----------------------|--------------------------------------------------|---|
| Home > App registrations > contoso-office-add-in-sso |                                                                                                                                                                                 |                      |  |  |    |   |                      |                                                  |   |
|                                                      | contoso-office-add-in-sso   Expose an API<br>20                                                                                                                                 |                      |  |  |    |   |                      |                                                  | × |
| P Search<br><<<br>Overview                           | Got feedback?                                                                                                                                                                   |                      |  |  |    |   |                      |                                                  |   |
| Quickstart                                           | api://localhost:3000/cfe719d7-aef3-4108-83a8-a8283f139a69<br>Application ID URI                                                                                                 |                      |  |  |    |   |                      | 0 0 0                                            |   |
| Integration assistant<br>Manage                      | Scopes defined by this API<br>Define custom scopes to restrict access to data and functionality protected by the API. An application that requires access to parts of this      |                      |  |  |    |   |                      |                                                  |   |
| Branding & properties<br>15                          | API can request that a user or admin consent to one or more of these.                                                                                                           |                      |  |  |    |   |                      |                                                  |   |
| କ୍ଷ<br>Authentication                                | Adding a scope here creates only delegated permissions of you are looking to create application-only scopes, use "App roles assignable to<br>application type. Go to App roles. |                      |  |  |    |   |                      |                                                  |   |
| Certificates & secrets                               |                                                                                                                                                                                 |                      |  |  |    |   |                      |                                                  |   |
| Token confiquration                                  | Add a scope                                                                                                                                                                     |                      |  |  |    |   |                      |                                                  |   |
| API permissions<br>φ                                 | Who can consent<br>Scopes                                                                                                                                                       | Admin consent displa |  |  |    |   | User consent display | State                                            |   |
| Expose an API<br>8                                   | No scopes have been defined                                                                                                                                                     |                      |  |  |    |   |                      |                                                  |   |
| App roles                                            |                                                                                                                                                                                 |                      |  |  |    |   |                      |                                                  |   |
| a Owners                                             | Authorized client applications                                                                                                                                                  |                      |  |  |    |   |                      |                                                  |   |
| Roles and administrators<br>100                      | Authorizing a client application indicates that this API trusts the application and users should not be client calls<br>this API.                                               |                      |  |  |    |   |                      |                                                  |   |
| n   Manifest                                         |                                                                                                                                                                                 |                      |  |  |    |   |                      |                                                  |   |
| Support + Troubleshooting                            | Add a client application<br>-                                                                                                                                                   |                      |  |  |    |   |                      |                                                  |   |
| Troubleshooting                                      | Client Id                                                                                                                                                                       | Scopes               |  |  |    |   |                      |                                                  |   |
| New support request                                  | No client applications have been authorized                                                                                                                                     |                      |  |  |    |   |                      |                                                  |   |

The **Add a scope** pane opens.

- 2. In the **Add a scope** pane, specify the scope's attributes. The following table shows example values for and Outlook add-in requiring the profile , openid ,
Files.ReadWrite , and Mail.Read permissions. Modify the text to match the permissions your add-in needs.

| Field              | Description                                                                                       | Values                                                                             |
|--------------------|---------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------|
| Scope name         | The name of your scope. A common<br>scope naming convention is<br>resource.operation.constraint . | For SSO this must be set to<br>access_as_user .                                    |
| Who can<br>consent | Determines if admin consent is required<br>or if users can consent without an admin<br>approval.  | For learning SSO and samples,<br>we recommend you set this to<br>Admins and users. |


| Field                               | Description                                                                                                                                      | Values                                                                                                                                                                      |
|-------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                     |                                                                                                                                                  | Select Admins only for higher<br>privileged permissions.                                                                                                                    |
| Admin<br>consent<br>display<br>name | A short description of the scope's purpose<br>visible to admins only.                                                                            | Read/write permissions to<br>user files. Read permissions<br>to user mail and profiles.                                                                                     |
| Admin<br>consent<br>description     | A more detailed description of the<br>permission granted by the scope that only<br>admins see.                                                   | Allow Office to have<br>read/write permissions to all<br>user files and read<br>permissions to all user mail.<br>Office can call the app's web<br>APIs as the current user. |
| User<br>consent<br>display<br>name  | A short description of the scope's<br>purpose. Shown to users only if you set<br>Who can consent to Admins and users.                            | Read/write permissions to<br>your files. Read permissions<br>to your mail and profile.                                                                                      |
| User<br>consent<br>description      | A more detailed description of the<br>permission granted by the scope. Shown<br>to users only if you set Who can consent<br>to Admins and users. | Allow Office to have<br>read/write permissions to<br>your files, and read<br>permissions to your mail and<br>profile.                                                       |

3. Set the **State** to **Enabled**, and then select **Add scope**.


| Add a scope                                                                                                                                                     |  |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| Scope name * (1                                                                                                                                                 |  |
| access_as_user                                                                                                                                                  |  |
| api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69/access_as_user                                                                                       |  |
| Who can consent? (1)                                                                                                                                            |  |
| Admins and users<br>Admins only                                                                                                                                 |  |
| Admin consent display name * 1                                                                                                                                  |  |
| Read/write permissions to user files. Read permissions to user mail and profiles.                                                                               |  |
| Admin consent description * 0                                                                                                                                   |  |
| Allow Office to have read/write permissions to all user files and read permissions to all<br>user mail. Office can call the app's web APIs as the current user. |  |
| User consent display name (1                                                                                                                                    |  |
| Read/write permissions to your files. Read permissions to your mail and profile.                                                                                |  |
| User consent description (1                                                                                                                                     |  |
| Allow Office to have read/write permissions to your files, and read permissions to your mail<br>and profile.                                                    |  |
| State (1)<br>Disabled<br>Enabled                                                                                                                                |  |
|                                                                                                                                                                 |  |

The new scope you defined displays on the pane.


|                                              | Microsoft Azure                                      |                                                                                                                                  | Search resources, services, and docs (G+/)                                                                                                                                                                                                                                                                                                                                                          |                                                   |   |                                                            | >_ |                                                             |  |                      |  | NestorW@M365x63284 | CONTOSO |
|----------------------------------------------|------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|---|------------------------------------------------------------|----|-------------------------------------------------------------|--|----------------------|--|--------------------|---------|
|                                              | Home > App registrations > contoso-office-add-in-sso |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                     |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              | contoso-office-add-in-sso   Expose an API            |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                     |                                                   | な |                                                            |    |                                                             |  |                      |  |                    | ×       |
|                                              | Search                                               | <<                                                                                                                               | & Got feedback?                                                                                                                                                                                                                                                                                                                                                                                     |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              |                                                      |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                     |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              | 号 Overview                                           |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                     |                                                   |   |                                                            |    |                                                             |  |                      |  |                    | ×       |
|                                              | Quickstart                                           |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                     | Got a second to give us some feedback? >>         |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              | Integration assistant                                |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                     |                                                   |   | api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69 |    |                                                             |  |                      |  |                    | 0 / 向   |
| Manage                                       |                                                      |                                                                                                                                  | Application ID URI                                                                                                                                                                                                                                                                                                                                                                                  |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              | Branding & properties                                |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                     |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              | அ Authentication                                     |                                                                                                                                  | Scopes defined by this API<br>Define custom scopes to restrict access to data and functionality protected by the API. An application that requires access to parts of this<br>API can request that a user or admin consent to one or more of these.<br>Adding a scope here creates only delegated permissions it create application-only scopes, use 'App roles' and define app roles assignable to |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              | Certificates & secrets                               |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                     |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              | Token configuration                                  |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                     |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              | API permissions                                      |                                                                                                                                  | application type. Go to App roles.                                                                                                                                                                                                                                                                                                                                                                  |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              | Expose an API                                        |                                                                                                                                  | - Add a scope                                                                                                                                                                                                                                                                                                                                                                                       |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              | App roles                                            |                                                                                                                                  | Scopes                                                                                                                                                                                                                                                                                                                                                                                              |                                                   |   | Who can consent                                            |    | Admin consent displa                                        |  | User consent display |  | State              |         |
|                                              | Owners                                               |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                     | api://localhost:44355/cfe719d7-aef3-4108-83a8-a8- |   | Admins and users                                           |    | Read/write permissions t  Read/write permissions t  Enabled |  |                      |  |                    |         |
|                                              | & Roles and administrators                           |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                     |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
| o Manifest<br>Authorized client applications |                                                      |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                     |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
| Support + Troubleshooting                    |                                                      | Authorizing a client application indicates that this API trusts the application and users should not be dient calls<br>this API. |                                                                                                                                                                                                                                                                                                                                                                                                     |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              | A Troubleshooting                                    |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                     |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              | New support request                                  |                                                                                                                                  | + Add a client application                                                                                                                                                                                                                                                                                                                                                                          |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              |                                                      |                                                                                                                                  | Client Id                                                                                                                                                                                                                                                                                                                                                                                           |                                                   |   | Scopes                                                     |    |                                                             |  |                      |  |                    |         |
|                                              |                                                      |                                                                                                                                  | No client applications have been authorized                                                                                                                                                                                                                                                                                                                                                         |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |
|                                              |                                                      |                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                     |                                                   |   |                                                            |    |                                                             |  |                      |  |                    |         |

The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID URI** set in the previous step, with /access_as_user appended to the end; for example,

api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user .

- 4. Select **Add a client application**.

| Microsoft Azure<br>=                                                                                                                                                                                     | NestorW@M365x63284.<br>>---<br>2<br>ದಿ<br>Search resources, services, and docs (G+/)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | CONTOSC |  |  |  |  |  |  |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|--|--|--|--|--|--|
| Home > App registrations > contoso-office-add-in-sso                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |         |  |  |  |  |  |  |
|                                                                                                                                                                                                          | contoso-office-add-in-sso   Expose an API<br>2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | ×       |  |  |  |  |  |  |
| ਼<br>Search<br><<                                                                                                                                                                                        | ਕੇ<br>Got feedback?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |         |  |  |  |  |  |  |
| Overview<br>用                                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |         |  |  |  |  |  |  |
| Quickstart                                                                                                                                                                                               | ×                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |         |  |  |  |  |  |  |
| 4                                                                                                                                                                                                        | Got a second to give us some feedback? →                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |         |  |  |  |  |  |  |
| Integration assistant                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |         |  |  |  |  |  |  |
| Manage                                                                                                                                                                                                   | api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69<br>G<br>Application ID URI                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | △前      |  |  |  |  |  |  |
| Branding & properties<br>18<br>ନ<br>Authentication<br>Certificates & secrets<br>Token confiquration<br>API permissions<br>Expose an API<br>App roles<br>Owners<br>Roles and administrators<br>o Manifest | Scopes defined by this API<br>Define custom scopes to restrict access to data and functionality protected by the API. An application that requires access to parts of this<br>API can request that a user or admin consent to one or more of these.<br>Adding a scope here creates only delegated permissions of you are looking to create application-only scopes, as "App roles assignable to<br>application type. Go to App roles.<br>Add a scope<br>+<br>Scopes<br>Who can consent<br>Admin consent displa<br>User consent display<br>State<br>Admins and users<br>Read/write permissions t Read/write permissions t Enabled<br>api://localhost:44355/cfe719d7-aef3-4108-83a8-a8-a8-a8-a8- |         |  |  |  |  |  |  |
| Support + Troubleshootinq                                                                                                                                                                                | Authorized client applications                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |         |  |  |  |  |  |  |
| ્                                                                                                                                                                                                        | Authorizing a client application indicates that this AP trusts the application and users should not be client calls                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |         |  |  |  |  |  |  |
| Troubleshooting                                                                                                                                                                                          | this API.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |         |  |  |  |  |  |  |
| New support request                                                                                                                                                                                      | Add a client application                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |         |  |  |  |  |  |  |
|                                                                                                                                                                                                          | Client Id<br>Scopes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |         |  |  |  |  |  |  |
|                                                                                                                                                                                                          | No client applications have been authorized                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |         |  |  |  |  |  |  |


The **Add a client application** pane appears.

- 5. In the **Client ID** enter ea5a67f6-b6f3-4338-b240-c655ddc3cc8e . This value preauthorizes all Microsoft Office application endpoints. If you also want to preauthorize Office when used inside of Microsoft Teams, add 1fec8e78-bce4-4aafab1b-5451cc387264 (Microsoft Teams desktop and Teams mobile) and 5e3ce6c0- 2b1f-4285-8d4b-75ee78787346 (Teams on the web).
#### 7 **Note**

The ea5a67f6-b6f3-4338-b240-c655ddc3cc8e ID pre-authorizes Office on all the following platforms. Alternatively, you can enter a proper subset of the following IDs if, for any reason, you want to deny authorization to Office on some platforms. If you do so, leave out the IDs of the platforms from which you want to withhold authorization. Users of your add-in on those platforms will not be able to call your Web APIs, but other functionality in your add-in will still work.

- d3590ed6-52b3-4102-aeff-aad2292ab01c (Microsoft Office)
- 93d53678-613d-4013-afc1-62e9e444a0a5 (Office on the web)
- bc59ab01-8403-45c6-8796-ac3ef710b3e3 (Outlook on the web)
- 6. In **Authorized scopes**, select the api://<fully-qualified-domain-name>/<appid>/access_as_user checkbox.
- 7. Select **Add application**.

| Add a client application                                                  |  |  |  |
|---------------------------------------------------------------------------|--|--|--|
| Client ID 1                                                               |  |  |  |
| ea5a67f6-b6f3-4338-b240-c655ddc3cc8e                                      |  |  |  |
| Authorized scopes (1                                                      |  |  |  |
| api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69/access_as_user |  |  |  |
|                                                                           |  |  |  |
| Add application<br>Cancel                                                 |  |  |  |

## **Add Microsoft Graph permissions**


- 1. From the left pane, select **API permissions**.
The **API permissions** pane opens.

- 2. Select **Add a permission**.

| ==<br>Microsoft Azure                                             | NestorW@M365x63284<br>2<br>ಕ್ಷೆ 3<br>>---<br>13<br>2<br>ರ್ಯ<br>Search resources, services, and docs (G+/)<br>CONTOSO (M365X63284053.ON.                                                                                                                                          |  |
|-------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| Home > App registrations > contoso-office-add-in-sso              | contoso-office-add-in-sso   API permissions<br>2<br>×                                                                                                                                                                                                                            |  |
| P Search<br>曝 Overview                                            | & Got feedback?<br>Refresh<br><<                                                                                                                                                                                                                                                 |  |
| & Quickstart<br>Integration assistant                             | ×<br>Starting November 9th, 2020 end users will no longer to newly registered multitenant apps without verfied publishers. Add MPN II to verify<br>publisher                                                                                                                     |  |
| Manage<br>Branding & properties                                   | ×<br>The "Admin consent regured" column shows for an organization. However, user consent can be customized per permission, user, or app. This column<br>may not reflect the value in your orqanizations where this app will be used. Learn more                                  |  |
| ூ Authentication<br>Certificates & secrets<br>Token configuration | Confiqured permissions<br>Applications are authorized to call APIs when the permissions by users/admins as part of the consent process. The list of configured permissions should<br>include all the permissions the application needs. Learn more about permissions and consent |  |
| API permissions<br>Expose an API                                  | Grant admin consent for Contoso<br>+ Add a permission<br>><br>API / Permissions name<br>Type<br>Description<br>Admin consent req<br>Status                                                                                                                                       |  |
| App roles<br>Owners<br>Roles and administrators                   | V Microsoft Graph (1)<br><br>User.Read<br>Sign in and read user profile<br>No<br>:<br>Delegated                                                                                                                                                                                  |  |
| o Manifest<br>Support + Troubleshootina                           | To view and manage permissions and user consent, try Enterprise applications.                                                                                                                                                                                                    |  |
| ્<br>Troubleshooting<br>New support request                       |                                                                                                                                                                                                                                                                                  |  |

The **Request API permissions** pane opens.

- 3. Select **Microsoft Graph**.


- 4. Select **Delegated permissions**.

| Request API permissions                                                                                                         |                                                                                                                 |  |  |  |
|---------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|--|--|--|
| < All APIs<br>Microsoft Graph<br>https://graph.microsoft.com/ Docs [<br>What type of permissions does your application require? |                                                                                                                 |  |  |  |
| Delegated permissions<br>Your application needs to access the API as the signed-in user.                                        | Application permissions<br>Your application runs as a background service or daemon without a<br>signed-in user. |  |  |  |

- 5. In the **Select permissions** search box, search for the permissions your add-in needs. For example, for an Outlook add-in, you might use profile , openid , Files.ReadWrite , and Mail.Read .
The User.Read permission may already be listed by default. It's a good practice to only request permissions that are needed, so we recommend that you uncheck the box for this permission if your add-in doesn't actually need it.

- 6. Select the checkbox for each permission as it appears. Note that the permissions will not remain visible in the list as you select each one. After selecting the permissions that your add-in needs, select **Add permissions**.


| Request API permissions                                                                                                                                                                                                                                          |                                                                                                                 |  |  |  |  |  |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|--|--|--|--|--|
| < All APIs<br>Microsoft Graph<br>https://graph.microsoft.com/ Docs c2<br>What type of permissions does your application require?                                                                                                                                 |                                                                                                                 |  |  |  |  |  |
| Delegated permissions<br>Your application needs to access the API as the signed-in user.                                                                                                                                                                         | Application permissions<br>Your application runs as a background service or daemon without a<br>signed-in user. |  |  |  |  |  |
| Select permissions                                                                                                                                                                                                                                               | expand all                                                                                                      |  |  |  |  |  |
| P Start typing a permission to filter these results                                                                                                                                                                                                              |                                                                                                                 |  |  |  |  |  |
| The "Admin consent required" column shows the default value for an organization. However, user consent can be customized per<br>permission, user, or app. This column may not reflect the value in your organizations where this app will be<br>used. Learn more | ×                                                                                                               |  |  |  |  |  |
| Permission                                                                                                                                                                                                                                                       | Admin consent required                                                                                          |  |  |  |  |  |
| V OpenId permissions (2)                                                                                                                                                                                                                                         |                                                                                                                 |  |  |  |  |  |
| email (1)<br>View users' email address                                                                                                                                                                                                                           | No                                                                                                              |  |  |  |  |  |
| offline_access (1)<br>Maintain access to data you have given it access to                                                                                                                                                                                        | No                                                                                                              |  |  |  |  |  |
| openid 1<br>Sign users in                                                                                                                                                                                                                                        | No                                                                                                              |  |  |  |  |  |
| profile 1<br>View users' basic profile                                                                                                                                                                                                                           | No                                                                                                              |  |  |  |  |  |
| AccessReview                                                                                                                                                                                                                                                     |                                                                                                                 |  |  |  |  |  |
|                                                                                                                                                                                                                                                                  |                                                                                                                 |  |  |  |  |  |
| Add permissions<br>Discard                                                                                                                                                                                                                                       |                                                                                                                 |  |  |  |  |  |

- 7. Select **Grant admin consent for [tenant name]**. Select **Yes** for the confirmation that appears.
## **Configure access token version**

You must define the access token version that is acceptable for your app. This configuration is made in the Azure Active Directory application manifest.

### **Define the access token version**

The access token version can change if you chose an account type other than **Accounts in any organizational directory (Any Azure AD directory - Multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)**. Use the following steps to ensure the access token version is correct for Office SSO usage.


- 1. From the left pane, select **Manifest**.
The Azure Active Directory application manifest appears.

- 2. Enter **2** as the value for the accessTokenAcceptedVersion property.

| NestorW@M365x63284<br>Search resources, services, and docs (G+/)<br>>-<br>18<br>CONTOSO (M365X63284053.ON.                                |  |  |  |  |  |  |  |  |  |
|-------------------------------------------------------------------------------------------------------------------------------------------|--|--|--|--|--|--|--|--|--|
| Home > App registrations > contoso-office-add-in-sso                                                                                      |  |  |  |  |  |  |  |  |  |
| contoso-office-add-in-sso   Manifest<br>2<br>×                                                                                            |  |  |  |  |  |  |  |  |  |
| X Discard ↑ Upload<br>Save<br>↓ Download<br><<<br>Got feedback?                                                                           |  |  |  |  |  |  |  |  |  |
| The editor belows you to update this application its JSON representation. For more details, see. Understanding the Azure Active Driectory |  |  |  |  |  |  |  |  |  |
| application manifest.                                                                                                                     |  |  |  |  |  |  |  |  |  |
| ਹ<br>2<br>"id": "dda28777-ae12-4468-9b03-f9b1867657e2",                                                                                   |  |  |  |  |  |  |  |  |  |
| "acceptMappedClaims": null,<br>3<br>4<br>"accessTokenAcceptedVersion": 2,                                                                 |  |  |  |  |  |  |  |  |  |
| 5<br>addIns : ap<br>6<br>"allowPublicClient": null,                                                                                       |  |  |  |  |  |  |  |  |  |
| 7<br>"appId":"cfe719d7-aef3-4108-83a8-a8283f139a69",                                                                                      |  |  |  |  |  |  |  |  |  |
| 8<br>"appRoles": [],<br>ರಿ<br>"oauth2AllowUrlPathMatching": false,                                                                        |  |  |  |  |  |  |  |  |  |
| "createdDateTime": "2022-10-05T20:54:41Z",<br>10<br>11<br>"description": null,                                                            |  |  |  |  |  |  |  |  |  |
| 12<br>"certification": null,                                                                                                              |  |  |  |  |  |  |  |  |  |
| "disabledByMicrosoftStatus": null,<br>13<br>"groupMembershipClaims": null,<br>14                                                          |  |  |  |  |  |  |  |  |  |
| "identifierUris": [<br>15<br>16<br>"api://localhost:3000/cfe719d7-aef3-4108-83a8-a8283f139a69"                                            |  |  |  |  |  |  |  |  |  |
| 17<br>1,<br>18<br>"informationalUrls": {                                                                                                  |  |  |  |  |  |  |  |  |  |
| "termsOfService": null,<br>19                                                                                                             |  |  |  |  |  |  |  |  |  |
| "support": null,<br>20<br>"privacy": null,<br>21                                                                                          |  |  |  |  |  |  |  |  |  |
| "marketing": null<br>22<br>23<br>},                                                                                                       |  |  |  |  |  |  |  |  |  |
| "keyCredentials": [],<br>24<br>"knownClientApplications": [],<br>25                                                                       |  |  |  |  |  |  |  |  |  |
| 26<br>"logoUrl": null,<br>"logoutUrl": null,<br>27                                                                                        |  |  |  |  |  |  |  |  |  |
| "name": "contoso-office-add-in-sso",<br>28                                                                                                |  |  |  |  |  |  |  |  |  |
| "notes": null,<br>29<br>"oauth2AllowIdTokenImplicitFlow": false.<br>30                                                                    |  |  |  |  |  |  |  |  |  |
|                                                                                                                                           |  |  |  |  |  |  |  |  |  |

- 3. Select **Save**.
A message pops up on the browser stating that the manifest was updated successfully.


Congratulations! You've completed the app registration to enable SSO for your Office add-in.


## **Use SSO to get the identity of the signed-in user**

06/24/2025

Use the getAccessToken API to get an access token that contains the identity for the current user signed in to Office. The access token is also an ID token because it contains identity claims about the signed-in user, such as their name and email. You can also use the ID token to identify the user when calling your own web services. To call getAccessToken , you must configure your Office Add-in to use SSO with Office.

In this article, you'll create an Office Add-in that gets the ID token, and displays the user's name, email, and unique ID in the task pane.

#### 7 **Note**

SSO with Office and the getAccessToken API don't work in all scenarios. Always implement a fallback dialog to sign in the user when SSO is unavailable. For more information, see **Authenticate and authorize with the Office dialog API**.

### **Create an app registration**

To use SSO with Office, you need to create an app registration in the Azure portal so the Microsoft identity platform can provide authentication and authorization services for your Office Add-in and its users.

- 1. To register your app, go to the [Azure portal App registrations](https://go.microsoft.com/fwlink/?linkid=2083908) page.
- 2. Sign in with the *admin* credentials to your Microsoft 365 tenancy. For example, MyName@contoso.onmicrosoft.com.
- 3. Select **New registration**. On the **Register an application** page, set the values as follows.
	- Set **Name** to Office-Add-in-SSO .
	- Set **Supported account types** to **Accounts in any organizational directory and personal Microsoft accounts (e.g. Skype, Xbox, Outlook.com)**.
	- Set the application type to **Web** and then set **Redirect URI** to https://localhost: [port]/dialog.html . Replace [port] with the correct port number for your web application. If you created the add-in using Yo Office, the port number is typically 3000 and found in the package.json file. If you created the add-in with Visual Studio 2019, the port is found in the **SSL URL** property of the web project.


- Choose **Register**.
- 4. On the **Office-Add-in-SSO** page, copy and save the values for the **Application (client) ID** and the **Directory (tenant) ID**. You'll use both of them in later procedures.

This **Application (client) ID** is the "audience" value when other applications, such as the Office client application (e.g., PowerPoint, Word, Excel), seek authorized access to the application. It's also the "client ID" of the application when it, in turn, seeks authorized access to Microsoft Graph.

- 5. Select **Authentication** under **Manage**. In the **Implicit grant** section, enable the checkboxes for both **Access token** and **ID token**.
- 6. Select **Save** at the top of the form.
- 7. Select **Expose an API** under **Manage**. Select the **Set** link. This will generate the Application ID URI in the form api://[app-id-guid] , where [app-id-guid] is the **Application (client) ID**.
- 8. In the generated ID, insert localhost:[port]/ (note the forward slash "/" appended to the end) between the double forward slashes and the GUID. Replace [port] with the correct port number for your web application. If you created the add-in using Yo Office, the port number is typically 3000 and found in the package.json file. If you created the add-in with Visual Studio 2019, the port is found in the **SSL URL** property of the web project.

When you're finished, the entire ID should have the form api://localhost:[port]/[appid-guid] ; for example api://localhost:44355/c6c1f32b-5e55-4997-881a-753cc1d563b7 .

- 9. Select the **Add a scope** button. In the panel that opens, enter access_as_user as the <Scope> name.
#### 10. Set **Who can consent?** to **Admins and users**.

- 11. Fill in the fields for configuring the admin and user consent prompts with values that are appropriate for the access_as_user scope which enables the Office client application to use your add-in's web APIs with the same rights as the current user. Suggestions:
	- **Admin consent display name**: Office can act as the user.
	- **Admin consent description**: Enable Office to call the add-in's web APIs with the same rights as the current user.
	- **User consent display name**: Office can act as you.


- **User consent description**: Enable Office to call the add-in's web APIs with the same rights that you have.
- 12. Ensure that **State** is set to **Enabled**.
- 13. Select **Add scope** .

The domain part of the <Scope> name displayed just below the text field should automatically match the Application ID URI that you set earlier, with /access_as_user appended to the end; for example, api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user .

- 14. In the **Authorized client applications** section, enter the following ID to pre-authorize all Microsoft Office application endpoints.
	- ea5a67f6-b6f3-4338-b240-c655ddc3cc8e (All Microsoft Office application endpoints)

#### 7 **Note**

The ea5a67f6-b6f3-4338-b240-c655ddc3cc8e ID pre-authorizes Office on all the following platforms. Alternatively, you can enter a proper subset of the following IDs if for any reason you want to deny authorization to Office on some platforms. Just leave out the IDs of the platforms from which you want to withhold authorization. Users of your add-in on those platforms will not be able to call your Web APIs, but other functionality in your add-in will still work.

- d3590ed6-52b3-4102-aeff-aad2292ab01c (Microsoft Office)
- 93d53678-613d-4013-afc1-62e9e444a0a5 (Office on the web)
- bc59ab01-8403-45c6-8796-ac3ef710b3e3 (Outlook on the web)
- 15. Select the **Add a client application** button and then, in the panel that opens, set the [app-id-guid] to the Application (client) ID and check the box for

api://localhost:44355/[app-id-guid]/access_as_user .

- 16. Select **Add application**.
- 17. Select **API permissions** under **Manage** and select **Add a permission**. On the panel that opens, choose **Microsoft Graph** and then choose **Delegated permissions**.


- 18. Use the **Select permissions** search box to search for the permissions your add-in needs. Search for and select the **profile** permission. The profile permission is required for the Office application to get a token to your add-in web application.
	- profile

The User.Read permission may already be listed by default. It's a good practice not to ask for permissions that aren't needed, so we recommend that you uncheck the box for this permission if your add-in doesn't actually need it.

- 19. Select the **Add permissions** button at the bottom of the panel.
- 20. On the same page, choose the **Grant admin consent for <tenant-name>** button, and then select **Yes** for the confirmation that appears.

## **Create the Office Add-in**

#### Visual Studio 2019

- 1. Start Visual Studio 2019 and choose to **Create a new project**.
- 2. Search for and select the **Excel Web Add-in** project template. Then choose **Next**. Note: SSO works with any Office application, but Excel is the application being used with this article.
- 3. Enter a project name, such as **sso-display-user-info**, and choose **Create**. You can leave the other fields at default values.
- 4. In the **Choose the add-in type** dialog box, select **Add new functionality to Excel**, and choose **Finish**.

The project is created and will contain two projects in the solution.

- **sso-display-user-info**: Contains the manifest and details for sideloading the add-in to Excel.
- **sso-display-user-infoWeb**: The ASP.NET project that hosts the web pages for the add-in.

## **Configure the manifest**


Visual Studio 2019

In **Solution Explorer**, open **sso-display-user-info** > **sso-display-user-infoManifest** > **ssodisplay-user-info.xml**.

- 1. Near the bottom of the manifest is a closing </Resources> element. Insert the following XML just below the </Resources> element but before the closing </VersionOverrides> element. For Office applications other than Outlook, add the markup to the end of the <VersionOverrides ... xsi:type="VersionOverridesV1_0"> section. For Outlook, add the markup to the end of the <VersionOverrides ... xsi:type="VersionOverridesV1_1"> section.

```
XML
<WebApplicationInfo>
 <Id>[application-id]</Id>
 <Resource>api://localhost:[port]/[application-id]</Resource>
 <Scopes>
 <Scope>openid</Scope>
 <Scope>user.read</Scope>
 <Scope>profile</Scope>
 </Scopes>
</WebApplicationInfo>
```
- 2. Replace [port] with the correct port number for your project. If you created the add-in using Yo Office, the port number is typically 3000 and found in the package.json file. If you created the add-in with Visual Studio 2019, the port is found in the **SSL URL** property of the web project.
- 3. Replace both [application-id] placeholders with the actual application ID from your app registration.
- 4. Save the file.

The XML you inserted contains the following elements and information.

- <WebApplicationInfo> The parent of the following elements.
- <Id> The client ID of the add-in This is an application ID that you obtain as part of registering the add-in. See Register an Office Add-in that uses single sign-on (SSO) with the Microsoft identity platform.
- <Resource> The URL of the add-in. This is the same URI (including the api: protocol) that you used when registering the add-in in Microsoft Entra ID. The domain part of this URI must match the domain, including any subdomains, used in the URLs in the


<Resources> section of the add-in's manifest and the URI must end with the client ID in the <Id> .

- <Scopes> The parent of one or more <Scope> elements.
- <Scope> Specifies a permission that the add-in needs. The profile and openID permissions are always needed and may be the only permissions needed, if your add-in doesn't access Microsoft Graph. If it does, you also need <Scope> elements for the required Microsoft Graph permissions; for example, User.Read , Mail.Read . Libraries that you use in your code to access Microsoft Graph may need additional permissions. For example, Microsoft Authentication Library (MSAL) for .NET requires the offline_access permission. For more information, see Authorize to Microsoft Graph from an Office Addin.

## **Add the jwt-decode package**

You can call the getAccessToken API to get the ID token from Office. First, let's add the jwtdecode package to make it easier to decode and view the ID token.

```
Visual Studio 2019
```
- 1. Open the Visual Studio solution.
- 2. On the menu, choose **Tools** > **NuGet Package Manager** > **Package Manager Console**.
- 3. Enter the following command in the **Package Manager Console**.

Install-Package jwt-decode -Projectname sso-display-user-infoWeb

### **Add UI to the task pane**

Modify the task pane so that it can display the user information you'll get from the ID token.

Visual Studio 2019

- 1. Open the Home.html file.
- 2. Add the following script tag to the <head> section of the page. This will include the jwt-decode package was added earlier.


```
HTML
```

```
<script src="Scripts/jwt-decode-2.2.0.js" type="text/javascript">
</script>
```
- 3. Replace the <body> section with the following HTML.

```
HTML
<body>
 <h1>Welcome</h1>
 <p>
 Sign in to Office, then choose the <b>Get ID Token</b> button to see
your
 ID token information.
 </p>
 <button id="getIDToken">Get ID Token</button>
 <div>
 <span id="userInfo"></span>
 </div>
</body>
```
## **Call the getAccessToken API**

The final step is to get the ID token by calling getAccessToken .

```
1. Open the Home.js file.
  2. Replace the entire contents of the file with the following code.
       JavaScript
Visual Studio 2019
       (function () {
        "use strict";
        // The initialize function must be run each time a new page is loaded.
        Office.initialize = function (reason) {
        $(document).ready(function () {
        $("#getIDToken").on("click", getIDToken);
        });
        };
        async function getIDToken() {
```


## **Run the add-in**

Visual Studio 2019

Choose **Debug** > **Start Debugging**, or press F5 .

- 1. When Excel starts, sign in to Office with the same tenant account you used to create the app registration.
- 2. On the **Home** ribbon, choose **Show Taskpane** to open the add-in.
- 3. In the add-in's task pane, choose **Get ID token**.

The add-in will display the name, email, and ID of the account you signed in with.

#### 7 **Note**

If you encounter any errors, review the registration steps in this article for the app registration. Missing a detail when setting up the app registration is a common cause of 


issues working with SSO. If you still can't get the add-in to run successfully, see **Troubleshoot error messages for single sign-on (SSO)**.

### **Stop the add-in**

Visual Studio 2019

Choose **Stop Debugging**, or press Shift + F5 .

## **See also**

[Using claims to reliably identify a user (Subject and Object ID)](https://learn.microsoft.com/en-us/azure/active-directory/develop/id-tokens#using-claims-to-reliably-identify-a-user-subject-and-object-id)


# **Authorize to Microsoft Graph with SSO**

08/13/2025

Users sign in to Office using either their personal Microsoft account or their Microsoft 365 Education or work account. The best way for an Office Add-in to get authorized access to [Microsoft Graph](https://developer.microsoft.com/graph/docs) is to use the credentials from the user's Office sign on. This enables them to access their Microsoft Graph data without needing to sign in a second time.

## **Add-in architecture for SSO and Microsoft Graph**

In addition to hosting the pages and JavaScript of the web application, the add-in must also host, at the same [fully qualified domain name,](https://learn.microsoft.com/en-us/windows/desktop/DNS/f-gly#_dns_fully_qualified_domain_name_fqdn__gly) one or more web APIs that will get an access token to Microsoft Graph and make requests to it.

The add-in manifest contains a <WebApplicationInfo> element that provides important Azure app registration information to Office, including the permissions to Microsoft Graph that the add-in requires.

### **How it works at runtime**

The following diagram shows the steps involved to sign in and access Microsoft Graph. The entire process uses OAuth 2.0 and JWT access tokens.


- 1. The client-side code of the add-in calls the Office.js API [getAccessToken.](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.auth#office-runtime-officeruntime-auth-getaccesstoken-member(1)) This tells the Office host to obtain an access token for the add-in.
If the user is not signed in, the Office host in conjunction with the Microsoft identity platform provides UI for the user to sign in and consent.

- 2. The Office host request an access token from the Microsoft identity platform.
- 3. The Microsoft identity platform returns access token *A* to the Office host. Access token *A* only provides access to the add-in's own server-side APIs. It does not provide access to Microsoft Graph.
- 4. The Office host returns access token *A* to the add-in's client-side code. Now the clientside code can make authenticated calls to the server-side APIs.
- 5. The client-side code makes an HTTP request to a web API on the server-side that requires authentication. It includes access token *A* as authorization proof. Server-side code validates access token *A*.
- 6. The server-side code uses the OAuth 2.0 On-Behalf-Of flow (OBO) to request a new access token with permissions to Microsoft Graph.


- 7. The Microsoft identity platform returns the new access token *B* with permissions to Microsoft Graph (and a refresh token, if the add-in requests *offline_access* permission). The server can optionally cache access token *B*.
- 8. The server-side code makes a request to a Microsoft Graph API and includes access token *B* with permissions to Microsoft Graph.
- 9. Microsoft Graph returns data back to the server-side code.
- 10. The server-side code returns the data back to the client-side code.

On subsequent requests the client code will always pass access token *A* when making authenticated calls to server-side code. The server-side code can cache token *B* so that it does not need to request it again on future API calls.

## **Develop an SSO add-in that accesses Microsoft Graph**

You develop an add-in that accesses Microsoft Graph just as you would any other application that uses SSO. For a thorough description, see Enable single sign-on for Office Add-ins. The difference is that it is mandatory that the add-in have a server-side Web API.

Depending on your language and framework, libraries might be available that will simplify the server-side code you have to write. Your code should do the following:

- Validate the access token *A* every time it is passed from the client-side code. For more information, see Validate the access token.
- Initiate the OAuth 2.0 On-Behalf-Of flow (OBO) with a call to the Microsoft identity platform that includes the access token, some metadata about the user, and the credentials of the add-in (its ID and secret). For more information about the OBO flow, see [Microsoft identity platform and OAuth 2.0 On-Behalf-Of flow.](https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow)
- Optionally, after the flow completes, cache the returned access token *B* with permissions to Microsoft Graph. You'll want to do this if the add-in makes more than one call to Microsoft Graph. For more information, see [Acquire and cache tokens using the Microsoft](https://learn.microsoft.com/en-us/azure/active-directory/develop/msal-acquire-cache-tokens) [Authentication Library (MSAL)](https://learn.microsoft.com/en-us/azure/active-directory/develop/msal-acquire-cache-tokens)
- Create one or more Web API methods that get Microsoft Graph data by passing the (possibly cached) access token *B* to Microsoft Graph.

For examples of detailed walkthroughs and scenarios, see:

- Create a Node.js Office Add-in that uses single sign-on
- Create an ASP.NET Office Add-in that uses single sign-on
- Scenario: Implement single sign-on to your service in an Outlook add-in


## **Distributing SSO-enabled add-ins in Microsoft AppSource**

When a Microsoft 365 admin acquires an add-in from [AppSource](https://appsource.microsoft.com/) , the admin can redistribute it through the [integrated apps portal](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/test-and-deploy-microsoft-365-apps) and grant admin consent to the add-in to access Microsoft Graph scopes. It's also possible, however, for the end user to acquire the add-in directly from AppSource, in which case the user must grant consent to the add-in. This can create a potential performance problem for which we've provided a solution.

If your code passes the allowConsentPrompt option in the call of getAccessToken , like OfficeRuntime.auth.getAccessToken( { allowConsentPrompt: true } ); , then Office can prompt the user for consent if the Microsoft identity platform reports to Office that consent has not yet been granted to the add-in. However, for security reasons, Office can only prompt the user to consent to the Microsoft Graph profile scope. *Office cannot prompt for consent to other Microsoft Graph scopes*, not even User.Read . This means that if the user grants consent on the prompt, Office returns an access token. But the attempt to exchange the access token for a new access token with additional Microsoft Graph scopes fails with error AADSTS65001, which means consent (to Microsoft Graph scopes) has not been granted.

#### 7 **Note**

The request for consent with { allowConsentPrompt: true } could still fail even for the profile scope if the administrator has turned off end-user consent. For more information, see **[Configure how end-users consent to applications](https://learn.microsoft.com/en-us/entra/identity/enterprise-apps/configure-user-consent)**.

Your code can, and should, handle this error by falling back to an alternate system of authentication, which prompts the user for consent to Microsoft Graph scopes. For code examples, see Create a Node.js Office Add-in that uses single sign-on and Create an ASP.NET Office Add-in that uses single sign-on and the samples they link to. The entire process requires multiple round trips to the Microsoft identity platform. To avoid this performance penalty, include the forMSGraphAccess option in the call of getAccessToken ; for example,

OfficeRuntime.auth.getAccessToken( { forMSGraphAccess: true } ) . This signals to Office that your add-in needs Microsoft Graph scopes. Office will ask the Microsoft identity platform to verify that consent to Microsoft Graph scopes has already been granted to the add-in. If it has, the access token is returned. If it hasn't, then the call of getAccessToken returns error 13012. Your code can handle this error by falling back to an alternate system of authentication immediately, without making a doomed attempt to exchange tokens with the Microsoft identity platform.


As a best practice, always pass forMSGraphAccess to getAccessToken when your add-in will be distributed in AppSource and needs Microsoft Graph scopes.

## **Details on SSO with an Outlook add-in**

If you develop an Outlook add-in that uses SSO and you sideload it for testing, Office will *always* return error 13012 when forMSGraphAccess is passed to getAccessToken even if administrator consent has been granted. For this reason, you should comment out the forMSGraphAccess option **when developing** an Outlook add-in. Be sure to uncomment the option when you deploy for production. The bogus 13012 only happens when you are sideloading in Outlook.

For Outlook add-ins, be sure to enable Modern Authentication for the Microsoft 365 tenancy. For information about how to do this, see [Enable or disable modern authentication for Outlook](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online) [in Exchange Online.](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online)

## **Google Chrome third-party cookie support**

Google Chrome is working to give users more control of their browsing experience. Users will be able to block third-party cookies in their Chrome browser. This will prevent your add-in from using any such cookies. This may cause issues when the add-in authenticates the user, such as multiple sign-on requests or errors.

For improved authentication experiences, see [Using device state for an improved SSO](https://devblogs.microsoft.com/identity/managed-devices-for-blocked-third-party-cookies/) [experience on browsers with blocked third-party cookies](https://devblogs.microsoft.com/identity/managed-devices-for-blocked-third-party-cookies/) .

For more information about the Google Chrome rollout, see [A new path for Privacy Sandbox](https://privacysandbox.com/news/privacy-sandbox-update) [on the web](https://privacysandbox.com/news/privacy-sandbox-update) .

## **See also**

- [OAuth2 Token Exchange](https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-02)
- [Microsoft identity platform and OAuth 2.0 On-Behalf-Of flow](https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow)
- [IdentityAPI requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/identity-api-requirement-sets)


# **Create an ASP.NET Office Add-in that uses single sign-on**

Article • 05/20/2023

Users can sign in to Office, and your Office Web Add-in can take advantage of this signin process to authorize users to your add-in and to Microsoft Graph without requiring users to sign in a second time. This article walks you through the process of enabling single sign-on (SSO) in an add-in.

The sample shows you how to build the following parts:

- Client-side code that provides a task pane that loads in Microsoft Excel, Word, or PowerPoint. The client-side code calls the Office JS API getAccessToken() to get the SSO access token to call server-side REST APIs.
- Server-side code that uses ASP.NET Core to provide a single REST API /api/files . The server-side code uses the [Microsoft Authentication Library for .NET](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet) [(MSAL.NET)](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet) for all token handling, authentication, and authorization.

The sample uses SSO and the On-Behalf-Of (OBO) flow to obtain correct access tokens and call Microsoft Graph APIs. If you are unfamiliar with how this flow works, see How SSO works at runtime for more detail.

## **Prerequisites**

- Visual Studio 2019 or later.
- The **Office/SharePoint development** workload when configuring Visual Studio.
- At least a few files and folders stored on OneDrive for Business in your Microsoft 365 subscription.
- A build of Microsoft 365 that supports the [IdentityAPI 1.3 requirement set.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/identity-api-requirement-sets) You might qualify for a Microsoft 365 E5 developer subscription, which includes a developer sandbox, through the [Microsoft 365 Developer Program](https://aka.ms/m365devprogram) ; for details, see the [FAQ](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-). The [developer sandbox](https://developer.microsoft.com/microsoft-365/dev-program#Subscription) includes a Microsoft Azure subscription that you can use for app registrations in later steps in this article. If you prefer, you can use a separate Microsoft Azure subscription for app registrations. Get a trial subscription at [Microsoft Azure](https://account.windowsazure.com/SignUp) .

## **Set up the starter project**


Clone or download the repo at [Office Add-in ASPNET SSO](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-ASPNET-SSO) .

#### 7 **Note**

There are two versions of the sample.

- The **Begin** folder is a starter project. The UI and other aspects of the add-in that are not directly connected to SSO or authorization are already done. Later sections of this article walk you through the process of completing it.
- The **Complete** folder contains the same sample with all coding steps from this article completed. To use the completed version, just follow the instructions in this article, but replace "Begin" with "Complete" and skip the sections **Code the client side** and **Code the server side**.

Use the following values for placeholders for the subsequent app registration steps.

ノ **Expand table**

| Placeholder                                                 | Value                       |  |  |  |  |  |
|-------------------------------------------------------------|-----------------------------|--|--|--|--|--|
| <add-in-name></add-in-name>                                 | Office-Add-in-ASPNET-SSO    |  |  |  |  |  |
| <fully-qualified-domain-name></fully-qualified-domain-name> | localhost:44355             |  |  |  |  |  |
| Microsoft Graph permissions                                 | profile, openid, Files.Read |  |  |  |  |  |

## **Register the add-in with Microsoft identity platform**

You need to create an app registration in Azure that represents your web server. This enables authentication support so that proper access tokens can be issued to the client code in JavaScript. This registration supports both SSO in the client, and fallback authentication using the Microsoft Authentication Library (MSAL).

- 1. Sign in to the [Azure portal](https://portal.azure.com/) with the *admin* credentials to your Microsoft 365 tenancy. For example, **MyName@contoso.onmicrosoft.com**.
- 2. Select **App registrations**. If you don't see the icon, search for "app registration" in the search bar.


| == | Microsoft Azure                                                                                                                           |                        | Search resources, services, and docs (G+/)                                                                    |                     |              |                                                                                                                                                 |               |  |  |
|----|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------|---------------------------------------------------------------------------------------------------------------|---------------------|--------------|-------------------------------------------------------------------------------------------------------------------------------------------------|---------------|--|--|
|    | Welcome to Azure!<br>Don't have a subscription? Check out the following options.                                                          |                        |                                                                                                               |                     |              |                                                                                                                                                 |               |  |  |
|    |                                                                                                                                           |                        |                                                                                                               |                     |              |                                                                                                                                                 |               |  |  |
|    | Start with an Azure free trial<br>Get $200 free credit toward Azure<br>products and services, plus 12 months of<br>popular free services. | Directory.             | Manage Azure Active Directory<br>Manage access, set smart policies, and<br>enhance security with Azure Active |                     |              | Access student benefits<br>Get free software, Azure credit, or access<br>Azure Dev Tools for Teaching after you<br>verify your academic status. |               |  |  |
|    | Start                                                                                                                                     |                        | View                                                                                                          | Learn more of       |              | Explore                                                                                                                                         | Learn more Of |  |  |
|    | Azure services                                                                                                                            |                        |                                                                                                               |                     |              |                                                                                                                                                 |               |  |  |
|    |                                                                                                                                           |                        |                                                                                                               |                     |              |                                                                                                                                                 |               |  |  |
|    | Create a<br>resource                                                                                                                      | App<br>registrations   | Quickstart<br>Center                                                                                          | Virtual<br>machines | App Services | Storage<br>accounts                                                                                                                             | SQL databases |  |  |
|    |                                                                                                                                           |                        |                                                                                                               |                     |              |                                                                                                                                                 |               |  |  |
|    | Azure Cosmos<br>DB                                                                                                                        | Kubernetes<br>services | More services                                                                                                 |                     |              |                                                                                                                                                 |               |  |  |

The **App registrations** page appears.

- 3. Select **New registration**.

| =      | Microsoft Azure   |                                                                | Search resources, services, and docs (G+/)                                                                                                                                                                                                                              |   |
|--------|-------------------|----------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---|
| Home > |                   |                                                                |                                                                                                                                                                                                                                                                         |   |
|        | App registrations | * **                                                           |                                                                                                                                                                                                                                                                         | × |
|        | New registration  | I<br>Endpoints                                                 | Troubleshooting<br>(. )<br>Refresh<br>20 Preview features<br>ം Download<br>Got feedback?                                                                                                                                                                                |   |
| 0      |                   | Authentication Library (MSAL) and Microsoft Graph.  Learn more | Starting June 30th, 2020 we will no longer add any netive Directory Authentication Library (ADAL) and Azure AD Graph. We will continue<br>to provide technical support and security updates but we will no longer provide feature will need to be upgraded to Microsoft |   |
|        | All applications  | Owned applications                                             | Deleted applications                                                                                                                                                                                                                                                    |   |
|        |                   |                                                                | Add filters<br>Start typing a display name or application (client) ID to filter these r                                                                                                                                                                                 |   |

The **Register an application** page appears.

- 4. On the **Register an application** page, set the values as follows.
	- Set **Name** to <add-in-name> .
	- Set **Supported account types** to **Accounts in any organizational directory (any Azure AD directory - multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)**.
	- Set **Redirect URI** to use the platform **Single-page application (SPA)** and the URI to https://<fully-qualified-domain-name>/dialog.html .


| Register an application<br>×<br>The user-facing display name for this application (this can be changed later).<br>contoso-office-add-in-sso<br>Who can use this application or access this API?<br>Accounts in this organizational directory only (Contoso only - Single tenant)<br>Accounts in any organizational directory (Any Azure AD directory - Multitenant)<br>Accounts in any orqanizational directory (Any Azure AD directory - Multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)<br>Personal Microsoft accounts only<br>Redirect URI (optional)<br>We'll return the authentication response to this URI after successfully authenticating the user. Providing this now is optional and it can be<br>changed later, but a value is required for most authentication scenarios.<br>Single-page application (SPA)<br>https://localhost:44355/dialog.html<br>Register an app you're working on here. Integrate gallery apps from outside your organization by adding from Enterprise applications.<br>By proceeding, you agree to the Microsoft Platform Policies ra<br>Register | ==<br>Microsoft Azure      | Search resources, services, and docs (G+/) |  |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|--------------------------------------------|--|
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Home > App registrations > |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | * Name                     |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Supported account types    |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Help me choose             |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                            |                                            |  |

- 5. Select **Register**. A message is displayed stating that the application registration was created.
- 6. Copy and save the values for the **Application (client) ID** and the **Directory (tenant) ID**. You'll use both of them in later procedures.


## **Add a client secret**

Sometimes called an *application password*, a client secret is a string value your app can use in place of a certificate to identity itself.

- 1. From the left pane, select **Certificates & secrets**. Then on the **Client secrets** tab, select **New client secret**.

| =<br>Microsoft Azure                                                                                                                                                                        |    | Search resources, services, and docs (G+/)                                                                                                                                                                                                                                                  |                                                                                                                                       |           | >- | 13 |  | 803 | 2         | a | NestorW@M365x63284<br>CONTOSO (M365X63284053.ON |   |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------|-----------|----|----|--|-----|-----------|---|-------------------------------------------------|---|
| Home > App registrations > contoso-office-add-in-sso<br>contoso-office-add-in-sso   Certificates & secrets<br>ಸಿ<br>×                                                                       |    |                                                                                                                                                                                                                                                                                             |                                                                                                                                       |           |    |    |  |     |           |   |                                                 |   |
| Search<br>Overview<br>用<br>Quickstart<br>Integration assistant                                                                                                                              | << | ਕੇ<br>Got feedback?<br>Credentials enable confidential applications to identication service when receiving tokens at a web addressable location (using an HTTPS<br>scheme). For a higher level of assurance, we recommend using a certificate (instead of a client secret) as a credential. |                                                                                                                                       |           |    |    |  |     |           |   |                                                 |   |
| Manage<br>Branding & properties<br>17<br>ଦି<br>Authentication<br>Certificates & secrets<br>Token configuration                                                                              |    | Certificates (0)<br>Client secrets (0)<br>A secret string that the application uses to prove its identity when requesting a token. Also can be referred to as application password.<br>- New client secret                                                                                  | Application registration certificates, secrets and federated credentials can be found in the tabs below.<br>Federated credentials (0) |           |    |    |  |     |           |   |                                                 | × |
| API permissions<br>Expose an API<br>App roles<br>Owners<br>્<br>Roles and administrators<br>P<br>o   Manifest<br>Support + Troubleshooting<br>్రా<br>Troubleshooting<br>New support request |    | Description<br>No client secrets have been created for this application.                                                                                                                                                                                                                    | Expires                                                                                                                               | Value (1) |    |    |  |     | Secret ID |   |                                                 |   |

The **Add a client secret** pane appears.

- 2. Add a description for your client secret.
- 3. Select an expiration for the secret or specify a custom lifetime.
	- Client secret lifetime is limited to two years (24 months) or less. You can't specify a custom lifetime longer than 24 months.


- Microsoft recommends that you set an expiration value of less than 12 months.

| Add a client secret |                       | X |
|---------------------|-----------------------|---|
| Description         | Contoso app secret    |   |
| Expires             | Recommended: 6 months |   |

- 4. Select **Add**. The new secret is created and the value is temporarily displayed.
#### ) **Important**

*Record the secret's value* for use in your client application code. This secret value is *never displayed again* after you leave this pane.

### **Expose a web API**

- 1. From the left pane, select **Expose an API**.
The **Expose an API** pane appears.

| Microsoft Azure<br>=                                     | Search resources, services, and docs (G+/) |                                                                                                                                                                                                                       |                      |  |  |  | 803 | 2 | ar                   | NestorW@M365x63284.<br>CONTOSO (M365X63284053.ON |   |
|----------------------------------------------------------|--------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------|--|--|--|-----|---|----------------------|--------------------------------------------------|---|
| Home > App registrations > contoso-office-add-in-sso     |                                            |                                                                                                                                                                                                                       |                      |  |  |  |     |   |                      |                                                  |   |
|                                                          |                                            | contoso-office-add-in-sso   Expose an API<br>2                                                                                                                                                                        |                      |  |  |  |     |   |                      |                                                  | × |
| Search                                                   | <<                                         | ંવે<br>Got feedback?                                                                                                                                                                                                  |                      |  |  |  |     |   |                      |                                                  |   |
| 18<br>Overview<br>Quickstart<br>16                       |                                            | Application ID URI (1 Set                                                                                                                                                                                             |                      |  |  |  |     |   |                      |                                                  |   |
| Integration assistant                                    |                                            | Scopes defined by this API                                                                                                                                                                                            |                      |  |  |  |     |   |                      |                                                  |   |
| Manage                                                   |                                            | Define custom scopes to restrict access to data and functionality protected by the API. An application that requires access to parts of this<br>API can request that a user or admin consent to one or more of these. |                      |  |  |  |     |   |                      |                                                  |   |
| Branding & properties<br>Property<br>Authentication<br>ନ |                                            | Adding a scope here creates only delegated permissions of you are looking to create application-only scopes, as "App roles assignable to<br>application type. Go to App roles.                                        |                      |  |  |  |     |   |                      |                                                  |   |
| Certificates & secrets                                   |                                            | -- Add a scope                                                                                                                                                                                                        |                      |  |  |  |     |   |                      |                                                  |   |
| Token confiquration                                      |                                            | Scopes<br>Who can consent                                                                                                                                                                                             | Admin consent displa |  |  |  |     |   | User consent display | State                                            |   |
| API permissions<br>�                                     |                                            | No scopes have been defined                                                                                                                                                                                           |                      |  |  |  |     |   |                      |                                                  |   |
| Expose an API                                            |                                            |                                                                                                                                                                                                                       |                      |  |  |  |     |   |                      |                                                  |   |
| App roles                                                |                                            | Authorized client applications                                                                                                                                                                                        |                      |  |  |  |     |   |                      |                                                  |   |
| Owners                                                   |                                            | Authorizing a client application indicates that this AP trusts the application and users should not be client calls                                                                                                   |                      |  |  |  |     |   |                      |                                                  |   |
| Roles and administrators<br>10                           |                                            | this API.                                                                                                                                                                                                             |                      |  |  |  |     |   |                      |                                                  |   |
| 0 Manifest                                               |                                            | ー Add a client application                                                                                                                                                                                            |                      |  |  |  |     |   |                      |                                                  |   |
| Support + Troubleshooting                                |                                            | Client Id<br>Scopes                                                                                                                                                                                                   |                      |  |  |  |     |   |                      |                                                  |   |
| Troubleshooting<br>New support request<br>ರ್             |                                            | No client applications have been authorized                                                                                                                                                                           |                      |  |  |  |     |   |                      |                                                  |   |

- 2. Select **Set** to generate an application ID URI.


| ==<br>Microsoft Azure                                 | Search resources, services, and docs (G+/)                                                                                                                                                                            | >_                                                                                                                   |  |  |                      | NestorW@M365x63284<br>CONTOSO (M365X63284053.ON |   |  |  |
|-------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------|--|--|----------------------|-------------------------------------------------|---|--|--|
| Home > App registrations > contoso-office-add-in-sso  |                                                                                                                                                                                                                       |                                                                                                                      |  |  |                      |                                                 |   |  |  |
|                                                       | contoso-office-add-in-sso   Expose an API<br>な                                                                                                                                                                        |                                                                                                                      |  |  |                      |                                                 | × |  |  |
| Search<br><<                                          | ్రార్ల<br>Got feedback?                                                                                                                                                                                               |                                                                                                                      |  |  |                      |                                                 |   |  |  |
| 曝 Overview<br>Quickstart                              | Application ID URI (1)                                                                                                                                                                                                |                                                                                                                      |  |  |                      |                                                 |   |  |  |
| ನ್<br>Integration assistant                           | Scopes defined by this API                                                                                                                                                                                            |                                                                                                                      |  |  |                      |                                                 |   |  |  |
| Manage                                                | Define custom scopes to restrict access to data and functionality protected by the API. An application that requires access to parts of this<br>API can request that a user or admin consent to one or more of these. |                                                                                                                      |  |  |                      |                                                 |   |  |  |
| Branding & properties<br>ព្រៃ<br>ଦି<br>Authentication | Adding a scope here creates only delegated permissions of you are looking to create application-only scopes, as "App roles assignable to<br>application type. Go to App roles.                                        |                                                                                                                      |  |  |                      |                                                 |   |  |  |
| Certificates & secrets                                | -- Add a scope                                                                                                                                                                                                        |                                                                                                                      |  |  |                      |                                                 |   |  |  |
| Token confiquration                                   | Scopes<br>Who can consent                                                                                                                                                                                             | Admin consent displa                                                                                                 |  |  | User consent display | State                                           |   |  |  |
| API permissions<br>φ                                  | No scopes have been defined                                                                                                                                                                                           |                                                                                                                      |  |  |                      |                                                 |   |  |  |
| Expose an API                                         |                                                                                                                                                                                                                       |                                                                                                                      |  |  |                      |                                                 |   |  |  |
| App roles                                             | Authorized client applications                                                                                                                                                                                        |                                                                                                                      |  |  |                      |                                                 |   |  |  |
| Owners                                                |                                                                                                                                                                                                                       | Authorizing a client application indicates that this API trusts the application and users should not be client calls |  |  |                      |                                                 |   |  |  |
| Roles and administrators<br>100                       | this API.                                                                                                                                                                                                             |                                                                                                                      |  |  |                      |                                                 |   |  |  |
| 0 Manifest                                            |                                                                                                                                                                                                                       |                                                                                                                      |  |  |                      |                                                 |   |  |  |
| Support + Troubleshooting                             | Add a client application<br>--                                                                                                                                                                                        |                                                                                                                      |  |  |                      |                                                 |   |  |  |
| হ্য<br>Troubleshooting                                | Client Id<br>Scopes                                                                                                                                                                                                   |                                                                                                                      |  |  |                      |                                                 |   |  |  |
| New support request                                   | No client applications have been authorized                                                                                                                                                                           |                                                                                                                      |  |  |                      |                                                 |   |  |  |

The section for setting the application ID URI appears with a generated Application ID URI in the form api://<app-id> .

- 3. Update the application ID URI to api://<fully-qualified-domain-name>/<app-id> .

| Edit the App ID URI                                        |
|------------------------------------------------------------|
| Application ID URI                                         |
| api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69 |
| Discard<br>Save                                            |

- The **Application ID URI** is pre-filled with app ID (GUID) in the format api://<app-id> .
- The application ID URI format should be: api://<fully-qualified-domainname>/<app-id>
- Insert the fully-qualified-domain-name between api:// and <app-id> (which is a GUID). For example, api://contoso.com/<app-id> .
- If you're using localhost, then the format should be api://localhost: <port>/<app-id> . For example, api://localhost:3000/c6c1f32b-5e55-4997- 881a-753cc1d563b7 .

For additional application ID URI details, see [Application manifest identifierUris](https://learn.microsoft.com/en-us/azure/active-directory/develop/reference-app-manifest#identifieruris-attribute) [attribute.](https://learn.microsoft.com/en-us/azure/active-directory/develop/reference-app-manifest#identifieruris-attribute)

7 **Note**


If you get an error saying that the domain is already owned but you own it, follow the procedure at **[Quickstart: Add a custom domain name to Azure](https://learn.microsoft.com/en-us/azure/active-directory/add-custom-domain) [Active Directory](https://learn.microsoft.com/en-us/azure/active-directory/add-custom-domain)** to register it, and then repeat this step. (This error can also occur if you are not signed in with credentials of an admin in the Microsoft 365 tenancy. See step 2. Sign out and sign in again with admin credentials and repeat the process from step 3.)

### **Add a scope**

- 1. On the **Expose an API** page, select **Add a scope**.

| Microsoft Azure<br>=                                 |    | Search resources, services, and docs (G+/)  |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  | >-                   |  |  |  | 2 | ಡಿ                   | NestorW@M365x63284<br>CONTOSO (M365X63284053.ON |       |   |
|------------------------------------------------------|----|---------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---|-----------------------------------------------------------|--|----------------------|--|--|--|---|----------------------|-------------------------------------------------|-------|---|
| Home > App registrations > contoso-office-add-in-sso |    |                                             |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
| contoso-office-add-in-sso   Expose an API            |    |                                             |                                                                                                                                                                                                                                                                                                                                                                                                             | 2 |                                                           |  |                      |  |  |  |   |                      |                                                 |       | × |
| P Search<br>Overview<br>सर                           | << | ದ್ದಾರೆ.<br>Got feedback?                    |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
| Quickstart                                           |    | Application ID URI                          |                                                                                                                                                                                                                                                                                                                                                                                                             |   | api://localhost:3000/cfe719d7-aef3-4108-83a8-a8283f139a69 |  |                      |  |  |  |   |                      |                                                 | ■ △ 向 |   |
| Integration assistant                                |    | Scopes defined by this API                  |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
| Manage                                               |    |                                             |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
| Branding & properties<br>1                           |    |                                             | Define custom scopes to restrict access to data and functionality protected by the API. An application that requires access to parts of this<br>API can request that a user or admin consent to one or more of these.<br>Adding a scope here creates only delegated permissions of create application-only scopes, use "App roles" and define app roles assignable to<br>application type. Go to App roles. |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
| Authentication<br>ନ                                  |    |                                             |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
| Certificates & secrets                               |    |                                             |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
| Token confiquration                                  |    | Add a scope                                 |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
| API permissions<br>Ф                                 |    | Scopes                                      |                                                                                                                                                                                                                                                                                                                                                                                                             |   | Who can consent                                           |  | Admin consent displa |  |  |  |   | User consent display | State                                           |       |   |
| Expose an API                                        |    | No scopes have been defined                 |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
| #<br>App roles                                       |    |                                             |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
| Owners                                               |    | Authorized client applications              |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
| Roles and administrators<br>8                        |    | this API.                                   | Authorizing a client application indicates that this API trusts the application and users should not be dient calls                                                                                                                                                                                                                                                                                         |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
| 0 Manifest                                           |    |                                             |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
| Support + Troubleshooting                            |    | Add a client application<br>-               |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
| Troubleshooting<br>19                                |    | Client Id                                   |                                                                                                                                                                                                                                                                                                                                                                                                             |   | Scopes                                                    |  |                      |  |  |  |   |                      |                                                 |       |   |
| New support request<br>್                             |    | No client applications have been authorized |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |
|                                                      |    |                                             |                                                                                                                                                                                                                                                                                                                                                                                                             |   |                                                           |  |                      |  |  |  |   |                      |                                                 |       |   |

The **Add a scope** pane opens.

- 2. In the **Add a scope** pane, specify the scope's attributes. The following table shows example values for and Outlook add-in requiring the profile , openid , Files.ReadWrite , and Mail.Read permissions. Modify the text to match the
permissions your add-in needs.

ノ **Expand table**

| Field      | Description                                                                                       | Values                                          |
|------------|---------------------------------------------------------------------------------------------------|-------------------------------------------------|
| Scope name | The name of your scope. A common<br>scope naming convention is<br>resource.operation.constraint . | For SSO this must be set to<br>access_as_user . |


| Field                               | Description                                                                                                                                      | Values                                                                                                                                                                      |
|-------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Who can<br>consent                  | Determines if admin consent is required<br>or if users can consent without an admin<br>approval.                                                 | For learning SSO and samples,<br>we recommend you set this to<br>Admins and users.                                                                                          |
|                                     |                                                                                                                                                  | Select Admins only for higher<br>privileged permissions.                                                                                                                    |
| Admin<br>consent<br>display<br>name | A short description of the scope's purpose<br>visible to admins only.                                                                            | Read/write permissions to<br>user files. Read permissions<br>to user mail and profiles.                                                                                     |
| Admin<br>consent<br>description     | A more detailed description of the<br>permission granted by the scope that only<br>admins see.                                                   | Allow Office to have<br>read/write permissions to all<br>user files and read<br>permissions to all user mail.<br>Office can call the app's web<br>APIs as the current user. |
| User<br>consent<br>display<br>name  | A short description of the scope's<br>purpose. Shown to users only if you set<br>Who can consent to Admins and users.                            | Read/write permissions to<br>your files. Read permissions<br>to your mail and profile.                                                                                      |
| User<br>consent<br>description      | A more detailed description of the<br>permission granted by the scope. Shown<br>to users only if you set Who can consent<br>to Admins and users. | Allow Office to have<br>read/write permissions to<br>your files, and read<br>permissions to your mail and<br>profile.                                                       |

3. Set the **State** to **Enabled**, and then select **Add scope**.


| Add a scope                                                                                                                                                     |  |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| Scope name * (1                                                                                                                                                 |  |
| access_as_user                                                                                                                                                  |  |
| api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69/access_as_user                                                                                       |  |
| Who can consent? (1)                                                                                                                                            |  |
| Admins and users<br>Admins only                                                                                                                                 |  |
| Admin consent display name * (1                                                                                                                                 |  |
| Read/write permissions to user files. Read permissions to user mail and profiles.                                                                               |  |
| Admin consent description * (1                                                                                                                                  |  |
| Allow Office to have read/write permissions to all user files and read permissions to all<br>user mail. Office can call the app's web APIs as the current user. |  |
| User consent display name (1                                                                                                                                    |  |
| Read/write permissions to your files. Read permissions to your mail and profile.                                                                                |  |
| User consent description (1                                                                                                                                     |  |
| Allow Office to have read/write permissions to your files, and read permissions to your mail<br>and profile.                                                    |  |
| tate (i)<br>Disabled<br>Enabled                                                                                                                                 |  |
|                                                                                                                                                                 |  |

The new scope you defined displays on the pane.


|  | Microsoft Azure                                      | Q  | Search resources, services, and docs (G+/)                                                                                       |                                                                                                                                                                                                                      |   |                                                            | >-                   |  |  |  |                                                           | NestorW@M365x63284. | CONTOSO |  |
|--|------------------------------------------------------|----|----------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---|------------------------------------------------------------|----------------------|--|--|--|-----------------------------------------------------------|---------------------|---------|--|
|  | Home > App registrations > contoso-office-add-in-sso |    |                                                                                                                                  |                                                                                                                                                                                                                      |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  | contoso-office-add-in-sso   Expose an API            |    |                                                                                                                                  |                                                                                                                                                                                                                      | 2 |                                                            |                      |  |  |  |                                                           |                     | ×       |  |
|  | P Search                                             | << | Got feedback?                                                                                                                    |                                                                                                                                                                                                                      |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  | 号 Overview                                           |    |                                                                                                                                  |                                                                                                                                                                                                                      |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  | Quickstart                                           |    |                                                                                                                                  | Got a second to give us some feedback? >                                                                                                                                                                             |   |                                                            |                      |  |  |  |                                                           |                     | ×       |  |
|  | Integration assistant                                |    |                                                                                                                                  |                                                                                                                                                                                                                      |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  | Manage                                               |    | Application ID URI                                                                                                               |                                                                                                                                                                                                                      |   | api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69 |                      |  |  |  |                                                           |                     | 0 / 向   |  |
|  | Branding & properties                                |    |                                                                                                                                  |                                                                                                                                                                                                                      |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  | ூ Authentication                                     |    | Scopes defined by this API                                                                                                       |                                                                                                                                                                                                                      |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  | Certificates & secrets                               |    |                                                                                                                                  | Define custom scopes to restrict access to data and functionality protected by the API. An application that regures access to parts of this<br>API can request that a user or admin consent to one or more of these. |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  | Token configuration                                  |    |                                                                                                                                  | Adding a scope here creates only delegated permissions of you are locking to create application-only scopes, use 'App roles assignable to                                                                            |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  | API permissions                                      |    | application type. Go to App roles.                                                                                               |                                                                                                                                                                                                                      |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  | Expose an API                                        |    | — Add a scope                                                                                                                    |                                                                                                                                                                                                                      |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  | App roles                                            |    | Scopes                                                                                                                           |                                                                                                                                                                                                                      |   | Who can consent                                            | Admin consent displa |  |  |  | User consent display                                      | State               |         |  |
|  | Owners                                               |    |                                                                                                                                  | api://localhost:44355/cfe719d7-aef3-4108-83a8-a8-                                                                                                                                                                    |   | Admins and users                                           |                      |  |  |  | Read/write permissions t Read/write permissions t Enabled |                     |         |  |
|  | Roles and administrators                             |    |                                                                                                                                  |                                                                                                                                                                                                                      |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  | o Manifest                                           |    | Authorized client applications                                                                                                   |                                                                                                                                                                                                                      |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  | Support + Troubleshooting                            |    | Authorizing a client application indicates that this API trusts the application and users should not be dient calls<br>this API. |                                                                                                                                                                                                                      |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  | ് Troubleshooting                                    |    |                                                                                                                                  |                                                                                                                                                                                                                      |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  | New support request                                  |    | + Add a client application                                                                                                       |                                                                                                                                                                                                                      |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  |                                                      |    | Client Id                                                                                                                        |                                                                                                                                                                                                                      |   | Scopes                                                     |                      |  |  |  |                                                           |                     |         |  |
|  |                                                      |    |                                                                                                                                  | No client applications have been authorized                                                                                                                                                                          |   |                                                            |                      |  |  |  |                                                           |                     |         |  |
|  |                                                      |    |                                                                                                                                  |                                                                                                                                                                                                                      |   |                                                            |                      |  |  |  |                                                           |                     |         |  |

The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID URI** set in the previous step, with /access_as_user appended to the end; for example,

api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user .

- 4. Select **Add a client application**.

| Microsoft Azure                                                                                                                | NestorW@M365x63284.<br>>_<br>C<br>0<br>Search resources, services, and docs (G+/)<br>CONTOSO                                                                                                                                                        |  |  |  |  |  |  |  |  |
|--------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|--|--|--|--|--|--|
| Home > App registrations > contoso-office-add-in-sso                                                                           |                                                                                                                                                                                                                                                     |  |  |  |  |  |  |  |  |
|                                                                                                                                | contoso-office-add-in-sso   Expose an API<br>2<br>×                                                                                                                                                                                                 |  |  |  |  |  |  |  |  |
| 0<br>Search                                                                                                                    | Got feedback?<br>ਕੇ<br><<                                                                                                                                                                                                                           |  |  |  |  |  |  |  |  |
| は<br>Overview                                                                                                                  |                                                                                                                                                                                                                                                     |  |  |  |  |  |  |  |  |
| Quickstart                                                                                                                     | ×                                                                                                                                                                                                                                                   |  |  |  |  |  |  |  |  |
| ತೆ                                                                                                                             | Got a second to give us some feedback? >>                                                                                                                                                                                                           |  |  |  |  |  |  |  |  |
| Integration assistant<br>28                                                                                                    |                                                                                                                                                                                                                                                     |  |  |  |  |  |  |  |  |
| Manage                                                                                                                         | api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69<br>△前<br>Application ID URI                                                                                                                                                              |  |  |  |  |  |  |  |  |
| Branding & properties<br>12<br>ନ<br>Authentication<br>Certificates & secrets                                                   | Scopes defined by this API<br>Define custom scopes to restrict access to data and functionality protected by the API. An application that requires access to parts of this<br>API can request that a user or admin consent to one or more of these. |  |  |  |  |  |  |  |  |
| Token configuration                                                                                                            | Adding a scope here creates only delegated permission of you are looking to create application-only scopes, as "App roles assignable to<br>application type. Go to App roles.                                                                       |  |  |  |  |  |  |  |  |
| API permissions                                                                                                                |                                                                                                                                                                                                                                                     |  |  |  |  |  |  |  |  |
| Expose an API                                                                                                                  | — Add a scope                                                                                                                                                                                                                                       |  |  |  |  |  |  |  |  |
| App roles                                                                                                                      | Admin consent displa<br>Scopes<br>Who can consent<br>User consent display<br>State                                                                                                                                                                  |  |  |  |  |  |  |  |  |
| Owners                                                                                                                         | Admins and users<br>Read/write permissions t Read/write permissions t Enabled<br>api://localhost:44355/cfe719d7-aef3-4108-83a8-a8-                                                                                                                  |  |  |  |  |  |  |  |  |
| Roles and administrators<br>ﻦ<br>o Manifest<br>Support + Troubleshooting<br>્<br>Troubleshooting<br>New support request<br>ర్య | Authorized client applications<br>Authorizing a client application indicates that this API trusts the application and users should not be dient calls<br>this API.<br>Add a client application<br>Client Id<br>Scopes                               |  |  |  |  |  |  |  |  |
|                                                                                                                                | No client applications have been authorized                                                                                                                                                                                                         |  |  |  |  |  |  |  |  |


The **Add a client application** pane appears.

- 5. In the **Client ID** enter ea5a67f6-b6f3-4338-b240-c655ddc3cc8e . This value preauthorizes all Microsoft Office application endpoints. If you also want to preauthorize Office when used inside of Microsoft Teams, add 1fec8e78-bce4-4aafab1b-5451cc387264 (Microsoft Teams desktop and Teams mobile) and 5e3ce6c0- 2b1f-4285-8d4b-75ee78787346 (Teams on the web).
#### 7 **Note**

The ea5a67f6-b6f3-4338-b240-c655ddc3cc8e ID pre-authorizes Office on all the following platforms. Alternatively, you can enter a proper subset of the following IDs if, for any reason, you want to deny authorization to Office on some platforms. If you do so, leave out the IDs of the platforms from which you want to withhold authorization. Users of your add-in on those platforms will not be able to call your Web APIs, but other functionality in your add-in will still work.

- d3590ed6-52b3-4102-aeff-aad2292ab01c (Microsoft Office)
- 93d53678-613d-4013-afc1-62e9e444a0a5 (Office on the web)
- bc59ab01-8403-45c6-8796-ac3ef710b3e3 (Outlook on the web)
- 6. In **Authorized scopes**, select the api://<fully-qualified-domain-name>/<appid>/access_as_user checkbox.
- 7. Select **Add application**.

| Add a client application                                                  |  |
|---------------------------------------------------------------------------|--|
| Client ID (1)                                                             |  |
| ea5a67f6-b6f3-4338-b240-c655ddc3cc8e                                      |  |
| Authorized scopes (1                                                      |  |
| api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69/access_as_user |  |
|                                                                           |  |
| Add application<br>Cancel                                                 |  |

## **Add Microsoft Graph permissions**


- 1. From the left pane, select **API permissions**.
The **API permissions** pane opens.

- 2. Select **Add a permission**.

| =<br>Microsoft Azure                                 |                                                                               | Search resources, services, and docs (G+/) |                                 |                                                                                                                                                                                                                                                        | >_ |  | ಲ  | ಕ್ಷರಿ | 2                 | ್ನಿ | NestorW@M365x63284<br>CONTOSO (M365X63284053.ON. |   |
|------------------------------------------------------|-------------------------------------------------------------------------------|--------------------------------------------|---------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----|--|----|-------|-------------------|-----|--------------------------------------------------|---|
| Home > App registrations > contoso-office-add-in-sso |                                                                               |                                            |                                 |                                                                                                                                                                                                                                                        |    |  |    |       |                   |     |                                                  |   |
| contoso-office-add-in-sso   API permissions<br>2     |                                                                               |                                            |                                 |                                                                                                                                                                                                                                                        |    |  |    |       | ×                 |     |                                                  |   |
| Search<br>場 Overview<br>Quickstart                   | <<                                                                            | & Got feedback?<br>() Refresh              |                                 |                                                                                                                                                                                                                                                        |    |  |    |       |                   |     |                                                  |   |
| Integration assistant                                |                                                                               | publisher                                  |                                 | Starting November 9th, 2020 end users will no longer to newly registered multitenant apps without verified publishers. Add MPN ID to verify                                                                                                            |    |  |    |       |                   |     |                                                  | × |
| Manage<br>Branding & properties<br>ூ Authentication  |                                                                               |                                            |                                 | The "Admin consent reguired" column shows the default value for an organization. However, user permission, user, or app. This column<br>may not reflect the value in your orqanizations where this app will be used. Learn more                        |    |  |    |       |                   |     |                                                  | × |
| Certificates & secrets                               |                                                                               | Confiqured permissions                     |                                 |                                                                                                                                                                                                                                                        |    |  |    |       |                   |     |                                                  |   |
| Token configuration                                  |                                                                               |                                            |                                 | Applications are authorized to call APIs when the permissions by users/admins as part of the consent process. The list of configured permissions should<br>include all the permissions the application needs. Learn more about permissions and consent |    |  |    |       |                   |     |                                                  |   |
| API permissions                                      |                                                                               |                                            |                                 |                                                                                                                                                                                                                                                        |    |  |    |       |                   |     |                                                  |   |
| Expose an API                                        |                                                                               | + Add a permission<br>>                    | Grant admin consent for Contoso |                                                                                                                                                                                                                                                        |    |  |    |       |                   |     |                                                  |   |
| App roles                                            |                                                                               | API / Permissions name                     | Type                            | Description                                                                                                                                                                                                                                            |    |  |    |       | Admin consent req |     | Status                                           |   |
| Owners                                               |                                                                               | V Microsoft Graph (1)                      |                                 |                                                                                                                                                                                                                                                        |    |  |    |       |                   |     |                                                  |   |
| Roles and administrators                             |                                                                               | User.Read                                  | Delegated                       | Sign in and read user profile                                                                                                                                                                                                                          |    |  | No |       |                   |     |                                                  |   |
| o Manifest                                           |                                                                               |                                            |                                 |                                                                                                                                                                                                                                                        |    |  |    |       |                   |     |                                                  |   |
| Support + Troubleshooting                            | To view and manage permissions and user consent, try Enterprise applications. |                                            |                                 |                                                                                                                                                                                                                                                        |    |  |    |       |                   |     |                                                  |   |
| જ્<br>Troubleshooting                                |                                                                               |                                            |                                 |                                                                                                                                                                                                                                                        |    |  |    |       |                   |     |                                                  |   |
| New support request                                  |                                                                               |                                            |                                 |                                                                                                                                                                                                                                                        |    |  |    |       |                   |     |                                                  |   |
|                                                      |                                                                               |                                            |                                 |                                                                                                                                                                                                                                                        |    |  |    |       |                   |     |                                                  |   |

The **Request API permissions** pane opens.

- 3. Select **Microsoft Graph**.


- 4. Select **Delegated permissions**.

| Request API permissions                                                                                                           | ×                                                                                                               |
|-----------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
| < All APIs<br>Microsoft Graph<br>https://graph.microsoft.com/ Docs [2]<br>What type of permissions does your application require? |                                                                                                                 |
| Delegated permissions<br>Your application needs to access the API as the signed-in user.                                          | Application permissions<br>Your application runs as a background service or daemon without a<br>signed-in user. |

- 5. In the **Select permissions** search box, search for the permissions your add-in needs. For example, for an Outlook add-in, you might use profile , openid ,
Files.ReadWrite , and Mail.Read .

7 **Note**

The User.Read permission may already be listed by default. It's a good practice to only request permissions that are needed, so we recommend that you uncheck the box for this permission if your add-in doesn't actually need it.

- 6. Select the checkbox for each permission as it appears. Note that the permissions will not remain visible in the list as you select each one. After selecting the permissions that your add-in needs, select **Add permissions**.


| Request API permissions                                                                                                                                                                                                                                               |                                                                                                                 |  |  |  |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|--|--|--|
| < All APIs<br>Microsoft Graph<br>https://graph.microsoft.com/ Docs &<br>What type of permissions does your application require?                                                                                                                                       |                                                                                                                 |  |  |  |
| Delegated permissions<br>Your application needs to access the API as the signed-in user.                                                                                                                                                                              | Application permissions<br>Your application runs as a background service or daemon without a<br>signed-in user. |  |  |  |
| Select permissions                                                                                                                                                                                                                                                    | expand all                                                                                                      |  |  |  |
| Start typing a permission to filter these results                                                                                                                                                                                                                     |                                                                                                                 |  |  |  |
| ×<br>The "Admin consent required" column shows the default value for an organization. However, user consent can be customized per<br>permission, user, or app. This column may not reflect the value in your organizations where this app will be<br>used. Learn more |                                                                                                                 |  |  |  |
| Permission                                                                                                                                                                                                                                                            | Admin consent required                                                                                          |  |  |  |
| V OpenId permissions (2)                                                                                                                                                                                                                                              |                                                                                                                 |  |  |  |
| email (1)<br>View users' email address                                                                                                                                                                                                                                | No                                                                                                              |  |  |  |
| offline_access (1)<br>Maintain access to data you have given it access to                                                                                                                                                                                             | No                                                                                                              |  |  |  |
| openid ()<br>Sign users in                                                                                                                                                                                                                                            | No                                                                                                              |  |  |  |
| profile ()<br>View users' basic profile                                                                                                                                                                                                                               | No                                                                                                              |  |  |  |
| AccessReview                                                                                                                                                                                                                                                          |                                                                                                                 |  |  |  |
|                                                                                                                                                                                                                                                                       |                                                                                                                 |  |  |  |
|                                                                                                                                                                                                                                                                       |                                                                                                                 |  |  |  |
| Add permissions<br>Discard                                                                                                                                                                                                                                            |                                                                                                                 |  |  |  |

- 7. Select **Grant admin consent for [tenant name]**. Select **Yes** for the confirmation that appears.
## **Configure access token version**

You must define the access token version that is acceptable for your app. This configuration is made in the Azure Active Directory application manifest.

### **Define the access token version**

The access token version can change if you chose an account type other than **Accounts in any organizational directory (Any Azure AD directory - Multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)**. Use the following steps to ensure the access token version is correct for Office SSO usage.


- 1. From the left pane, select **Manifest**.
The Azure Active Directory application manifest appears.

- 2. Enter **2** as the value for the requestedAccessTokenVersion property (in the api object).


- 3. Select **Save**.
A message pops up on the browser stating that the manifest was updated successfully.

Congratulations! You've completed the app registration to enable SSO for your Office add-in.

### **Configure the solution**

- 1. In the root of the **Begin** folder, open the solution (.sln) file in **Visual Studio**. Rightclick (or select and hold) the top node in **Solution Explorer** (the Solution node, not either of the project nodes), and then select **Set startup projects**.


- 2. Under **Common Properties**, select **Startup Project**, and then **Multiple startup projects**. Ensure that the **Action** for both projects is set to **Start**, and that the **Office-Add-in-ASPNETCoreWebAPI** project is listed first. Close the dialog.
- 3. In **Solution Explorer**, choose the **Office-Add-in-ASPNET-SSO-manifest** project and open the add-in manifest file "Office-Add-in-ASPNET-SSO.xml" and then scroll to the bottom of the file. Just above the end </VersionOverrides> tag, you'll find the following markup.

| XML                                                             |
|-----------------------------------------------------------------|
| <webapplicationinfo></webapplicationinfo>                       |
| <id>Enter_client_ID_here</id>                                   |
| <resource>api://localhost:44355/Enter_client_ID_here</resource> |
| <scopes></scopes>                                               |
| <scope>Files.Read</scope>                                       |
| <scope>profile</scope>                                          |
| <scope>openid</scope>                                           |
|                                                                 |
|                                                                 |

- 4. Replace the placeholder "Enter_client_ID_here" *in both places* in the markup with the **Application ID** that you copied when you created the **Office-Add-in-ASPNET-SSO** app registration. This is the same ID you used for the application ID in the appsettings.json file.
The **<Resource>** value is the **Application ID URI** you set when you registered the add-in. The **<Scopes>** section is used only to generate a consent dialog box if the add-in is sold through AppSource.

- 5. Save and close the manifest file.
- 6. In **Solution Explorer**, choose the **Office-Add-in-ASPNET-SSO-web** project and open the **appsettings.json** file.
- 7. Replace the placeholder **Enter_client_id_here** with the **Application (client) ID** value you saved previously.
- 8. Replace the placeholder **Enter_client_secret_here** with the client secret value you saved previously.


You must also change the **TenantId** to support single-tenant if you configured your app registration for single-tenant. Replace the **Common** value with the **Application (client) ID** for single-tenant support.

- 9. Save and close the appsettings.json file.
## **Code the client side**

### **Get the access token and call the application server REST API**

- 1. In the **Office-Add-in-ASPNETCore-WebAPI** project, open the **wwwroot\js\HomeES6.js** file. It already has code that ensures that Promises are supported, even in the Trident (Internet Explorer 11) webview control, and an Office.onReady call to assign a handler to the add-in's only button.
#### 7 **Note**

As the name suggests, the HomeES6.js uses JavaScript ES6 syntax because using async and await best shows the essential simplicity of the SSO API. When the localhost server is started, this file is transpiled to ES5 syntax so that the sample will support Trident.

- 2. In the getUserFileNames function, replace TODO 1 with the following code. About this code, note:
	- It calls Office.auth.getAccessToken to get the access token from Office using SSO. This token will contain the user's identity as well as access permission to the application server.
	- The access token is passed to callRESTApi which makes the actual call to the application server. The application server then uses the OBO flow to call Microsoft Graph.
	- Any errors from calling getAccessToken will be handled by handleClientSideErrors .

#### JavaScript

```
 let fileNameList = null;
try {
 let accessToken = await Office.auth.getAccessToken(options);
```


```
 fileNameList = await callRESTApi("/api/files", accessToken);
}
catch (exception) {
 if (exception.code) {
 handleClientSideErrors(exception);
 }
 else {
 showMessage("EXCEPTION: " + exception);
 }
}
```
- 3. In the getUserFileNames function, replace TODO 2 with the following code. This will write the list of file names to the document.

```
JavaScript
 try {
 await writeFileNamesToOfficeDocument(fileNameList);
 showMessage("Your data has been added to the document.");
 } catch (error) {
 // The error from writeFileNamesToOfficeDocument will begin 
 // "Unable to add filenames to document."
 showMessage(error);
 }
```
- 4. In the callRESTApi function, replace TODO 3 with the following code. About this code, note:
	- It constructs an authorization header containing the access token. This confirms to the application server that this client code has access permissions to the REST APIs.
	- It request JSON return types, so that all return values are handled in JSON.
	- Any errors are passed to handleServerSideErrors for processing.

```
JavaScript
try {
 let result = await $.ajax({
 url: relativeUrl,
 headers: { "Authorization": "Bearer " + accessToken },
 type: "GET",
 dataType: "json",
 contentType: "application/json; charset=utf-8"
 });
 return result;
} catch (error) {
```


### **Handle SSO errors and application REST API errors**

- 1. In the handleSSOErrors function, replace TODO 4 with the following code. For more information about these errors, see Troubleshoot SSO in Office Add-ins.

```
JavaScript
 switch (error.code) {
 case 13001:
 // No one is signed into Office. If the add-in cannot be
effectively used when no one 
 // is logged into Office, then the first call of
getAccessToken should pass the 
 // `allowSignInPrompt: true` option.
 showMessage("No one is signed into Office. But you can use
many of the add-ins functions anyway. If you want to log in, press the
Get OneDrive File Names button again.");
 break;
 case 13002:
 // The user aborted the consent prompt. If the add-in cannot
be effectively used when consent
 // has not been granted, then the first call of getAccessToken
should pass the `allowConsentPrompt: true` option.
 showMessage("You can use many of the add-ins functions even
though you have not granted consent. If you want to grant consent,
press the Get OneDrive File Names button again.");
 break;
 case 13006:
 // Only seen in Office on the web.
 showMessage("Office on the web is experiencing a problem.
Please sign out of Office, close the browser, and then start again.");
 break;
 case 13008:
 // Only seen in Office on the web.
 showMessage("Office is still working on the last operation.
When it completes, try this operation again.");
 break;
 case 13010:
 // Only seen in Office on the web.
 showMessage("Follow the instructions to change your browser's
zone configuration.");
 break;
 default:
 // For all other errors, including 13000, 13003, 13005, 13007,
13012, and 50001, fall back
 // to non-SSO sign-in by using MSAL authentication.
 showMessage("SSO failed. In these cases you should implement a
falback to MSAL authentication.");
```


}

- 2. In the handleServerSideErrors function, replace TODO 5 with the following code.

```
JavaScript
// Check headers to see if admin has not consented.
const header = errorResponse.getResponseHeader('WWW-Authenticate');
if (header !== null && header.includes('proposedAction=\"consent\"')) {
 showMessage("MSAL ERROR: " + "Admin consent required. Be sure admin
consent is granted on all scopes in the Azure app registration.");
 return;
}
```
- 3. In the handleServerSideErrors function, replace TODO 6 with the following code. About this code, note:
	- In some cases, additional consent is required, such as 2FA. Microsoft identity returns the additional claims that are required to complete consent. This code adds the authChallenge property with the additional claims and calls getUserfileNames again. When getAccessToken is called again with the additional claims, the user gets a prompt for all required forms of authentication.

#### JavaScript

```
// Check if Microsoft Graph requires an additional form of
authentication. Have the Office host 
// get a new token using the Claims string, which tells Microsoft
identity to prompt the user for all 
// required forms of authentication.
const errorDetails = 
JSON.parse(errorResponse.responseJSON.value.details);
if (errorDetails) {
 if (errorDetails.error.message.includes("AADSTS50076")) {
 const claims = errorDetails.message.Claims;
 const claimsAsString = JSON.stringify(claims);
 getUserFileNames({ authChallenge: claimsAsString });
 return;
 }
}
```
- 4. In the handleServerSideErrors function, replace TODO 7 with the following code. About this code, note:


- In the rare case the original SSO token is expired, it will detect this error condition and call getUserFilenames again. This results in another call to getAccessToken which returns a refreshed access token. The retryGetAccessToken variable counts the retries and is currently configured to only retry once.
- Finally, if an error cannot be handled, the default is to display the error in the task pane.

```
JavaScript
// Results from other errors (other than AADSTS50076) will have an
ExceptionMessage property.
const exceptionMessage = 
JSON.parse(errorResponse.responseText).ExceptionMessage;
if (exceptionMessage) {
 // On rare occasions the access token is unexpired when Office
validates it,
 // but expires by the time it is sent to Microsoft identity in the
OBO flow. Microsoft identity will respond
 // with "The provided value for the 'assertion' is not valid. The
assertion has expired."
 // Retry the call of getAccessToken (no more than once). This time
Office will return a 
 // new unexpired access token.
 if ((exceptionMessage.includes("AADSTS500133"))
 && (retryGetAccessToken <= 0)) {
 retryGetAccessToken++;
 getUserFileNames();
 return;
 }
 else {
 showMessage("MSAL error from application server: " + 
JSON.stringify(exceptionMessage));
 return;
 }
}
// Default error handling if previous checks didn't apply.
showMessage(errorResponse.responseJSON.value);
```
- 5. Save the file.
### **Code the server side**

The server-side code is an ASP.NET Core server that provides REST APIs for the client to call. For example, the REST API /api/files gets a list of filenames from the user's OneDrive folder. Each REST API call requires an access token by the client to ensure the correct client is accessing their data. The access token is exchanged for a Microsoft


Graph token through the On-Behalf-Of flow (OBO). The new Microsoft Graph token is cached by the MSAL.NET library for subsequent API calls. It's never sent outside of the server-side code. Microsoft identity documentation refers to this server as the middletier server because it is in the middle of the flow from client-side code to Microsoft services. For more information, see [Middle-tier access token request](https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow#middle-tier-access-token-request)

### **Configure Microsoft Graph and OBO flow**

- 1. Open the Program.cs file and replace TODO 8 with the following code. About this code, note:
	- It adds required services to handle token validation that is required for the REST APIs.
	- It adds Microsoft Graph and OBO flow support in the call to EnableTokenAcquisitionToCallDownstreamApi().AddMicrosoftGraph(...) . The OBO flow is handled automatically for you, and the Microsoft Graph SDK is provided to your REST API controllers.
	- The **DownstreamApi** configuration is specified in the **appsettings.json** file.

```
C#
// Add services to the container.
builder.Services.AddMicrosoftIdentityWebApiAuthentication(builder.Confi
guration)
 .EnableTokenAcquisitionToCallDownstreamApi()

.AddMicrosoftGraph(builder.Configuration.GetSection("DownstreamApi"))
 .AddInMemoryTokenCaches();
```
### **Create the /api/filenames REST API**

- 1. In the **Controllers** folder, open the **FilesController.cs** file. replace TODO 9 with the following code. About this code, note:
	- It specifies the [Authorize] attribute to ensure the access token is validated for each call to any REST APIs in the FilesController class. For more information, see [Validating tokens.](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens#validating-tokens)
	- It specifies the [RequiredScope("access_as_user")] attribute to ensure the client has the correct **access_as_user** scope in the access token.
	- The constructor initializes the _graphServiceClient object to make calling Microsoft Graph REST APIs easier.


```
C#
[Authorize]
[Route("api/[controller]")]
[RequiredScope("access_as_user")]
public class FilesController : Controller
{ 
 public FilesController(ITokenAcquisition tokenAcquisition,
GraphServiceClient graphServiceClient, IOptions<MicrosoftGraphOptions>
graphOptions)
 {
 _tokenAcquisition = tokenAcquisition;
 _graphServiceClient = graphServiceClient;
 _graphOptions = graphOptions;
 }
 private readonly ITokenAcquisition _tokenAcquisition;
 private readonly GraphServiceClient _graphServiceClient;
 private readonly IOptions<MicrosoftGraphOptions> _graphOptions;
 // TODO 10: Add the REST API to get filenames.
}
```
2. Replace TODO 10 with the following code. About this code, note:

- It creates the /api/files REST API.
C#

- It handles exceptions from MSAL through MsalException class.
- It handles exceptions from Microsoft Graph API calls through the ServiceException class.

```
// GET api/files
 [HttpGet]
 [Produces("application/json")]
 public async Task<IActionResult> Get()
 {
 List<DriveItem> result = new List<DriveItem>();
 try
 {
 var files = await
_graphServiceClient.Me.Drive.Root.Children.Request()
 .Top(10)
 .Select(m => new { m.Name })
 .GetAsync();
 result = files.ToList();
 }
 catch (MsalException ex)
```


```
 {
 var errorResponse = new
 {
 message = "An authentication error occurred while
acquiring a token for downstream API",
 details = ex.Message
 };
 return StatusCode((int)HttpStatusCode.Unauthorized,
Json(errorResponse));
 }
 catch (ServiceException ex)
 {
 if (ex.InnerException is
MicrosoftIdentityWebChallengeUserException challengeException)
 {

_tokenAcquisition.ReplyForbiddenWithWwwAuthenticateHeader(_graphOptions
.Value.Scopes.Split(' '),
 challengeException.MsalUiRequiredException);
 }
 else
 {
 var errorResponse = new
 {
 message = "An error occurred calling Microsoft
Graph",
 details = ex.RawResponseBody
 };
 return StatusCode((int)HttpStatusCode.BadRequest,
Json(errorResponse));
 }
 }
 catch (Exception ex)
 {
 var errorResponse = new
 {
 message = "An error occurred while calling the
downstream API",
 details = ex.Message
 };
 return StatusCode((int)HttpStatusCode.BadRequest,
Json(errorResponse));
 }
 return Json(result);
 }
```
### **Run the solution**

- 1. In Visual Studio, on the **Build** menu, select **Clean Solution**. When it finishes, open the **Build** menu again and select **Build Solution**.


- 2. In **Solution Explorer**, select the **Office-Add-in-ASPNET-SSO-manifest** project node.
- 3. In the **Properties** pane, open the **Start Document** drop down and choose one of the three options (Excel, Word, or PowerPoint).

|                                                      | Properties     |  |                               |  |  |  |
|------------------------------------------------------|----------------|--|-------------------------------|--|--|--|
| Office-Add-in-ASPNET-SSO-manifest Project Properties |                |  |                               |  |  |  |
|                                                      |                |  |                               |  |  |  |
| Add-in                                               |                |  |                               |  |  |  |
|                                                      | Start Action   |  | Office Desktop Client         |  |  |  |
|                                                      | Start Document |  | [New Excel Workbook]          |  |  |  |
|                                                      | Web Project    |  | [New Excel Workbook]          |  |  |  |
|                                                      | E Misc         |  | [New Word Document]           |  |  |  |
|                                                      | Project File   |  | [New PowerPoint Presentation] |  |  |  |
|                                                      | Project Folder |  |                               |  |  |  |

- 4. Press F5 . Or select **Debug** > **Start Debugging**.
- 5. In the Office application, select the **Show Add-in** in the **SSO ASP.NET** group to open the task pane add-in.
- 6. Select **Get OneDrive File Names**. If you're logged into Office with either a Microsoft 365 Education or work account, or a Microsoft account, and SSO is working as expected, the first 10 file and folder names in your OneDrive for Business are displayed on the task pane. If you are not logged in, or you are in a scenario that does not support SSO, or SSO is not working for any reason, you will be prompted to sign in. After you sign in, the file and folder names appear.

## **Deploy the add-in**

When you're ready to deploy to a staging or production server, be sure to update the following areas in the project solution.

- In the **appsettings.json** file, change the **domain** to your staging or production domain name.
- Update any references to localhost:7080 throughout your project to use your staging or production URL.
- Update any references to localhost:7080 in your Azure App registration, or create a new registration for use in staging or production.


For more information, see [Host and deploy ASP.NET Core](https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/).

## **See also**

- Create a Node.js Office Add-in that uses single sign-on.
- Authorize to Microsoft Graph with SSO.


# **Create a Node.js Office Add-in that uses single sign-on**

Article • 05/20/2023

Users can sign in to Office, and your Office Web Add-in can take advantage of this signin process to authorize users to your add-in and to Microsoft Graph without requiring users to sign in a second time. For an overview, see Enable SSO in an Office Add-in.

This article walks you through the process of enabling single sign-on (SSO) in an add-in. The sample add-in you create has two parts; a task pane that loads in Microsoft Excel, and a middle-tier server that handles calls to Microsoft Graph for the task pane. The middle-tier server is built with Node.js and Express and exposes a single REST API, /getuserfilenames , that returns a list of the first 10 file names in the user's OneDrive folder. The task pane uses the getAccessToken() method to get an access token for the signed in user to the middle-tier server. The middle-tier server uses the On-Behalf-Of flow (OBO) to exchange the access token for a new one with access to Microsoft Graph. You can extend this pattern to access any Microsoft Graph data. The task pane always calls a middle-tier REST API (passing the access token) when it needs Microsoft Graph services. The middle-tier uses the token obtained via OBO to call Microsoft Graph services and return the results to the task pane.

This article works with an add-in that uses Node.js and Express. For a similar article about an ASP.NET-based add-in, see Create an ASP.NET Office Add-in that uses single sign-on.

## **Prerequisites**

- [Node.js](https://nodejs.org/) (the latest [LTS](https://nodejs.org/en/about/previous-releases) version)
- [Git Bash](https://git-scm.com/downloads) (or another git client)
- A code editor we recommend Visual Studio Code
- At least a few files and folders stored on OneDrive for Business in your Microsoft 365 subscription
- A build of Microsoft 365 that supports the [IdentityAPI 1.3 requirement set.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/identity-api-requirement-sets) You might qualify for a Microsoft 365 E5 developer subscription, which includes a developer sandbox, through the [Microsoft 365 Developer Program](https://aka.ms/m365devprogram) ; for details, see the [FAQ](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-). The [developer sandbox](https://developer.microsoft.com/microsoft-365/dev-program#Subscription) includes a Microsoft Azure subscription that you can use for app registrations in later steps in this article. If you prefer, you can


use a separate Microsoft Azure subscription for app registrations. Get a trial subscription at [Microsoft Azure](https://account.windowsazure.com/SignUp) .

## **Set up the starter project**

- 1. Clone or download the repo at [Office Add-in NodeJS SSO](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-NodeJS-SSO) .
#### 7 **Note**

There are two versions of the sample:

- The **Begin** folder is a starter project. The UI and other aspects of the add-in that are not directly connected to SSO or authorization are already done. Later sections of this article walk you through the process of completing it.
- The **Complete** folder contains the same sample with all coding steps from this article completed. To use the completed version, just follow the instructions in this article, but replace "Begin" with "Complete" and skip the sections **Code the client side** and **Code the middle-tier server** side.
- 2. Open a command prompt in the **Begin** folder.
- 3. Enter npm install in the console to install all of the dependencies itemized in the package.json file.
- 4. Run the command npm run install-dev-certs . Select **Yes** to the prompt to install the certificate.

Use the following values for placeholders for the subsequent app registration steps.

ノ **Expand table**

| Placeholder                                                 | Value                       |
|-------------------------------------------------------------|-----------------------------|
| <add-in-name></add-in-name>                                 | Office-Add-in-NodeJS-SSO    |
| <fully-qualified-domain-name></fully-qualified-domain-name> | localhost:3000              |
| Microsoft Graph permissions                                 | profile, openid, Files.Read |


## **Register the add-in with Microsoft identity platform**

You need to create an app registration in Azure that represents your web server. This enables authentication support so that proper access tokens can be issued to the client code in JavaScript. This registration supports both SSO in the client, and fallback authentication using the Microsoft Authentication Library (MSAL).

- 1. Sign in to the [Azure portal](https://portal.azure.com/) with the *admin* credentials to your Microsoft 365 tenancy. For example, **MyName@contoso.onmicrosoft.com**.
- 2. Select **App registrations**. If you don't see the icon, search for "app registration" in the search bar.

The **App registrations** page appears.

- 3. Select **New registration**.


| ==<br>Microsoft Azure                                                    | Search resources, services, and docs (G+/)                                                                                                                                                                                         |   |
|--------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---|
| Home >                                                                   |                                                                                                                                                                                                                                    |   |
| App registrations<br>2                                                   |                                                                                                                                                                                                                                    | × |
| ti<br>New registration<br>6                                              | Endpoints & Troubleshooting () Refresh & Download<br>@ Preview features<br>Got feedback?<br>Starting June 30th, 2020 we will no longer add any netive Directory Authertication Library (ADAL) and Azure AD Graph. We will continue |   |
| Authentication Library (MSAL) and Microsoft Graph.  Learn more           | to provide technical support and security updates but we will no longer provide feature will need to be upgraded to Microsoft                                                                                                      |   |
| All applications<br>Owned applications                                   | Deleted applications                                                                                                                                                                                                               |   |
| Start typing a display name or application (client) ID to filter these r | Add filters                                                                                                                                                                                                                        |   |

The **Register an application** page appears.

- 4. On the **Register an application** page, set the values as follows.
	- Set **Name** to <add-in-name> .
	- Set **Supported account types** to **Accounts in any organizational directory (any Azure AD directory - multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)**.
	- Set **Redirect URI** to use the platform **Single-page application (SPA)** and the URI to https://<fully-qualified-domain-name>/dialog.html .


| Register an application<br>×<br>contoso-office-add-in-sso<br>Who can use this application or access this API?<br>Accounts in this organizational directory only (Contoso only - Single tenant)<br>Accounts in any organizational directory (Any Azure AD directory - Multitenant)<br>Accounts in any orqanizational directory (Any Azure AD directory - Multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)<br>Personal Microsoft accounts only<br>Redirect URI (optional)<br>We'll return the authentication response to this URI after successfully authenticating the user. Providing this now is optional and it can be<br>changed later, but a value is required for most authentication scenarios.<br>Single-page application (SPA)<br>https://localhost:44355/dialog.html<br>Register an app you're working on here. Integrate gallery apps from outside your organization by adding from Enterprise applications.<br>By proceeding, you agree to the Microsoft Platform Policies ra<br>Register | ==<br>Microsoft Azure                                                          | Search resources, services, and docs (G+/) |  |  |  |  |  |  |  |  |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------|--------------------------------------------|--|--|--|--|--|--|--|--|
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Home > App registrations >                                                     |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | * Name                                                                         |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | The user-facing display name for this application (this can be changed later). |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Supported account types                                                        |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | Help me choose                                                                 |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |
|                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                |                                            |  |  |  |  |  |  |  |  |

- 5. Select **Register**. A message is displayed stating that the application registration was created.
- 6. Copy and save the values for the **Application (client) ID** and the **Directory (tenant) ID**. You'll use both of them in later procedures.


## **Add a client secret**

Sometimes called an *application password*, a client secret is a string value your app can use in place of a certificate to identity itself.

- 1. From the left pane, select **Certificates & secrets**. Then on the **Client secrets** tab, select **New client secret**.

| =<br>Microsoft Azure                                                                                                                                                                        |    | Search resources, services, and docs (G+/)                                                                                                                                                                                                                                                  |                                                                                                                                       |           | >- | 13 |  | 803 | 2         | a | NestorW@M365x63284<br>CONTOSO (M365X63284053.ON |   |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------|-----------|----|----|--|-----|-----------|---|-------------------------------------------------|---|
| Home > App registrations > contoso-office-add-in-sso                                                                                                                                        |    | contoso-office-add-in-sso   Certificates & secrets                                                                                                                                                                                                                                          | ಸಿ                                                                                                                                    |           |    |    |  |     |           |   |                                                 | × |
| Search<br>Overview<br>用<br>Quickstart<br>Integration assistant                                                                                                                              | << | ਕੇ<br>Got feedback?<br>Credentials enable confidential applications to identication service when receiving tokens at a web addressable location (using an HTTPS<br>scheme). For a higher level of assurance, we recommend using a certificate (instead of a client secret) as a credential. |                                                                                                                                       |           |    |    |  |     |           |   |                                                 |   |
| Manage<br>Branding & properties<br>17<br>ଦି<br>Authentication<br>Certificates & secrets<br>Token configuration                                                                              |    | Certificates (0)<br>Client secrets (0)<br>A secret string that the application uses to prove its identity when requesting a token. Also can be referred to as application password.<br>- New client secret                                                                                  | Application registration certificates, secrets and federated credentials can be found in the tabs below.<br>Federated credentials (0) |           |    |    |  |     |           |   |                                                 | × |
| API permissions<br>Expose an API<br>App roles<br>Owners<br>્<br>Roles and administrators<br>P<br>o   Manifest<br>Support + Troubleshooting<br>్రా<br>Troubleshooting<br>New support request |    | Description<br>No client secrets have been created for this application.                                                                                                                                                                                                                    | Expires                                                                                                                               | Value (1) |    |    |  |     | Secret ID |   |                                                 |   |

The **Add a client secret** pane appears.

- 2. Add a description for your client secret.
- 3. Select an expiration for the secret or specify a custom lifetime.
	- Client secret lifetime is limited to two years (24 months) or less. You can't specify a custom lifetime longer than 24 months.


- Microsoft recommends that you set an expiration value of less than 12 months.

| Add a client secret |                       | X |
|---------------------|-----------------------|---|
| Description         | Contoso app secret    |   |
| Expires             | Recommended: 6 months |   |

- 4. Select **Add**. The new secret is created and the value is temporarily displayed.
#### ) **Important**

*Record the secret's value* for use in your client application code. This secret value is *never displayed again* after you leave this pane.

### **Expose a web API**

- 1. From the left pane, select **Expose an API**.
The **Expose an API** pane appears.

| Microsoft Azure<br>=                                 |    | Search resources, services, and docs (G+/)                                                                                                                                                                            |                 | >--                  |  |  |  | 2 | a                    | NestorW@M365x63284.<br>CONTOSO (M365X63284053.ON |   |
|------------------------------------------------------|----|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------|----------------------|--|--|--|---|----------------------|--------------------------------------------------|---|
| Home > App registrations > contoso-office-add-in-sso |    |                                                                                                                                                                                                                       |                 |                      |  |  |  |   |                      |                                                  |   |
|                                                      |    | contoso-office-add-in-sso   Expose an API                                                                                                                                                                             | 2               |                      |  |  |  |   |                      |                                                  | × |
| Search                                               | << | િંત્વે<br>Got feedback?                                                                                                                                                                                               |                 |                      |  |  |  |   |                      |                                                  |   |
| Overview<br>B<br>Quickstart<br>ಳಿ                    |    | Application ID URI ① Set                                                                                                                                                                                              |                 |                      |  |  |  |   |                      |                                                  |   |
| Integration assistant                                |    | Scopes defined by this API                                                                                                                                                                                            |                 |                      |  |  |  |   |                      |                                                  |   |
| Manage                                               |    | Define custom scopes to restrict access to data and functionality protected by the API. An application that requires access to parts of this<br>API can request that a user or admin consent to one or more of these. |                 |                      |  |  |  |   |                      |                                                  |   |
| Branding & properties<br>12<br>Authentication<br>ନ   |    | Adding a scope here creates only delegated permissions of you are looking to create application-only scopes, as "App roles assignable to<br>application type. Go to App roles.                                        |                 |                      |  |  |  |   |                      |                                                  |   |
| Certificates & secrets                               |    | -- Add a scope                                                                                                                                                                                                        |                 |                      |  |  |  |   |                      |                                                  |   |
| Token confiquration                                  |    | Scopes                                                                                                                                                                                                                | Who can consent | Admin consent displa |  |  |  |   | User consent display | State                                            |   |
| API permissions<br>p                                 |    | No scopes have been defined                                                                                                                                                                                           |                 |                      |  |  |  |   |                      |                                                  |   |
| Expose an API<br>600<br>App roles                    |    | Authorized client applications                                                                                                                                                                                        |                 |                      |  |  |  |   |                      |                                                  |   |
| Owners<br>Roles and administrators<br>f              |    | Authorizing a client application indicates that this API trusts the application and users should not be client calls<br>this API.                                                                                     |                 |                      |  |  |  |   |                      |                                                  |   |
| 0 Manifest                                           |    |                                                                                                                                                                                                                       |                 |                      |  |  |  |   |                      |                                                  |   |
| Support + Troubleshooting                            |    | 十 Add a client application                                                                                                                                                                                            |                 |                      |  |  |  |   |                      |                                                  |   |
| Troubleshooting<br>New support request<br>ರ್         |    | Client Id<br>No client applications have been authorized                                                                                                                                                              | Scopes          |                      |  |  |  |   |                      |                                                  |   |
|                                                      |    |                                                                                                                                                                                                                       |                 |                      |  |  |  |   |                      |                                                  |   |

- 2. Select **Set** to generate an application ID URI.


| ==<br>Microsoft Azure                                 | Search resources, services, and docs (G+/)                                                                                                                                                                            | >_                   |  |  |                      | NestorW@M365x63284<br>CONTOSO (M365X63284053.ON |   |
|-------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------|--|--|----------------------|-------------------------------------------------|---|
| Home > App registrations > contoso-office-add-in-sso  |                                                                                                                                                                                                                       |                      |  |  |                      |                                                 |   |
|                                                       | contoso-office-add-in-sso   Expose an API<br>な                                                                                                                                                                        |                      |  |  |                      |                                                 | × |
| Search<br><<                                          | ్రార్ల<br>Got feedback?                                                                                                                                                                                               |                      |  |  |                      |                                                 |   |
| 曝 Overview<br>Quickstart                              | Application ID URI (1)                                                                                                                                                                                                |                      |  |  |                      |                                                 |   |
| ನ್<br>Integration assistant                           | Scopes defined by this API                                                                                                                                                                                            |                      |  |  |                      |                                                 |   |
| Manage                                                | Define custom scopes to restrict access to data and functionality protected by the API. An application that requires access to parts of this<br>API can request that a user or admin consent to one or more of these. |                      |  |  |                      |                                                 |   |
| Branding & properties<br>ព្រៃ<br>ଦି<br>Authentication | Adding a scope here creates only delegated permissions of you are looking to create application-only scopes, as "App roles assignable to<br>application type. Go to App roles.                                        |                      |  |  |                      |                                                 |   |
| Certificates & secrets                                | -- Add a scope                                                                                                                                                                                                        |                      |  |  |                      |                                                 |   |
| Token confiquration                                   | Scopes<br>Who can consent                                                                                                                                                                                             | Admin consent displa |  |  | User consent display | State                                           |   |
| API permissions<br>φ                                  | No scopes have been defined                                                                                                                                                                                           |                      |  |  |                      |                                                 |   |
| Expose an API                                         |                                                                                                                                                                                                                       |                      |  |  |                      |                                                 |   |
| App roles                                             | Authorized client applications                                                                                                                                                                                        |                      |  |  |                      |                                                 |   |
| Owners                                                | Authorizing a client application indicates that this API trusts the application and users should not be client calls                                                                                                  |                      |  |  |                      |                                                 |   |
| Roles and administrators<br>100                       | this API.                                                                                                                                                                                                             |                      |  |  |                      |                                                 |   |
| 0 Manifest                                            |                                                                                                                                                                                                                       |                      |  |  |                      |                                                 |   |
| Support + Troubleshooting                             | Add a client application<br>--                                                                                                                                                                                        |                      |  |  |                      |                                                 |   |
| হ্য<br>Troubleshooting                                | Client Id<br>Scopes                                                                                                                                                                                                   |                      |  |  |                      |                                                 |   |
| New support request                                   | No client applications have been authorized                                                                                                                                                                           |                      |  |  |                      |                                                 |   |

The section for setting the application ID URI appears with a generated Application ID URI in the form api://<app-id> .

- 3. Update the application ID URI to api://<fully-qualified-domain-name>/<app-id> .

| Edit the App ID URI                                        |
|------------------------------------------------------------|
| Application ID URI                                         |
| api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69 |
| Discard<br>Save                                            |

- The **Application ID URI** is pre-filled with app ID (GUID) in the format api://<app-id> .
- The application ID URI format should be: api://<fully-qualified-domainname>/<app-id>
- Insert the fully-qualified-domain-name between api:// and <app-id> (which is a GUID). For example, api://contoso.com/<app-id> .
- If you're using localhost, then the format should be api://localhost: <port>/<app-id> . For example, api://localhost:3000/c6c1f32b-5e55-4997- 881a-753cc1d563b7 .

For additional application ID URI details, see [Application manifest identifierUris](https://learn.microsoft.com/en-us/azure/active-directory/develop/reference-app-manifest#identifieruris-attribute) [attribute.](https://learn.microsoft.com/en-us/azure/active-directory/develop/reference-app-manifest#identifieruris-attribute)

7 **Note**


If you get an error saying that the domain is already owned but you own it, follow the procedure at **[Quickstart: Add a custom domain name to Azure](https://learn.microsoft.com/en-us/azure/active-directory/add-custom-domain) [Active Directory](https://learn.microsoft.com/en-us/azure/active-directory/add-custom-domain)** to register it, and then repeat this step. (This error can also occur if you are not signed in with credentials of an admin in the Microsoft 365 tenancy. See step 2. Sign out and sign in again with admin credentials and repeat the process from step 3.)

### **Add a scope**

- 1. On the **Expose an API** page, select **Add a scope**.

| Microsoft Azure<br>=                                 |    | Search resources, services, and docs (G+/)                            |  |   |                                                                                                                                              |  | >-                   |  |  |  | 2 | ಡಿ                   | NestorW@M365x63284<br>CONTOSO (M365X63284053.ON |       |   |
|------------------------------------------------------|----|-----------------------------------------------------------------------|--|---|----------------------------------------------------------------------------------------------------------------------------------------------|--|----------------------|--|--|--|---|----------------------|-------------------------------------------------|-------|---|
| Home > App registrations > contoso-office-add-in-sso |    |                                                                       |  |   |                                                                                                                                              |  |                      |  |  |  |   |                      |                                                 |       |   |
| contoso-office-add-in-sso   Expose an API            |    |                                                                       |  | 2 |                                                                                                                                              |  |                      |  |  |  |   |                      |                                                 |       | × |
| P Search<br>Overview<br>सर                           | << | ದ್ದಾರೆ.<br>Got feedback?                                              |  |   |                                                                                                                                              |  |                      |  |  |  |   |                      |                                                 |       |   |
| Quickstart                                           |    | Application ID URI                                                    |  |   | api://localhost:3000/cfe719d7-aef3-4108-83a8-a8283f139a69                                                                                    |  |                      |  |  |  |   |                      |                                                 | ■ △ 向 |   |
| Integration assistant                                |    | Scopes defined by this API                                            |  |   |                                                                                                                                              |  |                      |  |  |  |   |                      |                                                 |       |   |
| Manage                                               |    |                                                                       |  |   | Define custom scopes to restrict access to data and functionality protected by the API. An application that requires access to parts of this |  |                      |  |  |  |   |                      |                                                 |       |   |
| Branding & properties<br>1                           |    | API can request that a user or admin consent to one or more of these. |  |   |                                                                                                                                              |  |                      |  |  |  |   |                      |                                                 |       |   |
| Authentication<br>ନ                                  |    | application type. Go to App roles.                                    |  |   | Adding a scope here creates only delegated permissions of create application-only scopes, use "App roles" and define app roles assignable to |  |                      |  |  |  |   |                      |                                                 |       |   |
| Certificates & secrets                               |    |                                                                       |  |   |                                                                                                                                              |  |                      |  |  |  |   |                      |                                                 |       |   |
| Token confiquration                                  |    | Add a scope                                                           |  |   |                                                                                                                                              |  |                      |  |  |  |   |                      |                                                 |       |   |
| API permissions<br>Ф                                 |    | Scopes                                                                |  |   | Who can consent                                                                                                                              |  | Admin consent displa |  |  |  |   | User consent display | State                                           |       |   |
| Expose an API                                        |    | No scopes have been defined                                           |  |   |                                                                                                                                              |  |                      |  |  |  |   |                      |                                                 |       |   |
| #<br>App roles                                       |    |                                                                       |  |   |                                                                                                                                              |  |                      |  |  |  |   |                      |                                                 |       |   |
| Owners                                               |    | Authorized client applications                                        |  |   |                                                                                                                                              |  |                      |  |  |  |   |                      |                                                 |       |   |
| Roles and administrators<br>8                        |    | this API.                                                             |  |   | Authorizing a client application indicates that this API trusts the application and users should not be dient calls                          |  |                      |  |  |  |   |                      |                                                 |       |   |
| 0 Manifest                                           |    |                                                                       |  |   |                                                                                                                                              |  |                      |  |  |  |   |                      |                                                 |       |   |
| Support + Troubleshooting                            |    | Add a client application<br>-                                         |  |   |                                                                                                                                              |  |                      |  |  |  |   |                      |                                                 |       |   |
| Troubleshooting<br>19                                |    | Client Id                                                             |  |   | Scopes                                                                                                                                       |  |                      |  |  |  |   |                      |                                                 |       |   |
| New support request<br>್                             |    | No client applications have been authorized                           |  |   |                                                                                                                                              |  |                      |  |  |  |   |                      |                                                 |       |   |
|                                                      |    |                                                                       |  |   |                                                                                                                                              |  |                      |  |  |  |   |                      |                                                 |       |   |

The **Add a scope** pane opens.

- 2. In the **Add a scope** pane, specify the scope's attributes. The following table shows example values for and Outlook add-in requiring the profile , openid , Files.ReadWrite , and Mail.Read permissions. Modify the text to match the
permissions your add-in needs.

ノ **Expand table**

| Field      | Description                                                                                       | Values                                          |  |  |  |  |  |
|------------|---------------------------------------------------------------------------------------------------|-------------------------------------------------|--|--|--|--|--|
| Scope name | The name of your scope. A common<br>scope naming convention is<br>resource.operation.constraint . | For SSO this must be set to<br>access_as_user . |  |  |  |  |  |


| Field                               | Description                                                                                                                                      | Values                                                                                                                                                                      |  |  |  |  |
|-------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|--|--|
| Who can<br>consent                  | Determines if admin consent is required<br>or if users can consent without an admin<br>approval.                                                 | For learning SSO and samples,<br>we recommend you set this to<br>Admins and users.                                                                                          |  |  |  |  |
|                                     |                                                                                                                                                  | Select Admins only for higher<br>privileged permissions.                                                                                                                    |  |  |  |  |
| Admin<br>consent<br>display<br>name | A short description of the scope's purpose<br>visible to admins only.                                                                            | Read/write permissions to<br>user files. Read permissions<br>to user mail and profiles.                                                                                     |  |  |  |  |
| Admin<br>consent<br>description     | A more detailed description of the<br>permission granted by the scope that only<br>admins see.                                                   | Allow Office to have<br>read/write permissions to all<br>user files and read<br>permissions to all user mail.<br>Office can call the app's web<br>APIs as the current user. |  |  |  |  |
| User<br>consent<br>display<br>name  | A short description of the scope's<br>purpose. Shown to users only if you set<br>Who can consent to Admins and users.                            | Read/write permissions to<br>your files. Read permissions<br>to your mail and profile.                                                                                      |  |  |  |  |
| User<br>consent<br>description      | A more detailed description of the<br>permission granted by the scope. Shown<br>to users only if you set Who can consent<br>to Admins and users. | Allow Office to have<br>read/write permissions to<br>your files, and read<br>permissions to your mail and<br>profile.                                                       |  |  |  |  |

3. Set the **State** to **Enabled**, and then select **Add scope**.


| Add a scope                                                                                                                                                     |  |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|--|
| Scope name * (1                                                                                                                                                 |  |
| access_as_user                                                                                                                                                  |  |
| api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69/access_as_user                                                                                       |  |
| Who can consent? (1)                                                                                                                                            |  |
| Admins and users<br>Admins only                                                                                                                                 |  |
| Admin consent display name * (1                                                                                                                                 |  |
| Read/write permissions to user files. Read permissions to user mail and profiles.                                                                               |  |
| Admin consent description * (1                                                                                                                                  |  |
| Allow Office to have read/write permissions to all user files and read permissions to all<br>user mail. Office can call the app's web APIs as the current user. |  |
| User consent display name (1                                                                                                                                    |  |
| Read/write permissions to your files. Read permissions to your mail and profile.                                                                                |  |
| User consent description (1                                                                                                                                     |  |
| Allow Office to have read/write permissions to your files, and read permissions to your mail<br>and profile.                                                    |  |
| tate (i)<br>Disabled<br>Enabled                                                                                                                                 |  |
|                                                                                                                                                                 |  |

The new scope you defined displays on the pane.


|  | Microsoft Azure                                      | Q  | Search resources, services, and docs (G+/) |                                                                                                                                                                                                                      |   |                                                                                                                     | >-                   |  |  |  |                                                           | NestorW@M365x63284. | CONTOSO |
|--|------------------------------------------------------|----|--------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---|---------------------------------------------------------------------------------------------------------------------|----------------------|--|--|--|-----------------------------------------------------------|---------------------|---------|
|  | Home > App registrations > contoso-office-add-in-sso |    |                                            |                                                                                                                                                                                                                      |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  | contoso-office-add-in-sso   Expose an API            |    |                                            |                                                                                                                                                                                                                      | 2 |                                                                                                                     |                      |  |  |  |                                                           |                     | ×       |
|  | P Search                                             | << | Got feedback?                              |                                                                                                                                                                                                                      |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  | 号 Overview                                           |    |                                            |                                                                                                                                                                                                                      |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  | Quickstart                                           |    |                                            | Got a second to give us some feedback? >                                                                                                                                                                             |   |                                                                                                                     |                      |  |  |  |                                                           |                     | ×       |
|  | Integration assistant                                |    |                                            |                                                                                                                                                                                                                      |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  | Manage                                               |    | Application ID URI                         |                                                                                                                                                                                                                      |   | api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69                                                          |                      |  |  |  |                                                           |                     | 0 / 向   |
|  | Branding & properties                                |    |                                            |                                                                                                                                                                                                                      |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  | ூ Authentication                                     |    | Scopes defined by this API                 |                                                                                                                                                                                                                      |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  | Certificates & secrets                               |    |                                            | Define custom scopes to restrict access to data and functionality protected by the API. An application that regures access to parts of this<br>API can request that a user or admin consent to one or more of these. |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  | Token configuration                                  |    |                                            | Adding a scope here creates only delegated permissions of you are locking to create application-only scopes, use 'App roles assignable to                                                                            |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  | API permissions                                      |    | application type. Go to App roles.         |                                                                                                                                                                                                                      |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  | Expose an API                                        |    | — Add a scope                              |                                                                                                                                                                                                                      |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  | App roles                                            |    | Scopes                                     |                                                                                                                                                                                                                      |   | Who can consent                                                                                                     | Admin consent displa |  |  |  | User consent display                                      | State               |         |
|  | Owners                                               |    |                                            | api://localhost:44355/cfe719d7-aef3-4108-83a8-a8-                                                                                                                                                                    |   | Admins and users                                                                                                    |                      |  |  |  | Read/write permissions t Read/write permissions t Enabled |                     |         |
|  | Roles and administrators                             |    |                                            |                                                                                                                                                                                                                      |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  | o Manifest                                           |    | Authorized client applications             |                                                                                                                                                                                                                      |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  | Support + Troubleshooting                            |    | this API.                                  |                                                                                                                                                                                                                      |   | Authorizing a client application indicates that this API trusts the application and users should not be dient calls |                      |  |  |  |                                                           |                     |         |
|  | ് Troubleshooting                                    |    |                                            |                                                                                                                                                                                                                      |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  | New support request                                  |    | + Add a client application                 |                                                                                                                                                                                                                      |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  |                                                      |    | Client Id                                  |                                                                                                                                                                                                                      |   | Scopes                                                                                                              |                      |  |  |  |                                                           |                     |         |
|  |                                                      |    |                                            | No client applications have been authorized                                                                                                                                                                          |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |
|  |                                                      |    |                                            |                                                                                                                                                                                                                      |   |                                                                                                                     |                      |  |  |  |                                                           |                     |         |

The domain part of the **Scope name** displayed just below the text field should automatically match the **Application ID URI** set in the previous step, with /access_as_user appended to the end; for example,

api://localhost:6789/c6c1f32b-5e55-4997-881a-753cc1d563b7/access_as_user .

- 4. Select **Add a client application**.

| Microsoft Azure                                                                                                                                                                                      | NestorW@M365x63284.<br>>_<br>C<br>0<br>Search resources, services, and docs (G+/)<br>CONTOSO                                                                                                                                                        |  |  |  |  |  |  |  |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|--|--|--|--|--|
| Home > App registrations > contoso-office-add-in-sso                                                                                                                                                 |                                                                                                                                                                                                                                                     |  |  |  |  |  |  |  |
|                                                                                                                                                                                                      | contoso-office-add-in-sso   Expose an API<br>2<br>×                                                                                                                                                                                                 |  |  |  |  |  |  |  |
| 0<br>Search                                                                                                                                                                                          | Got feedback?<br>ਕੇ<br><<                                                                                                                                                                                                                           |  |  |  |  |  |  |  |
| は<br>Overview                                                                                                                                                                                        |                                                                                                                                                                                                                                                     |  |  |  |  |  |  |  |
| Quickstart                                                                                                                                                                                           | ×                                                                                                                                                                                                                                                   |  |  |  |  |  |  |  |
| ತೆ                                                                                                                                                                                                   | Got a second to give us some feedback? >>                                                                                                                                                                                                           |  |  |  |  |  |  |  |
| Integration assistant<br>28                                                                                                                                                                          |                                                                                                                                                                                                                                                     |  |  |  |  |  |  |  |
| Manage                                                                                                                                                                                               | api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69<br>△前<br>Application ID URI                                                                                                                                                              |  |  |  |  |  |  |  |
| Branding & properties<br>12<br>ନ<br>Authentication<br>Certificates & secrets                                                                                                                         | Scopes defined by this API<br>Define custom scopes to restrict access to data and functionality protected by the API. An application that requires access to parts of this<br>API can request that a user or admin consent to one or more of these. |  |  |  |  |  |  |  |
| Token configuration<br>Adding a scope here creates only delegated permission of you are looking to create application-only scopes, as "App roles assignable to<br>application type. Go to App roles. |                                                                                                                                                                                                                                                     |  |  |  |  |  |  |  |
| API permissions                                                                                                                                                                                      |                                                                                                                                                                                                                                                     |  |  |  |  |  |  |  |
| Expose an API                                                                                                                                                                                        | — Add a scope                                                                                                                                                                                                                                       |  |  |  |  |  |  |  |
| App roles                                                                                                                                                                                            | Admin consent displa<br>Scopes<br>Who can consent<br>User consent display<br>State                                                                                                                                                                  |  |  |  |  |  |  |  |
| Owners                                                                                                                                                                                               | Admins and users<br>Read/write permissions t Read/write permissions t Enabled<br>api://localhost:44355/cfe719d7-aef3-4108-83a8-a8-                                                                                                                  |  |  |  |  |  |  |  |
| Roles and administrators<br>ﻦ<br>o Manifest<br>Support + Troubleshooting<br>્<br>Troubleshooting<br>New support request<br>ర్య                                                                       | Authorized client applications<br>Authorizing a client application indicates that this API trusts the application and users should not be dient calls<br>this API.<br>Add a client application<br>Client Id<br>Scopes                               |  |  |  |  |  |  |  |
|                                                                                                                                                                                                      | No client applications have been authorized                                                                                                                                                                                                         |  |  |  |  |  |  |  |


The **Add a client application** pane appears.

- 5. In the **Client ID** enter ea5a67f6-b6f3-4338-b240-c655ddc3cc8e . This value preauthorizes all Microsoft Office application endpoints. If you also want to preauthorize Office when used inside of Microsoft Teams, add 1fec8e78-bce4-4aafab1b-5451cc387264 (Microsoft Teams desktop and Teams mobile) and 5e3ce6c0- 2b1f-4285-8d4b-75ee78787346 (Teams on the web).
#### 7 **Note**

The ea5a67f6-b6f3-4338-b240-c655ddc3cc8e ID pre-authorizes Office on all the following platforms. Alternatively, you can enter a proper subset of the following IDs if, for any reason, you want to deny authorization to Office on some platforms. If you do so, leave out the IDs of the platforms from which you want to withhold authorization. Users of your add-in on those platforms will not be able to call your Web APIs, but other functionality in your add-in will still work.

- d3590ed6-52b3-4102-aeff-aad2292ab01c (Microsoft Office)
- 93d53678-613d-4013-afc1-62e9e444a0a5 (Office on the web)
- bc59ab01-8403-45c6-8796-ac3ef710b3e3 (Outlook on the web)
- 6. In **Authorized scopes**, select the api://<fully-qualified-domain-name>/<appid>/access_as_user checkbox.
- 7. Select **Add application**.

| Add a client application                                                  |  |
|---------------------------------------------------------------------------|--|
| Client ID (1)                                                             |  |
| ea5a67f6-b6f3-4338-b240-c655ddc3cc8e                                      |  |
| Authorized scopes (1                                                      |  |
| api://localhost:44355/cfe719d7-aef3-4108-83a8-a8283f139a69/access_as_user |  |
|                                                                           |  |
| Add application<br>Cancel                                                 |  |

## **Add Microsoft Graph permissions**


- 1. From the left pane, select **API permissions**.
The **API permissions** pane opens.

- 2. Select **Add a permission**.

| =<br>Microsoft Azure                                 |                                                                               | Search resources, services, and docs (G+/)                                                  |                                 |                                                                                                                                                                                                                                 | >_ |  | ಲ  | ಕ್ಷರಿ | 2                 | ್ನಿ | NestorW@M365x63284<br>CONTOSO (M365X63284053.ON. |   |
|------------------------------------------------------|-------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------|---------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----|--|----|-------|-------------------|-----|--------------------------------------------------|---|
| Home > App registrations > contoso-office-add-in-sso |                                                                               |                                                                                             |                                 |                                                                                                                                                                                                                                 |    |  |    |       |                   |     |                                                  |   |
| contoso-office-add-in-sso   API permissions<br>2     |                                                                               |                                                                                             |                                 |                                                                                                                                                                                                                                 |    |  |    | ×     |                   |     |                                                  |   |
| Search<br>場 Overview<br>Quickstart                   | <<                                                                            | & Got feedback?<br>() Refresh                                                               |                                 |                                                                                                                                                                                                                                 |    |  |    |       |                   |     |                                                  |   |
| Integration assistant                                |                                                                               | publisher                                                                                   |                                 | Starting November 9th, 2020 end users will no longer to newly registered multitenant apps without verified publishers. Add MPN ID to verify                                                                                     |    |  |    |       |                   |     |                                                  | × |
| Manage<br>Branding & properties<br>ூ Authentication  |                                                                               |                                                                                             |                                 | The "Admin consent reguired" column shows the default value for an organization. However, user permission, user, or app. This column<br>may not reflect the value in your orqanizations where this app will be used. Learn more |    |  |    |       |                   |     |                                                  | × |
| Certificates & secrets                               |                                                                               | Confiqured permissions                                                                      |                                 |                                                                                                                                                                                                                                 |    |  |    |       |                   |     |                                                  |   |
| Token configuration                                  |                                                                               |                                                                                             |                                 | Applications are authorized to call APIs when the permissions by users/admins as part of the consent process. The list of configured permissions should                                                                         |    |  |    |       |                   |     |                                                  |   |
| API permissions                                      |                                                                               | include all the permissions the application needs. Learn more about permissions and consent |                                 |                                                                                                                                                                                                                                 |    |  |    |       |                   |     |                                                  |   |
| Expose an API                                        |                                                                               | + Add a permission<br>>                                                                     | Grant admin consent for Contoso |                                                                                                                                                                                                                                 |    |  |    |       |                   |     |                                                  |   |
| App roles                                            |                                                                               | API / Permissions name                                                                      | Type                            | Description                                                                                                                                                                                                                     |    |  |    |       | Admin consent req |     | Status                                           |   |
| Owners                                               |                                                                               | V Microsoft Graph (1)                                                                       |                                 |                                                                                                                                                                                                                                 |    |  |    |       |                   |     |                                                  |   |
| Roles and administrators                             |                                                                               | User.Read                                                                                   | Delegated                       | Sign in and read user profile                                                                                                                                                                                                   |    |  | No |       |                   |     |                                                  |   |
| o Manifest                                           |                                                                               |                                                                                             |                                 |                                                                                                                                                                                                                                 |    |  |    |       |                   |     |                                                  |   |
| Support + Troubleshooting                            | To view and manage permissions and user consent, try Enterprise applications. |                                                                                             |                                 |                                                                                                                                                                                                                                 |    |  |    |       |                   |     |                                                  |   |
| જ્<br>Troubleshooting                                |                                                                               |                                                                                             |                                 |                                                                                                                                                                                                                                 |    |  |    |       |                   |     |                                                  |   |
| New support request                                  |                                                                               |                                                                                             |                                 |                                                                                                                                                                                                                                 |    |  |    |       |                   |     |                                                  |   |
|                                                      |                                                                               |                                                                                             |                                 |                                                                                                                                                                                                                                 |    |  |    |       |                   |     |                                                  |   |

The **Request API permissions** pane opens.

- 3. Select **Microsoft Graph**.


- 4. Select **Delegated permissions**.

| Request API permissions                                                                                                           | ×                                                                                                               |
|-----------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
| < All APIs<br>Microsoft Graph<br>https://graph.microsoft.com/ Docs [2]<br>What type of permissions does your application require? |                                                                                                                 |
| Delegated permissions<br>Your application needs to access the API as the signed-in user.                                          | Application permissions<br>Your application runs as a background service or daemon without a<br>signed-in user. |

- 5. In the **Select permissions** search box, search for the permissions your add-in needs. For example, for an Outlook add-in, you might use profile , openid ,
Files.ReadWrite , and Mail.Read .

7 **Note**

The User.Read permission may already be listed by default. It's a good practice to only request permissions that are needed, so we recommend that you uncheck the box for this permission if your add-in doesn't actually need it.

- 6. Select the checkbox for each permission as it appears. Note that the permissions will not remain visible in the list as you select each one. After selecting the permissions that your add-in needs, select **Add permissions**.


| Request API permissions                                                                                                                                                                                                                                          |                                                                                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
| < All APIs<br>Microsoft Graph<br>https://graph.microsoft.com/ Docs &<br>What type of permissions does your application require?                                                                                                                                  |                                                                                                                 |
| Delegated permissions<br>Your application needs to access the API as the signed-in user.                                                                                                                                                                         | Application permissions<br>Your application runs as a background service or daemon without a<br>signed-in user. |
| Select permissions                                                                                                                                                                                                                                               | expand all                                                                                                      |
| Start typing a permission to filter these results                                                                                                                                                                                                                |                                                                                                                 |
| The "Admin consent required" column shows the default value for an organization. However, user consent can be customized per<br>permission, user, or app. This column may not reflect the value in your organizations where this app will be<br>used. Learn more | ×                                                                                                               |
| Permission                                                                                                                                                                                                                                                       | Admin consent required                                                                                          |
| V OpenId permissions (2)                                                                                                                                                                                                                                         |                                                                                                                 |
| email (1)<br>View users' email address                                                                                                                                                                                                                           | No                                                                                                              |
| offline_access (1)<br>Maintain access to data you have given it access to                                                                                                                                                                                        | No                                                                                                              |
| openid ()<br>Sign users in                                                                                                                                                                                                                                       | No                                                                                                              |
| profile ()<br>View users' basic profile                                                                                                                                                                                                                          | No                                                                                                              |
| AccessReview                                                                                                                                                                                                                                                     |                                                                                                                 |
|                                                                                                                                                                                                                                                                  |                                                                                                                 |
|                                                                                                                                                                                                                                                                  |                                                                                                                 |
| Add permissions<br>Discard                                                                                                                                                                                                                                       |                                                                                                                 |

- 7. Select **Grant admin consent for [tenant name]**. Select **Yes** for the confirmation that appears.
## **Configure access token version**

You must define the access token version that is acceptable for your app. This configuration is made in the Azure Active Directory application manifest.

### **Define the access token version**

The access token version can change if you chose an account type other than **Accounts in any organizational directory (Any Azure AD directory - Multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)**. Use the following steps to ensure the access token version is correct for Office SSO usage.


- 1. From the left pane, select **Manifest**.
The Azure Active Directory application manifest appears.

- 2. Enter **2** as the value for the accessTokenAcceptedVersion property.
- 3. Select **Save**.
A message pops up on the browser stating that the manifest was updated successfully.


Congratulations! You've completed the app registration to enable SSO for your Office add-in.

## **Configure the add-in**

- 1. Open the \Begin folder in the cloned project in your code editor.
- 2. Open the .ENV file and use the values that you copied earlier from the **Office-Addin-NodeJS-SSO** app registration. Set the values as follows:

#### ノ **Expand table**

| Name          | Value                                                        |
|---------------|--------------------------------------------------------------|
| CLIENT_ID     | Application (client) ID from app registration overview page. |
| CLIENT_SECRET | Client secret saved from Certificates & Secrets page.        |

The values should **not** be in quotation marks. When you are done, the file should be similar to the following:

JavaScript CLIENT_ID=8791c036-c035-45eb-8b0b-265f43cc4824 CLIENT_SECRET=X7szTuPwKNts41:-/fa3p.p@l6zsyI/p NODE_ENV=development SERVER_SOURCE=<https://localhost:3000>

- 3. Open the add-in manifest file "manifest\manifest_local.xml" and then scroll to the bottom of the file. Just above the </VersionOverrides> end tag, you'll find the following markup.

```
XML
<WebApplicationInfo>
 <Id>$app-id-guid$</Id>
 <Resource>api://localhost:3000/$app-id-guid$</Resource>
 <Scopes>
 <Scope>Files.Read</Scope>
 <Scope>profile</Scope>
 <Scope>openid</Scope>
```


- 4. Replace the placeholder "$app-id-guid$" *in both places* in the markup with the **Application ID** that you copied when you created the **Office-Add-in-NodeJS-SSO** app registration. The "$" symbols are not part of the ID, so don't include them. This is the same ID you used for the CLIENT_ID in the .ENV file.
The **<Resource>** value is the **Application ID URI** you set when you registered the add-in. The **<Scopes>** section is used only to generate a consent dialog box if the add-in is sold through AppSource.

- 5. Open the \public\javascripts\fallback-msal\authConfig.js file. Replace the placeholder "$app-id-guid$" with the application ID that you saved from the **Office-Add-in-NodeJS-SSO** app registration you created previously.
- 6. Save the changes to the file.

## **Code the client-side**

### **Call our web server REST API**

- 1. In your code editor, open the file public\javascripts\ssoAuthES6.js . It already has code that ensures that Promises are supported, even in the Trident (Internet Explorer 11) webview control, and an Office.onReady call to assign a handler to the add-in's only button.
#### 7 **Note**

As the name suggests, the ssoAuthES6.js uses JavaScript ES6 syntax because using async and await best shows the essential simplicity of the SSO API. When the localhost server is started, this file is transpiled to ES5 syntax so that the sample will support Trident.

- 2. In the getFileNameList function, replace TODO 1 with the following code. About this code, note:


- The function getFileNameList is called when the user chooses the **Get OneDrive File Names** button on the task pane.
- It calls the callWebServerAPI function specifying which REST API to call. This returns JSON containing a list of file names from the user's OneDrive.
- The JSON is passed to the writeFileNamesToOfficeDocument function to list the file names in the document.

```
JavaScript
try {
 const jsonResponse = await callWebServerAPI('GET', 
'/getuserfilenames');
 if (jsonResponse === null) {
 // Null is returned when a message was displayed to the user
 // regarding an authentication error that cannot be resolved.
 return;
 }
 await writeFileNamesToOfficeDocument(jsonResponse);
 showMessage('Your OneDrive filenames are added to the document.');
} catch (error) {
 console.log(error.message);
 showMessage(error.message);
}
```
- 3. In the callWebServerAPI function, replace TODO 2 with the following code. About this code, note:
	- The function calls getAccessToken which is our own function that encapsulates using Office SSO or MSAL fallback as necessary to get the token. If it returns a null token, a message was shown for an auth error condition that cannot be resolved, so the function also returns null.
	- The function uses the fetch API to call the web server and if successful, returns the JSON body.

```
JavaScript
const accessToken = await getAccessToken(authSSO);
if (accessToken === null) {
 return null;
}
const response = await fetch(path, {
 method: method,
 headers: {
 'Content-Type': 'application/json',
 'Authorization': 'Bearer ' + accessToken,
 },
});
```


```
// Check for success condition: HTTP status code 2xx.
if (response.ok) {
 return response.json();
}
```
- 4. In the callWebServerAPI function, replace TODO 3 with the following code. About this code, note:
	- This code handles the scenario where the SSO token expired. If so we need to call Office.auth.getAccessToken to get a refreshed token. The simplest way is to make a recursive call which results in a new call to Office.auth.getAccessToken . The retryRequest parameter ensures the recursive call is only attempted once.
	- The TokenExpiredError string is set by our web server whenever it detects an expired token.

```
JavaScript
```

```
// Check for fail condition: Is SSO token expired? If so, retry the
call which will get a refreshed token.
const jsonBody = await response.json();
if (
 authSSO === true &&
 jsonBody != null &&
 jsonBody.type === 'TokenExpiredError'
) {
 if (!retryRequest) {
 return callWebServerAPI(method, path, true); // Try the call
again. The underlying call to Office JS getAccessToken will refresh the
token.
 } else {
 // Indicates a second call to retry and refresh the token
failed.
 authSSO = false;
 return callWebServerAPI(method, path, true); // Try the call
again, but now using MSAL fallback auth.
 }
}
```
- 5. In the callWebServerAPI function, replace TODO 4 with the following code. About this code, note:
	- The Microsoft Graph string is set by our web server whenever a Microsoft Graph call fails.

JavaScript


```
// Check for fail condition: Did we get a Microsoft Graph API error,
which is returned as bad request (403)?
if (response.status === 403 && jsonBody.type === 'Microsoft Graph') {
 throw new Error('Microsoft Graph error: ' + jsonBody.errorDetails);
}
```
- 6. In the callWebServerAPI function, replace TODO 5 with the following code.

```
JavaScript
// Handle other errors.
throw new Error(
 'Unknown error from web server: ' + JSON.stringify(jsonBody)
);
```
- 7. In the getAccessToken function, replace TODO 6 with the following code. About this code, note:
	- authSSO tracks if we are using SSO, or using MSAL fallback. If SSO is used, the function calls Office.auth.getAccessToken and returns the token.
	- Errors are handled by the handleSSOErrors function which will return a token if it switches to fallback MSAL authentication.
	- Fallback authentication uses the MSAL library to sign in the user. The add-in itself is an SPA, and uses an SPA app registration to access the web server.

```
JavaScript
if (authSSO) {
 try {
 // Get the access token from Office host using SSO.
 // Note that Office.auth.getAccessToken modifies the options
parameter. Create a copy of the object
 // to avoid modifying the original object.
 const options = JSON.parse(JSON.stringify(ssoOptions));
 const token = await Office.auth.getAccessToken(options);
 return token;
 } catch (error) {
 console.log(error.message);
 return handleSSOErrors(error);
 }
} else {
 // Get access token through MSAL fallback.
 try {
 const accessToken = await getAccessTokenMSAL();
 return accessToken;
 } catch (error) {
 console.log(error);
 throw new Error(
```


```
 'Cannot get access token. Both SSO and fallback auth
failed. ' +
 error
 );
 }
}
```
- 8. In the handleSSOErrors function, replace TODO 7 with the following code. For more information about these errors, see Troubleshoot SSO in Office Add-ins.

```
JavaScript
switch (error.code) {
 case 13001:
 // No one is signed into Office. If the add-in cannot be
effectively used when no one
 // is logged into Office, then the first call of getAccessToken
should pass the
 // `allowSignInPrompt: true` option. Since this sample does
that, you should not see
 // this error.
 showMessage(
 'No one is signed into Office. But you can use many of the
add-ins functions anyway. If you want to log in, press the Get OneDrive
File Names button again.'
 );
 break;
 case 13002:
 // The user aborted the consent prompt. If the add-in cannot be
effectively used when consent
 // has not been granted, then the first call of getAccessToken
should pass the `allowConsentPrompt: true` option.
 showMessage(
 'You can use many of the add-ins functions even though you
have not granted consent. If you want to grant consent, press the Get
OneDrive File Names button again.'
 );
 break;
 case 13006:
 // Only seen in Office on the web.
 showMessage(
 'Office on the web is experiencing a problem. Please sign
out of Office, close the browser, and then start again.'
 );
 break;
 case 13008:
 // Only seen in Office on the web.
 showMessage(
 'Office is still working on the last operation. When it
completes, try this operation again.'
 );
 break;
 case 13010:
```


```
 // Only seen in Office on the web.
 showMessage(
 "Follow the instructions to change your browser's zone
configuration."
 );
 break;
```
- 9. Replace TODO 8 with the following code. For any errors that can't be handled the code switches to fallback authentication using MSAL.

```
JavaScript
default: //recursive call.
 // For all other errors, including 13000, 13003, 13005, 13007,
13012, and 50001, fall back
 // to MSAL sign-in.
 showMessage('SSO failed. Trying fallback auth.');
 authSSO = false;
 return getAccessToken(false);
}
return null; // Return null for errors that show a message to the user.
```
### **Code the web server REST API**

The web server provides REST APIs for the client to call. For example, the REST API /getuserfilenames gets a list of filenames from the user's OneDrive folder. Each REST API call requires an access token by the client to ensure the correct client is accessing their data. The access token is exchanged for a Microsoft Graph token through the On-Behalf-Of flow (OBO). The new Microsoft Graph token is cached by the MSAL library for subsequent API calls. It's never sent outside of the web server. For more information, see [Middle-tier access token request](https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow#middle-tier-access-token-request)

### **Create the route and implement On-Behalf-Of flow**

- 1. Open the file routes\getFilesRoute.js and replace TODO 9 with the following code. About this code, note:
	- It calls authHelper.validateJwt . This ensures the access token is valid and hasn't been tampered with.
	- For more information, see [Validating tokens](https://learn.microsoft.com/en-us/azure/active-directory/develop/access-tokens#validating-tokens).


```
router.get(
"/getuserfilenames",
authHelper.validateJwt,
async function (req, res) {
 // TODO 10: Exchange the access token for a Microsoft Graph token
 // by using the OBO flow.
}
);
```
- 2. Replace TODO 10 with the following code. About this code, note:
	- It only requests the minimum scopes it needs, such as files.read .
	- It uses the MSAL authHelper to perform the OBO flow in the call to acquireTokenOnBehalfOf .

```
JavaScript
try {
 const authHeader = req.headers.authorization;
 let oboRequest = {
 oboAssertion: authHeader.split(' ')[1],
 scopes: ["files.read"],
 };
 // The Scope claim tells you what permissions the client application
has in the service.
 // In this case we look for a scope value of access_as_user, or full
access to the service as the user.
 const tokenScopes = jwt.decode(oboRequest.oboAssertion).scp.split('
');
 const accessAsUserScope = tokenScopes.find(
 (scope) => scope === 'access_as_user'
 );
 if (!accessAsUserScope) {
 res.status(401).send({ type: "Missing access_as_user" });
 return;
 }
 const cca = authHelper.getConfidentialClientApplication();
 const response = await cca.acquireTokenOnBehalfOf(oboRequest);
 // TODO 11: Call Microsoft Graph to get list of filenames.
} catch (err) {
 // TODO 12: Handle any errors.
}
```
- 3. Replace TODO 11 with the following code. About this code, note:
	- It constructs the URL for the Microsoft Graph API call and then makes the call via the getGraphData function.
	- It returns errors by sending an HTTP 500 response along with details.


- On success it returns the JSON with the filename list to the client.

```
JavaScript
```

```
// Minimize the data that must come from MS Graph by specifying only
the property we need ("name")
// and only the top 10 folder or file names.
const rootUrl = '/me/drive/root/children';
// Note that the last parameter, for queryParamsSegment, is hardcoded.
If you reuse this code in
// a production add-in and any part of queryParamsSegment comes from
user input, be sure that it is
// sanitized so that it cannot be used in a Response header injection
attack.
const params = '?$select=name&$top=10';
const graphData = await getGraphData(
 response.accessToken,
 rootUrl,
 params
);
// If Microsoft Graph returns an error, such as invalid or expired
token,
// there will be a code property in the returned object set to a HTTP
status (e.g. 401).
// Return it to the client. On client side it will get handled in the
fail callback of `makeWebServerApiCall`.
if (graphData.code) {
 res
 .status(403)
 .send({
 type: "Microsoft Graph",
 errorDetails:
 "An error occurred while calling the Microsoft Graph API.\n" +
 graphData,
 });
} else {
 // MS Graph data includes OData metadata and eTags that we don't
need.
 // Send only what is actually needed to the client: the item names.
 const itemNames = [];
 const oneDriveItems = graphData["value"];
 for (let item of oneDriveItems) {
 itemNames.push(item["name"]);
 }
 res.status(200).send(itemNames);
}
// TODO 12: Check for expired token.
```


- 4. Replace TODO 12 with the following code. This code specifically checks if the token expired because the client can request a new token and call again.

```
JavaScript
} catch (err) {
 // On rare occasions the SSO access token is unexpired when Office
validates it,
 // but expires by the time it is used in the OBO flow. Microsoft
identity platform will respond
 // with "The provided value for the 'assertion' is not valid. The
assertion has expired."
 // Construct an error message to return to the client so it can
refresh the SSO token.
 if (err.errorMessage.indexOf('AADSTS500133') !== -1) {
 res.status(401).send({ type: "TokenExpiredError", errorDetails:
err });
 } else {
 res.status(403).send({ type: "Unknown", errorDetails: err });
 }
}
```
The sample must handle both fallback authentication through MSAL and SSO authentication through Office. The sample will try SSO first, and the authSSO boolean at the top of the file tracks if the sample is using SSO or has switched to fallback auth.

### **Run the project**

- 1. Ensure that you have some files in your OneDrive so that you can verify the results.
- 2. Open a command prompt in the root of the \Begin folder.
- 3. Run the command npm install to install all package dependencies.
- 4. Run the command npm start to start the middle-tier server.
- 5. You need to sideload the add-in into an Office application (Excel, Word, or PowerPoint) to test it. The instructions depend on your platform. There are links to instructions at Sideload an Office Add-in for Testing.
- 6. In the Office application, on the **Home** ribbon, select the **Show Add-in** button in the **SSO Node.js** group to open the task pane add-in.
- 7. Click the **Get OneDrive File Names** button. If you're logged into Office with either a Microsoft 365 Education or work account, or a Microsoft account, and SSO is working as expected the first 10 file and folder names in your OneDrive for


Business are inserted into the document. (It may take as much as 15 seconds the first time.) If you're not logged in, or you're in a scenario that doesn't support SSO, or SSO isn't working for any reason, you'll be prompted to sign in. After you sign in, the file and folder names appear.

#### 7 **Note**

If you were previously signed into Office with a different ID, and some Office applications that were open at the time are still open, Office may not reliably change your ID even if it appears to have done so. If this happens, the call to Microsoft Graph may fail or data from the previous ID may be returned. To prevent this, be sure to *close all other Office applications* before you press **Get OneDrive File Names**.

## **Stop running the project**

When you're ready to stop the middle-tier server and uninstall the add-in, follow these instructions:

- 1. Run the following command to stop the middle-tier server.

| command line |  |  |  |  |  |  |
|--------------|--|--|--|--|--|--|
| npm stop     |  |  |  |  |  |  |

- 2. To uninstall or remove the add-in, see the specific sideload article you used for details.
## **Security notes**

- The /getuserfilenames route in getFilesroute.js uses a literal string to compose the call for Microsoft Graph. If you change the call so that any part of the string comes from user input, sanitize the input so that it cannot be used in a Response header injection attack.
- In app.js the following content security policy is in place for scripts. You may want to specify additional restrictions depending on your add-in security needs.

```
"Content-Security-Policy": "script-src https://appsforoffice.microsoft.com
https://ajax.aspnetcdn.com https://alcdn.msauth.net " +
```


process.env.SERVER_SOURCE,

Always follow security best practices in the [Microsoft identity platform documentation](https://learn.microsoft.com/en-us/azure/active-directory/develop/).


## **Troubleshoot error messages for single sign-on (SSO)**

07/30/2025

This article provides some guidance about how to troubleshoot problems with single sign-on (SSO) in Office Add-ins, and how to make your SSO-enabled add-in robustly handle special conditions or errors.

#### 7 **Note**

The Single Sign-on API is currently supported for Word, Excel, Outlook, and PowerPoint. For more information about where the Single Sign-on API is currently supported, see **[IdentityAPI requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/identity-api-requirement-sets)**. If you're working with an Outlook add-in, be sure to enable Modern Authentication for the Microsoft 365 tenancy. For information about how to do this, see **[Enable or disable modern authentication for Outlook in Exchange Online](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online)**.

## **Debugging tools**

We strongly recommend that you use a tool that can intercept and display the HTTP Requests from, and Responses to, your add-in's web service when you are developing. Some of the most popular are:

- [Fiddler](https://www.telerik.com/fiddler) : Free for 10 days ([Documentation](https://docs.telerik.com/fiddler-everywhere/introduction) )
- [Charles](https://www.charlesproxy.com/) : Free for 30 days. ([Documentation](https://www.charlesproxy.com/documentation) )
- [Requestly](https://requestly.com/downloads) : Free basic service. ([Documentation](https://developers.requestly.com/) )

## **Causes and handling of errors from getAccessToken**

For examples of the error handling described in this section, see:

- [HomeES6.js in Office-Add-in-ASPNET-SSO](https://github.com/OfficeDev/Office-Add-in-samples/blob/main/Samples/auth/Office-Add-in-ASPNET-SSO/Complete/Office-Add-in-ASPNETCore-WebAPI/wwwroot/js/HomeES6.js)
- [ssoAuthES6.js in Office-Add-in-NodeJS-SSO](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-NodeJS-SSO/Complete/public/javascripts/ssoAuthES6.js)

### **13000**

The [getAccessToken](https://learn.microsoft.com/en-us/javascript/api/office-runtime/officeruntime.auth#office-runtime-officeruntime-auth-getaccesstoken-member(1)) API isn't supported by the add-in or the Office version.


- The version of Office does not support SSO. The required version is Microsoft 365 subscription, in any monthly channel.
- The add-in manifest is missing the proper [WebApplicationInfo](https://learn.microsoft.com/en-us/javascript/api/manifest/webapplicationinfo) section.

Your add-in should respond to this error by falling back to an alternate system of user authentication. For more information, see Requirements and Best Practices.

### **13001**

The user isn't signed into Office. In most scenarios, you should prevent this error from ever being seen by passing the option allowSignInPrompt: true in the AuthOptions parameter.

But there may be exceptions. For example, you want the add-in to open with features that require a logged in user; but *only if* the user is *already* logged into Office. If the user isn't logged in, you want the add-in to open with an alternate set of features that do not require that the user is signed in. In this case, logic which runs when the add-in launches calls getAccessToken without allowSignInPrompt: true . Use the 13001 error as the flag to tell the add-in to present the alternate set of features.

Another option is to respond to 13001 by falling back to an alternate system of user authentication. This will sign the user into Microsoft Entra ID, but not sign the user into Office.

This error doesn't typically occur in Office on the web. If the user's cookie expires, Office on the web returns error 13006. However, if a user accesses Outlook on the web from Firefox with Enhanced Tracking Protection turned on, they'll encounter error 13001.

### **13002**

The user aborted sign in or consent; for example, by choosing **Cancel** on the consent dialog.

- If your add-in provides functions that don't require the user to be signed in (or to have granted consent), then your code should catch this error and allow the add-in to stay running.
- If the add-in requires a signed-in user who has granted consent, your code should have a sign-in button appear.

## **13003**

User Type not supported. The user isn't signed into Office with a valid Microsoft account or Microsoft 365 Education or work account. This may happen if Office runs with an on-premises domain account, for example. Your code should fall back to an alternate system of user authentication. In Outlook, this error may also occur if [modern authentication is disabled](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online) for


the user's tenant in Exchange Online. For more information, see Requirements and Best Practices.

## **13004**

Invalid Resource. (This error should only be seen in development.) The add-in manifest hasn't been configured correctly. Update the manifest. For more information, see Validate an Office Add-in's manifest. The most common problem is that the <Resource> element (in the <WebApplicationInfo> element) has a domain that does not match the domain of the add-in. Although the protocol part of the Resource value should be "api" not "https"; all other parts of the domain name (including port, if any) should be the same as for the add-in.

### **13005**

Invalid Grant. This usually means that Office has not been pre-authorized to the add-in's web service. For more information, see Create the service application and Register an Office Add-in that uses single sign-on (SSO) with the Microsoft identity platform. This also may happen if the user has not granted your service application permissions to their profile , or has revoked consent. Your code should fall back to an alternate system of user authentication.

Another possible cause, during development, is that your add-in using Internet Explorer, and you are using a self-signed certificate. (To determine which browser or webview is being used by the add-in, see Browsers and webview controls used by Office Add-ins.)

### **13006**

Client Error. This error is only seen in **Office on the web**. Your code should suggest that the user sign out and then restart the Office browser session.

### **13007**

The Office application was unable to get an access token to the add-in's web service.

- If this error occurs during development, be sure that your add-in registration and add-in manifest specify the profile permission (and the openid permission, if you are using MSAL.NET). For more information, see Register an Office Add-in that uses single sign-on (SSO) with the Microsoft identity platform.
- In production, an account mismatch could cause this error. For example, if the user attempts to sign in with a personal Microsoft account (MSA) when a Work or school account was expected. For these cases, your code should fall back to an alternate system


of user authentication. For more information on account types, see [Identity and account](https://learn.microsoft.com/en-us/security/zero-trust/develop/identity-supported-account-types) [types for single- and multi-tenant apps.](https://learn.microsoft.com/en-us/security/zero-trust/develop/identity-supported-account-types)

- Make sure your application is enabled for users to sign-in for your organization.
	- 1. Sign in to the [Microsoft Azure portal](https://portal.azure.com/) .
	- 2. Go to your add-in's app registration.
	- 3. On the **Overview** page, select **Managed application in local directory**.

| へ Essentials                                     |                                        |                    |                                                   |
|--------------------------------------------------|----------------------------------------|--------------------|---------------------------------------------------|
| Display name                                     | : Contoso-Outlook-Add-in               | Client credentials | : Add a certificate or secret                     |
| Application (client) ID                          | : 4508d899-982a-4cae-885c-6ada07beb60d | Redirect URIs      | : 0 web, 3 spa, 0 public client                   |
| Object ID                                        | : baed79f2-2202-4d31-a678-0afaeaadbe68 | Application ID URI | : Add an Application ID URI                       |
| Directory (tenant) ID                            | : 8ef5695c-8176-4c68-b914-189ef51e1378 |                    | Managed application in I : Contoso-Outlook-Add-in |
| Supported account types  :  My organization only |                                        |                    |                                                   |

- 4. Select **Manage** > **Properties**, and ensure that the value of **Enabled for users to signin?** is **Yes**.

| III: 12 163.<br>Contoso-Outlook-Add-in   Properties<br>Enterprise Application |                                                                                                                                                        |  |  |
|-------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|
| ◇<br><<                                                                       | X Discard<br>Q Got feedback?<br>는 Save                                                                                                                 |  |  |
| Overview                                                                      | View and manage application settings for your organization. Editing properties like display information, user sign-in                                  |  |  |
| []] Deployment Plan                                                           | settings, and user visibility settings requires Global Administrator, Cloud Application Administrator, Application<br>Administrator roles. Learn more. |  |  |
| * Diagnose and solve problems                                                 | If this application resides in your tenant, you can manage additional properties on the application registration.                                      |  |  |
| ✓ Manage                                                                      | No                                                                                                                                                     |  |  |
| HIH                                                                           | Enabled for users to sign-in? ①                                                                                                                        |  |  |
| Properties                                                                    | Yes                                                                                                                                                    |  |  |
| Owners                                                                        | Name *  ①<br>Contoso-Outlook-Add-in<br>>                                                                                                               |  |  |
| Roles and administrators                                                      | Homepage URL  ①<br>ம்                                                                                                                                  |  |  |

### **13008**

The user triggered an operation that calls getAccessToken before a previous call of getAccessToken completed. This error is only seen on **Office on the web**. Your code should ask the user to repeat the operation after the previous operation has completed.

### **13010**

The user is running the add-in in Office on Microsoft Edge. The user's Microsoft 365 domain, and the login.microsoftonline.com domain, are in a different security zones in the browser settings. This error is only seen on **Office on the web**. If this error is returned, the user will have already seen an error explaining this and linking to a page about how to change the zone configuration. If your add-in provides functions that don't require the user to be signed in, then your code should catch this error and allow the add-in to stay running.

### **13012**

There are several possible causes.


- The add-in is running on a platform that does not support the getAccessToken API. For example, it isn't supported on iPad. See also [Identity API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/identity-api-requirement-sets).
- The Office document was opened from the **Files** tab of a Teams channel using the **Edit in Teams** option on the **Open** dropdown menu. The getAccessToken API isn't supported in this scenario.
- The forMSGraphAccess option was passed in the call to getAccessToken and the user obtained the add-in from AppSource. In this scenario, the tenant admin has not granted consent to the add-in for the Microsoft Graph scopes (permissions) that it needs. Recalling getAccessToken with the allowConsentPrompt will not solve the problem because Office is allowed to prompt the user for consent to only the Microsoft Entra ID profile scope.

Your code should fall back to an alternate system of user authentication.

In development, the add-in is sideloaded in Outlook and the forMSGraphAccess option was passed in the call to getAccessToken .

### **13013**

The getAccessToken was called too many times in a short amount of time, so Office throttled the most recent call. This is usually caused by an infinite loop of calls to the method. There are scenarios when recalling the method is advisable. However, your code should use a counter or flag variable to ensure that the method isn't recalled repeatedly. If the same "retry" code path is running again, the code should fall back to an alternate system of user authentication. For a code example, see how the retryGetAccessToken variable is used in [HomeES6.js](https://github.com/OfficeDev/Office-Add-in-samples/blob/main/Samples/auth/Office-Add-in-ASPNET-SSO/Complete/Office-Add-in-ASPNETCore-WebAPI/wwwroot/js/HomeES6.js) or [ssoAuthES6.js](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-NodeJS-SSO/Complete/public/javascripts/ssoAuthES6.js) .

### **50001**

This error (which isn't specific to getAccessToken ) may indicate that the browser has cached an old copy of the office.js files. When you're developing, clear the browser's cache. Another possibility is that the version of Office isn't recent enough to support SSO. On Windows, the minimum version is Version 1911 (Build 12215.20006). On Mac, it's Version 16.32 (19102902).

In a production add-in, the add-in should respond to this error by falling back to an alternate system of user authentication. For more information, see Requirements and Best Practices.

## **Errors on the server-side from Microsoft Entra ID**

For samples of the error-handling described in this section, see:


- [Office-Add-in-ASPNET-SSO](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-ASPNET-SSO)
- [Office-Add-in-NodeJS-SSO](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-NodeJS-SSO)

### **Conditional access / Multifactor authentication errors**

In certain configurations of identity in Microsoft Entra ID and Microsoft 365, it is possible for some resources that are accessible with Microsoft Graph to require multifactor authentication (MFA), even when the user's Microsoft 365 tenancy does not. When Microsoft Entra ID receives a request for a token to the MFA-protected resource, via the on-behalf-of flow, it returns to your add-in's web service a JSON message that contains a claims property. The claims property has information about what further authentication factors are needed.

Your code should test for this claims property. Depending on your add-in's architecture, you may test for it on the client-side, or you may test for it on the server-side and relay it to the client. You need this information in the client because Office handles authentication for SSO add-ins. If you relay it from the server-side, the message to the client can be either an error (such as 500 Server Error or 401 Unauthorized ) or in the body of a success response (such as 200 OK ). In either case, the (failure or success) callback of your code's client-side AJAX call to your add-in's web API should test for this response.

Regardless of your architecture, if the claims value has been sent from Microsoft Entra ID, your code should recall getAccessToken and pass the option authChallenge: CLAIMS-STRING-HERE in the options parameter. When Microsoft Entra ID sees this string, it prompts the user for the additional factors and then returns a new access token which will be accepted in the on-behalfof flow.

### **Consent missing errors**

If Microsoft Entra ID has no record that consent (to the Microsoft Graph resource) was granted to the add-in by the user (or tenant administrator), Microsoft Entra ID will send an error message to your web service. Your code must tell the client (in the body of a 403 Forbidden response, for example).

If the add-in needs Microsoft Graph scopes that can only be consented to by an admin, your code should throw an error. If the only scopes that are needed can be consented to by the user, then your code should fall back to an alternate system of user authentication.

### **Invalid or missing scope (permission) errors**

This kind of error should only be seen in development.


- Your server-side code should send a 403 Forbidden response to the client which should log the error to the console or record it in a log.
- Be sure your add-in manifest [Scopes](https://learn.microsoft.com/en-us/javascript/api/manifest/scopes) section specifies all needed permissions. And be sure your registration of the add-in's web service specifies the same permissions. Check for spelling mistakes too. For more information, see Register an Office Add-in that uses single sign-on (SSO) with the Microsoft identity platform.

### **Invalid audience error in the access token for Microsoft Graph**

Your server-side code should send a 403 Forbidden response to the client which should present a friendly message to the user and possibly also log the error to the console or record it in a log.


## **Enable single sign-on in an Office Add-in with nested app authentication**

08/06/2025

You can use the MSAL.js library with nested app authentication to use single sign-on (SSO) from your Office Add-in. Using nested app authentication (NAA) offers several advantages over the On-Behalf-Of (OBO) flow.

- You only need to use the MSAL.js library and don't need the getAccessToken function in Office.js.
- You can call services such as Microsoft Graph with an access token from your client code as an SPA. There's no need for a middle-tier server.
- You can use incremental and dynamic consent for scopes.
- You don't need to [preauthorize your hosts](https://learn.microsoft.com/en-us/microsoftteams/platform/m365-apps/extend-m365-teams-personal-tab?tabs=manifest-teams-toolkit#update-azure-ad-app-registration-for-sso) (for example, Teams, Office) to call your endpoints.

### **NAA supported accounts and hosts**

NAA supports both Microsoft Accounts and Microsoft Entra ID (work/school) identities. It doesn't support [Azure Active Directory B2C](https://learn.microsoft.com/en-us/azure/active-directory-b2c/overview) for business-to-consumer identity management scenarios. The following table explains the current support by platform. Platforms listed as generally available (GA) are ready for production usage in your add-in.

#### ノ **Expand table**

| Application | Web        | Windows    | Mac        | iOS/iPad           | Android        |
|-------------|------------|------------|------------|--------------------|----------------|
| Excel       | In preview | In preview | In preview | In preview on iPad | Not applicable |
| Outlook     | GA         | GA         | GA         | GA (iOS)           | GA             |
| PowerPoint  | In preview | In preview | In preview | In preview on iPad | Not applicable |
| Word        | In preview | In preview | In preview | In preview on iPad | Not applicable |

#### ) **Important**

To use NAA on platforms that are still in preview (Word, Excel, and PowerPoint), join the **[Microsoft 365 Insider Program](https://aka.ms/MSFT365InsiderProgram)** and choose **Current Channel (Preview)**. Don't use NAA in production add-ins for any preview platforms. We invite you to try out NAA in test or


development environments and welcome feedback on your experience through GitHub (see the **Feedback** section at the end of this page).

For information on using NAA in Microsoft Teams, see [Nested app authentication in Microsoft](https://learn.microsoft.com/en-us/microsoftteams/platform/concepts/authentication/nested-authentication) [Teams.](https://learn.microsoft.com/en-us/microsoftteams/platform/concepts/authentication/nested-authentication)

## **Register your single-page application**

You'll need to create a Microsoft Azure App registration for your add-in on the Azure portal. The app registration must have at minimum:

- A name
- A supported account type
- An SPA redirect

If your add-in requires additional app registration beyond NAA and SSO, see [Single-page](https://learn.microsoft.com/en-us/entra/identity-platform/scenario-spa-app-registration) [application: App registration](https://learn.microsoft.com/en-us/entra/identity-platform/scenario-spa-app-registration).

## **Add a trusted broker through SPA redirect**

To enable NAA, your app registration must include a specific redirect URI to indicate to the Microsoft identity platform that your add-in allows itself to be brokered by supported hosts. The redirect URI of the application must be of type **Single Page Application** and conform to the following scheme.

```
brk-multihub://your-add-in-domain
```
Your domain must include only the origin and not its subpaths. For example:

- ✔️ brk-multihub://localhost:3000
- ✔️ brk-multihub://www.contoso.com
- ❌ brk-multihub://www.contoso.com/go

Trusted broker groups are dynamic by design and can be updated in the future to include additional hosts where your add-in may use NAA flows. Currently the brk-multihub group includes Office Word, Excel, PowerPoint, Outlook, and Teams (for when Office is activated inside).

## **Configure MSAL config to use NAA**


Configure your add-in to use NAA by calling

the  createNestablePublicClientApplication  function in MSAL. MSAL returns a public client application that can be nested in a native application host (for example, Outlook) to acquire tokens for your application.

The following steps show how to enable NAA in the taskpane.js or taskpane.ts file in a project built with yo office (**Office Add-in Task Pane** project).

- 1. Add the @azure/msal-browser package to the dependencies section of the package.json file for your project. For more information on this package, see [Microsoft Authentication](https://www.npmjs.com/package/%40azure/msal-browser) [Library for JavaScript (MSAL.js) for Browser-Based Single-Page Applications](https://www.npmjs.com/package/%40azure/msal-browser) . We recommend using the latest version of the package (at time of the last article update it was 3.26.0).

```
JSON
"dependencies": {
 "@azure/msal-browser": "^3.27.0",
 ...
```
- 2. Save and run npm install to install @azure/msal-browser .
- 3. Add the following code to the top of the taskpane.js or taskpane.ts file. This will import the MSAL browser library.

```
JavaScript
import { createNestablePublicClientApplication } from "@azure/msal-browser";
```
## **Initialize the public client application**

Next, you need to initialize MSAL and get an instance of the [public client application.](https://learn.microsoft.com/en-us/entra/identity-platform/msal-client-applications) This is used to get access tokens when needed. We recommend that you put the code that creates the public client application in the Office.onReady method.

- In your Office.onReady function, add a call to createNestablePublicClientApplication as shown below. Replace the Enter_the_Application_Id_Here placeholder with the Azure app ID you saved previously.

```
JavaScript
let pca = undefined;
Office.onReady(async (info) => {
```


```
 if (info.host) {
 document.getElementById("sideload-msg").style.display = "none";
 document.getElementById("app-body").style.display = "flex";
 document.getElementById("run").onclick = run;
 // Initialize the public client application
 pca = await createNestablePublicClientApplication({
 auth: {
 clientId: "Enter_the_Application_Id_Here",
 authority: "https://login.microsoftonline.com/common"
 },
 });
 }
});
```
The previous code sample sets the **authority** to **common**, which supports work and school accounts or personal Microsoft accounts. If you want to configure a single tenant or other account types, see **[Application configuration options](https://learn.microsoft.com/en-us/entra/identity-platform/msal-client-application-configuration)** for additional authority options.

## **Acquire your first token**

The tokens acquired by MSAL.js via NAA will be issued for your Azure app registration ID. In this code sample, you acquire a token for the Microsoft Graph API. If the user has an active session with Microsoft Entra ID the token is acquired silently. If not, the library prompts the user to sign in interactively. The token is then used to call the Microsoft Graph API.

The following steps show the pattern to use for acquiring a token.

- 1. Specify your scopes. NAA supports incremental and dynamic consent so always request the minimum scopes needed for your code to complete its task.
- 2. Call acquireTokenSilent . This will get the token without requiring user interaction.
- 3. If acquireTokenSilent fails, call acquireTokenPopup to display an interactive dialog for the user. acquireTokenSilent can fail if the token expired, or the user has not yet consented to all of the requested scopes.

The following code shows how to implement this authentication pattern in your own project.

- 1. Replace the run function in taskpane.js or taskpane.ts with the following code. The code specifies the minimum scopes needed to read the user's files.


```
async function run() {
// Specify minimum scopes needed for the access token.
const tokenRequest = {
 scopes: ["Files.Read", "User.Read", "openid", "profile"],
};
let accessToken = null;
// TODO 1: Call acquireTokenSilent.
// TODO 2: Call acquireTokenPopup.
// TODO 3: Log error if token still null.
// TODO 4: Call the Microsoft Graph API.
}
```
#### ) **Important**

The token request must include scopes other than just offline_access , openid , profile , or email . You can use any combination of the previous scopes, but you must include at least one additional scope. If not, the token request can fail.

- 2. Replace TODO 1 with the following code. This code calls acquireTokenSilent to get the access token.

```
JavaScript
try {
 console.log("Trying to acquire token silently...");
 const userAccount = await pca.acquireTokenSilent(tokenRequest);
 console.log("Acquired token silently.");
 accessToken = userAccount.accessToken;
} catch (error) {
 console.log(`Unable to acquire token silently: ${error}`);
}
```
- 3. Replace TODO 2 with the following code. This code checks if the access token is acquired. If not it attempts to interactively get the access token by calling acquireTokenPopup .

```
JavaScript
if (accessToken === null) {
 // Acquire token silent failure. Send an interactive request via popup.
 try {
 console.log("Trying to acquire token interactively...");
 const userAccount = await pca.acquireTokenPopup(tokenRequest);
```


```
 console.log("Acquired token interactively.");
 accessToken = userAccount.accessToken;
 } catch (popupError) {
 // Acquire token interactive failure.
 console.log(`Unable to acquire token interactively: ${popupError}`);
 }
}
```
- 4. Replace TODO 3 with the following code. If both silent and interactive sign-in failed, log the error and return.

```
JavaScript
// Log error if both silent and popup requests failed.
if (accessToken === null) {
 console.error(`Unable to acquire access token.`);
 return;
}
```
## **Call an API**

After acquiring the token, use it to call an API. The following example shows how to call the Microsoft Graph API by calling fetch with the token attached in the *Authorization* header.

- Replace TODO 4 with the following code.

```
JavaScript
// Call the Microsoft Graph API with the access token.
const response = await fetch(
 `https://graph.microsoft.com/v1.0/me/drive/root/children?
$select=name&$top=10`,
 {
 headers: { Authorization: accessToken },
 }
);
if (response.ok) {
 // Write file names to the console.
 const data = await response.json();
 const names = data.value.map((item) => item.name);
 // Be sure the taskpane.html has an element with Id = item-subject.
 const label = document.getElementById("item-subject");
 // Write file names to task pane and the console.
 const nameText = names.join(", ");
 if (label) label.textContent = nameText;
 console.log(nameText);
```


```
} else {
 const errorText = await response.text();
 console.error("Microsoft Graph call failed - error text: " + errorText);
}
```
Once all the previous code is added to the run function, be sure a button on the task pane calls the run function. Then you can sideload the add-in and try out the code.

## **What is nested app authentication**

Nested app authentication enables SSO for applications that are nested inside of supported Microsoft applications. For example, Excel on Windows runs your add-in inside a webview. In this scenario, your add-in is a nested application running inside Excel, which is the host. NAA also supports nested apps in Teams. For example, if a Teams tab is hosting Excel, and your addin is loaded, it is nested inside Excel, which is also nested inside Teams. Again, NAA supports this nested scenario and you can access SSO to get user identity and access tokens of the signed in user.

## **Best practices**

We recommend the following best practices when using MSAL.js with NAA.

### **Use silent authentication whenever possible**

MSAL.js provides the  acquireTokenSilent  method that handles token renewal by making silent token requests without prompting the user. The method first looks for a valid cached token. If it doesn't find one, the library makes the silent request to Microsoft Entra ID and if there's an active user session, a fresh token is returned.

In certain cases, the  acquireTokenSilent method's attempt to get the token fails. Some examples of this are when there's an expired user session with Microsoft Entra ID or a password change by the user, which requires user interaction. When the acquireTokenSilent fails, you need to call the interactive acquireTokenPopup token method.

### **Have a fallback when NAA isn't supported**

While we strive to provide a high-degree of compatibility with these flows across the Microsoft ecosystem, your add-in may be loaded in an older Office host that does not support NAA. In these cases, your add-in won't support seamless SSO and you may need to fall back to an


alternate method of authenticating the user. In general you'll want to use the MSAL SPA authentication pattern with the Office JS dialog API.

Use the following code to check if NAA is supported when your add-in loads.

JavaScript

Office.context.requirements.isSetSupported("NestedAppAuth", "1.1");

For more information, see the following resources.

- [Outlook sample: How to fall back and support Internet Explorer 11](https://github.com/OfficeDev/Office-Add-in-samples/blob/main/Samples/auth/Outlook-Add-in-SSO-NAA-IE/README.md)
- Authenticate and authorize with the Office dialog API.
- [Microsoft identity sample for SPA and JavaScript](https://github.com/Azure-Samples/ms-identity-javascript-tutorial/blob/main/2-Authorization-I/1-call-graph/README.md)
- [Microsoft identity samples for various app types and frameworks](https://learn.microsoft.com/en-us/entra/identity-platform/sample-v2-code?tabs=apptype)

## **MSAL.js APIs supported by NAA**

The following table shows which APIs are supported when NAA is enabled in the MSAL config.

| Method                      | Supported by NAA      |
|-----------------------------|-----------------------|
| acquireTokenByCode          | No (throws exception) |
| acquireTokenPopup           | Yes                   |
| acquireTokenRedirect        | No (throws exception) |
| acquireTokenSilent          | Yes                   |
| addEventCallback            | Yes                   |
| addPerformanceCallback      | No (throws exception) |
| disableAccountStorageEvents | No (throws exception) |
| enableAccountStorageEvents  | No (throws exception) |
| getAccountByHomeId          | Yes                   |
| getAccountByLocalId         | Yes                   |
| getAccountByUsername        | Yes                   |
| getActiveAccount            | Yes                   |

ノ **Expand table**


| Method                    | Supported by NAA      |
|---------------------------|-----------------------|
| getAllAccounts            | Yes                   |
| getConfiguration          | Yes                   |
| getLogger                 | Yes                   |
| getTokenCache             | No (throws exception) |
| handleRedirectPromise     | No                    |
| initialize                | Yes                   |
| initializeWrapperLibrary  | Yes                   |
| loginPopup                | Yes                   |
| loginRedirect             | No (throws exception) |
| logout                    | No (throws exception) |
| logoutPopup               | No (throws exception) |
| logoutRedirect            | No (throws exception) |
| removeEventCallback       | Yes                   |
| removePerformanceCallback | No (throws exception) |
| setActiveAccount          | No                    |
| setLogger                 | Yes                   |
| ssoSilent                 | Yes                   |

## **Security reporting**

If you find a security issue with our libraries or services, report the issue to [secure@microsoft.com](mailto:secure@microsoft.com) with as much detail as you can provide. Your submission may be eligible for a bounty through the [Microsoft Bounty](https://aka.ms/bugbounty)  program. Don't post security issues to GitHub or any other public site. We'll contact you shortly after receiving your issue report. We encourage you to get new security incident notifications by visiting [Microsoft technical security](https://technet.microsoft.com/security/dd252948) [notifications](https://technet.microsoft.com/security/dd252948)  to subscribe to Security Advisory Alerts.

## **Code samples**


| Sample name                                                                           | Description                                                                                                                                                                                                         |
|---------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Office Add-in with SSO using nested                                                   | Shows how to use NAA in an Office Add-in to access Microsoft                                                                                                                                                        |
| app authentication                                                                    | Graph APIs for the signed-in user.                                                                                                                                                                                  |
| Outlook add-in with SSO using                                                         | Shows how to use NAA in an Outlook Add-in to access Microsoft                                                                                                                                                       |
| nested app authentication                                                             | Graph APIs for the signed-in user.                                                                                                                                                                                  |
| Implement SSO in events in an<br>Outlook add-in using nested app<br>authentication    | Shows how to use NAA and SSO in Outlook add-in events.                                                                                                                                                              |
| Send identity claims to resources<br>using nested app authentication<br>(NAA) and SSO | Shows how to send the signed-in user's identity claims (such as<br>name, email, or a unique ID) to a resource such as a database.<br>This sample replaces an obsolete pattern for legacy Exchange<br>Online tokens. |
| Outlook add-in with SSO using                                                         | Shows how to implement a fallback authentication strategy when                                                                                                                                                      |
| nested app authentication including                                                   | NAA isn't available and the add-in needs to support Outlook                                                                                                                                                         |
| Internet Explorer fallback                                                            | versions that still use Internet Explorer 11.                                                                                                                                                                       |

### **See also**

- [NAA FAQ](https://aka.ms/NAAFAQ)
- [Nested app authentication in Microsoft Teams.](https://learn.microsoft.com/en-us/microsoftteams/platform/concepts/authentication/nested-authentication)


# **Authenticate and authorize with the Office dialog API**

Article • 12/01/2023

Always use the Office dialog API to authenticate and authorize users with your Office Add-in. You must also use the Office dialog API if you're implementing fallback authentication when single sign-on (SSO) can't be used.

Office Add-ins run in an iframe when opened in Office on the web. Many identity authorities, also called Secure Token Services (STS), prevent their sign-in page from opening in an iframe. These include Google, Facebook, and services protected by the Microsoft identity platform (formerly Azure AD V 2.0) such as a Microsoft account, a Microsoft 365 Education or work account, or other common account. Also security features implemented in the webview when Office Add-ins run in Office on Windows, or Office on Mac can prevent sign-in pages from working correctly.

For authorization to work correctly, the sign-in page must open in a separate browser or webview control instance. This is why Office provides the Office dialog API, specifically the [displayDialogAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.ui) method.

#### 7 **Note**

- This article assumes that you're familiar with **Use the Office dialog API in your Office Add-ins**.
- For brevity hereafter, this article uses "browser instance" to mean "browser or webview instance".

The dialog opened with this API has the following characteristics.

- It is [nonmodal](https://en.wikipedia.org/wiki/Dialog_box) .
- It is a completely separate browser instance from the task pane, meaning:
	- It has its own runtime environment and window object and global variables.
	- There is no shared execution environment with the task pane.
	- It doesn't share the same session storage (the [Window.sessionStorage](https://developer.mozilla.org/docs/Web/API/Window/sessionStorage) property) as the task pane.
- The first page opened in the dialog must be hosted in the same domain as the task pane, including protocol, subdomains, and port, if any.
- The dialog can send information back to the task pane by using the [messageParent](https://learn.microsoft.com/en-us/javascript/api/office/office.ui#office-office-ui-messageparent-member(1)) method. We recommend that this method be called only from a


page that is hosted in the same domain as the task pane, including protocol, subdomains, and port. Otherwise, there are complications in how you call the method and process the message. For more information, see Cross-domain messaging to the host runtime.

By default, the dialog opens in a new web view control, not in an iframe. This ensures that it can open the sign-in page of an identity provider. As you'll see later in this article, the characteristics of the Office dialog have implications for how you use authentication or authorization libraries such as Microsoft Authentication Library (MSAL) and Passport.

#### 7 **Note**

To configure the dialog to open in a floating iframe, pass the displayInIframe: true option in the call to displayDialogAsync . Do *not* do this when you're using the Office dialog API for sign in.

### **Authentication flow with the Office dialog**

The following is a typical authentication flow.


- 1. The first page that opens in the dialog is a page (or other resource) that is hosted in the add-in's domain; that is, the same domain as the task pane window. This page can have a UI that only says "Please wait, we are redirecting you to the page


where you can sign in to *NAME-OF-PROVIDER*." The code in this page constructs the URL of the identity provider's sign-in page with information that is either passed to the dialog as described in Pass information to the dialog or is hardcoded into a configuration file of the add-in, such as a web.config file.

- 2. The dialog window then redirects to the sign-in page. The URL includes a query parameter that tells the identity provider to redirect the dialog window to a specific page after the user signs in. We'll call this page **redirectPage.html** in this article. The results of the sign-in attempt can be passed to the task pane with a call of messageParent on this page. *We recommend that this be a page in the same domain as the host window*.
- 3. The identity provider's service processes the incoming GET request from the dialog window. If the user is already signed in, it immediately redirects the window to **redirectPage.html** and includes user data as a query parameter. If the user isn't already signed in, the provider's sign-in page appears in the window, and the user signs in. For most providers, if the user can't sign in successfully, the provider shows an error page in the dialog window and does not redirect to **redirectPage.html**. The user must close the window by selecting the **X** in the corner. If the user successfully signs in, the dialog window is redirected to **redirectPage.html** and user data is included as a query parameter.
- 4. When the **redirectPage.html** page opens, it calls messageParent to report the success or failure to the task pane page and optionally also report user data or error data. Other possible messages include passing an access token or telling the task pane that the token is in storage.
- 5. The DialogMessageReceived event fires in the task pane page and its handler closes the dialog window and may further process of the message.

### **Support multiple identity providers**

If your add-in gives the user a choice of providers, such as a Microsoft account, Google, or Facebook, you need a local first page (see preceding section) that provides a UI for the user to select a provider. Selection triggers the construction of the sign-in URL and redirection to it.

### **Authorization of the add-in to an external resource**

In the modern web, users and web applications are security principals. The application has its own identity and permissions to an online resource such as Microsoft 365, Google Plus, Facebook, or LinkedIn. The application is registered with the resource provider before it is deployed. The registration includes:


- A list of the permissions that the application needs.
- A URL to which the resource service should return an access token when the application accesses the service.

When a user invokes a function in the application that accesses the user's data in the resource service, they are prompted to sign in to the service and then prompted to grant the application the permissions it needs to the user's resources. The service then redirects the sign-in window to the previously registered URL and passes the access token. The application uses the access token to access the user's resources.

You can use the Office dialog API to manage this process by using a flow that is similar to the one described for users to sign in. The only differences are:

- If the user hasn't previously granted the application the permissions it needs, the user is prompted to do so in the dialog after signing in.
- Your code in the dialog window sends the access token to the host window either by using messageParent to send the stringified access token or by storing the access token where the host window can retrieve it (and using messageParent to tell the host window that the token is available). The token has a time limit, but while it lasts, the host window can use it to directly access the user's resources without any further prompting.

Some authentication sample add-ins that use the Office dialog API for this purpose are listed in Samples.

## **Use authentication libraries with the dialog**

Because the Office dialog and the task pane run in different browser runtime instances, you must use authentication/authorization libraries differently from how they are used when authentication and authorization take place in the same window. The following sections describe the ways that you can and can't use these libraries.

### **You usually can't use the library's internal cache to store tokens**

Typically, auth-related libraries provide an in-memory cache to store the access token. If subsequent calls to the resource provider (such as Google, Microsoft Graph, Facebook, etc.) are made, the library will first check to see if the token in its cache is expired. If it is unexpired, the library returns the cached token rather than making another round-trip to the STS for a new token. But this pattern isn't usable in Office Add-ins. Since the sign


in process occurs in the Office dialog's browser instance, the token cache is in that instance.

Closely related to this is the fact that a library will typically provide both interactive and "silent" methods for getting a token. When you can do both the authentication and the data calls to the resource in the same browser instance, your code calls the silent method to obtain a token just before your code adds the token to the data call. The silent method checks for an unexpired token in the cache and returns it, if there is one. Otherwise, the silent method calls the interactive method which redirects to the STS's sign-in. After sign-in completes, the interactive method returns the token, but also caches it in memory. But when the Office dialog API is being used, the data calls to the resource, which would call the silent method, are in the task pane's browser instance. The library's token cache does not exist in that instance.

As an alternative, your add-in's dialog browser instance can directly call the library's interactive method. When that method returns a token, your code must explicitly store the token someplace where the task pane's browser instance can retrieve it, such as local storage or a server-side database.

#### 7 **Note**

Changes to browser security will affect your strategy for token handling.

- If your add-in runs in **Office on the web** in the Microsoft Edge Legacy (non-Chromium) or Safari browser, the dialog and task pane don't share the same **[local storage](https://www.w3schools.com/html/html5_webstorage.asp)** , so it can't be used to communicate between them.
- Starting in Version 115 of Chromium-based browsers, such as Chrome and Edge, **[storage partitioning](https://developer.chrome.com/docs/privacy-sandbox/storage-partitioning/)** is being tested to prevent specific side-channel cross-site tracking (see also **[Microsoft Edge browser policies](https://learn.microsoft.com/en-us/deployedge/microsoft-edge-policies#defaultthirdpartystoragepartitioningsetting)**). This means that data stored by storage APIs, such as local storage, are only available to contexts with the same origin and the same top-level site. To work around this, in your browser, go to **chrome://flags** or **edge://flags**, then set the **Experimental third-party storage partitioning (#third-party-storagepartitioning)** flag to **Disabled**. Where possible, we recommend to pass data between the dialog and task pane using the **[messageParent](https://learn.microsoft.com/en-us/javascript/api/office/office.ui#office-office-ui-messageparent-member(1))** and **[messageChild](https://learn.microsoft.com/en-us/javascript/api/office/office.dialog#office-office-dialog-messagechild-member(1))** methods as described in **Use the Office dialog API in your Office Add-ins**.

Another option is to pass the token to the task pane with the messageParent method. This alternative is only possible if the interactive method stores the access token in a


place where your code can read it. Sometimes a library's interactive method is designed to store the token in a private property of an object that is inaccessible to your code.

### **You usually can't use the library's "auth context" object**

Often, an auth-related library has a method that both obtains a token interactively and also creates an "auth-context" object which the method returns. The token is a property of the object (possibly private and inaccessible directly from your code). That object has the methods that get data from the resource. These methods include the token in the HTTP Requests that they make to the resource provider (such as Google, Microsoft Graph, Facebook, etc.).

These auth-context objects, and the methods that create them, are not usable in Office Add-ins. Since the sign-in occurs in the Office dialog's browser instance, the object would have to be created there. But the data calls to the resource are in the task pane browser instance and there is no way to get the object from one instance to another. For example, you can't pass the object with messageParent because messageParent can only pass string values. A JavaScript object with methods can't be reliably stringified.

### **How you can use libraries with the Office dialog API**

In addition to, or instead of, monolithic "auth context" objects, most libraries provide APIs at a lower level of abstraction that enable your code to create less monolithic helper objects. For example, [MSAL.NET](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/wiki#conceptual-documentation) v. 3.x.x has an API to construct a sign-in URL, and another API that constructs an AuthResult object that contains an access token in a property that is accessible to your code. For examples of MSAL.NET in an Office Add-in [see:](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET) [Office Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET) [and Outlook Add-in Microsoft Graph](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET) ASP.NET [. For an example of using](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-Microsoft-Graph-React) [msal.js](https://github.com/AzureAD/microsoft-authentication-library-for-js) [in an add-in, see Office Add-in Microsoft](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-Microsoft-Graph-React) Graph React .

For more information about authentication and authorization libraries, see Microsoft Graph: Recommended libraries and Other external services: Libraries.

## **Samples**

- [Office Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET) : An ASP.NET based add-in (Excel, Word, or PowerPoint) that uses the MSAL.NET library and the Authorization Code Flow to sign in and get an access token for Microsoft Graph data.
- [Outlook Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET) : Just like the one above, but the Office application is Outlook.


- [Office Add-in Microsoft Graph React](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-Microsoft-Graph-React) : A NodeJS based add-in (Excel, Word, or PowerPoint) that uses the msal.js library and the Implicit Flow to sign in and get an access token for Microsoft Graph data.
## **See also**

- Authorize external services in your Office Add-in
- Use the Office dialog API in your Office Add-ins

# **Authorize to Microsoft Graph from an Office Add-in**

Article • 01/23/2024

Your add-in can get authorization to Microsoft Graph data by obtaining an access token to Microsoft Graph from the Microsoft identity platform. Use either the Authorization Code flow or the Implicit flow just as you would in other web applications but with one exception: The Microsoft identity platform doesn't allow its sign-in page to open in an iframe. When an Office Add-in is running in *Office on the web*, the task pane is an iframe. This means you'll need to open the sign-in page in a dialog box by using the Office dialog API. This affects how you use authentication and authorization helper libraries. For more information, see Authentication with the Office dialog API.

#### 7 **Note**

If you're implementing SSO and plan to access Microsoft Graph, see **Authorize to Microsoft Graph with SSO**.

For information about programming authentication using the Microsoft identity platform, see [Microsoft identity platform documentation](https://learn.microsoft.com/en-us/azure/active-directory/develop). You'll find tutorials and guides in that documentation set, as well as links to relevant samples. Once again, you may need to adjust the code in the samples to run in the Office dialog box to account for the Office dialog box that runs in a separate process from the task pane.

After your code obtains the access token to Microsoft Graph, either it passes the access token from the dialog box to the task pane, or it stores the token in a database and signals the task pane that the token is available. (See Authentication with the Office dialog API for details.) Code in the task pane requests data from Microsoft Graph and includes the token in those requests. For more information about calling Microsoft Graph and the Microsoft Graph SDKs, see [Microsoft Graph documentation](https://learn.microsoft.com/en-us/graph/).

### **Recommended libraries and samples**

We recommend that you use the following libraries when accessing Microsoft Graph.

- For add-ins using a server-side with a .NET-based framework such as .NET Core or ASP.NET, use [MSAL.NET](https://github.com/AzureAD/microsoft-authentication-library-for-dotnet/wiki#conceptual-documentation) .
- For add-ins using a NodeJS-based server-side, use [Passport Azure AD](https://github.com/AzureAD/passport-azure-ad) .
- For add-ins using the Implicit flow, use [msal.js](https://github.com/AzureAD/microsoft-authentication-library-for-js/wiki) .


For more information about recommended libraries for working with Microsoft Identity Platform (formerly AAD v.2.0), see [Microsoft identity platform authentication libraries](https://learn.microsoft.com/en-us/azure/active-directory/develop/reference-v2-libraries).

The following samples get Microsoft Graph data from an Office Add-in.

- [Office Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET)
- [Outlook Add-in Microsoft Graph ASP.NET](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET)
- [Office Add-in Microsoft Graph React](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-Microsoft-Graph-React)

## **Google Chrome 3rd party cookie support**

Google Chrome is phasing out 3rd party cookies in 2024 and introducing a feature named Tracking Prevention. If Tracking Prevention is enabled in the Chrome browser, your add-in will not be able to use any 3rd party cookies. Your add-in may encounter issues when authenticating the user, such as multiple sign-on requests, or errors.

[For improved authentication experiences, see Using device state for an improved SSO](https://devblogs.microsoft.com/identity/managed-devices-for-blocked-third-party-cookies/) experience on browsers with blocked third-party cookies .

For more information about the Google Chrome rollout, see the following resources:

- [The next step toward phasing out third-party cookies in Chrome](https://blog.google/products/chrome/privacy-sandbox-tracking-protection/) .
- [The Privacy Sandbox Timeline for the Web](https://privacysandbox.com/open-web/#the-privacy-sandbox-timeline)


# **Enable automatic password saving in Microsoft Edge WebView2**

Article • 04/11/2025

Most browsers can automatically save passwords on behalf of the user when they sign in. This helps users manage passwords in a secure environment. Microsoft Edge WebView2 also supports automatic password saving. When your add-in is loaded in Microsoft Office on Windows, Webview2 hosts your add-in. To enable automatic password saving, add HTML input controls for the username and password, as shown in the following HTML.

```
HTML
<div>
 <label for="username">Username:</label><br/>
 <input type="text" id="username" name="username" /><br/>

 <label for="password">Password:</label><br/>
 <input type="password" id="password" name="password" /><br/>

 <button id="btn" type="button">Sign in</button>
</div>
```
In the button click event handler for the sign-in button, call the authentication library of your choice to sign in the user. Once the sign-in is complete, redirect to a new web page. When WebView2 sees the redirect, and the username and password, it prompts the user to offer to automatically save the credentials. The following code shows how to handle the sign-in button click event.

```
JavaScript
async function btnSignIn() {
 // Get the username and password credentials entered by the user.
 const username = document.getElementById("username").value;
 const pwd = document.getElementById("password").value;
 try {
 // Sign in the user. This is a placeholder for the actual sign-in logic.
 await signInUser(username, pwd);
 // Redirect to a success page to trigger the password autosave.
 window.location.href = "/home.html";
 }
 catch (error) {
 console.error("Sign in failed: " + error);
 return;
```


#### } }

### **How the user manages passwords**

When the user enters a new password in your add-in, and your add-in redirects to a new web page, WebView2 asks the user if they want to save their username and password. The next time your add-in prompts for credentials, WebView2 automatically enters the user's account information.

Users remove saved passwords by deleting The WebView2 local cache folder at %LOCALAPPDATA%\Microsoft\Office\16.0\Wef\webview2\ . If your add-in relies on automatically saving passwords, you should document this folder location so users can remove their passwords.

## **Related content**

- [Microsoft Edge WebView2](https://developer.microsoft.com/microsoft-edge/webview2)
- Browsers and webview controls used by Office Add-ins

# **Build your first Project task pane add-in**

Article • 09/17/2024

In this article, you'll walk through the process of building a Project task pane add-in.

#### **Prerequisites**

- Node.js (the latest LTS version). Visit the [Node.js site](https://nodejs.org/) to download and install the right version for your operating system.
- The latest version of Yeoman and the Yeoman generator for Office Add-ins. To install these tools globally, run the following command via the command prompt.

command line npm install -g yo generator-office

7 **Note**

Even if you've previously installed the Yeoman generator, we recommend you update your package to the latest version from npm.

- Office connected to a Microsoft 365 subscription (including Office on the web).
#### 7 **Note**

If you don't already have Office, you might qualify for a Microsoft 365 E5 developer subscription through the **[Microsoft 365 Developer Program](https://aka.ms/m365devprogram)** ; for details, see the **[FAQ](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-)**. Alternatively, you can **[sign up for a 1-month free trial](https://www.microsoft.com/microsoft-365/try)** or **[purchase a Microsoft 365 plan](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g)** .

- Project 2016 or later on Windows
## **Create the add-in**

Run the following command to create an add-in project using the Yeoman generator. A folder that contains the project will be added to the current directory.


#### 7 **Note**

When you run the yo office command, you may receive prompts about the data collection policies of Yeoman and the Office Add-in CLI tools. Use the information that's provided to respond to the prompts as you see fit.

When prompted, provide the following information to create your add-in project.

- **Choose a project type:** Office Add-in Task Pane project
- **Choose a script type:** JavaScript
- **What do you want to name your add-in?** My Office Add-in
- **Which Office client application would you like to support?** Project

After you complete the wizard, the generator creates the project and installs supporting Node components.

## **Explore the project**

The add-in project that you've created with the Yeoman generator contains sample code for a very basic task pane add-in.

- The **./manifest.xml** file in the root directory of the project defines the settings and capabilities of the add-in.
- The **./src/taskpane/taskpane.html** file contains the HTML markup for the task pane.


- The **./src/taskpane/taskpane.css** file contains the CSS that's applied to content in the task pane.
- The **./src/taskpane/taskpane.js** file contains the Office JavaScript API code that facilitates interaction between the task pane and the Office client application. In this quick start, the code sets the Name field and Notes field of the selected task of a project.

### **Try it out**

- 1. Navigate to the root folder of the project.
command line

cd "My Office Add-in"

- 2. Start the local web server.

```
7 Note
```
Office Add-ins should use HTTPS, not HTTP, even while you're developing. If you're prompted to install a certificate after you run one of the following commands, accept the prompt to install the certificate that the Yeoman generator provides. You may also have to run your command prompt or terminal as an administrator for the changes to be made.

Run the following command in the root directory of your project. When you run this command, the local web server will start.

command line

npm run dev-server

- 3. In Project, create a simple project plan.
- 4. Load your add-in in Project by following the instructions in Sideload Office Add-ins on Windows.
- 5. Select a single task within the project.
- 6. At the bottom of the task pane, choose the **Run** link to rename the selected task and add notes to the selected task.


|           | B                                                                                                                                                                     |      |                           | Simple project plan - Project Professional |                                             |        | Gantt Chart Tools      |                                         |                                                                      |                                                       |                 |   | D | ×      |
|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|------|---------------------------|--------------------------------------------|---------------------------------------------|--------|------------------------|-----------------------------------------|----------------------------------------------------------------------|-------------------------------------------------------|-----------------|---|---|--------|
|           | File                                                                                                                                                                  | lask | Resource                  | Report<br>Project                          | Help<br>View                                | Team   | Format                 |                                         |                                                                      | O Tell me what you want to do                         |                 | 3 | 0 | ×      |
|           | Subproject                                                                                                                                                            |      | Get Add-ins<br>My Add-ins | Project<br>Information Fields Sprints      | Custom Manage Links Between<br>Projects     |        | Change<br>Working Time | Calculate<br>Project Baseline · Project | Set<br>Move                                                          | Status Date: NA<br>= Update Project                   | ABC<br>Spelling |   |   |        |
|           | Insert                                                                                                                                                                |      | Add-ins                   |                                            | Properties                                  |        |                        | Schedule                                |                                                                      | Status                                                | Proofina        |   |   |        |
|           | New task name<br>d 4/24/19 - Fri 4/26/19<br>Today<br>Apr 28, '19<br>Start<br>Summary #1<br>Summary #2<br>Mon 4/22/19<br>Mon 4/29/19 - Thu 5/9/19<br>Mon 4/22/19 - Fri |      |                           |                                            | Sun 5/5/19                                  |        |                        |                                         | My Office Add-in                                                     |                                                       |                 |   |   | ×<br>> |
| IMELIN    |                                                                                                                                                                       |      |                           |                                            | May 5, "19<br>May 12, "19<br>Summary<br>Mon |        |                        | Finish<br>Wed 5/15/19                   |                                                                      | Discover what Office Add-ins<br>can do for you today! |                 |   |   |        |
|           |                                                                                                                                                                       |      | Task                      | Mode ▼ Task Name                           | 19<br>Duration                              | W<br>5 | Apr 21, '19<br>T       | Apr 28, "19<br>5<br>M                   |                                                                      | വ<br>Achieve more with Office integration             |                 |   |   |        |
|           | 2                                                                                                                                                                     |      | 1<br>P                    | 4 Summary #1<br>Task 1                     | 5 days<br>2 days                            |        |                        |                                         |                                                                      |                                                       |                 |   |   |        |
|           | 3                                                                                                                                                                     |      | 0                         | New task name                              | 3 days                                      |        |                        |                                         | Unlock features and functionality<br>Create and visualize like a pro |                                                       |                 |   |   |        |
|           |                                                                                                                                                                       |      | P                         | Summary #1 Complete                        | 0 days                                      |        |                        | 4/26                                    |                                                                      |                                                       |                 |   |   |        |
| ANTT CHAF | 5                                                                                                                                                                     |      | r                         | · Summary #2                               | 9 days                                      |        |                        |                                         |                                                                      |                                                       |                 |   |   |        |
|           | 6                                                                                                                                                                     |      | । ਤੇ                      | Task 3                                     | 3 days                                      |        |                        |                                         |                                                                      |                                                       |                 |   |   |        |
|           |                                                                                                                                                                       |      | P                         | Task 4                                     | 4 days                                      |        |                        |                                         |                                                                      | Modify the source files, then click Run.              |                 |   |   |        |
|           | 8                                                                                                                                                                     |      | P                         | Task 5                                     | 2 days                                      |        |                        |                                         |                                                                      |                                                       |                 |   |   |        |
|           | 9                                                                                                                                                                     |      | मी                        | Summary #2 Complete                        | 0 days                                      |        |                        |                                         |                                                                      |                                                       |                 |   |   |        |
|           | 10                                                                                                                                                                    |      | T                         | · Summary #3                               | 3 days                                      |        |                        |                                         |                                                                      |                                                       |                 |   |   |        |
|           |                                                                                                                                                                       |      |                           | Task 6                                     | 3 days                                      |        |                        |                                         |                                                                      |                                                       | Run             |   |   | >      |
| Ready     | ব                                                                                                                                                                     |      |                           | New Tasks : Manually Schecluled            | -4                                          |        |                        |                                         | -                                                                    |                                                       |                 |   |   |        |

- 7. When you want to stop the local web server and uninstall the add-in, follow these instructions:
	- To stop the server, run the following command.

| command line |  |  |  |  |  |
|--------------|--|--|--|--|--|
| npm stop     |  |  |  |  |  |

- To uninstall the sideloaded add-in, see Remove a sideloaded add-in.
#### **Next steps**

Congratulations, you've successfully created a Project task pane add-in! Next, learn more about the capabilities of a Project add-in and explore common scenarios.

**Project add-ins**

## **Troubleshooting**

- Ensure your environment is ready for Office development by following the instructions in Set up your development environment.
- Some of the sample code uses ES6 JavaScript. This isn't compatible with older versions of Office that use the Trident (Internet Explorer 11) browser engine. For information on how to support those platforms in your add-in, see Support older Microsoft webviews and Office versions. If you don't already have a Microsoft 365


subscription to use for development, you might qualify for a Microsoft 365 E5 developer subscription through the [Microsoft 365 Developer Program](https://aka.ms/m365devprogram) ; for details, see the [FAQ](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-). Alternatively, you can [sign up for a 1-month free trial](https://www.microsoft.com/microsoft-365/try) or [purchase a Microsoft 365 plan](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g) .

- The automatic npm install step Yo Office performs may fail. If you see errors when trying to run npm start , navigate to the newly created project folder in a command prompt and manually run npm install . For more information about Yo Office, see Create Office Add-in projects using the Yeoman Generator.
#### **See also**

- Develop Office Add-ins
- Core concepts for Office Add-ins
- Using Visual Studio Code to publish

# **Authentication patterns**

07/30/2025

Add-ins may require users to sign-in or sign-up in order to access features and functionality. Input boxes for username and password or buttons that start third party credential flows are common interface controls in authentication experiences. A simple and efficient authentication experience is an important first step to getting users started with your add-in.

## **Best practices**

ノ **Expand table**

| Do                                                                                                                   | Don't                                                                                                     |
|----------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|
| Prior to sign-in, describe the value of your add-in or<br>demonstrate functionality without requiring an<br>account. | Expect users to sign-in without understanding<br>the value and benefits of your add-in.                   |
| Guide users through authentication flows with a                                                                      | Draw attention to secondary and tertiary tasks                                                            |
| primary, highly visible button on each screen.                                                                       | with competing buttons and calls to action.                                                               |
| Use clear button labels that describe specific tasks<br>like "Sign in" or "Create account".                          | Use vague button labels like "Submit" or "Get<br>started" to guide users through authentication<br>flows. |
| Use a dialog to focus users' attention on                                                                            | Overcrowd your task pane with a first-run                                                                 |
| authentication forms.                                                                                                | experience and authentication forms.                                                                      |
| Find small efficiencies in the flow like auto-focusing                                                               | Add unnecessary steps to the interaction like                                                             |
| on input boxes.                                                                                                      | requiring users to click into form fields.                                                                |
| Provide a way for users to sign out and<br>reauthenticate.                                                           | Force users to uninstall to switch identities.                                                            |

## **Authentication flow**

- 1. First-Run Placemat Place your sign-in button as a clear call-to action inside your addin's first-run experience.


- 2. Identity Provider Choices Dialog Display a clear list of identity providers including a username and password form if applicable. Your add-in UI may be blocked while the authentication dialog is open.

|  | My add-insign-in<br>×<br>My Add-in name<br>Select your sign-in preference<br>Username | My Add-in Name<br>(1) Info - please sign-in with dialog window.<br>× |
|--|---------------------------------------------------------------------------------------|----------------------------------------------------------------------|
|  | Password<br>Sign In<br>Don't have an account? Sign Up<br>Sign in with Microsoft       |                                                                      |
|  |                                                                                       |                                                                      |

- 3. Identity Provider Sign-in The identity provider will have their own UI. Microsoft Entra ID allows customization of sign-in and access panel pages for consistent look and feel with your service. For more information, see [Configure your company branding](https://learn.microsoft.com/en-us/entra/fundamentals/how-to-customize-branding).


| My Add-in Name - Dialog Title | 8                                                                           |                                                                                                                 |
|-------------------------------|-----------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
|                               | My Add-in Name                                                              | Converter<br>网<br>(i) Info - Please sign in with the pop-up window.                                             |
|                               | Work or School, or personal Microsoft Account<br>Email or phone<br>Password | Ogo                                                                                                             |
|                               | □ Keep me signed in<br>Sign In                                              | Welcome                                                                                                         |
|                               | Can't access your account?<br>Other sign-in options<br>Get a new account    | Discover what this add-in<br>can do for you today!                                                              |
|                               | 2016 Microsoft<br>  Microsoft<br>Terms of use   Privacy & Cookies           | ള  Achieve more with Office integration<br>Unlock features and functionality<br>Create and visualize like a pro |
|                               |                                                                             | Sign in<br>1                                                                                                    |

- 4. Progress Indicate progress while settings and UI load.

|  | My add-in sign-in<br>×         |                                                  |
|--|--------------------------------|--------------------------------------------------|
|  |                                | My Add-in Name                                   |
|  | My Add-in Brand<br>Authorizing | ① Info - please sign-in with dialog window.<br>× |

### 7 **Note**

When using Microsoft's Identity service you'll have the opportunity to use a branded signin button that is customizable to light and dark themes. Learn more.

## **Single Sign-On authentication flow**


#### 7 **Note**

The single sign-on API is currently supported for Word, Excel, Outlook, and PowerPoint. For more information about single sign-on support, see **[IdentityAPI requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/identity-api-requirement-sets)**. If you're working with an Outlook add-in, be sure to enable Modern Authentication for the Microsoft 365 tenancy. For information about how to do this, see **[Enable or disable](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online) [modern authentication for Outlook in Exchange Online](https://learn.microsoft.com/en-us/exchange/clients-and-mobile-in-exchange-online/enable-or-disable-modern-authentication-in-exchange-online)**.

Use single sign-on for a smoother end-user experience. The user's identity within Office (either a Microsoft account or a Microsoft 365 identity) is used to sign in to your add-in. As a result users only sign in once. This removes friction in the experience making it easier for your customers to get started.

- 1. As an add-in is being installed, a user will see a consent window similar to the one following:
### 7 **Note**

The add-in publisher will have control over the logo, strings and permission scopes included in the consent window. The UI is pre-configured by Microsoft.

- 2. The add-in will load after the user consents. It can extract and display any necessary user customized information.


### **See also**

- Learn more about developing SSO Add-ins

# **Navigation patterns**

Article • 05/18/2023

The main features of an add-in are accessed through specific command types and limited screen area. It's important that navigation is intuitive, provides context, and allows the user to move easily throughout the add-in.

### **Best practices**

| Do                                                                                                | Don't                                                                                                     |
|---------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|
| Ensure the user has a clearly visible navigation                                                  | Don't complicate the navigation process by                                                                |
| option.                                                                                           | using non-standard UI.                                                                                    |
| Utilize the following components as applicable<br>to allow users to navigate through your add-in. | Don't make it difficult for the user to<br>understand their current place or context within<br>the add-in |

## **Command Bar**

The CommandBar is a surface within the task pane that houses commands that operate on the content of the window, panel, or parent region it resides above. Optional features include a hamburger menu access point, search, and side commands.


The tab bar shows navigation using buttons with vertically stacked text and icons. Use the tab bar to provide navigation using tabs with short and descriptive titles.

### **Back Button**

The back button allows users to recover from a drill-down navigational action. This pattern helps ensure users follow an ordered series of steps.


# **Office UI elements for Office Add-ins**

Article • 03/12/2025

You can use several types of UI elements to extend the Office UI, including add-in commands and HTML containers. These UI elements look like a natural extension of Office and work across platforms. You can insert your custom web-based code into any of these elements.

The following image shows the types of Office UI elements that you can create.

## **Add-in commands**

Use add-in commands to add entry points to your add-in to the Office app ribbon. Commands start actions in your add-in either by running JavaScript code, or by launching an HTML container. You can create two types of add-in commands.


| Command type                       | Description                                                                                                                                                                                          |
|------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Ribbon buttons,<br>menus, and tabs | Use to add custom buttons, menus (dropdowns), or tabs to the default<br>ribbon in Office. Use buttons and menus to trigger an action in Office. Use<br>tabs to group and organize buttons and menus. |
| Context menus                      | Use to extend the default context menu. Context menus are displayed when,<br>for example, users right-click (or select and hold) text in an Office document<br>or an object in Excel.                |

### **HTML containers**

Use HTML containers to embed HTML-based UI code within Office clients. These web pages can then reference the Office JavaScript API to interact with content in the document. You can create three types of HTML containers.

ノ **Expand table**

| HTML<br>container  | Description                                                                                                                                                                                                                                                                      |
|--------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Task panes         | Display custom UI in the right pane of the Office document. Use task panes to<br>allow users to interact with your add-in side-by-side with the Office document.                                                                                                                 |
| Content<br>add-ins | Display custom UI embedded within Office documents. Use content add-ins to<br>allow users to interact with your add-in directly within the Office document. For<br>example, you might want to show external content such as videos or data<br>visualizations from other sources. |
| Dialog<br>boxes    | Display custom UI in a dialog box that overlays the Office document. Use a dialog<br>box for interactions that require focus and more real estate, and don't require a<br>side-by-side interaction with the document.                                                            |

### **See also**

- Add-in commands for Excel, Word, and PowerPoint
- Task panes
- Content add-ins
- Dialog boxes


# **Add-in commands**

08/13/2025

Add-in commands are UI elements that extend the Office UI and start actions in your add-in. You can use add-in commands to add a button on the ribbon or an item to a context menu. When users select an add-in command, they initiate actions such as running JavaScript code, or showing a page of the add-in in a task pane. Add-in commands help users find and use your add-in, which can help increase your add-in's adoption and reuse, and improve customer retention.

#### 7 **Note**

- SharePoint catalogs don't support add-in commands. You can deploy add-in commands via the **[integrated apps portal](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/test-and-deploy-microsoft-365-apps)** or **[AppSource](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/submit-to-appsource-via-partner-center)**, or use **sideloading** to deploy your add-in command for testing.
- Content add-ins don't currently support add-in commands.

## **Types of add-in commands**

There are two types of add-in commands, based on the kind of action that the command triggers.

- **Task pane commands**: The button or menu item opens the add-in's task pane. You add this kind of add-in command with markup in the manifest. The "code behind" the command is provided by Office.
- **Function commands**: The button or menu item runs any arbitrary JavaScript. The code almost always calls APIs in the Office JavaScript Library, but it doesn't have to. This type of add-in typically displays no UI other than the button or menu item itself. Note the following about function commands:
	- The runtime in which the function command runs is a full browser-based runtime. It can render HTML and call out to the Internet to send or get data.
	- The runtime closes when either the function completes or 5 minutes have passed, whichever is earlier.
	- The function that is triggered can call the [displayDialogAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.ui?view=common-js&preserve-view=true#office-office-ui-displaydialogasync-member(1)) method to show a dialog. This is a good way to display an error, show progress, or prompt the user for input.


#### 7 **Note**

Because of the 5-minute timeout, the dialog should be designed so that users complete their interaction and close it within 5 minutes. Your add-in should use a task pane for longer interactions.

- If the add-in is configured to use a shared runtime, the function can also call the [showAsTaskpane](https://learn.microsoft.com/en-us/javascript/api/office/office.addin#office-office-addin-showastaskpane-member(1)) method.
#### **Tip**

Function commands aren't the only way to run arbitrary JavaScript in an add-in. An add-in can also include:

- Custom handlers for certain events, such as a user opening an new message pane in Outlook.
- Custom **Copilot agents** that take actions in response to natural language requests from the add-in's users.

## **Location of add-in commands**

When a user installs an add-in, the add-in's commands are found on the ribbon, in a built-in Office tab or a custom tab that is specified in the manifest. (You can also put add-in commands on a custom contextual tab that your add-in code defines at runtime.) They appear in the UI as a button or an item in a dropdown menu.

As the ribbon or action bar gets more crowded, add-in commands are displayed in the overflow menu. Commands for the same add-in are usually grouped together.

In Office on the web, if you're using the single-line or simplified ribbon layout, the add-in name isn't shown on the ribbon. Only the add-in's command icon is shown.

### **Excel, PowerPoint, and Word**

The following shows an example of add-in commands in a custom group on the **Data** tab of the Excel ribbon.


|                                                                        |                                                          | Table Tools                                                     |                                           | Book1 - Excel                             |                                                      |                      |                                                  |                  |                      |                                                                     |   | D       |  |
|------------------------------------------------------------------------|----------------------------------------------------------|-----------------------------------------------------------------|-------------------------------------------|-------------------------------------------|------------------------------------------------------|----------------------|--------------------------------------------------|------------------|----------------------|---------------------------------------------------------------------|---|---------|--|
| Data<br>Review                                                         | View<br>Power Pivot                                      | Test Addin<br>Design                                            | Tell me what you want to do               |                                           |                                                      |                      |                                                  |                  |                      |                                                                     |   | Q Share |  |
| Show Queries<br>From Table<br>Refresh<br>Recent Sources<br>& Transform | Connections<br>= Properties<br>Edit Links<br>Connections | Clear<br>Reapply<br>Sort<br>Filter<br>Advanced<br>Sort & Filter | ext to<br>Columns<br>Fill                 | Remove<br>Data<br>Duplicates Validation - | onsolidate Relationships<br>Data Tools               | Manage<br>Data Model | What-If Forecast<br>Analysis · Sheet<br>Forecast | aroup<br>Outline | Show De<br>Hide Deta | → ←<br>Compare<br>Save<br>Data<br>Data<br>Data<br>OData Integration |   |         |  |
|                                                                        |                                                          |                                                                 |                                           |                                           |                                                      |                      |                                                  |                  |                      |                                                                     |   |         |  |
|                                                                        | D                                                        | E                                                               | G                                         | H                                         |                                                      |                      | M                                                | N<br>0           | P                    | OData Integration                                                   |   |         |  |
|                                                                        | ▼ ReleaseDate<br>1/1/1992 12:00:00 AM                    | > DiscontinuedDate                                              | 2.5                                       |                                           | Rating Price > Categories > Supplier > ProductDetail |                      |                                                  |                  |                      |                                                                     |   |         |  |
|                                                                        | 10/1/1995 12:00:00 AM                                    |                                                                 |                                           |                                           |                                                      |                      |                                                  |                  |                      | (€)                                                                 |   |         |  |
| flavors                                                                | 10/1/2000 12:00:00 AM                                    |                                                                 | ស្រី ដី 2018  22 ដែរ  22 ដែរ  22  ន្រី 22 |                                           |                                                      |                      |                                                  |                  |                      |                                                                     |   |         |  |
|                                                                        | 10/1/2005 12:00:00 AM                                    | 10/1/2006 12:00:00 AM                                           |                                           |                                           |                                                      |                      |                                                  |                  |                      | Row with Differences                                                |   |         |  |
| (Pack of 24)                                                           | 1/5/2003 12:00:00 AM                                     |                                                                 |                                           |                                           |                                                      |                      |                                                  |                  |                      | Select row to see details in the second table.                      |   |         |  |
| k of 12)                                                               | 8/4/2006 12:00:00 AM                                     |                                                                 | 22.8                                      |                                           |                                                      |                      |                                                  |                  |                      | Row 5                                                               |   |         |  |
|                                                                        | 11/5/2006 12:00:00 AM                                    |                                                                 | 18.8                                      |                                           |                                                      |                      |                                                  |                  |                      | 1 different cell in this row.                                       |   |         |  |
| /er                                                                    | 11/15/2006 12:00:00 AM                                   |                                                                 | 35.88                                     |                                           |                                                      |                      |                                                  |                  |                      |                                                                     |   |         |  |
| n Blu-ray Disc Player                                                  | 5/8/2008 12:00:00 AM                                     |                                                                 | 1088.8                                    |                                           |                                                      |                      |                                                  |                  |                      | O Excel<br>Column                                                   |   | OData   |  |
| (Single bottle)                                                        | 1/1/1970 12:00:00 AM                                     |                                                                 | 1.01                                      |                                           |                                                      |                      |                                                  |                  |                      | Price<br>0)<br>12                                                   | C | 19.9    |  |
|                                                                        | 12/31/1982 12:00:00 AM                                   |                                                                 | 6.99                                      |                                           |                                                      |                      |                                                  |                  |                      |                                                                     |   |         |  |
|                                                                        |                                                          |                                                                 |                                           |                                           |                                                      |                      |                                                  |                  |                      | × 目<br>Use Excel For All Differences                                |   |         |  |
|                                                                        |                                                          |                                                                 |                                           |                                           |                                                      |                      |                                                  |                  |                      | Use OData For All Differences                                       |   |         |  |
|                                                                        |                                                          |                                                                 |                                           |                                           |                                                      |                      |                                                  |                  |                      |                                                                     |   |         |  |

### **Outlook**

For Outlook, when you want an add-in command on a built-in ribbon tab, rather than creating your own, the command will appear on the default tab based on the platform and current Outlook mode. For guidance, see [Use add-ins in Outlook](https://support.microsoft.com/office/1ee261f9-49bf-4ba6-b3e2-2ba7bcab64c8) .

### **Dropdown menu**

A dropdown menu add-in command defines a static list of items. The menu can be any mix of items that execute a function or that open a task pane. Submenus aren't supported.

### **Grouped add-in commands on the ribbon**

Multiple add-in commands can be grouped together on the ribbon. A group must contain at least one add-in command in the form of a button or a dropdown menu. In Office on Windows and on Mac, the label and icon of a button or dropdown menu are usually shown for add-in commands in a group. However, the icon size and label visibility may vary due to the following factors that constrain space.

- The number of add-in commands in the group.
- The size of the Office client window.


If the client window is maximized and there are more than three controls in a group, the label of each control is shown, but the size of its icon may vary (some are shown as 16 x 16 pixels while others are shown as 32 x 32 pixels).

When there are two or more add-in commands in a group and space becomes limited, the following adjustments are made to how the add-in commands are displayed. These changes are applied to the groups of add-in commands from right to left across the ribbon in the following sequence.

- 1. Small icons (16 x 16 pixels) and labels are shown for each add-in command in a group.
- 2. Only small icons are shown.
- 3. The group is displayed as a dropdown menu instead of showing individual add-in commands on the ribbon. A scroll slider icon also appears on the ribbon, so that you can scroll through the ribbon.

In Office on the web, the icon size and label visibility of controls in groups don't change as the browser window is resized. The scroll slider icon is simply shown on the ribbon.

## **Command capabilities**

The following command capabilities are currently supported.

### **Extension points**

- Ribbon tabs Extend built-in tabs or create a new custom core tab. An add-in can have just one custom core tab. (You can also put add-in commands on a custom contextual tab.)
#### 7 **Note**

For Outlook, custom tabs are only supported in classic Outlook on Windows. In Outlook on the web, on Mac, and in the new Outlook on Windows, you can put custom groups of controls on one of the built-in ribbon tabs instead.

- Context menus Extend selected context menus.
### **Control types**

- Simple buttons trigger specific actions.
- Menus simple menu dropdown with buttons that trigger actions.


### **Default availability state**

You can specify whether the command is available when your add-in launches, and programmatically change the setting.

7 **Note**

This feature isn't supported in all Office applications or scenarios. For more information, see **Change the availability of add-in commands**.

### **Position on the ribbon**

You can specify where a custom tab appears on the Office application's ribbon, such as "just to the right of the Home tab".

#### 7 **Note**

This feature isn't supported in all Office applications or scenarios. For more information, see **Position a custom tab on the ribbon**.

### **Integration of built-in Office buttons**

You can insert the built-in Office ribbon buttons into your custom command groups and your custom ribbon tab.

#### 7 **Note**

This feature isn't supported in all Office applications or scenarios. For more information, see **Integrate built-in Office buttons into custom tabs**.

### **Contextual tabs**

You can specify a custom contextual tab; that is, a tab that is only visible on the ribbon in certain contexts, such as when a chart is selected in Excel.

```
7 Note
```


This feature isn't supported in all Office applications or scenarios. For more information, see **Create custom contextual tabs in Office Add-ins**.

## **Supported platforms**

Add-in commands are currently supported on the following platforms, except for limitations specified in the subsections of Command capabilities earlier.

- Office on the web
- Office on Windows (Version 1604 (Build 6769.2000) or later, connected to a Microsoft 365 subscription)
- Office on Mac (Version 15.33 (17040900) or later, connected to a Microsoft 365 subscription)
- Perpetual Office 2019 or later on Windows or on Mac

#### 7 **Note**

For information about support in Outlook, see **Outlook support notes**.

## **Debug**

To debug an add-in command, you must run it in Office on the web. For details, see Debug add-ins in Office on the web.

## **Best practices**

Apply the following best practices when you develop add-in commands.

- Use commands to represent a specific action with a clear and specific outcome for users. Don't combine multiple actions in a single button.
- Provide granular actions that make common tasks within your add-in more efficient to perform. Minimize the number of steps an action takes to complete.
- For the placement of your commands in the Office app ribbon:
	- Place commands on an existing tab (Insert, Review, and so on) if the functionality provided fits there. For example, if your add-in enables users to insert media, add a group to the Insert tab. Note that not all tabs are available across all Office versions. For more information, see Office Add-ins manifest.


- Place commands on the Home tab if the functionality doesn't fit on another tab, and you have fewer than six top-level commands. You can also add commands to the Home tab if your add-in needs to work across Office versions (such as Office on the web or desktop) and a tab is not available in all versions (for example, the Design tab doesn't exist in Office on the web).
- Place commands on a custom tab if you have more than six top-level commands.
- Name your group to match the name of your add-in. If you have multiple groups, name each group based on the functionality that the commands in that group provide.
- Don't add unnecessary buttons to increase the real estate of your add-in.
- Don't position a custom tab to the left of the Home tab, or give it focus by default when the document opens, unless your add-in is the primary way users will interact with the document. Giving excessive prominence to your add-in inconveniences and annoys users and administrators.
- If your add-in is the primary way users interact with the document and you have a custom ribbon tab, consider integrating into the tab the buttons for the Office functions that users will frequently need.
- If the functionality provided with a custom tab should only be available in certain contexts, use custom contextual tabs. If you use custom contextual tabs, make sure to implement a fallback experience for when your add-in runs on platforms that don't support custom contextual tabs.

#### 7 **Note**

Add-ins that take up too much space might not pass **AppSource validation**.

- For all icons, follow the icon design guidelines.
- Provide a version of your add-in that works on Office applications or platforms (such as iPad) that don't support commands. A single add-in manifest can be used for these versions.

## **Next steps**

The best way to get started using add-in commands is to take a look at the [Office Add-in](https://github.com/OfficeDev/Office-Add-in-Commands-Samples/) [commands samples](https://github.com/OfficeDev/Office-Add-in-Commands-Samples/) on GitHub.

For more information about specifying add-in commands in an add-in only manifest, see Create add-in commands with the add-in only manifest and the [VersionOverrides](https://learn.microsoft.com/en-us/javascript/api/manifest/versionoverrides) reference content.


For more information about specifying add-in commands in the unified manifest for Microsoft 365, see Create add-in commands with the unified manifest for Microsoft 365.


# **Create add-in commands with the addin only manifest**

Article • 03/04/2025

Add-in commands provide an easy way to customize the default Office user interface (UI) with specified UI elements that perform actions. For an introduction to add-in commands, see Add-in commands.

This article describes how to edit your add-in only manifest to define add-in commands and how to create the code for function commands.

#### **Tip**

For instructions on how to create add-in commands with the unified manifest for Microsoft 365, see **Create add-in commands with the unified manifest for Microsoft 365**.

The following diagram shows the hierarchy of elements used to define add-in commands. These elements are described in more detail in this article.


## **Sample commands**

All the task pane add-ins created by Yo Office have add-in commands. They contain an add-in command (button) to show the task pane. Generate these projects by following one of the quick starts, such as Build an Excel task pane add-in. Ensure that you have read Add-in commands to understand command capabilities.


### **Important parts of an add-in command**

The following steps explain how to add add-in commands to an existing add-in.

### **Step 1: Add VersionOverrides element**

The **[<VersionOverrides>](https://learn.microsoft.com/en-us/javascript/api/manifest/versionoverrides)** [element](https://learn.microsoft.com/en-us/javascript/api/manifest/versionoverrides) is the root element that contains the definition of your add-in command. Details on the valid attributes and implications are found in [Version overrides in the manifest.](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/xml-manifest-overview?tabs=tabid-1#version-overrides-in-the-manifest)

The following example shows the **<VersionOverrides>** element and its child elements.

```
XML
<OfficeApp>
...
 <VersionOverrides
xmlns="http://schemas.microsoft.com/office/taskpaneappversionoverrides"
xsi:type="VersionOverridesV1_0">
 <Requirements>
 <!-- Add information about requirement sets. -->
 </Requirements>
 <Hosts>
 <Host xsi:type="Workbook">
 <!-- Add information about form factors. -->
 </Host>
 </Hosts>
 <Resources>
 <!-- Add information about resources. -->
 </Resources>
 </VersionOverrides>
...
</OfficeApp>
```
### **Step 2: Add Hosts, Host, and DesktopFormFactor elements**

The **[<Hosts>](https://learn.microsoft.com/en-us/javascript/api/manifest/hosts)** [element](https://learn.microsoft.com/en-us/javascript/api/manifest/hosts) contains one or more **[<Host>](https://learn.microsoft.com/en-us/javascript/api/manifest/host)** [elements](https://learn.microsoft.com/en-us/javascript/api/manifest/host). A **<Host>** element specifies a particular Office application. The **<Host>** element contains child elements that specify the add-in commands to display after your add-in is installed in that Office application. To show the same add-in commands in two or more different Office applications, you must duplicate the child elements in each **<Host>**.

The **[<DesktopFormFactor>](https://learn.microsoft.com/en-us/javascript/api/manifest/desktopformfactor)** element specifies the settings for an add-in that runs in Office on the web, Windows, and Mac.


The following example shows the **<Hosts>**, **<Host>**, and **<DesktopFormFactor>** elements.

```
XML
<OfficeApp>
...
 <VersionOverrides
xmlns="http://schemas.microsoft.com/office/taskpaneappversionoverrides"
xsi:type="VersionOverridesV1_0">
 ...
 <Hosts>
 <Host xsi:type="Workbook">
 <DesktopFormFactor>
 <!-- Information about FunctionFile and ExtensionPoint. -->
 </DesktopFormFactor>
 </Host>
 </Hosts>
 ...
 </VersionOverrides>
...
</OfficeApp>
```
### **Step 3: Add the FunctionFile element**

The **[<FunctionFile>](https://learn.microsoft.com/en-us/javascript/api/manifest/functionfile)** [element](https://learn.microsoft.com/en-us/javascript/api/manifest/functionfile) specifies a file that contains JavaScript or TypeScript code to run when an add-in command uses the **ExecuteFunction** action. The **<FunctionFile>** element's **resid** attribute is set to a HTML file that includes all the JavaScript or TypeScript files your add-in commands require. You can't link directly to a JavaScript or TypeScript file. You can only link to an HTML file. The file name is specified as a **[<Url>](https://learn.microsoft.com/en-us/javascript/api/manifest/url)** [element](https://learn.microsoft.com/en-us/javascript/api/manifest/url) in the **[<Resources>](https://learn.microsoft.com/en-us/javascript/api/manifest/resources)** [element.](https://learn.microsoft.com/en-us/javascript/api/manifest/resources)

#### 7 **Note**

The Yo Office projects use **[webpack](https://webpack.js.org/concepts/)** to avoid manually adding the JavaScript or TypeScript to the HTML.

The following is an example of the **<FunctionFile>** element.

XML

```
<DesktopFormFactor>
 <FunctionFile resid="Commands.Url" />
 <ExtensionPoint xsi:type="PrimaryCommandSurface">
```


```
 <!-- Information about this extension point. -->
 </ExtensionPoint>
```
 <!-- You can define more than one ExtensionPoint element as needed. --> </DesktopFormFactor>

#### ) **Important**

Office.js must be initialized before the add-in command logic runs. For more information, see **Initialize your Office Add-in**.

#### **Outlook notifications**

When an add-in needs to provide status updates, such as progress indicators or error messages, it must do so through the [notification APIs](https://learn.microsoft.com/en-us/javascript/api/outlook/office.notificationmessages). The processing for the notifications must also be defined in a separate HTML file that is specified in the FunctionFile node of the manifest.

#### **Step 4: Add ExtensionPoint elements**

The **[<ExtensionPoint>](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint)** [element](https://learn.microsoft.com/en-us/javascript/api/manifest/extensionpoint) defines where add-in commands should appear in the Office UI.

The following examples show how to use the **<ExtensionPoint>** element with **PrimaryCommandSurface** and **ContextMenu** attribute values, and the child elements that should be used with each.

#### ) **Important**

For elements that contain an ID attribute, make sure you provide a unique ID. We recommend that you use your company's name along with your ID. For example, use the following format: <CustomTab id="mycompanyname.mygroupname"> .

| XML                                                                                                                                                                                               |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <extensionpoint xsi:type="PrimaryCommandSurface"><br/><customtab id="Contoso Tab"></customtab></extensionpoint>                                                                                   |
| If you want to use a default tab that comes with Office, remove the<br>above CustomTab element, and then uncomment the following OfficeTab element.</td></tr><tr><td><br><OfficeTab id="TabData"> |
| <label resid="residLabel4"></label><br><group id="Group1Id12"></group>                                                                                                                            |


```
 <Label resid="residLabel4" />
 <Icon>
 <bt:Image size="16" resid="icon1_32x32" />
 <bt:Image size="32" resid="icon1_32x32" />
 <bt:Image size="80" resid="icon1_32x32" />
 </Icon>
 <Control xsi:type="Button" id="Button1Id1">
 <!-- Information about the control. -->
 </Control>
 <!-- Other controls, as needed. -->
 </Group>
 </CustomTab>
</ExtensionPoint>
<ExtensionPoint xsi:type="ContextMenu">
 <OfficeMenu id="ContextMenuCell">
 <Control xsi:type="Menu" id="ContextMenu2">
 <!-- Information about the control. -->
 </Control>
 <!-- Other controls, as needed. -->
 </OfficeMenu>
</ExtensionPoint>
```
#### **Step 5: Add Control elements**

The **[<Control>](https://learn.microsoft.com/en-us/javascript/api/manifest/control)** [element](https://learn.microsoft.com/en-us/javascript/api/manifest/control) defines the usable surface of command, such as a button or menu, and the action associated with it.

#### **Button controls**

XML

A [button control](https://learn.microsoft.com/en-us/javascript/api/manifest/control-button) performs a single action when the user selects it. It can either run a JavaScript or TypeScript function or show a task pane. The following example shows how to define two buttons. The first button runs a JavaScript function without showing a UI, and the second button shows a task pane. In the **<Control>** element:

- The **type** attribute is required, and must be set to **Button**.
- The **id** attribute of the **<Control>** element is a string with a maximum of 125 characters.
- The **xsi:type** attribute of the child **[<Action>](https://learn.microsoft.com/en-us/javascript/api/manifest/action)** [element](https://learn.microsoft.com/en-us/javascript/api/manifest/action) must be set to **ExecuteFunction** to run a function or **ShowTaskpane** to display a task pane.

```
<!-- Define a control that calls a JavaScript function. -->
<Control xsi:type="Button" id="Button1Id1">
 <Label resid="residLabel" />
 <Supertip>
```


```
 <Title resid="residLabel" />
 <Description resid="residToolTip" />
 </Supertip>
 <Icon>
 <bt:Image size="16" resid="icon1_32x32" />
 <bt:Image size="32" resid="icon1_32x32" />
 <bt:Image size="80" resid="icon1_32x32" />
 </Icon>
 <Action xsi:type="ExecuteFunction">
 <FunctionName>highlightSelection</FunctionName>
 </Action>
</Control>
<!-- Define a control that shows a task pane. -->
<Control xsi:type="Button" id="Button2Id1">
 <Label resid="residLabel2" />
 <Supertip>
 <Title resid="residLabel" />
 <Description resid="residToolTip" />
 </Supertip>
 <Icon>
 <bt:Image size="16" resid="icon2_32x32" />
 <bt:Image size="32" resid="icon2_32x32" />
 <bt:Image size="80" resid="icon2_32x32" />
 </Icon>
 <Action xsi:type="ShowTaskpane">
 <SourceLocation resid="residUnitConverterUrl" />
 </Action>
</Control>
```
#### **Menu controls**

A [menu control](https://learn.microsoft.com/en-us/javascript/api/manifest/control-menu) can be used with either **PrimaryCommandSurface** or **ContextMenu**, and defines:

- A root-level menu item.
- A list of submenu items.

When used with **PrimaryCommandSurface**, the root menu item displays as a button on the ribbon. When the button is selected, the submenu displays as a drop-down list. When used with **ContextMenu**, a menu item with a submenu is inserted on the context menu. In both cases, individual submenu items can either run a JavaScript or TypeScript function or show a task pane. Only one level of submenus is supported at this time.

The following example shows how to define a menu item with two submenu items. The first submenu item shows a task pane, and the second submenu item runs a JavaScript function. In the **<Control>** element:

- The **xsi:type** attribute is required, and must be set to **Menu**.


- The **id** attribute is a string with a maximum of 125 characters.

```
XML
```

```
<Control xsi:type="Menu" id="TestMenu2">
 <Label resid="residLabel3" />
 <Supertip>
 <Title resid="residLabel" />
 <Description resid="residToolTip" />
 </Supertip>
 <Icon>
 <bt:Image size="16" resid="icon1_32x32" />
 <bt:Image size="32" resid="icon1_32x32" />
 <bt:Image size="80" resid="icon1_32x32" />
 </Icon>
 <Items>
 <Item id="showGallery2">
 <Label resid="residLabel3"/>
 <Supertip>
 <Title resid="residLabel" />
 <Description resid="residToolTip" />
 </Supertip>
 <Icon>
 <bt:Image size="16" resid="icon1_32x32" />
 <bt:Image size="32" resid="icon1_32x32" />
 <bt:Image size="80" resid="icon1_32x32" />
 </Icon>
 <Action xsi:type="ShowTaskpane">
 <TaskpaneId>MyTaskPaneID1</TaskpaneId>
 <SourceLocation resid="residUnitConverterUrl" />
 </Action>
 </Item>
 <Item id="showGallery3">
 <Label resid="residLabel5"/>
 <Supertip>
 <Title resid="residLabel" />
 <Description resid="residToolTip" />
 </Supertip>
 <Icon>
 <bt:Image size="16" resid="icon4_32x32" />
 <bt:Image size="32" resid="icon4_32x32" />
 <bt:Image size="80" resid="icon4_32x32" />
 </Icon>
 <Action xsi:type="ExecuteFunction">
 <FunctionName>getButton</FunctionName>
 </Action>
 </Item>
 </Items>
</Control>
```


The following code shows a function that's invoked by a button or menu item control whose **<Action>** element's **xsi:type** is set to **ExecuteFunction**. Note the following about the code.

- The [Office.actions.associate](https://learn.microsoft.com/en-us/javascript/api/office/office.actions#office-office-actions-associate-member(1)) call tells Office which function to run when a button or menu item is selected. The value passed to its **actionId** parameter must match the value specified in the **[<FunctionName>](https://learn.microsoft.com/en-us/javascript/api/manifest/action#functionname)** [element](https://learn.microsoft.com/en-us/javascript/api/manifest/action#functionname) of the manifest. You must have an Office.actions.associate call for every function command defined in the manifest.
- The [event.completed](https://learn.microsoft.com/en-us/javascript/api/office/office.addincommands.event#office-office-addincommands-event-completed-member(1)) call signals that you've successfully handled the event. When a function is called multiple times, such as multiple clicks on the same add-in command, all events are automatically queued. The first event runs automatically, while the other events remain on the queue. When your function calls event.completed , the next queued call to that function runs. You must implement event.completed , otherwise your function won't run.

```
JavaScript
```

```
// Initialize the Office Add-in.
Office.onReady(() => {
 // If needed, Office.js is ready to be called.
});
// The command function.
async function highlightSelection(event) {
 // Implement your custom code here. The following code is a simple Excel
example.
 try {
 await Excel.run(async (context) => {
 const range = context.workbook.getSelectedRange();
 range.format.fill.color = "yellow";
 await context.sync();
 });
 } catch (error) {
 // Note: In a production add-in, notify the user through your add-
in's UI.
 console.error(error);
 }
 // Calling event.completed is required. The event.completed call lets
the platform know that processing has completed.
 event.completed();
}
// This maps the function to the action ID specified in the manifest.
Office.actions.associate("highlightSelection", highlightSelection);
```


### **Step 6: Add the Resources element**

The **[<Resources>](https://learn.microsoft.com/en-us/javascript/api/manifest/resources)** [element](https://learn.microsoft.com/en-us/javascript/api/manifest/resources) contains resources used by the different child elements of the **<VersionOverrides>** element. Resources include icons, strings, and URLs. An element in the manifest can use a resource by referencing the **id** of the resource. Using the **id** helps organize the manifest, especially when there are different versions of the resource for different locales. An **id** has a maximum of 32 characters.

The following shows an example of how to use the **<Resources>** element. Each resource can have one or more **[<Override>](https://learn.microsoft.com/en-us/javascript/api/manifest/override)** [child elements](https://learn.microsoft.com/en-us/javascript/api/manifest/override) to define a different resource for a specific locale.

| XML                                                                                                                                                 |
|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| <resources></resources>                                                                                                                             |
| <bt:images></bt:images>                                                                                                                             |
| <bt:image <="" id="icon1_16x16" td=""></bt:image>                                                                                                   |
| DefaultValue="https://www.contoso.com/Images/icon_default.png">                                                                                     |
| <bt:override locale="ja-jp" value="https://www.contoso.com/Images/ja&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;jp16-icon_default.png"></bt:override> |
|                                                                                                                                                     |
| <bt:image <="" id="icon1_32x32" td=""></bt:image>                                                                                                   |
| DefaultValue="https://www.contoso.com/Images/icon_default.png">                                                                                     |
| <bt:override locale="ja-jp" value="https://www.contoso.com/Images/ja&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;jp32-icon_default.png"></bt:override> |
|                                                                                                                                                     |
| <bt:image <="" id="icon1_80x80" td=""></bt:image>                                                                                                   |
| DefaultValue="https://www.contoso.com/Images/icon_default.png">                                                                                     |
| <bt:override locale="ja-jp" value="https://www.contoso.com/Images/ja&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;jp80-icon_default.png"></bt:override> |
|                                                                                                                                                     |
|                                                                                                                                                     |
| <bt:urls></bt:urls>                                                                                                                                 |
| <bt:url <="" id="residDesktopFuncUrl" td=""></bt:url>                                                                                               |
| DefaultValue="https://www.contoso.com/Pages/Home.aspx"><br><bt:override <="" locale="ja-jp" td=""></bt:override>                                    |
| Value="https://www.contoso.com/Pages/Home.aspx" />                                                                                                  |
|                                                                                                                                                     |
|                                                                                                                                                     |
| <bt:shortstrings></bt:shortstrings>                                                                                                                 |
| <bt:string defaultvalue="GetData" id="residLabel"></bt:string>                                                                                      |
| <bt:override locale="ja-jp" value="JA-JP-GetData"></bt:override>                                                                                    |
|                                                                                                                                                     |
|                                                                                                                                                     |
| <bt:longstrings></bt:longstrings>                                                                                                                   |
| <bt:string defaultvalue="Get data for your document." id="residToolTip"></bt:string>                                                                |
| <bt:override locale="ja-jp" value="JA-JP - Get data for your&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;document."></bt:override>                     |
|                                                                                                                                                     |
|                                                                                                                                                     |


#### 7 **Note**

You must use Secure Sockets Layer (SSL) for all URLs in the **<Image>** and **<Url>** elements.

## **Outlook support notes**

Add-in commands are available in the following Outlook versions.

- Outlook on the web for Microsoft 365 and Outlook.com
- Outlook on the web for Exchange 2016 or later
- [new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)
- Outlook 2016 or later on Windows
- Outlook on Mac
- Outlook on Android
- Outlook on iOS

Support for add-in commands in Exchange 2016 requires [Cumulative Update 5](https://support.microsoft.com/topic/d67d7693-96a4-fb6e-b60b-e64984e267bd) .

If your add-in uses an add-in only manifest, then add-in commands are only available for add-ins that don't use [ItemHasAttachment, ItemHasKnownEntity, or](https://learn.microsoft.com/en-us/javascript/api/manifest/rule) [ItemHasRegularExpressionMatch rules](https://learn.microsoft.com/en-us/javascript/api/manifest/rule) to limit the types of items they activate on. However, contextual add-ins can present different commands depending on whether the currently selected item is a message or appointment, and can choose to appear in read or compose scenarios. Using add-in commands if possible is a best practice.

# **See also**

- Add-in commands
- [Sample: Create an Excel add-in with command buttons](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/office-add-in-commands/excel)
- [Sample: Create a Word add-in with command buttons](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/office-add-in-commands/word)
- [Sample: Create a PowerPoint add-in with command buttons](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/office-add-in-commands/powerpoint)


# **Create add-in commands with the unified manifest for Microsoft 365**

Article • 05/19/2025

Add-in commands provide an easy way to customize the default Office user interface (UI) with specified UI elements that perform actions. For an introduction to add-in commands, see Addin commands.

This article describes how to configure the Unified manifest for Microsoft 365 to define add-in commands and how to create the code for function commands.

#### 7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word add-ins.

#### **Tip**

Instructions for creating add-in commands with the add-in only manifest are in **Create add-in commands with the add-in only manifest**.

#### 7 **Note**

Office Add-ins that use the unified manifest for Microsoft 365 are *directly* supported in Office on the web, in **[new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** , and in Office on Windows connected to a Microsoft 365 subscription, Version 2304 (Build 16320.00000) or later.

When the app package that contains the unified manifest is deployed in **[AppSource](https://appsource.microsoft.com/)** or the **Microsoft 365 Admin Center** then an add-in only manifest is generated from the unified manifest and stored. This add-in only manifest enables the add-in to be installed on platforms that don't directly support the unified manifest, including Office on Mac, Office on mobile, subscription versions of Office on Windows earlier than 2304 (Build 16320.00000), and perpetual versions of Office on Windows.

## **Starting point and major steps**

Both of the tools that create add-in projects with a unified manifest — the Office Yeoman generator and Microsoft 365 Agents Toolkit — create projects with one or more add-in


commands. The only time you won't already have an add-in command is if you are updating an add-in which previously didn't have one.

## **Two decisions**

- Decide which of two types of add-in commands you need: Task pane or function
- Decide which kind of UI element you need: button or menu item. Then carry out the steps in the sections and subsections below that correspond to your decisions.

### **Add a task pane command**

The following subsections explain how to include a task pane command in an add-in.

#### **Configure the runtime for the task pane command**

- 1. Open the unified manifest and find the ["extensions.runtimes"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array?view=m365-app-prev&preserve-view=true) array.
- 2. Ensure that there is a runtime object that has an ["actions.type"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-actions-item#type) property with the value "openPage" . This type of runtime opens a task pane.
- 3. Ensure that the ["requirements.capabilities"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/requirements-extension-element-capabilities) array contains an object that specifies a Requirement Set that supports add-in commands. For Outlook the minimum requirement set for add-in commands is [Mailbox 1.3.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.3/outlook-requirement-set-1.3) For other Office host applications, the minimum requirement set for add-in commands is [AddinCommands 1.1.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/add-in-commands-requirement-sets)
- 4. Ensure that the "id" of the runtime object has a descriptive name such as "TaskPaneRuntime" .
- 5. Ensure that the ["code.page"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtime-code#page) property of the runtime object is set to the URL of the page that should open in the task pane, such as "https://localhost:3000/taskpane.html" .
- 6. Ensure that the ["actions.view"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-actions-item#view) of the runtime object has a name that describes the content of the page that you set in the preceding step, such as "homepage" or "dashboard" .
- 7. Ensure that the ["actions.id"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-actions-item#id) of the runtime object has a descriptive name such as "ShowTaskPane" that indicates what happens when the user selects the add-in command button or menu item.
- 8. Set the other properties and subproperties of the runtime object as shown in the following completed example of a runtime object. The "type" and "lifetime" properties are required and in Outlook Add-ins. They always have the values shown in this example.


```
"runtimes": [
 {
 "requirements": {
 "capabilities": [
 {
 "name": "Mailbox",
 "minVersion": "1.3"
 }
 ]
 },
 "id": "TaskPaneRuntime",
 "type": "general",
 "code": {
 "page": "https://localhost:3000/taskpane.html"
 },
 "lifetime": "short",
 "actions": [
 {
 "id": "ShowTaskPane",
 "type": "openPage",
 "view": "homepage"
 }
 ]
 }
]
```
### **Configure the UI for the task pane command**

- 1. Ensure that the extension object for which you configured a runtime has a ["ribbons"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/element-extensions#ribbons) array property as a peer to the ["runtimes"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/element-extensions#runtimes) array. There is typically only one extension object in the ["extensions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/root#extensions) array.
- 2. Ensure that the array has an object with array properties named "contexts" and "tabs" , as shown in the following example.

```
JSON
"ribbons": [
 {
 "contexts": [
 // child objects omitted
 ],
 "tabs": [
 // child objects omitted
 ]
 }
]
```

```
JSON
```


- 3. Ensure that the "contexts" array has strings that specify the windows or panes in which the UI for the task pane command should appear. For example, "mailRead" means that it will appear in the reading pane or message window when an email message is open, but "mailCompose" means it will appear when a new message or a reply is being composed. The following are the allowable values:
	- "mailRead"
	- "mailCompose"
	- "meetingDetailsOrganizer"
	- "meetingDetailsAttendee"

The following is an example.

```
JSON
"contexts": [
 "mailRead"
],
```
- 4. Ensure that the "tabs" array has an object with a "builtInTabId" string property that is set to the ID of ribbon tab in which you want your task pane command to appear. Also, ensure that there is a "groups" array with at least one object in it. The following is an example.

```
JSON
"tabs": [
 {
 "builtInTabID": "TabDefault",
 "groups": [
 {
 // properties omitted
 }
 ]
 }
]
```
#### 7 **Note**

For a list of the possible values of the "builtInTabID" property, see **[Find the IDs of](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/built-in-ui-ids) [built-in Office ribbon tabs](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/built-in-ui-ids)**.


- 5. Ensure that the "groups" array has an object to define the custom control group that will hold your add-in command UI controls. The following is an example. Note the following about this JSON:
	- The "id" must be unique across all groups in all ribbon objects in the manifest. Maximum length is 64 characters.
	- The "label" appears on the group on the ribbon. Although its maximum length is 64 characters, to ensure that the control group fits correctly in the ribbon, we recommend that you limit the "label" to 16 characters.
	- One of the "icons" appears on the group only if the Office application window, and hence the ribbon, has been sized by the user too small for any of the controls in the group to appear. Office decides when to use one of these icons and which one to use based on the size of the window and the resolution of the device. You cannot control this. You must provide image files for 16, 32, and 80 pixels, while five other sizes are also supported (20, 24, 40, 48, and 64 pixels). You must use Secure Sockets Layer (SSL) for all URLs.

JSON

```
"groups": [
 {
 "id": "msgReadGroup",
 "label": "Contoso Add-in",
 "icons": [
 {
 "size": 16,
 "url": "https://localhost:3000/assets/icon-16.png"
 },
 {
 "size": 32,
 "url": "https://localhost:3000/assets/icon-32.png"
 },
 {
 "size": 80,
 "url": "https://localhost:3000/assets/icon-80.png"
 }
 ],
 "controls": [
 {
 // properties omitted
 }
 ]
 }
]
```
- 6. Ensure that there is a control object in the "controls" array for each button or custom menu you want. The following is an example. Note the following about this JSON:


- The "id" , "label" , and "icons" properties have the same purpose and the same restrictions as the corresponding properties of a group object, except that they apply to a specific button or menu within the group.
- The "type" property is set to "button" which means that the control will be a ribbon button. You can also configure a task pane command to be run from a menu item. See Menu and menu items.
- The "supertip.title" (maximum length: 64 characters) and "supertip.description" (maximum length: 128 characters) appear when the cursor is hovering over the button or menu.
- The "actionId" must be an exact match for the ["runtimes.actions.id"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-actions-item#id) that you set in Configure the runtime for the task pane command.

```
JSON
{
 "id": "msgReadOpenPaneButton",
 "type": "button",
 "label": "Show Task Pane",
 "icons": [
 {
 "size": 16,
 "url": "https://localhost:3000/assets/icon-16.png"
 },
 {
 "size": 32,
 "url": "https://localhost:3000/assets/icon-32.png"
 },
 {
 "size": 80,
 "url": "https://localhost:3000/assets/icon-80.png"
 }
 ],
 "supertip": {
 "title": "Show Contoso Task Pane",
 "description": "Opens the Contoso task pane."
 },
 "actionId": "ShowTaskPane"
}
```
You've now completed adding a task pane command to your add-in. Sideload and test it.

## **Add a function command**

The following subsections explain how to include a function command in an add-in.

### **Create the code for the function command**


- 1. Ensure that your source code includes a JavaScript or Typescript file with the function that you want to run with your function command. The following is an example. Since this article is about creating add-in commands, and not about teaching the Office JavaScript Library, we provide it with minimal comments, but do note the following:
	- For purposes of this article, the file is named **commands.js**.
	- The function will cause a small notification to appear on an open email message with the text "Action performed".
	- Like all code that call APIs in the Office JavaScript Library, it must begin by initializing the library. It does this by calling Office.onReady .
	- The last thing the code calls is [Office.actions.associate](https://learn.microsoft.com/en-us/javascript/api/office/office.actions#office-office-actions-associate-member(1)) to tell Office which function in the file should be run when the UI for your function command is invoked. The function maps the function name to an action ID that you configure in the manifest in a later step. If you define multiple function commands in the same file, your code must call associate for each one.
	- The function must take a parameter of type [Office.AddinCommands.Event.](https://learn.microsoft.com/en-us/javascript/api/office/office.addincommands.event) The last line of the function must call [event.completed](https://learn.microsoft.com/en-us/javascript/api/office/office.addincommands.event#office-office-addincommands-event-completed-member(1)).

JavaScript

```
Office.onReady(function() {
// Add any initialization code here.
});
function setNotification(event) {
const message = {
 type:
Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,
 message: "Performed action.",
 icon: "Icon.80x80",
 persistent: true,
};
// Show a notification message.
Office.context.mailbox.item.notificationMessages.replaceAsync("ActionPerforma
nceNotification", message);
// Be sure to indicate when the add-in command function is complete.
event.completed();
}
// Map the function to the action ID in the manifest.
Office.actions.associate("SetNotification", setNotification);
```
- 2. Ensure that your source code includes an HTML file that is configured to load the function file you created. The following is an example. Note the following about this JSON:


- For purposes of this article, the file is named **commands.html**.
- The <body> element is empty because the file has no UI. Its only purpose is to load JavaScript files.
- The Office JavaScript Library and the **commands.js** file that you created in the preceding step is explicitly loaded.

#### 7 **Note**

It's common in Office Add-in development to use tools like **[webpack](https://webpack.js.org/)** and its plugins to automatically inject <script> tags into HTML files at build time. If you use such a tool, you shouldn't include any <script> tags in your source file that are going to be inserted by the tool.

#### HTML

```
<!DOCTYPE html>
<html>
 <head>
 <meta charset="UTF-8" />
 <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
 <!-- Office JavaScript Library -->
 <script type="text/javascript"
src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
 <!-- Function command file -->
 <script src="commands.js" type="text/javascript"></script>
 </head>
 <body>
 </body>
</html>
```
#### **Configure the runtime for the function command**

- 1. Open the unified manifest and find the "extensions.runtimes" array.
- 2. Ensure that there is a runtime object that has a "actions.type" property with the value "executeFunction" .
- 3. Ensure that the "requirements.capabilities" array contains objects that specify any Requirement Sets that are needed to support the APIs add-in commands. For Outlook, the minimum requirement set for add-in commands is [Mailbox 1.3.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/requirement-set-1.3/outlook-requirement-set-1.3) But if your function command calls that API that is part of later **Mailbox** requirement set, such as **Mailbox 1.5**,


then you need to specify the later version (e.g., "1.5") as the "minVersion" value. For other Office host applications, the minimum requirement set for add-in commands is [AddinCommands 1.1](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/add-in-commands-requirement-sets).

- 4. Ensure that the "id" of the runtime object has a descriptive name such as "CommandsRuntime".
- 5. Ensure that the ["code.page"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtime-code#page) property of the runtime object is set to the URL of the UI-less HTML page that loads your function file, such as "https://localhost:3000/commands.html" .
- 6. Ensure that the "actions.id" of the runtime object has a descriptive name such as "SetNotification" that indicates what happens when the user selects the add-in command button or menu item.

```
) Important
The value of "actions.id" must exactly match the first parameter of the call to
Office.actions.associate in the function file.
```
- 7. Set the other properties and subproperties of the runtime object as shown in the following completed example of a runtime object.

```
JSON
"runtimes": [
 {
 "id": "CommandsRuntime",
 "type": "general",
 "code": {
 "page": "https://localhost:3000/commands.html"
 },
 "lifetime": "short",
 "actions": [
 {
 "id": "SetNotification",
 "type": "executeFunction",
 }
 ]
 } 
]
```
**Configure the UI for the function command**


- 1. Ensure that the extension object for which you configured a runtime has a "ribbons" array property as a peer to the "runtimes" array. There is typically only one extension object in the "extensions" array.
- 2. Ensure that the array has an object with array properties named "contexts" and "tabs" , as shown in the following example.

```
JSON
"ribbons": [
 {
 "contexts": [
 // child objects omitted
 ],
 "tabs": [
 // child objects omitted
 ]
 }
]
```
- 3. Ensure that the "contexts" array has strings that specify the windows or panes in which the UI for the function command should appear. For example, "mailRead" means that it will appear in the reading pane or message window when an email message is open, but "mailCompose" means it will appear when a new message or a reply is being composed. The following are the allowable values:
	- "mailRead"
	- "mailCompose"
	- "meetingDetailsOrganizer"
	- "meetingDetailsAttendee"

The following is an example.

```
JSON
"contexts": [
 "mailRead"
],
```
- 4. Ensure that the "tabs" array has an object with a "builtInTabId" string property that is set to the ID of ribbon tab in which you want your function command to appear and a "groups" array with at least one object in it. The following is an example.
JSON


```
"tabs": [
 {
 "builtInTabID": "TabDefault",
 "groups": [
 {
 // properties omitted
 }
 ]
 }
]
```
#### 7 **Note**

For a list of the possible values of the "builtInTabID" property, see **[Find the IDs of](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/built-in-ui-ids) [built-in Office ribbon tabs](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/built-in-ui-ids)**.

- 5. Ensure that the "groups" array has an object to define the custom control group that will hold your add-in command UI controls. The following is an example. Note the following about this JSON:
	- The "id" must be unique across all groups in all ribbon objects in the manifest. Maximum length is 64 characters.
	- The "label" appears on the group on the ribbon. Although its maximum length is 64 characters, to ensure that the control group fits correctly in the ribbon, we recommend that you limit the "label" to 16 characters.
	- One of the "icons" appears on the group only if the Office application window, and hence the ribbon, has been sized by the user too small for any of the controls in the group to appear. Office decides when to use one of these icons and which one to use based on the size of the window and the resolution of the device. You cannot control this. You must provide image files for 16, 32, and 80 pixels, while five other sizes are also supported (20, 24, 40, 48, and 64 pixels). You must use Secure Sockets Layer (SSL) for all URLs.

```
JSON
```

```
"groups": [
 {
 "id": "msgReadGroup",
 "label": "Contoso Add-in",
 "icons": [
 {
 "size": 16,
 "url": "https://localhost:3000/assets/icon-16.png"
 },
```


```
 {
 "size": 32,
 "url": "https://localhost:3000/assets/icon-32.png"
 },
 {
 "size": 80,
 "url": "https://localhost:3000/assets/icon-80.png"
 }
 ],
 "controls": [
 {
 // properties omitted
 }
 ]
 }
]
```
- 6. Ensure that there is a control object in the "controls" array for each button or custom menu you want. The following is an example. Note the following about this JSON:
	- The "id" , "label" , and "icons" properties have the same purpose and the same restrictions as the corresponding properties of a group object, except that they apply to a specific button or menu within the group.
	- The "type" property is set to "button" which means that the control will be a ribbon button. You can also configure a function command to be run from a menu item. See Menu and menu items.
	- The "supertip.title" (maximum length: 64 characters) and "supertip.description" (maximum length: 128 characters) appear when the cursor is hovering over the button or menu.
	- The "actionId" must be an exact match for the "runtime.actions.id" that you set in Configure the runtime for the function command.

```
JSON
{
 "id": "msgReadSetNotificationButton",
 "type": "button",
 "label": "Set Notification",
 "icons": [
 {
 "size": 16,
 "url": "https://localhost:3000/assets/icon-16.png"
 },
 {
 "size": 32,
 "url": "https://localhost:3000/assets/icon-32.png"
 },
 {
 "size": 80,
```


```
 "url": "https://localhost:3000/assets/icon-80.png"
 }
 ],
 "supertip": {
 "title": "Set Notification",
 "description": "Displays a notification message on the current
message."
 },
 "actionId": "SetNotification"
}
```
You've now completed adding a function command to your add-in. Sideload and test it.

## **Menu and menu items**

In addition to custom buttons, you can also add custom drop down menus to the Office ribbon. This section explains how by using an example with two menu items. One invokes a task pane command. The other invokes a function command.

### **Configure the runtimes and code**

Carry out the steps of the following sections:

- Configure the runtime for the task pane command
- Create the code for the function command
- Configure the runtime for the function command

### **Configure the UI for the menu**

- 1. Ensure that the extension object for which you configured a runtime has a "ribbons" array property as a peer to the "runtimes" array. There is typically only one extension object in the "extensions" array.
- 2. Ensure that the array has an object with array properties named "contexts" and "tabs" , as shown in the following example.

```
JSON
"ribbons": [
 {
 "contexts": [
 // child objects omitted
 ],
 "tabs": [
 // child objects omitted
```


 ] } ]

- 3. Ensure that the "contexts" array has strings that specify the windows or panes in which the menu should appear on the ribbon. For example, "mailRead" means that it will appear in the reading pane or message window when an email message is open, but "mailCompose" means it will appear when a new message or a reply is being composed. The following are the allowable values:
	- "mailRead"
	- "mailCompose"
	- "meetingDetailsOrganizer"
	- "meetingDetailsAttendee"

The following is an example.

```
JSON
"contexts": [
 "mailRead"
],
```
- 4. Ensure that the "tabs" array has an object with a "builtInTabId" string property that is set to the ID of ribbon tab in which you want your task pane command to appear and a "groups" array with at least one object in it. The following is an example.

```
JSON
"tabs": [
 {
 "builtInTabID": "TabDefault",
 "groups": [
 {
 // properties omitted
 }
 ]
 }
]
```
#### 7 **Note**

For a list of the possible values of the "builtInTabID" property, see **[Find the IDs of](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/built-in-ui-ids) [built-in Office ribbon tabs](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/built-in-ui-ids)**.


- 5. Ensure that the "groups" array has an object to define the custom control group that will hold your drop down menu control. The following is an example. Note the following about this JSON:
	- The "id" must be unique across all groups in all ribbon objects in the manifest. Maximum length is 64 characters.
	- The "label" appears on the group on the ribbon. Although its maximum length is 64 characters, to ensure that the control group fits correctly in the ribbon, we recommend that you limit the "label" to 16 characters.
	- One of the "icons" appears on the group only if the Office application window, and hence the ribbon, has been sized by the user too small for any of the controls in the group to appear. Office decides when to use one of these icons and which one to use based on the size of the window and the resolution of the device. You cannot control this. You must provide image files for 16, 32, and 80 pixels, while five other sizes are also supported (20, 24, 40, 48, and 64 pixels). You must use Secure Sockets Layer (SSL) for all URLs.

JSON

```
"groups": [
 {
 "id": "msgReadGroup",
 "label": "Contoso Add-in",
 "icons": [
 {
 "size": 16,
 "url": "https://localhost:3000/assets/icon-16.png"
 },
 {
 "size": 32,
 "url": "https://localhost:3000/assets/icon-32.png"
 },
 {
 "size": 80,
 "url": "https://localhost:3000/assets/icon-80.png"
 }
 ],
 "controls": [
 {
 // properties omitted
 }
 ]
 }
]
```
- 6. Ensure that there is a control object in the "controls" array. The following is an example. Note the following about this JSON:


- The "id" , "label" , and "icons" properties have the same purpose and the same restrictions as the corresponding properties of a group object, except that they apply to the drop down menu within the group.
- The "type" property is set to "menu" which means that the control will be a drop down menu.
- The "supertip.title" (maximum length: 64 characters) and "supertip.description" (maximum length: 128 characters) appear when the cursor is hovering over the menu.
- The "items" property contains the JSON for the two menu options. The values are added in later steps.

```
JSON
{
 "id": "msgReadMenu",
 "type": "menu",
 "label": "Contoso Menu",
 "icons": [
 {
 "size": 16,
 "url": "https://localhost:3000/assets/icon-16.png"
 },
 {
 "size": 32,
 "url": "https://localhost:3000/assets/icon-32.png"
 },
 {
 "size": 80,
 "url": "https://localhost:3000/assets/icon-80.png"
 }
 ],
 "supertip": {
 "title": "Show Contoso Actions",
 "description": "Opens the Contoso menu."
 },
 "items": [
 {
 "id": "",
 "type": "",
 "label": "",
 "supertip": {},
 "actionId": ""
 },
 {
 "id": "",
 "type": "",
 "label": "",
 "supertip": {},
 "actionId": ""
 }
```


- ] }
- 7. The first item shows a task pane. The following is an example. Note the following about this code:
	- The "id" , "label" , and "supertip" properties have the same purpose and the same restrictions as the corresponding properties of the parent menu object, except that they apply to just this menu option.
	- The "icons" property is optional for menu items and there isn't one in this example. If you include one, it has the same purposes and restrictions as the "icons" property of the parent menu, except that the icon appears on the menu item beside the label.
	- The "type" property is set to "menuItem" .
	- The "actionId" must be an exact match for the "runtimes.actions.id" that you set in Configure the runtime for the task pane command.

```
JSON
{
 "id": "msgReadOpenPaneMenuItem",
 "type": "menuItem",
 "label": "Show Task Pane",
 "supertip": {
 "title": "Show Contoso Task Pane",
 "description": "Opens the Contoso task pane."
 },
 "actionId": "ShowTaskPane"
},
```
- 8. The second item runs a function command. The following is an example. Note the following about this code:
	- The "actionId" must be an exact match for the "runtimes.actions.id" that you set in Configure the runtime for the function command.

```
JSON
{
 "id": "msgReadSetNotificationMenuItem",
 "type": "menuItem",
 "label": "Set Notification",
 "supertip": {
 "title": "Set Notification",
 "description": "Displays a notification message on the current
message."
```


```
 },
 "actionId": "SetNotification"
}
```
You've now completed adding a menu to your add-in. Sideload and test it.

## **See also**

- Add-in commands
- Unified manifest for Microsoft 365.


# **Create custom contextual tabs in Office Add-ins**

06/30/2025

A contextual tab is a hidden tab control in the Office ribbon that's displayed in the tab row when a specified event occurs in the Office document. For example, the **Table Design** tab that appears on the Excel ribbon when a table is selected. You include custom contextual tabs in your Office Add-in and specify when they're visible or hidden, by creating event handlers that change the visibility. (However, custom contextual tabs don't respond to focus changes.)

#### 7 **Note**

This article assumes that you're familiar with **Basic concepts for add-in commands**. Please review it if you haven't worked with add-in commands (custom menu items and ribbon buttons) recently.

### **Prerequisites**

Custom contextual tabs are currently only supported on **Excel** and only on the following platforms and builds.

- Excel on the web
- Excel on Windows: Version 2102 (Build 13801.20294) and later.
- Excel on Mac: Version 16.53 (21080600) and later.

Additionally, custom contextual tabs only work on platforms that support the following requirement sets. For more about requirement sets and how to work with them, see Specify Office applications and API requirements.

- [RibbonApi 1.2](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/ribbon-api-requirement-sets)
- [SharedRuntime 1.1](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/shared-runtime-requirement-sets)

#### **Tip**

Use the runtime checks in your code to test whether the user's host and platform combination supports these requirement sets as described in **Check for API availability at runtime**. (The technique of specifying the requirement sets in the manifest, which is also described in that article, doesn't currently work for RibbonApi 1.2.) Alternatively, you can **implement an alternate UI experience when custom contextual tabs aren't supported**.


## **Behavior of custom contextual tabs**

The user experience for custom contextual tabs follows the pattern of built-in Office contextual tabs. The following are the basic principles for the placement custom contextual tabs.

- When a custom contextual tab is visible, it appears on the right end of the ribbon.
- If one or more built-in contextual tabs and one or more custom contextual tabs from add-ins are visible at the same time, the custom contextual tabs are always to the right of all of the built-in contextual tabs.
- If your add-in has more than one contextual tab and there are contexts in which more than one is visible, they appear in the order in which they are defined in your add-in. (The direction is the same direction as the Office language; that is, is left-to-right in left-toright languages, but right-to-left in right-to-left languages.) See Define the groups and controls that appear on the tab for details about how you define them.
- If more than one add-in has a contextual tab that's visible in a specific context, then they appear in the order in which the add-ins were launched.
- Custom *contextual* tabs, unlike custom core tabs, aren't added permanently to the Office application's ribbon. They're present only in Office documents on which your add-in is running.

## **Major steps for including a contextual tab in an add-in**

The following are the major steps for including a custom contextual tab in an add-in.

- 1. Configure the add-in to use a shared runtime.
- 2. Specify the icons for your contextual tab.
- 3. Define the groups and controls that appear on the tab.
- 4. Register the contextual tab with Office.
- 5. Specify the circumstances when the tab will be visible.

## **Configure the add-in to use a shared runtime**

Adding custom contextual tabs requires your add-in to use the shared runtime. For more information, see Configure an add-in to use a shared runtime.

# **Specify the icons for your contextual tab**

Before you can customize your contextual tab, you must first specify any icons that will appear on it in your add-in's manifest. Each icon must have at least three sizes: 16x16 px, 32x32 px,


and 80x80 px. Select the tab for the type of manifest your add-in uses.

```
Unified manifest for Microsoft 365
```
In the ["extensions.ribbons.tabs.groups.icons"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-custom-tab-groups-item#icons) array, specify the icons for the group of contextual tab controls that will be displayed on the host's ribbon. For icons that will be used by the tab's buttons and menus, specify these in the "icons" property of the ["extensions.ribbons.tabs.groups.controls"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-custom-tab-groups-item#controls) object.

Because the contextual tab will only be shown when a certain event occurs, you must also set the ["extensions.ribbons.tabs.groups.controls.overriddenByRibbonApi"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-common-custom-group-controls-item#overriddenbyribbonapi) property to true .

The following is an example.

```
JSON
"ribbons": [
 {
 ...
 "tabs": [
 "groups": [
 {
 "id": "ContosoGroup",
 ...
 "icons": [
 {
 "size": 16,
               "url": 
"https://cdn.contoso.com/addins/datainsertion/Images/Group16x16.png"
 },
            {
 "size": 32,
               "url": 
"https://cdn.contoso.com/addins/datainsertion/Images/Group32x32.png"
 },
            {
 "size": 80,
               "url": 
"https://cdn.contoso.com/addins/datainsertion/Images/Group80x80.png"
 }
 ],
 "controls": [
 {
 "id": "WriteDataButton",
               ...
               "icons": [
 {
 "size": 16,
                   "url":
```


#### ) **Important**

When you move your add-in from development to staging or production, remember to update the URLs in your manifest as needed (such as changing the domain from localhost to contoso.com ).

## **Define the groups and controls that appear on the tab**

Unlike custom core tabs, which are defined in the manifest, custom contextual tabs are defined at runtime with a JSON blob. Your code parses the blob into a JavaScript object, and then passes the object to the [Office.ribbon.requestCreateControls](https://learn.microsoft.com/en-us/javascript/api/office/office.ribbon?view=common-js&preserve-view=true#office-office-ribbon-requestcreatecontrols-member(1)) method. Custom contextual tabs are only present in documents on which your add-in is currently running. This is different from custom core tabs which are added to the Office application ribbon when the add-in is installed and remain present when another document is opened. Also, the requestCreateControls method may be run only once in a session of your add-in. If it's called again, an error is thrown.

We'll construct an example of a contextual tabs JSON blob step-by-step. The full schema for the contextual tab JSON is at [dynamic-ribbon.schema.json](https://developer.microsoft.com/json-schemas/office-js/dynamic-ribbon.schema.json). If you're working in Visual Studio 


Code, you can use this file to get IntelliSense and to validate your JSON. For more information, see [Editing JSON with Visual Studio Code - JSON schemas and settings](https://code.visualstudio.com/docs/languages/json#_json-schemas-and-settings) .

- 1. Begin by creating a JSON string with two array properties named actions and tabs . The actions array is a specification of all the functions that can be executed by controls on the contextual tab. The tabs array defines one or more contextual tabs.

```
JSON
'{
 "actions": [
 ],
 "tabs": [
 ]
}'
```
- 2. This simple example of a contextual tab will have only a single button and, thus, only a single action. Add the following as the only member of the actions array. About this markup, note:
	- The id and type properties are mandatory.
	- The value of type can be either "ExecuteFunction" or "ShowTaskpane" .
	- The functionName property is only used when the value of type is ExecuteFunction . It's the name of a function defined in the FunctionFile. For more information about the FunctionFile, see Basic concepts for add-in commands.
	- In a later step, you'll map this action to a button on the contextual tab.

```
JSON
{
 "id": "executeWriteData",
 "type": "ExecuteFunction",
 "functionName": "writeData"
}
```
- 3. Add the following as the only member of the tabs array. About this markup, note:
	- The id property is required. Use a brief, descriptive ID that is unique among all contextual tabs in your add-in.
	- The label property is required. It's a user-friendly string to serve as the label of the contextual tab.


- The groups property is required. It defines the groups of controls that will appear on the tab. It must have at least one member.
#### 7 **Note**

The tab object can also have an optional visible property that specifies whether the tab is visible immediately when the add-in starts up. Since contextual tabs are normally hidden until a user event triggers their visibility (such as the user selecting an entity of some type in the document), the visible property defaults to false when not present. In a later section, we show how to set the property to true in response to an event.

```
JSON
```

```
{
 "id": "CtxTab1",
 "label": "Contoso Data",
 "groups": [
 ]
}
```
- 4. In the simple ongoing example, the contextual tab has only a single group. Add the following as the only member of the groups array. About this markup, note:
	- All the properties are required.
	- The id property must be unique among all the groups in the manifest. Use a brief, descriptive ID, of up to 125 characters.
	- The label is a user-friendly string to serve as the label of the group.
	- The icon property's value is an array of objects that specify the icons that the group will have on the ribbon depending on the size of the ribbon and the Office application window.
	- The controls property's value is an array of objects that specify the buttons and menus in the group. There must be at least one.

```
JSON
{
 "id": "CustomGroup111",
 "label": "Insertion",
 "icon": [
 ],
 "controls": [
```


- 5. Every group must have an icon of at least three sizes: 16x16 px, 32x32 px, and 80x80 px. Optionally, you can also have icons of sizes 20x20 px, 24x24 px, 40x40 px, 48x48 px, and 64x64 px. Office decides which icon to use based on the size of the ribbon and Office application window. Add the following objects to the icon array. (If the window and ribbon sizes are large enough for at least one of the *controls* on the group to appear, then no group icon at all appears. For an example, watch the **Styles** group on the Word ribbon as you shrink and expand the Word window.) About this markup, note:
	- Both the properties are required.
	- The size property unit of measure is pixels. Icons are always square, so the number is both the height and the width.
	- The sourceLocation property specifies the full URL to the icon. Its value must match the URL specified in the **<Image>** element of the **<Resources>** section of your manifest (see Specify the icons for your contextual tab).

#### ) **Important**

 ] }

Just as you typically must change the URLs in the add-in's manifest when you move from development to production, you must also change the URLs in your contextual tabs JSON.

```
JSON
```

```
{
 "size": 16,
 "sourceLocation": 
"https://cdn.contoso.com/addins/datainsertion/Images/Group16x16.png"
},
{
 "size": 32,
 "sourceLocation": 
"https://cdn.contoso.com/addins/datainsertion/Images/Group32x32.png"
},
{
 "size": 80,
 "sourceLocation": 
"https://cdn.contoso.com/addins/datainsertion/Images/Group80x80.png"
}
```
- 6. In our simple ongoing example, the group has only a single button. Add the following object as the only member of the controls array. About this markup, note:


- All the properties, except enabled , are required.
- type specifies the type of control. The values can be "Button" , "Menu" , or "MobileButton" .
- id can be up to 125 characters.
- actionId must be the ID of an action defined in the actions array. (See step 1 of this section.)
- label is a user-friendly string to serve as the label of the button.
- superTip represents a rich form of tool tip. Both the title and description properties are required.
- icon specifies the icons for the button. The previous remarks about the group icon apply here too.
- enabled (optional) specifies whether the button is enabled when the contextual tab appears starts up. The default if not present is true .

```
JSON
{
 "type": "Button",
 "id": "CtxBt112",
 "actionId": "executeWriteData",
 "enabled": false,
 "label": "Write Data",
 "superTip": {
 "title": "Data Insertion",
 "description": "Use this button to insert data into the document."
 },
 "icon": [
 {
 "size": 16,
 "sourceLocation": 
"https://cdn.contoso.com/addins/datainsertion/Images/WriteDataButton16x16.png
"
 },
 {
 "size": 32,
 "sourceLocation": 
"https://cdn.contoso.com/addins/datainsertion/Images/WriteDataButton32x32.png
"
 },
 {
 "size": 80,
 "sourceLocation": 
"https://cdn.contoso.com/addins/datainsertion/Images/WriteDataButton80x80.png
"
 }
 ]
}
```


The following is the complete example of the JSON blob.

```
JSON
`{
 "actions": [
 {
 "id": "executeWriteData",
 "type": "ExecuteFunction",
 "functionName": "writeData"
 }
 ],
 "tabs": [
 {
 "id": "CtxTab1",
 "label": "Contoso Data",
 "groups": [
 {
 "id": "CustomGroup111",
 "label": "Insertion",
 "icon": [
 {
 "size": 16,
 "sourceLocation": 
"https://cdn.contoso.com/addins/datainsertion/Images/Group16x16.png"
 },
 {
 "size": 32,
 "sourceLocation": 
"https://cdn.contoso.com/addins/datainsertion/Images/Group32x32.png"
 },
 {
 "size": 80,
 "sourceLocation": 
"https://cdn.contoso.com/addins/datainsertion/Images/Group80x80.png"
 }
 ],
 "controls": [
 {
 "type": "Button",
 "id": "CtxBt112",
 "actionId": "executeWriteData",
 "enabled": false,
 "label": "Write Data",
 "superTip": {
 "title": "Data Insertion",
 "description": "Use this button to insert data into the
document."
 },
 "icon": [
 {
 "size": 16,
                "sourceLocation": 
"https://cdn.contoso.com/addins/datainsertion/Images/WriteDataButton16x16.png"
```


## **Register the contextual tab with Office with requestCreateControls**

The contextual tab is registered with Office by calling the [Office.ribbon.requestCreateControls](https://learn.microsoft.com/en-us/javascript/api/office/office.ribbon?view=common-js&preserve-view=true#office-office-ribbon-requestcreatecontrols-member(1)) method. This is typically done in either the function that's assigned to Office.initialize or with the Office.onReady function. For more about these functions and initializing the add-in, see Initialize your Office Add-in. You can, however, call the method anytime after initialization.

#### ) **Important**

The requestCreateControls method may be called only once in a given session of an addin. An error is thrown if it's called again.

The following is an example. Note that the JSON string must be converted to a JavaScript object with the JSON.parse method before it can be passed to a JavaScript function.

```
JavaScript
Office.onReady(async () => {
 const contextualTabJSON = ` ... `; // Assign the JSON string such as the one
at the end of the preceding section.
 const contextualTab = JSON.parse(contextualTabJSON);
    await Office.ribbon.requestCreateControls(contextualTab);
});
```


## **Specify the contexts when the tab will be visible with requestUpdate**

Typically, a custom contextual tab should appear when a user-initiated event changes the addin context. Consider a scenario in which the tab should be visible when, and only when, a chart (on the default worksheet of an Excel workbook) is activated.

Begin by assigning handlers. This is commonly done in the Office.onReady function as in the following example which assigns handlers (created in a later step) to the onActivated and onDeactivated events of all the charts in the worksheet.

JavaScript

```
Office.onReady(async () => {
 const contextualTabJSON = ` ... `; // Assign the JSON string.
 const contextualTab = JSON.parse(contextualTabJSON);
    await Office.ribbon.requestCreateControls(contextualTab);
 await Excel.run(context => {
        const charts = context.workbook.worksheets
           .getActiveWorksheet()
           .charts;
       charts.onActivated.add(showDataTab);
       charts.onDeactivated.add(hideDataTab);
        return context.sync();
   });
});
```
Next, define the handlers. The following is a simple example of a showDataTab , but see Handling the HostRestartNeeded error later in this article for a more robust version of the function. About this code, note:

- Office controls when it updates the state of the ribbon. The [Office.ribbon.requestUpdate](https://learn.microsoft.com/en-us/javascript/api/office/office.ribbon?view=common-js&preserve-view=true#office-office-ribbon-requestupdate-member(1)) method queues a request to update. The method will resolve the Promise object as soon as it has queued the request, not when the ribbon actually updates.
- The parameter for the requestUpdate method is a [RibbonUpdaterData](https://learn.microsoft.com/en-us/javascript/api/office/office.ribbonupdaterdata) object that (1) specifies the tab by its ID *exactly as specified in the JSON* and (2) specifies visibility of the tab.
- If you have more than one custom contextual tab that should be visible in the same context, you simply add additional tab objects to the tabs array.

JavaScript

```
async function showDataTab() {
 await Office.ribbon.requestUpdate({
```


```
 tabs: [
 {
 id: "CtxTab1",
 visible: true
 }
 ]});
}
```
The handler to hide the tab is nearly identical, except that it sets the visible property back to false .

The Office JavaScript library also provides several interfaces (types) to make it easier to construct the RibbonUpdateData object. The following is the showDataTab function in TypeScript and it makes use of these types.

```
TypeScript
const showDataTab = async () => {
 const myContextualTab: Office.Tab = {id: "CtxTab1", visible: true};
 const ribbonUpdater: Office.RibbonUpdaterData = { tabs: [ myContextualTab ]};
 await Office.ribbon.requestUpdate(ribbonUpdater);
}
```
### **Toggle tab visibility and the enabled status of a button at the same time**

The requestUpdate method is also used to toggle the enabled or disabled status of a custom button on either a custom contextual tab or a custom core tab. For details about this, see Change the availability of add-in commands. There may be scenarios in which you want to change both the visibility of a tab and the enabled status of a button at the same time. You do this with a single call of requestUpdate . The following is an example in which a button on a core tab is enabled at the same time as a contextual tab is made visible.

```
JavaScript
function myContextChanges() {
 Office.ribbon.requestUpdate({
 tabs: [
 {
 id: "CtxTab1",
 visible: true
 },
 {
 id: "OfficeAppTab1",
 groups: [
 {
```


```
 id: "CustomGroup111",
        controls: [
 {
 id: "MyButton",
           enabled: true
 }
 ]
 }
 ]
 ]}
 ]
 });
}
```
In the following example, the button that's enabled is on the very same contextual tab that is being made visible.

```
JavaScript
function myContextChanges() {
 Office.ribbon.requestUpdate({
 tabs: [
 {
 id: "CtxTab1",
 visible: true,
 groups: [
 {
 id: "CustomGroup111",
           controls: [
 {
 id: "MyButton",
               enabled: true
 }
 ]
 }
 ]
 }
 ]
 });
}
```
## **Open a task pane from contextual tabs**

To open your task pane from a button on a custom contextual tab, create an action in the JSON with a type of ShowTaskpane . Then define a button with the actionId property set to the id of the action. This opens the default task pane specified in your manifest.


```
`{
 "actions": [
 {
 "id": "openChartsTaskpane",
 "type": "ShowTaskpane",
 "title": "Work with Charts",
 "supportPinning": false
 }
 ],
 "tabs": [
 {
 // some tab properties omitted
 "groups": [
 {
 // some group properties omitted
 "controls": [
 {
 "type": "Button",
 "id": "CtxBt112",
 "actionId": "openChartsTaskpane",
 "enabled": false,
 "label": "Open Charts Taskpane",
 // some control properties omitted
 }
 ]
 }
 ]
 }
 ]
}`
```
To open any task pane that's not the default task pane, specify a sourceLocation property in the definition of the action. In the following example, a second task pane is opened from a different button.

#### ) **Important**

- When a sourceLocation is specified for the action, then the task pane does *not* use the shared runtime. It runs in a new separate runtime.
- No more than one task pane can use the shared runtime, so no more than one action of type ShowTaskpane can omit the sourceLocation property.

```
JSON
`{
 "actions": [
 {
 "id": "openChartsTaskpane",
```


```
 "type": "ShowTaskpane",
 "title": "Work with Charts",
 "supportPinning": false
 },
 {
 "id": "openTablesTaskpane",
 "type": "ShowTaskpane",
 "title": "Work with Tables",
 "supportPinning": false
 "sourceLocation": "https://MyDomain.com/myPage.html"
 }
 ],
 "tabs": [
 {
 // some tab properties omitted
 "groups": [
 {
 // some group properties omitted
 "controls": [
 {
 "type": "Button",
 "id": "CtxBt112",
 "actionId": "openChartsTaskpane",
 "enabled": false,
 "label": "Open Charts Taskpane",
 // some control properties omitted
 },
 {
 "type": "Button",
 "id": "CtxBt113",
 "actionId": "openTablesTaskpane",
 "enabled": false,
 "label": "Open Tables Taskpane",
 // some control properties omitted
 }
 ]
 }
 ]
 }
 ]
}`
```
### **Localize the JSON text**

The JSON blob that's passed to requestCreateControls isn't localized the same way that the manifest markup for custom core tabs is localized (which is described at Control localization from the manifest). Instead, the localization must occur at runtime using distinct JSON blobs for each locale. We suggest that you use a switch statement that tests the [Office.context.displayLanguage](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-displaylanguage-member) property. The following is an example.


```
JavaScript
```

```
function GetContextualTabsJsonSupportedLocale () {
 const displayLanguage = Office.context.displayLanguage;
 switch (displayLanguage) {
 case 'en-US':
 return `{
 "actions": [
 // actions omitted
 ],
 "tabs": [
 {
 "id": "CtxTab1",
            "label": "Contoso Data",
            "groups": [
 // groups omitted
 ]
 }
 ]
 }`;
 case 'fr-FR':
 return `{
 "actions": [
 // actions omitted 
 ],
 "tabs": [
 {
 "id": "CtxTab1",
            "label": "Contoso Données",
            "groups": [
 // groups omitted
 ]
 }
 ]
 }`;
 // Other cases omitted
 }
}
```
Then your code calls the function to get the localized blob that's passed to requestCreateControls , as in the following example.

JavaScript

const contextualTabJSON = GetContextualTabsJsonSupportedLocale();

### **Best practices for custom contextual tabs**


### **Implement an alternate UI experience when custom contextual tabs aren't supported**

Some combinations of platform, Office application, and Office build don't support requestCreateControls . Your add-in should be designed to provide an alternate experience to users who are running the add-in on one of those combinations. The following sections describe two ways of providing a fallback experience.

#### **Use noncontextual tabs or controls**

The add-in's manifest provides a way to create a fallback experience in an add-in that implements custom contextual tabs when the add-in is running on an application or platform that doesn't support custom contextual tabs. The strategy is to define a custom core tab (that is, *noncontextual* custom tab) in the manifest that duplicates the ribbon customizations of the custom contextual tabs in your add-in. Then you use special manifest markup to enable the custom core tab to be visible all the time on platform and version combinations that don't support custom contextual tabs. The process depends on which type of manifest your add-in uses.

Unified manifest for Microsoft 365

#### 7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word add-ins.

Begin by defining a custom core tab (that is, *noncontextual* custom tab) in the manifest that duplicates the ribbon customizations of the custom contextual tabs in your add-in. Then, mark any control groups, or individual controls, or menu items that shouldn't be visible on platforms that support contextual tabs. You mark a group, control, or menu item object by adding an "overriddenByRibbonApi" property to it and setting its value to true . The effect of doing so is the following:

- If the add-in runs on an application and platform that support custom contextual tabs, then the marked custom groups, controls, and menu items won't appear on the ribbon. Instead, the custom contextual tab will be created when the add-in calls the requestCreateControls method.
- If the add-in runs on an application or platform that *doesn't* support requestCreateControls , then the groups, controls, and menu items do appear on the custom core tab.


The following is an example. Note that "Contoso.MyButton1" will appear on the custom core tab only when custom contextual tabs aren't supported. However, the parent group (with "ContosoButton2") and the custom core tab will appear regardless of whether custom contextual tabs are supported.

The following is another example. Note that "MyControlGroup" will appear on the custom core tab only when custom contextual tabs aren't supported. However, the parent custom core tab (with unmarked groups) will appear regardless of whether custom contextual tabs are supported.

JSON "extensions": [ ...


```
 {
 ...
 "ribbons": [
 ...
 {
 ...
 "tabs": [
 {
 "id": "MyTab",
         "groups": [
 {
 "id": "MyControlGroup",
            "overriddenByRibbonApi": true
            ...
            "controls": [
 {
 "id": "Contoso.MyButton1",
               ...
 }
 ]
 },
          ... other groups configured here
 ]
 }
 ]
 }
 ]
 }
]
```
When a parent menu control is marked with "overriddenByRibbonApi": true , then it isn't visible, and all of its child markup is ignored when custom contextual tabs aren't supported. So, it doesn't matter if any of those child menu items have the "overriddenByRibbonApi" property or what its value is. The implication of this is that if a menu item must be visible in all contexts, then not only should it not be marked with "overriddenByRibbonApi": true , but *its ancestor menu control must also not be marked this way*. A similar point applies to ribbon controls. If a control must be visible in all contexts, then not only should it not be marked with "overriddenByRibbonApi": true , but its parent group must also not be marked this way.

#### ) **Important**

Don't mark *all* of the child items of a menu with "overriddenByRibbonApi": true . This is pointless if the parent element is marked with "overriddenByRibbonApi": true for reasons given in the preceding paragraph. Moreover, if you leave out the "overriddenByRibbonApi" property on the parent menu control (or set it to false ), then the parent will appear regardless of whether custom contextual tabs are


supported, but it will be empty when they are supported. So, if all the child elements shouldn't appear when custom contextual tabs are supported, mark the *parent* menu control with "overriddenByRibbonApi": true .

A parallel point applies to groups and controls, don't mark all of the controls in a group with "overriddenByRibbonApi": true . This is pointless if the parent group is marked with "overriddenByRibbonApi": true . Moreover, if you leave out the "overriddenByRibbonApi" property on the parent group (or set it to false ), then the group will appear regardless of whether custom contextual tabs are supported, but it will have no controls in it when they are supported. So, if all the controls shouldn't appear when custom contextual tabs are supported, mark the parent group with "overriddenByRibbonApi": true .

#### **Use APIs that show or hide a task pane in specified contexts**

As an alternative to using the manifest, your add-in can define a task pane with UI controls that duplicate the functionality of the controls on a custom contextual tab. Then use the [Office.addin.showAsTaskpane](https://learn.microsoft.com/en-us/javascript/api/office/office.addin?view=common-js&preserve-view=true#office-office-addin-showastaskpane-member(1)) and [Office.addin.hide](https://learn.microsoft.com/en-us/javascript/api/office/office.addin?view=common-js&preserve-view=true#office-office-addin-hide-member(1)) methods to show the task pane when the contextual tab would have been shown if it was supported. For details on how to use these methods, see Show or hide the task pane of your Office Add-in.

### **Handle the HostRestartNeeded error**

In some scenarios, Office is unable to update the ribbon and will return an error. For example, if the add-in is upgraded and the upgraded add-in has a different set of custom add-in commands, then the Office application must be closed and reopened. Until it is, the requestUpdate method will return the error HostRestartNeeded . Your code should handle this error. The following is an example of how. In this case, the reportError method displays the error to the user.

JavaScript

```
function showDataTab() {
 try {
 Office.ribbon.requestUpdate({
 tabs: [
 {
 id: "CtxTab1",
 visible: true
 }
 ]});
 }
```


```
 catch(error) {
 if (error.code == "HostRestartNeeded"){
 reportError("Contoso Awesome Add-in has been upgraded. Please save
your work, then close and reopen the Office application.");
 }
 }
}
```
## **Resources**

- [Code sample: Create custom contextual tabs on the ribbon](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/office-contextual-tabs)
- Community demo of contextual tabs sample <https://www.youtube-nocookie.com/embed/9tLfm4boQIo>


# **Change the availability of add-in commands**

Article • 03/12/2025

When some functionality in your add-in should only be available in certain contexts, you can programmatically configure your custom add-in commands to only be available in these contexts. For example, a function that changes the header of a table should only be available when the cursor is in a table.

#### 7 **Note**

- This article assumes that you're familiar with the **basic concepts for add-in commands**. Please review it if you haven't worked with add-in commands (custom menu items and ribbon buttons) recently.
### **Supported capabilities**

You can programmatically change the availability of an add-in command for the following capabilities.

- Ribbon buttons, menus, and tabs.
- Context menu items.

### **Office application and requirement set support**

The following table outlines the Office applications that support configuring the availability of add-in commands. It also lists the requirement sets needed to use the API.

ノ **Expand table**

| Add-in command capability       | Requirement set | Supported Office applications |
|---------------------------------|-----------------|-------------------------------|
| Ribbon buttons, menus, and tabs | RibbonApi 1.1   | Excel<br>PowerPoint<br>Word   |


| Add-in command capability | Requirement set    | Supported Office applications |
|---------------------------|--------------------|-------------------------------|
| Context menu items        | ContextMenuApi 1.1 | Excel<br>PowerPoint<br>Word   |

#### **Tip**

To learn how to test for platform support with requirement sets, see **Office versions and requirement sets**.

## **Configure a shared runtime**

To change the availability of a ribbon or context menu control or item, the manifest of your add-in must first be configured to use a shared runtime. For guidance on how to set up a shared runtime, see Configure your Office Add-in to use a shared runtime.

## **Programmatically change the availability of an add-in command**

Ribbon

### **Deactivate ribbon controls at launch**

7 **Note**

Only the controls on the ribbon can be deactivated when the Office application starts. You can't deactivate custom controls added to a context menu at launch.

By default, a custom button or menu item on the ribbon is available for use when the Office application launches. To deactivate it when Office starts, you must specify this in the manifest. The process depends on which type of manifest your add-in uses.

- Unified manifest for Microsoft 365
- Add-in only manifest


#### 7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word addins.

Just add an "enabled" property with the value false to the control or menu item object. The following shows the basic structure.

```
JSON
"extensions": [
 ...
 {
 ...
 "ribbons": [
 ...
 {
 ...
 {
```
#### **Add-in only manifest**

Just add an [Enabled](https://learn.microsoft.com/en-us/javascript/api/manifest/enabled) element immediately *below* (not inside) the [Action](https://learn.microsoft.com/en-us/javascript/api/manifest/action) element of the control item. Then, set its value to false .


The following shows the basic structure of a manifest that configures the **<Enabled>** element.

```
XML
<OfficeApp ...>
  ...
  <VersionOverrides ...>
    ...
    <Hosts>
      <Host ...>
        ...
        <DesktopFormFactor>
          <ExtensionPoint ...>
            <CustomTab ...>
              ...
              <Group ...>
                 ...
                 <Control ... id="Contoso.MyButton3">
                   ...
                   <Action ...>
                   <Enabled>false</Enabled>
...
</OfficeApp>
```
### **Change the availability of a ribbon control**

To update the availability of a button or menu item on the ribbon, perform the following steps.

- 1. Create a [RibbonUpdaterData](https://learn.microsoft.com/en-us/javascript/api/office/office.ribbonupdaterdata) object that specifies the following:
	- The IDs of the command, including its parent group and tab. The IDs must match those declared in the manifest.
	- The availability status of the command.
- 2. Pass the **RibbonUpdaterData** object to the [Office.ribbon.requestUpdate()](https://learn.microsoft.com/en-us/javascript/api/office/office.ribbon?view=common-js&preserve-view=true#office-office-ribbon-requestupdate-member(1)) method.

The following is a simple example. Note that "MyButton", "OfficeAddinTab1", and "CustomGroup111" are copied from the manifest.

JavaScript

```
function enableButton() {
 const ribbonUpdaterData = {
 tabs: [
 {
```


```
 id: "OfficeAppTab1",
 groups: [
 {
 id: "CustomGroup111",
          controls: [
 {
 id: "MyButton",
            enabled: true
 }
 ]
 }
 ]
 }
 ]
 };
 Office.ribbon.requestUpdate(ribbonUpdaterData);
}
```
There are several interfaces (types) to make it easier to construct the **RibbonUpdateData** object.

- [Office.Control](https://learn.microsoft.com/en-us/javascript/api/office/office.control)
- [Office.Group](https://learn.microsoft.com/en-us/javascript/api/office/office.group)
- [Office.Tab](https://learn.microsoft.com/en-us/javascript/api/office/office.tab)

The following is the equivalent example in TypeScript and it makes use of these types.

#### TypeScript

```
const enableButton = async () => {
 const button: Control = { id: "MyButton", enabled: true };
 const parentGroup: Group = { id: "CustomGroup111", controls:
[button] };
 const parentTab: Tab = { id: "OfficeAddinTab1", groups:
[parentGroup] };
 const ribbonUpdater: RibbonUpdaterData = { tabs: [parentTab] };
 Office.ribbon.requestUpdate(ribbonUpdater);
}
```
#### **Tip**

You can await the call of **requestUpdate()** if the parent function is asynchronous, but note that the Office application controls when it updates the state of the ribbon. The **requestUpdate()** method queues a request to


update. The method will resolve the promise object as soon as it has queued the request, not when the ribbon actually updates.

### **Toggle tab visibility and the enabled status of a button at the same time**

The **requestUpdate** method is also used to toggle the visibility of a custom contextual tab. For details about this and example code, see Create custom contextual tabs in Office Add-ins.

### **Change the state in response to an event**

A common scenario in which the state of a ribbon or context menu control should change is when a user-initiated event changes the add-in context. Consider a scenario in which a button should be available when, and only when, a chart is activated. Although the following example uses ribbon controls, a similar implementation can be applied to custom items on a context menu.

- 1. First, set the **<Enabled>** element for the button in the manifest to false . For guidance on how to configure this, see Deactivate ribbon controls at launch.
- 2. Then, assign handlers. This is commonly done in the **Office.onReady** function as in the following example. In the example, handlers (created in a later step) are assigned to the **onActivated** and **onDeactivated** events of all the charts in an Excel worksheet.

```
JavaScript
```

```
Office.onReady(async () => {
    await Excel.run((context) => {
        const charts = context.workbook.worksheets
            .getActiveWorksheet()
            .charts;
        charts.onActivated.add(enableChartFormat);
        charts.onDeactivated.add(disableChartFormat);
        return context.sync();
    });
});
```
- 3. Define the enableChartFormat handler. The following is a simple example. For a more robust way of changing a control's status, see Best practice: Test for control status errors.


```
JavaScript
function enableChartFormat() {
 const button =
 {
 id: "ChartFormatButton",
 enabled: true
 };
 const parentGroup =
 {
 id: "MyGroup",
 controls: [button]
 };
 const parentTab =
 {
 id: "CustomChartTab",
 groups: [parentGroup]
 };
 const ribbonUpdater = { tabs: [parentTab] };
 Office.ribbon.requestUpdate(ribbonUpdater);
}
```
- 4. Define the disableChartFormat handler. It's identical to the enableChartFormat handler, except that the **enabled** property of the button object is set to false .
### **Best practice: Test for control status errors**

In some circumstances, the ribbon or context menu doesn't repaint after requestUpdate is called, so the control's clickable status doesn't change. For this reason it's a best practice for the add-in to keep track of the status of its controls. The add-in should conform to the following rules.

- Whenever requestUpdate is called, the code should record the intended state of the custom buttons and menu items.
- When a custom control is selected, the first code in the handler should check to see if the button should have been available. If it shouldn't have been available, the code should report or log an error and try again to set the buttons to the intended state.

The following example shows a function that deactivates a button on the ribbon and records the button's status. In this example, chartFormatButtonEnabled is a global boolean variable that's initialized to the same value as the [Enabled](https://learn.microsoft.com/en-us/javascript/api/manifest/enabled) element for the button in the add-in's manifest. Although the example uses a ribbon button, a similar implementation can be applied to custom items on a context menu.


```
JavaScript
```

```
function disableChartFormat() {
 const button =
 {
 id: "ChartFormatButton",
 enabled: false
 };
 const parentGroup =
 {
 id: "MyGroup",
 controls: [button]
 };
 const parentTab =
 {
 id: "CustomChartTab",
 groups: [parentGroup]
 };
 const ribbonUpdater = { tabs: [parentTab] };
 Office.ribbon.requestUpdate(ribbonUpdater);
 chartFormatButtonEnabled = false;
}
```
The following example shows how the button's handler tests for an incorrect state of the button. Note that reportError is a function that shows or logs an error.

```
JavaScript
function chartFormatButtonHandler() {
 if (chartFormatButtonEnabled) {
 // Do work here.
 } else {
 // Report the error and try to make the button unavailable again.
 reportError("That action is not possible at this time.");
 disableChartFormat();
 }
}
```
## **Error handling**

In some scenarios, Office is unable to update the ribbon or context menu and will return an error. For example, if the add-in is upgraded and the upgraded add-in has a different set of custom add-in commands, then the Office application must be closed and reopened. Until it is, the requestUpdate method will return the error HostRestartNeeded . The following is an example of how to handle this error. In this case, the reportError


method displays the error to the user. Although the example uses a ribbon button, a similar implementation can be applied to custom items on a context menu.

```
JavaScript
function disableChartFormat() {
 try {
 const button =
 {
 id: "ChartFormatButton",
 enabled: false
 };
 const parentGroup =
 {
 id: "MyGroup",
 controls: [button]
 };
 const parentTab =
 {
 id: "CustomChartTab",
 groups: [parentGroup]
 };
 const ribbonUpdater = { tabs: [parentTab] };
 Office.ribbon.requestUpdate(ribbonUpdater);
 chartFormatButtonEnabled = false;
 }
 catch(error) {
 if (error.code == "HostRestartNeeded"){
 reportError("Contoso Awesome Add-in has been upgraded. Please
save your work, close the Office application, and restart it.");
 }
 }
}
```
## **See also**

- Add-in commands
- Create add-in commands with the add-in only manifest
- Create custom contextual tabs in Office Add-ins


# **Integrate built-in Office buttons into custom control groups and tabs**

06/10/2025

You can insert built-in Office buttons into your custom control groups on the Office ribbon by using markup in the add-in's manifest. (You can't insert your custom add-in commands into a built-in Office group.) You can also insert entire built-in Office control groups into your custom ribbon tabs.

#### 7 **Note**

This article assumes that you're familiar with the article **Basic concepts for add-in commands**. Please review it if you haven't done so recently.

#### ) **Important**

The add-in feature described in this article is only available in **PowerPoint** on the web, on Windows, and on Mac.

Open the tab for the type of manifest your add-in uses for the details of the manifest markup.

Unified manifest for Microsoft 365

#### 7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word add-ins.

### **Insert a built-in control group into a custom tab**

To insert a built-in Office control group into a custom tab, add a group object with a ["builtInGroupId"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array-tabs-item#builtintabid) property *instead of an ["id"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array-tabs-item#id) property* to the ["groups"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-array-tabs-item#groups) array of your custom tab object. Set to the ID of the built-in group. See Find the IDs of controls and control groups. *The built-in group object should have no other properties.*

The following example adds the Office Paragraph control group to a custom tab.


```
"extensions": [
 ...
 {
 ...
 "ribbons": [
 ...
 {
 ...
 "tabs": [
 {
 "id": "MyTab",
           ...
           "groups": [
 ... // Optionally, other groups in the tab.
             {
 "builtInGroupId": "Paragraph"
 },
             ... // Optionally, other groups in the tab.
 ]
 }
 ]
 }
 ]
 }
]
```
### **Insert a built-in control into a custom group**

To insert a built-in Office control into a custom group, add a control object with a "builtInControlId" property *instead of an "id" property* to the ["controls"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-ribbons-custom-tab-groups-item#controls) array of your custom group object. Set to the ID of the built-in control. See Find the IDs of controls and control groups. *The built-in control object should have no other properties.*

The following example adds the Office Superscript control to a custom group.

```
JSON
"extensions": [
 ...
 {
 ...
 "ribbons": [
 ...
 {
 ...
 "tabs": [
 {
 ...
           "groups": [
```


#### 7 **Note**

Users can customize the ribbon in the Office application. Any user customizations will override your manifest settings. For example, a user can remove a button from any group and remove any group from a tab.

## **Find the IDs of controls and control groups**

The IDs for supported controls and control groups are in files in the repo [Office Control IDs](https://github.com/OfficeDev/office-control-ids) . Follow the instructions in the ReadMe file of that repo.

### **Behavior on unsupported platforms**

If your add-in is installed on a platform that doesn't support [requirement set AddinCommands](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/add-in-commands-requirement-sets) [1.3,](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/add-in-commands-requirement-sets) then the markup described in this article is ignored and the built-in Office controls/groups won't appear in your custom groups/tabs. To prevent your add-in from being installed on platforms that don't support the markup, you must specify **AddinCommands 1.3** in the manifest as a requirement for installation. For instructions, see Specify which Office versions and platforms can host your add-in. Alternatively, design your add-in to have an experience when **AddinCommands 1.3** isn't supported, as described in Design for alternate experiences. For example, if your add-in contains instructions that assume the built-in buttons are in your


custom groups, you could design a version that assumes that the built-in buttons are only in their usual places.


# **Position a custom tab on the ribbon**

Article • 02/12/2025

You can specify where you want your add-in's custom tab to appear on the Office application's ribbon by using markup in the add-in's manifest.

#### 7 **Note**

This article assumes that you're familiar with the article **Basic concepts for add-in commands**. Please review it if you haven't done so recently.

#### ) **Important**

- The add-in feature and markup described in this article is *only available in PowerPoint on the web*.
- The markup described in this article only works on platforms that support requirement set **AddinCommands 1.3**. See **Behavior on unsupported platforms** below.

By default, a custom tab is added to the end of the ribbon. However, you can specify where you want a custom tab to appear by identifying which built-in Office tab you want it to be next to and specifying whether it should be on the left or right side of the built-in tab. Open the tab for the type of manifest your add-in uses for the details of the manifest markup.

Unified manifest for Microsoft 365

7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word addins.

To position your custom tab, include a "position" property in the "extensions.ribbons.tabs" object. Set the "position.builtInTabId" property to the ID of the built-in tab that you want your custom tab to be next to. (See [Find the IDs of](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/built-in-ui-ids) [built-in Office ribbon tabs](https://learn.microsoft.com/en-us/office/dev/add-ins/develop/built-in-ui-ids).) Set the "position.align" property to either "before" (left) or "after" (right).


In the following example, the custom tab is configured to appear *just after* the **Review** tab.

JSON

```
"extensions": [
 ...
 {
 ...
 "ribbons": [
 ...
 {
 ...
 "tabs": [
 {
 "id": "MyTab",
          ...
          "position": {
 "builtInTabId": "TabReview",
            "align": "after"
 }
 }
 ]
 }
 ]
 }
]
```
## **How user actions can affect custom tab positioning**

- If the user installs more than one add-in whose custom tab is configured for the same place, say after the **Review** tab, then the tab for the most recently installed add-in will be located in that place. The tabs of the previously installed add-ins will be moved over one place. For example, the user installs add-ins A, B, and C in that order and all are configured to insert a tab after the **Review** tab, then the tabs will appear in this order: **Review**, **AddinCTab**, **AddinBTab**, **AddinATab**.
- Users can customize the ribbon in the Office application. For example, a user can move or hide your add-in's tab. You cannot prevent this or detect that it has happened.
- If a user moves one of the built-in tabs, then Office interprets the positioning markup in the manifest in terms of *the default location of the built-in tab*. For example, if the user moves the **Review** tab to the right end of the ribbon, Office will interpret the markup in the previous example as meaning "put the custom tab just to the right of *where the Review tab would be by default*."


## **Specify which tab has focus when the document opens**

Office always gives default focus to the tab that's immediately to the right of the **File** tab. By default this is the **Home** tab. If you configure your custom tab to be before the **Home** tab, then your custom tab will have focus when the document opens.

#### ) **Important**

Giving excessive prominence to your add-in inconveniences and annoys users and administrators. Don't position a custom tab before the **Home** tab unless your addin is the primary way users will interact with the document.

### **Behavior on unsupported platforms**

If your add-in is installed on a platform that doesn't support [requirement set](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/add-in-commands-requirement-sets) [AddinCommands 1.3](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/add-in-commands-requirement-sets), then the markup described in this article is ignored and your custom tab will appear as the rightmost tab on the ribbon. To prevent your add-in from being installed on platforms that don't support the markup, you must specify **AddinCommands 1.3** in the manifest as a requirement for installation. For instructions, see Specify which Office versions and platforms can host your add-in. Alternatively, design your add-in to have an alternate experience when **AddinCommands 1.3** isn't supported, as described in Design for alternate experiences. For example, if your add-in contains instructions that assume the custom tab is where you want it, you could have an alternate version that assumes the tab is the rightmost.


# **Content Office Add-ins**

Article • 02/12/2025

Content add-ins are surfaces that can be embedded directly into Excel or PowerPoint documents. Content add-ins give users access to interface controls that run code to modify documents or display data from a data source. Use content add-ins when you want to embed functionality directly into the document.

|  | My Files<br>Shared Files<br>Recent |  |
|--|------------------------------------|--|
|  |                                    |  |
|  | Logo Contoso, Ltd<br>్లో           |  |
|  | 1                                  |  |

### **Best practices**

- Include some navigational or commanding element such as the CommandBar or Pivot at the top of your add-in.
- Include a branding element such as the BrandBar at the bottom of your add-in (applies to Excel and PowerPoint add-ins only).

## **Variants**


Content add-in sizes for Excel and PowerPoint in Office desktop and in a web browser are user specified.

# **Personality menu**

Personality menus can obstruct navigational and commanding elements located near the top right of the add-in. The following are the current dimensions of the personality menu on Windows and Mac.

For Windows, the personality menu measures 12x32 pixels, as shown.

*Figure 2. Personality menu on Windows*

For Mac, the personality menu measures 26x26 pixels, but floats 8 pixels in from the right and 6 pixels from the top, which increases the occupied space to 34x32 pixels, as shown.

*Figure 3. Personality menu on Mac*


## **Implementation**

There are minor differences in the manifests between content add-ins and add-ins that use task panes. Open the tab for the type of manifest you're using.

Unified manifest for Microsoft 365

#### 7 **Note**

The unified manifest is available in Excel, PowerPoint, and Word as a developer preview. For Outlook, it's generally available and can be used in production add-ins.

Configure the manifest with the following steps.

- 1. Add a "contentRuntimes" child array to the extension object in the "extensions" array.
- 2. Remove the "runtimes" property if it is present. The "runtimes" array is for task pane or mail add-ins. These cannot be combined with a content add-in.
- 3. Add an anonymous content runtime object in the "contentRuntimes" array.
- 4. Set the "id" property of the object to a descriptive name.
- 5. Set the "code.page" object to the full URL of the custom content that you want to embed in the document.
- 6. Optionally, set the "requestedWidth" and "requestedHeight" properties to a size between 32 and 1000 pixels. If these properties aren't used, the Office application determines the size.


- 7. Optionally, set the "disableSnapshot" property to true to prevent Office from saving a snapshot of the content component with the document.
The following is an example of a "contentRuntimes" property.

```
JSON
"contentRuntimes": [
 {
 "id": "ContentRuntime",
 "code": {
 "page": "https://localhost:3000/content.html"
 },
 "requestedWidth": 100,
 "requestedHeight": 100,
 "disableSnapshot": true,
 }
]
```
For a sample that implements a content add-in, see [Excel Content Add-in Humongous](https://github.com/OfficeDev/Excel-Content-Add-in-Humongous-Insurance) [Insurance](https://github.com/OfficeDev/Excel-Content-Add-in-Humongous-Insurance) on GitHub.

To create your own content add-in, see the Excel content add-in quick start and PowerPoint content add-in quick start.

### **Support considerations**

- Check to see if your Office Add-in will work on a [specific Office application or](https://learn.microsoft.com/en-us/javascript/api/requirement-sets) [platform.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets)
- Some content add-ins may require the user to "trust" the add-in to read and write to Excel or PowerPoint. You can declare what level of permissions you want your user to have in the add-in's manifest.

## **See also**

- [Office client application and platform availability for Office Add-ins](https://learn.microsoft.com/en-us/javascript/api/requirement-sets)
- Fabric Core in Office Add-ins
- UX design patterns for Office Add-ins
- Requesting permissions for API use in add-ins

# **Explore Office JavaScript API using Script Lab**

Article • 03/26/2025

Script Lab is a free tool for anyone to learn how to develop Office Add-ins. Script Lab lets you to code and run the Office JavaScript APIs alongside your document in Excel, Outlook, PowerPoint, and Word. Use this convenient tool to prototype and verify the functionality you want in your own add-in.

#### **[Get Script Lab for Excel, PowerPoint, and Word](https://appsource.microsoft.com/product/office/WA104380862)**

**[Get Script Lab for Outlook](https://appsource.microsoft.com/product/office/wa200001603)**

See Script Lab in action in this one-minute YouTube video.

| E                            |      |                              |      |                   |                                        | Book1 - Excel |                                 |          |          |                                                     | Michael Saunders                                                                          | 0         |          | × |
|------------------------------|------|------------------------------|------|-------------------|----------------------------------------|---------------|---------------------------------|----------|----------|-----------------------------------------------------|-------------------------------------------------------------------------------------------|-----------|----------|---|
| File                         | Home | Insert                       |      | Draw              | Page Layout                            | Formulas      | Data                            | Review   | View     | Load Test                                           | Script Lab                                                                                | Q Tell me | Q. Share | 0 |
| Code<br>Script               | Run  | Tutorial<br>About Script Lab | Help | Reference<br>Docs | Ask the<br>Community<br>About the APIs |               |                                 |          |          |                                                     |                                                                                           |           |          | < |
|                              |      |                              |      |                   |                                        |               |                                 |          |          |                                                     |                                                                                           |           |          |   |
| A4                           |      | :<br>♪<br>×                  | V    | fr                |                                        |               |                                 |          |          |                                                     |                                                                                           |           |          | V |
| A<br>1<br>2<br>3<br>4        | A    | B                            | C    |                   | D<br>E                                 |               |                                 |          | 6<br>all | 8<br>画                                              |                                                                                           |           | >        | × |
| 5                            |      |                              |      |                   |                                        |               | Script                          | Template | Style    | Libraries                                           |                                                                                           |           |          |   |
| б<br>7<br>8<br>9<br>10<br>11 |      |                              |      |                   |                                        |               | 1<br>2<br>3<br>4<br>5<br>ნ<br>7 | });      |          | Excel.run(async (context) => {<br>// your code here | const range = context.workbook.getSelectedRange();<br>range.format.fill.color = "yellow"; |           |          |   |
| 12<br>13                     |      |                              |      |                   |                                        |               | 8                               |          |          |                                                     |                                                                                           |           |          |   |
| 14<br>15                     |      |                              |      |                   |                                        |               | 9                               |          |          |                                                     |                                                                                           |           |          | L |

### **What is Script Lab?**

Script Lab is an add-in for prototyping add-ins. It uses the Office JavaScript API in Excel, Outlook, PowerPoint, Word and sits in a task pane inside your document, spreadsheet, or email. It has an IntelliSense-enabled code editor, built on the [same framework used](https://microsoft.github.io/monaco-editor/) [by Visual Studio Code](https://microsoft.github.io/monaco-editor/) . Through Script Lab, you have access to a library of samples. Quickly try out features or use these samples as the starting point for your own code. You can even try upcoming APIs in Script Lab that are still in preview.


**Script Lab** is unrelated to **Office Scripts**. **[Office Scripts](https://learn.microsoft.com/en-us/office/dev/scripts)** is a tool for end-user automation in Excel. Use Office Scripts if you want quick, reusable solutions that don't need integrations with web services.

## **Key features**

Script Lab offers a number of features to help you prototype add-in functionality and explore the Office JavaScript API.

#### **Explore samples**

Get started quickly with a collection of built-in sample snippets that show how to complete tasks with the API. Run the samples to instantly see the result in the task pane or document, examine the samples to learn how the API works, and even use samples to prototype your own add-in.

### **Code and style**


In addition to JavaScript or TypeScript code that calls the Office JS API, each snippet also contains HTML markup that defines content of the task pane and CSS that defines the appearance of the task pane. Customize the HTML markup and CSS to experiment with element placement and styling as you prototype task pane design for your own add-in.

#### **Preview APIs**

To call preview APIs within a snippet, you need to update the snippet's libraries to use the beta content delivery network (CDN)

( https://appsforoffice.microsoft.com/lib/beta/hosted/office.js ) and the preview type definitions @types/office-js-preview . Additionally, some preview APIs are only accessible if you've signed up for the [Microsoft 365 Insider program](https://aka.ms/MSFT365InsiderProgram) and are running an Insider build of Office.

#### **Save and share snippets**

By default, snippets that you open in Script Lab are saved to your browser cache or local storage. To save a snippet permanently, select **Copy** and paste the resulting clipboard content into a new .yml file. Use this to share snippets with colleagues or provide code for community sites, such as Stack Overflow.

To import a snippet into Script Lab, select **Import** from the menu and paste in the complete YAML for the snippet. If you've saved the YAML as a [GitHub gist](https://gist.github.com/) , you can paste a link to the gist instead.

### **Supported clients**

Script Lab is supported for Excel, Word, and PowerPoint on the following clients.

- Office on the web
- Office on Windows*
- Office on Mac

Script Lab for Outlook is available on the following clients.

- Outlook on the web when using Chrome, Microsoft Edge, or Safari browsers
- Outlook on Windows*
- Outlook on Mac

#### ) **Important**


* Script Lab no longer works with combinations of platform and Office version that use the Trident (Internet Explorer) webview to host add-ins. This includes perpetual versions of Office through Office 2019. For more information, see **Browsers and webview controls used by Office Add-ins**.

### **Limitations**

Script Lab is designed for you to play with small code samples. Generally, a snippet should be at most a few hundred lines and a few thousand characters.

Your snippet can use hard-coded data. A small amount of data (say, a few hundred characters) is OK to hard code in Script Lab. However, for larger pieces of data, we recommend that you store those externally then load them at runtime with a command like fetch .

Keep your snippets and hard-coded data small since storing several large snippets could exceed Script Lab's storage and cause issues when loading Script Lab.

### **Next steps**

**[Get Script Lab for Excel, PowerPoint, and Word](https://appsource.microsoft.com/product/office/WA104380862)**

**[Get Script Lab for Outlook](https://appsource.microsoft.com/product/office/wa200001603)**

Once you've prototyped your code in Script Lab, turn it into a real add-in with the steps in Create a standalone Office Add-in from your Script Lab code.

### **Issues**

If you find an issue or have feedback for us, let us know!

- Issue in this article? See the "Office Add-ins feedback" section at the end of this article.
- Problem with a Script Lab code sample? Open a new issue in the [office-js-snippets](https://github.com/OfficeDev/office-js-snippets/issues) [GitHub repository](https://github.com/OfficeDev/office-js-snippets/issues) .
- Feedback or issue with the Script Lab tool? Open a new issue in the [office-js](https://aka.ms/script-lab-issues) [GitHub repository](https://aka.ms/script-lab-issues) .

### **See also**


- [Script Lab samples GitHub repository](https://github.com/OfficeDev/office-js-snippets#office-js-snippets)
- Developing Office Add-ins

# **Create a standalone Office Add-in from your Script Lab code**

Article • 11/13/2023

If you created a snippet in Script Lab, you may want to turn it into a standalone add-in. You can copy the code from Script Lab into a project generated by the Yeoman Generator for Office Add-ins (also called "Yo Office"). Then you can continue developing the code as an add-in that you can eventually deploy to others.

The steps in this article refer to [Visual Studio Code](https://code.visualstudio.com/) , but you can use any code editor that you prefer.

### **Create a new Yo Office project**

You need to create the standalone add-in project which will be the new development location for your snippet code.

Run the command yo office --projectType taskpane --ts true --host <host> --name "my-add-in" , where <host> is one of the following values.

- excel
- outlook
- powerpoint
- word

#### ) **Important**

The --name argument value must be in double quotation marks, even if it has no spaces.

The previous command creates a new project folder named **my-add-in**. It's configured to run in the host you specified, and uses TypeScript. Script Lab uses TypeScript by default, but most of the snippets are JavaScript. You can build a Yo Office JavaScript project if you prefer, but just be sure any code you copy over is JavaScript.

## **Open the snippet in Script Lab**

Use an existing snippet in Script Lab to learn how to copy a snippet to a Yo Office generated project.


- 1. Open Office (Word, Excel, PowerPoint, or Outlook) and then open Script Lab.
- 2. Select **Script Lab** > **Code**. If you're working in Outlook, open an email message to see Script Lab on the ribbon.
- 3. Open your snippet in Script Lab. If you want to start with an existing sample, go to the Script Lab task pane and choose **Samples**.

### **Copy snippet code to Visual Studio code**

Now you can copy the code from the snippet to the Yo Office project in VS Code.

- In VS Code, open the **my-add-in** project.
In the next steps, you'll copy code from several tabs in Script Lab.

### **Copy task pane code**

- 1. In VS Code, open the **/src/taskpane/taskpane.ts** file. If you're using a JavaScript project, the filename is **taskpane.js**.
- 2. In Script Lab, select the **Script** tab.
- 3. Copy all of the code in the **Script** tab to the clipboard. Replace the entire contents of **taskpane.ts** (or **taskpane.js** for JavaScript) with the code you copied.

#### **Copy task pane HTML**

- 1. In VS Code, open the **/src/taskpane/taskpane.html** file.
- 2. In Script Lab, select the **HTML** tab.
- 3. Copy all of the HTML in the **HTML** tab to the clipboard. Replace all of the HTML inside the <body> tag with the HTML you copied.

#### **Copy task pane CSS**

- 1. In VS Code, open the **/src/taskpane/taskpane.css** file.
- 2. In Script Lab, select the **CSS** tab.
- 3. Copy all of the CSS in the **CSS** tab to the clipboard. Replace the entire contents of **taskpane.css** with the CSS you copied.
- 4. Save all changes to the files you updated in previous steps.


# **Add jQuery support**

Script Lab uses jQuery in the snippets. You need to add this dependency to the Yo Office project to run the code successfully.

- 1. Open the **taskpane.html** file, and add the following script tag to the <head> section.

```
HTML
<script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-3.3.1.js">
</script>
```
7 **Note**

The specific version of jQuery may vary. You can determine which version Script Lab is using by choosing the **Libraries** tab.

- 2. Open a terminal in VS Code and enter the following commands.

```
command line
npm install --save-dev jquery@3.1.1
npm install --save-dev @types/jquery@3.3.1
```
If you created a snippet that has additional library dependencies, be sure to add them to the Yo Office project. Find a list of all library dependencies on the **Libraries** tab in Script Lab.

### **Handle initialization**

Script Lab handles the Office.onReady initialization automatically. You'll need to modify the code to provide your own Office.onReady handler.

- 1. Open the **taskpane.ts** (or **taskpane.js** for JavaScript) file.
- 2. For Excel, PowerPoint, or Word, replace:

TypeScript

```
$("#run").on("click", () => tryCatch(run));
```


with:

```
TypeScript
```

```
Office.onReady(function () {
 // Office is ready.
 $(document).ready(function () {
 // The document is ready.
 $("#run").on("click", () => tryCatch(run));
 });
});
```
- 3. For Outlook, replace:

```
TypeScript
$("#get").on("click", get);
$("#set").on("click", set);
$("#save").on("click", save);
```
with:

```
TypeScript
Office.onReady(function () {
 // Office is ready
 $(document).ready(function () {
 // The document is ready
 $("#get").on("click", get);
 $("#set").on("click", set);
```
$("#save").on("click", save);

4. Save the file.

 }); });

### **Custom functions**

If your snippet uses custom functions, you need to use the Yo Office custom functions template. To turn custom functions into a standalone add-in, follow these steps.

- 1. Run the command yo office --projectType excel-functions --ts true --name "my-functions" .


The --name argument value must be in double quotation marks, even if it has no spaces.

- 2. Open Excel, and then open Script Lab.
- 3. Select **Script Lab** > **Code**.
- 4. Open your snippet in Script Lab. If you want to start with an existing sample, go to the Script Lab task pane, choose **Samples**, and search under the **Custom Functions** section.
- 5. Open the **/src/functions/functions.ts** file. If you're using a JavaScript project, the filename is **functions.js**.
- 6. In Script Lab, select the **Script** tab.
- 7. Copy all of the code in the **Script** tab to the clipboard. Paste the code at the top of the **functions.ts** (or **functions.js** for JavaScript) with the code you copied.
- 8. Save the file.

### **Test the standalone add-in**

Once all the steps are complete, run and test out your standalone add-in. Run the following command to get started.

```
command line
npm start
```
Office will start and you can open the task pane for your add-in from the ribbon. Congratulations! Now you can continue building your add-in as a standalone project.

When you're ready to stop the dev server and uninstall the add-in, run the following command.

command line

npm stop

# **Console logging**


Many snippets in Script Lab write output to a console section at the bottom of the task pane. The Yo Office project doesn't have a console section. All console.log* statements will write to the default debug console (such as your browser developer tools). If you want the output to go to your task pane, you'll need to update the code.

# **Use the Office dialog API in Office Add-ins**

06/25/2025

Use the [Office dialog API](https://learn.microsoft.com/en-us/javascript/api/office/office.ui) to open dialog boxes in your Office Add-in. This article provides guidance for using the dialog API in your Office Add-in. Consider opening a dialog box from a task pane, content add-in, or add-in command to do the following:

- Sign in a user with a resource such as Google, Facebook, or Microsoft identity. For more information, see Authenticate with the Office dialog API.
- Provide more screen space, or even a full screen, for some tasks in your add-in.
- Host a video that would be too small if confined to a task pane.
- Show an error, progress, or input screen.

### **Tip**

- We recommend that you don't use a dialog box to interact with a document. Use a task pane instead. For guidance, see **Task panes in Office Add-ins**.
- Because overlapping UI elements are discouraged, avoid opening a dialog box from a task pane unless your scenario requires it. When you consider how to use the surface area of a task pane, note that task panes can be tabbed. For an example of a tabbed task pane, see the **[Excel Add-in JavaScript SalesTracker](https://github.com/OfficeDev/Excel-Add-in-JavaScript-SalesTracker)** sample.

To learn more about best practices for implementing a dialog, see **Best practices and rules for the Office dialog API**.

The following image shows an example of a dialog box.


| ::   | Word<br>Document Saved v |                                                                                                                                     |              |                            |                   |            |        | Search (Alt + Q) |      |      |   |            |            |    |     |                                                                                             |  |                          |                         | భ్రీర్థి |
|------|--------------------------|-------------------------------------------------------------------------------------------------------------------------------------|--------------|----------------------------|-------------------|------------|--------|------------------|------|------|---|------------|------------|----|-----|---------------------------------------------------------------------------------------------|--|--------------------------|-------------------------|----------|
| File |                          | Home                                                                                                                                | Insert       | Layout                     |                   | References | Review |                  | View | Help |   | Script Lab | Script Lab |    |     | Comments                                                                                    |  | * Catch up               | / Editing V             | Share V  |
| r) > |                          |                                                                                                                                     |              | Calibri (Body)             | ▽ 11              | >          | B<br>I | U                |      |      |   | As         | Ov         | তি | 0 v | E                                                                                           |  |                          |                         | V        |
|      |                          |                                                                                                                                     |              |                            |                   |            |        |                  |      |      |   |            |            |    |     |                                                                                             |  | Office Add-in NodeJS SSO |                         | ×        |
|      |                          | Sign in to your account<br>login.microsoftonline.com/common/oauth2/v2.0/authorize<br>Microsoft<br>Sign in<br>Email, phone, or Skype |              |                            |                   |            | -      |                  |      | 0    | × |            |            |    |     | Welcome<br>This add-in demonstrates how to<br>connect to Microsoft Graph from an<br>add-in. |  |                          |                         |          |
|      |                          |                                                                                                                                     |              |                            |                   |            |        |                  |      |      |   |            |            |    |     |                                                                                             |  |                          |                         |          |
|      |                          |                                                                                                                                     |              | No account? Create one!    |                   |            |        |                  |      |      |   |            |            |    |     |                                                                                             |  |                          |                         |          |
|      |                          |                                                                                                                                     |              | Can't access your account? |                   |            |        |                  |      |      |   |            |            |    |     |                                                                                             |  |                          |                         |          |
|      |                          |                                                                                                                                     |              |                            |                   |            | Back   |                  |      | Next |   |            |            |    |     |                                                                                             |  |                          |                         |          |
|      |                          |                                                                                                                                     |              |                            |                   |            |        |                  |      |      |   |            |            |    |     |                                                                                             |  |                          |                         |          |
|      |                          |                                                                                                                                     |              | C                          | Sign-in options   |            |        |                  |      |      |   |            |            |    |     |                                                                                             |  |                          |                         |          |
|      |                          |                                                                                                                                     |              |                            |                   |            |        |                  |      |      |   |            |            |    |     |                                                                                             |  |                          |                         |          |
|      |                          |                                                                                                                                     |              |                            | Privacy & cookies |            |        |                  |      |      |   |            |            |    |     |                                                                                             |  |                          |                         |          |
|      |                          |                                                                                                                                     | Terms of use |                            |                   |            |        |                  |      |      |   |            |            |    |     |                                                                                             |  |                          | Get OneDrive File Names |          |

The dialog box always opens in the center of the screen. The user can move and resize it. The window is *nonmodal*--a user can continue to interact with both the document in the Office application and with the page in the task pane, if there is one.

#### 7 **Note**

If you're developing an add-in that runs in Office on the web or new Outlook on Windows and it requires access to a user's device capabilities, see the **[device permission API](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/device-permission-service-requirement-sets)** to learn how to prompt the user for permissions. Device capabilities include a user's camera, geolocation, and microphone.

## **Open a dialog box from a host page**

The Office JavaScript APIs include a [Dialog](https://learn.microsoft.com/en-us/javascript/api/office/office.dialog) object and two functions in the [Office.context.ui](https://learn.microsoft.com/en-us/javascript/api/office/office.ui) [namespace](https://learn.microsoft.com/en-us/javascript/api/office/office.ui).

To open a dialog box, your code, typically a page in a task pane, calls the [displayDialogAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.ui#office-office-ui-displaydialogasync-member(1)) method and passes to it the URL of the resource that you want to open. The page on which this method is called is known as the "host page". For example, if you call this method in script on index.html in a task pane, then index.html is the host page of the dialog box that the method opens.


The resource that is opened in the dialog box is usually a page, but it can be a controller method in an MVC application, a route, a web service method, or any other resource. In this article, "page" or "website" refers to the resource in the dialog box. The following code is a simple example.

#### JavaScript

Office.context.ui.displayDialogAsync("https://www.contoso.com/myDialog.html");

- The URL uses the HTTP**S** protocol. This is mandatory for all pages loaded in a dialog box, not just the first page loaded.
- The dialog box's domain is the same as the domain of the host page, which can be the page in a task pane or the [function file](https://learn.microsoft.com/en-us/javascript/api/manifest/functionfile) of an add-in command. It is required that the page, controller method, or other resource that is passed to the displayDialogAsync method must be in the same domain as the host page.

### ) **Important**

The host page and the resource that opens in the dialog box must have the same full domain. If you attempt to pass displayDialogAsync a subdomain of the add-in's domain, it won't work. The full domain, including any subdomain, must match.

After the first page (or other resource) is loaded, a user can use links or other UI to navigate to any website (or other resource) that uses HTTPS. You can also design the first page to immediately redirect to another site.

By default, the dialog box will occupy 80% of the height and width of the device screen, but you can set different percentages by passing a configuration object to the method, as shown in the following example.

```
JavaScript
Office.context.ui.displayDialogAsync("https://www.contoso.com/myDialog.html", { 
height: 30, width: 20 });
```
For a sample add-in that does this, see [Excel Tutorial - Completed](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/tutorials/excel-tutorial) . For more samples that use displayDialogAsync , see Code samples.

Set both values to 100% to get what is effectively a full screen experience. The effective maximum is 99.5%, and the window is still moveable and resizable.


You can open only one dialog box from a host window. An attempt to open another dialog box generates an error. For example, if a user opens a dialog box from a task pane, they can't open a second dialog box from a different page in the task pane. However, when a dialog box is opened from an add-in command, the command opens a new (but unseen) HTML file each time it is selected. This creates a new (unseen) host window, so each such window can launch its own dialog box. For more information, see Errors from displayDialogAsync.

#### 7 **Note**

In Outlook on the web and new Outlook on Windows, don't set the **[window.name](https://developer.mozilla.org/docs/Web/API/Window/name)** property when configuring a dialog in your add-in. The window.name property is used by these Outlook clients to maintain functionality across page redirects.

### **Take advantage of a performance option in Office on the web**

The displayInIframe property is an additional property in the configuration object that you can pass to displayDialogAsync . When this property is set to true , and the add-in is running in a document opened in Office on the web, the dialog box will open as a floating iframe rather than an independent window, which makes it open faster. The following is an example.

JavaScript Office.context.ui.displayDialogAsync("https://www.contoso.com/myDialog.html", { height: 30, width: 20, displayInIframe: true });

The default value is false , which is the same as omitting the property entirely. If the add-in isn't running in Office on the web, the displayInIframe is ignored.

### 7 **Note**

You should **not** use displayInIframe: true if the dialog box will at any point redirect to a page that can't be opened in an iframe. For example, the sign in pages of many popular web services, such as Google and Microsoft account, can't be opened in an iframe.

## **Send information from the dialog box to the host page**

Code in the dialog box uses the [messageParent](https://learn.microsoft.com/en-us/javascript/api/office/office.ui#office-office-ui-messageparent-member(1)) function to send a string message to the host page. The string can be a word, sentence, XML blob, stringified JSON, or anything else that can 


be serialized to a string or cast to a string. To use the messageParent method, the dialog box must first initialize the Office JavaScript API.

#### 7 **Note**

For clarity, in this section we call the message target the host *page*, but strictly speaking the messages are going to the **Runtime** in the task pane (or the runtime that is hosting a **[function file](https://learn.microsoft.com/en-us/javascript/api/manifest/functionfile)**). The distinction is only significant in the case of cross-domain messaging. For more information, see **Cross-domain messaging to the host runtime**.

The following example shows how to initialize Office JS and send a message to the host page.

```
JavaScript
Office.onReady(() => {
 // Add any initialization code for your dialog here.
});
// Called when dialog signs in the user.
function userSignedIn() {
 Office.context.ui.messageParent(true.toString());
}
```
The next example shows how to return a JSON string containing profile information.

```
JavaScript
function userProfileSignedIn(profile) {
 const profileMessage = {
 "name": profile.name,
 "email": profile.email,
 };
 Office.context.ui.messageParent(JSON.stringify(profileMessage));
}
```
The messageParent function is one of *only* two Office JS APIs that can be called in the dialog box. The other JS API that can be called in the dialog box is

Office.context.requirements.isSetSupported . For information about it, see Specify Office applications and API requirements. However, in the dialog box, this API isn't supported in volume-licensed perpetual Outlook 2016 (that is, the MSI version).

The host page must be configured to receive the message. You do this by adding a callback parameter to the original call of displayDialogAsync . The callback assigns a handler to the DialogMessageReceived event. The following is an example.


```
JavaScript
```

```
let dialog; // Declare dialog as global for use in later functions.
Office.context.ui.displayDialogAsync("https://www.contoso.com/myDialog.html", { 
height: 30, width: 20 },
 (asyncResult) => {
 dialog = asyncResult.value;
 dialog.addEventHandler(Office.EventType.DialogMessageReceived,
processMessage);
 }
);
```
Office passes an [AsyncResult](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult) object to the callback. It represents the result of the attempt to open the dialog box. It does not represent the outcome of any events in the dialog box. For more on this distinction, see Handle errors and events.

- The value property of the asyncResult is set to a [Dialog](https://learn.microsoft.com/en-us/javascript/api/office/office.dialog) object, which exists in the host page, not in the dialog box's execution context.
- The processMessage is the function that handles the event. You can give it any name you want.
- The dialog variable is declared at a wider scope than the callback because it is also referenced in processMessage .

The following is a simple example of a handler for the DialogMessageReceived event.

```
JavaScript
function processMessage(arg) {
 const messageFromDialog = JSON.parse(arg.message);
 showUserName(messageFromDialog.name);
}
```
Office passes the arg object to the handler. Its message property is the string sent by the call of messageParent in the dialog box. In this example, it is a stringified representation of a user's profile from a service, such as Microsoft account or Google, so it's deserialized back to an object with JSON.parse . The showUserName implementation isn't shown. It might display a personalized welcome message on the task pane.

When the user interaction with the dialog box is completed, your message handler should close the dialog box, as shown in this example.

```
JavaScript
function processMessage(arg) {
 dialog.close();
```


```
 // Add code to process the message here.
```
The dialog object must be the same one that is returned by the call of displayDialogAsync . You need to declare the dialog object as a global variable. Or you can scope the dialog object to the displayDialogAsync call with an anonymous callback function as shown in the following example. In the example, processMessage doesn't need to close the dialog since the close method is called in the anonymous callback function.

```
JavaScript
```
}

```
Office.context.ui.displayDialogAsync("https://www.contoso.com/myDialog.html", { 
height: 30, width: 20 },
 (asyncResult) => {
 const dialog = asyncResult.value;
 dialog.addEventHandler(Office.EventType.DialogMessageReceived, (arg) => {
 dialog.close();
 processMessage(arg);
 });
 }
 );
```
If the add-in needs to open a different page of the task pane after receiving the message, you can use the window.location.replace method (or window.location.href ) as the last line of the handler. The following is an example.

```
JavaScript
function processMessage(arg) {
 // Add code to process the message here.
 window.location.replace("/newPage.html");
 // Alternatively, use the following:
 // window.location.href = "/newPage.html";
}
```
For an example of an add-in that does this, see the [Insert Excel charts using Microsoft Graph in](https://github.com/OfficeDev/PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart) [a PowerPoint add-in](https://github.com/OfficeDev/PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart) sample.

### **Conditional messaging**

Because you can send multiple messageParent calls from the dialog box, but you have only one handler in the host page for the DialogMessageReceived event, the handler must use conditional logic to distinguish different messages. For example, if the dialog box prompts a user to sign in to an identity provider such as Microsoft account or Google, it sends the user's


profile as a message. If authentication fails, the dialog box sends error information to the host page, as in the following example.

JavaScript

JavaScript

```
if (loginSuccess) {
 const userProfile = getProfile();
 const messageObject = { messageType: "signinSuccess", profile: userProfile };
 const jsonMessage = JSON.stringify(messageObject);
 Office.context.ui.messageParent(jsonMessage);
} else {
 const errorDetails = getError();
 const messageObject = { messageType: "signinFailure", error: errorDetails };
 const jsonMessage = JSON.stringify(messageObject);
 Office.context.ui.messageParent(jsonMessage);
}
```
About the previous example, note:

- The loginSuccess variable would be initialized by reading the HTTP response from the identity provider.
- The implementation of the getProfile and getError functions isn't shown. They each get data from a query parameter or from the body of the HTTP response.
- Anonymous objects of different types are sent depending on whether the sign in was successful. Both have a messageType property, but one has a profile property and the other has an error property.

The handler code in the host page uses the value of the messageType property to branch as shown in the following example. Note that the showUserName function is the same as in the previous example and showNotification function displays the error in the host page's UI.

```
function processMessage(arg) {
 const messageFromDialog = JSON.parse(arg.message);
 if (messageFromDialog.messageType === "signinSuccess") {
 dialog.close();
 showUserName(messageFromDialog.profile.name);
 window.location.replace("/newPage.html");
 } else {
 dialog.close();
 showNotification("Unable to authenticate user: " +
messageFromDialog.error);
 }
}
```


The showNotification implementation isn't shown. It might display status in a notification bar on the task pane.

### **Cross-domain messaging to the host runtime**

After the dialog opens, either the dialog or the parent runtime may navigate away from the add-in's domain. If either of these things happens, then a call of messageParent will fail unless your code specifies the domain of the parent runtime. You do this by adding a [DialogMessageOptions](https://learn.microsoft.com/en-us/javascript/api/office/office.dialogmessageoptions) parameter to the call of messageParent . This object has a targetOrigin property that specifies the domain to which the message should be sent. If the parameter isn't used, Office assumes that the target is the same domain that the dialog is currently hosting.

7 **Note**

Using messageParent to send a cross-domain message requires the **[Dialog Origin 1.1](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/dialog-origin-requirement-sets) [requirement set](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/dialog-origin-requirement-sets)**. The DialogMessageOptions parameter is ignored on older versions of Office that don't support the requirement set, so the behavior of the method is unaffected if you pass it.

The following is an example of using messageParent to send a cross-domain message.

```
JavaScript
Office.context.ui.messageParent("Some message", { targetOrigin: 
"https://resource.contoso.com" });
```
If the message doesn't include sensitive data, you can set the targetOrigin to "*" which allows it to be sent to any domain. The following is an example.

```
Office.context.ui.messageParent("Some message", { targetOrigin: "*" });
```

```
 Tip
```
JavaScript

- The DialogMessageOptions parameter was added to the messageParent method as a required parameter in mid-2021. Older add-ins that send a cross-domain message with the method no longer work until they are updated to use the new parameter. Until the add-in is updated, *in Office on Windows only*, users and system administrators can enable those add-ins to continue working by specifying the


trusted domains with a registry setting:

**HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\AllowedDialogCom municationDomains**. To do this, create a file with a .reg extension, save it to the Windows computer, and then double-click it to run it. The following is an example of the contents of such a file.

```
properties
```
Windows Registry Editor Version 5.00

```
[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\AllowedDialogCommun
icationDomains]
"My trusted domain"="https://www.contoso.com"
"Another trusted domain"="https://fabrikam.com"
```
- In Office on the web and **[new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** , if the domain of your dialog is different from that of your add-in and it enforces the **[Cross-Origin-Opener-Policy:](https://developer.mozilla.org/docs/Web/HTTP/Headers/Cross-Origin-Opener-Policy) [same-origin](https://developer.mozilla.org/docs/Web/HTTP/Headers/Cross-Origin-Opener-Policy)** response header, your add-in will be blocked from accessing messages from the dialog and your users will be shown **error 12006**. To prevent this, you must set the header to Cross-Origin-Opener-Policy: unsafe-none or configure your add-in and dialog to be in the same domain.
## **Pass information to the dialog box**

Your add-in can send messages from the host page to a dialog box using [Dialog.messageChild.](https://learn.microsoft.com/en-us/javascript/api/office/office.dialog#office-office-dialog-messagechild-member(1))

## **Use messageChild() from the host page**

When you call the Office dialog API to open a dialog box, a [Dialog](https://learn.microsoft.com/en-us/javascript/api/office/office.dialog) object is returned. It should be assigned to a variable that has global scope so that you can reference it from other functions. The following is an example.

```
JavaScript
let dialog; // Declare as global variable.
Office.context.ui.displayDialogAsync("https://www.contoso.com/myDialog.html",
 (asyncResult) => {
 dialog = asyncResult.value;
 dialog.addEventHandler(Office.EventType.DialogMessageReceived,
processMessage);
 }
);
```


```
function processMessage(arg) {
 dialog.close();
 // Add code to process the message here.
}
```
This Dialog object has a [messageChild](https://learn.microsoft.com/en-us/javascript/api/office/office.dialog#office-office-dialog-messagechild-member(1)) method that sends any string, including stringified data, to the dialog box. This raises a DialogParentMessageReceived event in the dialog box. Your code should handle this event, as shown in the next section.

Consider a scenario in which the UI of the dialog is related to the currently active Excel worksheet and that worksheet's position relative to the other worksheets. In the following example, worksheetPropertiesChanged sends the properties of the active worksheet to the dialog box. The data is stringified so that it can be passed to messageChild .

```
JavaScript
await Excel.run(async (context) => {
 const worksheet = context.workbook.worksheets.getActiveWorksheet();
 worksheet.load();
 await context.sync();
 worksheetPropertiesChanged(worksheet);
});
...
function worksheetPropertiesChanged(currentWorksheet) {
 const messageToDialog = JSON.stringify(currentWorksheet);
 dialog.messageChild(messageToDialog);
}
```
## **Handle DialogParentMessageReceived in the dialog box**

In the dialog box's JavaScript, register a handler for the DialogParentMessageReceived event with the [UI.addHandlerAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.ui#office-office-ui-addhandlerasync-member(1)) method. This is typically done in the Office.onReady or Office.initialize function, as shown in the following. (A more robust example is included later in this article.)

```
JavaScript
Office.onReady(() => {

Office.context.ui.addHandlerAsync(Office.EventType.DialogParentMessageReceived,onM
essageFromParent);
});
```


Then, define the onMessageFromParent handler. The following code continues the example from the preceding section. Note that Office passes an argument to the handler and that the message property of the argument object contains the string from the host page. In this example, the message is reconverted to an object and jQuery is used to set the top heading of the dialog to match the new worksheet name.

```
JavaScript
function onMessageFromParent(arg) {
 const messageFromParent = JSON.parse(arg.message);
 document.querySelector('h1').textContent = messageFromParent.name;
}
```
It's best practice to verify that your handler is properly registered. You can do this by passing a callback to the addHandlerAsync method. This runs when the attempt to register the handler completes. Use the handler to log or show an error if the handler wasn't successfully registered. The following is an example. Note that reportError is a function, not defined here, that logs or displays the error.

```
JavaScript
```

```
Office.onReady(() => {
 Office.context.ui.addHandlerAsync(
 Office.EventType.DialogParentMessageReceived,
 onMessageFromParent,
 onRegisterMessageComplete
 );
});
function onRegisterMessageComplete(asyncResult) {
 if (asyncResult.status !== Office.AsyncResultStatus.Succeeded) {
 reportError(asyncResult.error.message);
 }
}
```
### **Conditional messaging from parent page to dialog box**

Because you can make multiple messageChild calls from the host page, but you have only one handler in the dialog box for the DialogParentMessageReceived event, the handler must use conditional logic to distinguish different messages. You can do this in a way that is precisely parallel to how you would structure conditional messaging when the dialog box is sending a message to the host page as described in Conditional messaging.


In some situations, the messageChild API, which is a part of the **[DialogApi 1.2 requirement](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/dialog-api-requirement-sets) [set](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/dialog-api-requirement-sets)**, may not be supported. For example, messageChild isn't supported in volume-licensed perpetual Outlook 2016 and volume-licensed perpetual Outlook 2019. Some alternative ways for parent-to-dialog-box messaging are described in **Alternative ways of passing messages to a dialog box from its host page**.

### ) **Important**

The **[DialogApi 1.2 requirement set](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/dialog-api-requirement-sets)** can't be specified in the add-in manifest. You'll have to check for support for DialogApi 1.2 at runtime using the isSetSupported method as described in **Check for API availability at runtime**. Support for manifest requirements is under development.

### **Cross-domain messaging to the dialog runtime**

After the dialog opens, either the dialog or the parent runtime may navigate away from the add-in's domain. If either of these things happens, then calls to messageChild will fail unless your code specifies the domain of the dialog runtime. You do this by adding a [DialogMessageOptions](https://learn.microsoft.com/en-us/javascript/api/office/office.dialogmessageoptions) parameter to the call of messageChild . This object has a targetOrigin property that specifies the domain to which the message should be sent. If the parameter isn't used, Office assumes that the target is the same domain that the parent runtime is currently hosting.

### 7 **Note**

JavaScript

Using messageChild to send a cross-domain message requires the **[Dialog Origin 1.1](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/dialog-origin-requirement-sets) [requirement set](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/dialog-origin-requirement-sets)**. The DialogMessageOptions parameter is ignored on older versions of Office that don't support the requirement set, so the behavior of the method is unaffected if you pass it.

The following is an example of using messageChild to send a cross-domain message.

dialog.messageChild(messageToDialog, { targetOrigin: "https://resource.contoso.com" });

If the message doesn't include sensitive data, you can set the targetOrigin to "*" which allows it to be *sent* to any domain. The following is an example.


```
JavaScript
```

```
dialog.messageChild(messageToDialog, { targetOrigin: "*" });
```
The add-in's manifest specifies trusted domains. In the unified manifest for Microsoft 365, this is specified in the "validDomains" property. In the add-in only manifest, this is specified in the **<AppDomains>** element.

#### 7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word add-ins.

But the runtime that's hosting the dialog can't access the manifest and thereby determine whether the domain *from which the message comes* is trusted, you must use the DialogParentMessageReceived handler to determine this. The object that's passed to the handler contains the domain that's currently hosted in the parent as its origin property. The following is an example of how to use the property.

```
JavaScript
function onMessageFromParent(arg) {
 if (arg.origin === "https://addin.fabrikam.com") {
 // Process the message.
 } else {
 // Signal the parent page to close the dialog.
 const messageObject = { messageType: "untrustedDomain" };
 Office.context.ui.messageParent(messageObject);
 }
}
```
For example, your code could use the Office.onReady or Office.initialize function to store an array of trusted domains in a global variable. The arg.origin property could then be checked against that list in the handler.

#### **Tip**

The DialogMessageOptions parameter was added to the messageChild method as a required parameter in mid-2021. Older add-ins that send a cross-domain message with the method no longer work until they are updated to use the new parameter. Until the add-in is updated, *in Office on Windows only*, users and system administrators can enable those add-ins to continue working by specifying the trusted domains with a registry setting:


**HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\AllowedDialogCommuni cationDomains**. To do this, create a file with a .reg extension, save it to the Windows computer, and then double-click it to run it. The following is an example of the contents of such a file.

```
properties
```
Windows Registry Editor Version 5.00

```
[HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\AllowedDialogCommunicati
onDomains]
"My trusted domain"="https://www.contoso.com"
"Another trusted domain"="https://fabrikam.com"
```
## **Close the dialog box**

You can implement a button in the dialog box that will close it. To do this, the click event handler for the button should use messageParent to tell the host page that the button has been clicked. The following is an example.

```
JavaScript
function closeButtonClick() {
 const messageObject = { messageType: "dialogClosed" };
 const jsonMessage = JSON.stringify(messageObject);
 Office.context.ui.messageParent(jsonMessage);
}
```
The host page handler for DialogMessageReceived would call dialog.close , as in this example. (See previous examples that show how the dialog object is initialized.)

```
JavaScript
function processMessage(arg) {
 const messageFromDialog = JSON.parse(arg.message);
 if (messageFromDialog.messageType === "dialogClosed") {
 dialog.close();
 }
}
```
Even when you don't have your own close-dialog UI, an end user can close the dialog box by choosing the **X** in the upper-right corner. This action triggers the DialogEventReceived event. If your host pane needs to know when this happens, it should declare a handler for this event. See the section Errors and events in the dialog box for details.


## **Code samples**

All of the following samples use displayDialogAsync . Some have NodeJS-based servers and others have ASP.NET/IIS-based servers, but the logic of using the method is the same regardless of how the server-side of the add-in is implemented.

- [Excel Tutorial Completed](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/tutorials/excel-tutorial)
- [Excel Shared Runtime Scenario](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/excel-shared-runtime-scenario)
- [Office Add-in Microsoft Graph ASPNET](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-Microsoft-Graph-ASPNET)
- [Office Add-in Microsoft Graph React](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-Microsoft-Graph-React)
- [Office Add-in NodeJS SSO](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-NodeJS-SSO)
- [Office Add-in ASPNET SSO](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Office-Add-in-ASPNET-SSO)
- [Office Add-in SAAS Monetization Sample](https://github.com/OfficeDev/office-add-in-saas-monetization-sample)
- [Outlook Add-in Microsoft Graph ASPNET](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Outlook-Add-in-Microsoft-Graph-ASPNET)
- [Outlook Add-in SSO](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/auth/Outlook-Add-in-SSO)
- [Outlook Add-in Token Viewer](https://github.com/OfficeDev/Outlook-Add-In-Token-Viewer)
- [Outlook Add-in Actionable Message](https://github.com/OfficeDev/Outlook-Add-In-Actionable-Message)
- [Outlook Add-in Sharing to OneDrive](https://github.com/OfficeDev/Outlook-Add-in-Sharing-to-OneDrive)
- [PowerPoint Add-in Microsoft Graph ASPNET InsertChart](https://github.com/OfficeDev/PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart)

## **See also**

- [Dialog API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/dialog-api-requirement-sets)
- Best practices and rules for the Office dialog API
- Authenticate with the Office dialog API
- Use the Office dialog box to show a video
- Handling errors and events in the Office dialog box
- Runtimes in Office Add-ins

# **Best practices and rules for the Office Dialog API**

06/17/2025

This article provides rules, limitations, and best practices for the Office Dialog API, including best practices for designing the UI of a dialog and using the API within a single-page application (SPA).

#### 7 **Note**

To familiarize yourself with the basics of using the Office Dialog API, see **Use the Office Dialog API in your Office Add-ins**.

See also **Handling errors and events with the Office dialog box**.

### **Rules and limitations**

- A dialog box can only navigate to HTTPS URLs, not HTTP.
- The URL passed to the [displayDialogAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.ui) method must be in the exact same domain as the add-in itself. It can't be a subdomain. However, the page that is passed to it can redirect to a page in another domain.
- A host page can have only one dialog box open at a time. The host page could be either a task pane or the [function file](https://learn.microsoft.com/en-us/javascript/api/manifest/functionfile) of a function command. Multiple dialogs can be open at the same time from custom ribbon buttons or menu items.
- Only two Office APIs can be called in the dialog box,
	- [Office.context.ui.messageParent](https://learn.microsoft.com/en-us/javascript/api/office/office.ui#office-office-ui-messageparent-member(1))
	- Office.context.requirements.isSetSupported (For more information, see Specify Office applications and API requirements.)
- The [messageParent](https://learn.microsoft.com/en-us/javascript/api/office/office.ui#office-office-ui-messageparent-member(1)) function should usually be called from a page in the exact same domain as the add-in itself, but this isn't mandatory. For more information, see Crossdomain messaging to the host runtime.
- When a dialog box opens, it's centered on the screen on top of the Office application.
- A dialog box can be moved and resized by the user.
- A dialog box appears in the order in which it was created.


**Tip**

In Office on the web and **[new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** , if the domain of your dialog is different from that of your add-in and it enforces the **[Cross-Origin-Opener-Policy:](https://developer.mozilla.org/docs/Web/HTTP/Headers/Cross-Origin-Opener-Policy) [same-origin](https://developer.mozilla.org/docs/Web/HTTP/Headers/Cross-Origin-Opener-Policy)** response header, your add-in will be blocked from accessing messages from the dialog and your users will be shown **error 12006**. To prevent this, you must set the header to Cross-Origin-Opener-Policy: unsafe-none or configure your add-in and dialog to be in the same domain.

- In Outlook on the web and new Outlook on Windows, don't set the [window.name](https://developer.mozilla.org/docs/Web/API/Window/name) property when configuring a dialog in your add-in. The window.name property is used by these Outlook clients to maintain functionality across page redirects.
## **Best practices**

#### **Avoid overusing dialog boxes**

Because overlapping UI elements are discouraged, avoid opening a dialog box from a task pane unless your scenario requires it. When you consider how to use the surface area of a task pane, note that task panes can be tabbed. For an example of a tabbed task pane, see the [Excel](https://github.com/OfficeDev/Excel-Add-in-JavaScript-SalesTracker) [Add-in JavaScript SalesTracker](https://github.com/OfficeDev/Excel-Add-in-JavaScript-SalesTracker) sample.

#### **Design a dialog box UI**

For best practices in dialog box design, see Dialog boxes in Office Add-ins.

#### **Handle pop-up blockers with Office on the web**

Attempting to display a dialog box while using Office on the web may cause the browser's pop-up blocker to block the dialog box. To prevent this, Office on the web prompts the user to **Allow** or **Ignore** opening the dialog.


If the user chooses **Allow**, the Office dialog box opens. If the user chooses **Ignore**, the prompt closes and the Office dialog box does not open. Instead, the displayDialogAsync method returns error 12009. Your code should catch this error and either provide an alternate experience that doesn't require a dialog, or display a message to the user advising that the add-in requires them to allow the dialog. (For more about 12009, see Errors from displayDialogAsync.)

If, for any reason, you want to turn off this feature, then your code must opt out. It makes this request with the [DialogOptions](https://learn.microsoft.com/en-us/javascript/api/office/office.dialogoptions) object that is passed to the displayDialogAsync method. Specifically, the object should include promptBeforeOpen: false . When this option is set to false, Office on the web won't prompt the user to allow the add-in to open a dialog, and the Office dialog won't open.

#### **Request access to device capabilities in Office on the web and new Outlook on Windows**

If your add-in requires access to a user's device capabilities, a dialog to request for permissions is available through the [device permission API.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/device-permission-service-requirement-sets) Device capabilities include a user's camera, geolocation, and microphone. This applies to the following Office applications.

- Office on the web (Excel, Outlook, PowerPoint, and Word) running in Chromium-based browsers, such as Microsoft Edge or Google Chrome
- [new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)

When your add-in calls [Office.context.devicePermission.requestPermissions](https://learn.microsoft.com/en-us/javascript/api/office/office.devicepermission#office-office-devicepermission-requestpermissions-member(1)) or [Office.context.devicePermission.requestPermissionsAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.devicepermission#office-office-devicepermission-requestpermissionsasync-member(1)), a dialog is shown with the requested device capabilities and the options to **Allow**, **Allow once**, or **Deny** access. To learn more, see [View, manage, and install add-ins for Excel, PowerPoint, and Word](https://support.microsoft.com/office/16278816-1948-4028-91e5-76dca5380f8d) .


- Add-ins that run in Office desktop clients or in browsers not based on Chromium automatically show a dialog requesting for a user's permission. The developer doesn't need to implement the device permission API on these platforms.
- Add-ins that run in Safari are blocked from accessing a user's device capabilities. The device permission API isn't supported in Safari.
- Access to a user's geolocation is only supported in **Outlook on the web** and new **Outlook on Windows**.

#### **Don't use the _host_info value**

Office automatically adds a query parameter called _host_info to the URL that is passed to displayDialogAsync . It is appended after your custom query parameters, if any. It isn't appended to any subsequent URLs that the dialog box navigates to. Microsoft may change the content of this value, or remove it entirely, so your code shouldn't read it. The same value is added to the dialog box's session storage (that is, the [Window.sessionStorage](https://developer.mozilla.org/docs/Web/API/Window/sessionStorage) property). Again, *your code should neither read nor write to this value*.

#### **Open another dialog immediately after closing one**

You can't have more than one dialog open from a given host page, so your code should call [Dialog.close](https://learn.microsoft.com/en-us/javascript/api/office/office.dialog#office-office-dialog-close-member(1)) on an open dialog before it calls displayDialogAsync to open another dialog. The close method is asynchronous. For this reason, if you call displayDialogAsync immediately after a call of close , the first dialog may not have completely closed when Office attempts to open the second. If that happens, Office will return a 12007 error: "The operation failed because this add-in already has an active dialog."

The close method doesn't accept a callback parameter, and it doesn't return a Promise object so it cannot be awaited with either the await keyword or with a then method. For this reason, we suggest the following technique when you need to open a new dialog immediately after closing a dialog: encapsulate the code to open the new dialog in a function and design the function to recursively call itself if the call of displayDialogAsync returns 12007 . The following is an example.

JavaScript

```
function openFirstDialog() {
 Office.context.ui.displayDialogAsync(
 "https://MyDomain/firstDialog.html",
 { width: 50, height: 50 },
 (result) => {
 if (result.status === Office.AsyncResultStatus.Succeeded) {
```


```
 const dialog = result.value;
 dialog.close();
 openSecondDialog();
 }
 else {
 // Handle errors.
 }
 }
 );
}
function openSecondDialog() {
 Office.context.ui.displayDialogAsync(
 "https://MyDomain/secondDialog.html",
 { width: 50, height: 50 },
 (result) => {
 if (result.status === Office.AsyncResultStatus.Failed) {
 if (result.error.code === 12007) {
 openSecondDialog(); // Recursive call.
 }
 else {
 // Handle other errors.
 }
 }
 }
 );
}
```
Alternatively, you could force the code to pause before it tries to open the second dialog by using the [setTimeout](https://www.w3schools.com/jsref/met_win_settimeout.asp) method. The following is an example.

```
JavaScript
function openFirstDialog() {
 Office.context.ui.displayDialogAsync(
 "https://MyDomain/firstDialog.html",
 { width: 50, height: 50 },
 (result) => {
 if (result.status === Office.AsyncResultStatus.Succeeded) {
 const dialog = result.value;
 dialog.close();
 setTimeout(() => { 
 Office.context.ui.displayDialogAsync(
 "https://MyDomain/secondDialog.html",
 { width: 50, height: 50 },
 (result) => {
 // Callback body.
 }
 );
 }, 1000);
 }
 else {
 // Handle errors.
```


#### **Best practices for using the Office Dialog API in an SPA**

If your add-in uses client-side routing, as single-page applications (SPAs) typically do, you have the option to pass the URL of a route to the [displayDialogAsync](https://learn.microsoft.com/en-us/javascript/api/office/office.ui) method instead of the URL of a separate HTML page. *We recommend against doing so for the reasons given below.*

#### 7 **Note**

This article isn't relevant to *server-side* routing, such as in an Express-based web application.

#### **Problems with SPAs and the Office Dialog API**

The Office dialog box is in a new window with its own instance of the JavaScript engine, and hence it's own complete execution context. If you pass a route, your base page and all its initialization and bootstrapping code run again in this new context, and any variables are set to their initial values in the dialog box. So this technique downloads and launches a second instance of your application in the box window, which partially defeats the purpose of an SPA. In addition, code that changes variables in the dialog box window doesn't change the task pane version of the same variables. Similarly, the dialog box window has its own session storage (the [Window.sessionStorage](https://developer.mozilla.org/docs/Web/API/Window/sessionStorage) property), which isn't accessible from code in the task pane. The dialog box and the host page on which displayDialogAsync was called look like two different clients to your server. (For a reminder of what a host page is, see Open a dialog box from a host page.)

So, if you passed a route to the displayDialogAsync method, you wouldn't really have an SPA; you'd have *two instances of the same SPA*. Moreover, much of the code in the task pane instance would never be used in that instance and much of the code in the dialog box instance would never be used in that instance. It would be like having two SPAs in the same bundle.

#### **Microsoft recommendations**

Instead of passing a client-side route to the displayDialogAsync method, we recommend that you do one of the following:


- If the code that you want to run in the dialog box is sufficiently complex, create two different SPAs explicitly; that is, have two SPAs in different folders of the same domain. One SPA runs in the dialog box and the other in the dialog box's host page where displayDialogAsync was called.
- In most scenarios, only simple logic is needed in the dialog box. In such cases, your project will be greatly simplified by hosting a single HTML page, with embedded or referenced JavaScript, in the domain of your SPA. Pass the URL of the page to the displayDialogAsync method. While this means that you are deviating from the literal idea of a single-page app; you don't really have a single instance of an SPA when you are using the Office Dialog API.

### **See also**

- Use the Office Dialog API in Office Add-ins
- Handle errors and events in the Office dialog box


# **Alternative ways of passing messages to a dialog box from its host page**

Article • 12/01/2023

The recommended way to pass data and messages from a parent page to a child dialog is with the messageChild method as described in Use the Office dialog API in your Office Add-ins. If your add-in is running on a platform or host that doesn't support the [DialogApi 1.2 requirement set,](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/dialog-api-requirement-sets) there are two other ways that you can pass information to the dialog.

- Store the information somewhere accessible to both the host window and dialog. The two windows don't share a common session storage (the [Window.sessionStorage](https://developer.mozilla.org/docs/Web/API/Window/sessionStorage) property), but *if they have the same domain* (including port number, if any), they share a common [local storage](https://www.w3schools.com/html/html5_webstorage.asp) .
#### 7 **Note**

Changes to browser security will affect your strategy for token handling.

- If your add-in runs in **Office on the web** in the Microsoft Edge Legacy (non-Chromium) or Safari browser, the dialog and task pane don't share the same **[local storage](https://www.w3schools.com/html/html5_webstorage.asp)** , so it can't be used to communicate between them.
- Starting in Version 115 of Chromium-based browsers, such as Chrome and Edge, **[storage partitioning](https://developer.chrome.com/docs/privacy-sandbox/storage-partitioning/)** is being tested to prevent specific sidechannel cross-site tracking (see also **[Microsoft Edge browser policies](https://learn.microsoft.com/en-us/deployedge/microsoft-edge-policies#defaultthirdpartystoragepartitioningsetting)**). This means that data stored by storage APIs, such as local storage, are only available to contexts with the same origin and the same top-level site. To work around this, in your browser, go to **chrome://flags** or **edge://flags**, then set the **Experimental third-party storage partitioning (#third-partystorage-partitioning)** flag to **Disabled**. Where possible, we recommend to pass data between the dialog and task pane using the **[messageParent](https://learn.microsoft.com/en-us/javascript/api/office/office.ui#office-office-ui-messageparent-member(1))** and **[messageChild](https://learn.microsoft.com/en-us/javascript/api/office/office.dialog#office-office-dialog-messagechild-member(1))** methods as described in **Use the Office dialog API in your Office Add-ins**.
- Add query parameters to the URL that is passed to displayDialogAsync .


### **Use local storage**

To use local storage, call the setItem method of the window.localStorage object in the host page before the displayDialogAsync call, as in the following example.

```
JavaScript
localStorage.setItem("clientID", "15963ac5-314f-4d9b-b5a1-ccb2f1aea248");
```
Code in the dialog box reads the item when it's needed, as in the following example.

```
JavaScript
const clientID = localStorage.getItem("clientID");
// You can also use property syntax:
// const clientID = localStorage.clientID;
```
### **Use query parameters**

The following example shows how to pass data with a query parameter.

```
JavaScript
Office.context.ui.displayDialogAsync('https://myAddinDomain/myDialog.html?
clientID=15963ac5-314f-4d9b-b5a1-ccb2f1aea248');
```
[For a sample that uses this technique, see Insert Excel charts using Microsoft Graph in a](https://github.com/OfficeDev/PowerPoint-Add-in-Microsoft-Graph-ASPNET-InsertChart) PowerPoint add-in .

Code in your dialog box can parse the URL and read the parameter value.

#### ) **Important**

Office automatically adds a query parameter called _host_info to the URL that is passed to displayDialogAsync . (It is appended after your custom query parameters, if any. It isn't appended to any subsequent URLs that the dialog box navigates to.) Microsoft may change the content of this value, or remove it entirely, in the future, so your code shouldn't read it. The same value is added to the dialog box's session storage (the **[Window.sessionStorage](https://developer.mozilla.org/docs/Web/API/Window/sessionStorage)** property). Again, *your code should neither read nor write to this value*.


# **Handle errors and events in the Office dialog box**

Article • 03/12/2025

This article describes how to trap and handle errors when opening the dialog box and errors that happen inside the dialog box.

#### 7 **Note**

This article presupposes that you're familiar with the basics of using the Office dialog API as described in **Use the Office dialog API in your Office Add-ins**.

See also **Best practices and rules for the Office dialog API**.

Your code should handle two categories of events.

- Errors returned by the call of displayDialogAsync because the dialog box can't be created.
- Errors, and other events, in the dialog box.

### **Errors from displayDialogAsync**

In addition to general platform and system errors, four errors are specific to calling displayDialogAsync .

ノ **Expand table**

| Code<br>number | Meaning                                                                                                                                                                                               |
|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 12004          | The domain of the URL passed to displayDialogAsync isn't trusted. The domain must<br>be the same domain as the host page (including protocol and port number).                                        |
|                | In Outlook on the web and the new Outlook on Windows<br>, this error occurs when an<br>add-in is hosted on a localhost server and its manifest doesn't specify an AppDomain<br>element for localhost. |
| 12005          | The URL passed to displayDialogAsync uses the HTTP protocol. HTTPS is required. (In<br>some versions of Office, the error message text returned with 12005 is the same one<br>returned for 12004.)    |


| Code<br>number | Meaning                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 12007          | A dialog box is already opened from this host window. A host window, such as a task<br>pane, can only have one dialog box open at a time.                                                                                                                                                                                                                                                                                                                                                                                                   |
| 12009          | The user chose to ignore the dialog box. This error can occur in Office on the web,<br>where users may choose not to allow an add-in to present a dialog box. For more<br>information, see Handling pop-up blockers with Office on the web.                                                                                                                                                                                                                                                                                                 |
| 12011          | The add-in is running in Office on the web and the user's browser configuration is<br>blocking popups. This most commonly happens when the browser is Edge Legacy and<br>the domain of the add-in is in different security zone from the domain that the dialog<br>is trying to open. Another scenario which triggers this error is that the browser is<br>Safari and it's configured to block all popups. Consider responding to this error with a<br>prompt to the user to change their browser configuration or use a different browser. |

When displayDialogAsync is called, it passes an [AsyncResult](https://learn.microsoft.com/en-us/javascript/api/office/office.asyncresult) object to its callback function. When the call is successful, the dialog box is opened, and the value property of the AsyncResult object is a [Dialog](https://learn.microsoft.com/en-us/javascript/api/office/office.dialog) object. For an example of this, see Send information from the dialog box to the host page. When the call to displayDialogAsync fails, the dialog box isn't created, the status property of the AsyncResult object is set to Office.AsyncResultStatus.Failed , and the error property of the object is populated. You should always provide a callback that tests the status and responds when it's an error. For an example that reports the error message regardless of its code number, see the following code. (The showNotification function, not defined in this article, either displays or logs the error. For an example of how you can implement this function within your add-in, see [Office Add-in Dialog API Example](https://github.com/OfficeDev/Office-Add-in-Dialog-API-Simple-Example) .)

```
JavaScript
```

```
let dialog;
Office.context.ui.displayDialogAsync('https://myDomain/myDialog.html',
function (asyncResult) {
 if (asyncResult.status === Office.AsyncResultStatus.Failed) {
 showNotification(asyncResult.error.code = ": " +
asyncResult.error.message);
 } else {
 dialog = asyncResult.value;
 dialog.addEventHandler(Office.EventType.DialogMessageReceived,
processMessage);
 }
});
```
## **Errors and events in the dialog box**


Three errors and events in the dialog box will raise a DialogEventReceived event in the host page. For a reminder of what a host page is, see Open a dialog box from a host page.

ノ **Expand table**

| Code<br>number | Meaning                                                                                                                                                                                                                                                                                                                                                                 |
|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 12002          | One of the following:<br>No page exists at the URL that was passed to displayDialogAsync<br>The page that was passed to displayDialogAsync loaded, but the dialog box<br>was then redirected to a page that it can't find or load, or it has been directed<br>to a URL with invalid syntax.                                                                             |
| 12003          | The dialog box was directed to a URL with the HTTP protocol. HTTPS is required.                                                                                                                                                                                                                                                                                         |
| 12006          | One of the following:<br>The dialog box was closed, usually because the user chose the Close button X.<br>The dialog returned a Cross-Origin-Opener-Policy: same-origin<br>response<br>header. To prevent this, you must set the header to Cross-Origin-Opener<br>Policy: unsafe-none or configure your add-in and dialog to be in the same<br>domain as the host page. |

Your code can assign a handler for the DialogEventReceived event in the call to displayDialogAsync . The following is a simple example.

```
JavaScript
let dialog;
Office.context.ui.displayDialogAsync('https://myDomain/myDialog.html',
 function (result) {
 dialog = result.value;
 dialog.addEventHandler(Office.EventType.DialogEventReceived,
processDialogEvent);
 }
);
```
For an example of a handler for the DialogEventReceived event that creates custom error messages for each error code, see the following example.

```
JavaScript
function processDialogEvent(arg) {
 switch (arg.error) {
 case 12002:
```


```
 showNotification("The dialog box has been directed to a page
that it can't find or load, or the URL syntax is invalid.");
 break;
 case 12003:
 showNotification("The dialog box has been directed to a URL with
the HTTP protocol. HTTPS is required."); break;
 case 12006:
 showNotification("Dialog closed.");
 break;
 default:
 showNotification("Unknown error in dialog box.");
 break;
 }
}
```
### **See also**

For a sample add-in that handles errors in this way, see [Office Add-in Dialog API](https://github.com/OfficeDev/Office-Add-in-Dialog-API-Simple-Example) [Example](https://github.com/OfficeDev/Office-Add-in-Dialog-API-Simple-Example) .


# **Use the Office dialog box to show a video**

Article • 04/04/2023

This article explains how to play a video in an Office Add-in dialog box.

#### 7 **Note**

This article presumes you're familiar with the basics of using the Office dialog box as described in **Use the Office dialog API in your Office Add-ins**.

To play a video in a dialog box with the Office dialog API, follow these steps.

- 1. Create a page containing an iframe and no other content. The page must be in the same domain as the host page. For a reminder of what a host page is, see Open a dialog box from a host page. In the src attribute of the iframe, point to the URL of an online video. The protocol of the video's URL must be HTTPS. In this article, we'll call this page "video.dialogbox.html". The following is an example of the markup.

```
HTML
```

```
<iframe class="ms-firstrun-video__player" width="640" height="360"
 src="https://www.youtube.com/embed/XVfOe5mFbAE?rel=0&autoplay=1"
 frameborder="0" allowfullscreen>
</iframe>
```
- 2. Use a call of displayDialogAsync in the host page to open video.dialogbox.html.
- 3. If your add-in needs to know when the user closes the dialog box, register a handler for the DialogEventReceived event and handle the 12006 event. For details, see Errors and events in the Office dialog box.

For a sample of a video playing in a dialog box, see the video placemat design pattern.



# **Task panes in Office Add-ins**

Article • 08/18/2023

Task panes are interface surfaces that typically appear on the right side of the window within Word, PowerPoint, Excel, and Outlook. Task panes give users access to interface controls that run code to modify documents or emails, or display data from a data source. Use task panes when you don't need to embed functionality directly into the document.

*Figure 1. Typical task pane layout*

|   |                   |        |              |      | × |
|---|-------------------|--------|--------------|------|---|
|   | Command           |        |              |      |   |
|   | My Add-in         |        |              |      |   |
|   |                   |        |              |      |   |
| - | My Files          | Recent | Shared Files |      |   |
|   |                   |        |              |      |   |
|   |                   |        |              |      |   |
|   |                   |        |              |      |   |
|   |                   |        |              |      |   |
|   |                   |        |              |      |   |
|   |                   |        |              |      |   |
|   |                   |        |              |      |   |
|   |                   |        |              |      |   |
|   |                   |        |              |      |   |
|   |                   |        |              |      |   |
|   |                   |        |              |      |   |
|   |                   |        |              |      |   |
|   | Logo Contoso, Ltd |        |              | ಭ್ವಾ |   |
|   |                   |        |              |      |   |

# **Best practices**

ノ **Expand table**

| Do                                            | Don't                                           |
|-----------------------------------------------|-------------------------------------------------|
| Include the name of your add-in in the title. | Don't append your company name to<br>the title. |


| Do                                                                                                                                  | Don't                                                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|
| Use short descriptive names in the title.                                                                                           | Don't append strings such as "add-in,"<br>"for Word," or "for Office" to the title of<br>your add-in. |
| Include some navigational or commanding element<br>such as the CommandBar or Pivot at the top of your<br>add-in.                    | None                                                                                                  |
| Include a branding element such as the BrandBar at the<br>bottom of your add-in unless your add-in is to be used<br>within Outlook. | None                                                                                                  |

## **Variants**

The following images show the various task pane sizes with the Office app ribbon at a 1366x768 resolution. For Excel, additional vertical space is required to accommodate the formula bar.

- Excel 320x455 pixels
- PowerPoint 320x531 pixels
- Word 320x531 pixels
- Outlook 348x535 pixels

*Figure 3. Office task pane sizes*


| Excel<br>350x378 | PowerPoint<br>348x391 | Word<br>329x445 | Outlook<br>Web App<br>320x570 |
|------------------|-----------------------|-----------------|-------------------------------|

- Excel 350x378 pixels
- PowerPoint 348x391 pixels
- Word 329x445 pixels
- Outlook (on the web) 320x570 pixels

# **Personality menu**

Personality menus can obstruct navigational and commanding elements located near the top right of the add-in. The following are the current dimensions of the personality menu on Windows and Mac. (The personality menu isn't supported in Outlook.)

For Windows, the personality menu measures 12x32 pixels, as shown.

*Figure 4. Personality menu on Windows*

For Mac, the personality menu measures 26x26 pixels, but floats 8 pixels in from the right and 6 pixels from the top, which increases the space to 34x32 pixels, as shown.

*Figure 5. Personality menu on Mac*


|  |  |  |  |  |  |  |  |  |  | i |
|--|--|--|--|--|--|--|--|--|--|---|
|  |  |  |  |  |  |  |  |  |  |   |
|  |  |  |  |  |  |  |  |  |  |   |
|  |  |  |  |  |  |  |  |  |  |   |
|  |  |  |  |  |  |  |  |  |  |   |
|  |  |  |  |  |  |  |  |  |  |   |
|  |  |  |  |  |  |  |  |  |  |   |

# **Implementation**

For a sample that implements a task pane, see [Excel Add-in JS WoodGrove Expense](https://github.com/OfficeDev/Excel-Add-in-WoodGrove-Expense-Trends) [Trends](https://github.com/OfficeDev/Excel-Add-in-WoodGrove-Expense-Trends) on GitHub.

## **See also**

- Fabric Core in Office Add-ins
- UX design patterns for Office Add-ins

#### 6 **Collaborate with us on GitHub**

The source for this content can be found on GitHub, where you can also create and review issues and pull requests. For more information, see [our](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md) [contributor guide](https://github.com/OfficeDev/office-js-docs-pr/blob/main/Contributing.md).

#### **Office Add-ins feedback**

Office Add-ins is an open source project. Select a link to provide feedback:

- [Open a documentation issue](https://github.com/OfficeDev/office-js-docs-pr/issues/new?template=3-customer-feedback.yml&pageUrl=https%3A%2F%2Flearn.microsoft.com%2Fen-us%2Foffice%2Fdev%2Fadd-ins%2Fdesign%2Ftask-pane-add-ins&pageQueryParams=&contentSourceUrl=https%3A%2F%2Fgithub.com%2FOfficeDev%2Foffice-js-docs-pr%2Fblob%2Fmain%2Fdocs%2Fdesign%2Ftask-pane-add-ins.md&documentVersionIndependentId=992aac02-d330-de2a-3162-3c8a4f11eabe&feedback=%0A%0A%5BEnter+feedback+here%5D%0A&author=%40o365devx&metadata=*+ID%3A+f38413d5-1782-d337-80cd-43453222f897+%0A*+Service%3A+**microsoft-365**%0A*+Sub-service%3A+**add-ins**)
- [Provide product feedback](https://aka.ms/office-addins-dev-questions)


# **Show or hide the task pane of your Office Add-in**

Article • 02/12/2025

#### ) **Important**

The shared runtime is only supported in some Office applications. For more information, see **[Shared runtime requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/shared-runtime-requirement-sets)**.

You can show the task pane of your Office Add-in by calling the Office.addin.showAsTaskpane() method.

```
JavaScript
function onCurrentQuarter() {
   Office.addin.showAsTaskpane()
 .then(function() {
 // Code that enables task pane UI elements for
 // working with the current quarter.
 });
}
```
The previous code assumes a scenario where there is an Excel worksheet named **CurrentQuarterSales**. The add-in will make the task pane visible whenever this worksheet is activated. The method onCurrentQuarter is a handler for the [Office.Worksheet.onActivated](https://learn.microsoft.com/en-us/javascript/api/excel/excel.worksheet?view=excel-js-preview&preserve-view=true#excel-excel-worksheet-onactivated-member) event which has been registered for the worksheet.

You can also hide the task pane by calling the Office.addin.hide() method.

```
JavaScript
function onCurrentQuarterDeactivated() {
    Office.addin.hide();
}
```
The previous code is a handler that is registered for the [Office.Worksheet.onDeactivated](https://learn.microsoft.com/en-us/javascript/api/excel/excel.worksheet?view=excel-js-preview&preserve-view=true#excel-excel-worksheet-ondeactivated-member) event.

## **Additional details on showing the task pane**


When you call Office.addin.showAsTaskpane() , Office will display in a task pane the file that you specified in the manifest. The configuration depends on what type of manifest you're using.

- **Unified manifest for Microsoft 365**: The URL of the file is assigned as the value of a "runtimes.code.page" property of the runtime object which has an action object of type "openPage".
7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word addins.

- **Add-in only manifest**: The URL of the file is assigned as the resource ID ( resid ) value of the task pane. This resid value can be assigned or changed by opening your manifest file and locating **<SourceLocation>** inside the <Action xsi:type="ShowTaskpane"> element.
(See Configure your Office Add-in to use a shared runtime for additional details.)

Since Office.addin.showAsTaskpane() is an asynchronous method, your code will continue running until the method is complete. Wait for this completion with either the await keyword or a then() method, depending on which JavaScript syntax you are using.

# **Configure your add-in to use the shared runtime**

To use the showAsTaskpane() and hide() methods, your add-in must use the shared runtime. For more information, see Configure your Office Add-in to use a shared runtime.

### **Preservation of state and event listeners**

The hide() and showAsTaskpane() methods only change the *visibility* of the task pane. They do not unload or reload it (or reinitialize its state).

Consider the following scenario: A task pane is designed with tabs. The **Home** tab is open when the add-in is first launched. Suppose a user opens the **Settings** tab and,


later, code in the task pane calls hide() in response to some event. Still later code calls showAsTaskpane() in response to another event. The task pane will reappear, and the **Settings** tab is still selected.

In addition, any event listeners that are registered in the task pane continue to run even when the task pane is hidden.

Consider the following scenario: The task pane has a registered handler for the Excel Worksheet.onActivated and Worksheet.onDeactivated events for a sheet named **Sheet1**. The activated handler causes a green dot to appear in the task pane. The deactivated handler turns the dot red (which is its default state). Suppose then that code calls hide() when **Sheet1** is not activated and the dot is red. While the task pane is hidden, **Sheet1** is activated. Later code calls showAsTaskpane() in response to some event. When the task pane opens, the dot is green because the event listeners and handlers ran even though the task pane was hidden.

### **Handle the visibility changed event**

When your code changes the visibility of the task pane with showAsTaskpane() or hide() , Office triggers the VisibilityModeChanged event. It can be useful to handle this event. For example, suppose the task pane displays a list of all the sheets in a workbook. If a new worksheet is added while the task pane is hidden, making the task pane visible


would not, in itself, add the new worksheet name to the list. But your code can respond to the VisibilityModeChanged event to reload the [Worksheet.name](https://learn.microsoft.com/en-us/javascript/api/excel/excel.worksheet#excel-excel-worksheet-name-member) property of all the worksheets in the [Workbook.worksheets](https://learn.microsoft.com/en-us/javascript/api/excel/excel.workbook#excel-excel-workbook-worksheets-member) collection as shown in the example code below.

To register a handler for the event, you do not use an "add handler" method as you would in most Office JavaScript contexts. Instead, there is a special function to which you pass your handler: [Office.addin.onVisibilityModeChanged](https://learn.microsoft.com/en-us/javascript/api/office/office.addin#office-office-addin-onvisibilitymodechanged-member(1)). The following is an example. Note that the args.visibilityMode property is type [VisibilityMode](https://learn.microsoft.com/en-us/javascript/api/office/office.visibilitymode).

```
JavaScript
Office.addin.onVisibilityModeChanged(function(args) {
   if (args.visibilityMode == "Taskpane") {
 // Code that runs whenever the task pane is made visible.
 // For example, an Excel.run() that loads the names of
 // all worksheets and passes them to the task pane UI.
 }
});
```
The function returns another function that *deregisters* the handler. Here is a simple, but not robust, example.

```
JavaScript
const removeVisibilityModeHandler =
   Office.addin.onVisibilityModeChanged(function(args) {
       if (args.visibilityMode == "Taskpane") {
 // Code that runs whenever the task pane is made visible.
 }
 });
// In some later code path, deregister with:
removeVisibilityModeHandler();
```
The onVisibilityModeChanged method is asynchronous and returns a promise, which means that your code needs to await the fulfillment of the promise before it can call the **deregister** handler.

```
JavaScript
// await the promise from onVisibilityModeChanged and assign
// the returned deregister handler to removeVisibilityModeHandler.
const removeVisibilityModeHandler =
    await Office.addin.onVisibilityModeChanged(function(args) {
        if (args.visibilityMode == "Taskpane") {
 // Code that runs whenever the task pane is made visible.
```


 } });

The deregister function is also asynchronous and returns a promise. So, if you have code that should not run until after the deregistration is complete, then you should await the promise returned by the deregister function.

```
JavaScript
// await the promise from the deregister handler before continuing
await removeVisibilityModeHandler();
// subsequent code here
```
### **See also**

- Configure your Office Add-in to use a shared runtime
- Run code in your Office Add-in when the document opens


# **Add custom keyboard shortcuts to your Office Add-ins**

Article • 03/12/2025

Keyboard shortcuts, also known as key combinations, make it possible for your add-in's users to work more efficiently. Keyboard shortcuts also improve the add-in's accessibility for users with disabilities by providing an alternative to the mouse.

There are three steps to add keyboard shortcuts to an add-in.

- 1. Configure the add-in's manifest to use a shared runtime.
- 2. Define custom keyboard shortcuts and the actions they'll run.
- 3. Map custom actions to their functions using the [Office.actions.associate](https://learn.microsoft.com/en-us/javascript/api/office/office.actions#office-office-actions-associate-member) API.

### **Prerequisites**

Keyboard shortcuts are currently only supported in the following platforms and build of **Excel** and **Word**.

- Office on the web
- Office on Windows
	- **Excel**: Version 2102 (Build 13801.20632) and later
	- **Word**: Version 2408 (Build 17928.20114) and later
- Office on Mac
	- **Excel**: Version 16.55 (21111400) and later
	- **Word**: Version 16.88 (24081116) and later

Additionally, keyboard shortcuts only work on platforms that support the following requirement sets. For information about requirement sets and how to work with them, see Specify Office applications and API requirements.

- [SharedRuntime 1.1](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/shared-runtime-requirement-sets)
- [KeyboardShortcuts 1.1](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/keyboard-shortcuts-requirement-sets) (required if the add-in provides its users with the option to customize keyboard shortcuts)

#### **Tip**

To start with a working version of an add-in with keyboard shortcuts already configured, clone and run the **[Use keyboard shortcuts for Office Add-in actions](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/office-keyboard-shortcuts)** 


sample. When you're ready to add keyboard shortcuts to your own add-in, continue with this article.

### **Define custom keyboard shortcuts**

The process to define custom keyboard shortcuts for your add-in varies depending on the type of manifest your add-in uses. Select the tab for the type of manifest you're using.

#### **Tip**

To learn more about manifests for Office Add-ins, see **Office Add-ins manifest**.

Unified app manifest for Microsoft 365

#### 7 **Note**

Implementing keyboard shortcuts with the unified app manifest for Microsoft 365 is in public developer preview. This shouldn't be used in production addins. We invite you to try it out in test or development environments. For more information, see the **[Microsoft 365 app manifest schema reference](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/?view=m365-app-prev&preserve-view=true)**.

If your add-in uses the unified app manifest for Microsoft 365, custom keyboard shortcuts and their actions are defined in the manifest.

- 1. In your add-in project, open the **manifest.json** file.
- 2. Add the following object to the ["extensions.runtimes"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-array?view=m365-app-prev&preserve-view=true) array. Note the following about this markup.
	- The ["actions"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-actions-item?view=m365-app-prev&preserve-view=true) objects specify the functions your add-in can run. In the following example, an add-in will be able to show and hide a task pane. You'll create these functions in a later section. Currently, custom keyboard shortcuts can only run actions that are of type "executeFunction".
	- While the ["actions.displayName"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/extension-runtimes-actions-item?view=m365-app-prev&preserve-view=true#displayname) property is optional, it's required if a custom keyboard shortcut will be created for the action. This property is used to describe the action of a keyboard shortcut. The description you provide appears in the dialog that's shown to a user when there's a shortcut conflict between multiple add-ins or with Microsoft 365. Office


appends the name of the add-in in parentheses at the end of the description. For more information on how conflicts with keyboard shortcuts are handled, see Avoid key combinations in use by other addins.

```
JSON
```

```
"runtimes": [
 {
 "id": "TaskPaneRuntime",
 "type": "general",
 "code": {
 "page": "https://localhost:3000/taskpane.html"
 },
 "lifetime": "long",
 "actions": [
 {
 "id": "ShowTaskpane",
 "type": "executeFunction",
 "displayName": "Show task pane (Contoso Add-in)"
 },
 {
 "id": "HideTaskpane",
 "type": "executeFunction",
 "displayName": "Hide task pane (Contoso Add-in)"
 }
 ],
 }
]
```
- 3. Add the following to the "extensions" array. Note the following about the markup.
	- The SharedRuntime 1.1 requirement set is specified in the ["requirements.capabilities"](https://learn.microsoft.com/en-us/microsoft-365/extensibility/schema/requirements-extension-element-capabilities?view=m365-app-prev&preserve-view=true) object to support custom keyboard shortcuts.
	- Each "shortcuts" object represents a single action that's invoked by a keyboard shortcut. It specifies the supported key combinations for various platforms, such as Office on the web, on Windows, and on Mac. For guidance on how to create custom key combinations, see Guidelines for custom key combinations.
	- A default key combination must be specified. It's used on all supported platforms if there isn't a specific combination configured for a particular platform.
	- The value of the "actionId" property must match the value specified in the "id" property of the applicable "extensions.runtimes.actions" object.


```
"keyboardShortcuts": [
 {
 "requirements": {
 "capabilities": [
 {
 "name": "SharedRuntime",
 "minVersion": "1.1"
 }
 ]
 },
 "shortcuts": [
 {
 "key": {
 "default": "Ctrl+Alt+Up",
 "mac": "Command+Shift+Up",
 "web": "Ctrl+Alt+1",
 "windows": "Ctrl+Alt+Up"
 },
 "actionId": "ShowTaskpane"
 },
 {
 "key": {
 "default": "Ctrl+Alt+Down",
 "mac": "Command+Shift+Down",
 "web": "Ctrl+Alt+2",
 "windows": "Ctrl+Alt+Up"
 },
 "actionId": "HideTaskpane"
 }
 ]
 }
]
```
## **Map custom actions to their functions**

- 1. In your project, open the JavaScript file loaded by your HTML page in the **<FunctionFile>** element.
- 2. In the JavaScript file, use the [Office.actions.associate](https://learn.microsoft.com/en-us/javascript/api/office/office.actions#office-office-actions-associate-member) API to map each action you specified in an earlier step to a JavaScript function. Add the following JavaScript to the file. Note the following about the code.
	- The first parameter is the name of an action that you mapped to a keyboard shortcut. The location of the name of the action depends on the type of manifest your add-in uses.
		- **Unified app manifest for Microsoft 365**: The value of the "extensions.keyboardShortcuts.shortcuts.actionId" property in the


**manifest.json** file.

- **Add-in only manifest**: The value of the "actions.id" property in the shortcuts JSON file.
- The second parameter is the function that runs when a user presses the key combination that's mapped to an action.

```
JavaScript
Office.actions.associate("ShowTaskpane", () => {
 return Office.addin.showAsTaskpane()
 .then(() => {
 return;
 })
 .catch((error) => {
 return error.code;
 });
});
```

```
JavaScript
```

```
Office.actions.associate("HideTaskpane", () => {
 return Office.addin.hide()
 .then(() => {
 return;
 })
 .catch((error) => {
 return error.code;
 });
});
```
### **Guidelines for custom key combinations**

Use the following guidelines to create custom key combinations for your add-ins.

- A keyboard shortcut must include at least one modifier key ( Alt / Option , Ctrl / Cmd , Shift ) and only one other key. These keys must be joined with a + character.
- The Cmd modifier key is supported on the macOS platform.
- On macOS, the Alt key is mapped to the Option key. On Windows, the Cmd key is mapped to the Ctrl key.
- The Shift key can't be used as the only modifier key. It must be combined with either Alt / Option or Ctrl / Cmd .
- Key combinations can include characters "A-Z", "a-z", "0-9", and the punctuation marks "-", "_", and "+". By convention, lowercase letters aren't used in keyboard shortcuts.


- When two characters are linked to the same physical key on a standard keyboard, then they're synonyms in a custom keyboard shortcut. For example, Alt + a and Alt + A are the same shortcut, as well as Ctrl + - and Ctrl + _ ("-" and "_" are linked to the same physical key).
#### 7 **Note**

Custom keyboard shortcuts must be pressed simultaneously. KeyTips, also known as sequential key shortcuts (for example, Alt + H , H ), aren't supported in Office Add-ins.

#### **Browser shortcuts that can't be overridden**

When using custom keyboard shortcuts on the web, some keyboard shortcuts that are used by the browser can't be overridden by add-ins. The following list is a work in progress. If you discover other combinations that can't be overridden, please let us know by using the feedback tool at the bottom of this page.

- Ctrl + N
- Ctrl + Shift + N
- Ctrl + T
- Ctrl + Shift + T
- Ctrl + W
- Ctrl + PgUp / PgDn

#### **Avoid key combinations in use by other add-ins**

There are many keyboard shortcuts that are already in use by Microsoft 365. Avoid registering keyboard shortcuts for your add-in that are already in use. However, there may be some instances where it's necessary to override existing keyboard shortcuts or handle conflicts between multiple add-ins that have registered the same keyboard shortcut.

In the case of a conflict, the user will see a dialog box the first time they attempt to use a conflicting keyboard shortcut. Note that the source of the text for the add-in option that's displayed in this dialog varies depending on the type of manifest your add-in uses. - **Unified app manifest for Microsoft 365**: The value of the "extensions.runtimes.actions.displayName" property in the **manifest.json** file. - **Add-in only manifest**: The value of the "actions.name" property in the shortcuts JSON file.


The user can select which action the keyboard shortcut will take. After making the selection, the preference is saved for future uses of the same shortcut. The shortcut preferences are saved per user, per platform. If the user wishes to change their preferences, they can invoke the **Reset Office Add-ins shortcut preferences** command from the **Tell me** search box. Invoking the command clears all of the user's add-in shortcut preferences and the user will again be prompted with the conflict dialog box the next time they attempt to use a conflicting shortcut.

| rese                               | ×                                             |  |
|------------------------------------|-----------------------------------------------|--|
| View<br>Review                     | Actions                                       |  |
| Conditional Forma                  | Reset Office Add-in Shortcut Preferences<br>물 |  |
| Format as Table ×<br>Cell Styles × | 篇<br>Reset Graphic                            |  |
| Styles                             | ਸ ਸੂ<br>Reset Picture                         |  |
|                                    | Pre<br>Reset Window Position                  |  |
| H                                  | Find in Document                              |  |
|                                    | "rese"                                        |  |
|                                    | Files                                         |  |

For the best user experience, we recommend that you minimize keyboard shortcut conflicts with these good practices.

- Use only keyboard shortcuts with the following pattern: Ctrl + Shift + Alt +*x*, where *x* is some other key.
- Avoid using established keyboard shortcuts in Excel and Word. For a list, see the following:
	- [Keyboard shortcuts in Excel](https://support.microsoft.com/office/1798d9d5-842a-42b8-9c99-9b7213f0040f)
	- [Keyboard shortcuts in Word](https://support.microsoft.com/office/95ef89dd-7142-4b50-afb2-f762f663ceb2)


- When the keyboard focus is inside the add-in UI, Ctrl + Space and Ctrl + Shift + F10 won't work as these are essential accessibility shortcuts.
- On a Windows or Mac computer, if the **Reset Office Add-ins shortcut preferences** command isn't available on the search menu, the user can manually add the command to the ribbon by customizing the ribbon through the context menu.

## **Localize the description of a keyboard shortcut**

You may need to localize your custom keyboard shortcuts in the following scenarios.

- Your add-in supports multiple locales.
- Your add-in supports different alphabets, writing systems, or keyboard layouts.

Guidance on how to localize your keyboard shortcuts varies depending on the type of manifest your add-in uses.

Unified app manifest for Microsoft 365

To learn how to localize your custom keyboard shortcuts with the unified app manifest for Microsoft 365, see [Localize strings in your app manifest](https://learn.microsoft.com/en-us/microsoftteams/platform/concepts/build-and-test/apps-localization).

# **Turn on shortcut customization for specific users**

#### 7 **Note**

The APIs described in this section require the **[KeyboardShortcuts 1.1](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/keyboard-shortcuts-requirement-sets)** requirement set.

Users of your add-in can reassign the actions of the add-in to alternate keyboard combinations.

Use the [Office.actions.replaceShortcuts](https://learn.microsoft.com/en-us/javascript/api/office/office.actions#office-office-actions-replaceshortcuts-member) method to assign a user's custom keyboard combinations to your add-ins actions. The method takes a parameter of type {[actionId:string]: string|null} , where the actionId s are a subset of the action IDs that must be defined in the add-in's extended manifest JSON. The values are the user's preferred key combinations. The value can also be null , which will remove any customization for that actionId and revert to the specified default keyboard combination.


If the user is logged into Microsoft 365, the custom combinations are saved in the user's roaming settings per platform. Customizing shortcuts aren't currently supported for anonymous users.

```
JavaScript
const userCustomShortcuts = {
 ShowTaskpane: "Ctrl+Shift+1",
 HideTaskpane: "Ctrl+Shift+2"
};
Office.actions.replaceShortcuts(userCustomShortcuts)
 .then(() => {
 console.log("Successfully registered shortcut.");
 })
 .catch((error) => {
 if (error.code == "InvalidOperation") {
 console.log("ActionId doesn't exist or shortcut combination is
invalid.");
 }
 });
```
To find out what shortcuts are already in use for the user, call the [Office.actions.getShortcuts](https://learn.microsoft.com/en-us/javascript/api/office/office.actions#office-office-actions-getshortcuts-member) method. This method returns an object of type [actionId:string]:string|null} , where the values represent the current keyboard combination the user must use to invoke the specified action. The values can come from three different sources.

- If there was a conflict with the shortcut and the user has chosen to use a different action (either native or another add-in) for that keyboard combination, the value returned will be null since the shortcut has been overridden and there's no keyboard combination the user can currently use to invoke that add-in action.
- If the shortcut has been customized using the [Office.actions.replaceShortcuts](https://learn.microsoft.com/en-us/javascript/api/office/office.actions#office-office-actions-replaceshortcuts-member) method, the value returned will be the customized keyboard combination.
- If the shortcut hasn't been overridden or customized, the value returned varies depending on the type of manifest the add-in uses.
	- **Unified app manifest for Microsoft 365**: The shortcut specified in the **manifest.json** file of the add-in.
	- **Add-in only manifest**: The shortcut specified in the shortcuts JSON file of the add-in.

The following is an example.


```
Office.actions.getShortcuts()
 .then((userShortcuts) => {
 for (const action in userShortcuts) {
 let shortcut = userShortcuts[action];
 console.log(action + ": " + shortcut);
 }
 });
```
As described in Avoid key combinations in use by other add-ins, it's a good practice to avoid conflicts in shortcuts. To discover if one or more key combinations are already in use, pass them as an array of strings to the [Office.actions.areShortcutsInUse](https://learn.microsoft.com/en-us/javascript/api/office/office.actions#office-office-actions-areshortcutsinuse-member) method. The method returns a report containing key combinations that are already in use in the form of an array of objects of type {shortcut: string, inUse: boolean} . The shortcut property is a key combination, such as "Ctrl+Shift+1". If the combination is already registered to another action, the inUse property is set to true . For example,

[{shortcut: "Ctrl+Shift+1", inUse: true}, {shortcut: "Ctrl+Shift+2", inUse: false}] . The following code snippet is an example.

```
JavaScript
```

```
const shortcuts = ["Ctrl+Shift+1", "Ctrl+Shift+2"];
Office.actions.areShortcutsInUse(shortcuts)
 .then((inUseArray) => {
 const availableShortcuts = inUseArray.filter((shortcut) => {
 return !shortcut.inUse;
 });
 console.log(availableShortcuts);
 const usedShortcuts = inUseArray.filter((shortcut) => {
 return shortcut.inUse;
 });
 console.log(usedShortcuts);
 });
```
# **Implement custom keyboard shortcuts across supported Microsoft 365 apps**

You can implement a custom keyboard shortcut to be used across supported Microsoft 365 apps, such as Excel and Word. If the implementation to perform the same task is different on each app, you must use the Office.actions.associate method to call a different callback function for each app. The following code is an example.


```
const host = Office.context.host;
if (host === Office.HostType.Excel) {
 Office.actions.associate("ChangeFormat", changeFormatExcel);
} else if (host === Office.HostType.Word) {
 Office.actions.associate("ChangeFormat", changeFormatWord);
}
...
```
### **See also**

- [Office Add-in sample: Use keyboard shortcuts for Office Add-in actions](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/office-keyboard-shortcuts)
- [Shared runtime requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/shared-runtime-requirement-sets)
- [Keyboard shortcuts requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/keyboard-shortcuts-requirement-sets)

# **Office Add-in code samples**

Article • 09/27/2024

These code samples are written to help you learn how to use various features when developing Office Add-ins.

### **Getting started**

The following samples show how to build the simplest Office Add-in with only a manifest, HTML web page, and a logo. These components are the fundamental parts of an Office Add-in. For additional getting started information, see our quick starts and [tutorials.](https://learn.microsoft.com/en-us/search/?terms=tutorial&scope=Office%20Add-ins)

- [Excel "Hello world" add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/hello-world/excel-hello-world)
- [Outlook "Hello world" add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/hello-world/outlook-hello-world)
- [PowerPoint "Hello world" add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/hello-world/powerpoint-hello-world)
- [Word "Hello world" add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/hello-world/word-hello-world)

### **Blazor WebAssembly**

If your development background is in building VSTO Add-ins, the following samples show how to build Office Web Add-ins using .NET Blazor WebAssembly. You can keep much of your code in C# and Visual Studio.

- [Create a Blazor WebAssembly Excel add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/blazor-add-in/excel-blazor-add-in)
- [Create a Blazor WebAssembly Outlook add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/blazor-add-in/outlook-blazor-add-in)
- [Create a Blazor WebAssembly Word add-in](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/blazor-add-in/word-blazor-add-in)

### **Excel**

| Name                             | Description                                                                                                                                                                                                                                             |
|----------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Data types explorer<br>(preview) | Builds an Excel add-in that allows you to create and explore data<br>types in your workbooks. Data types enable add-in developers to<br>organize complex data structures as objects, such as formatted<br>number values, web images, and entity values. |
| Open in Teams                    | Create a new Excel spreadsheet in Microsoft Teams containing data<br>you define.                                                                                                                                                                        |


| Name                                                                           | Description                                                                                                                                                                                                                                           |
|--------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Insert an external Excel file                                                  | Insert an existing template from an external Excel file into the                                                                                                                                                                                      |
| and populate it with JSON                                                      | currently open Excel workbook. Then, populate the template with                                                                                                                                                                                       |
| data                                                                           | data from a JSON web service.                                                                                                                                                                                                                         |
| Create custom contextual<br>tabs on the ribbon                                 | Create a custom contextual tab on the ribbon in the Office UI. The<br>sample creates a table, and when the user moves the focus inside<br>the table, the custom tab is displayed. When the user moves outside<br>the table, the custom tab is hidden. |
| Custom function sample                                                         | Use web workers in custom functions to prevent blocking the UI of                                                                                                                                                                                     |
| using web worker                                                               | your Office Add-in.                                                                                                                                                                                                                                   |
| Use storage techniques to<br>access data from an Office<br>Add-in when offline | Implement localStorage to enable limited functionality for your<br>Office Add-in when a user experiences lost connection.                                                                                                                             |
| Custom function batching                                                       | Batch multiple calls into a single call to reduce the number of                                                                                                                                                                                       |
| pattern                                                                        | network calls to a remote service.                                                                                                                                                                                                                    |

### **Outlook**

| Name                                                                                                                                                | Description                                                                                                                                                                                                                                                                           |
|-----------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Report spam or phishing emails in<br>Outlook                                                                                                        | Build an integrated spam-reporting solution that's easily<br>discoverable in the Outlook client ribbon. The solution<br>provides the user with a dialog to report an email. It also<br>saves a copy of the reported email to a file for further<br>processing in your backend system. |
| Encrypt attachments, process<br>meeting request attendees, and<br>react to appointment date/time<br>changes using Outlook event<br>based activation | Use event-based activation to encrypt attachments when<br>added by the user. Also use event handling for recipients<br>changed in a meeting request, and changes to the start or<br>end date or time in a meeting request.                                                            |
| Identify and tag external recipients<br>using Outlook event-based<br>activation                                                                     | Use event-based activation to run an Outlook add-in when<br>the user changes recipients while composing a message.<br>The add-in also uses the appendOnSendAsync API to add a<br>disclaimer.                                                                                          |
| Set your signature using Outlook<br>event-based activation                                                                                          | Use event-based activation to run an Outlook add-in when<br>the user creates a new message or appointment. The add-in<br>can respond to events, even when the task pane isn't open.<br>It also uses the setSignatureAsync API.                                                        |


| Name                                         | Description                                                                                                                                                 |
|----------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Verify the color categories of a             | Use Outlook Smart Alerts to verify that required color                                                                                                      |
| message or appointment before                | categories are applied to a new message or appointment                                                                                                      |
| it's sent using Smart Alerts                 | before it's sent.                                                                                                                                           |
| Verify the sensitivity label of a<br>message | Use the sensitivity label API in an event-based add-in to<br>verify and apply the Highly Confidential sensitivity label to<br>applicable outgoing messages. |

### **Word**

#### ノ **Expand table**

| Name                                                     | Description                                                                                                                                                                                                                                                                                     |
|----------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Get, edit, and set                                       | This sample shows how to get, edit, and set OOXML content in a Word                                                                                                                                                                                                                             |
| OOXML content in a                                       | document. The sample add-in provides a scratch pad to get Office Open                                                                                                                                                                                                                           |
| Word document with a                                     | XML for your own content and test your own edited Office Open XML                                                                                                                                                                                                                               |
| Word add-in                                              | snippets.                                                                                                                                                                                                                                                                                       |
| Import a Word<br>document template<br>with a Word add-in | Shows how to import templates in a Word document.                                                                                                                                                                                                                                               |
| Load and write Open<br>XML in your Word<br>add-in        | This sample add-in shows you how to add a variety of rich content types<br>to a Word document using the setSelectedDataAsync method with<br>ooxml coercion type. The add-in also gives you the ability to show the<br>Office Open XML markup for each sample content type right on the<br>page. |
| Manage citations with<br>your Word add-in                | Shows how to manage citations in a Word document.                                                                                                                                                                                                                                               |

# **Authentication, authorization, and single signon (SSO)**

| Name                   | Description                                                          |
|------------------------|----------------------------------------------------------------------|
| Office Add-in with SSO | Shows how to use MSAL.js nested app authentication (NAA) in an       |
| using nested app       | Office Add-in to access Microsoft Graph APIs for the signed-in user. |
| authentication         | The sample displays the signed-in user's name and email. It also     |


| Name                                                           | Description                                                                                                                                                                                                                                                                                                      |  |  |
|----------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--|--|
|                                                                | inserts the names of files from the user's Microsoft OneDrive<br>account into the document.                                                                                                                                                                                                                      |  |  |
| Outlook add-in with SSO<br>using nested app<br>authentication  | Shows how to use MSAL.js nested app authentication (NAA) in an<br>Outlook Add-in to access Microsoft Graph APIs for the signed-in<br>user. The sample displays the signed-in user's name and email. It<br>also inserts the names of files from the user's Microsoft OneDrive<br>account into a new message body. |  |  |
| Use SSO with event-based<br>activation in an Outlook<br>add-in | Shows how to use SSO to access a user's Microsoft Graph data from<br>an event fired in an Outlook add-in.                                                                                                                                                                                                        |  |  |
| Single Sign-on (SSO)                                           | Use Office's SSO feature to give the add-in access to Microsoft                                                                                                                                                                                                                                                  |  |  |
| Sample Outlook Add-in                                          | Graph data.                                                                                                                                                                                                                                                                                                      |  |  |
| Get OneDrive data using                                        | Build an Office Add-in, as a single-page application (SPA) with no                                                                                                                                                                                                                                               |  |  |
| Microsoft Graph and                                            | backend, that connects to Microsoft Graph, and access workbooks                                                                                                                                                                                                                                                  |  |  |
| msal.js in an Office Add-in                                    | stored in OneDrive for Business to update a spreadsheet.                                                                                                                                                                                                                                                         |  |  |
| Office Add-in auth to<br>Microsoft Graph                       | Learn how to build a Microsoft Office Add-in that connects to<br>Microsoft Graph, and access workbooks stored in OneDrive for<br>Business to update a spreadsheet.                                                                                                                                               |  |  |
| Outlook Add-in auth to                                         | Build an Outlook add-in that connects to Microsoft Graph, and                                                                                                                                                                                                                                                    |  |  |
| Microsoft Graph                                                | access workbooks stored in OneDrive for Business to compose a                                                                                                                                                                                                                                                    |  |  |
|                                                                | new email message.                                                                                                                                                                                                                                                                                               |  |  |
| Single Sign-on (SSO) Office                                    | Use the getAccessToken API in Office.js to give the add-in access to                                                                                                                                                                                                                                             |  |  |
| Add-in with ASP.NET                                            | Microsoft Graph data. This sample is built on ASP.NET.                                                                                                                                                                                                                                                           |  |  |
| Single Sign-on (SSO) Office                                    | Use the getAccessToken API in Office.js to give the add-in access to                                                                                                                                                                                                                                             |  |  |
| Add-in with Node.js                                            | Microsoft Graph data. This sample is built on Node.js.                                                                                                                                                                                                                                                           |  |  |

## **Office**

| Name                                             | Description                                                                                                                                                                                                                                                                 |
|--------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Save custom<br>settings in your<br>Office Add-in | Save custom settings inside an Office Add-in. The add-in stores data as<br>key-value pairs, using the JavaScript API for Office property bag, browser<br>cookies, web storage (localStorage and sessionStorage), or by storing the<br>data in a hidden div in the document. |
| Use keyboard                                     | Create custom keyboard shortcuts to invoke certain actions for your Office                                                                                                                                                                                                  |
| shortcuts for Office                             | Add-in.                                                                                                                                                                                                                                                                     |


[Add-in actions](https://github.com/OfficeDev/Office-Add-in-samples/tree/main/Samples/office-keyboard-shortcuts)

# **Shared runtime**

#### ノ **Expand table**

| Name                                       | Description                                                                                                                                            |
|--------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|
| Share global data with a<br>shared runtime | Set up a basic project that uses the shared runtime to run code<br>for ribbon buttons, task pane, and custom functions in a single<br>browser runtime. |
| Manage ribbon and task pane                | Create contextual ribbon buttons that are enabled based on the                                                                                         |
| UI, and run code on doc open               | state of your add-in.                                                                                                                                  |

### **Additional samples**

#### ノ **Expand table**

| Name                                                                                                     | Description                                                                                                  |
|----------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------|
| Use a shared library to migrate your Visual<br>Studio Tools for Office add-in to an Office web<br>add-in | Provides a strategy for code reuse when<br>migrating from VSTO Add-ins to Office Add-ins.                    |
| Integrate an Azure function with your Excel<br>custom function                                           | Integrate Azure functions with custom functions<br>to move to the cloud or integrate additional<br>services. |
| Dynamic DPI code samples                                                                                 | A collection of samples for handling DPI<br>changes in COM, VSTO, and Office Add-ins.                        |

### **Next steps**

Join the [Microsoft 365 Developer Program](https://aka.ms/m365devprogram) to get resources and information to help you build solutions for the Microsoft 365 platform, including recommendations tailored to your areas of interest.

You might also qualify for a free developer subscription that's renewable for 90 days and comes configured with sample data; for details, see the [FAQ](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-).


# **Office Add-in development lifecycle**

06/13/2025

All Office Add-ins are built upon the Office Add-ins platform. They share a common framework through which add-in capabilities are implemented. This means that regardless of whether you're creating an add-in for Excel, Outlook, or another Office application, you can have features such as dialog boxes, add-in commands, task panes, and single sign-on (SSO).

For any add-in you build, you need to understand the following concepts.

- Office application and platform availability
- Office JavaScript API programming patterns
- How to specify an add-in's settings and capabilities in the manifest file
- Troubleshooting your add-in
- Publishing your add-in

For the best foundation for these common features and application-specific implementations, review the following documentation.

#### **Plan**

Learn the best practices and system requirements for Office Add-ins.

**Develop** Learn the APIs and patterns to develop Office Add-ins.


#### **Test and debug**

Learn how to test and debug Office Add-ins.

#### **Publish**

Learn how to deploy and publish Office Add-ins.

#### **Reference**

View the reference documentation for the Office JavaScript APIs, the add-ins manifest, error code lists, and more.

### **See also**

- [Office Dev Center](https://developer.microsoft.com/office)
- Office Add-ins platform overview
- [Office client application and platform availability for Office Add-ins](https://learn.microsoft.com/en-us/javascript/api/requirement-sets)


# **Best practices for developing Office Addins**

07/30/2025

Great add-ins provide unique, compelling functionality that extend Office apps in visually appealing ways. To build a successful add-in, you'll need to create an engaging first-time user experience, design a polished UI, and optimize performance. Follow the best practices in this article to help your users complete tasks quickly and efficiently.

#### 7 **Note**

If you plan to **publish** your add-in to AppSource and make it available within the Office experience, make sure that you conform to the **Commercial marketplace certification policies**. For example, to pass validation, your add-in must work across all platforms that support the methods that you define (for more information, see **section 1120.3** and the **[Office Add-in application and availability page](https://learn.microsoft.com/en-us/javascript/api/requirement-sets)**).

### **Provide clear value**

Build add-ins that help users complete tasks quickly and efficiently. Focus on scenarios that make sense for Office apps, such as:

- Make core authoring tasks faster and easier with fewer interruptions.
- Enable new scenarios within Office.
- Embed complementary services within Office apps.
- Improve the Office experience to enhance productivity.

Make sure users understand your add-in's value immediately by creating an engaging first-run experience.

When you're ready to promote your add-in, learn how to create an [effective AppSource listing.](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/create-effective-office-store-listings)

- Make your add-in's benefits clear in the title and description. Don't rely only on your brand to communicate what your add-in does.
- Ensure your add-in provides sufficient value to justify users' investment. It shouldn't be just a simple utility or have limited scope.
- If your add-in targets larger organizations and enterprises, several AppSource requirements differ from those of a general commercial marketplace add-in. For more information, see the [submission FAQ.](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/appsource-submission-faq#if-my-app-targets-enterprises--how-does-that-affect-my-submission-)


## **Create an engaging first-run experience**

New users are still deciding whether to use or abandon your add-in after downloading it from the store. Here's how to win them over.

- **Make the next steps clear.** Use videos, placemats, paging panels, or other resources to guide users through your add-in.
- **Lead with value, not registration.** Reinforce your add-in's value proposition when it launches rather than immediately asking users to sign in.
- **Provide helpful guidance.** Include teaching UI to guide users and make the experience feel personal.

| Do                                                                                                              | Don't                          |
|-----------------------------------------------------------------------------------------------------------------|--------------------------------|
| Lead users into your experience                                                                                 | Assume users know how to begin |
| Contoso Part Catalog<br>lli                                                                                     | Contoso Part Catalog           |
| Browse<br>Locate products from our part catalog.<br>Sort by category and filter by market,<br>lumens, or price. | Contoso Part Catalog           |
| Insert<br>Add parts right to your document and<br>format them the way that you want.<br>Work fast               |                                |
| Speed up your workflow. Stop copying and<br>pasting from the catalog and keep your<br>proposals up-to-date.     |                                |
| Connect                                                                                                         |                                |
| Contoso                                                                                                         | Contoso                        |

- **Show users what to expect.** If your content add-in binds to data in the user's document, include sample data or a template to show users the expected data format.


- **Offer free trials.** If your add-in requires a subscription, make some functionality available without one.
- **Simplify sign-up.** Prefill information like email and display name, and skip email verifications when possible.
- **Avoid pop-ups.** If you must use them, guide users on how to enable your pop-up window.

For patterns you can apply when developing your first-run experience, see UX design patterns for Office Add-ins.

## **Use add-in commands**

Provide relevant UI entry points for your add-in by using add-in commands. These commands help users discover and access your add-in's functionality directly from the Office ribbon. For details and design best practices, see add-in commands.

# **Apply UX design principles**

Follow these key principles to create add-ins that feel native to Office:

- **Match the Office experience.** Ensure your add-in's look, feel, and functionality complement the Office experience. See Design the UI of Office Add-ins.


- **Prioritize content over chrome.** Avoid unnecessary UI elements that don't add value to the user experience.
- **Keep users in control.** Make sure users understand important decisions and can easily reverse actions your add-in performs.
- **Use branding thoughtfully.** Inspire trust and help orient users, but don't overwhelm or advertise to them.
- **Minimize scrolling.** Optimize for 1366 x 768 resolution.
- **Use licensed images only.** Avoid legal and branding issues that come from unlicensed images.
- **Write clearly.** Use clear and simple language in your add-in.
- **Design for accessibility.** Make your add-in easy for all users to interact with and accommodate assistive technologies like screen readers. See our accessibility guidelines.
- **Support all platforms and input methods.** Design for mouse/keyboard and touch. Ensure your UI responds well to different form factors.

### **Optimize for touch**

Touch support is essential for modern Office add-ins.

- **Detect touch support.** Use the [Context.touchEnabled](https://learn.microsoft.com/en-us/javascript/api/office/office.context#office-office-context-touchenabled-member) property to detect whether the Office app your add-in runs on is touch-enabled.
#### 7 **Note**

This property isn't supported in Outlook.

- **Size controls appropriately.** Make sure all controls work well with touch interaction. For example, buttons need adequate touch targets, and input boxes should be large enough for users to enter text easily.
- **Don't rely on hover or right-click.** These input methods aren't available on touch devices.
- **Support both orientations.** Ensure your add-in works in both portrait and landscape modes. Remember that on touch devices, the soft keyboard might hide part of your addin.
- **Test on real devices.** Use sideloading to test your add-in on actual touch devices.


## **Optimize and monitor add-in performance**

Performance directly impacts user satisfaction. Follow these guidelines to keep your add-in fast and responsive:

- **Aim for quick loading.** Your add-in should load in 500 ms or less to create the perception of fast UI responses.
- **Respond quickly to interactions.** All user interactions should respond in under one second.
- **Show progress for long operations.** Provide loading indicators for operations that take time.
- **Use a CDN.** Host images, resources, and common libraries on a content delivery network (CDN). Load as much as possible from one place.
- **Follow web optimization best practices.** In production, use only minified versions of libraries. Load only the resources you need and optimize how they're loaded.
- **Provide feedback for longer operations.** When operations take time to execute, give users feedback based on the thresholds in the following table. For more information, see Resource limits and performance optimization for Office Add-ins.

| Interaction<br>class | Target        | Upper<br>bound | Human perception                                                        |
|----------------------|---------------|----------------|-------------------------------------------------------------------------|
| Instant              | <=50 ms       | 100 ms         | No noticeable delay.                                                    |
| Fast                 | 50-100 ms     | 200 ms         | Minimally noticeable delay. No feedback necessary.                      |
| Typical              | 100-300<br>ms | 500 ms         | Quick, but too slow to be described as fast. No<br>feedback necessary.  |
| Responsive           | 300-500<br>ms | 1 second       | Not fast, but still feels responsive. No feedback<br>necessary.         |
| Continuous           | >500 ms       | 5 seconds      | Medium wait, no longer feels responsive. Might need<br>feedback.        |
| Captive              | >500 ms       | 10 seconds     | Long, but not long enough to do something else.<br>Might need feedback. |
| Extended             | >500 ms       | >10<br>seconds | Long enough to do something else while waiting.<br>Might need feedback. |


| Interaction<br>class | Target        | Upper<br>bound | Human perception                        |
|----------------------|---------------|----------------|-----------------------------------------|
| Long running         | >5<br>seconds | >1 minute      | Users will certainly do something else. |

- **Monitor your service.** Use telemetry to monitor service health and user success.
- **Minimize data exchanges.** Reduce data exchanges between your add-in and the Office document. For more information, see Avoid using the context.sync method in loops.

### **Publish and market your add-in**

Ready to share your add-in with the world? Here's how to get started.

- **Create a Partner Center account.** This process can take time, so if you plan to publish to AppSource, start early. See [Partner Center account.](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/open-a-developer-account)
- **Create an effective AppSource listing.** Follow these tips:
	- Use succinct, descriptive titles (128 characters or fewer).
	- Write short, compelling descriptions that answer "What problem does this add-in solve?"
	- Convey your add-in's value proposition clearly in the title and description. Don't rely only on your brand.

Learn more about [creating effective AppSource listings.](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/create-effective-office-store-listings)

- **Publish to AppSource.** Follow the AppSource [prepublish checklist](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/checklist) and [submission guide.](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/add-in-submission-guide) Make sure to:
	- Test your add-in thoroughly on all supported operating systems, browsers, and devices.
	- Provide detailed testing instructions and resources for certification reviewers.
- **Create a website.** Help users discover your add-in outside of AppSource.
- **Promote your add-in** from your website. See [how to promote your add-in](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/promote-your-office-store-solution).

#### ) **Important**

If your add-in targets larger organizations and enterprises, several AppSource requirements differ from those of a general commercial marketplace add-in. For more information, see the **[submission FAQ](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/appsource-submission-faq#if-my-app-targets-enterprises--how-does-that-affect-my-submission-)**.


# **Support older Microsoft webviews and Office versions (recommended but not required)**

See Support older Microsoft webviews and Office versions.

# **See also**

- Office Add-ins platform overview
- [Learn about the Microsoft 365 Developer Program](https://aka.ms/m365devprogram)

# **Localization for Office Add-ins**

Article • 02/12/2025

You can implement any localization scheme that's appropriate for your Office Add-in. The JavaScript API and manifest schema of the Office Add-ins platform provide some choices. You can use the Office JavaScript API to determine a locale and display strings based on the locale of the Office application, or to interpret or display data based on the locale of the data. You can use the manifest to specify locale-specific add-in file location and descriptive information. Alternatively, you can use Visual Studio and Microsoft Ajax script to support globalization and localization.

## **Use the JavaScript API to determine localespecific strings**

The Office JavaScript API provides two properties that support displaying or interpreting values consistent with the locale of the Office application and data.

- [Context.displayLanguage](https://learn.microsoft.com/en-us/javascript/api/office/office.context#displayLanguage) specifies the locale (or language) of the user interface of the Office application. The following example verifies if the Office application uses the en-US or fr-FR locale, and displays a locale-specific greeting.

```
JavaScript
function sayHelloWithDisplayLanguage() {
 const myLanguage = Office.context.displayLanguage;
 switch (myLanguage) {
 case 'en-US':
 write('Hello!');
 break;
 case 'fr-FR':
 write('Bonjour!');
 break;
 }
}
// Function that writes to a div with id='message' on the page.
function write(message) {
 document.getElementById('message').innerText += message;
}
```
- [Context.contentLanguage](https://learn.microsoft.com/en-us/javascript/api/office/office.context#contentLanguage) specifies the locale (or language) of the data. Extending the last code sample, instead of checking the [displayLanguage](https://learn.microsoft.com/en-us/javascript/api/office/office.context#displayLanguage) property, assign


myLanguage the value of the [contentLanguage](https://learn.microsoft.com/en-us/javascript/api/office/office.context#contentLanguage) property, and use the rest of the same code to display a greeting based on the locale of the data.

```
JavaScript
const myLanguage = Office.context.contentLanguage;
```
## **Control localization from the manifest**

The techniques for localizing with the manifest differ depending on whether you're using the add-in only manifest or the unified app manifest for Microsoft 365.

Unified app manifest for Microsoft 365

When using the unified app manifest for Microsoft 365, localize the public-facing strings in the manifest as described in [Localize strings in your app manifest.](https://learn.microsoft.com/en-us/microsoftteams/platform/concepts/build-and-test/apps-localization#localize-strings-in-your-app-manifest) The following is an example for an Outlook add-in. First is the "localizationInfo" object in the manifest. Below that is the fr-fr.json file with the translated strings. The add-in has a task pane (with a French version of the home page), localized French icons, and a custom ribbon button that opens a video player in a dialog box.

JSON

```
"localizationInfo": {
 "defaultLanguageTag": "en",
 "additionalLanguages": [
 {
 "languageTag": "fr-fr",
 "file": "fr-fr.json"
 }
 ]
}
```
JSON

```
{
 "$schema": "https://developer.microsoft.com/json-
schemas/teams/v1.16/MicrosoftTeams.Localization.schema.json",
 "name.short": "Lecteur vidéo",
 "name.full": "Lecteur vidéo pour Outlook",
 "description.short": "Voir les vidéos YouTube dans Outlook via les
mails.",
 "description.full": "Visualisez les vidéos YouTube référencées dans
vos courriers électronique directement depuis Outlook.",
 "icons.color": "https://localhost:3000/assets/fr-fr/icon-128.png",
 "extensions[0].audienceClaimUrl": "https://localhost:3000/fr-
```


```
fr/taskpane.html",
 "extensions[0].ribbons[0].tabs[0].groups[0].label": "Outils de
médias",
 "extensions[0].ribbons[0].tabs[0].groups[0].controls[0].icons[0].url":
"https://localhost:3000/assets/fr-fr/player-icon.png",
 "extensions[0].ribbons[0].tabs[0].groups[0].controls[0].label": 
"Ouvrir le lecteur vidéo",

"extensions[0].ribbons[0].tabs[0].groups[0].controls[0].supertip.descrip
tion": "Cliquez pour ouvrir le lecteur vidéo.",

"extensions[0].ribbons[0].tabs[0].groups[0].controls[0].supertip.title":
"Ouvrir le lecteur vidéo",
}
```
## **Match date/time format with client locale**

You can get the locale of the user interface of the Office client application by using the **[displayLanguage](https://learn.microsoft.com/en-us/javascript/api/office/office.context#displayLanguage)** property. You can then display date and time values in a format consistent with the current locale of the Office application. One way to do that is to prepare a resource file that specifies the date/time display format to use for each locale that your Office Add-in supports. At run time, your add-in can use the resource file and match the appropriate date/time format with the locale obtained from the **[displayLanguage](https://learn.microsoft.com/en-us/javascript/api/office/office.context#displayLanguage)** property.

You can get the locale of the data of the Office client application by using the [contentLanguage](https://learn.microsoft.com/en-us/javascript/api/office/office.context#contentLanguage) property. Based on this value, you can then appropriately interpret or display date/time strings. For example, the jp-JP locale expresses data/time values as yyyy/MM/dd , and the fr-FR locale, dd/MM/yyyy .

## **Use Visual Studio to create a localized and globalized add-in**

If you use Visual Studio to create Office Add-ins, the .NET Framework and Ajax provide ways to globalize and localize client script files.

You can globalize and use the [Date](https://learn.microsoft.com/en-us/previous-versions/bb310850(v=vs.140)) and [Number](https://learn.microsoft.com/en-us/previous-versions/bb310835(v=vs.140)) JavaScript type extensions and the JavaScript [Date](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Date) object in the JavaScript code for an Office Add-in to display values based on the locale settings on the current browser. For more information, see [Walkthrough: Globalizing a Date by Using Client Script.](https://learn.microsoft.com/en-us/previous-versions/bb386581(v=vs.140))

You can include localized resource strings directly in standalone JavaScript files to provide client script files for different locales, which are set on the browser or provided 


by the user. Create a separate script file for each supported locale. In each script file, include an object in JSON format that contains the resource strings for that locale. The localized values are applied when the script runs in the browser.

### **Example: Build a localized Office Add-in**

This section provides examples that show you how to localize an Office Add-in description, display name, and UI.

#### 7 **Note**

To download Visual Studio, see the **[Visual Studio IDE page](https://visualstudio.microsoft.com/vs/)** . During installation you'll need to select the Office/SharePoint development workload.

### **Configure Office to use additional languages for display or editing**

To run the sample code provided, configure Office on your computer to use additional languages so that you can test your add-in by switching the language used for display in menus and commands, for editing and proofing, or both.

You can use an Office Language pack to install an additional language. For more information about Language Packs and where to get them, see [Language Accessory](https://support.microsoft.com/office/82ee1236-0f9a-45ee-9c72-05b026ee809f) [Pack for Office](https://support.microsoft.com/office/82ee1236-0f9a-45ee-9c72-05b026ee809f) .

After you install the Language Accessory Pack, you can configure Office to use the installed language for display in the UI, for editing document content, or both. The example in this article uses an installation of Office that has the Spanish Language Pack applied.

#### **Create an Office Add-in project**

You'll need to create a Visual Studio Office Add-in project.

#### 7 **Note**

If you haven't installed Visual Studio, see the **[Visual Studio IDE page](https://visualstudio.microsoft.com/vs/)** for download instructions. During installation you'll need to select the Office/SharePoint development workload. If you've previously installed Visual Studio 2019 or later, **[use the Visual Studio Installer](https://learn.microsoft.com/en-us/visualstudio/install/modify-visual-studio/)** to ensure that the Office/SharePoint development workload is installed.


- 1. Choose **Create a new project**.
- 2. Using the search box, enter **add-in**. Choose **Word Web Add-in**, then select **Next**.
- 3. Name your project **WorldReadyAddIn** and select **Create**.
- 4. Visual Studio creates a solution and its two projects appear in **Solution Explorer**. The **Home.html** file opens in Visual Studio.

### **Localize the text used in your add-in**

The text that you want to localize for another language appears in two areas.

- **Add-in display name and description**. This is controlled by entries in the add-in manifest file.
- **Add-in UI**. You can localize the strings that appear in your add-in UI by using JavaScript code, for example, by using a separate resource file that contains the localized strings.

### **Localize the add-in display name and description**

- 1. In **Solution Explorer**, expand **WorldReadyAddIn**, **WorldReadyAddInManifest**, and then choose **WorldReadyAddIn.xml**.
- 2. In **WorldReadyAddInManifest.xml**, replace the [DisplayName](https://learn.microsoft.com/en-us/javascript/api/manifest/displayname) and [Description](https://learn.microsoft.com/en-us/javascript/api/manifest/description) elements with the following block of code.

#### 7 **Note**

You can replace the Spanish language localized strings used in this example for the **[DisplayName](https://learn.microsoft.com/en-us/javascript/api/manifest/displayname)** and **[Description](https://learn.microsoft.com/en-us/javascript/api/manifest/description)** elements with the localized strings for any other language.

```
XML
<DisplayName DefaultValue="World Ready add-in">
 <Override Locale="es-es" Value="Aplicación de uso internacional"/>
</DisplayName>
<Description DefaultValue="An add-in for testing localization">
 <Override Locale="es-es" Value="Una aplicación para la prueba de la
localización"/>
</Description>
```


- 3. When you change the display language for Microsoft 365 from English to Spanish, for example, and then run the add-in, the add-in display name and description are shown with localized text.
#### **Lay out the add-in UI**

- 1. In Visual Studio, in **Solution Explorer**, choose **Home.html**.
- 2. Replace the <body> element contents in **Home.html** with the following HTML, and save the file.

```
HTML
<body>
 <!-- Page content -->
 <div id="content-header" class="ms-bgColor-themePrimary ms-font-
xl">
 <div class="padding">
 <h1 id="greeting" class="ms-fontColor-white"></h1>
 </div>
 </div>
 <div id="content-main">
 <div class="padding">
 <div class="ms-font-m">
 <p id="about"></p>
 </div>
 </div>
 </div>
</body>
```
The following figure shows the heading (h1) element and the paragraph (p) element that will display localized text when you complete the remaining steps and run the addin.


### **Add the resource file that contains the localized strings**

The JavaScript resource file contains the strings used for the add-in UI. The HTML for the sample add-in UI contains an <h1> element that displays a greeting, and a <p> element that introduces the add-in to the user.

To enable localized strings for the heading and paragraph, you place the strings in a separate resource file. The resource file creates a JavaScript object that contains a separate JavaScript Object Notation (JSON) object for each set of localized strings. The resource file also provides a method for getting back the appropriate JSON object for a given locale.

### **Add the resource file to the add-in project**


- 1. In **Solution Explorer** in Visual Studio, right-click (or select and hold) the **WorldReadyAddInWeb** project, then choose **Add** > **New Item**.
- 2. In the **Add New Item** dialog box, choose **JavaScript File**.
- 3. Enter **UIStrings.js** as the file name and choose **Add**.
- 4. Add the following code to the **UIStrings.js** file, and save the file.

```
JavaScript
/* Store the locale-specific strings */
const UIStrings = (() => {
 "use strict";
 const UIStrings = {};
 // JSON object for English strings
 UIStrings.EN = {
 "Greeting": "Welcome",
 "Introduction": "This is my localized add-in."
 };
 // JSON object for Spanish strings
 UIStrings.ES = {
 "Greeting": "Bienvenido",
 "Introduction": "Esta es mi aplicación localizada."
 };
 UIStrings.getLocaleStrings = (locale) => {
 let text;
 // Get the resource strings that match the language.
 switch (locale) {
 case 'en-US':
 text = UIStrings.EN;
 break;
 case 'es-ES':
 text = UIStrings.ES;
 break;
 default:
 text = UIStrings.EN;
 break;
 }
 return text;
 };
 return UIStrings;
})();
```


The **UIStrings.js** resource file creates an object, **UIStrings**, which contains the localized strings for your add-in UI.

#### **Localize the text used for the add-in UI**

To use the resource file in your add-in, you'll need to add a script tag for it on **Home.html**. When **Home.html** is loaded, **UIStrings.js** executes and the **UIStrings** object that you use to get the strings is available to your code. Add the following HTML in the head tag for **Home.html** to make **UIStrings** available to your code.

```
HTML
<!-- Resource file for localized strings: -->
<script src="../UIStrings.js" type="text/javascript"></script>
```
Now you can use the **UIStrings** object to set the strings for the UI of your add-in.

If you want to change the localization for your add-in based on what language is used for display in menus and commands in the Office client application, you use the **Office.context.displayLanguage** property to get the locale for that language. For example, if the application language uses Spanish for display in menus and commands, the **Office.context.displayLanguage** property will return the language code es-ES.

If you want to change the localization for your add-in based on what language is being used for editing document content, you use the **Office.context.contentLanguage** property to get the locale for that language. For example, if the application language uses Spanish for editing document content, the **Office.context.contentLanguage** property will return the language code es-ES.

After you know the language the application is using, you can use **UIStrings** to get the set of localized strings that matches the application language.

Replace the code in the **Home.js** file with the following code. The code shows how you can change the strings used in the UI elements on **Home.html** based on either the display language of the application or the editing language of the application.

#### 7 **Note**

To switch between changing the localization of the add-in based on the language used for editing, uncomment the line of code const myLanguage = Office.context.contentLanguage; and comment out the line of code const myLanguage = Office.context.displayLanguage;


```
/// <reference path="../App.js" />
/// <reference path="../UIStrings.js" />
(() => {
 "use strict";
 // The initialize function must be run each time a new page is loaded.
 Office.onReady(() => {
 $(document).ready(() => {
 // Get the language setting for editing document content.
 // To test this, uncomment the following line and then comment
out the
 // line that uses Office.context.displayLanguage.
 // const myLanguage = Office.context.contentLanguage;

 // Get the language setting for UI display in the Office
application.
 const myLanguage = Office.context.displayLanguage;
 let UIText;

 // Get the resource strings that match the language.
 // Use the UIStrings object from the UIStrings.js file
 // to get the JSON object with the correct localized strings.
 UIText = UIStrings.getLocaleStrings(myLanguage);

 // Set localized text for UI elements.
 $("#greeting").text(UIText.Greeting);
 $("#about").text(UIText.Introduction);
 });
 });
})();
```
### **Test your localized add-in**

To test your localized add-in, change the language used for display or editing in the Office application and then run your add-in.

- 1. In Word, choose **File** > **Options** > **Language**. The following figure shows the **Word Options** dialog box opened to the Language tab.


| Word Options         |                                                                                                                                 |                 |     |           |                                |                                            |    | ?              | ×      |
|----------------------|---------------------------------------------------------------------------------------------------------------------------------|-----------------|-----|-----------|--------------------------------|--------------------------------------------|----|----------------|--------|
| General              | Set the Office Language Preferences.                                                                                            |                 |     |           |                                |                                            |    |                |        |
| Display              | Choose Editing Languages                                                                                                        |                 |     |           |                                |                                            |    |                |        |
| Proofing             |                                                                                                                                 |                 |     |           |                                |                                            |    |                |        |
| Save                 | Add languages to edit your documents. Editing language-specific features, including spelling, grammar<br>checking, and sorting. |                 |     |           |                                |                                            |    |                | 1      |
| Lanquage             | Editing Language                                                                                                                | Keyboard Layout |     |           | Proofing (Spelling, Grammar  ) |                                            |    |                |        |
| Ease of Access       | English (United States) <default></default>                                                                                     | Enabled         | abc | Installed |                                |                                            |    | Remove         |        |
| Advanced             | Spanish (Spain)                                                                                                                 | Not enabled     | abc | Installed |                                |                                            |    | Set as Default |        |
|                      |                                                                                                                                 |                 |     |           |                                |                                            |    |                |        |
| Customize Ribbon     |                                                                                                                                 |                 |     |           |                                |                                            |    |                |        |
| Quick Access Toolbar | [Add additional editing languages]                                                                                              | >               |     | Add       |                                |                                            |    |                |        |
| Add-ins              | Y Let me know when I should download additional proofing tools.                                                                 |                 |     |           |                                |                                            |    |                |        |
|                      | Choose Display Language                                                                                                         |                 |     |           |                                |                                            |    |                |        |
| Trust Center         | Set the language priority order for display (Ribbon, buttons, tabs, and other controls) and Help.0                              |                 |     |           |                                |                                            |    |                |        |
| Experiment           | Display Lanquage                                                                                                                |                 |     |           | Help Language                  |                                            |    |                |        |
|                      | Match Microsoft Windows <default><br/>1.</default>                                                                              |                 | ▲   | 1.        |                                | Match Display Language <default></default> |    |                | 4      |
|                      | 2.<br>English                                                                                                                   |                 |     | 2.        | English                        |                                            |    |                |        |
|                      | Spanish [Español]<br>3.                                                                                                         |                 | レ   | 3.        | Spanish [Español]              |                                            |    |                | て      |
|                      |                                                                                                                                 |                 |     |           |                                |                                            |    |                |        |
|                      | Set as Default                                                                                                                  |                 |     |           | Set as Default                 |                                            |    |                |        |
|                      | യ Get more display and Help languages from Office.com                                                                           |                 |     |           |                                |                                            |    |                |        |
|                      |                                                                                                                                 |                 |     |           |                                |                                            |    |                |        |
|                      |                                                                                                                                 |                 |     |           |                                |                                            |    |                |        |
|                      |                                                                                                                                 |                 |     |           |                                |                                            |    |                |        |
|                      |                                                                                                                                 |                 |     |           |                                |                                            |    |                |        |
|                      |                                                                                                                                 |                 |     |           |                                |                                            |    |                |        |
|                      |                                                                                                                                 |                 |     |           |                                |                                            |    |                |        |
|                      |                                                                                                                                 |                 |     |           |                                |                                            |    |                |        |
|                      |                                                                                                                                 |                 |     |           |                                |                                            | OK |                | Cancel |

- 2. Under **Choose Display Language**, select the language that you want for display, for example Spanish, and then choose the up arrow to move the Spanish language to the first position in the list. Alternatively, to change the language used for editing, under **Choose Editing Languages**, choose the language you want to use for editing, for example, Spanish, and then choose **Set as Default**.
- 3. Choose **OK** to confirm your selection, and then close Word.
- 4. Press F5 in Visual Studio to run the sample add-in, or choose **Debug** > **Start Debugging** from the menu bar.
- 5. In Word, choose **Home** > **Show Taskpane**.

Once running, the strings in the add-in UI change to match the language used by the application, as shown in the following figure.


## **See also**

- Design guidelines for Office Add-ins
- [Overview of deploying languages for Microsoft 365 Apps](https://learn.microsoft.com/en-us/deployoffice/overview-deploying-languages-microsoft-365-apps)

# **Create Office Add-in projects using Office Add-ins Development Kit for Visual Studio Code**

Article • 12/19/2024

The Office Add-ins Development Kit helps set up your environment, create Office Addins, and debug your code in a streamlined experience.

#### ) **Important**

The Office Add-ins Development Kit extension only supports creating add-ins that use the **add-in only manifest**. It also only creates Excel, PowerPoint, and Word addins at this time. Support for Outlook is under development, as are additional samples and other improvements. We welcome any feedback you have on the tool. Issues and features requests should be submitted through **[GitHub issues on the](https://aka.ms/officedevkitnewissue) [extension's repo](https://aka.ms/officedevkitnewissue)** .

### **Prerequisites**

- Download and install [Visual Studio Code](https://code.visualstudio.com/) .
- Node.js (the latest LTS version). Visit the [Node.js site](https://nodejs.org/)  to download and install the right version for your operating system. To verify if you've already installed these tools, run the commands node -v and npm -v in your terminal.
- Office connected to a Microsoft 365 subscription. You might qualify for a Microsoft 365 E5 developer subscription through the [Microsoft 365 Developer Program](https://developer.microsoft.com/microsoft-365/dev-program), see [FAQ](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-) for details. Alternatively, you can [sign up for a 1-month free trial](https://www.microsoft.com/microsoft-365/try?rtc=1) or [purchase a Microsoft 365 plan](https://www.microsoft.com/microsoft-365/buy/compare-all-microsoft-365-products) .

### **Install the development kit**

You can install Office Add-ins Development Kit using **Extensions** in Visual Studio Code or install it from the Visual Studio Code Marketplace.

- 1. Launch Visual Studio Code.


- 2. Select **View** > **Extensions** or **Ctrl+Shift+X**. You can also open extensions by selecting the **Extensions** tab from the Visual Studio Code activity bar.
- 3. Enter **Office Add-ins Development Kit** in the search box.
- 4. Select **Office Add-ins Development Kit**. From the Office Add-ins Development Kit extension page that appears in the main pane, select **Install**. After successfully installing, the Office Add-ins Development Kit icon will appear in the Visual Studio Code activity bar.

### **Create an add-in project**

The Office Add-ins Development Kit offers two ways to get started with a new project: templates and samples. Templates let you choose the Office application, programming language, and starting feature. Samples are more complete projects that demonstrate a realistic scenario.

### **Create an add-in from a template**

Templates offer a basic starting point for your add-in. They add a minimal amount of functionality so you can get started without changing much of the existing code. The following instructions describe how to make a new project from a template using the development kit.

- 1. Open Visual Studio Code and select the Office Add-ins Development Kit icon in the **Activity Bar**.
- 2. Select **Create a New Add-in** in the extension task pane.
- 3. In the now-active Quick Pick menu, select the Office application for your add-in.
- 4. Select an add-in template from the list of available templates.
- 5. Select "JavaScript" or "TypeScript" as the programming language.
- 6. In the **Workspace folder** dialog that opens, select the folder where you want to create the project.
- 7. Give a name to the project (with no spaces) when prompted. Office Add-ins Development Kit will create the project with basic files and scaffolding. It then opens the project in a *second* Visual Studio Code window. You can freely close the original Visual Studio Code window.

### **Create an add-in from a sample**

Samples show a working add-in that solves an end-to-end scenario. Samples are most useful as learning tools to understand how features of the Office Add-ins framework


work together. You can also expand a sample to fit your particular needs.

- 1. Open Visual Studio Code and select the Office Add-ins Development Kit icon in the **Activity Bar**.
- 2. Select **View Samples**.
- 3. Select the sample you would like to view.
- 4. Select the **Create** button above the now-open sample readme.
- 5. In the **Workspace folder** dialog that opens, select the folder where you want to create the project. The extension copies a version of the sample to that folder. It then opens the project in a *second* Visual Studio Code window. You can freely close the original Visual Studio Code window.

### **Test your add-in**

To understand how the add-in will work in an Office application, use the Office Add-ins Development Kit to run and debug your Office add-in in your local development environment.

#### 7 **Note**

These steps are the same as the ones listed in Visual Studio Code by the extension when you create a new project.

- 1. Open the extension by selecting the Office Add-ins Development Kit icon in the **Activity Bar**.
- 2. Select **Preview Your Office Add-in (F5)**
- 3. In the Quick Pick menu, select the option **{Office Application} Desktop (Edge Chromium)**, where '{Office Application}' is the appropriate application, such as "Excel" or "Word". This will launch the add-in and debug the code.

The development kit checks that the prerequisites are met before debugging starts. Check the terminal for detailed information if there are issues with your environment. After this process, the Office desktop application launches and sideloads the add-in. Please note that the first time you run a project, it may make take a few minutes to install the dependencies. You'll need to install the certificate when prompted.

## **Stop testing your Office Add-in**

Once you are finished testing and debugging the add-in, *always* close the add-in by following these steps. (Closing the Office application or web server window doesn't


reliably deregister the add-in.)

- 1. Open the extension by selecting the Office Add-ins Development Kit icon in the **Activity Bar**.
- 2. Select **Stop Previewing Your Office Add-in**. This closes the web server and removes the add-in from the registry and cache.
- 3. Close the Office application window.

## **Troubleshooting**

If you have problems running the add-in, take these steps.

- Close any open instances of Office.
- Close the previous web server started for the add-in with the **Stop Previewing Your Office Add-in** Office Add-ins Development Kit extension option.

The article Troubleshoot development errors with Office Add-ins contains solutions to common problems. If you're still having issues, [create a GitHub issue](https://aka.ms/officedevkitnewissue) and we'll help you.

For information on running the add-in on Office on the web, see Sideload Office Addins to Office on the web.

For information on debugging on older versions of Office, see Debug add-ins using developer tools in Microsoft Edge Legacy.

# **Create Office Add-in projects using the Yeoman Generator**

07/07/2025

The [Yeoman Generator for Office Add-ins](https://github.com/OfficeDev/generator-office) (also called "Yo Office") is an interactive Node.jsbased command line tool that creates Office Add-in development projects. These projects are Node.js-based. When you want the server-side code of the add-in to be in a .NET-based language (such as C# or VB.Net) or you want the add-in hosted in Internet Information Server (IIS), use Visual Studio to create the add-in.

#### 7 **Note**

Office add-ins can also be created with the **Microsoft 365 Agents Toolkit** or the **Office Add-in Development Kit**.

The projects that the tool creates have the following characteristics.

- They have a standard [npm](https://www.npmjs.com/) configuration that includes a **package.json** file.
- They include several helpful scripts to build the project, start the server, sideload the addin in Office, and other tasks.
- They use [webpack](https://webpack.js.org/) as a bundler and basic task runner.
- In development mode, they are hosted on localhost by webpack's Node.js-based webpack-dev-server, a development-oriented version of the [express](http://expressjs.com/) server that supports hot-reloading and recompile-on-change.
- By default, all dependencies are installed by the tool, but you can postpone the installation with a command line argument.
- They include a complete add-in manifest.
- They have a "Hello World"-level add-in that is ready run as soon as the tool has finished.
- They include a polyfill and a transpiler that is configured to transpile TypeScript, and recent versions of JavaScript, to ES5 JavaScript. These features ensure that the add-in is supported in all webview runtimes that Office Add-ins might run in, including Trident (Internet Explorer).

### **Tip**

If you want to deviate from these choices significantly, such as using a different task runner or a different server, we recommend that when you run the tool you choose the **Manifest-only option**.


## **Prerequisites**

#### 7 **Note**

If you aren't familiar with Node.js or npm, you should start by **setting up your development environment**.

- Node.js (the latest LTS version). Visit the [Node.js site](https://nodejs.org/) to download and install the right version for your operating system.
- The latest version of Yeoman and the Yeoman generator for Office Add-ins. To install these tools globally, run the following command via the command prompt.

command line

npm install -g yo generator-office

#### 7 **Note**

Even if you've previously installed the Yeoman generator, we recommend you update your package to the latest version from npm.

- Office connected to a Microsoft 365 subscription (including Office on the web).
### 7 **Note**

If you don't already have Office, you might qualify for a Microsoft 365 E5 developer subscription through the **[Microsoft 365 Developer Program](https://aka.ms/m365devprogram)** ; for details, see the **[FAQ](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-)**. Alternatively, you can **[sign up for a 1-month free trial](https://www.microsoft.com/microsoft-365/try)** or **[purchase a](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g) [Microsoft 365 plan](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g)** .

## **Use the tool**

Start the tool with the following command in a system prompt (not a bash window). This will create a new project in a new folder in the current directory.

```
command line
```
yo office


A lot needs to load, so it may take 40 seconds before the tool starts. The tool asks you a series of questions. For some, you just type an answer to the prompt. For others, you're given a list of possible answers. If given a list, use the up and down arrow keys to select one and then select Enter .

The first question asks you to choose between several types of projects. The options are:

- **Office Add-in Task Pane project**
- **Excel, PowerPoint, and/or Word Task Pane with unified manifest for Microsoft 365 (preview)**
- **Office Add-in Task Pane project using React framework**
- **Excel Custom Functions using a Shared Runtime**
- **Excel Custom Functions using a JavaScript-only Runtime**
- **Office Add-in Task Pane project supporting single sign-on**
- **Office Add-in Task Pane project supporting Nested App Auth single sign-on (preview)**
- **Office Add-in project containing the manifest only**

7 **Note**

- The **Office Add-in project containing the manifest only** option produces a project that contains a basic add-in manifest and minimal scaffolding. For more information about the option, see **Manifest-only option**.
- The **Excel, PowerPoint, and/or Word Task Pane with unified manifest for Microsoft 365 (preview)** option creates a project for Excel, PowerPoint, Word, or all three, that uses the unified manifest for Microsoft 365. For more information about the option, see **Word, PowerPoint, or Excel with unified manifest option**.

The next question asks you to choose between **TypeScript** and **JavaScript**. (This question is skipped if you chose the manifest-only option in the preceding question.)


You're then prompted to give the add-in a name. The name you specify will be used in the add-in's manifest, but you can change it later. This is also the folder name for the project.

You're then prompted to choose which Office application the add-in should run in. There are six possible applications to choose from: **Excel**, **OneNote**, **Outlook**, **PowerPoint**, **Project**, and **Word**. You must choose just one, but you can change the manifest later to support the additional Office applications. The exception is Outlook. A manifest that supports Outlook cannot support any other Office application.


If you choose **Outlook** as the Office application, you get an additional question asking you which type of manifest you want to use. We recommend that you choose **unified manifest for Microsoft 365** unless your add-in will include an extensibility feature that isn't yet supported by the unified manifest.

#### 7 **Note**

For information on clients and platforms that *directly* support Office Add-ins that use the unified manifest for Microsoft 365, see **Office Add-ins with the unified app manifest for Microsoft 365**.

After you've answered all questions, the generator creates the project and installs the dependencies. You may see **WARN** messages in the npm output on screen. You can ignore these. You may also see messages that vulnerabilities were found. You can ignore these for now, but you'll eventually need to fix them before your add-in is released to production. For more information, see Warnings and dependencies in the Node.js and npm world.

If the creation is successful, you'll see a **Congratulations!** message in the command window, followed by some suggested next steps. (If you're using the generator as part of a quick start or tutorial, ignore the next steps in the command window and continue with the instructions in the article.)


If you want to create the scaffolding of an Office Add-in project, but postpone the installation of the dependencies, add the --skip-install option to the yo office command. The following code is an example.

command line

yo office --skip-install

When you're ready to install the dependencies, navigate to the root folder of the project in a command prompt and enter npm install .

### 2 **Warning**

If you choose **Office Add-in Task Pane project supporting single sign-on** and **TypeScript**, and you are using a Node.js version greater than 18.16.0, then a bug in Node.js may cause the project file **<root>\src\middle-tier\ssoauth-helper.ts** to be corrupted. To fix it, copy the contents of the file from the repo, **[ssoauth-helper.ts](https://github.com/OfficeDev/Office-Addin-Taskpane-SSO/blob/master/src/middle-tier/ssoauth-helper.ts)** , over the contents of the file in the generated project.

# **Manifest-only option**

This option creates only a manifest for an add-in. The resulting project doesn't have a Hello World add-in, any of the scripts, or any of the dependencies. Use this option in the following scenarios.

- You want to use different tools from the ones a Yeoman generator project installs and configures by default. For example, you want to use a different bundler, transpiler, task runner, or development server.
- You want to use a web application development framework, other than React, such as Vue.

# **Word, PowerPoint, or Excel with unified manifest option**

The unified manifest for Microsoft 365 is in preview for Excel, PowerPoint, and Word add-ins. It should not be used for production add-ins, but you can select this option in Yo Office to create an add-in for one (or all three) of those Office applications. You'll be asked to choose which Office application. You can also choose **All** to create an add-in that is installable on all three Office applications. The project that is created uses TypeScript.


## **Use command line parameters**

You can also add parameters to the yo office command. The two most common are:

- yo office --details : This will output brief help about all of the other command line parameters.
- yo office --skip-install : This will prevent the generator from installing the dependencies.

For detailed reference about the command line parameters, see the readme for the generator at [Yeoman generator for Office Add-ins](https://github.com/officedev/generator-office) .

## **Troubleshooting**

If you encounter problems using the tool, your first step should be to reinstall it to be sure that you have the latest version. (See Prerequisites for details.) If doing so doesn't fix the problem, search the [issues of the GitHub repo for the tool](https://github.com/OfficeDev/generator-office/issues) to see if anyone else has encountered the same problem and found a solution. If no one has, [create a new issue](https://github.com/OfficeDev/generator-office/issues/new?assignees=&labels=needs+triage&template=bug_report.md&title=) .

# **Create Office Add-in projects with Microsoft 365 Agents Toolkit**

08/13/2025

A primary tool for developing Microsoft 365 apps and agents, including Office Add-ins, is Microsoft 365 Agents Toolkit.

Add-ins created with Agents Toolkit use the unified manifest for Microsoft 365.

#### 7 **Note**

The **unified manifest for Microsoft 365** can be used in production Outlook add-ins. It's available only as a preview for Excel, PowerPoint, and Word add-ins.

#### **Tip**

There's another Visual Studio Code extension that creates Office Add-ins that use the addin only manifest. See **Create Office Add-in projects using Office Add-ins Development Kit for Visual Studio Code**.

#### 7 **Note**

For information on clients and platforms that *directly* support Office Add-ins that use the unified manifest for Microsoft 365, see **Office Add-ins with the unified app manifest for Microsoft 365**.

Install the latest version of Agents Toolkit into Visual Studio Code as described in [Install](https://learn.microsoft.com/en-us/microsoftteams/platform/toolkit/install-teams-toolkit?tabs=vscode) [Microsoft 365 Agents Toolkit](https://learn.microsoft.com/en-us/microsoftteams/platform/toolkit/install-teams-toolkit?tabs=vscode).

#### ) **Important**

You can create an Outlook add-in with the latest released version of Agents Toolkit. To create an add-in for Excel, PowerPoint, or Word, install the prerelease version as described in **[Install a prerelease version](https://learn.microsoft.com/en-us/microsoftteams/platform/toolkit/install-teams-toolkit?tabs=vscode#install-a-prerelease-version)**. The toolkit creates projects that use the **unified manifest for Microsoft 365**. Support for this manifest in Excel, PowerPoint, and Word is preview only.


## **Create an Office Add-in project**

- 1. Open Visual Studio Code and select the Agents Toolkit icon in the **Activity Bar**.
- 2. Select **Create a New App**.
- 3. The **New Project** dropdown menu opens. The options listed will vary depending on your version of Agents Toolkit. Select **Office Add-in**.

| New Project                                                                                                                                                                                                                                                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Select an option                                                                                                                                                                                                                                                                                            |
| Declarative Agent<br>Agents for Microsoft 365 Copilot<br>Create your own agent by declaring instructions, actions, & knowledge to suit your needs                                                                                                                                                           |
| 2 Custom Engine Agent<br>Build intelligent agent where you manage orchestration and provide your own LLM<br>Copilot Connector<br>Embed your organization data to make it searchable in Microsoft 365 Copilot                                                                                                |
| Agent for Teams<br>Apps for Microsoft 365<br>Build an agent for Microsoft Teams easily using Teams Al Library<br>Teams app<br>Create your own web page, chat bot or message extensions for Microsoft Teams<br>Office Add-in<br>Extend Office ribbons or task pane to interact context in Office and Outlook |
| ② Don't know how to start? Use GitHub Copilot Chat<br>Chat with GitHub Copilot and get step-by-step instructions to develop your Teams app                                                                                                                                                                  |

- 4. The **App Features Using an Office Add-in** dropdown menu opens. The options listed will vary depending on your version of Agents Toolkit. Select **Task pane**.
- 5. In the **Workspace Folder** dialog that opens, select the folder where you want to create the project.


- 6. Give a name to the project (with no spaces) when prompted. Agents Toolkit will create the project with basic files and scaffolding. It will then open the project *in a second Visual Studio Code window*. Close the original Visual Studio Code window.
#### 7 **Note**

The project that's generated is configured to be installable on Excel, Outlook, PowerPoint, and Word. You can edit the manifest and source files as needed to change which Office applications are supported.

- 7. In the Visual Studio Code **TERMINAL** navigate to the root of the project and run npm install .
- 8. After the installation completes, verify that you can sideload your add-in from Visual Studio Code. The steps to sideload vary depending on the Office application on which you want to test the add-in.

### **Sideload in Excel, PowerPoint, or Word**

#### 7 **Note**

This section only applies if you are developing the add-in on a *Windows* computer.

- 1. Select **View** | **Run** in Visual Studio Code. In the **RUN AND DEBUG** dropdown menu, select one of these options:
	- **Excel Desktop (Edge Chromium)**
	- **PowerPoint Desktop (Edge Chromium)**
	- **Word Desktop (Edge Chromium)**
- 2. Press F5 . The project builds and a Node dev-server window opens. This process may take a couple of minutes. Eventually, the desktop version of the Office application you selected opens.

#### 7 **Note**

If this is the first time that you have sideloaded an Office Add-in on your computer (or the first time in over a month), you may be prompted to delete an old certificate and/or to install a new one. Agree to both prompts.


- 3. A **Contoso Add-in** tab with two buttons will appear on the **Home** ribbon. Use one button to perform an action in the open Office document. Use the other to open the add-in's task pane.
#### 7 **Note**

Regardless of which button you select, a **WebView Stop On Load** prompt appears. Select **OK**.

#### **Tip**

Sideloading in Office on Windows also makes the add-in available in Office on the web, so you can test it on that platform too. After this step is complete, minimize the Office on Windows application window and in a browser, navigate to https://excel.cloud.microsoft/ , https://word.cloud.microsoft/ , or https://powerpoint.cloud.microsoft/ , whichever is appropriate for the add-in you're testing. Open a new or existing document in the Office application on the web. The buttons should appear on the **Home** ribbon just as they do in Office on Windows.

- 4. To stop debugging and uninstall the add-in, select **Run** | **Stop Debugging** in Visual Studio Code.
#### 7 **Note**

If the preceding step seems to have no effect, uninstall the add-in by opening a **TERMINAL** in Visual Studio Code, and then running the command npm run stop . Closing the server window doesn't reliably stop the server and closing the Office application doesn't reliably cause Office to unacquire the add-in.

### **Other ways to sideload**

See Sideload Office Add-ins that use the unified manifest for Microsoft 365 for alternative ways to sideload an Excel, PowerPoint, or Word add-in, including through the app store in Teams.

## **Sideload in Outlook**

7 **Note**


If your development computer is Windows, be sure that your Outlook client is classic Outlook for Windows, not **[new Outlook on Windows](https://support.microsoft.com/office/656bb8d9-5a60-49b2-a98b-ba7822bc7627)** . There is currently a bug that prevents add-ins created with Agents Toolkit from properly sideloading in new Outlook for Windows or in Outlook on the web.

- 1. Ensure that your account in your Microsoft 365 developer tenancy is also an email account in desktop Outlook. If it isn't, follow the guidance in [Add an email account to](https://support.microsoft.com/office/e9da47c4-9b89-4b49-b945-a204aeea6726) [Outlook](https://support.microsoft.com/office/e9da47c4-9b89-4b49-b945-a204aeea6726) .
#### 2. **Close Outlook desktop**.

- 3. In Visual Studio Code, open Agents Toolkit.
- 4. In the **ACCOUNTS** section, verify that you're signed into Microsoft 365.
- 5. Select **View** | **Run** in Visual Studio Code. In the **RUN AND DEBUG** dropdown menu, select the option, **Outlook Desktop (Edge Chromium)**, and then press F5 . The project builds and a Node dev-server window opens. This process may take a couple of minutes and then Outlook desktop will open.

#### 7 **Note**

If this is the first time that you have sideloaded an Office Add-in on your computer (or the first time in over a month), you may be prompted to delete an old certificate and/or to install a new one. Agree to both prompts.

- 6. Open the **Inbox** *of your Microsoft 365 account identity* and open any message. A **Contoso Add-in** tab with two buttons will appear on the **Home** ribbon (or the **Message** ribbon, if you have opened the message in its own window).
- 7. Click the **Show Taskpane** button and a task pane opens. Click the **Perform an action** button and a small notification appears near the top of the message.

#### 7 **Note**

Regardless of which button you select, a **WebView Stop On Load** prompt appears. Select **OK**.

- 8. To stop debugging and uninstall the add-in, select **Run** | **Stop Debugging** in Visual Studio Code.


#### 7 **Note**

If the preceding step seems to have no effect, uninstall the add-in by opening a **TERMINAL** in Visual Studio Code, and then running the command npm run stop . Closing the server window doesn't reliably stop the server and closing the Office application doesn't reliably cause Office to unacquire the add-in.

## **Develop your project**

Now you can change and develop the project. In places where the guidance in the Office Addins documentation branches depending on what type of manifest is being used, be sure to follow the guidance for the unified manifest.

# **Import an add-in project to Microsoft 365 Agents Toolkit**

Article • 05/19/2025

The [Agents Toolkit extension for Visual Studio Code](https://learn.microsoft.com/en-us/microsoftteams/platform/toolkit/teams-toolkit-fundamentals) is a richly featured tool for working with extensions on the Microsoft 365 developer platform, including Teams apps, Office Add-ins, and Copilot extensions, among others. It also makes it easy to work with extensions that transcend the boundaries between Teams apps, add-ins, and Copilot extensions. For example, it makes sideloading such cross-boundary extensions easier.

There can be no algorithmic procedure for importing an add-in into the toolkit because an algorithm would have to make assumptions about the following aspects of the project.

- The folder and file structure of the existing add-in. But these structures vary depending on which tool was used to create the project and what version of that tool. The developer of the add-in might also have changed the structure after the project was created.
- The settings in various configuration files. But these settings also vary depending on how the project was created and changes made to the configuration since it was created.
- Which language, TypeScript or JavaScript, was used for the client-side source code of the web application.

However, we can make some general recommendations.

#### 7 **Note**

- This article doesn't apply to add-in projects that were created with Visual Studio. Such projects are based on the ASP.NET web application framework and are designed to run on Internet Information Server (IIS). Converting such a project to work in Agents Toolkit would significantly more difficult and is out-of-scope for this article.
- Add-in projects in Agents Toolkit must use the **unified manifest for Microsoft 365**. If your add-in project uses a feature that isn't yet supported with the unified manifest, then you can't import it to Agents Toolkit unless you first redesign it so that it doesn't use unsupported features.
- Currently, add-ins that use the unified manifest can't be sideloaded on a Mac. If your development computer is a Mac, don't import your project into Agents Toolkit until sideloading on the Mac is supported.


- Use the importation feature of the toolkit
- Start with a new toolkit project

Regardless of which you choose, begin by ensuring that you have installed [Visual Studio](https://code.visualstudio.com/) [Code](https://code.visualstudio.com/) and the [Agents Toolkit](https://learn.microsoft.com/en-us/microsoftteams/platform/toolkit/install-teams-toolkit) extension.

## **Use the importation feature of the toolkit**

There are four tasks to using the importation feature.

- Prepare the existing manifest
- Import the project
- Verify that the add-in can be sideloaded
- Post importation: Adjust the project structure as needed

## **Prepare the existing manifest**

#### ) **Important**

If the existing project uses the add-in only manifest, the importation feature automatically converts it to a unified manifest. So, you must carry out the steps in **Ensure that your manifest is ready to convert** before you import the project.

### **Import the project**

- 1. Open Visual Studio Code and select the Agents Toolkit icon on the **Activity Bar**.
- 2. Select **Create a New App**.
- 3. The **New Project** dropdown menu opens. The options listed vary depending on your version of Agents Toolkit. Select **Office Add-in**.


| New Project                                                                                                                                                                                                                                                                                                 |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Select an option                                                                                                                                                                                                                                                                                            |
| Declarative Agent<br>Agents for Microsoft 365 Copilot<br>Create your own agent by declaring instructions, actions, & knowledge to suit your needs                                                                                                                                                           |
| Custom Engine Agent<br>Build intelligent agent where you manage orchestration and provide your own LLM<br>Copilot Connector<br>Embed your organization data to make it searchable in Microsoft 365 Copilot                                                                                                  |
| Agent for Teams<br>Apps for Microsoft 365<br>Build an agent for Microsoft Teams easily using Teams Al Library<br>Teams app<br>Create your own web page, chat bot or message extensions for Microsoft Teams<br>Office Add-in<br>Extend Office ribbons or task pane to interact context in Office and Outlook |
| ? Don't know how to start? Use GitHub Copilot Chat<br>Chat with GitHub Copilot and get step-by-step instructions to develop your Teams app                                                                                                                                                                  |

- 4. The **App Features Using an Office Add-in** dropdown menu opens. The options listed vary depending on your version of Agents Toolkit. Select **Upgrade an Existing Office Add-in**.

| Select a capability                                                                                             |
|-----------------------------------------------------------------------------------------------------------------|
| Task pane<br>Customize the ribbon with a button and embed content in the task pane                              |
| Upgrade an Existing Office Add-in<br>Upgrade an add-in project to the latest app manifest and project structure |

- 5. In the **Existing add-in project folder** dropdown menu, browse to the root folder of the add-in project.
- 6. In the **Select import project manifest file** dropdown menu, browse to the add-in only manifest file, typically named **manifest.xml**.
- 7. In the **Workspace folder** dialog, select the folder where you want to put the converted project.
- 8. In the **Application name** dialog, give a name to the project (with no spaces). Agents Toolkit creates the project with your source files and scaffolding. It then opens the project *in a second Visual Studio Code window*. Close the original Visual Studio Code window.

### **Verify that the add-in can be sideloaded**


#### 7 **Note**

Add-ins that use the unified manifest can be sideloaded only on Office Version 2304 (Build 16320.20000) or later.

Sideload the add-in using the instructions at Sideload with Microsoft 365 Agents Toolkit.

If you encounter problems, as a troubleshooting step, try sideloading with a system prompt, bash shell, or terminal. If you can, then the problem is isolated to the toolkit.

It's possible that sideloading problems are the result of a file and folder structure, or configuration settings, that are different from what Agents Toolkit normally expects. See the section Post importation: Adjust the project structure and settings as needed.

## **Post importation: Adjust the project structure and settings as needed**

The importation process creates some folders and files that Visual Studio Code or Agents Toolkit need, but it doesn't reorganize your source files; such as HTML, JavaScript, and CSS files. It also doesn't change the content of any files in the project, including tool configuration files. We recommend that you change your project to match the pattern of projects that are created in Agents Toolkit. As you work, keep the following points in mind.

- HTML files in the toolkit projects don't have inline <script> elements. They only use <script> elements with a src attribute that loads an external file.
- Source files in a new toolkit project are in a folder named **\src**. Within this folder, the source files are further divided into subfolders based on the runtimes in which they normally are run. The following is a typical structure.

```
Console
\src
 \commands
 commands.html
 commands.js
 \taskpane
 taskpane.css
 taskpane.html
 taskpane.js
```
- Agents Toolkit projects have a folder named **\appPackage**. The manifest and any other files that should be in the app package zip file are in this folder.


#### ) **Important**

- The URLs in manifest will reflect the original structure of the project. Change these URLs as needed if you make changes in the file and folder structure.
- Tool configuration files, such as webpack.config.js, may have URLs. Change these as needed.

## **Start with a new toolkit project**

As an alternative to using the toolkit's importation feature, you can create a brand new add-in project in the toolkit and move files from the existing project into it and make changes to other files. The following are the tasks that you need to carry out.

- 1. If the existing project uses the add-in only manifest, convert it. See Convert an add-in to use the unified manifest for Microsoft 365.
- 2. Create a new add-in project in Agents Toolkit. For each choice the toolkit asks you to make, such as the choice between JavaScript and TypeScript, make the choice that best matches your existing add-in. See Create Office Add-in projects with Microsoft 365 Agents Toolkit.
- 3. Replace the manifest in the new project's **\appPackage** folder with your converted manifest.

#### 7 **Note**

If the conversion process produced any language string files, such as **fr-fr.json**, add these to the **\appPackage** folder.

- 4. Replace the files in the **\src** folder of the new project with the source files from your old project. To maximize compatibility with the configuration files in the new project, we recommend that you divide your source files into subfolders based on the runtimes in which they normally are run. For example, have separate folders for the source files of function commands, the taskpane, autorun events, and Excel custom functions.
- 5. Edit the manifest to ensure that any URLs in it are compatible with the new structure of the project.
- 6. Inspect the configuration files in the new project to ensure that they are compatible with the organization of the project.


#### **Tip**

When the old project and the new both have a configuration file with the same name (such as **babel.config.json**), use a file comparison ("diff") tool to find the differences. For each difference, determine which file is correct for the new project and change the file in the new project as needed.

- 7. The **webpack.config.js** is likely to need editing. It isn't possible to give universal rules for that file, but the following principles apply in most cases.
	- Ensure that URLs match the structure of the project.
	- Ensure that there is an entry subproperty for each subfolder under the **\src** folder.
	- Ensure that the plugins array also takes account of each subfolder under the **\src** folder.
	- Ensure that the extensions and rules properties take account of the file types in your project that should be handled by loaders and bundled.
- 8. Ensure that you can sideload the add-in in the new project. See Verify that the add-in can be sideloaded.

# **Develop Office Add-ins with Visual Studio Code**

Article • 08/20/2024

This article describes how to use [Visual Studio Code (VS Code)](https://code.visualstudio.com/) to develop an Office Add-in.

#### 7 **Note**

For information about using Visual Studio to create an Office Add-in, see **Develop Office Add-ins with Visual Studio**.

### **Prerequisites**

- [Visual Studio Code](https://code.visualstudio.com/)
- Node.js (the latest LTS version). Visit the [Node.js site](https://nodejs.org/) to download and install the right version for your operating system.
- The latest version of Yeoman and the Yeoman generator for Office Add-ins. To install these tools globally, run the following command via the command prompt.

command line

```
npm install -g yo generator-office
```
#### 7 **Note**

Even if you've previously installed the Yeoman generator, we recommend you update your package to the latest version from npm.

- Office connected to a Microsoft 365 subscription (including Office on the web).
#### 7 **Note**

If you don't already have Office, you might qualify for a Microsoft 365 E5 developer subscription through the **[Microsoft 365 Developer Program](https://aka.ms/m365devprogram)** ; for 


details, see the **[FAQ](https://learn.microsoft.com/en-us/office/developer-program/microsoft-365-developer-program-faq#who-qualifies-for-a-microsoft-365-e5-developer-subscription-)**. Alternatively, you can **[sign up for a 1-month free trial](https://www.microsoft.com/microsoft-365/try)** or **[purchase a Microsoft 365 plan](https://www.microsoft.com/microsoft-365/business/compare-all-microsoft-365-business-products-g)** .

## **Create the add-in project using the Yeoman generator**

If you're using VS Code as your integrated development environment (IDE), you should create the Office Add-in project with the Yeoman generator for Office Add-ins. The Yeoman generator creates a Node.js project that can be managed with VS Code or any other editor.

To create an Office Add-in with the Yeoman generator, follow instructions in the 5 minute quick start that corresponds to the type of add-in you'd like to create.

### **Develop the add-in using VS Code**

When the Yeoman generator finishes creating the add-in project, open the root folder of the project with VS Code.

#### **Tip**

On Windows, you can navigate to the root directory of the project via the command line and then enter code . to open that folder in VS Code. On Mac, you'll need to **[add the code command to the path](https://code.visualstudio.com/docs/setup/mac#_launching-from-the-command-line)** before you can use that command to open the project folder in VS Code.

The Yeoman generator creates a basic add-in with limited functionality. You can customize the add-in by editing the manifest, HTML, JavaScript or TypeScript, and CSS files in VS Code. For a high-level description of the project structure and files in the addin project that the Yeoman generator creates, see the Yeoman generator guidance within the 5-minute quick start that corresponds to the type of add-in you've created.

### **Create the add-in project using the Office Add-ins Development Kit (preview)**

The [Office Add-ins Development Kit](https://marketplace.visualstudio.com/items?itemName=msoffice.microsoft-office-add-in-debugger) is a Visual Studio Code extension that allows you to create new projects directly from VS Code. For information on installing the extension and creating projects from templates and samples, see Create Office Add-in projects using Office Add-ins Development Kit for Visual Studio Code.


#### ) **Important**

The Office Add-ins Development Kit extension is currently in preview. It only supports creating add-ins that use the **add-in only manifest**. It also only creates Excel, PowerPoint, and Word add-ins at this time. Support for Outlook is under development, as are additional samples and other improvements. We welcome any feedback you have on the tool. Issues and features requests should be submitted through **[GitHub issues on the extension's repo](https://aka.ms/officedevkitnewissue)** .

### **Test and debug the add-in**

Methods for testing, debugging, and troubleshooting Office Add-ins vary by platform. For more information, see Test and debug Office Add-ins.

### **Publish the add-in**

An Office Add-in consists of a web application and a manifest file. The web application defines the add-in's user interface and functionality, while the manifest specifies the location of the web application and defines settings and capabilities of the add-in.

While you're developing your add-in, you can run the add-in on your local web server ( localhost ), but when you're ready to publish it for other users to access, you'll need to deploy the web application to a web server or web hosting service (for example, Microsoft Azure) and update the manifest to specify the URL of the deployed application.

When your add-in is working as desired and you're ready to publish it for other users to access, complete the following steps.

- 1. From the command line, in the root directory of your add-in project, run the following command to prepare all files for production deployment.
command line npm run build

When the build completes, the **dist** folder in the root directory of your add-in project will contain the files that you'll deploy in subsequent steps.

- 2. Upload the contents of the **dist** folder to the web server that'll host your add-in. You can use any type of web server or web hosting service to host your add-in.


- 3. In VS Code, open the add-in's manifest file, located in the root directory of the project ( manifest.xml ). Replace all occurrences of https://localhost:3000 with the URL of the web application that you deployed to a web server in the previous step.
- 4. Choose the method you'd like to use to deploy your Office Add-in, and follow the instructions to publish the manifest file.

### **See also**

- Core concepts for Office Add-ins
- Develop Office Add-ins
- Design Office Add-ins
- Test and debug Office Add-ins
- Publish Office Add-ins


# **Develop Office Add-ins with Visual Studio**

Article • 08/18/2023

This article describes how to use Visual Studio to develop an Office Add-in. If you've already created your add-in, you can skip ahead to the Develop the add-in using Visual Studio section.

#### 7 **Note**

As an alternative to using Visual Studio, you may choose to use the Yeoman generator for Office Add-ins and VS Code to create an Office Add-in. For more information about this choice, see **Creating an Office Add-in**.

### **Create the add-in project using Visual Studio**

Visual Studio can be used to create Office Add-ins for Excel, Outlook, PowerPoint, and Word. An Office Add-in project gets created as part of a Visual Studio solution and uses HTML, CSS, and JavaScript. To create an Office Add-in with Visual Studio, follow instructions in the quick start that corresponds to the add-in you'd like to create.

- Excel quick start
- Outlook quick start
- PowerPoint quick start
- Word quick start

Visual Studio doesn't support creating Office Add-ins for OneNote or Project. To create Office Add-ins for either of these applications, you'll need to use the Yeoman generator for Office Add-ins, as described in the OneNote quick start or the Project quick start.

## **Develop the add-in using Visual Studio**

Visual Studio creates a basic add-in with limited functionality. You can customize the add-in by editing the manifest, HTML, JavaScript, and CSS files in Visual Studio. For a high-level description of the project structure and files in the add-in project that Visual Studio creates, see the Visual Studio guidance within the quick start that you completed to create your add-in.


Because an Office Add-in is a web application, you'll need at least basic web development skills to customize your add-in. If you're new to JavaScript, we

recommend reviewing the **[Mozilla JavaScript tutorial](https://developer.mozilla.org/docs/Web/JavaScript/Guide/Introduction)** .

To customize your add-in, you'll need to understand concepts described in the Core concepts > Develop area of this documentation, as well as concepts described in the application-specific area of documentation that corresponds to the add-in you're building (for example, Excel).

## **Test and debug the add-in**

Methods for testing, debugging, and troubleshooting Office Add-ins vary by platform. For more information, see Debug Office Add-ins in Visual Studio and Test and debug Office Add-ins.

## **Publish the add-in**

An Office Add-in consists of a web application and a manifest file. The web application defines the add-in's user interface and functionality, while the manifest specifies the location of the web application and defines settings and capabilities of the add-in.

While you're developing your add-in in Visual Studio, your add-in runs on your local web server ( localhost ). When your add-in is working as desired and you're ready to publish it for other users to access, you'll need to complete the following steps.

- 1. Deploy the web application to a web server or web hosting service (for example, Microsoft Azure).
- 2. Update the manifest to specify the URL of the deployed application.
- 3. Choose the method you'd like to use to deploy your Office Add-in, and follow the instructions to publish the manifest file.

## **See also**

- Core concepts for Office Add-ins
- Develop Office Add-ins
- Design Office Add-ins
- Test and debug Office Add-ins
- Publish Office Add-ins

#### **Tip**

# **Office versions and requirement sets**

Article • 03/12/2025

There are many versions of Office on several platforms, and they don't all support every API in Office JavaScript API (Office.js). Office 2013 on Windows was the earliest version of Office that supported Office Add-ins. You may not always have control over the version of Office your users have installed. To handle this situation, we provide a system called requirement sets to help you determine whether an Office application supports the capabilities you need in your Office Add-in.

#### 7 **Note**

- Office runs across multiple platforms, including Windows, in a browser, Mac, and iPad.
- Examples of Office applications are Office products: Excel, Word, PowerPoint, Outlook, OneNote, and so forth.
- Office is available by a Microsoft 365 subscription or perpetual license. The perpetual version is available by volume-licensing agreement or retail.
- A requirement set is a named group of API members, for example, ExcelApi 1.5 , WordApi 1.3 , and so on.

### **How to check your Office version**

To identify the Office version that you're using, from within an Office application, select the **File** menu, and then choose **Account**. The version of Office appears in the **Product Information** section. For example, the following screenshot indicates Office Version 1802 (Build 9026.1000).


If your version of Office is different from this, see **[What version of Outlook do I](https://support.microsoft.com/office/b3a9568c-edb5-42b9-9825-d48d82b2257c) [have?](https://support.microsoft.com/office/b3a9568c-edb5-42b9-9825-d48d82b2257c)** or **[About Office: What version of Office am I using?](https://support.microsoft.com/topic/932788b8-a3ce-44bf-bb09-e334518b8b19)** to understand how to get this information for your version.

## **Deployment**

How your add-in is deployed can affect your add-in's availability on the various platforms and clients. To learn more about deployment options, see Deploy and publish Office Add-ins.

## **Office requirement sets availability**

Office Add-ins can use API requirement sets to determine whether the Office application supports the API members that it need to use. Requirement set support varies by Office application and the Office application version (see earlier section How to check your Office version).

Some Office applications have their own API requirement sets. For example, the first requirement set for the Excel API was ExcelApi 1.1 and the first requirement set for the Word API was WordApi 1.1 . Since then, multiple new ExcelApi requirement sets and WordApi requirement sets have been added to provide additional API functionality.

In addition, other functionality such as add-in commands (ribbon extensibility) and the ability to launch dialog boxes (Dialog API) were added to the Common API. Add-in commands and Dialog API requirement sets are examples of API sets that various Office applications share in common.

An add-in can only use APIs in requirement sets that are supported by the version of Office application where the add-in is running. To know exactly which requirement sets are available for a specific Office application version, refer to the following applicationspecific requirement set articles.

- [Excel JavaScript API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/excel/excel-api-requirement-sets) (ExcelApi)
- [OneNote JavaScript API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/onenote/onenote-api-requirement-sets) (OneNoteApi)
- [Outlook JavaScript API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets) (Mailbox)
- [PowerPoint JavaScript API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/powerpoint/powerpoint-api-requirement-sets) (PowerPointApi)
- [Word JavaScript API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/word/word-api-requirement-sets) (WordApi)

Some requirement sets contain APIs that can be used by several Office applications. For information about these requirement sets, see [Office Common API requirement sets.](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/office-add-in-requirement-sets)


The version number of a requirement set, such as the "1.1" in ExcelApi 1.1 , is relative to the Office application. The version number of a given requirement set (e.g., ExcelApi 1.1 ) does not correspond to the version number of Office.js or to requirement sets for other Office applications (e.g., Word, Outlook, etc.). Requirement sets for the different Office applications are released at different rates. For example, ExcelApi 1.5 was released before the WordApi 1.3 requirement set.

The Office JavaScript API library (Office.js) includes all requirement sets that are currently available. While there is such a thing as requirement sets ExcelApi 1.3 and WordApi 1.3 , there is no Office.js 1.3 requirement set. The latest release of Office.js is maintained as a single Office endpoint delivered via the content delivery network (CDN). For more details around the Office.js CDN, including how versioning and backward compatibility is handled, see Understanding the Office JavaScript API.

## **Specify Office applications and requirement sets**

There are various ways to specify which Office applications and requirement sets are required by an add-in. For detailed information, see Specify Office applications and API requirements

### **See also**

- Specify Office applications and API requirements
- Install the latest version of Office
- [Overview of update channels for Microsoft 365 Apps](https://learn.microsoft.com/en-us/deployoffice/overview-of-update-channels-for-office-365-proplus)
- [Reimagine productivity with Microsoft 365 and Microsoft Teams](https://www.microsoft.com/microsoft-365/buy/compare-all-microsoft-365-products)


# **Requirements for running Office Add-ins**

08/13/2025

This article describes the software and device requirements for running Office Add-ins.

#### 7 **Note**

If you plan to **publish** your add-in to AppSource and make it available within the Office experience, make sure that you conform to the **Commercial marketplace certification policies**. For example, to pass validation, your add-in must work across all platforms that support the methods that you define (for more information, see **section 1120.3** and the **[Office Add-in application and availability page](https://learn.microsoft.com/en-us/javascript/api/requirement-sets)**).

For a high-level view of where Office Add-ins are currently supported, see [Office client](https://learn.microsoft.com/en-us/javascript/api/requirement-sets) [application and platform availability for Office Add-ins](https://learn.microsoft.com/en-us/javascript/api/requirement-sets).

### **Server requirements**

To be able to install and run any Office Add-in, you first need to deploy the manifest and webpage files for the UI and code of your add-in to the appropriate server locations.

For all types of add-ins (content, Outlook, and task pane add-ins and add-in commands), you need to deploy your add-in's webpage files to a web server, or web hosting service, such as Microsoft Azure.

While not strictly required in all add-in scenarios, using an HTTPS endpoint for your add-in is strongly recommended. Add-ins that are not SSL-secured (HTTPS) generate unsecure content warnings and errors during use. If you plan to run your add-in in Office on the web or publish your add-in to AppSource, it must be SSL-secured. If your add-in accesses external data and services, it should be SSL-secured to protect data in transit. Self-signed certificates can be used for development and testing, so long as the certificate is trusted on the local machine.

#### **Tip**

When you develop and debug an add-in in Visual Studio, Visual Studio deploys and runs your add-in's webpage files locally with IIS Express, and doesn't require an additional web server.

For content and task pane add-ins, in the supported Office client applications - Excel, PowerPoint, Project, or Word - you also need either an app catalog on SharePoint to upload 


the add-in's XML-formatted add-in only manifest file, or you need to deploy the add-in using the [integrated apps portal.](https://learn.microsoft.com/en-us/microsoft-365/admin/manage/test-and-deploy-microsoft-365-apps)

To test and run an Outlook add-in, the user's Outlook email account must reside on Exchange 2016 or later, which is available through Microsoft 365, Exchange Online, or through an onpremises installation. The user or administrator installs manifest files for Outlook add-ins on that server. For Exchange on-premises installations, the following requirements apply.

- The server must be Exchange 2016 or later.
- Exchange Web Services (EWS) must be enabled and must be exposed to the Internet. Many add-ins require EWS to function properly.
- The server must have a valid authentication certificate in order for the server to issue valid identity tokens. New installations of Exchange Server include a default authentication certificate. For more information, see [Digital certificates and encryption in Exchange 2016](https://learn.microsoft.com/en-us/Exchange/architecture/client-access/certificates) and [Set-AuthConfig](https://learn.microsoft.com/en-us/powershell/module/exchangepowershell/set-authconfig).
- To access add-ins from [AppSource](https://appsource.microsoft.com/marketplace/apps?product=office) , the client access servers must be able to communicate with AppSource.

7 **Note**

POP3 and IMAP email accounts in Outlook don't support Office Add-ins.

## **Client requirements: Windows desktop and tablet**

The following software is required for developing an Office Add-in for the supported Office desktop clients or web clients that run on Windows-based desktop, laptop, or tablet devices.

- For Windows x86 and x64 desktops, and tablets such as Surface Pro:
	- The 32- or 64-bit version of Office 2016 or a later version, running on Windows 7 or a later version.
	- Excel 2016, Outlook 2016, PowerPoint 2016, Project Professional 2016, Project 2016, Word 2016, or a later version of the Office client, if you're testing or running an Office Add-in specifically for one of these Office desktop clients. Office desktop clients can be installed on premises or via Click-to-Run on the client computer.

If you have a valid Microsoft 365 subscription and you don't have access to the Office client, you can [download and install the latest version of Office](https://support.microsoft.com/office/4414eaaf-0478-48be-9c42-23adc4716658) .

- Microsoft Edge must be installed, but doesn't have to be the default browser. To support Office Add-ins, the Office client that acts as host uses webview components that are part of Microsoft Edge.


#### 7 **Note**

- Strictly speaking, it's possible to develop add-ins on a machine that has Internet Explorer 11 (IE11) installed, but not Microsoft Edge. However, IE11 is used to run add-ins only on certain older combinations of Windows and Office versions. See **Browsers and webview controls used by Office Add-ins** for more details. We don't recommend using such old environments as your primary add-in development environment. However, if you're likely to have customers of your add-in that are working in these older combinations, we recommend that you support the Trident webview that's provided by Internet Explorer. For more information, see **Support older Microsoft webviews and Office versions**.
- Internet Explorer's Enhanced Security Configuration (ESC) must be turned off for Office Web Add-ins to work. If you are using a Windows Server computer as your client when developing add-ins, note that ESC is turned on by default in Windows Server.
- One of the following as the default browser: Internet Explorer 11, or the latest version of Microsoft Edge, Chrome, Firefox, or Safari (Mac OS).
- An HTML and JavaScript editor such as [Visual Studio Code](https://code.visualstudio.com/) , [Visual Studio and the](https://www.visualstudio.com/features/office-tools-vs) [Microsoft Developer Tools](https://www.visualstudio.com/features/office-tools-vs) , or non-Microsoft web development tool.

## **Client requirements: OS X desktop**

Outlook on Mac, which is distributed as part of Microsoft 365, supports Outlook add-ins. Running Outlook add-ins in Outlook on Mac has the same requirements as Outlook on Mac itself: the operating system must be at least OS X v10.10 "Yosemite". Because Outlook on Mac uses WebKit as a layout engine to render the add-in pages, there is no additional browser dependency.

The following are the minimum client versions of Office on Mac that support Office Add-ins.

- Word version 15.18 (160109)
- Excel version 15.19 (160206)
- PowerPoint version 15.24 (160614)

## **Client requirements: Browser support for Office web clients and SharePoint**


Any browser, except Internet Explorer, that supports ECMAScript 5.1, HTML5, and CSS3, such as Microsoft Edge, Chrome, Firefox, or Safari (Mac OS).

## **Client requirements: Non-Windows smartphone and tablet**

Specifically for Outlook running on smartphones and non-Windows tablet devices, the following software is required for testing and running Outlook add-ins.

ノ **Expand table**

| Office<br>application                  | Device                                                              | Operating<br>system                                    | Exchange account                                                                    | Mobile browser                                                        |
|----------------------------------------|---------------------------------------------------------------------|--------------------------------------------------------|-------------------------------------------------------------------------------------|-----------------------------------------------------------------------|
| Outlook on<br>the web<br>1<br>(modern) | iPad 2 or later<br>Android<br>tablets                               | iOS 5 or<br>later<br>Android<br>4.4 KitKat<br>or later | On Microsoft 365,<br>Exchange Online                                                | Microsoft Edge<br>Chrome<br>Firefox<br>Safari                         |
| Outlook on<br>the web<br>(classic)     | iPhone 4 or<br>later<br>iPad 2 or later<br>iPod Touch 4<br>or later | iOS 5 or<br>later                                      | On on-premises<br>Exchange Server<br>2<br>2016 or later                             | Safari                                                                |
| Outlook on<br>Android                  | Android<br>tablets<br>Android<br>smartphones                        | Android<br>4.4 KitKat<br>or later                      | On the latest update<br>of Microsoft 365<br>Apps for business or<br>Exchange Online | Browser not<br>applicable. Use the<br>native app for<br>3<br>Android. |
| Outlook on<br>iOS                      | iPad tablets<br>iPhone<br>smartphones                               | iOS 11 or<br>later<br>iPadOS 13<br>or later            | On the latest update<br>of Microsoft 365<br>Apps for business or<br>Exchange Online | Browser not<br>applicable. Use the<br>3<br>native app for iOS.        |

#### 7 **Note**

 Modern Outlook on the web on iPhone and Android smartphones is no longer required or available for testing Outlook add-ins. 1


 Add-ins aren't supported in Outlook on Android, on iOS, and modern mobile web with on-premises Exchange accounts. 2

 OWA for Android, OWA for iPad, and OWA for iPhone native apps have been **[deprecated](https://support.microsoft.com/office/076ec122-4576-4900-bc26-937f84d25a4b)** . 3

#### **Tip**

You can distinguish between classic and modern Outlook in a web browser by checking your mailbox toolbar.

#### **modern**

### **See also**

- Office Add-ins platform overview
- [Office client application and platform availability for Office Add-ins](https://learn.microsoft.com/en-us/javascript/api/requirement-sets)
- Browsers and webview controls used by Office Add-ins


# **Install the latest version of Office**

Article • 09/24/2024

New developer features, including those still in preview, are delivered first to subscribers who opt in to get the latest builds of Office.

## **Opt in to getting the latest builds of Office**

- If you're a Microsoft 365 Family, Personal, or University subscriber, see [Be a](https://aka.ms/MSFT365InsiderHandbook) [Microsoft 365 Insider](https://aka.ms/MSFT365InsiderHandbook) .
- If you're a Microsoft 365 Apps for business customer, see [Microsoft 365 Insider for](https://learn.microsoft.com/en-us/microsoft-365-apps/insider/) [Business.](https://learn.microsoft.com/en-us/microsoft-365-apps/insider/)
- If you're running Office on a Mac:
	- Start an Office application.
	- Select **Check for Updates** on the Help menu.
	- In the Microsoft AutoUpdate box, check the box to join the Microsoft 365 Insider program.

## **Get the latest build of Office**

- 1. Download the [Office Deployment Tool](https://www.microsoft.com/download/details.aspx?id=49117) .
- 2. Run the tool. This extracts a **setup.exe** and configuration files.
- 3. Create a new file named **configuration.xml** and add the following XML.

```
<Configuration>
 <Add OfficeClientEdition="32" Branch="CurrentPreview">
 <Product ID="O365ProPlusRetail">
 <Language ID="en-us" />
 </Product>
 </Add>
 <Updates Enabled="TRUE" />
 <Display Level="None" AcceptEULA="TRUE" /> 
</Configuration>
```
- 4. Run the following command as an administrator.
command line

XML


setup.exe /configure configuration.xml

#### 7 **Note**

The command might take a long time to run without indicating progress.

When the installation process finishes, you'll have the latest Office applications installed. To verify that you have the latest build, go to **File** > **Account** from any Office application. Under the About section, you'll see the version and build number, along with Current Channel (Preview). The Microsoft 365 Insider section is displayed or hidden for business customers depending on their company's settings.

| Product Information        | Microsoft                                                                   |
|----------------------------|-----------------------------------------------------------------------------|
|                            |                                                                             |
| This product contains      |                                                                             |
|                            |                                                                             |
| P                          |                                                                             |
|                            |                                                                             |
| Update<br>Options *        |                                                                             |
|                            | Microsoft 365 Insider                                                       |
|                            | ■<br>You're signed up for Current Channel (Preview).                        |
| Microsoft 365<br>Insider × | You will receive new builds of Microsoft 365 apps once or twice a<br>month. |
|                            | About                                                                       |
|                            | Support, Product ID, and Copyright information.<br>Learn more about         |
|                            | Version 2409 (Build 18025.20058 Click-to-Run)                               |
| About                      | Current Channel (Preview)                                                   |

## **Minimum Office builds for Office JavaScript API requirement sets**

- [Excel JavaScript API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/excel/excel-api-requirement-sets)


- [OneNote JavaScript API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/onenote/onenote-api-requirement-sets)
- [Outlook JavaScript API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/outlook/outlook-api-requirement-sets)
- [PowerPoint JavaScript API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/powerpoint/powerpoint-api-requirement-sets)
- [Word JavaScript API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/word/word-api-requirement-sets)
- [Dialog API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/dialog-api-requirement-sets)
- [Office Common API requirement sets](https://learn.microsoft.com/en-us/javascript/api/requirement-sets/common/office-add-in-requirement-sets)


# **Browsers and webview controls used by Office Add-ins**

Article • 10/17/2024

Office Add-ins are web applications that are displayed using iframes when running in Office on the web. In Office for desktop and mobile clients, Office Add-ins use an embedded browser control (also known as a webview). Add-ins also need a JavaScript engine to run the JavaScript. Both the embedded browser and the engine are supplied by a browser installed on the user's computer. In this article, "webview" refers to the combination of a webview control and a JavaScript engine.

Which webview is used depends on:

- The computer's operating system.
- Whether the add-in is running in Office on the web, in Office downloaded from a Microsoft 365 subscription, or in perpetual Office 2016 or later.
- Within the perpetual versions of Office on Windows, whether the add-in is running in the "retail" or "volume-licensed" variation.

#### ) **Important**

#### **Webviews from Internet Explorer and Microsoft Edge Legacy are still used in Office Add-ins**

Some combinations of platforms and Office versions, including volume-licensed perpetual versions through Office 2019, still use the webview controls that come with Internet Explorer 11 (called "Trident") and Microsoft Edge Legacy (called "EdgeHTML") to host add-ins, as explained in this article. Internet Explorer 11 was disabled in Windows 10 and Windows 11 in February 2023, and the UI for launching it was removed; but it's still installed on those operating systems. So, Trident and other functionality from Internet Explorer can still be called programmatically by Office.

We recommend (but don't require) that you continue to support these combinations, at least in a minimal way, by providing users of your add-in a graceful failure message when your add-in is launched in one of these webviews. Keep these additional points in mind:

- Office on the web no longer opens in Internet Explorer or Microsoft Edge Legacy. Consequently, **[AppSource](https://learn.microsoft.com/en-us/partner-center/marketplace-offers/submit-to-appsource-via-partner-center)** doesn't test add-ins in Office on these web


browsers.

- AppSource still tests for combinations of platform and Office *desktop* versions that use Trident or EdgeHTML. However, it only issues a warning when the add-in doesn't support these webviews; the add-in isn't rejected by AppSource.
- The **Script Lab tool** no longer supports Trident.

For more information about supporting Trident or EdgeHTML, including configuring a graceful failure message on your add-in, see **Support older Microsoft webviews and Office versions**.

The following sections specify which browser is used for the various platforms and operating systems.

### **Non-Windows platforms**

For these platforms, the platform alone determines the browser that's used.

ノ **Expand table**

| OS      | Office version    | Browser                                                                                                                                                                 |
|---------|-------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| any     | Office on the web | The browser in which Office is opened.<br>(But note that Office on the web will not open in Internet Explorer.<br>Attempting to do so opens Office on the web in Edge.) |
| Mac     | any               | Safari with WKWebView                                                                                                                                                   |
| iOS     | any               | Safari with WKWebView                                                                                                                                                   |
| Android | any               | Chrome                                                                                                                                                                  |

#### ) **Important**

**[Conditional Access](https://learn.microsoft.com/en-us/azure/active-directory/conditional-access/overview)** isn't supported for Office Add-ins on iOS or Android. Those add-ins use the Safari-based WKWebView or the Android-based WebView, not an Edge-based browser control.

### **Windows**

An add-in running on Windows might use any of three different webviews:


- **WebView2**, which is provided by Microsoft Edge (Chromium-based).
- **EdgeHTML**, which is provided by Microsoft Edge Legacy.
- **Trident+**, which is provided by Internet Explorer 11. The "+" on the end indicates that Office Add-ins use additional functionality from Internet Explorer 11 that isn't built into Trident itself.

#### **Perpetual versions of Office on Windows**

For perpetual versions of Office on Windows, the browser that's used is determined by the Office version, whether the license is retail or volume-licensed, and whether the Edge WebView2 (Chromium-based) is installed. The version of Windows doesn't matter, but note that Office Add-ins aren't supported on versions earlier than Windows 7 and Office 2021 and later aren't supported on versions earlier than Windows 10.

To determine whether Office 2016 or Office 2019 is retail or volume-licensed, use the format of the Office version and build number. (For Office 2021 and later, the distinction between volume-licensed and retail doesn't matter.)

- **Retail**: For both Office 2016 and 2019, the format is YYMM (xxxxx.xxxxxx) , ending with two blocks of five digits; for example, 2206 (Build 15330.20264) .
- **Volume-licensed**:
	- For Office 2016, the format is 16.0.xxxx.xxxxx , ending with two blocks of *four* digits; for example, 16.0.5197.1000 .
	- For Office 2019, the format is 1808 (xxxxx.xxxxxx) , ending with two blocks of *five* digits; for example, 1808 (Build 10388.20027) . Note that the year and month is always 1808 .

ノ **Expand table**

| Office      | Retail vs. Volume | WebView2   | Browser                                                                                                          |
|-------------|-------------------|------------|------------------------------------------------------------------------------------------------------------------|
| version     | licensed          | installed? |                                                                                                                  |
| Office 2024 | Doesn't matter    | 1<br>Yes   | 2<br>WebView2 (Microsoft Edge Chromium<br>based)                                                                 |
| Office 2021 | Doesn't matter    | 1<br>Yes   | 2<br>WebView2 (Microsoft Edge Chromium<br>based)                                                                 |
| Office 2019 | Retail            | 1<br>Yes   | 2<br>WebView2 (Microsoft Edge Chromium<br>based)                                                                 |
| Office 2019 | Retail            | No         | 2, 3<br>EdgeHTML (Microsoft Edge Legacy)<br>If Edge isn't installed, Trident+ (Internet<br>Explorer 11) is used. |


| Office      | Retail vs. Volume | WebView2       | Browser                                                                                                          |
|-------------|-------------------|----------------|------------------------------------------------------------------------------------------------------------------|
| version     | licensed          | installed?     |                                                                                                                  |
| Office 2019 | Volume-licensed   | Doesn't matter | Trident+ (Internet Explorer 11)                                                                                  |
| Office 2016 | Retail            | 1<br>Yes       | 2<br>WebView2 (Microsoft Edge Chromium<br>based)                                                                 |
| Office 2016 | Retail            | No             | 2, 3<br>EdgeHTML (Microsoft Edge Legacy)<br>If Edge isn't installed, Trident+ (Internet<br>Explorer 11) is used. |
| Office 2016 | Volume-licensed   | Doesn't matter | Trident+ (Internet Explorer 11)                                                                                  |

 On Windows versions prior to Windows 11, the WebView2 control must be installed so that Office can embed it. It's installed with perpetual Office 2021 or later; but it isn't automatically installed with Microsoft Edge. If you have an earlier version of perpetual Office, use the instructions for installing the control at [Microsoft Edge WebView2 /](https://developer.microsoft.com/microsoft-edge/webview2/) [Embed web content ... with Microsoft Edge WebView2](https://developer.microsoft.com/microsoft-edge/webview2/). 1

 When you use either EdgeHTML or WebView2, the Windows Narrator (sometimes called a "screen reader") reads the <title> tag in the page that opens in the task pane. In Trident+, the Narrator reads the title bar of the task pane, which comes from the addin name that's specified in the add-in's manifest. 2

 If your add-in uses an add-in only manifest and includes the **<Runtimes>** element in the manifest or it uses the unified manifest and it includes an "extensions.runtimes.lifetime" property, then it won't use EdgeHTML. If the conditions for using WebView2 are met, then the add-in uses WebView2. Otherwise, it uses Trident+. For more information, see [Runtimes](https://learn.microsoft.com/en-us/javascript/api/manifest/runtimes) and [Configure your Outlook add-in for](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/autolaunch?tabs=jsonmanifest) [event-based activation](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/autolaunch?tabs=jsonmanifest). 3

#### **Microsoft 365 subscription versions of Office on Windows**

For subscription Office on Windows, the browser that's used is determined by the operating system, the Office version, and whether the WebView2 control is installed.

#### ノ **Expand table**

| OS                                      | Office version                              | WebView2<br>installed? | Browser                             |
|-----------------------------------------|---------------------------------------------|------------------------|-------------------------------------|
| Windows 11<br>Windows 10<br>Windows 8.1 | 1<br>Microsoft 365 ver. >= 16.0.13530.20424 | 2<br>Yes               | WebView2<br>(Microsoft<br>3<br>Edge |


| OS                                                                         | Office version                                                  | WebView2<br>installed? | Browser                                           |
|----------------------------------------------------------------------------|-----------------------------------------------------------------|------------------------|---------------------------------------------------|
| Windows<br>Server 2022<br>Windows<br>Server 2019<br>Windows<br>Server 2016 |                                                                 |                        | Chromium<br>based)                                |
| Window 11<br>Windows 10<br>ver. >= 1903                                    | 1<br>Microsoft 365 ver. >= 16.0.13530.20424                     | No                     | EdgeHTML<br>(Microsoft<br>Edge<br>3, 4<br>Legacy) |
| Windows 11<br>Windows 10<br>ver. >= 1903                                   | Microsoft 365<br>1<br>ver. >= 16.0.11629 AND < 16.0.13530.20424 | Doesn't<br>matter      | EdgeHTML<br>(Microsoft<br>Edge<br>3, 4<br>Legacy) |
| Windows 11<br>Windows 10<br>ver. >= 1903                                   | 1<br>Microsoft 365 ver. < 16.0.11629                            | Doesn't<br>matter      | Trident+<br>(Internet<br>Explorer 11)             |
| Windows 10<br>ver. < 1903<br>Windows 8.1                                   | Microsoft 365                                                   | No                     | Trident+<br>(Internet<br>Explorer 11)             |
| Windows 7                                                                  | Microsoft 365                                                   | Doesn't<br>matter      | Trident+<br>(Internet<br>Explorer 11)             |

 See the [update history page](https://learn.microsoft.com/en-us/officeupdates/update-history-office365-proplus-by-date) and how to [find your Office client version and update](https://support.microsoft.com/office/932788b8-a3ce-44bf-bb09-e334518b8b19) [channel](https://support.microsoft.com/office/932788b8-a3ce-44bf-bb09-e334518b8b19) for more details. 1

 On Windows versions prior to Windows 11, the WebView2 control must be installed so that Office can embed it. It's installed with Microsoft 365, Version 2101 or later, but it isn't automatically installed with Microsoft Edge. If you have an earlier version of Microsoft 365, use the instructions for installing the control at [Microsoft Edge](https://developer.microsoft.com/microsoft-edge/webview2/) [WebView2 / Embed web content ... with Microsoft Edge WebView2.](https://developer.microsoft.com/microsoft-edge/webview2/) On Microsoft 365 builds before 16.0.14326.xxxxx, you must also create the registry key **HKEY_CURRENT_USER\SOFTWARE\Microsoft\Office\16.0\WEF\Win32WebView2** and set its value to dword:00000001 . 2

 When you use either EdgeHTML or WebView2, the Windows Narrator (sometimes called a "screen reader") reads the <title> tag in the page that opens in the task pane. 3


In Trident+, the Narrator reads the title bar of the task pane, which comes from the addin name that's specified in the add-in's manifest.

 If your add-in uses an add-in only manifest and includes the **<Runtimes>** element in the manifest or it uses the unified manifest and it includes an "extensions.runtimes.lifetime" property, then it won't use EdgeHTML. If the conditions for using WebView2 are met, then the add-in uses WebView2. Otherwise, it uses Trident+. For more information, see [Runtimes](https://learn.microsoft.com/en-us/javascript/api/manifest/runtimes) and [Configure your Outlook add-in for](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/autolaunch?tabs=jsonmanifest) [event-based activation](https://learn.microsoft.com/en-us/office/dev/add-ins/outlook/autolaunch?tabs=jsonmanifest). 4

## **Working with Trident+ (Internet Explorer 11)**

Trident+ doesn't support JavaScript versions later than ES5. If any of your add-in's users have platforms that use Trident+, then to use the syntax and features of ECMAScript 2015 or later, you have two options.

- Write your code in ECMAScript 2015 (also called ES6) or later JavaScript, or in TypeScript, and then compile your code to ES5 JavaScript using a compiler such as [babel](https://babeljs.io/) or [tsc](https://www.typescriptlang.org/index.html) .
- Write in ECMAScript 2015 or later JavaScript, but also load a [polyfill](https://en.wikipedia.org/wiki/Polyfill_(programming)) library such as [core-js](https://github.com/zloirock/core-js) that enables IE to run your code.

For more information about these options, see Support older Microsoft webviews and Office versions.

Also, Trident+ doesn't support some HTML5 features such as media, recording, and location. To learn more, see Determine the webview the add-in is running in at runtime.

## **Troubleshoot EdgeHTML and WebView2 (Microsoft Edge) issues**

#### **Service Workers aren't working**

Office Add-ins don't support Service Workers when EdgeHTML is used. They're supported with WebView2.

#### **Scroll bar doesn't appear in task pane**

By default, scroll bars in EdgeHTML and WebView2 are hidden until hovered over. To ensure that the scroll bar is always visible, the CSS styling that applies to the <body>


element of the pages in the task pane should include the [-ms-overflow-style](https://devdoc.net/web/developer.mozilla.org/en-US/docs/Web/CSS/-ms-overflow-style.html) property and it should be set to scrollbar .

#### **When debugging with the Microsoft Edge DevTools, the add-in crashes or reloads**

Setting breakpoints in the [Microsoft Edge DevTools](https://apps.microsoft.com/detail/9mzbfrmz0mnj) for EdgeHTML can cause Office to think that the add-in is hung. It will automatically reload the add-in when this happens. To prevent this, add the following Registry key and value to the development computer: [HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Office\16.0\Wef]"AlertInterval"=dword:000000 00 .

#### **When the add-in tries to open, get "ADD-IN ERROR We can't open this add-in from the localhost" error**

One known cause is that EdgeHTML requires that localhost be given a loopback exemption on the development computer. Follow the instructions at [Cannot open add](https://learn.microsoft.com/en-us/office/troubleshoot/error-messages/cannot-open-add-in-from-localhost)[in from localhost.](https://learn.microsoft.com/en-us/office/troubleshoot/error-messages/cannot-open-add-in-from-localhost)

#### **Get errors trying to download a PDF file**

Directly downloading blobs as PDF files in an add-in isn't supported with EdgeHTML or WebView2. The workaround is to create a simple web application that downloads blobs as PDF files. In your add-in, call the Office.context.ui.openBrowserWindow(url) method and pass the URL of the web application. This will open the web application in a browser window outside of Office.

### **WIP-protected documents**

There's an extra step needed for Add-ins to run in a document with [WIP (Windows](https://learn.microsoft.com/en-us/windows/uwp/enterprise/wip-hub) [Information Protection)](https://learn.microsoft.com/en-us/windows/uwp/enterprise/wip-hub) and use **WebView2 (Microsoft Edge Chromium-based)**. Add the WebView2 process, **msedgewebview2.exe**, to the protected apps list in your enterprise's WIP policy. An admin [adds this WIP policy through Intune](https://learn.microsoft.com/en-us/mem/intune/apps/windows-information-protection-policy-create#to-add-a-wip-policy) with the following values.

- **Name**: Webview2
- **Publisher**: O=MICROSOFT CORPORATION, L=REDMOND, S=WASHINGTON, C=US
- **Product Name**: MICROSOFT EDGE WEBVIEW2
- **File**: MSEDGEWEBVIEW2.EXE
- **Min Version**: *


- **Max Version**: *
If the WIP policy hasn't been added, the add-in defaults to an older runtime. In the sections Perpetual versions of Office on Windows and Microsoft 365 subscription versions of Office on Windows earlier in this article, substitute **EdgeHTML (Microsoft Edge Legacy)** for **WebView2 (Microsoft Edge Chromium-based)** wherever the latter appears.

To determine if a document is WIP-protected, follow these steps.

- 1. Open the file.
- 2. Select the **File** tab on the ribbon.
- 3. Select **Info**.
- 4. In the upper section of the **Info** page, just below the file name, a WIP-enabled document will have a briefcase icon followed by **Managed by Work (...)**.

#### 7 **Note**

Support for WebView2 in WIP-enabled documents was added with build 16.0.16626.20132. If you're on an older build, your runtime defaults to **EdgeHTML (Microsoft Edge Legacy)**, regardless of policy.

## **See also**

- Requirements for Running Office Add-ins
- Runtimes in Office Add-ins